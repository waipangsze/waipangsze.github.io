<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>ML | huggingface</title>
    <link href="/2025/01/08/ML-huggingface-LLM/"/>
    <url>/2025/01/08/ML-huggingface-LLM/</url>
    
    <content type="html"><![CDATA[<h1 id="conda-env">Conda env</h1><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs console"><span class="hljs-meta prompt_"># </span><span class="language-bash">check CUDA Version:</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">nvidia-smi</span><br><br>micromamba env create -n huggingface_hub<br>micromamba activate huggingface_hub <br>micromamba install python==3.10<br>micromamba env create -n huggingface_hub<br>python -c &quot;from huggingface_hub import model_info; print(model_info(&#x27;gpt2&#x27;))&quot;<br>micromamba install pytorch torchvision torchaudio pytorch-cuda=12.4 -c pytorch -c nvidia<br>micromamba install git-lfs<br>micromamba install transformers<br></code></pre></td></tr></table></figure><h1 id="example">Example</h1><h2 id="deepseek-vl2-tiny">deepseek-vl2-tiny</h2><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs console">git clone https://github.com/deepseek-ai/DeepSeek-VL2.git<br><br>micromamba env create -n DeepSeek-VL2<br>micromamba activate DeepSeek-VL2 <br>micromamba install python==3.10<br>pip install -e .<br>pip install flash-attn<br>pip install xformers<br></code></pre></td></tr></table></figure><h3 id="download">Download</h3><ul><li>Files and versions</li></ul><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs console"> Make sure you have git-lfs installed (https://git-lfs.com)<br>git lfs install<br><br>git clone https://huggingface.co/deepseek-ai/deepseek-vl2-tiny<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">If you want to <span class="hljs-built_in">clone</span> without large files - just their pointers</span><br>GIT_LFS_SKIP_SMUDGE=1 git clone https://huggingface.co/deepseek-ai/deepseek-vl2-tiny<br></code></pre></td></tr></table></figure><h3 id="section"></h3>]]></content>
    
    
    <categories>
      
      <category>ML</category>
      
    </categories>
    
    
    <tags>
      
      <tag>AI</tag>
      
      <tag>ML</tag>
      
      <tag>pytorch</tag>
      
      <tag>LLM</tag>
      
      <tag>huggingface</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ML | Scaling Law</title>
    <link href="/2025/01/08/ML-Scaling-Law/"/>
    <url>/2025/01/08/ML-Scaling-Law/</url>
    
    <content type="html"><![CDATA[<h1 id="scaling-law">Scaling Law</h1><p>In machine learning, a neural scaling law is an empirical scaling law that describes how neural network performance changes as key factors are scaled up or down. These factors typically include the <strong>number of parameters</strong>, <strong>training dataset size</strong>, and <strong>training cost</strong>.</p><ul><li>Scaling Law å®šç¾©ï¼šæˆ‘å€‘å¯ä»¥ç”¨æ¨¡å‹å¤§å°ã€Datasetå¤§å°ã€ç¸½è¨ˆç®—é‡ï¼Œä¾†é æ¸¬æ¨¡å‹æœ€çµ‚èƒ½åŠ›ã€‚ï¼ˆé€šå¸¸ä»¥ç›¸å°ç°¡å–®çš„å‡½æ•¸å‹æ…‹, ex: Linear relationshipï¼‰</li><li>å¦‚æœæˆ‘å€‘æ¥å—åŸæœ¬Scaling Lawçš„å®šç¾©ï¼ˆæ¨¡å‹æ€§èƒ½å¯è—‰ç”±åƒæ•¸é‡ã€Datasetå¤§å°ã€è¨ˆç®—é‡é æ¸¬ï¼‰ï¼Œé¦¬ä¸Šå°±æœƒè¡ä¼¸å‡ºå…©å€‹å¾ˆé‡è¦çš„å•é¡Œã€‚<ul><li>Returnï¼ˆæ”¶ç›Šï¼‰ï¼šåœ¨å›ºå®šçš„è¨“ç·´è¨ˆç®—é‡ä¹‹ä¸‹ï¼Œæˆ‘å€‘æ‰€èƒ½å¾—åˆ°çš„æœ€å¥½æ€§èƒ½æ˜¯å¤šå¥½ï¼Ÿ</li><li>Allocationï¼ˆåˆ†é…ï¼‰ï¼šæˆ‘å€‘è¦æ€éº¼åˆ†é…æˆ‘å€‘çš„æ¨¡å‹åƒæ•¸é‡è·ŸDatasetå¤§å°ã€‚ï¼ˆå‡è¨­è¨ˆç®—é‡ = åƒæ•¸é‡ * Dataset sizeï¼Œæˆ‘å€‘è¦å¤§æ¨¡å‹ * å°‘é‡dataã€ä¸­æ¨¡å‹ * ä¸­é‡dataã€é‚„æ˜¯å°æ¨¡å‹ * å¤§é‡dataï¼‰</li></ul></li><li>2022å¹´DeepMindæå‡ºChinchilla Scaling Lawï¼ŒåŒæ™‚è§£æ±ºäº†é€™å…©å€‹å•é¡Œï¼Œä¸¦ä¸”ä¾æ­¤æ”¹å–„äº†ç•¶æ™‚å…¶ä»–å¤§æ¨¡å‹çš„è¨“ç·´æ–¹å¼ã€‚<ul><li>ä»–å€‘åŸºæ–¼ä¸‰ç¨®æ–¹å¼ä¾†æ‰¾åˆ°è¨“ç·´LLMçš„Scaling Lawï¼š<ul><li>å›ºå®šæ¨¡å‹å¤§å°ï¼Œè®ŠåŒ–è¨“ç·´Dataæ•¸é‡ã€‚</li><li>å›ºå®šè¨ˆç®—é‡ï¼ˆæµ®é»é‹ç®—ï¼‰ï¼Œè®ŠåŒ–æ¨¡å‹å¤§å°ã€‚</li><li>å°æ‰€æœ‰å¯¦é©—çµæœï¼Œç›´æ¥æ“¬åˆåƒæ•¸åŒ–æå¤±å‡½æ•¸ã€‚</li></ul></li></ul></li><li><strong>é€™å°±åƒæ˜¯é–‹é ­OpenAIçš„åœ–ï¼Œæ‰¾åˆ°äº†ä¸€å€‹é ä¼°è¨“ç·´LLMå›å ±çš„å…¬å¼ï¼Œä¾æ­¤ï¼Œæˆ‘å€‘ä¸ç”¨æ‹¿è¶…å¤§çš„æ¨¡å‹è·Ÿæ•¸æ“šï¼Œç”¨å¹¾å€‹æœˆç”šè‡³å¹¾å¹´çš„æ™‚é–“æ…¢æ…¢åšå¯¦é©—ï¼Œåªè¦åœ¨å°æ¨¡å‹ã€å°æ•¸æ“šä¸‹é©—è­‰ã€ç¢ºèªæˆ‘å€‘çš„å…¬å¼ï¼Œå°±å¯ä»¥è¨­è¨ˆä¸€å€‹æ›´å¤§å‹çš„è¨“ç·´ï¼Œå¤§å¹…åº¦æ¸›å°‘äº†å¯¦é©—æˆæœ¬</strong>ã€‚</li></ul><h2 id="å› æ‡‰scaling-lawæˆ‘å€‘è¦å¦‚ä½•æ”¹è®Šæˆ‘å€‘çš„å·¥ä½œæ¨¡å¼èˆ‡æ€è€ƒæ–¹å¼">å› æ‡‰Scaling Lawï¼Œæˆ‘å€‘è¦å¦‚ä½•æ”¹è®Šæˆ‘å€‘çš„å·¥ä½œæ¨¡å¼èˆ‡æ€è€ƒæ–¹å¼ï¼Ÿ</h2><ul><li>è¦èƒ½ Scalingï¼Œæ„å‘³è‘—çµ„ç¹”å¿…é ˆèƒ½å¤ æ”¯æ´æŒçºŒæ“´å¤§ï¼ˆScaleï¼‰æ¨¡å‹çš„infraè·ŸGPUè³‡æºåˆ†é…æ¨¡å¼ã€‚<ul><li>é¦–å…ˆï¼Œæˆ‘å€‘ä¾†èªª infrastructureï¼Œä»¥7Bæ¨¡å‹è€Œè¨€ï¼Œç²—ä¼°è¦ä½”ç”¨15GB~20GBçš„GPU memoryï¼Œä¹Ÿå°±æ˜¯èªªå¦‚æœä½ å…¨åƒæ•¸è¨“ç·´ï¼Œä¸€å¼µA100ï¼ˆ80GB GPU memoryï¼‰åªèƒ½é–‹ Batch = 4ï¼Œå¦‚æœä½ æƒ³è¦ Batch = 64, 128ï¼Œé‚£éº¼å¿…é ˆå…ˆé€²è¡Œè·¨å¡å’Œè·¨æ©Ÿçš„è¨“ç·´ç’°å¢ƒè¨­ç½®ã€‚</li><li>åŒæ™‚ç‚ºäº†åŠ é€Ÿè¨“ç·´ï¼Œè®“memoryä½¿ç”¨ç‡è®Šçš„æ›´é«˜ï¼Œæ¯ä¸€å…©å€‹æœˆå¹¾ä¹å°±æœ‰æ–°çš„æŠ€è¡“ã€python packageå‡ºä¾†ï¼ŒEx: Flash Attention 2, Zero 3, Vllm, Gradient Checkpoint, CPU offloading â€¦ç­‰ï¼Œéš¨æ™‚è¿½è¹¤æœ€æ–°çš„è¨“ç·´å„ªåŒ–æŠ€è¡“ï¼Œä¸¦ä¸”ä¿æŒçµ„ç¹”çš„Serverè¦èƒ½å¤ é«˜é »ç‡åšæ”¹è®Šï¼Œå¦‚æœä¸€å€‹çµ„ç¹”å°Serverè£¡é¢pipç‰ˆæœ¬æ›´æ–°ã€å„ç¨®packagesæ›´æ–°çš„é€±æœŸéƒ½æ˜¯ä»¥æœˆç‚ºå–®ä½ï¼Œæ³¨å®šæœƒåœ¨infraå±¤é¢è½å¾Œå…¨ä¸–ç•ŒåŠå¹´åˆ°ä¸€å¹´ã€‚</li></ul></li></ul><h2 id="gpuçš„è³‡æºåˆ†é…æ¨¡å¼-é€šéscalingæª¢æŸ¥">GPUçš„è³‡æºåˆ†é…æ¨¡å¼, é€šéScalingæª¢æŸ¥</h2><p>GPUçš„è³‡æºåˆ†é…æ¨¡å¼ï¼Œå‚³çµ±å¯¦é©—å®¤ã€å…¬å¸çš„GPUè³‡æºæ¨¡å¼ä¸å¤–ä¹å…©ç¨®ï¼š</p><ul><li>å¹³å‡åˆ†æ”¤GPUçµ¦æ¯å€‹äºº</li><li>å› æ‡‰Projectå»ç”³è«‹æ›´å¤§å‹çš„GPU cluster</li></ul><div class="note note-primary">            <p>æ›´å¥½çš„æ–¹æ³•æ‡‰è©²æ˜¯ç›¡é‡è®“æ¯å€‹Projectéƒ½å…·å‚™åœ¨ 3B ä»¥ä¸‹æ¨¡å‹é€²è¡Œæ¦‚å¿µé©—è­‰çš„èƒ½åŠ›ï¼Œä¸¦<strong>è¨­è¨ˆæ­£å¼çš„Scalingæª¢æŸ¥æ©Ÿåˆ¶</strong>ï¼Œåªæœ‰<strong>é€šéScalingæª¢æŸ¥çš„åœ˜éšŠ</strong>å¯ä»¥ "By experiments" å»ä½¿ç”¨æ›´å¤§çš„GPU Clusterã€‚é€™é‚Šæåˆ°Scalingæª¢æŸ¥æ©Ÿåˆ¶ï¼Œæ ¸å¿ƒå°±æ˜¯ï¼Œç•¶æˆ‘å€‘æƒ³è¦è·‘7Bç”šè‡³13Bæ¨¡å‹æ™‚ï¼Œæˆ‘å€‘æœ€å¥½åœ¨3Bä»¥ä¸‹çš„æ¨¡å‹éƒ½æœ‰ä¸€è‡´çš„Scaling Behaviorã€‚æœ€å¥½åœ¨BERTè·ŸT5é€™å…©ç¨®å¤§å°å…ˆé€²è¡Œéæ¦‚å¿µé©—è­‰ã€‚</p>          </div><h2 id="scalingå…¶ä¸­æœ€å°‘éƒ½æœƒåŒ…å«ä¸‰å€‹éšæ®µ">Scalingï¼Œå…¶ä¸­æœ€å°‘éƒ½æœƒåŒ…å«ä¸‰å€‹éšæ®µ</h2><ul><li>Cold startï¼šä¸€é–‹å§‹æ¨¡å‹å¤ªå°ã€Dataä¸å¤ ã€å•é¡Œå¤ªé›£æ™‚ï¼Œæœƒå‘ˆç¾æ€éº¼è¨“ç·´éƒ½æ²’æœ‰å¹«åŠ©ï¼Œå¥½å¹¾å€‹ä¸åŒå¤§å°çš„æ¨¡å‹ã€Datasetè¨“ç·´å‡ºä¾†çš„çµæœéƒ½å·®ä¸å¤šçˆ›ï¼Œçœ‹ä¸å‡ºScalingçš„æ™‚æœŸã€‚</li><li>Scalingï¼šæ­£å¸¸çš„Scalingæ™‚æœŸã€‚</li><li>Plateauï¼šæ’åˆ°äº†æŸå€‹éš±å½¢çš„å¤©èŠ±æ¿ï¼Œå¯èƒ½æ˜¯Datasetå“è³ªå¸¶ä¾†çš„å¤©èŠ±æ¿ã€æœ¬èº«ä»»å‹™çš„Irreducible Errorã€Architectureçš„èƒ½åŠ›å¤©èŠ±æ¿ã€‚</li></ul><p><img src="https://miro.medium.com/v2/resize:fit:828/format:webp/1*7bmT0RvnsfR1vvQ2ZBh8WQ.png" width="600" /></p><h2 id="ä¸€å€‹å¥½çš„ideaä¸€å®šè¦å…·å‚™scaleçš„æ½›èƒ½">ä¸€å€‹å¥½çš„ideaï¼Œä¸€å®šè¦å…·å‚™Scaleçš„æ½›èƒ½</h2><h1 id="references">References</h1><ul><li><a href="https://axk51013.medium.com/llm%E5%B0%88%E6%AC%84-%E8%BF%8E%E6%8E%A52024%E5%B9%B4-10%E5%80%8B%E5%BF%85%E9%A0%88%E8%A6%81%E6%90%9E%E6%87%82%E7%9A%84llm%E6%A6%82%E5%BF%B5-1-scaling-law-5f6a409d35c5">LLM 10å¤§è§€å¿µ-1 Scaling Law</a></li><li><a href="https://en.wikipedia.org/wiki/Neural_scaling_law">Neural_scaling_law | wiki</a></li><li><a href="https://arxiv.org/abs/2001.08361">Kaplan, Jared, et al. "Scaling laws for neural language models." arXiv preprint arXiv:2001.08361 (2020). | OpenAI</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>ML</category>
      
    </categories>
    
    
    <tags>
      
      <tag>AI</tag>
      
      <tag>ML</tag>
      
      <tag>pytorch</tag>
      
      <tag>LLM</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ML | GPU Memory for ML model</title>
    <link href="/2025/01/07/ML-GPU-Memory-for-Models/"/>
    <url>/2025/01/07/ML-GPU-Memory-for-Models/</url>
    
    <content type="html"><![CDATA[<h1 id="gpu-memory-you-need-to-serve-any-ml-models">GPU Memory you need to serve any ML models</h1><p><strong>System Memory (RAM)</strong> is not ideal for this purpose because it is slower than GPU memory. <strong>GPU memory</strong>, also known as <strong>VRAM (Video Memory)</strong> or <strong>GDDR (Graphics DDR)</strong>, is specifically designed for high-performance computing tasks like deep learning. It provides the speed and bandwidth needed to efficiently run large language models.</p><div class="note note-primary">            <p>So, the more VRAM the GPU has, the bigger Model/LLM it can host and serve</p>          </div><ul><li>P (parameters) : The number of parameters in the model. For example, GPT-3 has 175 Billion parameters, Llama-70b has 70 Billion Parameters etc.</li><li>Q (Precision or Size per parameter) : Is the data type used to store the model parameters. Common data types include:<ul><li>FP32 (32-bit floating point): 4 bytes per parameter</li><li>FP16 (half/BF16) (16-bit floating point): 2 bytes per parameter</li><li>INT8 (8-bit integer): 1 byte per parameter</li><li>INT4 (4-bit integer): 0.5 bytes per parameter</li></ul></li></ul><p>Overhead factor : This accounts for additional memory used during inference, such as storing activations (intermediate results) of the model. A typical overhead factor is 20%.</p><p>ä»¥ Llama-2-7b-hf ç‚ºä¾‹</p><ul><li>å› ç‚ºå…¨ç²¾åº¦æ¨¡å‹åƒæ•¸æ˜¯ float32 é¡å‹, ä½”ç”¨ 4 å€‹ä½å…ƒçµ„ï¼Œç²—ç•¥è¨ˆç®—ï¼š1b(10å„„)å€‹æ¨¡å‹åƒæ•¸ï¼Œç´„ä½”ç”¨4Gé¡¯å­˜(å¯¦éš›å¤§å°ï¼š10^9 * 4 / 1024^3 ~= 3.725 GB) ï¼Œå‰‡LLaMA çš„åƒæ•¸é‡ç‚º7bï¼Œé‚£éº¼è¼‰å…¥æ¨¡å‹åƒæ•¸æ‰€éœ€çš„é¡¯å­˜ç‚ºï¼š3.725 * 7 ~= 26.075 GB</li><li>å¦‚æœæ‚¨çš„é¡¯å­˜ä¸è¶³ 32GBï¼Œé‚£éº¼å¯ä»¥è¨­å®šåŠç²¾åº¦çš„ FP16/BF16 ä¾†åŠ è¼‰ï¼Œæ¯å€‹åƒæ•¸åªä½” 2 å€‹å­—ç¯€ï¼Œæ‰€éœ€é¡¯å­˜å°±ç›´æ¥æ¸›åŠï¼Œåªéœ€è¦ç´„ 13GBã€‚é›–ç„¶æ¨¡å‹æ•ˆæœæœƒå› ç²¾åº¦æå¤±è€Œç•¥å¾®é™ä½ï¼Œä½†ä¸€èˆ¬åœ¨å¯æ¥å—ç¯„åœã€‚</li><li>å¦‚æœæ‚¨çš„é¡¯å­˜ä¸è¶³ 16GBï¼Œé‚£éº¼å¯ä»¥æ¡ç”¨ int8 é‡åŒ–å¾Œï¼Œé¡¯å­˜å†æ¸›åŠï¼Œåªéœ€è¦ç´„ 6.5GBï¼Œä½†æ˜¯æ¨¡å‹æ•ˆæœæœƒæ›´å·®ä¸€äº›ã€‚</li><li>å¦‚æœæ‚¨çš„é¡¯å­˜å°‘æ–¼ 8GBï¼Œé‚£éº¼åªèƒ½æ¡ç”¨ int4 é‡åŒ–ï¼Œé¡¯ç¤ºå†æ¸›åŠï¼Œåªéœ€è¦ç´„ 3.26GBã€‚</li></ul><p>æˆ‘å€‘ä¾†èªª infrastructureï¼Œä»¥7Bæ¨¡å‹è€Œè¨€ï¼Œç²—ä¼°è¦ä½”ç”¨ 15GB~20GB çš„GPU memoryï¼Œä¹Ÿå°±æ˜¯èªªå¦‚æœä½ å…¨åƒæ•¸è¨“ç·´ï¼Œä¸€å¼µA100ï¼ˆ80GB GPU memoryï¼‰åªèƒ½é–‹ Batch = 4ï¼Œå¦‚æœä½ æƒ³è¦ Batch = 64, 128ï¼Œé‚£éº¼å¿…é ˆå…ˆé€²è¡Œè·¨å¡å’Œè·¨æ©Ÿçš„è¨“ç·´ç’°å¢ƒè¨­ç½®ã€‚</p><h2 id="torch.dtype">torch.dtype</h2><ul><li><a href="https://pytorch.org/docs/stable/tensor_attributes.html" class="uri">https://pytorch.org/docs/stable/tensor_attributes.html</a></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># add `torch_dtype=torch.float16` to use half the memory</span><br></code></pre></td></tr></table></figure><h1 id="references">References</h1><ul><li><a href="https://www.microsoft.com/en-us/research/uploads/prod/2020/09/dnnmem.pdf">Estimating GPU Memory Consumption of Deep Learning Models | microsoft | 2020 (<strong>Recommended</strong>)</a></li><li><a href="https://ksingh7.medium.com/calculate-how-much-gpu-memory-you-need-to-serve-any-llm-67301a844f21">Calculate : How much GPU Memory you need to serve any LLM ?</a></li><li><a href="https://unfoldai.com/gpu-memory-requirements-for-llms/">GPU memory requirements for serving Large Language Models</a></li><li><a href="https://www.jiqizhixin.com/articles/2020-02-19-9">2020å¹´ææ·±åº¦å­¦ä¹ éœ€è¦ä»€ä¹ˆæ ·çš„GPUï¼šè¯·ä¸Š48Gæ˜¾å­˜</a></li><li><a href="https://cloud.tencent.com/developer/article/2403424">æŒ‘æˆ˜æ€§èƒ½æé™å°æ˜¾å¡å¤§ä½œä¸ºï¼Œæ•™ä½ å¦‚ä½•åœ¨æœ‰é™èµ„æºä¸‹è¿è¡Œå¤§å‹æ·±åº¦å­¦ä¹ æ¨¡å‹ï¼ŒGPUæ˜¾å­˜ä¼°ç®—å¹¶é«˜æ•ˆåˆ©ç”¨å…¨æ”»ç•¥ï¼</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>ML</category>
      
    </categories>
    
    
    <tags>
      
      <tag>AI</tag>
      
      <tag>ML</tag>
      
      <tag>pytorch</tag>
      
      <tag>NVIDIA</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>CFD | Boussinesq approximation (buoyancy)</title>
    <link href="/2025/01/03/CFD-Boussinesq-approximation-buoyancy/"/>
    <url>/2025/01/03/CFD-Boussinesq-approximation-buoyancy/</url>
    
    <content type="html"><![CDATA[<h1 id="boussinesq-approximation-buoyancy">Boussinesq approximation (buoyancy)</h1><p>In fluid dynamics, the Boussinesq approximation is used in the field of buoyancy-driven flow (also known as natural convection). It ignores density differences except where they appear in terms multiplied by <span class="math inline">\(g\)</span>, the acceleration due to gravity.</p><p>Boussinesq flows are common in nature (such as atmospheric fronts, oceanic circulation, katabatic winds), industry (dense gas dispersion, fume cupboard ventilation), and the built environment (natural ventilation, central heating). The approximation can be used to simplify the equations describing such flows, whilst still describing the flow behaviour to a high degree of accuracy.</p><p><span class="math display">\[ \frac{\partial\rho}{\partial t} + \nabla\cdot\left(\rho\mathbf{u}\right) = 0\]</span></p><p>If density variations are ignored, this reduces to <span class="math display">\[\nabla\cdot\mathbf{u} = 0\]</span></p><p>The general expression for conservation of momentum of an incompressible, Newtonian fluid (the Navierâ€“Stokes equations) is</p><p><span class="math display">\[\frac{\partial \mathbf{u}}{\partial t} + \left( \mathbf{u}\cdot\nabla \right) \mathbf{u} = -\frac{1}{\rho}\nabla p + \nu\nabla^2 \mathbf{u} + \frac{1}{\rho}\mathbf{F}\]</span></p><p>where <span class="math inline">\(F\)</span> is the sum of any body forces such as gravity. In this equation, density variations are assumed to have a fixed part and another part that has a linear dependence on temperature:</p><p><span class="math display">\[\rho = \rho_0 - \alpha\rho_0(T-T_0),\]</span></p><p>where <span class="math inline">\(\alpha\)</span> is the coefficient of <strong>thermal expansion</strong>. The Boussinesq approximation states that the density variation is only important in the buoyancy term.</p><p>If <span class="math inline">\(F = \rho \mathbf{g}\)</span> is the gravitational body force, the resulting conservation equation is</p><p><span class="math display">\[ \frac{\partial \mathbf{u}}{\partial t} + \left( \mathbf{u}\cdot\nabla \right) \mathbf{u} = -\frac{1}{\rho_0}\nabla (p-\rho_0\mathbf{g}\cdot\mathbf{z}) + \nu\nabla^2 \mathbf{u} - \mathbf{g}\alpha(T-T_0)\]</span></p><p>In the equation for heat flow in a temperature gradient, the heat capacity per unit volume, <span class="math display">\[\rho C_p\]</span>, is assumed constant and the dissipation term is ignored. The resulting equation is</p><p><span class="math display">\[\frac{\partial T}{\partial t} + \mathbf{u}\cdot\nabla T = \frac{k}{\rho C_p}\nabla^2T +\frac{J}{\rho C_p}\]</span></p><p>where <span class="math inline">\(J\)</span> is the rate per unit volume of internal heat production and <span class="math inline">\(k\)</span> is the <strong>thermal conductivity</strong>.</p><p>The three numbered equations are the basic convection equations in the Boussinesq approximation.</p><h1 id="references">References</h1><ul><li><a href="https://www.comsol.com/multiphysics/boussinesq-approximation">The Boussinesq Approximation</a></li><li><a href="https://www.simscale.com/docs/simwiki/cfd-computational-fluid-dynamics/what-is-boussinesq-approximation/">What is the Boussinesq Approximation?</a></li><li><a href="https://arxiv.org/abs/2206.03046">The Boussinesq approximation for buoyant flows</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>CFD</category>
      
    </categories>
    
    
    <tags>
      
      <tag>HPC</tag>
      
      <tag>OpenFOAM</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ML | PINN | DeepXDE</title>
    <link href="/2025/01/03/ML-PINN-DeepXDE/"/>
    <url>/2025/01/03/ML-PINN-DeepXDE/</url>
    
    <content type="html"><![CDATA[<h1 id="deepxde">DeepXDE</h1><p>DeepXDE æ˜¯ä¸€æ¬¾å¼€æºä¸”é«˜åº¦æ¨¡å—åŒ–çš„ç§‘å­¦è®¡ç®—å·¥å…·ï¼Œä»¥æ·±åº¦å­¦ä¹ ä¸ºæ ¸å¿ƒï¼Œæä¾›å¤šç§æ•°æ®ã€ç‰©ç†æœºç†åŠæ•°ç†èåˆçš„æ¨¡å‹ï¼Œå¦‚PINNã€DeepONetã€MFNNç­‰ï¼ŒåŒæ—¶æ”¯æŒå¤šç§ç±»å‹å¾®åˆ†æ–¹ç¨‹ï¼Œå¦‚å¸¸å¾®åˆ†æ–¹ç¨‹ã€åå¾®åˆ†æ–¹ç¨‹çš„å®šä¹‰åŠæ±‚è§£ï¼Œå¯æœ‰æ•ˆè§£å†³å¤æ‚ç§‘å­¦è®¡ç®—é—®é¢˜ã€‚ åŸºäºæ‰€æä¾›çš„æ·±åº¦å­¦ä¹ æ±‚è§£æ¨¡å‹ï¼ŒDeepXDEå…·å¤‡ä»¥ä¸‹å…¸å‹çš„åŠŸèƒ½ç‰¹ç‚¹ï¼š</p><ul><li>é«˜åº¦æ¨¡å—åŒ–ï¼šDeepXDEæä¾›å¤šç§æ”¯æŒè°ƒç”¨ã€ç»„åˆçš„æ¨¡å—ï¼Œå¦‚è®¡ç®—åŸŸã€è¾¹ç•Œæ¡ä»¶ã€å¾®åˆ†æ–¹ç¨‹ã€ç¥ç»ç½‘ç»œã€è®­ç»ƒåŠé¢„æµ‹ç­‰ï¼Œæ–¹ä¾¿ç”¨æˆ·ç»„åˆæ„å»ºç‰©ç†ç³»ç»Ÿï¼›</li><li>å¤šç±»å¾®åˆ†æ–¹ç¨‹ï¼šæ”¯æŒè‡ªå®šä¹‰å¸¸å¾®åˆ†æ–¹ç¨‹ã€åå¾®åˆ†æ–¹ç¨‹ã€ç§¯åˆ†å¾®åˆ†æ–¹ç¨‹ç­‰æ¥æè¿°å…·ä½“é—®é¢˜ï¼›</li><li>å¯æ‰©å±•æ€§ï¼šæ”¯æŒç”¨æˆ·ç»“åˆè‡ªèº«éœ€æ±‚æ·»åŠ è‡ªå®šä¹‰çš„æ•°å€¼ç®—æ³•ã€æ¨¡å‹æˆ–å…¶ä»–åŠŸèƒ½ï¼›</li><li>å¯è§†åŒ– ï¼šæä¾›ä¸€ç³»åˆ—ä¸°å¯Œçš„å¯è§†åŒ–å·¥å…·ï¼Œå¯ä»¥å¸®åŠ©ç”¨æˆ·ç›´è§‚åœ°ç†è§£è®¡ç®—ç»“æœã€‚</li></ul><p>åœ¨ç§‘å­¦è®¡ç®—é¢†åŸŸï¼ŒDeepXDEçš„å¼ºå¤§åŠŸèƒ½ä¸é«˜ç²¾åº¦æ±‚è§£èƒ½åŠ›ï¼Œä½¿å…¶æˆä¸ºå›½å†…å¤–çŸ¥åçš„ç§‘å­¦è®¡ç®—å·¥å…·ä¹‹ä¸€ã€‚æˆªæ­¢ç›®å‰ï¼ŒDeepXDEçš„ä¸‹è½½é‡å·²è¶…è¿‡40ä¸‡æ¬¡ï¼Œå¹¶è¢«å…¨çƒ70å¤šæ‰€çŸ¥åå¤§å­¦ã€ç§‘ç ”æœºæ„å’Œä¼ä¸šé‡‡ç”¨ï¼Œæ¯”å¦‚MITã€Stanfordã€ç¾å›½è¥¿åŒ—å¤ªå¹³æ´‹å›½å®¶å®éªŒå®¤ã€é€šç”¨æ±½è½¦ç­‰ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼ŒDeepXDEæ­£åœ¨å¸®åŠ©ç”¨æˆ·å¿«é€Ÿè§£å†³å¤æ‚çš„ç§‘å­¦è®¡ç®—é—®é¢˜ï¼Œä¸ºå„é¢†åŸŸç§‘å­¦ç ”ç©¶çš„è¿›å±•ä½œå‡ºäº†é‡è¦è´¡çŒ®ã€‚</p><ul><li><a href="https://github.com/lululxvi/deepxde" class="uri">https://github.com/lululxvi/deepxde</a></li><li><a href="https://deepxde.readthedocs.io/en/latest/user/installation.html#" class="uri">https://deepxde.readthedocs.io/en/latest/user/installation.html#</a></li><li><a href="https://www.paddlepaddle.org.cn/support/news?action=detail&amp;id=3315" class="uri">https://www.paddlepaddle.org.cn/support/news?action=detail&amp;id=3315</a></li></ul><h1 id="install">Install</h1><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs console">micromamba create -n deepxde <br>micromamba activate /home/wpsze/micromamba/envs/deepxde<br>micromamba install conda-forge::pytorch-gpu<br>micromamba install -c conda-forge deepxde<br></code></pre></td></tr></table></figure><h1 id="run">Run</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/bash</span><br><br><span class="hljs-built_in">source</span> /home/wpsze/micromamba/etc/profile.d/mamba.sh<br>micromamba activate deepxde<br><br><span class="hljs-comment"># Before running your code, run this shell command to tell torch that there are no GPUs:</span><br><span class="hljs-comment">#export CUDA_VISIBLE_DEVICES=&quot;&quot;</span><br><br>time DDE_BACKEND=pytorch python Helmholtz_equation_2D.py<br></code></pre></td></tr></table></figure><h2 id="gpu">GPU</h2><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs console">nvidia-smi<br></code></pre></td></tr></table></figure><ul><li>GPU usage,</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> torch<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;--&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;torch.cuda.memory_allocated: %fMB&quot;</span>%(torch.cuda.memory_allocated(<span class="hljs-number">0</span>)/<span class="hljs-number">1024</span>/<span class="hljs-number">1024</span>))<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;torch.cuda.memory_reserved: %fMB&quot;</span>%(torch.cuda.memory_reserved(<span class="hljs-number">0</span>)/<span class="hljs-number">1024</span>/<span class="hljs-number">1024</span>))<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;torch.cuda.max_memory_reserved: %fMB&quot;</span>%(torch.cuda.max_memory_reserved(<span class="hljs-number">0</span>)/<span class="hljs-number">1024</span>/<span class="hljs-number">1024</span>))<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;--&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;torch.cuda.memory_allocated: %fGB&quot;</span>%(torch.cuda.memory_allocated(<span class="hljs-number">0</span>)/<span class="hljs-number">1024</span>/<span class="hljs-number">1024</span>/<span class="hljs-number">1024</span>))<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;torch.cuda.memory_reserved: %fGB&quot;</span>%(torch.cuda.memory_reserved(<span class="hljs-number">0</span>)/<span class="hljs-number">1024</span>/<span class="hljs-number">1024</span>/<span class="hljs-number">1024</span>))<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;torch.cuda.max_memory_reserved: %fGB&quot;</span>%(torch.cuda.max_memory_reserved(<span class="hljs-number">0</span>)/<span class="hljs-number">1024</span>/<span class="hljs-number">1024</span>/<span class="hljs-number">1024</span>))<br>device = torch.device(<span class="hljs-string">&#x27;cuda:0&#x27;</span>)<br>free, total = torch.cuda.mem_get_info(device)<br>mem_used_MB = (total - free) / <span class="hljs-number">1024</span> ** <span class="hljs-number">2</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;mem_used_MB = &quot;</span>, mem_used_MB)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;mem_used_GB = &quot;</span>, mem_used_MB/<span class="hljs-number">1024</span>)<br></code></pre></td></tr></table></figure><h2 id="cpu-only">CPU only</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># Before running your code, run this shell command to tell torch that there are no GPUs:</span><br><span class="hljs-built_in">export</span> CUDA_VISIBLE_DEVICES=<span class="hljs-string">&quot;&quot;</span><br><br><span class="hljs-comment"># This will tell it to use only one GPU (the one with id 0) and so on:</span><br><span class="hljs-built_in">export</span> CUDA_VISIBLE_DEVICES=<span class="hljs-string">&quot;0&quot;</span><br></code></pre></td></tr></table></figure><h2 id="cpu-vs-gpu">CPU vs GPU</h2><p>Test: <a href="https://deepxde.readthedocs.io/en/latest/demos/pinn_forward/helmholtz.2d.neumann.hole.html">Helmholtz equation over a 2D square domain with a hole</a></p><ul><li>iterations = 10000</li><li>num_dense_layers = 6</li><li>num_dense_nodes = 1350</li></ul><table><thead><tr class="header"><th></th><th>Cores</th><th>Training Time</th><th></th></tr></thead><tbody><tr class="odd"><td>CPU</td><td>20</td><td>5809s ~ 97min</td><td></td></tr><tr class="even"><td>GPU</td><td>10496</td><td>227s ~ 3.78min</td><td></td></tr><tr class="odd"><td>GPU/CPU</td><td>524.8</td><td>0.03907729385</td><td>1/0.039 ~ 25.59</td></tr></tbody></table><ul><li>CPU: (%CPU=2000)<ul><li>Intel(R) Xeon(R) Silver 4210R CPU @ 2.40GHz</li><li>Core(s) per socket: 10</li><li>Socket(s): 2</li></ul></li><li>GPU: 3090 (Volatile GPU util ~ 87%)<ul><li>CUDA cores: 10496</li></ul></li></ul><h1 id="reproducibility">Reproducibility</h1><p>Completely reproducible results are not guaranteed across PyTorch releases, individual commits, or different platforms. Furthermore, results may not be reproducible between CPU and GPU executions, even when using identical seeds.</p><p>However, there are some steps you can take to limit the number of sources of nondeterministic behavior for a specific platform, device, and PyTorch release. First, you can control sources of randomness that can cause multiple executions of your application to behave differently. Second, you can configure PyTorch to avoid using nondeterministic algorithms for some operations, so that multiple calls to those operations, given the same inputs, will produce the same result.</p><ul><li><a href="https://pytorch.org/docs/stable/notes/randomness.html" class="uri">https://pytorch.org/docs/stable/notes/randomness.html</a></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> torch<br>torch.manual_seed(<span class="hljs-number">0</span>)<br><br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br>np.random.seed(<span class="hljs-number">0</span>)<br><br><span class="hljs-keyword">import</span> random<br>random.seed(<span class="hljs-number">0</span>)<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>ML</category>
      
    </categories>
    
    
    <tags>
      
      <tag>PINN</tag>
      
      <tag>AI</tag>
      
      <tag>DeepONet</tag>
      
      <tag>ML</tag>
      
      <tag>DeepXDE</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>NWP | Bias Correction</title>
    <link href="/2025/01/02/NWP-Bias-Correction/"/>
    <url>/2025/01/02/NWP-Bias-Correction/</url>
    
    <content type="html"><![CDATA[<ul><li><a href="https://www.hko.gov.hk/hko/publica/reprint/r948.pdf">æ‡‰ç”¨ã€Œæ¨¡å¼è¼¸å‡ºçµ±è¨ˆã€æ ¡æ­£ï¥©ç¢¼æ°£æº«é å ± | HKO | 2011</a><ul><li>å¤šå…ƒç·šæ€§å›æ­¸åŠå¡çˆ¾æ›¼ï¦„æ³¢</li><li>å‡ºç¾æ¬¡ï¥©æœ€å¤šçš„æœ€ä½³å› å­ï¼Œé¦–ä¸‰ä½ç‚º2ç±³æº«ï¨ã€925hPaç¶“å‘é¢¨åŠ850hPaæº«ï¨</li></ul></li><li><a href="https://www.weather.gov.hk/tc/publica/reprint/files/r1010.pdf">æ‡‰ç”¨ã€Œæ¨¡å¼è¼¸å‡ºçµ±è¨ˆã€æ ¡æ­£ç›¸å°æ¿•åº¦åŠé¢¨çš„æ•¸ç¢¼é å ± | HKO | 2012</a><ul><li>æŠŠ2010ï¦9æœˆè‡³2011ï¦8æœˆçš„ï¥©æ“šåˆ†ç‚ºå››å­£ï¼Œåˆ†åˆ¥æ‰¾å‡ºï¥§åŒçµ±è¨ˆæ¨¡å‹åœ¨å››å­£åŠå…¨ï¦(å³2010ï¦9æœˆè‡³2011ï¦8æœˆ)çš„æœ€ä½³å› å­çµ„åˆã€‚</li><li>ï¥§åŒå­£ç¯€çš„æ¯”è¼ƒ</li><li>æ™‚é–“åŠç©ºé–“çš„è®ŠåŒ–</li><li>tâ€“æ¸¬è©¦</li></ul></li></ul>]]></content>
    
    
    <categories>
      
      <category>NWP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NWP</tag>
      
      <tag>AI</tag>
      
      <tag>ML</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ML | CorrDiff (NVIDIA)</title>
    <link href="/2025/01/02/ML-CorrDiff-NVIDIA/"/>
    <url>/2025/01/02/ML-CorrDiff-NVIDIA/</url>
    
    <content type="html"><![CDATA[<h1 id="news">News</h1><ul><li><a href="https://www.scimonth.com.tw/archives/10997">ç”Ÿæˆå¼AIèˆ‡å‚³çµ±æ•¸å€¼å¤©æ°£é å ±çš„çµåˆNVIDIA CorrDiffå¤©æ°£é™å°ºåº¦æ¨¡å‹ | ç§‘å­¸æœˆåˆŠ | 2024-07-15</a><ul><li>è¼é”ï¼ˆNVIDIAï¼‰åŸ·è¡Œé•·é»ƒä»å‹³ä»Šï¼ˆ2024ï¼‰å¹´3æœˆåœ¨ç¾åœ‹èˆ‰è¾¦çš„GTCï¼ˆGPU technology conferenceï¼‰å¤§æœƒåŠ6æœˆåœ¨è‡ºç£èˆ‰è¾¦çš„è‡ºåŒ—åœ‹éš›é›»è…¦å±•ï¼ˆCOMPUTEXï¼‰ä¸Šï¼Œçš†å±•ç¤ºäº†ä¸€é …ç¨±ç‚ºã€ŒCorrDiffã€ï¼ˆCorrector Diffusionï¼‰çš„ç”Ÿæˆå¼äººå·¥æ™ºæ…§ï¼ˆgenerative artificial intelligence, generative AIï¼‰æŠ€è¡“ï¼Œä¸¦è¡¨ç¤ºå®ƒå¯ä»¥æ‡‰ç”¨æ–¼å€åŸŸé«˜è§£æåº¦å¤©æ°£é å ±ä¸Šã€‚</li><li>å°æ–¼æ°£è±¡æ¨¡æ“¬èˆ‡é å ±ä¾†èªªï¼Œç¸®å°ç¶²æ ¼è§£æåº¦ä¸€ç›´æ˜¯ä¸€å¤§æŒ‘æˆ°ã€‚å‚³çµ±ç‰©ç†æ¨¡å¼å—é™æ–¼é‹è¡Œæ™‚æ‰€éœ€çš„é¾å¤§é‹ç®—é‡ï¼Œç•¶ä»ŠåŸ·è¡Œå…¨çƒé å ±çš„æœ€é«˜è§£æåº¦æ¨¡å¼ç‚ºECMWFçš„ä¹å…¬é‡Œè§£æåº¦å…¨çƒæ¨¡å¼ã€‚</li><li>æ°£è±¡ç½²ç™¼å±•çš„ã€ŒRWRFã€ï¼ˆRadar WRFï¼‰é«˜è§£æåº¦æ¥µçŸ­æœŸåŠ‡çƒˆå¤©æ°£é å ±ç³»çµ±ï¼ˆå»¶ä¼¸é–±è®€2ï¼‰ï¼Œå¯æå‡å°è‡ºç£å€åŸŸåŠ‡çƒˆå¤©æ°£çš„é å ±èƒ½åŠ›ã€‚æ­¤ç³»çµ±å¥ åŸºæ–¼ç¾åœ‹åœ‹å®¶å¤§æ°£ç ”ç©¶ä¸­å¿ƒï¼ˆNational Center for Atmospheric Researchï¼‰çš„ã€ŒWRFã€ï¼ˆWeather Research &amp; Forecastingï¼‰æ•¸å€¼å¤©æ°£é å ±æ¨¡å¼èˆ‡å®ƒçš„è³‡æ–™åŒåŒ–ç³»çµ±ï¼ˆWRFDAï¼‰ï¼Œå†ç”±æ°£è±¡ç½²é‡å°è‡ºç£æœ¬åœ°éœ€æ±‚ä¿®æ”¹ç™¼å±•ï¼Œè‡ª2016å¹´èµ·é–‹å§‹ä½œæ¥­é‹ä½œã€‚RWRFç³»çµ±çš„æ¨¡å¼è§£æåº¦ç‚ºå…©å…¬é‡Œï¼Œæ¶µè“‹ç¯„åœå¦‚åœ–ä¸€æ‰€ç¤ºã€‚å®ƒèƒ½é‹è¡Œå€åŸŸé«˜è§£æåº¦çš„<strong>å¿«é€Ÿæ›´æ–°å¾ªç’°è³‡æ–™åŒåŒ–</strong>ï¼Œå°‡é«˜è§£æåº¦çš„å³æ™‚è§€æ¸¬è³‡æ–™é‹ç”¨æ–¼å€åŸŸæ¨¡å¼ä¸­ï¼Œè—‰æ­¤å¾—åˆ°å€åŸŸç¯„åœå…§æ›´æº–ç¢ºçš„åˆ†æèˆ‡çŸ­æœŸé å ±è³‡æ–™ï¼Œæ¯”å–®ç´”çš„å‹•åŠ›é™å°ºåº¦é å ±æ›´ç‚ºè¤‡é›œã€‚<strong>å…¶ä¸­ï¼Œè³‡æ–™åŒåŒ–ä½¿è‡ºç£å€åŸŸçš„æ°£è±¡é›·é”è§€æ¸¬è³‡æ–™æ¯åŠå°æ™‚é€²å…¥æ­¤æ¨¡å¼ä¸­ã€åœ°é¢æ°£è±¡ç«™è§€æ¸¬è³‡æ–™ï¼ˆåŒ…å«äººå·¥å’Œè‡ªå‹•æ°£è±¡ç«™ï¼‰æ¯ä¸€å°æ™‚é€²å…¥æ¨¡å¼ä¸­ã€‚RWRFç³»çµ±ä»¥æ¯å°æ™‚çš„æ›´æ–°é »ç‡æä¾›13å°æ™‚é•·åº¦çš„é å ±è³‡æ–™ï¼Œ</strong> ä½œç‚ºç½²å…§é å ±ä¸­å¿ƒèˆ‡æ°‘èˆªå±€ç­‰ç›¸é—œæ”¿åºœå–®ä½çš„åƒè€ƒã€‚</li><li>æˆ‘å€‘å¯ä»¥çŸ¥é“æ­¤æ¨¡å‹åœ¨è¨“ç·´éç¨‹ä¸­æ¡ç”¨çš„è¼¸å…¥è³‡æ–™ç‚ºERA5å…¨çƒç´„25å…¬é‡Œè§£æåº¦å†åˆ†æè³‡æ–™ï¼ˆåƒ…æ“·å–èˆ‡RWRFç¯„åœç›¸è¿‘çš„è‡ºç£é„°è¿‘ç¯„åœï¼‰ï¼›è€Œæ¡ç”¨çš„è¼¸å‡ºè³‡æ–™å‰‡ç‚ºæ°£è±¡ç½²RWRFç³»çµ±çš„å…©å…¬é‡Œè§£æåº¦æ­·å²åˆ†æè³‡æ–™ï¼ŒåŒ…å«å‚ç›´æœ€å¤§é›·é”å›æ³¢ï¼ˆradar reflectivityï¼‰ã€å…©å…¬å°ºé«˜æ°£æº«ã€åå…¬å°ºé«˜æ±è¥¿å‘èˆ‡å—åŒ—å‘é¢¨é€Ÿç­‰å››å€‹å–®å±¤è®Šæ•¸ã€‚</li><li>åœ¨æ°£è±¡ç½²æä¾›çš„å››å¹´é¤˜çš„RWRFè³‡æ–™ä¸­ï¼Œå‰ä¸‰å¹´è¢«ç”¨ä½œç‚ºè¨“ç·´è³‡æ–™ï¼Œè€Œå¾Œé¢çš„ä¸€å¹´å››å€‹æœˆå‰‡æ˜¯é©—è­‰è³‡æ–™ã€‚</li><li>ç”±æ­¤è¨­è¨ˆå¯çŸ¥ï¼ŒCorrDiffæ¨¡å‹çš„ç›®æ¨™æ˜¯å°‡è¼ƒä½è§£æåº¦ï¼ˆç´„25å…¬é‡Œï¼‰çš„å…¨çƒå¤©æ°£é å ±æ¨¡å¼è³‡æ–™ï¼Œæå‡è§£æåº¦æˆç‚ºé«˜è§£æåº¦ï¼ˆå…©å…¬é‡Œï¼‰çš„è³‡æ–™ï¼Œä¸¦åœ¨éç¨‹ä¸­ç²å¾—å°å€åŸŸåŠ‡çƒˆå¤©æ°£é å ±é‡è¦çš„æ°£è±¡è®Šæ•¸â”€â”€æœ€å¤§é›·é”å›æ³¢ã€åœ°é¢æ°£æº«èˆ‡é¢¨é€Ÿã€‚</li><li>å°±ä½¿ç”¨é•·æœŸæ­·å²è³‡æ–™å»ºç«‹æ¨¡å‹è€Œè«–ï¼ŒCorrDiffå¯èªªæ˜¯ä¸€ç¨®é€²éšï¼ˆAIï¼‰ç‰ˆçš„çµ±è¨ˆé™å°ºåº¦ï¼›ä½†å®ƒèƒ½å¾—åˆ°é«˜è§£æåº¦ç¶²æ ¼è³‡æ–™è€Œéè§€æ¸¬é»ä¸Šçš„è³‡æ–™ï¼Œä»¥ç›®æ¨™èˆ‡æ•ˆæœè€Œè¨€æ¯”è¼ƒè¿‘ä¼¼æ–¼å‹•åŠ›é™å°ºåº¦æŠ€è¡“ã€‚</li><li><strong>CorrDiffæ¨¡å‹æ¡ç”¨å…©æ­¥é©Ÿä¾†å®Œæˆé™å°ºåº¦çš„è¨ˆç®—ï¼šç¬¬ä¸€æ­¥é©Ÿæ˜¯å…ˆä»¥å¸¸æ‡‰ç”¨æ–¼å½±åƒè™•ç†ã€èƒ½æœ‰æ•ˆç²å–å½±åƒç‰¹å¾µçš„UNetå›æ­¸æ¶æ§‹ï¼Œé€²è¡Œè³‡æ–™æ¨£æœ¬å¹³å‡å€¼çš„ä¿®æ­£ï¼›ç¬¬äºŒæ­¥é©Ÿå‰‡åˆ©ç”¨ç”Ÿæˆå¼AIä¸­çš„æ“´æ•£ï¼ˆdiffusionï¼‰æ¼”ç®—æ³•ï¼Œå¼·åŒ–è³‡æ–™çš„é«˜è§£æåº¦ç´°ç¯€èˆ‡æ¥µå€¼ã€‚æ“´æ•£æ¼”ç®—æ³•é€éå°‡åœ–åƒåŠ å…¥é›œè¨Šï¼Œå†å»é™¤é›œè¨Šçš„å¾ªç’°éç¨‹ä¾†åŸ·è¡Œï¼Œéå»å¸¸æ‡‰ç”¨æ–¼åœ–ç‰‡çš„å»å™ªï¼ˆdenoisingï¼‰ã€ä¿®è£œæˆ–è¶…è§£æåº¦æˆåƒç­‰ã€‚</strong></li><li>æœ€å¾Œï¼ŒCorrDiffæ¨¡å‹çš„é‹ç®—é€Ÿåº¦é é å¿«æ–¼RWRFç³»çµ±çš„æ•¸å€¼å¤©æ°£é å ±æ¨¡å¼ï¼Œå¾Œè€…éœ€è¦åœ¨é«˜é€Ÿé‹ç®—é›»è…¦ä¸Šä½¿ç”¨å¤§é‡ä¸­å¤®è™•ç†å™¨ï¼ˆcentral processing unit, CPUï¼‰æ ¸å¿ƒé€²è¡Œé‹ç®—ï¼Œè€Œå‰è€…åœ¨å–®ä¸€åœ–å½¢è™•ç†å™¨ï¼ˆgraphics processing unit, GPUï¼‰ä¸Šå³å¯ç”¨æ›´çŸ­çš„æ™‚é–“å®Œæˆé‹ç®—ï¼Œå…©è€…çš„èƒ½æºä½¿ç”¨æ•ˆç‡æœ‰å¤©å£¤ä¹‹åˆ¥ã€‚</li><li>åƒè€ƒé å°æœ¬è«–æ–‡ä¸­æ‰€æï¼Œæœªä¾†æ­¤æŠ€è¡“å¯èƒ½æœ‰ä»¥ä¸‹å¹¾ç¨®ä¸åŒçš„æ‡‰ç”¨æ–¹å¼<ul><li>ä¸€ã€ç”±å‚³çµ±å…¨çƒæ¨¡å¼æ•¸å€¼å¤©æ°£é å ±è³‡æ–™ï¼Œé™å°ºåº¦æˆç‚ºé«˜è§£æåº¦é å ±ã€‚</li><li>äºŒã€ç”±AIå…¨çƒå¤©æ°£é å ±æ¨¡å¼çš„é å ±è³‡æ–™ï¼Œé™å°ºåº¦æˆç‚ºé«˜è§£æåº¦é å ±ã€‚</li><li>ä¸‰ã€æ°£å€™æ¨¡æ“¬ç ”ç©¶ï¼ˆä¾‹å¦‚æ°£å€™è®Šé·æ¨ä¼°ï¼‰ä¸Šçš„é™å°ºåº¦æ‡‰ç”¨ï¼Œç‰¹åˆ¥æ˜¯ç”¨æ–¼è©•ä¼°æœªä¾†æ¥µç«¯å¤©æ°£äº‹ä»¶ç™¼ç”Ÿçš„æ©Ÿç‡ã€‚</li><li>å››ã€ç”¨æ–¼èˆ‡RWRFç³»çµ±æˆªç„¶ä¸åŒçš„å…¶ä»–åœ°ç†å€åŸŸçš„é™å°ºåº¦ï¼ˆå¯èƒ½ä»éœ€è¦å–å¾—å°æ‡‰å€åŸŸçš„é«˜è§£æåº¦æ°£è±¡è³‡æ–™ç”¨æ–¼æ¨¡å‹è¨“ç·´ï¼‰ã€‚<ul><li>å…¶ä¸­ï¼Œç¬¬ä¸‰é»èˆ‡ç¬¬å››é»çš„æ‡‰ç”¨æ–¹å¼å°šæœªç›´æ¥æœ‰ç ”ç©¶çµæœï¼Œä»ç‚ºæ½›åœ¨æ‡‰ç”¨ï¼Œæœ‰å¾…æœªä¾†æ›´å¤šç ”ç©¶ä¾†è­‰æ˜èˆ‡å±•ç¤ºå®ƒçš„èƒ½åŠ›ã€‚</li></ul></li></ul></li></ul></li><li>è¼é”åŸ·è¡Œé•·é»ƒä»å‹³çš†æåˆ°èˆ‡ä¸­å¤®æ°£è±¡ç½²åˆä½œé–‹ç™¼çš„ç”Ÿæˆå¼AIæ¨¡å‹ã€ŒCorrDiffã€ï¼Œèƒ½é€éAIå°‡æ°£è±¡è³‡æ–™è§£æåº¦å¾25å…¬é‡Œé™è‡³2å…¬é‡Œï¼Œèˆ‡å‚³çµ±æ¨¡å¼ç›¸æ¯”ï¼Œæ›´å¯è®“å–®æ¬¡æ¨ç†é€Ÿåº¦æé«˜1,000å€ã€èƒ½è€—æ¸›å°‘3,000å€ã€‚<a href="https://technews.tw/2024/09/28/cwa-corrdiff-nvidia/">link: 2024 å¹´ 09 æœˆ 28 æ—¥</a><ul><li>ç”¨CorrDiffä¾†ã€Œé™å°ºåº¦ã€ï¼ˆä¹Ÿå°±æ˜¯æé«˜è§£æåº¦ï¼‰çš„é‡è¦æ€§ç”±æ­¤è€Œç”Ÿã€‚</li><li>ä»¥CorrDiffä¾†èªªï¼Œä¾¿æ˜¯ç”±æ°£è±¡ç½²æä¾›å››å¹´ä»½ã€ä»¥æ¯å°æ™‚è¨ˆçš„2å…¬é‡Œæ°£è±¡è³‡æ–™ï¼Œå…±å«å››å€‹è®Šæ•¸ï¼Œè€Œè¼é”å‰‡æ‹¿å‡º25å…¬é‡Œæ°£è±¡è³‡æ–™ï¼Œä¸¦è² è²¬æ¼”ç®—æ³•åŠæä¾›è¶…ç´šé›»è…¦é‹ç®—è³‡æºï¼Œæ¡ã€Œç›£ç£å¼å­¸ç¿’ã€ï¼ˆSupervised learningï¼‰é€²è¡Œè¨“ç·´ï¼Œå…±åŒæ‰“ç£¨å‡ºé€™æ¬¾æ¨¡å‹ã€‚</li><li>ã€Œè¼é”åœ¨åšCorrDiffä¹‹å‰ï¼Œå…¶å¯¦å·²ç¶“åœ¨å…¨çƒå¤©æ°£é å ±æœ‰éå¸¸å¥½çš„æˆæœï¼Œæ‰€ä»¥ä»–æ¥è‘—å°±è¦æ‰¾ä¸€å€‹å°å°ºåº¦ã€å¤©æ°£æœ€å›°é›£æœ€è¤‡é›œçš„åœ°æ–¹ï¼Œã€é™³æŸå­šåˆ†æï¼Œå°ç£è™•åœ¨æœ€å¤§å­£é¢¨å€ã€æœ‰è¤‡é›œåœ°å½¢ï¼Œåˆæœ‰é¢±é¢¨ã€æ¢…é›¨ï¼Œæœ¬èº«å°±å¤ æŒ‘æˆ°ã€å¤ æœ‰ç‰¹è‰²ï¼Œé›™æ–¹åˆä½œæ˜¯é›™è´ã€‚</li></ul></li></ul><h1 id="paper">Paper</h1><ul><li><a href="https://arxiv.org/abs/2309.15214">Mardani, Morteza, et al. "Residual corrective diffusion modeling for km-scale atmospheric downscaling." arXiv preprint arXiv:2309.15214 (2023).</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>ML</category>
      
    </categories>
    
    
    <tags>
      
      <tag>AI</tag>
      
      <tag>ML</tag>
      
      <tag>pytorch</tag>
      
      <tag>NVIDIA</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>CFD | DNS</title>
    <link href="/2024/12/23/CFD-DNS/"/>
    <url>/2024/12/23/CFD-DNS/</url>
    
    <content type="html"><![CDATA[<h1 id="dns">DNS</h1><p><a href="https://en.wikipedia.org/wiki/Direct_numerical_simulation">A direct numerical simulation (DNS)</a> is a simulation in computational fluid dynamics (CFD) in which the Navierâ€“Stokes equations are numerically solved without any turbulence model. This means that the whole range of spatial and temporal scales of the turbulence must be resolved. All the spatial scales of the turbulence must be resolved in the computational mesh, from the smallest dissipative scales (Kolmogorov microscales), up to the integral scale <span class="math inline">\(L\)</span>, associated with the motions containing most of the kinetic energy.</p><p>In fluid dynamics, Kolmogorov microscales are the smallest scales in turbulent flow. At the Kolmogorov scale, viscosity dominates and the turbulence kinetic energy is dissipated into thermal energy.</p><table><thead><tr class="header"><th>Term</th><th>Formula</th></tr></thead><tbody><tr class="odd"><td>Kolmogorov length scale</td><td><span class="math inline">\(\eta = \left( \frac{\nu^3}{\varepsilon} \right)^{1/4}\)</span></td></tr><tr class="even"><td>Kolmogorov time scale</td><td><span class="math inline">\(\tau_\eta = \sqrt{ \frac{\nu}{\varepsilon} }\)</span></td></tr><tr class="odd"><td>Kolmogorov velocity scale</td><td><span class="math inline">\(u_\eta = \left( \nu \varepsilon \right)^{1/4}\)</span></td></tr></tbody></table><p>where</p><ul><li><span class="math inline">\(\varepsilon\)</span> is the average rate of dissipation of turbulence kinetic energy per unit mass, and</li><li><span class="math inline">\(\nu\)</span> is the kinematic viscosity of the fluid.</li></ul><h1 id="references">References</h1><ol type="1"><li><a href="https://mp.weixin.qq.com/s?__biz=MzAxNzkyOTkxNw==&amp;mid=2247489154&amp;idx=1&amp;sn=b770765d2d4b2c810180a9449300e846&amp;chksm=9bdf5550aca8dc46994752a830236071d351ba846cc957932cbd199c0e14100cee6aa4aeb747&amp;scene=21#wechat_redirect">æ¹æµæ˜¯ä»€ä¹ˆï¼Ÿï¼ˆ2ï¼‰æ¶¡å¤ªå°ï¼Œé‡å¤ªå¤§ï¼Œå€¼éš¾ç®—</a></li><li></li></ol>]]></content>
    
    
    <categories>
      
      <category>CFD</category>
      
    </categories>
    
    
    <tags>
      
      <tag>HPC</tag>
      
      <tag>OpenFOAM</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ML | Genesis</title>
    <link href="/2024/12/20/ML-Genesis-AI/"/>
    <url>/2024/12/20/ML-Genesis-AI/</url>
    
    <content type="html"><![CDATA[<h1 id="what-is-genesis">What is Genesis?</h1><p><img src="https://github.com/Genesis-Embodied-AI/Genesis/blob/main/imgs/teaser.png?raw=true" width="600" /></p><ul><li><a href="https://github.com/Genesis-Embodied-AI/Genesis" class="uri">https://github.com/Genesis-Embodied-AI/Genesis</a></li></ul><p>Genesis is a physics platform designed for general purpose Robotics/Embodied AI/Physical AI applications. It is simultaneously multiple things:</p><ul><li>A universal physics engine re-built from the ground up, capable of simulating a wide range of materials and physical phenomena.</li><li>A lightweight, ultra-fast, pythonic, and user-friendly robotics simulation platform.</li><li>A powerful and fast photo-realistic rendering system.</li><li>A generative data engine that transforms user-prompted natural language description into various modalities of data.</li></ul><h1 id="micromamba">micromamba</h1><h2 id="try-on-cpu-only">Try on CPU only,</h2><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs console">micromamba env create -n genesis<br>micromamba activate genesis<br>micromamba install pytorch torchvision torchaudio cpuonly -c pytorch<br>micromamba install anaconda::pip<br>micromamba install conda-forge::libgl<br>pip3 install git+https://github.com/cnr-isti-vclab/PyMeshLab<br>pip install einops timm pillow<br>pip install genesis-world <br></code></pre></td></tr></table></figure><p>and testing,</p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs console"><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; import genesis as gs</span><br>Failed to import pyrender. Rendering will not work.<br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; gs.init(backend=gs.cpu)</span><br>[Genesis] [14:56:47] [INFO] â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®<br>[Genesis] [14:56:47] [INFO] â”‚â”ˆâ”‰â”ˆâ”‰â”ˆâ”‰â”ˆâ”‰â”ˆâ”‰â”ˆâ”‰â”ˆâ”‰â”ˆâ”‰â”ˆâ”‰â”ˆâ”‰â”ˆâ”‰â”ˆâ”‰â”ˆâ”‰â”ˆâ”‰â”ˆâ”‰â”ˆâ”‰â”ˆâ”‰â”ˆâ”‰â”ˆâ”‰ Genesis â”ˆâ”‰â”ˆâ”‰â”ˆâ”‰â”ˆâ”‰â”ˆâ”‰â”ˆâ”‰â”ˆâ”‰â”ˆâ”‰â”ˆâ”‰â”ˆâ”‰â”ˆâ”‰â”ˆâ”‰â”ˆâ”‰â”ˆâ”‰â”ˆâ”‰â”ˆâ”‰â”ˆâ”‰â”ˆâ”‰â”ˆâ”‰â”‚<br>[Genesis] [14:56:47] [INFO] â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯<br>[Genesis] [14:56:47] [INFO] Running on [Intel Core Processor (Haswell, no TSX, IBRS)] with backend gs.cpu. Device memory: 62.39 GB.<br>[Genesis] [14:56:48] [INFO] ğŸš€ Genesis initialized. ğŸ”– version: 0.2.0, ğŸŒ± seed: None, ğŸ“ precision: &#x27;32&#x27;, ğŸ› debug: False, ğŸ¨ theme: &#x27;dark&#x27;.<br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; gs.generate(<span class="hljs-string">&quot;A drop of water falls on the window&quot;</span>)</span><br>Traceback (most recent call last):<br>  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;<br>AttributeError: module &#x27;genesis&#x27; has no attribute &#x27;generate&#x27;<br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">&gt;&gt;</span> <br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">scene = gs.Scene(show_viewer=<span class="hljs-literal">True</span>)<br>NameError: name <span class="hljs-string">&#x27;trimesh&#x27;</span> <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> defined<br></code></pre></td></tr></table></figure><p>export CONDA_INCLUDE_PATH=/home/wpsze/micromamba/envs/genesis/include/ cd ./ext/LuisaRender cmake -S . -B build -D CMAKE_BUILD_TYPE=Release -D PYTHON_VERSIONS=3.9 -D LUISA_COMPUTE_DOWNLOAD_NVCOMP=ON -D LUISA_COMPUTE_ENABLE_GUI=OFF -D ZLIB_INCLUDE_DIR=$CONDA_INCLUDE_PATH cmake --build build -j $(nproc)</p>]]></content>
    
    
    <categories>
      
      <category>ML</category>
      
    </categories>
    
    
    <tags>
      
      <tag>AI</tag>
      
      <tag>ML</tag>
      
      <tag>pytorch</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>CFD | Wall Function</title>
    <link href="/2024/12/18/CFD-Wall-Functions/"/>
    <url>/2024/12/18/CFD-Wall-Functions/</url>
    
    <content type="html"><![CDATA[<h1 id="why-using-wall-functions-approach">Why using wall functions approach?</h1><p>Nowadays turbulence models are heavily used when doing CFD simulations. However, <strong>some mature turbulence models such as $ k-$ are only valid in the area of turbulence fully developed</strong>, and <em>donâ€™t perform well in the area close to the wall</em>. In order to deal with the near wall region, two ways are usually proposed.</p><ul><li><strong>One way is to integrate the turbulence to the wall</strong>. Turbulence models are modified to enable the viscosity-affected region to be resolved with all the mesh down to the wall, including the viscous sublayer. This approach leads to requirement of abundant mesh number, which means a substantial computational resource is needed.</li><li><strong>Another way is to use so-called wall functions</strong>, which can model the near wall region. Wall functions are empirical equations used to satisfy the physics of the flow in the near wall region and the first cell center needs to be placed in the log-law region to ensure the accuracy of the result. Wall functions are used to bridge the inner region between the wall and the turbulence fully developed region, in order to provide near-wall boundary conditions for the momentum and turbulence transport equations, rather than to specify those conditions at the wall itself</li></ul><div class="note note-primary">            <p>Wall functions are an essential tool in CFD for modeling turbulent flows near solid boundaries. By using empirical relationships to approximate the near-wall region, they provide a balance between accuracy and computational efficiency.</p>          </div><p><img src="https://i.imgur.com/vEtRCp6.png" width="600" /></p><h1 id="wall-functions">Wall functions</h1><p>If you are a CFD engineer or scientist, wall functions are your best choice most of the time for your turbulent flow simulations since they can provide reliably accurate results within much less time than fully solving the turbulent boundary layer.</p><p><img src="https://i.imgur.com/xDxSACl.png" width="600" /></p><h2 id="wall-functions-in-openfoam">Wall functions in OpenFOAM</h2><p><strong>Wall functions are boundary conditions</strong> and in OpenFOAM all of them inherit from the abstract class <code>FvPatchField</code>.</p><p><strong>Wall functions directory</strong> in OpenFOAM is located in the path</p><p><code>$FOAM_SRC/TurbulenceModels/turbulenceModels/derivedFvPatchFields/wallFunctions</code></p><p>In wallFunctions directory there are six types of wall function sub-directories</p><ul><li>epsilonWallFunctions</li><li>kqRWallFunctions</li><li>omegaWallFunctions</li><li>fWallFunctions</li><li>nutWallFunctions</li><li>v2WallFunctions</li></ul><h1 id="near-wall-treatment-and-wall-functions">Near-wall treatment and wall functions</h1><ul><li>Wall functions is the approach to use if you are more interested in the mixing in the outer region, rather than the forces on the wall.</li><li>If accurate prediction of forces or heat transfer on the walls are key to your simulation (aerodynamic drag, turbomachinery blade performance, heat transfer) you might not want to use wall functions.</li><li>If you are conducting 2D steady simulations, do not be afraid of using a wall resolving approach.</li><li>On the other hand, if you are conducting 3D steady simulations, everything depends on your computational resources, but it you can afford it, use a wall resolving approach.</li><li>In all the other situations (unsteady cases) and if you do not have any restrictions in the nearwall treatment, use wall functions.</li><li>But again, it depends on your computational resources and time available.</li><li><strong>Wall functions can be used in RANS, DES and LES</strong>.</li><li><strong>If you are doing LES, it is highly recommended to use wall functions</strong>. Otherwise, your meshing requirements will be very similar to DNS</li></ul><p><img src="https://i.imgur.com/sSDoDhW.png" width="600" /> <img src="https://i.imgur.com/lluX5kd.png" width="600" /> <img src="https://i.imgur.com/cOet8K5.png" width="600" /> <img src="https://i.imgur.com/rsr0mMj.png" width="600" /> <img src="https://i.imgur.com/GiL1ZLN.png" width="600" /></p><h1 id="references">References</h1><ol type="1"><li><a href="https://www.wolfdynamics.com/training/turbulence/OF2021/turbulence_2021_OF8.pdf">turbulence_2021_OF8 (<strong>recommend</strong>)</a></li><li><a href="https://cfdmonkey.com/a-brief-introduction-to-wall-functions-in-cfd/">A brief introduction to wall functions in CFD</a></li><li><a href="https://doc.cfd.direct/notes/cfd-general-principles/wall-functions">7.5 Wall functions | The Architects of OpenFOAM</a></li><li><a href="https://www.tfd.chalmers.se/~hani/kurser/OS_CFD_2016/FangqingLiu/openfoamFinal.pdf">A Thorough Description Of How Wall Functions Are Implemented In OpenFOAM | Developed for OpenFOAM-4.0.x (<strong>recommend</strong>)</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>CFD</category>
      
    </categories>
    
    
    <tags>
      
      <tag>HPC</tag>
      
      <tag>OpenFOAM</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>CFD | RANS vs. URANS vs. LES</title>
    <link href="/2024/12/18/CFD-RANS-URANS-LES/"/>
    <url>/2024/12/18/CFD-RANS-URANS-LES/</url>
    
    <content type="html"><![CDATA[<h1 id="characteristics-of-turbulence">Characteristics of turbulence</h1><p>One characteristic of turbulent flows is their <strong>irregularity</strong> (or <strong>randomness</strong>). A fully deterministic approach to characterize turbulent flows is very difficult. Turbulent flows are usually described statistically.</p><ul><li>The <strong>diffusivity</strong> of turbulence cause rapid mixing and increased rates of momentum, heat, and mass transfer. A flow that looks random but does not exhibit the spreading of velocity fluctuations through the surrounding fluid is not turbulent.</li><li>Turbulent flows are <strong>dissipative</strong>. Kinetic energy gets converted into heat due to viscous shear stresses. Turbulent flows die out quickly when no energy is supplied.</li><li>Turbulent flows always occur at <strong>high Reynolds numbers</strong>. They are caused by a complex interaction between the viscous forces and convection.</li><li>Turbulent flows are rotational, that is, they have <strong>non-zero vorticity</strong>. Mechanisms such as the stretching of three-dimensional vortices play a key role in turbulence.</li><li>Turbulence is a <strong>continuum phenomenon</strong>. Even the smallest eddies are significantly larger than the molecular scales.</li><li>Turbulence is a <strong>feature of flow and is not a property of the fluid</strong>. A liquid or a gas at high Reynolds number will exhibit the same dynamics.</li></ul><ol type="1"><li><strong>Turbulent flows can originate at the walls</strong>. When this is the case, we talk about <code>wall bounded turbulence</code>.</li><li><strong>Turbulent flows can also originate in the absence of walls (or far from walls)</strong>. When this is the case, we talk about <code>shear free turbulence</code> (usually <strong>jets, heated walls, atmospheric flows</strong>).</li></ol><h1 id="instantaneous-fluctuations-removing-small-scales">Instantaneous fluctuations â€“ Removing small scales</h1><p>We have seen that turbulent flows are characterize by instantaneous fluctuations of velocity, pressure, and all transported quantities.</p><ul><li>In most engineering applications is not of interest resolving the instantaneous fluctuations.</li><li>To avoid the need to resolve the instantaneous fluctuations (or small scales), two methods can be used:<ul><li><strong>Reynolds averaging</strong>.</li><li><strong>Filtering</strong>.</li></ul></li><li>If you want to resolve all scales, you conduct DNS simulations, which are very computationally intensive.</li><li>Two methods can be used to eliminate the need to resolve the small scales:<ul><li><strong>Reynolds averaging (RANS/URANS)</strong>:<ul><li>All turbulence scales are modeled.</li><li>Can be 2D and 3D.</li><li>Can be steady or unsteady.</li></ul></li><li><strong>Filtering (LES/DES)</strong>:<ul><li>Resolves large eddies.</li><li>Models small eddies.</li><li>Intrinsically 3D and unsteady.</li></ul></li></ul></li><li>Both methods introduce additional terms in the governing equations that must be modeled (these terms are related to the instantaneous fluctuations).</li><li>The final goal of turbulence modeling is to find the closure equations to model these additional terms (usually a stress tensor).</li></ul><p><img src="https://i.imgur.com/yMpYzXN.png" width="600" /></p><p><img src="https://i.imgur.com/SrU2JMy.png" width="600" /></p><h1 id="reynolds-averaging-rans">Reynolds Averaging (RANS)</h1><div class="note note-primary">            <p><strong>Averaging the quantities (time average, spatial average or ensemble average)</strong></p>          </div><ul><li>Reynolds averaging simple consists in:<ul><li>Splitting the instantaneous value of the primitive variables into a mean component and a fluctuating component (Reynolds decomposition).</li><li><strong>Averaging the quantities (time average, spatial average or ensemble average)</strong>.</li><li>Applying a few averaging rules to simplify the equations</li><li>When we use Reynolds averaging, we are taking a statistical approach to turbulence modeling.</li></ul></li></ul><ol type="1"><li><strong>RANS (Reynolds-Averaged Navier-Stokes)</strong>: Time averaging</li><li><strong>URANS (Unsteady Reynolds-Averaged Navier-Stokes)</strong>: Ensemble averaging</li></ol><p><img src="https://i.imgur.com/hIMgzph.png" width="600" /></p><h2 id="time-averaging">Time averaging</h2><div class="note note-primary">            <p><strong>Time averaging is appropriate for stationary turbulence or slowly varying turbulent flows.</strong></p>          </div><p><span class="math display">\[\bar{\phi}(\mathbf{x})=\lim _{T \rightarrow \infty} \frac{1}{T} \int_t^{t+T} \phi(\mathbf{x}, t) d t\]</span></p><h2 id="spatial-averaging">Spatial averaging</h2><div class="note note-primary">            <p><strong>Spatial averaging is appropriate for homogenous turbulence.</strong></p>          </div><p><span class="math display">\[\bar{\phi}(t)=\lim _{V \rightarrow \infty} \frac{1}{V} \int_V \phi(\mathrm{x}, t) d V\]</span></p><h2 id="ensemble-averaging">Ensemble averaging</h2><div class="note note-primary">            <p><strong>Ensemble averaging is appropriate for unsteady turbulence.</strong></p>          </div><ul><li>In ensemble averaging, <strong>the number or realizations (or experiments) must be large enough</strong> to eliminate the effects of fluctuations. This type of averaging can be used with steady or unsteady flows.</li><li>If you can afford it, ensemble averaging is recommended. Have in mind that CFD is deterministic, <strong>so you should start each realization using different initial conditions and boundary conditions fluctuations to obtain different outcomes</strong>.</li></ul><p><span class="math display">\[\bar{\phi}(\mathrm{x}, t)=\lim _{ N \rightarrow \infty} \frac{1}{N} \sum_{i=1}^N \phi(\mathrm{x}, t)\]</span></p><h2 id="averaging-rules">Averaging rules</h2><p><img src="https://i.imgur.com/l3vVmDc.png" width="600" /></p><h1 id="question-urans">Question: URANS</h1><ul><li>URANS we basically insert the time derivative and ensemble-average the flow for a certain time step (see the picture, which is taken from the book of Ferzinger, 2020; left side is supposed to be RANS and right side is supposed to be URANS).</li><li>URANS is a Reynolds-Averaged equation. When you do this reynolds-averaging you assume that you average long enough so that you resolve the mean. That is, you assume you CAN actually find the average. If the flow time-scales and turbulent time-scales are similar and you don't average long enough the turbulent contribution will not be zero and you therefore get a mean-flow that is contaminated by turbulence statistics (which is not the true mean flow). This to me in a user-error and not a problem with URANS. If you don't sample long enough to get the correct statistics then you simply get the wrong statistics.<a href="https://www.cfd-online.com/Forums/main/6519-rans-urans.html">link</a></li><li>I think the definition of URANS is contentious for CFD theorists and therefore so is its applicability. In general, URANS isn't really defined very well. I've seen some try to define it in a similar way to LES in terms of how the energy spectrum is captured/modelled. I think this discussion really becomes important (useful) when developing hybrid resolving/modelling method (DES). Moreover, most if not all the commercial codes do not explain the foundation of how their URANS approuch is implimented. I'm sure it's usually just ensuring there's a time derivative in the transport equations. But agree with other posts here, for all intents and purposes, transient RANS ~ URANS. <a href="https://www.reddit.com/r/CFD/comments/k40bit/difference_between_unsteady_rans_urans_and/">link</a></li><li>å¯¹äº <span class="math inline">\(\int_t^{t+\Delta t}\)</span> çš„ <span class="math inline">\(\Delta t\)</span>ï¼Œä»ç†è®ºä¸Š URANS è¿™ä¸ª<span class="math inline">\(\Delta t\)</span>æ˜¯ä»»æ„çš„ï¼Œå¦‚æœä¸è€ƒè™‘é™„åŠ çš„æ¹æµå°é—­æ¨¡å‹å¦‚keä¹‹ç±»ï¼Œ<span class="math inline">\(\Delta t\)</span>è¶³å¤Ÿçš„å°ï¼Œå°±å˜æˆäº†LES (<strong>LES can be applied spatial/temporal/both filtering</strong>)ï¼Œ<span class="math inline">\(\Delta t\)</span>è¶³å¤Ÿçš„å¤§ï¼Œå°±å˜æˆäº†RANSã€‚ç„¶è€Œ<span class="math inline">\(\Delta t\)</span> å¹¶ä¸éœ€è¦æ˜¾æ€§çš„ç»™å®šã€‚æ‰€ä»¥å¯¹URANSå–å†³å®šæ€§çš„è¿˜æ˜¯ <span class="math inline">\(\mu_t\)</span>. <a href="https://cfd-china.com/topic/6517/rans-urans-des-les-vles/13">link</a><ul><li>ç±»ä¼¼çš„ï¼ŒURANSä¸LESä»ä¼ è¾“æ–¹ç¨‹ä¸ŠåŒºåˆ«ä¹Ÿéå¸¸å°‘ï¼ŒåŒºåˆ«ä»…ä»…åœ¨ä¸ <span class="math inline">\(\nu\)</span> çš„æ¨¡åŒ–ï¼Œå¦‚æœæ˜¯LESçš„ <span class="math inline">\(\nu\)</span> ï¼Œé‚£å°±æ˜¯LESï¼Œå¦‚æœæ˜¯URANSçš„ <span class="math inline">\(\nu\)</span> ï¼Œé‚£å°±æ˜¯URANSã€‚æ¹æµç†è®ºä¼šä»åº•å±‚ç‰¹åˆ«æ·±çš„åœ°æ–¹ï¼Œæ¨å¯¼å‡ºæ¥ <span class="math inline">\(\nu\)</span> çš„ä¸åŒï¼Œä½†æ˜¯ä»£ç å°±æ˜¯ä»£ç ï¼Œä¸çŸ¥é“åº•å±‚å•¥æ ·çš„ï¼Œåˆ°äº†ä»£ç è¿™ä¸€å±‚ï¼Œåªä¸è¿‡å°±æ˜¯ <span class="math inline">\(\nu\)</span> çš„å¤§å°ä¸ åŒã€‚</li></ul></li><li><strong>In below figure (right), let's define <span class="math inline">\(T_1 &lt;&lt; T &lt;&lt; T_2\)</span> for URANS.</strong></li><li><strong>Question: What turbulence model does URANS use?</strong> 1) Same as RANS?</li></ul><p><img src="https://i.imgur.com/yMpYzXN.png" width="600" /></p><ul><li><a href="https://mp.weixin.qq.com/s/c1nUiTd3UjO54ERO6RCKUw">link</a>: é›·è¯ºæ—¶å‡æ³•å¯¹éç¨³æ€NSæ–¹ç¨‹åšå¹³å‡ä»¥åï¼Œå¤šå‡ºäº†ååº”æ¹æµè„‰åŠ¨çš„é›·è¯ºåº”åŠ›é¡¹ï¼Œéœ€è¦é€šè¿‡æ¨¡å‹å°é—­ã€‚å¸¸ç”¨çš„å°é—­æ–¹æ³•æ˜¯åŸºäºBoussineqå‡è®¾ï¼ˆåˆå³ï¼Œæ¶¡ç²˜å‡è®¾ï¼‰ï¼Œè¯¥å‡è®¾å°†é›·è¯ºåº”åŠ›ä¸åº”å˜ç‡çš„å…³ç³»è§†ä¸ºæ­£æ¯”ï¼Œå…¶æ¯”ä¾‹ç³»æ•°å³ä¸ºæ¹æµç²˜æ€§ç³»æ•°ï¼ˆåˆå³ï¼Œæ¶¡ç²˜ç³»æ•°ï¼‰ã€‚ä¹‹åï¼Œé€šè¿‡å¯¹æ¹æµç²˜æ€§ç³»æ•°è¿›è¡Œå»ºæ¨¡å¯¹NSæ–¹ç¨‹è¿›è¡Œå°é—­ã€‚æŸä¸€å˜é‡çš„é›·è¯ºå¹³å‡æ“ä½œå¦‚ä¸‹ï¼š <span class="math inline">\(\int_t^{t+\Delta t}\)</span>, <strong>å…¶ä¸­æ—¶é—´é—´éš”æ¯”è¾ƒé‡è¦ï¼Œç‰©ç†ä¸Šè¦æ±‚è¿™ä¸ªæ—¶é—´é—´éš”è¦è¿œå¤§äºæ¹æµçš„éšæœºè„‰åŠ¨å‘¨æœŸï¼Œä½†åˆè¦è¿œå°äºæ—¶å‡é‡çš„å˜åŒ–å‘¨æœŸ</strong> â€”â€” <strong>è¿™æ˜¯ä¸€ä¸ªä»¤äººç›´è§‚ä¸Šæ„Ÿè§‰å¾ˆå¥‡æ€ªçš„è¦æ±‚</strong>ã€‚åœ¨æ—¶å‡å€¼å‡ ä¹ä¸éšæ—¶é—´å˜åŒ–çš„ç¨³æ€æˆ–å‡†ç¨³æ€æ¹æµä¸­ï¼Œæ—¶é—´é—´éš”è¶‹è¿‘äºæ— ç©·å¤§ï¼›ä½†åœ¨æ—¶å‡å€¼éšæ—¶é—´å˜åŒ–çš„éå®šå¸¸æ¹æµä¸­ï¼Œæ—¶é—´é—´éš”çš„å–å€¼éå¸¸é‡è¦ã€‚å¦‚æœæ—¶é—´é—´éš”å–å€¼å¤ªå°ï¼Œåˆ™å¹³å‡é‡æ— æ³•ä»£è¡¨è¯¥æ®µæ—¶é—´å†…ç‰©ç†é‡çš„æ•´ä½“å‡å€¼ï¼›è€Œå¦‚æœæ—¶é—´é—´éš”å–å€¼è¿‡å¤§ï¼Œåˆ™æ±‚è§£ç»“æœæ— æ³•ååº”æµåŠ¨çš„å˜åŒ–ç»†èŠ‚ï¼Œè¿™æ˜¯åˆ¶çº¦URANSè®¡ç®—ç»“æœç²¾åº¦çš„åŸå› ä¹‹ä¸€ã€‚LESé‡‡ç”¨éç¨³æ€NSæ–¹ç¨‹ç›´æ¥å¯¹å¤§æ¶¡è¿›è¡Œæ¨¡æ‹Ÿï¼Œè€Œé‡‡ç”¨äºšæ ¼å­æ¨¡å‹æ¥å¯¹å°æ¶¡è¿›è¡Œå»ºæ¨¡ã€‚äºšæ ¼å­æ¨¡å‹å»ºæ¨¡çš„æ€è·¯å´ä¸RANSä¸­çš„Boussineqå‡è®¾ç›¸ä¼¼ï¼Œå³å°†æ¹æµè„‰åŠ¨æ‰€é€ æˆçš„å½±å“ç”¨æ¹æµç²˜æ€§ç³»æ•°æ¥æè¿°ï¼Œä¹‹åé€šè¿‡æ¨¡å‹å°é—­æ¹æµç²˜æ€§ç³»æ•°è¿›è€Œå°é—­æ•´ä¸ªæ§åˆ¶æ–¹ç¨‹ã€‚<ul><li>æ‰€ä¸åŒçš„æ˜¯ï¼Œ<strong>LESæ–¹æ³•åªæ˜¯å¯¹äºšæ ¼å­å°ºåº¦ä¸Šçš„æ¹æµè„‰åŠ¨è¿›è¡Œå»ºæ¨¡</strong>ï¼Œ</li><li>è€Œ<strong>RANSåˆ™æ˜¯å¯¹æ•´åœºå°ºåº¦çš„æ¹æµè„‰åŠ¨è¿›è¡Œå»ºæ¨¡</strong>ï¼Œ</li><li>è€Œ<strong>è¿™ç§æ•´åœºçš„æ¨¡åŒ–å¿…ç„¶ä¹Ÿä¼šå¯¼è‡´URANSè®¡ç®—ç»“æœç²¾åº¦å­˜åœ¨ä¸€å®šåå·®</strong>ã€‚</li></ul></li><li><a href="https://blog.sciencenet.cn/home.php?mod=space&amp;uid=895670&amp;do=blog&amp;id=686615">link</a> <strong>é›·è¯ºå¹³å‡ï¼Œç»å¸¸è¢«è¯¯è§£ä¸ºæ—¶é—´å¹³å‡ï¼Œå…¶å®åº”è¯¥æ˜¯æ ·æœ¬å¹³å‡</strong>ã€‚åªæ˜¯åœ¨ä¸åŒçš„æ¡ä»¶ä¸‹ï¼Œæ ·æœ¬å¹³å‡å¯ä»¥ç”¨è¿™æ ·é‚£æ ·çš„å¹³å‡æ–¹å¼ä»£æ›¿ã€‚ä»RANSå’ŒURANSçš„å¹³å‡æ–¹å¼ä¸æ±‚è§£ç»“æœçš„éªŒè¯æ–¹æ³•ä¸Šæ¥çœ‹ï¼š<ul><li>1.<strong>è‹¥æµåŠ¨â€œæ—¶é—´ç»Ÿè®¡â€å‡åŒ€ï¼Œä¹Ÿå³Tè¶‹äºæ— ç©·å¤§æ—¶</strong>ï¼Œ<strong>Tä¸Šçš„æ—¶é—´å¹³å‡å­˜åœ¨ï¼Œä¸”æ—¶å‡å€¼ä¸æ—¶é—´æ— å…³</strong>ã€‚<strong>å¯¹åº”çš„æ˜¯RANS</strong>ï¼Œå› æ­¤å¯ä»¥ç”¨å®éªŒæ•°æ®åšæ ·æœ¬å¹³å‡ï¼ˆæˆ–å¾ˆé•¿æ—¶é—´çš„æ—¶é—´å¹³å‡ï¼‰è·ŸRANSç»“æœå¯¹æ¯”ã€‚å¯ä»¥è‚¯å®šçš„æ˜¯ï¼šRANSè®¡ç®—å‡ºçš„ç»“æœæ˜¯æµåœºå˜é‡çš„ç³»ç»Ÿå¹³å‡ã€‚</li><li>2.<strong>è‹¥æµåœºå­˜åœ¨ç¼“å˜å‘¨æœŸT2ï¼ˆimposed unsteadinessï¼‰ï¼Œæ¹æµè„‰åŠ¨å‘¨æœŸä¸ºT1ï¼Œä¸”T1ï¼ŒT2æ»¡è¶³è¿™æ ·çš„æ¡ä»¶ï¼šå­˜åœ¨Tå¯¹äºT2æ¥è¯´æ— ç©·å°ï¼Œå¯¹äºT1æ¥è¯´æ— ç©·å¤§ï¼Œé‚£ä¹ˆå¯ä»¥åœ¨Tä¸Šä½œæ—¶é—´å¹³å‡å¾—åˆ°URANS</strong>ã€‚å¯¹äºå®éªŒæ•°æ®ä¸ä»¿çœŸæ•°æ®çš„å¯¹æ¯”ï¼Œå½“æ¯”è¾ƒå‡å€¼æ—¶ï¼Œå¯ä»¥ç”¨å®éªŒæ•°æ®åœ¨Tä¸Šä½œå¹³å‡è·ŸURANSç»“æœå¯¹æ¯”ï¼›è‹¥è¦å¯¹æ¯”è„‰åŠ¨å€¼ï¼Œåˆ™éœ€è¦æŠŠURANSæ•æ‰åˆ°çš„è„‰åŠ¨ï¼ˆURANSç»“æœå‡å»URANSç»“æœçš„æ—¶é—´å¹³å‡å€¼ï¼ˆè¯¥å€¼åº”è¯¥ä¸æ—¶é—´æ— å…³ï¼‰ï¼‰è·Ÿæ¹æµæ¨¡å‹æ¨¡æ‹Ÿçš„è„‰åŠ¨å€¼åŠ èµ·æ¥è·Ÿå®éªŒè„‰åŠ¨æ•°æ®ï¼ˆå®éªŒå€¼å‡å»å®ƒçš„äºŒæ¬¡æ—¶é—´å¹³å‡ï¼‰å¯¹æ¯”ã€‚</li><li>3.è‹¥ä¸æ»¡è¶³ä¸Šé¢é‚£æ¡ï¼Œä½†æ˜¯æµåŠ¨å±å‘¨æœŸæµåŠ¨çš„ï¼Œåˆ™å¯ä»¥é€šè¿‡<code>ç›¸å¹³å‡</code>å¾—åˆ°URANSï¼Œæ­¤æ—¶å¯ç”¨å®éªŒæ•°æ®åšç›¸å¹³å‡ä¸URANSçš„ç»“æœå¯¹æ¯”ï¼Œä¸”å¯ä»¥é€šè¿‡åˆ¤æ–­URANSç»“æœçš„æ—¶é—´å¹³å‡æ˜¯å¦ä¸æ—¶é—´æ— å…³æ¥ç¡®å®šæ­¤ç§æµåŠ¨æ˜¯å¦åˆé€‚ç”¨URANSã€‚å¯¹äºå®éªŒæ•°æ®ä¸ä»¿çœŸæ•°æ®çš„å¯¹æ¯”ï¼Œå½“æ¯”è¾ƒå‡å€¼æ—¶ï¼Œå¯ä»¥ç”¨å®éªŒæ•°æ®åšç›¸å¹³å‡ä½œè·ŸURANSç»“æœç›´æ¥å¯¹æ¯”ï¼›è‹¥è¦å¯¹æ¯”è„‰åŠ¨å€¼ï¼Œåˆ™éœ€è¦æŠŠURANSæ•æ‰åˆ°çš„è„‰åŠ¨ï¼ˆURANSç»“æœå‡å»URANSç»“æœçš„æ—¶é—´å¹³å‡å€¼ï¼ˆè¯¥å€¼ä¹Ÿåº”è¯¥ä¸æ—¶é—´æ— å…³ï¼‰ï¼‰è·Ÿæ¹æµæ¨¡å‹æ¨¡æ‹Ÿçš„è„‰åŠ¨åŠ èµ·æ¥è·Ÿå®éªŒè„‰åŠ¨æ•°æ®ï¼ˆå®éªŒå€¼å‡å»å…¶ç›¸å¹³å‡å€¼çš„æ—¶å‡å€¼ï¼‰å¯¹æ¯”ã€‚</li></ul></li><li><strong>è‹¥ä¸Šé¢çš„éƒ½ä¸æ»¡è¶³</strong>ï¼ˆå¯ä»¥ç”¨URANSçš„ç»“æœåšæ—¶é—´å¹³å‡åæ˜¯å¦éšæ—¶é—´å˜åŒ–æ¥ç¡®å®šï¼‰ï¼Œå°±åªèƒ½è€è€å®å®çš„ç”¨ç³»ç»Ÿå¹³å‡ï¼Œæˆ–è€…LESæˆ–DNSäº†ã€‚</li></ul><h2 id="question-what-is-phase-averaging">Question: What is phase averaging?</h2><h1 id="large-eddy-simulation-les">Large eddy simulation (LES)</h1><p>Large eddy simulation (LES) is a mathematical model for turbulence used in computational fluid dynamics. It was initially proposed in <strong>1963 by Joseph Smagorinsky</strong> to simulate atmospheric air currents, and <strong>first explored by Deardorff (1970)</strong>.</p><p>An LES filter can be applied to a spatial and temporal field $ (,t) $ and <strong>perform a spatial filtering operation</strong>, <strong>a temporal filtering operation</strong>, or <strong>both</strong>. The filtered field, denoted with a bar, is defined as</p><p><span class="math display">\[\overline{\phi(\boldsymbol{x},t)} = \displaystyle{\int_{-\infty}^{\infty}} \int_{-\infty}^{\infty} \phi(\boldsymbol{r},\tau) G(\boldsymbol{x}-\boldsymbol{r},t - \tau) d\tau d \boldsymbol{r}\]</span></p><p><span class="math display">\[\overline{\phi} = G \star \phi\]</span></p><p><span class="math display">\[\phi = \bar{\phi} + \phi^{\prime}\]</span></p><h2 id="smagorinskylilly-model">Smagorinskyâ€“Lilly model</h2><p>The first SGS model developed was the Smagorinskyâ€“Lilly SGS model, which was developed by <strong>Joseph Smagorinsky</strong> and used in the <strong>first LES simulation by Deardorff</strong>. It models the eddy viscosity as:</p><p><span class="math display">\[\nu_\mathrm{t} = C \Delta^2\sqrt{2\bar{S}_{ij}\bar{S}_{ij}} = C \Delta^2 \left| \bar{S} \right|\]</span></p><p>where <span class="math inline">\(\Delta\)</span> is the <strong>grid size</strong> and <span class="math inline">\(C\)</span> is a constant.</p><p>This method assumes that the energy production and dissipation of the small scales are in equilibrium.</p><h1 id="ex-1d-burgers-equation">Ex: 1D Burgers equation</h1><p>Consider the 1D Burgers equation in terms of the velocity field <span class="math inline">\(u(x, t)\)</span> <span class="math display">\[\begin{equation*}\frac{\partial u}{\partial t}+\frac{\partial u^{2} / 2}{\partial x}=\frac{\partial}{\partial x}\left(v \frac{\partial u}{\partial x}\right) \tag{1}\end{equation*}\]</span></p><h2 id="les">LES</h2><p>In the continuous <strong>LES approach the scale separation is obtained via low-pass filtering</strong>. The spatial filtering operation (no time-filtering is considered here) can be expressed as the convolution product between the unfiltered point-wise velocity field and some suitable filter function <span class="math inline">\(G\)</span>, that is <span class="math display">\[\begin{equation*}\bar{u}(x, t ; \Delta)=\int_{R} G\left(x-x^{\prime} ; \Delta\right) u\left(x^{\prime}, t\right) d x^{\prime} \tag{2}\end{equation*}\]</span> <span class="math inline">\(\Delta\)</span> being the characteristic filter width. The LES equation is obtained by applying (2) to each term of (1) <span class="math display">\[\begin{equation*}\frac{\partial \bar{u}}{\partial t}+\frac{\partial \bar{u}^{2} / 2}{\partial x}=\frac{\partial}{\partial x}\left(v \frac{\partial \bar{u}}{\partial x}\right)+\underbrace{\frac{\partial\left(\bar{u}^{2}-u^{2}\right) / 2}{\partial x}}_{\frac{\partial f(\bar{u}, u)}{\partial x}} \tag{3}\end{equation*}\]</span></p><p>Commutation between filtering and derivative being applied</p><h2 id="urans">URANS</h2><p>As a counterpart, in the continuous <strong>URANS approach a statistical averaging</strong> is adopted. <span class="math display">\[\begin{equation*}\langle u\rangle(x, t)=\lim _{N \rightarrow \infty} \frac{1}{N} \sum_{k=1}^{N} u_{k}(x, t) \tag{4}\end{equation*}\]</span></p><p><span class="math inline">\(N\)</span> being the <strong>number of sample of the ensemble averaging</strong>. The URANS equation is obtained by applying (4) to each term of (1)</p><p><span class="math display">\[\begin{equation*}\frac{\partial\langle u\rangle}{\partial t}+\frac{\partial\langle u\rangle^{2} / 2}{\partial x}=\frac{\partial}{\partial x}\left(v \frac{\partial\langle u\rangle}{\partial x}\right)+\underbrace{\frac{\partial\left(\langle u\rangle^{2}-u^{2}\right) / 2}{\partial x}}_{\frac{\partial g(\langle u\rangle, u)}{\partial x}} \tag{5}\end{equation*}\]</span></p><h2 id="close-equations">Close equations</h2><p>In order to close Eqs.(3) and (5), suitable models are used, that is</p><p><span class="math display">\[f(\bar{u}, u) \cong f_{\text {LES }}(\bar{u}), \qquad g(\langle u\rangle, u) \cong g_{\text {URANS }}(\langle u\rangle)\]</span></p><h2 id="discretization">Discretization</h2><p>If we consider now the practical solution, a discretization of the derivative is introduced. Assume the same discretization is adopted for the LES and URANS equations, so that we can write a unique equation <span class="math display">\[\frac{\delta u_{j}}{\delta t}+\frac{\delta u_{j}^{2} / 2}{\delta x}=\frac{\delta}{\delta x}\left(v \frac{\delta u_{j}}{\delta x}\right)+\frac{\delta}{\delta x}\left\{\begin{array}{c}f_{L E S}\left(u_{j}\right)  \tag{6}\\g_{\text {URANS }}\left(u_{j}\right)\end{array}\right.\]</span> that characterizes LES or URANS depending on the closure model.</p><div class="note note-primary">            <p>One can deduce that the discrete equation (6) never implied a real application of a spatial filtering or an ensemble averaging. <strong>The only assessment is the spatial filtering implicitly induced by the discretization, a fact that is congruent to the LES assumption but not to the URANS one</strong>.</p>          </div><p>The Eq.(6) must be well posed by the set of initial and boundary conditions. This point adds a distinction as they should be different for LES and URANS.</p><h1 id="references">References</h1><ol type="1"><li><a href="http://www.dicat.unige.it/guerrero/teaching.html">Joel Guerrero's homepage</a><ol type="1"><li><a href="http://www.dicat.unige.it/guerrero/turbulence2020/slides/2tur_preliminaries.pdf">2tur_preliminaries (<strong>recommend</strong>)</a></li><li><a href="http://www.dicat.unige.it/guerrero/turbulence2020/slides/3turbulence_Scales_law_of_the_wall_wall_function.pdf">3turbulence_Scales_law_of_the_wall_wall_function (<strong>recommend</strong>)</a></li><li><a href="http://www.dicat.unige.it/guerrero/turbulence2020/slides/5governing_equations.pdf">5governing_equations (<strong>recommend</strong>)</a></li></ol></li><li><a href="https://www.wolfdynamics.com/training/turbulence/OF2021/turbulence_2021_OF8.pdf">turbulence_2021_OF8 (<strong>recommend</strong>)</a></li><li><a href="https://www.researchgate.net/profile/Filippo-Maria-Denaro/post/URANS-what-is-the-meaning-for-statistically-steady-flows-and-what-compared-to-LES/attachment/5b407d1e4cde265cb64d663d/AS%3A645677793165312%401530952990388/download/URANS+vs.+LES.pdf">URANS vs. LES</a></li><li><a href="https://marinecfd.xyz/post/rans-turbulence-modeling/">é›·è¯ºå¹³å‡ Navier-Stokes æ–¹ç¨‹</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>CFD</category>
      
    </categories>
    
    
    <tags>
      
      <tag>HPC</tag>
      
      <tag>OpenFOAM</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ML | Diffusion Models</title>
    <link href="/2024/12/15/ML-Diffusion-Models/"/>
    <url>/2024/12/15/ML-Diffusion-Models/</url>
    
    <content type="html"><![CDATA[<h1 id="diffusion-models">Diffusion Models</h1><h1 id="references">References</h1><ol type="1"><li><a href="https://www.assemblyai.com/blog/diffusion-models-for-machine-learning-introduction/">Introduction to Diffusion Models for Machine Learning</a></li><li><a href="https://www.youtube.com/playlist?list=PLJV_el3uVTsNi7PgekEUFsyVllAJXRsP-">æå®æ¯… Hung-yi Lee is very famous on teaching machine learning course in taiwan</a></li><li><a href="https://blog.cnbang.net/tech/3823/">ç†è§£ Stable Diffusion UNet ç½‘ç»œ</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>ML</category>
      
    </categories>
    
    
    <tags>
      
      <tag>AI</tag>
      
      <tag>ML</tag>
      
      <tag>pytorch</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ML | U-Net</title>
    <link href="/2024/12/13/ML-Unet/"/>
    <url>/2024/12/13/ML-Unet/</url>
    
    <content type="html"><![CDATA[<h1 id="u-net">U-Net</h1><p>The <code>U-Net</code> architecture follows an <strong>encoder-decoder cascade structure</strong>, where the encoder gradually compresses information into a <strong>lower-dimensional representation</strong>. Then the decoder decodes this information back to the original image dimension. Owing to this, the architecture gets an overall U-shape, which leads to the name U-Net.</p><p><strong>U-Net is a convolutional neural network that was developed for image segmentation</strong>. The network is based on a <a href="https://openaccess.thecvf.com/content_cvpr_2015/papers/Long_Fully_Convolutional_Networks_2015_CVPR_paper.pdf">fully convolutional neural network</a> whose architecture was modified and extended to work with fewer training images and to yield more precise segmentation.</p><p><img src="https://i.imgur.com/eKOoRN9.png" width="600" /></p><p>U-Net is a prominent deep learning architecture primarily used for <strong>semantic segmentation</strong> in computer vision tasks, particularly in the biomedical field. Developed by <a href="https://www.academia.edu/download/80140288/1505.pdf">Olaf Ronneberger and colleagues in 2015</a>, U-Net was designed to perform well even with limited training data, making it particularly useful in medical imaging where annotated datasets are scarce.</p><figure><img src="https://i.imgur.com/l2LtVgl.png" alt="Fig. 1. U-net architecture (example for 32x32 pixels in the lowest resolution). Each blue box corresponds to a multi-channel feature map. The number of channels is denoted on top of the box. The x-y-size is provided at the lower left edge of the box. White boxes represent copied feature maps. The arrows denote the different operations. ( Source: Ronneberger, O., Fischer, P., &amp; Brox, T. (2015). U-net: Convolutional networks for biomedical image segmentation." width="600" /><figcaption>Fig. 1. U-net architecture (example for 32x32 pixels in the lowest resolution). Each blue box corresponds to a multi-channel feature map. The number of channels is denoted on top of the box. The x-y-size is provided at the lower left edge of the box. White boxes represent copied feature maps. The arrows denote the different operations. ( Source: Ronneberger, O., Fischer, P., &amp; Brox, T. (2015). U-net: Convolutional networks for biomedical image segmentation.</figcaption></figure><h2 id="architecture-overview">Architecture Overview</h2><p>U-Net features a distinctive <strong>U-shaped architecture</strong> that consists of two main paths: the <strong>contracting path</strong> (encoder) and the <strong>expansive path</strong> (decoder).</p><ul><li><p><strong>Contracting Path (Encoder)</strong>: This part of the network captures context from the input image. It consists of several convolutional layers followed by max pooling operations, which progressively reduce the spatial dimensions while increasing the depth of feature maps. The encoder extracts high-level features from the input image, similar to other convolutional networks.</p></li><li><p><strong>Expansive Path (Decoder)</strong>: The decoder's role is to upsample the feature maps obtained from the encoder back to the original image size. This is achieved through <strong>transposed convolutions</strong> (<strong>deconvolutions</strong>) and concatenation with corresponding feature maps from the encoder via <strong>skip connections</strong>. These skip connections help preserve spatial information that might be lost during downsampling, allowing for more precise localization of features in the output segmentation map.</p></li></ul><h3 id="key-features">Key Features</h3><ul><li><strong>Skip Connections</strong>: These connections between corresponding layers in the encoder and decoder allow the model to retain spatial information, which is crucial for accurate segmentation.</li><li><strong>Fully Convolutional Network</strong>: U-Net is a fully convolutional network, meaning it does not rely on fully connected layers, making it more efficient for image processing tasks.</li><li><strong>Effective with Limited Data</strong>: U-Net's design enables it to perform well even when trained on small datasets, which is a significant advantage in fields like medical imaging where data acquisition can be challenging.</li></ul><h2 id="applications">Applications</h2><p>U-Net has been widely adopted for various applications beyond biomedical image segmentation, including:</p><ul><li><strong>Medical Imaging</strong>: Segmenting organs or tumors in MRI and CT scans.</li><li><strong>Satellite Image Analysis</strong>: Identifying land use or changes in land cover.</li><li><strong>Autonomous Vehicles</strong>: Assisting in scene understanding by segmenting objects within images.</li></ul><p>In summary, U-Net's innovative architecture and effective use of skip connections have made it a foundational model in semantic segmentation tasks across various domains, particularly where data scarcity poses challenges.</p><h1 id="u-net-æ¨¡å‹">U-Net æ¨¡å‹</h1><p>U-Net æ¨¡å‹å¯ä»¥åˆ†ç‚ºä¸‰å€‹ä¸»è¦éƒ¨åˆ†ï¼š</p><ul><li><code>ç·¨ç¢¼å™¨ï¼ˆEncoderï¼‰</code>ï¼šç·¨ç¢¼å™¨è² è²¬é€šéå·ç©å’Œæœ€å¤§æ± åŒ–ç­‰æ“ä½œå°è¼¸å…¥å½±åƒé€²è¡Œé™ç¶­è™•ç†ï¼ˆDownsamplingï¼‰ï¼Œä»¥æå–å½±åƒä¸­çš„é‡è¦ç‰¹å¾µã€‚æˆ‘å€‘å¯ä»¥æŠŠé€™ä¸€éç¨‹æƒ³åƒæˆåœ¨å½±åƒä¸Šç§»å‹•ä¸€å€‹å°è¦–çª—ï¼Œç„¶å¾Œè¨˜éŒ„ä¸‹è¦–çª—ä¸­çš„ç‰¹å¾µ</li><li><code>è§£ç¢¼å™¨ï¼ˆDecoderï¼‰</code>ï¼šè§£ç¢¼å™¨å‰‡é€šéåå·ç©åšä¸Šæ¡æ¨£ï¼ˆUpsampleï¼‰ä¾†æŠŠç‰¹å¾µè³‡è¨Šé‡æ–°çµ„åˆæˆä¸€å¼µèˆ‡åŸå§‹å½±åƒå¤§å°ç›¸åŒçš„æ–°å½±åƒï¼Œå…¶ä¸­ï¼Œåå·ç©æœƒé€æ­¥é‚„åŸåŸå§‹è¼¸å…¥å½±åƒä¸­çš„é«˜é »è³‡è¨Šï¼ˆå½±åƒç´°ç¯€ï¼‰å’Œä½é »è³‡è¨Šï¼ˆå½±åƒè¼ªå»“ï¼‰ï¼Œæœ€å¾Œç”Ÿæˆçš„å½±åƒå°±æœƒæ˜¯åƒç´ ç´šçš„åˆ†å‰²çµæœ</li><li><code>è·³èºé€£æ¥ï¼ˆSkip Connectionï¼‰</code>ï¼šè·³èºé€£æ¥æ˜¯åœ¨ç·¨ç¢¼å™¨å’Œè§£ç¢¼å™¨ä¹‹é–“çš„é€£æ¥ï¼Œå®ƒæœ‰åŠ©æ–¼ä¿ç•™åœ¨ç·¨ç¢¼å™¨éšæ®µå¯èƒ½éºå¤±çš„è³‡è¨Šï¼Œé€šéæ‹¼æ¥ï¼Œä½¿å¾—è§£ç¢¼å™¨åœ¨ä¸Šæ¡æ¨£çš„æ™‚å€™ï¼Œèƒ½å¤ ä¿ç•™æ›´å¤šåœ¨ç·¨ç¢¼å™¨æ™‚çš„ç‰¹å¾µåœ–ä¸­çš„é«˜åˆ†è¾¨ç‡ç´°ç¯€è³‡è¨Šï¼Œæé«˜åˆ†å‰²çš„ç²¾ç¢ºåº¦ã€‚é€™å°æ–¼èªç¾©åˆ†å‰²ä»»å‹™éå¸¸é‡è¦ï¼Œå› ç‚ºç·¨ç¢¼å™¨çš„å·ç©æœƒä¿ç•™é‡è¦çš„ç´°ç¯€è³‡è¨Š</li></ul><h2 id="u-net-convolutional-networks-for-biomedical-image-segmentation">U-net: Convolutional networks for biomedical image segmentation</h2><ul><li><a href="https://link.springer.com/chapter/10.1007/978-3-319-24574-4_28">Ronneberger, O., Fischer, P., &amp; Brox, T. (2015). U-net: Convolutional networks for biomedical image segmentation. In Medical image computing and computer-assisted interventionâ€“MICCAI 2015: 18th international conference, Munich, Germany, October 5-9, 2015, proceedings, part III 18 (pp. 234-241). Springer International Publishing.</a></li></ul><p>The network architecture is illustrated in Figure 1.</p><ul><li>It consists of a <strong>contracting path</strong> (left side) and an <strong>expansive path</strong> (right side).</li><li>The contracting path follows the typical architecture of a <strong>convolutional network</strong>.</li><li>It consists of the repeated<ul><li>application of two <strong>3x3 convolutions</strong> (unpadded convolutions), each followed by a rectified linear unit (<strong>ReLU</strong>) and a <strong>2x2 max pooling</strong> operation with stride 2 for downsampling.</li><li>At each downsampling step we <strong>double the number of feature channels</strong>.</li><li>Every step in the expansive path consists of an upsampling of the feature map followed by a<ul><li><strong>2x2 convolution ("up-convolution") that halves the number of feature channels</strong>,</li><li>a <strong>concatenation</strong> with the <code>correspondingly cropped</code> <strong>feature map</strong> from the contracting path,</li></ul></li><li>and two <strong>3x3 convolutions</strong>, each followed by a ReLU.</li><li>The cropping is necessary due to the loss of border pixels in every convolution.</li><li>At the final layer a 1x1 convolution is used to map each 64-component feature vector to the desired number of classes. In total the network has 23 convolutional layers.</li></ul></li></ul><p>To allow a seamless tiling of the output segmentation map (see Figure 2), it is important to select the input tile size such that all 2x2 max-pooling operations are applied to a layer with an even x- and y-size.</p><h1 id="ä¸€æ–‡ææ‡‚-deconvolutiontransposed-convolutionsub-pixel-or-fractional-convolution"><a href="https://www.cnblogs.com/shine-lee/p/11559825.html">ä¸€æ–‡ææ‡‚ deconvolutionã€transposed convolutionã€sub-pixel or fractional convolution</a></h1><ol type="1"><li><code>deconvolution</code>ï¼Œå®é™…ä¸Šä¸ <code>transposed convolution</code> ã€<code>sub-pixel</code> or <code>fractional convolution</code> æŒ‡ä»£ç›¸åŒã€‚<strong>transposed convolution</strong> æ˜¯ä¸€ä¸ªæ›´å¥½çš„åå­—ï¼Œsub-pixel or fractional convolutionå¯ä»¥çœ‹æˆæ˜¯transposed convolutionçš„ä¸€ä¸ªç‰¹ä¾‹ã€‚å¯¹ä¸€ä¸ªå¸¸è§„çš„å·ç§¯å±‚è€Œè¨€ï¼Œå‰å‘ä¼ æ’­æ—¶æ˜¯convolutionï¼Œå°†input feature mapæ˜ å°„ä¸ºoutput feature mapï¼Œåå‘ä¼ æ’­æ—¶åˆ™æ˜¯transposed convolutionï¼Œæ ¹æ®output feature mapçš„æ¢¯åº¦è®¡ç®—å‡ºinput feature mapçš„æ¢¯åº¦ï¼Œæ¢¯åº¦å›¾çš„å°ºå¯¸ä¸feature mapçš„å°ºå¯¸ç›¸åŒ</li><li><strong>convolution</strong> è¿‡ç¨‹æ˜¯å°† 4Ã—4 çš„mapæ˜ å°„ä¸º 2Ã—2 çš„mapï¼Œè€Œ <strong>transposed convolution</strong> è¿‡ç¨‹åˆ™æ˜¯å°† 2Ã—2 çš„mapæ˜ å°„ä¸º 4Ã—4 çš„mapï¼Œä¸¤è€…çš„kernel sizeå‡ä¸º3</li><li>å¯¹äºä¸€èˆ¬æƒ…å†µï¼Œåªéœ€æŠŠæ¡ä¸€ä¸ªå®—æ—¨ï¼štransposed convolution å°† output size æ¢å¤ä¸º input size ä¸”ä¿æŒè¿æ¥æ–¹å¼ç›¸åŒ</li></ol><figure><img src="https://s2.ax1x.com/2019/09/18/n75lfs.gif" alt="convolution vs transposed convolution" width="600" /><figcaption>convolution vs transposed convolution</figcaption></figure><h1 id="åæ²ç©deconvolutionä¸Šæ¡æ¨£unsamplingèˆ‡ä¸Šæ± åŒ–unpoolingå·®ç•°"><a href="https://medium.com/ai%E5%8F%8D%E6%96%97%E5%9F%8E/%E5%8F%8D%E6%8D%B2%E7%A9%8D-deconvolution-%E4%B8%8A%E6%8E%A1%E6%A8%A3-unsampling-%E8%88%87%E4%B8%8A%E6%B1%A0%E5%8C%96-unpooling-%E5%B7%AE%E7%95%B0-feee4db49a00">åæ²ç©(Deconvolution)ã€ä¸Šæ¡æ¨£(UNSampling)èˆ‡ä¸Šæ± åŒ–(UnPooling)å·®ç•°</a></h1><ol type="1"><li>é€†å·ç©(Deconvolution)æ¯”è¼ƒå®¹æ˜“å¼•èµ·èª¤æœƒï¼Œè½‰ç½®å·ç©(Transposed Convolution)æ˜¯ä¸€å€‹æ›´ç‚ºåˆé©çš„å«æ³•</li></ol><p><img src="https://miro.medium.com/v2/resize:fit:828/format:webp/0*eTUfEWr8wwLbGt-y" width="400" /></p><h1 id="copy-and-crop-æ“ä½œ">Copy and crop æ“ä½œ</h1><ul><li><a href="https://github.com/Rwzzz/Unet" class="uri">https://github.com/Rwzzz/Unet</a></li></ul><ol type="1"><li>è®ºæ–‡ä¸­åªç”¨åˆ†å‰²å‡ºç»†èƒè¾¹ç•Œï¼Œæ‰€ä»¥æœ€åä½¿ç”¨çš„æ˜¯2ä¸ª1<em>1å·ç§¯å¾—åˆ°èƒŒæ™¯å’Œç›®æ ‡ä¸¤ä¸ªã€‚å¦‚æœæ˜¯å¤šç›®æ ‡åˆ†å‰²ï¼Œæ ¹æ®åˆ†å‰²ç›®æ ‡çš„ç§ç±»æ¥å†³å®šä½¿ç”¨1</em>1çš„å·ç§¯çš„æ•°é‡æ¥è¾“å‡ºSegmentation map.æ³¨ï¼šå¯¹äºå¤šç›®æ ‡çš„Labelæ ‡æ³¨ï¼šå¯ä»¥ä½¿ç”¨ä¸åŒé¢œè‰²ï¼Œç„¶åä½¿ç”¨One-hotç¼–ç ç”ŸæˆLabelè¿›è¡Œè®­ç»ƒ</li><li>Copy and cropæ“ä½œï¼š ç»è¿‡ä¸¤æ¬¡3<em>3å·ç§¯åï¼Œå¤§å°å˜ä¸º28Ã—28ï¼Œç„¶åç»è¿‡ä¸€æ¬¡2</em>2å·ç§¯ï¼Œå˜ä¸º56Ã—56ï¼Œè¿™æ—¶å’Œå·¦ä¾§å¤§å°ä¸º64Ã—64çš„å›¾åƒè¿›è¡Œç»´åº¦çš„å åŠ ï¼Œä½†æ˜¯ç”±äºå›¾åƒå¤§å°ä¸åŒï¼Œéœ€è¦å°†å·¦ä¾§çš„64Ã—64å¤§å°çš„å›¾åƒè£å‰ªä¸º56Ã—56å¤§å°,æ­¤å¤„çš„è£å‰ªæ˜¯åˆç†çš„ï¼ŒåŸå› çœ‹ä¸‹ä¸€æ­¥3ä¸­è®²çš„Overlap-tileç­–ç•¥ã€‚</li><li>å¯ä»¥å‘ç°Unetè®ºæ–‡ä¸­è¾“å…¥çš„å›¾åƒæ˜¯572Ã—572ä½†æ˜¯è¾“å‡ºå›¾åƒç¡®å®388Ã—388.è¿™æ˜¯ä¸æ˜¯å°±æ„å‘³ç€åŸå›¾åƒå­˜åœ¨ä¿¡æ¯ä¸¢å¤±çš„ç°è±¡å‘¢ï¼Ÿå®é™…ä¸Šä¸æ˜¯çš„ï¼Œç»è¿‡äº†no paddingçš„å·ç§¯æ“ä½œï¼Œè¾“å…¥å›¾åƒå’Œè¾“å‡ºå›¾åƒè‚¯å®šæ˜¯ä¸ä¸€æ ·çš„å°ºå¯¸ï¼Œä½†æ˜¯Unetåœ¨è®ºæ–‡ä¸­æåŠäº†ä¸€ç§ç­–ç•¥--Overlap-tileï¼Œå°†å›¾åƒè¿›è¡Œé•œåƒæ‰©å……å’Œè¾“å…¥ç½‘ç»œï¼Œè¿™æ ·ç»è¿‡å·ç§¯åå¾—åˆ°çš„è¾“å‡ºå›¾åƒå’Œå®é™…éœ€è¦æå–çš„å›¾åƒæ˜¯ç›¸åŒçš„å°ºå¯¸ã€‚ â€‚â€‚â€‚ä¾‹å¦‚ä¸‹å›¾ï¼Œå®é™…éœ€è¦åˆ†å‰²çš„å›¾åƒæ˜¯é»„è‰²æ¡†æ‰€é€‰ä¸­éƒ¨åˆ†ï¼Œä½†æ˜¯è¾“å…¥åˆ°ç½‘ç»œä¸­çš„å›¾åƒæ˜¯è“è‰²éƒ¨åˆ†ï¼Œå¯¹ç©ºç™½éƒ¨åˆ†è¿›è¡Œé•œåƒå¡«å……ï¼Œè¿™æ ·ç»è¿‡ç½‘ç»œåæ‰€å¾—åˆ°çš„çš„è¾“å‡ºå¤§å°å°ºå¯¸é€‚åˆå®é™…éœ€è¦åˆ†å‰²çš„å›¾åƒå¤§å°æ˜¯ä¸€æ ·çš„ã€‚</li><li>Unetæ¨¡å‹ç®€å•ï¼Œå¹¶ä¸”ä½¿ç”¨è¾ƒå°‘çš„æ•°æ®é›†ï¼Œå¯ä»¥è¾¾åˆ°éå¸¸ç†æƒ³çš„åˆ†å‰²æ•ˆæœï¼Œå¯¹äºåŒ»å­¦å’Œå…¶ä»–ä¸€äº›æ•°æ®é›†æ¯”è¾ƒå°‘çš„é¢†åŸŸä¼˜åŠ¿å¾ˆå¤§ã€‚</li></ol><h1 id="youtube">Youtube</h1><ul><li>U-Net Architecture</li></ul><iframe width="628" height="353" src="https://www.youtube.com/embed/oQxrjl3INEY" title="U-Net Architecture" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe><ul><li>Deep learning: U-Net architecture | Qingjie Meng</li></ul><iframe width="628" height="353" src="https://www.youtube.com/embed/NDfhW9YTvek" title="U-Net architecture" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe><h1 id="hands-on-å‹•æ‰‹å¯¦è¸"><strong>Hands-on (å‹•æ‰‹å¯¦è¸)</strong></h1><p>todo</p><h1 id="references">References</h1><ol type="1"><li><a href="https://openaccess.thecvf.com/content_cvpr_2015/papers/Long_Fully_Convolutional_Networks_2015_CVPR_paper.pdf">Long, J., Shelhamer, E., &amp; Darrell, T. (2015). <strong>Fully convolutional networks for semantic segmentation</strong>. In Proceedings of the IEEE conference on computer vision and pattern recognition (pp. 3431-3440).</a></li><li><a href="https://www.academia.edu/download/80140288/1505.pdf">Ronneberger, O., Fischer, P., &amp; Brox, T. (2015). <strong>U-net: Convolutional networks for biomedical image segmentation</strong>. In Medical image computing and computer-assisted interventionâ€“MICCAI 2015: 18th international conference, Munich, Germany, October 5-9, 2015, proceedings, part III 18 (pp. 234-241). Springer International Publishing.</a></li><li><a href="https://martin12345m.medium.com/3d-unet-%E5%B0%8F%E7%B0%A1%E4%BB%8B-%E6%9E%B6%E6%A7%8B-1-%E5%BE%9E2d%E9%96%8B%E5%A7%8B-669cacd2f813">3D Unet å°ç°¡ä»‹ï¼šæ¶æ§‹(1) â€” å¾2Dé–‹å§‹</a></li><li><a href="https://pyimagesearch.com/2021/11/08/u-net-training-image-segmentation-models-in-pytorch/">U-Net: Training Image Segmentation Models in PyTorch</a></li><li><a href="https://acrocanthosaurus627.medium.com/%E7%B6%93%E5%85%B8%E7%B6%B2%E8%B7%AF%E7%B3%BB%E5%88%97-%E5%8D%81-unet-545efa00ad99">Pytorchå¯¦ä½œç³»åˆ— â€” UNet</a><ol type="1"><li>å°æ–¼åŸæœ¬çš„è«–æ–‡ï¼Œæœ‰å¹¾é»ç–‘æƒ‘<ol type="1"><li>ä½œè€…ä½¿ç”¨æ²’æœ‰ padding çš„å·ç©æ“ä½œï¼Œä¸çŸ¥é“æ˜¯æ€éº¼å°‡outputèˆ‡labelå°é½Šã€‚</li><li>ä½œè€…æåˆ°çµåˆä¸‹æ¡æ¨£æ™‚è¦é€²è¡Œcopy and cropï¼Œä½†æ²’æcropçš„å…§å®¹ã€‚</li><li>å¾ˆå¤šæŠ€å·§çš„ç´°ç¯€æ²’è¬›ã€‚</li></ol></li></ol></li></ol>]]></content>
    
    
    <categories>
      
      <category>ML</category>
      
    </categories>
    
    
    <tags>
      
      <tag>AI</tag>
      
      <tag>ML</tag>
      
      <tag>pytorch</tag>
      
      <tag>U-Net</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ML | NWP | GNN Graph Neural Network Model</title>
    <link href="/2024/12/12/NWP-ML-GNN/"/>
    <url>/2024/12/12/NWP-ML-GNN/</url>
    
    <content type="html"><![CDATA[<h1 id="overview-of-graph-neural-networks-gnns">Overview of Graph Neural Networks (GNNs)</h1><p>Graph Neural Networks (GNNs) are a specialized type of neural network designed to process and analyze graph-structured data. Unlike traditional neural networks that operate on structured data (like images or text), GNNs can directly handle the complex relationships represented in graphs, making them particularly useful for tasks where data is interconnected.</p><h2 id="what-is-a-graph">What is a Graph?</h2><p>A graph is a mathematical structure consisting of <strong>nodes</strong> (or vertices) and <strong>edges</strong> (connections between nodes). Formally, a graph $ G $ can be defined as $ G = (V, E) $, where $ V $ is the set of nodes and $ E $ is the set of edges. Graphs can represent various types of data, such as social networks, molecular structures, and transportation systems.</p><h2 id="how-gnns-work">How GNNs Work</h2><p>GNNs utilize a process called <strong>message passing</strong>, where information is exchanged between neighboring nodes. Each node updates its state by aggregating information from its neighbors, allowing the network to learn representations that capture the structure and features of the graph. The final output for each node is known as its <strong>embedding</strong>, which encapsulates the node's information in relation to its neighbors. (Message passing layers are permutation-equivariant layers mapping a graph into an updated representation of the same graph.)</p><h2 id="types-of-gnns">Types of GNNs</h2><p>There are several variations of GNNs, each suited for different applications:</p><ul><li><strong>Graph Convolutional Networks (GCNs)</strong>: These networks extend convolutional neural networks (CNNs) to graph data by learning features from neighboring nodes through convolution-like operations.</li><li><strong>Recurrent Graph Neural Networks (RGNNs)</strong>: RGNNs are designed for handling temporal or sequential data on graphs, leveraging recurrent mechanisms to model dependencies over time.</li><li><strong>Gated Graph Neural Networks (GGNNs)</strong>: These networks introduce gating mechanisms to better manage long-range dependencies within graph structures.</li><li><strong>Graph Autoencoders</strong>: Used primarily for unsupervised learning tasks such as link prediction, these models encode graph data into lower-dimensional representations and then attempt to reconstruct the original graph.</li></ul><h2 id="applications-of-gnns">Applications of GNNs</h2><p>GNNs are versatile and can be applied in various domains:</p><ul><li><strong>Node Classification</strong>: Predicting labels for nodes in a graph, often used in social networks or citation networks.</li><li><strong>Link Prediction</strong>: Estimating the likelihood of connections between nodes, useful in recommendation systems.</li><li><strong>Graph Classification</strong>: Classifying entire graphs based on their structure and node features, applicable in molecular chemistry and bioinformatics.</li></ul><p><img src="https://i.imgur.com/9cs4ilH.png" width="600" /></p><h2 id="conclusion">Conclusion</h2><p>Graph Neural Networks represent a significant advancement in machine learning by enabling the analysis of complex relational data. Their ability to learn from the structure and features of graphs opens up new possibilities across numerous fields, from social sciences to biology and beyond. As research continues to evolve, GNNs are likely to become increasingly integral to understanding and leveraging interconnected data.</p><h1 id="a-gentle-introduction-to-graph-neural-networks-recommend"><a href="https://distill.pub/2021/gnn-intro/">A Gentle Introduction to Graph Neural Networks (<strong>Recommend</strong>)</a></h1><div class="note note-danger">            <p>A GNN is an optimizable transformation on all attributes of the graph (nodes, edges, global-context) that preserves graph symmetries (permutation invariances).</p>          </div><p>Weâ€™re going to build GNNs using the â€œmessage passing neural networkâ€ framework proposed by <a href="https://proceedings.mlr.press/v70/gilmer17a/gilmer17a.pdf">Gilmer et al.</a> using the Graph Nets architecture schematics introduced by <a href="https://www.researchgate.net/profile/Andrea-Tacchetti/publication/325557043_Relational_inductive_biases_deep_learning_and_graph_networks/links/5cd0ad38299bf14d957cca5c/Relational-inductive-biases-deep-learning-and-graph-networks.pdf">Battaglia et al.</a></p><p>GNNs adopt a <strong>â€œgraph-in, graph-outâ€ architecture</strong> meaning that these model types accept a graph as input, with information loaded into its nodes, edges and global-context, and progressively transform these embeddings, without changing the connectivity of the input graph.</p><ul><li>What types of problems have graph structured data?<ul><li>We have described some examples of graphs in the wild, but what tasks do we want to perform on this data? There are three general types of prediction tasks on graphs: <strong>graph-level, node-level, and edge-level</strong>.<ul><li>In a <code>graph-level task</code>, we predict a single property for a whole graph.</li><li>For a <code>node-level task</code>, we predict some property for each node in a graph.</li><li>For an <code>edge-level task</code>, we want to predict the property or presence of edges in a graph.</li></ul></li><li>For the three levels of prediction problems described above (graph-level, node-level, and edge-level), we will show that all of the following problems can be solved with a single model class, the GNN. But first, letâ€™s take a tour through the three classes of graph prediction problems in more detail, and provide concrete examples of each.</li></ul></li></ul><p><img src="https://i.imgur.com/lTzKFu6.png" width="600" /> <img src="https://i.imgur.com/QzUIet1.png" width="600" /></p><p>However, it is not always so simple. For instance, you might have information in the graph stored in edges, but no information in nodes, but still need to make predictions on nodes. We need a way to collect information from edges and give them to nodes for prediction. We can do this by pooling. <code>Pooling proceeds</code> in two steps:</p><ol type="1"><li>For each item to be pooled, gather each of their embeddings and concatenate them into a matrix.</li><li>The gathered embeddings are then aggregated, usually via a sum operation.</li></ol><p>We represent the <strong>pooling operation</strong> by the letter <span class="math inline">\(\rho\)</span>, and denote that we are gathering information from edges to nodes as <span class="math inline">\(p_{E_n \to V_{n}}\)</span>.</p><p><img src="https://i.imgur.com/IuZEdeO.png" width="600" /></p><p><img src="https://i.imgur.com/SU2M541.png" width="600" /></p><h2 id="other-types-of-graphs-multigraphs-hypergraphs-hypernodes-hierarchical-graphs">Other types of graphs (multigraphs, hypergraphs, hypernodes, hierarchical graphs)</h2><p>We can also consider nested graphs, where for example a node represents a graph, also called a <a href="https://dl.acm.org/doi/pdf/10.1145/174608.174610">hypernode graph</a>. Nested graphs are useful for <strong>representing hierarchical information</strong>. For example, we can consider a network of molecules, where a node represents a molecule and an edge is shared between two molecules if we have a way (reaction) of transforming one to the other <a href="https://academic.oup.com/bioinformatics/article-pdf/34/13/i457/50316205/bioinformatics_34_13_i457.pdf">(1)</a>, <a href="https://www.nature.com/articles/s41467-020-19267-x.pdf">(2)</a>. In this case, we can learn on a nested graph by having a GNN that learns representations at the molecule level and another at the reaction network level, and alternate between them during training.</p><p><img src="https://i.imgur.com/36EVPAi.png" width="600" /></p><h1 id="regional-data-driven-weather-modeling-with-a-global-stretched-grid">Regional data-driven weather modeling with a global stretched-grid</h1><ul><li><a href="https://arxiv.org/pdf/2409.02891">Nipen, Thomas Nils, et al. "Regional data-driven weather modeling with a global stretched-grid." arXiv preprint arXiv:2409.02891 (2024).</a></li></ul><p><img src="https://i.imgur.com/4C4jXs3.png" width="600" /> <img src="https://i.imgur.com/KIhFwXW.png" width="600" /> <img src="https://i.imgur.com/cG9STZy.png" width="600" /></p><h1 id="references">References</h1><ol type="1"><li><a href="https://distill.pub/2021/gnn-intro/">A Gentle Introduction to Graph Neural Networks (<strong>Recommend</strong>)</a></li><li><a href="https://www.datacamp.com/tutorial/comprehensive-introduction-graph-neural-networks-gnns-tutorial">A Comprehensive Introduction to Graph Neural Networks (GNNs)</a></li><li><a href="https://www.kaggle.com/code/iogbonna/introduction-to-graph-neural-network-with-pytorch">Introduction to Graph Neural Network with Pytorch</a></li><li><a href="https://papers.baulab.info/papers/Scarselli-2009.pdf">Scarselli, F., Gori, M., Tsoi, A. C., Hagenbuchner, M., &amp; Monfardini, G. (2008). <strong>The graph neural network model</strong>. IEEE transactions on neural networks, 20(1), 61-80.</a></li><li><a href="https://arxiv.org/pdf/1810.00826">Xu, K., Hu, W., Leskovec, J., &amp; Jegelka, S. (2018). <strong>How powerful are graph neural networks?</strong>. arXiv preprint arXiv:1810.00826.</a></li><li><a href="https://www.sciencedirect.com/science/article/pii/S2666651021000012">Zhou, J., Cui, G., Hu, S., Zhang, Z., Yang, C., Liu, Z., ... &amp; Sun, M. (2020). <strong>Graph neural networks: A review of methods and applications</strong>. AI open, 1, 57-81.</a></li><li><a href="https://ieeexplore.ieee.org/ielaam/5962385/9312808/9046288-aam.pdf">Wu, Z., Pan, S., Chen, F., Long, G., Zhang, C., &amp; Philip, S. Y. (2020). <strong>A comprehensive survey on graph neural networks</strong>. IEEE transactions on neural networks and learning systems, 32(1), 4-24.</a></li><li><a href="http://proceedings.mlr.press/v70/gilmer17a/gilmer17a.pdf">Neural Message Passing for Quantum Chemistry J. Gilmer, S.S. Schoenholz, P.F. Riley, O. Vinyals, G.E. Dahl. Proceedings of the 34th International Conference on Machine Learning, Vol 70, pp. 1263--1272. PMLR. 2017.</a></li><li><a href="https://www.researchgate.net/profile/Andrea-Tacchetti/publication/325557043_Relational_inductive_biases_deep_learning_and_graph_networks/links/5cd0ad38299bf14d957cca5c/Relational-inductive-biases-deep-learning-and-graph-networks.pdf">Relational inductive biases, deep learning, and graph networks P.W. Battaglia, J.B. Hamrick, V. Bapst, A. Sanchez-Gonzalez, V. Zambaldi, M. Malinowski, A. Tacchetti, D. Raposo, A. Santoro, R. Faulkner, C. Gulcehre, F. Song, A. Ballard, J. Gilmer, G. Dahl, A. Vaswani, K. Allen, C. Nash, V. Langston, C. Dyer, N. Heess, D. Wierstra, P. Kohli, M. Botvinick, O. Vinyals, Y. Li, R. Pascanu. 2018.</a></li><li><a href="https://dl.acm.org/doi/pdf/10.1145/174608.174610">Poulovassilis, A., &amp; Levene, M. (1994). <strong>A nested-graph model for the representation and manipulation of complex objects</strong>. ACM Transactions on Information Systems (TOIS), 12(1), 35-68.</a></li><li><a href="https://academic.oup.com/bioinformatics/article-pdf/34/13/i457/50316205/bioinformatics_34_13_i457.pdf">Zitnik, M., Agrawal, M., &amp; Leskovec, J. (2018). <strong>Modeling polypharmacy side effects with graph convolutional networks</strong>. Bioinformatics, 34(13), i457-i466.</a></li><li><a href="https://www.nature.com/articles/s41467-020-19267-x.pdf">Stocker, S., Csanyi, G., Reuter, K., &amp; Margraf, J. T. (2020). <strong>Machine learning in chemical reaction space</strong>. Nature communications, 11(1), 5505.</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>ML</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ECMWF</tag>
      
      <tag>AI</tag>
      
      <tag>ML</tag>
      
      <tag>pytorch</tag>
      
      <tag>GNN</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ML | PyTorch</title>
    <link href="/2024/12/12/ML-pytorch/"/>
    <url>/2024/12/12/ML-pytorch/</url>
    
    <content type="html"><![CDATA[<h1 id="pytorch">PyTorch</h1><p>2017 å¹´åˆç”± Facebook é–‹æºçš„å¦ä¸€å¥—å»ºç«‹åœ¨ Torch ä¹‹ä¸Šçš„æ·±åº¦å­¸ç¿’æ¡†æ¶ PyTorch å› å…¶èªæ³•ç°¡æ½”å„ªé›…ã€æ¦‚å¿µç›´è§€å’Œæ˜“ä¸Šæ‰‹çš„ç‰¹æ€§ï¼Œç”«æ¨å‡ºä¾¿è¿…é€Ÿèµ°ç´…ï¼Œå„¼ç„¶å·²æˆç‚ºç“œåˆ†æ·±åº¦å­¸ç¿’å¸‚å ´çš„æœ‰åŠ›ç«¶çˆ­è€…ã€‚</p><p>PyTorch is an optimized tensor library for deep learning using GPUs and CPUs. Automatic differentiation is done with a tape-based system at both a functional and neural network layer level. This functionality brings a high level of flexibility and speed as a deep learning framework and provides accelerated NumPy-like functionality.</p><p>To check if your GPU driver and CUDA/ROCm is enabled and accessible by PyTorch,</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> torch<br><br><span class="hljs-built_in">print</span>(torch.__version__)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;torch.cuda.is_available() = &quot;</span>, torch.cuda.is_available())<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;torch.cuda.device_count() = &quot;</span>, torch.cuda.device_count())<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;torch.cuda.current_device() =&quot;</span>, torch.cuda.current_device())<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;torch.cuda.device(0) = &quot;</span>, torch.cuda.device(<span class="hljs-number">0</span>))<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;torch.cuda.get_device_name(0) = &quot;</span>, torch.cuda.get_device_name(<span class="hljs-number">0</span>))<br></code></pre></td></tr></table></figure><p>General usage,</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># å¯¼â¼ŠåŒ…å’Œç‰ˆæœ¬æŸ¥è¯¢</span><br><span class="hljs-keyword">import</span>Â torch <br><span class="hljs-keyword">import</span>Â torch.nnÂ <span class="hljs-keyword">as</span>Â nn <br><span class="hljs-keyword">import</span>Â torchvision <br><br><span class="hljs-built_in">print</span>(torch.__version__) <br><span class="hljs-built_in">print</span>(torch.version.cuda) <br><span class="hljs-built_in">print</span>(torch.backends.cudnn.version()) <br><span class="hljs-built_in">print</span>(torch.cuda.get_device_name(<span class="hljs-number">0</span>))<br><br><br><span class="hljs-comment"># å¯å¤ç°æ€§åœ¨ç¡¬ä»¶è®¾å¤‡ï¼ˆCPUã€GPUï¼‰ä¸åŒæ—¶ï¼Œå®Œå…¨çš„å¯å¤ç°æ€§â½†æ³•ä¿è¯ï¼Œå³ä½¿éšæœºç§â¼¦ç›¸åŒã€‚ä½†æ˜¯ï¼Œåœ¨åŒâ¼€ä¸ªè®¾å¤‡ä¸Šï¼Œåº”è¯¥ä¿è¯å¯å¤ç°æ€§ã€‚å…·ä½“åšæ³•æ˜¯ï¼Œåœ¨ç¨‹åºå¼€å§‹çš„æ—¶å€™å›ºå®štorchçš„éšæœºç§â¼¦ï¼ŒåŒæ—¶ä¹ŸæŠŠnumpyçš„éšæœºç§â¼¦å›ºå®šã€‚</span><br><br>np.random.seed(<span class="hljs-number">0</span>) <br>torch.manual_seed(<span class="hljs-number">0</span>) <br>torch.cuda.manual_seed_all(<span class="hljs-number">0</span>) <br>torch.backends.cudnn.deterministicÂ =Â <span class="hljs-literal">True</span> <br>torch.backends.cudnn.benchmarkÂ =Â <span class="hljs-literal">False</span><br></code></pre></td></tr></table></figure><h1 id="example">Example</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-number">1.</span>å¯¼å…¥Pyorch åº“ï¼š<br><span class="hljs-comment"># å¯¼å…¥PyTorchåº“ï¼Œç”¨äºæ„å»ºå’Œè®­ç»ƒç¥ç»ç½‘ç»œ</span><br><span class="hljs-keyword">import</span> torch<br><span class="hljs-comment"># å¯¼å…¥ç¥ç»ç½‘ç»œæ¨¡å—ï¼Œç”¨äºå®šä¹‰ç¥ç»ç½‘ç»œç»“æ„</span><br><span class="hljs-keyword">import</span> torch.nn <span class="hljs-keyword">as</span> nn<br><span class="hljs-comment"># å¯¼å…¥ä¼˜åŒ–å™¨æ¨¡å—ï¼Œç”¨äºå®šä¹‰æ¨¡å‹çš„ä¼˜åŒ–ç®—æ³•</span><br><span class="hljs-keyword">import</span> torch.optim <span class="hljs-keyword">as</span> optim<br><span class="hljs-comment"># å¯¼å…¥å‡½æ•°alæ¨¡å—ï¼Œç”¨äºä½¿ç”¨å„ç§æ¿€æ´»å‡½æ•°å’ŒæŸå¤±å‡½æ•°</span><br><span class="hljs-keyword">import</span> torch.nn.functional <span class="hljs-keyword">as</span> F<br><span class="hljs-comment"># å¯¼å…¥æ•°æ®åŠ è½½å’Œæ•°æ®é›†æ¨¡å—ï¼Œç”¨äºå¤„ç†å’ŒåŠ è½½è®­ç»ƒæ•°æ®</span><br><span class="hljs-keyword">from</span> torch.utils.data <span class="hljs-keyword">import</span> DataLoader, Dataset<br><span class="hljs-comment"># å¯¼å…¥å˜æ¢æ¨¡å—ï¼Œç”¨äºå¯¹å›¾åƒæ•°æ®è¿›è¡Œé¢„å¤„ç†</span><br><span class="hljs-keyword">from</span> torchvision <span class="hljs-keyword">import</span> transforms<br><br><span class="hljs-number">2.</span>æ£€æŸ¥ GPU æ”¯æŒï¼š<br><span class="hljs-comment"># æ ¹æ®ç¯å¢ƒé€‰æ‹©åˆé€‚çš„è®¡ç®—è®¾å¤‡</span><br>device = torch.device(<span class="hljs-string">&quot;cuda&quot;</span> <span class="hljs-keyword">if</span> torch.cuda.is_available() <span class="hljs-keyword">else</span> <span class="hljs-string">&quot;cpu&quot;</span>)<br><br><span class="hljs-number">3.</span>åˆ›å»ºè‡ªå®šä¹‰æ•°æ®é›†ï¼š<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">CustomDataset</span>(<span class="hljs-title class_ inherited__">Dataset</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    è‡ªå®šä¹‰æ•°æ®é›†ç±»ï¼Œç»§æ‰¿è‡ªtorch.utils.data.Datasetã€‚</span><br><span class="hljs-string">    ç”¨äºå°è£…ä»»æ„æ•°æ®å’Œå…¶å¯¹åº”çš„æ ‡ç­¾ï¼Œæ–¹ä¾¿åœ¨ç¥ç»ç½‘ç»œæ¨¡å‹ä¸­ä½¿ç”¨ã€‚</span><br><span class="hljs-string">    </span><br><span class="hljs-string">    å‚æ•°:</span><br><span class="hljs-string">    - data: æ•°æ®é›†ï¼Œå¯ä»¥æ˜¯ä»»æ„å½¢å¼ï¼Œå¦‚numpyæ•°ç»„æˆ–Pandas DataFrameã€‚</span><br><span class="hljs-string">    - labels: æ•°æ®é›†çš„æ ‡ç­¾ï¼Œé€šå¸¸æ˜¯ä¸€ä¸ªä¸€ç»´æ•°ç»„æˆ–åˆ—è¡¨ã€‚</span><br><span class="hljs-string">    - transform: å¯é€‰çš„æ•°æ®è½¬æ¢å‡½æ•°ï¼Œç”¨äºåœ¨è·å–æ•°æ®é¡¹æ—¶å¯¹å…¶è¿›è¡Œè½¬æ¢ã€‚</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, data, labels, transform=<span class="hljs-literal">None</span></span>):<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        åˆå§‹åŒ–è‡ªå®šä¹‰æ•°æ®é›†ç±»ã€‚</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        <span class="hljs-variable language_">self</span>.data = data<br>        <span class="hljs-variable language_">self</span>.labels = labels<br>        <span class="hljs-variable language_">self</span>.transform = transform<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__len__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        è¿”å›æ•°æ®é›†çš„å¤§å°ã€‚</span><br><span class="hljs-string">        </span><br><span class="hljs-string">        è¿”å›:</span><br><span class="hljs-string">        - æ•°æ®é›†çš„æ ·æœ¬æ•°é‡ã€‚</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">len</span>(<span class="hljs-variable language_">self</span>.data)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__getitem__</span>(<span class="hljs-params">self, index</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        æ ¹æ®ç´¢å¼•è·å–æ•°æ®é¡¹ã€‚</span><br><span class="hljs-string">        </span><br><span class="hljs-string">        å‚æ•°:</span><br><span class="hljs-string">        - index: ç´¢å¼•å€¼ï¼Œç”¨äºè·å–æ•°æ®é›†ä¸­çš„ç‰¹å®šæ ·æœ¬ã€‚</span><br><span class="hljs-string">        </span><br><span class="hljs-string">        è¿”å›:</span><br><span class="hljs-string">        - x: æ•°æ®é¡¹ã€‚</span><br><span class="hljs-string">        - y: æ•°æ®é¡¹çš„æ ‡ç­¾ã€‚</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        x = <span class="hljs-variable language_">self</span>.data[index]<br>        y = <span class="hljs-variable language_">self</span>.labels[index]<br><br>        <span class="hljs-comment"># å¦‚æœæä¾›äº†æ•°æ®è½¬æ¢å‡½æ•°ï¼Œåˆ™åº”ç”¨è¯¥å‡½æ•°å¯¹æ•°æ®é¡¹è¿›è¡Œè½¬æ¢</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-variable language_">self</span>.transform:<br>            x = <span class="hljs-variable language_">self</span>.transform(x)<br><br>        <span class="hljs-keyword">return</span> x, y<br><br><span class="hljs-number">4.</span>ä½¿ç”¨æ•°æ®å¢å¼ºï¼š<br><span class="hljs-comment"># å®šä¹‰ä¸€ä¸ªè½¬æ¢å™¨ï¼Œç”¨äºå°†å›¾åƒè½¬æ¢ä¸ºä¸€ç³»åˆ—é¢„å¤„ç†æ­¥éª¤çš„ç»„åˆ</span><br>transform = transforms.Compose([<br>    <span class="hljs-comment"># éšæœºæ°´å¹³ç¿»è½¬å›¾åƒï¼Œå¢åŠ æ•°æ®é›†çš„å¤šæ ·æ€§</span><br>    transforms.RandomHorizontalFlip(),<br>    <span class="hljs-comment"># éšæœºæ—‹è½¬å›¾åƒï¼Œæ—‹è½¬è§’åº¦åœ¨(-10, 10)ä¹‹é—´ï¼Œä»¥å¢å¼ºæ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›</span><br>    transforms.RandomRotation(<span class="hljs-number">10</span>),<br>    <span class="hljs-comment"># å°†å›¾åƒè½¬æ¢ä¸ºTensorï¼Œä»¥ä¾¿äºåœ¨PyTorchæ¨¡å‹ä¸­ä½¿ç”¨</span><br>    transforms.ToTensor(),<br>])<br><br><span class="hljs-number">5.</span>æ•°æ®åŠ è½½ï¼š<br><span class="hljs-comment"># åˆ›å»ºè®­ç»ƒæ•°æ®é›†å®ä¾‹</span><br><span class="hljs-comment"># å‚æ•°:</span><br><span class="hljs-comment"># - train_data: è®­ç»ƒæ•°æ®è¾“å…¥</span><br><span class="hljs-comment"># - train_labels: è®­ç»ƒæ•°æ®æ ‡ç­¾</span><br><span class="hljs-comment"># - transform: æ•°æ®è½¬æ¢å‡½æ•°</span><br>train_dataset = CustomDataset(train_data, train_labels, transform=transform)<br><br><span class="hljs-comment"># åˆ›å»ºæ•°æ®åŠ è½½å™¨</span><br><span class="hljs-comment"># å‚æ•°:</span><br><span class="hljs-comment"># - train_dataset: è®­ç»ƒæ•°æ®é›†å®ä¾‹</span><br><span class="hljs-comment"># - batch_size: æ¯ä¸ªæ‰¹æ¬¡çš„æ•°æ®å¤§å°</span><br><span class="hljs-comment"># - shuffle: æ˜¯å¦åœ¨æ¯ä¸ªepochå¼€å§‹æ—¶æ‰“ä¹±æ•°æ®é¡ºåº</span><br>train_loader = DataLoader(train_dataset, batch_size=<span class="hljs-number">64</span>, shuffle=<span class="hljs-literal">True</span>)<br><br><span class="hljs-number">6.</span>å®šä¹‰ç¥ç»ç½‘ç»œæ¨¡å‹ï¼š<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Net</span>(nn.Module):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    å®šä¹‰ä¸€ä¸ªç¥ç»ç½‘ç»œæ¨¡å‹ã€‚ç»§æ‰¿è‡ªtorch.nn.Moduleã€‚</span><br><span class="hljs-string">    è¯¥æ¨¡å‹åŒ…æ‹¬ä¸€ä¸ªå·ç§¯å±‚å’Œä¸¤ä¸ªå…¨è¿æ¥å±‚ã€‚</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        åˆå§‹åŒ–æ¨¡å‹å¹¶å®šä¹‰å„å±‚ã€‚</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        <span class="hljs-built_in">super</span>(Net, <span class="hljs-variable language_">self</span>).__init__()<br>        <span class="hljs-variable language_">self</span>.conv1 = nn.Conv2d(<span class="hljs-number">1</span>, <span class="hljs-number">32</span>, kernel_size=<span class="hljs-number">3</span>)  <span class="hljs-comment"># å·ç§¯å±‚ï¼šè¾“å…¥é€šé“æ•°1ï¼Œè¾“å‡ºé€šé“æ•°32ï¼Œå·ç§¯æ ¸å¤§å°3x3</span><br>        <span class="hljs-variable language_">self</span>.fc1 = nn.Linear(<span class="hljs-number">32</span> * <span class="hljs-number">28</span> * <span class="hljs-number">28</span>, <span class="hljs-number">128</span>)  <span class="hljs-comment"># å…¨è¿æ¥å±‚ï¼šè¾“å…¥å¤§å°32*28*28ï¼Œè¾“å‡ºå¤§å°128</span><br>        <span class="hljs-variable language_">self</span>.fc2 = nn.Linear(<span class="hljs-number">128</span>, <span class="hljs-number">10</span>)  <span class="hljs-comment"># å…¨è¿æ¥å±‚ï¼šè¾“å…¥å¤§å°128ï¼Œè¾“å‡ºå¤§å°10</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, x</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        å®šä¹‰æ¨¡å‹çš„å‰å‘ä¼ æ’­è¿‡ç¨‹ã€‚</span><br><span class="hljs-string">        :param x: è¾“å…¥æ•°æ®ï¼Œä¸€ä¸ªå¼ é‡</span><br><span class="hljs-string">        :return: æ¨¡å‹è¾“å‡ºï¼Œä¸€ä¸ªå¼ é‡</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        x = F.relu(<span class="hljs-variable language_">self</span>.conv1(x))  <span class="hljs-comment"># ç»è¿‡å·ç§¯å±‚åä½¿ç”¨ReLUæ¿€æ´»å‡½æ•°</span><br>        x = x.view(x.size(<span class="hljs-number">0</span>), -<span class="hljs-number">1</span>)  <span class="hljs-comment"># å°†å¼ é‡å±•å¹³</span><br>        x = F.relu(<span class="hljs-variable language_">self</span>.fc1(x))  <span class="hljs-comment"># ç»è¿‡ç¬¬ä¸€ä¸ªå…¨è¿æ¥å±‚åä½¿ç”¨ReLUæ¿€æ´»å‡½æ•°</span><br>        x = <span class="hljs-variable language_">self</span>.fc2(x)  <span class="hljs-comment"># ç¬¬äºŒä¸ªå…¨è¿æ¥å±‚çš„è¾“å‡ºï¼Œæ­¤å¤„ä¸ä½¿ç”¨æ¿€æ´»å‡½æ•°</span><br>        <span class="hljs-keyword">return</span> x<br><br><span class="hljs-number">7.</span>å®ä¾‹åŒ–æ¨¡å‹å’Œä¼˜åŒ–å™¨ï¼š<br><span class="hljs-comment">#å®ä¾‹åŒ–ç¥ç»ç½‘ç»œæ¨¡å‹å¹¶è½¬ç§»åˆ°æŒ‡å®šè®¾å¤‡ä¸Š</span><br>model = Net().to(device)  <br><br><span class="hljs-comment">#åˆå§‹åŒ–ä¼˜åŒ–å™¨ï¼Œä½¿ç”¨Adamç®—æ³•ä¼˜åŒ–æ¨¡å‹å‚æ•°</span><br><span class="hljs-comment">#å­¦ä¹ ç‡è®¾ç½®ä¸º0.001ï¼Œä»¥é€‚åº”å¤§å¤šæ•°æ·±åº¦å­¦ä¹ æ¨¡å‹çš„è®­ç»ƒéœ€æ±‚</span><br>optimizer = optim.Adam(model.parameters(), lr=<span class="hljs-number">0.001</span>)<br><br><span class="hljs-number">8.</span>å®šä¹‰æŸå¤±å‡½æ•°ï¼š<br><span class="hljs-comment"># å®šä¹‰æŸå¤±å‡½æ•°ä¸ºäº¤å‰ç†µæŸå¤±ï¼Œç”¨äºåˆ†ç±»ä»»åŠ¡ä¸­</span><br>criterion = nn.CrossEntropyLoss()<br><br><span class="hljs-number">9.</span>è®­ç»ƒæ¨¡å‹ï¼š<br><span class="hljs-comment"># è¿­ä»£è®­ç»ƒæ¨¡å‹ï¼Œå…±è¿›è¡Œnum_epochsè½®</span><br><span class="hljs-keyword">for</span> epoch <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(num_epochs):  <br>    <span class="hljs-comment"># éå†è®­ç»ƒæ•°æ®åŠ è½½å™¨ï¼Œè·å–æ‰¹æ¬¡ç´¢å¼•ã€æ•°æ®å’Œç›®æ ‡æ ‡ç­¾</span><br>    <span class="hljs-keyword">for</span> batch_idx, (data, target) <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(train_loader):  <br>        <span class="hljs-comment"># å°†æ•°æ®å’Œç›®æ ‡æ ‡ç­¾ç§»åŠ¨åˆ°æŒ‡å®šè®¾å¤‡ï¼ˆå¦‚GPUï¼‰</span><br>        data, target = data.to(device), target.to(device)  <br><br>        <span class="hljs-comment"># æ¸…ç©ºæ¢¯åº¦ï¼Œé¿å…ç´¯ç§¯</span><br>        optimizer.zero_grad()  <br>        <span class="hljs-comment"># å‰å‘ä¼ æ’­ï¼Œè·å–æ¨¡å‹è¾“å‡º</span><br>        output = model(data)  <br>        <span class="hljs-comment"># è®¡ç®—æ¨¡å‹è¾“å‡ºä¸ç›®æ ‡æ ‡ç­¾ä¹‹é—´çš„æŸå¤±</span><br>        loss = criterion(output, target)  <br>        <span class="hljs-comment"># åå‘ä¼ æ’­ï¼Œè®¡ç®—æ¢¯åº¦</span><br>        loss.backward()  <br>        <span class="hljs-comment"># æ›´æ–°æ¨¡å‹æƒé‡</span><br>        optimizer.step()  <br><br>        <span class="hljs-comment"># æŒ‰ç…§æ—¥å¿—é—´éš”æ‰“å°è®­ç»ƒä¿¡æ¯</span><br>        <span class="hljs-keyword">if</span> batch_idx % log_interval == <span class="hljs-number">0</span>:  <br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Train Epoch: <span class="hljs-subst">&#123;epoch&#125;</span> [<span class="hljs-subst">&#123;batch_idx * <span class="hljs-built_in">len</span>(data)&#125;</span>/<span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(train_loader.dataset)&#125;</span> (<span class="hljs-subst">&#123;<span class="hljs-number">100.</span> * batch_idx / <span class="hljs-built_in">len</span>(train_loader):<span class="hljs-number">.0</span>f&#125;</span>%)]\tLoss: <span class="hljs-subst">&#123;loss.item():<span class="hljs-number">.6</span>f&#125;</span>&quot;</span>)<br><br><span class="hljs-number">10.</span>è¯„ä¼°æ¨¡å‹ï¼š<br>model.<span class="hljs-built_in">eval</span>()  <span class="hljs-comment"># å°†æ¨¡å‹è®¾ç½®ä¸ºè¯„ä¼°æ¨¡å¼ï¼Œä»¥ç¦ç”¨dropoutç­‰ä»…åœ¨è®­ç»ƒæ—¶éœ€è¦çš„ç‰¹æ€§</span><br>test_loss = <span class="hljs-number">0</span>  <span class="hljs-comment"># åˆå§‹åŒ–æµ‹è¯•æŸå¤±ä¸º0</span><br>correct = <span class="hljs-number">0</span>  <span class="hljs-comment"># åˆå§‹åŒ–æ­£ç¡®é¢„æµ‹çš„æ•°é‡ä¸º0</span><br><span class="hljs-keyword">with</span> torch.no_grad():  <span class="hljs-comment"># åœ¨ä¸éœ€è¦è®¡ç®—æ¢¯åº¦çš„ä¸Šä¸‹æ–‡ä¸­è¿›è¡Œè¯„ä¼°ï¼Œä»¥å‡å°‘å†…å­˜æ¶ˆè€—</span><br>    <span class="hljs-keyword">for</span> data, target <span class="hljs-keyword">in</span> test_loader:  <span class="hljs-comment"># éå†æµ‹è¯•æ•°æ®é›†</span><br>        data, target = data.to(device), target.to(device)  <span class="hljs-comment"># å°†æ•°æ®å’Œç›®æ ‡ç§»åŠ¨åˆ°æŒ‡å®šè®¾å¤‡</span><br>        output = model(data)  <span class="hljs-comment"># å‰å‘ä¼ æ’­ï¼Œè·å–æ¨¡å‹çš„è¾“å‡º</span><br>        test_loss += criterion(output, target).item()  <span class="hljs-comment"># è®¡ç®—å¹¶ç´¯åŠ æµ‹è¯•æŸå¤±</span><br>pred = output.argmax(dim=<span class="hljs-number">1</span>, keepdim=<span class="hljs-literal">True</span>)  <span class="hljs-comment"># è·å–é¢„æµ‹çš„ç±»åˆ«ç´¢å¼•</span><br>correct += pred.eq(target.view_as(pred)).<span class="hljs-built_in">sum</span>().item()  <span class="hljs-comment"># è®¡ç®—å¹¶ç´¯åŠ æ­£ç¡®é¢„æµ‹çš„æ•°é‡</span><br><br>test_loss /= <span class="hljs-built_in">len</span>(test_loader.dataset)  <span class="hljs-comment"># è®¡ç®—å¹³å‡æµ‹è¯•æŸå¤±</span><br>test_accuracy = <span class="hljs-number">100.</span> * correct / <span class="hljs-built_in">len</span>(test_loader.dataset)  <span class="hljs-comment"># è®¡ç®—æµ‹è¯•å‡†ç¡®ç‡</span><br><br><span class="hljs-comment"># æ‰“å°æµ‹è¯•é›†çš„å¹³å‡æŸå¤±å’Œå‡†ç¡®ç‡</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;Test set: Average loss: <span class="hljs-subst">&#123;test_loss:<span class="hljs-number">.4</span>f&#125;</span>, Accuracy: <span class="hljs-subst">&#123;correct&#125;</span>/<span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(test_loader.dataset)&#125;</span> (<span class="hljs-subst">&#123;test_accuracy:<span class="hljs-number">.0</span>f&#125;</span>%)&#x27;</span>)<br><br><span class="hljs-number">11.</span>ä¿å­˜å’ŒåŠ è½½æ¨¡å‹ï¼š<br><span class="hljs-comment"># ä¿å­˜æ¨¡å‹çš„å‚æ•°çŠ¶æ€</span><br>torch.save(model.state_dict(), <span class="hljs-string">&#x27;model.pth&#x27;</span>)  <br><br><span class="hljs-comment"># å®ä¾‹åŒ–ä¸€ä¸ªæ–°çš„æ¨¡å‹å¯¹è±¡</span><br>model = Net()  <br><span class="hljs-comment"># åŠ è½½ä¿å­˜çš„æ¨¡å‹å‚æ•°çŠ¶æ€åˆ°æ–°çš„æ¨¡å‹å¯¹è±¡ä¸­</span><br>model.load_state_dict(torch.load(<span class="hljs-string">&#x27;model.pth&#x27;</span>))  <br><span class="hljs-comment"># å°†æ¨¡å‹ç§»åŠ¨åˆ°æŒ‡å®šçš„è®¾å¤‡ä¸Šï¼Œä¾‹å¦‚CPUæˆ–GPU</span><br>model.to(device)<br><br><span class="hljs-number">12.</span>ä½¿ç”¨ GPU åŠ é€Ÿï¼š<br><span class="hljs-comment"># å°†æ¨¡å‹ç§»åŠ¨åˆ°æŒ‡å®šè®¾å¤‡ä¸Šï¼Œä»¥é€‚åº”ä¸åŒç¡¬ä»¶ç¯å¢ƒï¼ˆå¦‚GPUæˆ–CPUï¼‰</span><br>model = model.to(device)  <br><br><span class="hljs-comment"># å°†æ•°æ®ç§»åŠ¨åˆ°æŒ‡å®šè®¾å¤‡ä¸Šï¼Œç¡®ä¿æ•°æ®ä¸æ¨¡å‹åœ¨åŒä¸€ç¡¬ä»¶ç¯å¢ƒ</span><br>data = data.to(device)  <br><br><span class="hljs-comment"># å°†ç›®æ ‡å€¼ç§»åŠ¨åˆ°æŒ‡å®šè®¾å¤‡ä¸Šï¼Œä¿è¯ç›®æ ‡ä¸æ•°æ®ã€æ¨¡å‹ä¸€è‡´</span><br>target = target.to(device)<br><br><span class="hljs-number">13.</span>ä½¿ç”¨ TensorBoard è¿›è¡Œå¯è§†åŒ–ï¼š<br><span class="hljs-keyword">from</span> torch.utils.tensorboard <span class="hljs-keyword">import</span> SummaryWriter<br>  <br><span class="hljs-comment"># åˆ›å»ºä¸€ä¸ªSummaryWriterå¯¹è±¡ï¼Œç”¨äºå°†è®­ç»ƒè¿‡ç¨‹ä¸­çš„æŸå¤±å’Œå‡†ç¡®ç‡ç­‰æ•°æ®å†™å…¥TensorBoardæ—¥å¿—æ–‡ä»¶</span><br>writer = SummaryWriter()<br>  <br><span class="hljs-comment"># éå†è®­ç»ƒçš„æ¯ä¸ªå‘¨æœŸ(epoch)</span><br><span class="hljs-keyword">for</span> epoch <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(num_epochs):<br>    <span class="hljs-comment"># è¿›è¡Œè®­ç»ƒå’Œè®°å½•...</span><br>    <span class="hljs-comment"># è®°å½•å½“å‰å‘¨æœŸçš„è®­ç»ƒæŸå¤±</span><br>    writer.add_scalar(<span class="hljs-string">&#x27;Loss/train&#x27;</span>, loss.item(), epoch)<br>    <span class="hljs-comment"># è®°å½•å½“å‰å‘¨æœŸçš„è®­ç»ƒå‡†ç¡®ç‡</span><br>    writer.add_scalar(<span class="hljs-string">&#x27;Accuracy/train&#x27;</span>, accuracy, epoch)<br>    <span class="hljs-comment"># ...</span><br>  <br><span class="hljs-comment"># å…³é—­SummaryWriterå¯¹è±¡ï¼Œç¡®ä¿æ‰€æœ‰æ•°æ®è¢«æ­£ç¡®å†™å…¥æ—¥å¿—æ–‡ä»¶</span><br>writer.close()<br><br><span class="hljs-number">14.</span>è°ƒæ•´å­¦ä¹ ç‡ï¼š<br><span class="hljs-comment"># åˆå§‹åŒ–å­¦ä¹ ç‡è°ƒåº¦å™¨ï¼Œä»¥ä¾¿åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­æŒ‰ç­–ç•¥è°ƒæ•´å­¦ä¹ ç‡</span><br>scheduler = optim.lr_scheduler.StepLR(optimizer, step_size=<span class="hljs-number">10</span>, gamma=<span class="hljs-number">0.1</span>)  <br><br><span class="hljs-comment"># å¼€å§‹è®­ç»ƒè¿‡ç¨‹ï¼Œè¿­ä»£æŒ‡å®šçš„è½®æ¬¡</span><br><span class="hljs-keyword">for</span> epoch <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(num_epochs):  <br>    <span class="hljs-comment"># æ›´æ–°å­¦ä¹ ç‡è°ƒåº¦å™¨ï¼Œæ ¹æ®å½“å‰è½®æ¬¡è°ƒæ•´å­¦ä¹ ç‡</span><br>    scheduler.step()  <span class="hljs-comment"># æ›´æ–°å­¦ä¹ ç‡  </span><br>    <span class="hljs-comment"># è¿›è¡Œè®­ç»ƒ...</span><br><br><span class="hljs-number">15.</span>ä½¿ç”¨é¢„è®­ç»ƒæ¨¡å‹ï¼š<br><span class="hljs-comment"># å¯¼å…¥torchvisionä¸­çš„modelsæ¨¡å—ï¼Œç”¨äºè®¿é—®é¢„å®šä¹‰çš„æ¨¡å‹æ¶æ„å’Œé¢„è®­ç»ƒæ¨¡å‹</span><br><span class="hljs-keyword">import</span> torchvision.models <span class="hljs-keyword">as</span> models<br>  <br><span class="hljs-comment"># åˆå§‹åŒ–ä¸€ä¸ªé¢„è®­ç»ƒçš„ResNet-18æ¨¡å‹</span><br><span class="hljs-comment"># ResNet-18æ˜¯ä¸€ä¸ªæ·±åº¦å·ç§¯ç¥ç»ç½‘ç»œï¼Œå…·æœ‰18å±‚ï¼Œå¹¿æ³›åº”ç”¨äºå›¾åƒåˆ†ç±»ä»»åŠ¡ä¸­</span><br><span class="hljs-comment"># å‚æ•°pretrained=Trueè¡¨ç¤ºä½¿ç”¨ImageNetæ•°æ®é›†é¢„è®­ç»ƒçš„æ¨¡å‹æƒé‡</span><br>model = models.resnet18(pretrained=<span class="hljs-literal">True</span>)<br><br><span class="hljs-number">16.</span>è¿ç§»å­¦ä¹ ï¼š<br><span class="hljs-comment"># éå†æ¨¡å‹çš„æ‰€æœ‰å‚æ•°</span><br><span class="hljs-keyword">for</span> param <span class="hljs-keyword">in</span> model.parameters():  <br>    param.requires_grad = <span class="hljs-literal">False</span>  <span class="hljs-comment"># å†»ç»“æ¨¡å‹å‚æ•°ï¼Œé˜²æ­¢åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­æ›´æ–°è¿™äº›å‚æ•°</span><br>  <br><span class="hljs-comment"># æ›¿æ¢æœ€åçš„å…¨è¿æ¥å±‚ä»¥é€‚åº”æ–°çš„ç±»åˆ«æ•°</span><br>model.fc = nn.Linear(model.fc.in_features, num_classes)<br></code></pre></td></tr></table></figure><h1 id="references">References</h1><ol type="1"><li><a href="https://dev.to/hyperkai/check-pytorch-version-cpu-and-gpucuda-in-pytorch-6jk">Check PyTorch version, CPU and GPU(CUDA) in PyTorch</a></li><li><a href="https://mp.weixin.qq.com/s/bcIC27Xo_LAaLUegElzOsg">Pytorch é«˜é¢‘ä½¿ç”¨ä»£ç é›†é”¦</a></li><li><a href="https://mp.weixin.qq.com/s/ydlzsZ3wuZt-0CRHeYy3GQ">åŒ…å«ä»£ç é€è¡Œè§£è¯»ï¼PyTorchçœŸçš„ä¸éš¾ï¼Œå¸¸è§çš„ç”¨æ³•å°±è¿™ä¹ˆå¤šï¼</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>ML</category>
      
    </categories>
    
    
    <tags>
      
      <tag>PINN</tag>
      
      <tag>AI</tag>
      
      <tag>DeepONet</tag>
      
      <tag>ML</tag>
      
      <tag>pytorch</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Maths | ROC Curves</title>
    <link href="/2024/12/10/maths-ROC/"/>
    <url>/2024/12/10/maths-ROC/</url>
    
    <content type="html"><![CDATA[<h1 id="roc-curve">ROC curve</h1><p>åœ¨è¨Šè™Ÿæª¢æ¸¬ç†è«–ä¸­ï¼Œ<strong>æ¥æ”¶è€…æ“ä½œç‰¹å¾µæ›²ç·š</strong>ï¼Œæˆ–è€…å« <strong>ROC æ›²ç·š</strong>ï¼ˆReceiver operating characteristic curveï¼‰ï¼Œæ˜¯ä¸€ç¨®åæ¨™åœ–å¼çš„åˆ†æå·¥å…·ï¼Œ</p><ul><li>ç”¨æ–¼é¸æ“‡æœ€ä½³çš„è¨Šè™Ÿåµæ¸¬æ¨¡å‹ ã€</li><li>æ¨æ£„æ¬¡ä½³çš„æ¨¡å‹ æˆ–è€…</li><li>åœ¨åŒä¸€æ¨¡å‹ä¸­è¨­ç½®æœ€ä½³é–¾å€¼ã€‚</li></ul><p>åœ¨åšæ±ºç­–æ™‚ï¼ŒROCåˆ†æèƒ½ä¸å—æˆæœ¬ï¼æ•ˆç›Šçš„å½±éŸ¿ï¼Œçµ¦å‡ºå®¢è§€ä¸­ç«‹çš„å»ºè­°ã€‚</p><p>ROCæ›²ç·š (Receiver operating characteristic curve) æ˜¯ç¬¬äºŒæ¬¡ä¸–ç•Œå¤§æˆ°ä¸­çš„ç™¼æ˜ï¼Œæœ€åˆç”¨åœ¨1941å¹´çš„çç æ¸¯äº‹ä»¶ï¼Œä»¥åµæ¸¬æˆ°å ´ä¸Šçš„æ—¥è»è¼‰å…·ï¼ˆé£›æ©Ÿã€èˆ¹è‰¦ï¼‰ï¼Œå…¶åŸç†ä¿‚åˆ©ç”¨é›·é”ä¸Šçš„ä¿¡è™Ÿå¼·å¼±è¨­å®šé–¾å€¼ï¼Œä»¥ä½œç‚ºè»äº‹è¡Œå‹•çš„åˆ¤æ–·ä¾æ“šï¼Œè€Œç™¼å±•å‡ºçš„ä¿¡è™Ÿåµæ¸¬ç†è«–(Signal Detection Theory )ï¼Œ1950å¹´ä»£è¢«æ‡‰ç”¨åœ¨å¿ƒç†å­¸é ˜åŸŸã€‚æ•¸åå¹´ä¾†ï¼ŒROCåˆ†æè¢«ç”¨æ–¼é†«å­¸ã€ç„¡ç·šé›»ã€ç”Ÿç‰©å­¸ã€çŠ¯ç½ªå¿ƒç†å­¸é ˜åŸŸä¸­ï¼Œè€Œä¸”æœ€è¿‘åœ¨æ©Ÿå™¨å­¸ç¿’ï¼ˆmachine learningï¼‰å’Œæ•¸æ“šæ¢å‹˜ï¼ˆdata miningï¼‰é ˜åŸŸä¹Ÿå¾—åˆ°äº†å¾ˆå¥½çš„ç™¼å±•ã€‚åœ¨é†«å­¸ä¸Šï¼Œå»£æ³›åœ°æ‡‰ç”¨åœ¨ç–¾ç—…çš„è¨ºæ–·ï¼ŒåŒæ™‚ä¹Ÿè¢«æ‡‰ç”¨åœ¨æµè¡Œç—…å­¸ã€å¯¦è­‰é†«å­¸ç ”ç©¶ã€æ”¾å°„æŠ€è¡“ã€ç¤¾æœƒç§‘å­¸çš„ç ”ç©¶ä¸Šã€‚åœ¨è‡¨åºŠä¸Šå¯èƒ½æœƒé¢å°æª¢é©—æ–¹æ³•è¤‡é›œã€è€—æ™‚ã€æœ‰ä¾µå…¥æ€§ã€çµæœéœ€è¦æœ‰ç¶“é©—è€…æ‰èƒ½æº–ç¢ºåˆ¤è®€ç­‰å› ç´ ï¼Œè€Œåˆ©ç”¨ROCæ›²ç·šç™¼å±•å‡ºæ›´ç°¡æ˜“æ“ä½œçš„æ›¿ä»£æ–¹å¼ï¼Œä¸¦èˆ‡è‡¨åºŠèªå®šçš„é»ƒé‡‘æ¨™æº–(Gold standard)ä½œæ¯”è¼ƒï¼Œä¾‹å¦‚ä»¥ç™Œç—‡çš„åˆ‡ç‰‡æª¢æŸ¥ä½œç‚ºé»ƒé‡‘æ¨™æº–ï¼Œè©²æ¨™æº–å°‡ç—…äººåˆ¤å®šç‚ºç½¹ç™Œèˆ‡æœªç½¹ç™Œï¼Œä»¥é‘‘å®šæ–°çš„è¨ºæ–·å·¥å…·æ›¿ä»£é»ƒé‡‘æ¨™æº–çš„å¯è¡Œæ€§ã€‚</p><div class="note note-danger">            <ul><li>A <strong>receiver operating characteristic curve</strong>, or <strong>ROC curve</strong>, is a graphical plot that illustrates the <strong>performance of a binary classifier model</strong> (can be used for multi class classification as well) at <strong>varying threshold values</strong>.</li><li>The ROC curve is the plot of the <strong>true positive rate (TPR) against the false positive rate (FPR) at each threshold setting</strong>.</li></ul>          </div><p>Terminology,</p><ul><li>True positive (TP)</li><li>False positive (FP)</li><li>True negative (TN)</li><li>False negative (FN)</li><li>The <code>true-positive rate</code> (TPR) is also known as <strong>sensitivity</strong> or <strong>probability of detection</strong>.</li><li>The <code>false-positive rate</code> (FPR) is also known as the <strong>probability of false alarm</strong> and equals <strong>(1 âˆ’ specificity)</strong>.</li><li><code>ROC</code> is also known as a relative operating characteristic curve, because it is a comparison of two operating characteristics (TPR and FPR) as the criterion changes.</li></ul><p>åœ¨ä¿¡è™Ÿåµæ¸¬ç†è«–ä¸­ï¼ŒROCæ›²ç·šæ˜¯ä»¥åœ–åƒçš„æ–¹å¼<strong>å‘ˆç¾äºŒåˆ†é¡ç³»çµ±(binary classifier system)åœ¨ç‰¹å®šçš„åˆ†é¡æˆ–é–¾å€¼(discrimination threshold)ä¸‹çš„è¡¨ç¾</strong>ã€‚</p><ul><li>åœ–å½¢çš„ç¸±è»¸(y-axis)ç‚ºçœŸé™½æ€§ç‡(true positive rate; TPR)ï¼Œåˆç¨±ç‚ºæ•æ„Ÿåº¦(sensitivity)ï¼›</li><li>æ©«è»¸(x-axis)ç‚ºå½é™½æ€§ç‡(false-posiitive rate; FPR)ï¼Œä»¥1 â€“ ç‰¹ç•°åº¦(specificity)è¡¨ç¤ºï¼Œ</li></ul><p>è€Œæ•æ„Ÿåº¦ç‚ºå°‡çµæœæ­£ç¢ºåˆ¤æ–·ç‚ºé™½æ€§çš„æ©Ÿç‡ï¼Œç‰¹ç•°åº¦ä¿‚å°‡çµæœæ­£ç¢ºåˆ¤æ–·ç‚ºè² å‘æˆ–é™°æ€§çš„æ©Ÿç‡ã€‚ç•¶æŒ‡å®šä¸€å€‹åˆ†ç•Œé»(cut-point)ä¾†å€åˆ†æª¢é©—çš„é™½æ€§èˆ‡é™°æ€§æ™‚ï¼Œé€™å€‹åˆ†ç•Œé»æœƒå½±éŸ¿åˆ°è¨ºæ–·å·¥å…·çš„æ•æ„Ÿåº¦(sensitivity)åŠç‰¹ç•°åº¦(specificity)ã€‚åœ¨é†«å­¸ä¸Šï¼Œæ•æ„Ÿåº¦è¡¨ç¤ºæœ‰ç—…è€…è¢«åˆ¤ç‚ºé™½æ€§çš„æ©Ÿç‡ï¼Œè€Œç‰¹ç•°åº¦è¡¨ç¤ºç„¡ç—…è€…è¢«åˆ¤ç‚ºé™°æ€§çš„æ©Ÿç‡ã€‚åœ¨æ›²ç·šä¸Šçš„ä»»ä½•ä¸€å€‹é»éƒ½æœƒå°æ‡‰åˆ°ä¸€çµ„æ•æ„Ÿåº¦èˆ‡1-ç‰¹ç•°åº¦ï¼Œ<strong>è€Œæ•æ„Ÿåº¦èˆ‡ç‰¹ç•°åº¦æœƒå—åˆ°åˆ†ç•Œé»ç§»å‹•çš„å½±éŸ¿</strong>ã€‚</p><div class="note note-danger">            <p><strong>Each prediction result or instance of a confusion matrix represents one point in the ROC space.</strong></p>          </div><p>In the field of machine learning and specifically the problem of statistical classification, a <code>confusion matrix</code>, also known as <strong>error matrix</strong>.</p><div class="note note-danger">            <p><strong>By adjusting the threshold used by this classifier, we can get a curve passing through (0, 0) and (1, 1)</strong>. <em>This is the ROC curve of this classifier</em>.</p>          </div><h2 id="roc-curve-equation">ROC Curve Equation</h2><p>The ROC curve is based on two key metrics:</p><ul><li><p><strong>True Positive Rate (TPR)</strong>, also known as Sensitivity: <span class="math display">\[\text{TPR} = \frac{\text{True Positives (TP)}}{\text{True Positives (TP)} + \text{False Negatives (FN)}}\]</span></p></li><li><p><strong>False Positive Rate (FPR)</strong>: <span class="math display">\[\text{FPR} = \frac{\text{False Positives (FP)}}{\text{False Positives (FP)} + \text{True Negatives (TN)}}\]</span></p></li></ul><p>The ROC curve is a plot of TPR against FPR at various threshold settings. Each point on the ROC curve corresponds to a different threshold, showing the trade-off between sensitivity and specificity. The area under the ROC curve (AUC) quantifies the overall ability of the model to discriminate between positive and negative classes.</p><p><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/4/4f/ROC_curves.svg/1024px-ROC_curves.svg.png" alt="\hat{y} is model, y is actual value" width="600" /> <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/1/13/Roc_curve.svg/1024px-Roc_curve.svg.png" width="600" /></p><h1 id="auc-area-under-roc-curve">AUC (Area Under roc Curve)</h1><p>ä¸€èˆ¬æƒ…æ³ä¸‹ï¼Œé€™å€‹æ›²ç·šéƒ½æ‡‰è©²è™•æ–¼(0, 0)å’Œ(1, 1)é€£ç·šçš„ä¸Šæ–¹ã€‚å› ç‚º(0, 0)å’Œ(1, 1)é€£ç·šå½¢æˆçš„ROCæ›²ç·šå¯¦éš›ä¸Šä»£è¡¨çš„æ˜¯ä¸€å€‹éš¨æ©Ÿåˆ†é¡å™¨ã€‚å¦‚æœå¾ˆä¸å¹¸ï¼Œä½ å¾—åˆ°ä¸€å€‹ä½æ–¼æ­¤ç›´ç·šä¸‹æ–¹çš„åˆ†é¡å™¨çš„è©±ï¼Œ<strong>ä¸€å€‹ç›´è§€çš„è£œæ•‘è¾¦æ³•å°±æ˜¯æŠŠæ‰€æœ‰çš„é æ¸¬çµæœåå‘ï¼Œå³ï¼šåˆ†é¡å™¨è¼¸å‡ºçµæœç‚ºæ­£é¡ï¼Œå‰‡æœ€çµ‚åˆ†é¡çš„çµæœç‚ºè² é¡</strong>ï¼Œåä¹‹ï¼Œå‰‡ç‚ºæ­£é¡ã€‚é›–ç„¶ï¼Œç”¨ROC æ›²ç·šä¾†è¡¨ç¤ºåˆ†é¡å™¨çš„æ•ˆèƒ½å¾ˆç›´è¦ºå¥½ç”¨ã€‚å¯æ˜¯ï¼Œäººå€‘ç¸½æ˜¯å¸Œæœ›æœ‰ä¸€å€‹æ•¸å€¼ä¾†æ¨™ç¤ºåˆ†é¡å™¨çš„å¥½å£ã€‚æ–¼æ˜¯Area Under roc Curve(AUC)å°±å‡ºç¾äº†ã€‚é¡§åæ€ç¾©ï¼ŒAUCçš„å€¼å°±æ˜¯è™•æ–¼ROC æ›²ç·šä¸‹æ–¹çš„é‚£éƒ¨åˆ†é¢ç©çš„å¤§å°ã€‚é€šå¸¸ï¼ŒAUCçš„å€¼ä»‹æ–¼0.5åˆ°1.0ä¹‹é–“ï¼Œè¼ƒå¤§çš„AUCä»£è¡¨äº†è¼ƒå¥½çš„è¡¨ç¾ã€‚ AUCï¼ˆArea Under roc Curveï¼‰æ˜¯ç”¨ä¾†åº¦é‡åˆ†é¡æ¨¡å‹å¥½å£çš„ä¸€å€‹æ¨™æº–ã€‚</p><h1 id="roc-vs-pr">ROC vs PR</h1><p>The equations for the ROC (Receiver Operating Characteristic) curve and the PR (Precision-Recall) curve are derived from their respective metrics used to assess the performance of binary classifiers.</p><h2 id="pr-curve-equation">PR Curve Equation</h2><p>The PR curve focuses on two different metrics:</p><ul><li><p><strong>Precision</strong>: <span class="math display">\[\text{Precision} = \frac{\text{True Positives (TP)}}{\text{True Positives (TP)} + \text{False Positives (FP)}}\]</span></p></li><li><p><strong>Recall</strong> (which is equivalent to TPR): <span class="math display">\[\text{Recall} = \frac{\text{True Positives (TP)}}{\text{True Positives (TP)} + \text{False Negatives (FN)}}\]</span></p></li></ul><p>The PR curve is a plot of <strong>Precision against Recall</strong> at <strong>various thresholds</strong>. This curve is particularly useful in scenarios where the positive class is rare or when false positives are more critical than false negatives. The area under the PR curve (AUC-PR) provides a summary measure of the model's ability to maintain precision across different levels of recall.</p><p><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/2/26/Precisionrecall.svg/525px-Precisionrecall.svg.png" width="400" /></p><h2 id="summary">Summary</h2><p>In summary, both curves provide valuable insights into classifier performance, but they focus on different aspects: - The <strong>ROC curve</strong> evaluates the balance between sensitivity and specificity. - The <strong>PR curve</strong> emphasizes the trade-off between precision and recall, making it more suitable for imbalanced datasets.</p><p>The <strong>ROC (Receiver Operating Characteristic) curve</strong> and the <strong>Precision-Recall (PR) curve</strong> are both essential tools for evaluating the performance of binary classification models, but they serve different purposes and are suited to different scenarios. Here are the key differences:</p><h2 id="key-differences-between-roc-and-pr-curves">Key Differences Between ROC and PR Curves</h2><ol type="1"><li><strong>Focus on Class Distribution</strong>:<ul><li><strong>ROC Curve</strong>: This curve plots the True Positive Rate (TPR) against the False Positive Rate (FPR) across various threshold settings. <strong>It considers both positive and negative classes equally, making it suitable for balanced datasets where both classes are important</strong>.</li><li><strong>PR Curve</strong>: In contrast, the PR curve focuses specifically on the positive class by plotting Precision (the proportion of true positive predictions among all positive predictions) against Recall (the proportion of actual positives correctly identified). <strong>This makes it particularly useful in scenarios with imbalanced datasets</strong>, where the positive class is rare or more critical.</li></ul></li><li><strong>Interpretation of Metrics</strong>:<ul><li><strong>ROC Curve</strong>: The area under the ROC curve (AUC-ROC) provides a single measure of overall model performance, indicating how well the model distinguishes between classes regardless of their distribution[3][4].</li><li><strong>PR Curve</strong>: The area under the PR curve (AUC-PR) reflects the model's ability to maintain high precision while capturing as many true positives as possible. It is especially informative when false positives carry significant consequences, such as in fraud detection or medical diagnoses[2][6].</li></ul></li><li><strong>Performance Visualization</strong>:<ul><li><strong>ROC Curve</strong>: The ROC curve can sometimes present an overly optimistic view of a model's performance in highly imbalanced datasets because it accounts for true negatives that may not be relevant in such cases[1][3].</li><li><strong>PR Curve</strong>: The PR curve provides a clearer picture of performance when dealing with imbalanced classes, as it directly relates to the positive class's prediction quality without being influenced by the large number of true negatives[2][6].</li></ul></li><li><strong>Use Cases</strong>:<ul><li><strong>ROC Curve</strong>: Best used when you want to evaluate a model's performance across different thresholds in balanced datasets or when both classes are equally important. It is also useful for comparing multiple models[3][4].</li><li><strong>PR Curve</strong>: More appropriate for applications where the positive class is significantly less frequent than the negative class, such as in medical testing for rare diseases or fraud detection, where maximizing precision and recall for the minority class is crucial[1][2][3].</li></ul></li></ol><h2 id="conclusion">Conclusion</h2><p>In summary, while both ROC and PR curves are valuable for assessing binary classifiers, they cater to different needs based on class distribution and specific evaluation goals. <strong>ROC curves are ideal for balanced datasets</strong>, whereas <strong>PR curves excel in situations with significant class imbalance</strong>, providing deeper insights into model performance related to the positive class. Leveraging both curves can offer a comprehensive understanding of a model's strengths and weaknesses.</p><h2 id="æ·±å…¥ä»‹ç´¹åŠæ¯”è¼ƒrocæ›²ç·šåŠpræ›²ç·š"><a href="https://medium.com/nlp-tsupei/roc-pr-%E6%9B%B2%E7%B7%9A-f3faa2231b8c">æ·±å…¥ä»‹ç´¹åŠæ¯”è¼ƒROCæ›²ç·šåŠPRæ›²ç·š</a></h2><ul><li>ROC Curves é©åˆé¡åˆ¥å¹³å‡çš„æƒ…æ³ï¼Œè€Œ PR Curves é©åˆæ–¼é¡åˆ¥ä¸å¹³å‡çš„æƒ…æ³</li><li>AUC (Area under curve) å¯ä»¥ç•¶ä½œä¸€å€‹åˆ¤æ–·æ•´é«”æ¨¡å‹èƒ½åŠ›(skill)çš„æŒ‡æ¨™</li><li>å¯ä»¥ç›´æ¥æ¯”è¼ƒä¸åŒæ¨¡å‹åœ¨ä¸åŒThresholdä¸‹çš„Skill</li><li><strong>ROC æ›²ç·šåŒæ™‚è€ƒæ…®äº†æ­£ä¾‹ä»¥åŠè² ä¾‹</strong>ï¼Œå› æ­¤é©ç”¨æ–¼è©•ä¼°åˆ†é¡å™¨æ•´é«”çš„æ•ˆèƒ½ï¼Œ<strong>è€Œ PR æ›²ç·šå‰‡å°ˆæ³¨æ–¼æ­£ä¾‹</strong>ï¼Œè‹¥æ˜¯åœ¨é¡åˆ¥å¹³å‡ä¸”æ­£ä¾‹åŠè² ä¾‹çš„åˆ¤æ–·éƒ½é‡è¦çš„æƒ…æ³ä¸‹ï¼ŒROC æ›²ç·šæ˜¯ä¸éŒ¯çš„é¸æ“‡</li><li>ç”±æ–¼ ROC æ›²ç·šçš„ X è»¸ä½¿ç”¨åˆ°äº† FPRï¼Œåœ¨é¡åˆ¥ä¸å¹³å‡çš„æƒ…æ³ä¸‹(è² æ¨£æœ¬è¼ƒå¤š)ï¼Œä½¿å¾— FPR çš„å¢é•·æœƒè¢«ç¨€é‡‹ï¼Œæœƒå°è‡´ ROC æ›²ç·šå‘ˆç¾å‡ºéåº¦æ¨‚è§€çš„çµæœï¼Œå› æ­¤åœ¨é¡åˆ¥ä¸å¹³å‡çš„æƒ…æ³ä¸‹ï¼ŒPR æ›²ç·šæœƒæ˜¯è¼ƒå¥½çš„é¸æ“‡</li></ul><h1 id="åœ–è§£-roc-æ›²ç·šç²¾é€š-roc-èˆ‡-auc-ç”¨æ³•è¼•é¬†è¨˜ç†Ÿå®šç¾©"><a href="https://haosquare.com/roc-curve/">åœ–è§£ ROC æ›²ç·šï¼šç²¾é€š ROC èˆ‡ AUC ç”¨æ³•ã€è¼•é¬†è¨˜ç†Ÿå®šç¾©</a></h1><ul><li>åˆ†é¡æ¨¡å‹åªæœƒè¼¸å‡ºæ©Ÿç‡ï¼Œä¸æœƒçœŸçš„å¹«ä½ ã€Œåˆ†é¡ã€</li><li>åœ¨æ©Ÿå™¨å­¸ç¿’é ˜åŸŸçš„åˆ†é¡å•é¡Œï¼Œæˆ‘å€‘é€šå¸¸æœƒæŠŠåˆ†ææ¨¡å‹ç¨±ç‚ºåˆ†é¡å™¨ï¼ˆClassifierï¼‰ï¼Œå¥½åƒæ¨¡å‹æœƒå¹«æˆ‘å€‘åšå¥½åˆ†é¡ä¸€æ¨£ï¼Œä½†å¯¦éš›ä¸Šä¸æ˜¯å¦‚æ­¤ï¼ä¸è«–æ˜¯ è²æ°åˆ†é¡å™¨ã€æˆ–è€…ç¾…å‰æ–¯å›æ­¸ï¼Œ<strong>çµ±è¨ˆæ¨¡å‹åªè² è²¬è¼¸å‡ºæ©Ÿç‡ï¼Œæœ€å¾Œè¦æ€éº¼åˆ†é¡æ˜¯æ±ºç­–è€…çš„è·è²¬</strong>ã€‚èªæ¸…é€™é»ï¼Œå°±èƒ½ç†è§£ ROC æ›²ç·šçš„åƒ¹å€¼äº†ã€‚</li><li>å°æ–¼ä¸åŒè³‡æ–™ä½¿ç”¨å ´æ™¯ï¼Œæ±ºç­–çš„é–¾å€¼ï¼ˆThreshold æˆ–è€… Cut-offï¼‰â€”ä¹Ÿå°±æ˜¯æ©Ÿç‡é–€æª»å€¼â€”å°‡æœƒä¸åŒï¼Œ<strong>ROC æ›²ç·šçš„æ ¸å¿ƒç›®æ¨™æ­£æ˜¯è¦å‘ˆç¾ä¸åŒé–¾å€¼æœƒå°ä½ çš„æ±ºç­–å“è³ªé€ æˆä»€éº¼å½±éŸ¿</strong>ã€‚</li><li>ï¼ˆè£œå……ï¼šæ­£è² æ¨£æœ¬æ˜¯é‡å°äºŒåˆ†é¡å•é¡Œçš„çœŸå¯¦è³‡æ–™è€Œè¨€ï¼Œæ­£æ¨£æœ¬çš„æ„æ€æ˜¯çœŸå¯¦ç­”æ¡ˆç‚ºæ­£å‘ï¼›ä¾‹å¦‚çœŸå¯¦è³‡æ–™é¡¯ç¤ºæœ‰ä¸‹é›¨ï¼›åä¹‹ç‚ºè² æ¨£æœ¬ï¼Œä¾‹å¦‚è³‡æ–™é¡¯ç¤ºå¯¦éš›ä¸Šæ²’æœ‰ä¸‹é›¨ï¼‰</li><li>ä»¥ä¸Šå…©æ•¸æ“šéƒ½æ˜¯åŸºæ–¼ã€Œæ±ºç­–è€…é æ¸¬çµæœç‚ºæ­£æ¨£æœ¬ã€</li><li>æˆ‘å€‘ä½œç‚ºæ±ºç­–è€…ç•¶ç„¶åªåœ¨ä¹é æ¸¬ç‚ºæ­£æ¨£æœ¬çš„æƒ…å½¢ï¼</li><li>é€™å‰‡ç­†è¨˜å‰é¢å¼·èª¿éåˆ†é¡æ¨¡å‹åªæœƒè¼¸å‡ºæ©Ÿç‡ï¼Œä¸æœƒçœŸçš„å¹«ä½ åˆ†é¡ï¼Œè€Œåˆ†é¡çš„æ±ºç­–åˆå–æ±ºæ–¼é–¾å€¼ï¼ˆæ©Ÿç‡çš„é–€æª»å€¼ï¼‰ï¼ŒROC æ›²ç·šçš„ç›®æ¨™æ˜¯è¦å‘ˆç¾ä¸åŒé–¾å€¼æœƒé€ æˆä»€éº¼ä¸åŒçš„æ±ºç­–å“è³ªã€‚</li><li>å¯¦éš›ä¸Šï¼ŒAUC é™¤äº†åœ¨åœ–å½¢ä¸Šä»£è¡¨é¢ç©ï¼Œå…¶æ•¸æ“šäº¦å­˜åœ¨æ•¸å­¸æ„ç¾©ï¼šAUC ä»£è¡¨éš¨æ©Ÿä¸€å€‹ï¼ˆç­”æ¡ˆç‚ºï¼‰æ­£æ¨£æœ¬è¢«é æ¸¬å‡ºçš„åˆ†æ•¸é«˜æ–¼éš¨æ©Ÿä¸€å€‹ï¼ˆç­”æ¡ˆç‚ºï¼‰è² æ¨£æœ¬çš„æ©Ÿç‡ã€‚æ›´å›‰å”†åœ°è§£é‡‹ï¼šå…ˆéš¨æ©Ÿé¸ä¸€å€‹å·²çŸ¥ç­”æ¡ˆç‚ºæ­£çš„æ¨£æœ¬ï¼Œå†éš¨æ©Ÿé¸ä¸€å€‹å·²çŸ¥ç­”æ¡ˆç‚ºè² çš„æ¨£æœ¬ï¼ŒAUC ä»£è¡¨åˆ†é¡å™¨é æ¸¬æ­¤æ­£æ¨£æœ¬æ¯”æ­¤è² æ¨£æœ¬æ›´å¯èƒ½ç‚ºæ­£æ¨£æœ¬çš„æ©Ÿç‡ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒAUC çš„æ­¤æ•¸å­¸æ„ç¾©åŒæ¨£èˆ‡é–¾å€¼ç„¡é—œã€ä¸å—é–¾å€¼é¸æ“‡é™åˆ¶å–”ï¼</li><li>ä¸€æ¢ ROC æ›²ç·šï¼šå–®ä¸€å€‹åˆ†é¡å™¨æ¯”è¼ƒä¸åŒé–¾å€¼çš„æˆæ•ˆ</li><li>å¤šæ¢ ROC æ›²ç·šï¼šç”¨ AUC æ¯”è¼ƒå¤šå€‹åˆ†é¡å™¨æ•´é«”è¡¨ç¾</li></ul><h1 id="references">References</h1><ol type="1"><li><a href="https://en.wikipedia.org/wiki/Receiver_operating_characteristic">ROC</a></li><li><a href="https://estat.pixnet.net/blog/post/61795603">ROCæ›²ç·š (Receiver Operating Characteristic Curve)</a></li><li><a href="https://sub.daais.sinica.edu.tw/download/jriaaward/34.pdf">ç–¾ç—…ç¯©æª¢è¨ºæ–·å·¥å…·ä¹‹è©•ä¼°ï¼šå¾ROC æ›²ç·šåˆ° Lorenz æ›²ç·šåˆ° Kullback-Leibler è·é›¢</a></li><li><a href="https://medium.com/nlp-tsupei/roc-pr-%E6%9B%B2%E7%B7%9A-f3faa2231b8c">æ·±å…¥ä»‹ç´¹åŠæ¯”è¼ƒROCæ›²ç·šåŠPRæ›²ç·š</a></li><li><a href="https://haosquare.com/roc-curve/">(<strong>æ¨è–¦</strong>)| åœ–è§£ ROC æ›²ç·šï¼šç²¾é€š ROC èˆ‡ AUC ç”¨æ³•ã€è¼•é¬†è¨˜ç†Ÿå®šç¾©</a></li><li><a href="https://haosquare.com/roc-curve-best-cutoff/">ROC æ›²ç·šä¸Šçš„æœ€ä½³é–¾å€¼ï¼šYouden Index èˆ‡åœ–è§£æ³•ä»‹ç´¹</a></li><li><a href="https://cloud.tencent.com/developer/article/1747389">ä»€ä¹ˆæ˜¯ROCæ›²çº¿ï¼Ÿä¸ºä»€ä¹ˆè¦ä½¿ç”¨ROC?ä»¥åŠ AUCçš„è®¡ç®—</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>Maths</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NWP</tag>
      
      <tag>AI</tag>
      
      <tag>ML</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MPAS | Smagorinsky turbulence model | Eddy viscosity</title>
    <link href="/2024/12/10/MPAS-eddy-viscosity-in-the-Smagorinsky-turbulence-model/"/>
    <url>/2024/12/10/MPAS-eddy-viscosity-in-the-Smagorinsky-turbulence-model/</url>
    
    <content type="html"><![CDATA[<h1 id="large-eddy-simulation-les">Large eddy simulation (LES)</h1><p>Large eddy simulation (LES) is a mathematical model for turbulence used in computational fluid dynamics. It was initially proposed in <strong>1963 by Joseph Smagorinsky to simulate atmospheric air currents</strong>, and <strong>first explored by Deardorff (1970)</strong>. LES is currently applied in a wide variety of engineering applications, including combustion,acoustics, and simulations of the atmospheric boundary layer.</p><p>The principal idea behind LES is to reduce the computational cost by ignoring the smallest length scales, which are the most computationally expensive to resolve, via low-pass filtering of the Navierâ€“Stokes equations. Such a low-pass filtering, which can be viewed as a time- and spatial-averaging, effectively removes small-scale information from the numerical solution. This information is not irrelevant, however, and its effect on the flow field must be modelled, a task which is an active area of research for problems in which small-scales can play an important role.</p><h1 id="smagorinskylilly-model">Smagorinskyâ€“Lilly model</h1><p>The first sub-grid scales (SGS) model developed was the <strong>Smagorinskyâ€“Lilly SGS model</strong>, which was developed by Joseph Smagorinsky and used in the first LES simulation by Deardorff. It models the eddy viscosity as:</p><p><span class="math display">\[\nu_\mathrm{t} = C \Delta^2\sqrt{2\bar{S}_{ij}\bar{S}_{ij}} = C \Delta^2 \left| \bar{S} \right|\]</span></p><p>where <span class="math inline">\(\Delta\)</span> is the grid size and <span class="math inline">\(C\)</span> is a constant.</p><p>This method assumes that the energy production and dissipation of the small scales are in equilibrium - that is, <span class="math inline">\(\epsilon\)</span>, the dissipation of kinetic energy.</p><h1 id="mpas-a">MPAS-A</h1><ol type="1"><li>Only horizontal mixing.</li></ol><ul><li><code>MPAS-Model/src/core_atmosphere/Registry.xml</code>,</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">nml_option</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;config_horiz_mixing&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;character&quot;</span> <span class="hljs-attr">default_value</span>=<span class="hljs-string">&quot;2d_smagorinsky&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">units</span>=<span class="hljs-string">&quot;-&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">description</span>=<span class="hljs-string">&quot;Formulation of horizontal mixing&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">possible_values</span>=<span class="hljs-string">&quot;`2d_fixed&#x27; or `2d_smagorinsky&#x27;&quot;</span>/&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">nml_option</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;config_len_disp&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;real&quot;</span> <span class="hljs-attr">default_value</span>=<span class="hljs-string">&quot;0.0&quot;</span> <span class="hljs-attr">in_defaults</span>=<span class="hljs-string">&quot;false&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">units</span>=<span class="hljs-string">&quot;m&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">description</span>=<span class="hljs-string">&quot;Horizontal length scale, used by the Smagorinsky formulation of horizontal diffusion and by 3-d divergence damping&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">possible_values</span>=<span class="hljs-string">&quot;Positive real values. A zero value implies that the length scale is prescribed by the nominalMinDc value in the input file.&quot;</span>/&gt;</span><br><br><br><span class="hljs-tag">&lt;<span class="hljs-name">nml_option</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;config_smagorinsky_coef&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;real&quot;</span> <span class="hljs-attr">default_value</span>=<span class="hljs-string">&quot;0.125&quot;</span> <span class="hljs-attr">in_defaults</span>=<span class="hljs-string">&quot;false&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">units</span>=<span class="hljs-string">&quot;-&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">description</span>=<span class="hljs-string">&quot;Dimensionless empirical parameter relating the strain tensor to the eddy viscosity in the Smagorinsky turbulence model&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">possible_values</span>=<span class="hljs-string">&quot;Real values typically in the range 0.1 to 0.4&quot;</span>/&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">var</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;kdiff&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;real&quot;</span> <span class="hljs-attr">dimensions</span>=<span class="hljs-string">&quot;nVertLevels nCells Time&quot;</span> <span class="hljs-attr">units</span>=<span class="hljs-string">&quot;m^2 s^&#123;-1&#125;&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">description</span>=<span class="hljs-string">&quot;Smagorinsky horizontal eddy viscosity&quot;</span>/&gt;</span><br></code></pre></td></tr></table></figure><ul><li><code>MPAS-Model/src/core_atmosphere/dynamics/mpas_atm_time_integration.F</code>,</li></ul><figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs Fortran">   <span class="hljs-comment">! Output: tend - tendencies: tend_u, tend_w, tend_theta and tend_rho</span><br>   <span class="hljs-comment">!                these are all coupled-variable tendencies.</span><br>   <span class="hljs-comment">!         various other quantities in diag: Smagorinsky eddy viscosity</span><br>......<br>   <span class="hljs-keyword">call</span> mpas_pool_get_config(configs, <span class="hljs-string">&#x27;config_smagorinsky_coef&#x27;</span>, c_s)<br>......<br><br>         <span class="hljs-comment">! Smagorinsky eddy viscosity, based on horizontal deformation (in this case on model coordinate surfaces).</span><br>         <span class="hljs-comment">! The integration coefficients were precomputed and stored in defc_a and defc_b</span><br><br>         <span class="hljs-keyword">if</span>(config_horiz_mixing == <span class="hljs-string">&quot;2d_smagorinsky&quot;</span>) <span class="hljs-keyword">then</span><br>            <span class="hljs-keyword">do</span> iCell = cellStart,cellEnd<br>               d_diag(<span class="hljs-number">1</span>:nVertLevels) = <span class="hljs-number">0.0</span><br>               d_off_diag(<span class="hljs-number">1</span>:nVertLevels) = <span class="hljs-number">0.0</span><br>               <span class="hljs-keyword">do</span> iEdge=<span class="hljs-number">1</span>,nEdgesOnCell(iCell)<br>                  <span class="hljs-keyword">do</span> k=<span class="hljs-number">1</span>,nVertLevels<br>                     d_diag(k)     = d_diag(k)     + defc_a(iEdge,iCell)*u(k,EdgesOnCell(iEdge,iCell))  &amp;<br>                                                   - defc_b(iEdge,iCell)*v(k,EdgesOnCell(iEdge,iCell))<br>                     d_off_diag(k) = d_off_diag(k) + defc_b(iEdge,iCell)*u(k,EdgesOnCell(iEdge,iCell))  &amp;<br>                                                   + defc_a(iEdge,iCell)*v(k,EdgesOnCell(iEdge,iCell))<br>                  <span class="hljs-keyword">end</span> <span class="hljs-keyword">do</span><br>               <span class="hljs-keyword">end</span> <span class="hljs-keyword">do</span><br><span class="hljs-comment">!DIR$ IVDEP</span><br>               <span class="hljs-keyword">do</span> k=<span class="hljs-number">1</span>, nVertLevels<br>                  <span class="hljs-comment">! here is the Smagorinsky formulation, </span><br>                  <span class="hljs-comment">! followed by imposition of an upper bound on the eddy viscosity</span><br>                  kdiff(k,iCell) = <span class="hljs-built_in">min</span>((c_s * config_len_disp)**<span class="hljs-number">2</span> * <span class="hljs-built_in">sqrt</span>(d_diag(k)**<span class="hljs-number">2</span> + d_off_diag(k)**<span class="hljs-number">2</span>),(<span class="hljs-number">0.01</span>*config_len_disp**<span class="hljs-number">2</span>) * invDt)<br>               <span class="hljs-keyword">end</span> <span class="hljs-keyword">do</span><br>            <span class="hljs-keyword">end</span> <span class="hljs-keyword">do</span><br><br>            h_mom_eddy_visc4   = config_visc4_2dsmag * config_len_disp**<span class="hljs-number">3</span><br>            h_theta_eddy_visc4 = h_mom_eddy_visc4<br><br>         <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(config_horiz_mixing == <span class="hljs-string">&quot;2d_fixed&quot;</span>) <span class="hljs-keyword">then</span><br><br>            kdiff(<span class="hljs-number">1</span>:nVertLevels,cellStart:cellEnd) = config_h_theta_eddy_visc2<br>            h_mom_eddy_visc4 = config_h_mom_eddy_visc4<br>            h_theta_eddy_visc4 = config_h_theta_eddy_visc4<br><br>         <span class="hljs-keyword">end</span> <span class="hljs-keyword">if</span><br>......<br></code></pre></td></tr></table></figure><h1 id="wrf">WRF</h1><ol type="1"><li>sub-grid turbulence (constant K diffusion/ 2-D Smagorinsky/ predicted TKE /2-D, 6th order diffusion / Nonlinear Backscatter Anisotropic (NBA) sub-grid turbulence stress for LES )</li></ol><ul><li><code>run/README.namelist</code>, <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs namelist">km_opt(max_dom) = 1,! eddy coefficient option<br>                1 = constant (use khdif kvdif)<br>                2 = 1.5 order TKE closure (3D)<br>                3 = Smagorinsky first order closure (3D)<br>                    Note: option 2 and 3 are not recommended for DX &gt; 2 km<br>                4 = horizontal Smagorinsky first order closure<br>                    (recommended for real-data cases)<br>c_s (max_dom) = 0.25     ! Smagorinsky coeff<br></code></pre></td></tr></table></figure></li></ul><h2 id="wrf-les">WRF-LES</h2><p>WRF provides a capability for ideal LES simulation. Please take a look at the WRF/test/em_les/README.les to get some idea how it works. Note that real-data LES simulation could be more complicated.</p><ul><li><code>WRF/test/em_real/namelist.input.pbl-les</code>,</li><li><code>WRF/test/em_les/README.les</code> --&gt; The ideal em_les test case</li></ul><ol type="1"><li><a href="https://www2.mmm.ucar.edu/wrf/users/tutorial/presentation_pdfs/202101/dudhia_physics_pbl_turbulence.pdf">(<strong>Important</strong>) | Overview of WRF Physics Boundary Layer and Turbulence | 2021Jimy Dudhia NCAR/MMM</a><ol type="1"><li>P.26-</li><li>For grid sizes of up to about 100 m, LES is preferable</li><li>LES treats turbulence three-dimensionally instead of separate vertical (PBL) and horizontal diffusion schemes</li></ol></li></ol><h1 id="references">References</h1><ol type="1"><li>Skamarock, W. C., Klemp, J. B., Duda, M. G., Fowler, L. D., Park, S., &amp; Ringler, T. D. (2012). A Multiscale Nonhydrostatic Atmospheric Model Using Centroidal Voronoi Tesselations and C-Grid Staggering. Monthly Weather Review, 140(9), 3090-3105. <a href="https://doi.org/10.1175/MWR-D-11-00215.1" class="uri">https://doi.org/10.1175/MWR-D-11-00215.1</a><ol type="1"><li>The horizontal filtering formulation of Smagorinsky (1963) uses the second-order Laplacians along with an eddy viscosity</li></ol></li></ol>]]></content>
    
    
    <categories>
      
      <category>MPAS</category>
      
    </categories>
    
    
    <tags>
      
      <tag>HPC</tag>
      
      <tag>NWP</tag>
      
      <tag>WRF</tag>
      
      <tag>MPAS</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>WRF | MPAS | MPI | halo/ghost cell</title>
    <link href="/2024/12/07/wrf-mpas-MPI-halocell-ghostcell/"/>
    <url>/2024/12/07/wrf-mpas-MPI-halocell-ghostcell/</url>
    
    <content type="html"><![CDATA[<h1 id="message-passing-interface-mpi">Message Passing Interface (MPI)</h1><p>è¨Šæ¯å‚³éä»‹é¢ï¼ˆMessage Passing Interfaceï¼Œç¸®å¯«MPIï¼‰æ˜¯ä¸€å€‹å¹³è¡Œè¨ˆç®—çš„æ‡‰ç”¨ç¨‹å¼ä»‹é¢ï¼ˆAPIï¼‰ï¼Œå¸¸åœ¨è¶…ç´šé›»è…¦ã€é›»è…¦å¢é›†ç­‰<strong>éå…±ç”¨ä¸»è¨˜æ†¶é«”ç’°å¢ƒ</strong>ç¨‹å¼è¨­è¨ˆã€‚</p><p>The message passing interface effort began in the summer of <strong>1991</strong> when a small group of researchers started discussions at a mountain retreat in Austria. Out of that discussion came a Workshop on Standards for Message Passing in a <strong>Distributed Memory Environment</strong>, held on April 29â€“30, <strong>1992</strong> in Williamsburg, Virginia.</p><p>MPI is a communication protocol for programming parallel computers.</p><h1 id="numerical-approach">Numerical Approach</h1><h2 id="the-problem-diffusion-in-a-two-dimensional-domain">The problem: diffusion in a two-dimensional domain</h2><p><span class="math display">\[\frac{\partial{u}}{\partial{t}} = D\left(\frac{\partial^2{u}}{\partial{x^2}} + \frac{\partial^2{u}}{\partial{y^2}}\right) \tag{1}\]</span></p><p>and apply the finite difference mehtod and above equation is expressed as,</p><p><span class="math display">\[ \frac{u_{i,k}^{j+1} - 2u_{i,k}^{j}}{\Delta t} = D \left(\frac{u_{i+1,k}^j-2u_{i,k}^j+u_{i-1,k}^j}{\Delta x^2}+ \frac{u_{i,k+1}^j-2u_{i,k}^j+u_{i,k-1}^j}{\Delta y^2}\right)\tag{2}\]</span></p><p>Equation (2) is really all is needed in order to find the solution across the whole domain at each subsequent time step. It is rather easy to implement a code that does this sequentially, with one process (CPU). <strong>However, here we want to discuss a parallel implementation that uses multiple processes</strong>.</p><p><img src="https://i.imgur.com/EIfd3nA.png" width="400" /></p><h2 id="use-mutiple-cores-mpi">Use mutiple cores, MPI,</h2><p>It shows how processes #0 and #1 will need to communicate in order to evaluate the solution near the boundary. This is where MPI enters. In the next section, we are going to look at an efficient way of communicating.</p><ul><li>Two neighboring processes need to communicate in order to find the solution near the boundary. Process #0 needs to know the value of the solution in B in order to calculate the solution at the grid point A. Similarly, process #1 needs to know the value at point C in order to calculate the solution at the grid point D. These values are unknown by the processes, until communication between processes #0 and #1 occurs.</li></ul><p><img src="https://i.imgur.com/gwauub0.png" width="400" /></p><h2 id="communication-among-processes-ghost-cells">Communication among processes: ghost cells</h2><p>Halo cells/ghost cells are additional grid points added around the edges of the computational domain to extend the grid beyond the physical boundaries of the model. They are crucial for ensuring that calculations at the boundaries can utilize information from adjacent grid points, which may not be directly part of the simulation domain.</p><p><img src="https://i.imgur.com/5b51gg2.png" width="400" /></p><figure><img src="https://i.imgur.com/SLlYNCN.png" alt="Non-uniform grid (top figure) decomposed into two uniform grids using a ghost cells generated for the data exchange (bottom figure)(from [35]). (from PeroviÄ‡, N., Frisch, J., Salama, A., Sun, S., Rank, E., &amp; Mundani, R. P. (2017). Multi-scale high-performance fluid flow: Simulations through porous media. Advances in Engineering Software, 103, 85-98.)" width="600" /><figcaption>Non-uniform grid (top figure) decomposed into two uniform grids using a ghost cells generated for the data exchange (bottom figure)(from [35]). (from PeroviÄ‡, N., Frisch, J., Salama, A., Sun, S., Rank, E., &amp; Mundani, R. P. (2017). Multi-scale high-performance fluid flow: Simulations through porous media. Advances in Engineering Software, 103, 85-98.)</figcaption></figure><p>An important notion in computational fluid dynamics is the one of <strong>ghost cells</strong>. This concept is useful whenever the <strong>spatial domain is decomposed into multiple sub-domains</strong>, each of which is solved by one process.</p><p><strong>Here is the problem</strong>: it is very <strong>inefficient</strong> to have process #0 and process #1 <strong>communicate each time</strong> they need a node from the neighboring process: it would result in an <strong>unacceptable communication overhead</strong>.</p><p>Instead, what is common practice is to surround the â€œrealâ€ sub-domains with extra cells called <strong>ghost cells</strong>.</p><div class="note note-danger">            <p>These <strong>ghost cells</strong> represent <strong>copies</strong> of the solution at the boundaries of neighboring sub-domains.</p>          </div><p>At each time step, the old boundary of each sub-domain is passed to its neighbors. This allows the new solution at the boundary of a sub-domain to be calculated with a significantly reduced communication overhead. The net effect is a speedup in the code.</p><ul><li>Communication among processes without (left) and with (right) ghost cells. Without ghost cells, each cell on the boundary of a sub-domain needs to pass its own message to a neighboring process. <strong>Using ghost cells allows to minimize the number of messages passed</strong>, as many cells belonging to the boundaries of a process are exchanged at once with a single message. Here, for example, Process #0 is passing its entire North boundary to Process #1, and its entire East boundary to Process #2.</li></ul><p><img src="https://i.imgur.com/pYIM9km.png" width="500" /></p><h1 id="wrf">WRF</h1><h2 id="three-level-domain-decomposition-of-wrf">Three level domain decomposition of WRF</h2><p>The entire study area in the WRF is called a <strong>domain</strong>. The subdomain obtained by dividing the domain with processes is called a <strong>patch</strong>, <em>a process known as domain decomposition</em>. The subdomains are assigned to each process. The patch can also be subdivided into <strong>tiles</strong>, <em>a process known as tile division</em>.</p><p><img src="https://i.imgur.com/XgaxGpW.png" width="400" /></p><p>WRF uses</p><ul><li><code>nproc_x</code> to denote the <em>number of processes</em> in the <strong>eastâ€“west direction</strong> of the domain and</li><li><code>nproc_y</code> to denote the <em>number of processes</em> in the <strong>northâ€“south</strong> direction of the domain.</li></ul><p>The domain decomposition should follow the following condition:</p><p><span class="math display">\[\mbox{n} = \mbox{nproc}_x \times \mbox{nproc}_y\tag{3}\]</span></p><p><img src="https://i.imgur.com/SqQhBMB.png" width="500" /></p><h3 id="performance-analysis-and-optimizations-of-the-weather-research-and-forecasting-wrf-model-2018"><a href="https://www.cisl.ucar.edu/sites/default/files/2021-09/Dixit_Patel_Presentation.pdf">Performance Analysis and Optimizations of the Weather Research and Forecasting (WRF) Model | 2018</a></h3><ul><li><strong>Intel</strong> 18.0.1 + SGI MPT 2.18 gives best performance</li><li><strong>Compiler Optimizations</strong><ul><li>GNU : <code>-ofast</code></li><li>Intel : <code>-xHost -fp-model fast =2</code></li></ul></li><li><strong>Hyperthreaded runs lowered model performance</strong></li></ul><div class="group-image-container"><div class="group-image-row"><div class="group-image-wrap"><img src="https://i.imgur.com/jNWRgGL.png" alt="1" /></div><div class="group-image-wrap"><img src="https://i.imgur.com/QH6rJCB.png" alt="2" /></div></div><div class="group-image-row"><div class="group-image-wrap"><img src="https://i.imgur.com/QsOLIMW.png" alt="3" /></div><div class="group-image-wrap"><img src="https://i.imgur.com/EG86Edj.png" alt="4" /></div></div></div><ul><li>Scalability Summary</li></ul><p><img src="https://i.imgur.com/82xzzGC.png" width="600" /></p><h3 id="tutorial-notes-wrf-software-2.1"><a href="http://danida.vnu.edu.vn/cpis/files/Refs/WRF/WRF%20Software.pdf">Tutorial Notes: WRF Software 2.1</a></h3><ul><li>WRF can be run serially or as a parallel job</li><li>WRF uses <strong>domain decomposition</strong> to divide total amount of work over parallel processes â€¢ Since the process model has two levels (heavy-weight and light-weight = MPI and OpenMP), the decomposition of the application over processes has two levels:<ul><li>The <strong>domain</strong> is first broken up into rectangular pieces that are assigned to heavy-weight processes. These pieces are called <strong>patches</strong></li><li>The <strong>patches</strong> may be further subdivided into smaller rectangular pieces that are called <strong>tiles</strong>, and these are assigned to <strong>threads</strong> within the process.</li></ul></li><li>Model domains are decomposed for parallelism on two-levels<ul><li><strong>Patch</strong>: section of model domain a located to a <strong>distributed memory node</strong>, this is the scope of a mediation layer solver or physics driver.</li><li><strong>Tile</strong>: section of a patch allocated to a <strong>shared-memory processor</strong> within a node; this is also the scope of a model layer subroutine.</li><li>Distributed memory parallelism is over patches; shared memory parallelism is over tiles within patches</li></ul></li></ul><h1 id="mpas">MPAS</h1><h2 id="an-overview-of-the-structure-of-mpas-meshes-boulder2023"><a href="https://www2.mmm.ucar.edu/projects/mpas/tutorial/Boulder2023/lectures/mesh_structure.pdf">An overview of the structure of MPAS meshes | Boulder2023</a></h2><p><img src="https://i.imgur.com/SsGuRLq.png" width="600" /> <img src="https://i.imgur.com/PpBWRMb.png" width="600" /> <img src="https://i.imgur.com/SsaBchP.png" width="600" /> <img src="https://i.imgur.com/raumO6Y.png" width="600" /> <img src="https://i.imgur.com/S6VjTov.png" width="600" /></p><h1 id="references">References</h1><ol type="1"><li><a href="http://www.claudiobellei.com/2018/09/30/julia-mpi/">Parallel programming with Julia using MPI</a></li><li><a href="https://www.iue.tuwien.ac.at/phd/quell/Hierarchical-Grids.html">Chapter 2â€ƒHierarchical Grids</a></li><li>PeroviÄ‡, N., Frisch, J., Salama, A., Sun, S., Rank, E., &amp; Mundani, R. P. (2017). <strong>Multi-scale high-performance fluid flow: Simulations through porous media</strong>. Advances in Engineering Software, 103, 85-98.</li><li>Huang, J., Wang, W., Wang, Y., Jiang, J., Yan, C., Zhao, L., &amp; Bai, Y. (2023). <strong>Performance Evaluation and Optimization of the Weather Research and Forecasting (WRF) Model Based on Kunpeng 920</strong>. Applied Sciences, 13(17), 9800. <a href="https://doi.org/10.3390/app13179800" class="uri">https://doi.org/10.3390/app13179800</a></li><li><a href="https://www.cisl.ucar.edu/sites/default/files/2021-09/Dixit_Patel_Presentation.pdf">Performance Analysis and Optimizations of the Weather Research and Forecasting (WRF) Model | 2018</a><ol type="1"><li><strong>Intel</strong> 18.0.1 + SGI MPT 2.18 gives best performance</li></ol></li><li><a href="https://www2.mmm.ucar.edu/projects/mpas/tutorial/Boulder2023/agenda.html">MPAS-A Tutorial Agenda | Boulder2023</a><ol type="1"><li><a href="https://www2.mmm.ucar.edu/projects/mpas/tutorial/Boulder2023/lectures/mesh_structure.pdf">An overview of the structure of MPAS meshes</a></li></ol></li><li><a href="https://www.tropmet.res.in/introspect/presentation/13feb/skamarock_20170213.pdf">MPAS | skamarock_20170213</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>WRF</category>
      
    </categories>
    
    
    <tags>
      
      <tag>HPC</tag>
      
      <tag>NWP</tag>
      
      <tag>WRF</tag>
      
      <tag>MPAS</tag>
      
      <tag>MPI</tag>
      
      <tag>halo cell</tag>
      
      <tag>ghost cell</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MPAS | MPAS-A Idealized Test Cases</title>
    <link href="/2024/12/06/MPAS-A-Idealized-Test-Cases/"/>
    <url>/2024/12/06/MPAS-A-Idealized-Test-Cases/</url>
    
    <content type="html"><![CDATA[<h1 id="mpas-atmosphere-idealized-test-cases">MPAS-Atmosphere idealized test cases</h1><div class="note note-danger">            <ul><li><strong><a href="https://mpas-dev.github.io/atmosphere/test_cases.html" class="uri">https://mpas-dev.github.io/atmosphere/test_cases.html</a></strong></li></ul>          </div><p>The downloads below for MPAS-Atmosphere idealized test cases include the following:</p><ul><li>an MPAS mesh file to be used with the test case;</li><li>for 3-d test cases, mesh decomposition files for several MPI task counts;</li><li>a <strong>namelist file for creating initial conditions</strong> for the test case;</li><li>a <strong>namelist file for running the model</strong>; and</li><li><strong>NCL scripts</strong> for making plots of the output.</li></ul><p>The process of generating initial conditions and running each test case is described in further detail in the MPAS-Atmosphere Users' Guide.</p><h2 id="test-cases-on-the-sphere">Test cases on the sphere</h2><h3 id="the-jablonowski-and-williamson-baroclinic-wave-test-case.">The Jablonowski and Williamson baroclinic wave test case.</h3><div class="note note-danger">            <p><strong>Jablonowski, C., &amp; Williamson, D. L. (2006). A baroclinic instability test case for atmospheric model dynamical cores. Quarterly Journal of the Royal Meteorological Society, 132(621C), 2943â€“2975. <a href="https://doi.org/10.1256/qj.06.12" class="uri">https://doi.org/10.1256/qj.06.12</a></strong></p>          </div><ul><li>The dynamical core is initialized with steady-state, balanced initial conditions that are an analytic solution to the hydrostatic primitive equations. <strong>This model set-up reveals how well a dynamical core maintains this initial state</strong> before numerical round-off and truncation errors as well as gravity waves degrade the steady state.</li></ul><p><img src="https://i.imgur.com/Cu4feVO.png" width="400" /> <img src="https://i.imgur.com/luYcZPl.png" width="400" /></p><p>Steps to run this test case:</p><ol type="1"><li><strong>Link</strong> the <code>init_atmosphere_model</code> and <code>atmosphere_model</code> executables from the top-level MPAS directory.</li><li>Run <code>init_atmosphere_model</code> to create initial conditions.<ol type="1"><li>The log file may show WARNING messages; these can generally be ignored.</li></ol></li><li>Run <code>atmosphere_model</code></li><li>Run the <strong>bwave_surface_p.ncl</strong> script to produce <strong>plots of surface pressure</strong> each simulated day.</li></ol><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs console">bwave_surface_p.ncl            x1.40962.graph.info.part.16<br>namelist.atmosphere            x1.40962.graph.info.part.2<br>namelist.init_atmosphere       x1.40962.graph.info.part.24<br>README                         x1.40962.graph.info.part.4<br>stream_list.atmosphere.output  x1.40962.graph.info.part.6<br>streams.atmosphere             x1.40962.graph.info.part.8<br>streams.init_atmosphere        x1.40962.grid.nc<br>x1.40962.graph.info.part.12<br></code></pre></td></tr></table></figure><p>and,</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs netcdf">netcdf x1.40962.init &#123;<br>dimensions:<br>nVertLevels = 26 ;<br>nCells = 40962 ;<br>Time = UNLIMITED ; // (1 currently)<br>StrLen = 64 ;<br>nEdges = 122880 ;<br>nVertices = 81920 ;<br>TWO = 2 ;<br>maxEdges = 10 ;<br>maxEdges2 = 20 ;<br>vertexDegree = 3 ;<br>R3 = 3 ;<br>nMonths = 12 ;<br>nSoilComps = 8 ;<br>FIFTEEN = 15 ;<br>nVertLevelsP1 = 27 ;<br>nSoilLevels = 4 ;<br></code></pre></td></tr></table></figure><p>Create a run.sh,</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/bash</span><br><span class="hljs-built_in">export</span> CODE_DIR=/home/wpsze/MPAS-A/mpasv822/MPASv822/<br><span class="hljs-built_in">export</span> MPAS_ENV=/home/wpsze/MPAS-A/mpas_env.sh<br><span class="hljs-built_in">source</span> <span class="hljs-variable">$&#123;MPAS_ENV&#125;</span><br><span class="hljs-built_in">source</span> /home/wpsze/micromamba/etc/profile.d/micromamba.sh<br>micromamba activate mpas_env<br><br><span class="hljs-built_in">ln</span> -s <span class="hljs-variable">$&#123;CODE_DIR&#125;</span>/init_atmosphere_model<br><span class="hljs-built_in">ln</span> -s <span class="hljs-variable">$&#123;CODE_DIR&#125;</span>/atmosphere_model<br><br>./init_atmosphere_model<br>./atmosphere_model<br></code></pre></td></tr></table></figure><p>the run is done and shows,</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs log">   timer_name                                            total       calls        min            max            avg      pct_tot   pct_par     par_eff<br> 1 total time                                        6369.85205         1     6369.85205     6369.85205     6369.85205   100.00       0.00       1.00<br> 2  initialize                                         16.04797         1       16.04797       16.04797       16.04797     0.25       0.25       1.00<br> 3   read_ICs                                          12.92155         1       12.92155       12.92155       12.92155     0.20      80.52       1.00<br> 2  diagnostic_fields                                  39.15386      6146        0.00027        0.55109        0.00637     0.61       0.61       1.00<br> 2  stream_output                                     135.25525      3073        0.00000       25.31770        0.04401     2.12       2.12       1.00<br> 2  time integration                                 6178.20117      3072        1.83821        6.71001        2.01113    96.99      96.99       1.00<br> 3   atm_rk_integration_setup                          72.62624      3072        0.02114        0.06312        0.02364     1.14       1.18       1.00<br> 3   atm_compute_moist_coefficients                    37.50331      3072        0.01115        0.03584        0.01221     0.59       0.61       1.00<br> 3   physics_get_tend                                  22.05075      3072        0.00633        0.03133        0.00718     0.35       0.36       1.00<br> 3   atm_compute_vert_imp_coefs                        45.81344      3072        0.01347        0.04496        0.01491     0.72       0.74       1.00<br> 3   atm_compute_dyn_tend                            2480.10986      9216        0.20928        0.82551        0.26911    38.94      40.14       1.00<br> 3   small_step_prep                                  133.52666      9216        0.01284        0.03533        0.01449     2.10       2.16       1.00<br> 3   atm_advance_acoustic_step                       2095.08105     36864        0.04626        0.15461        0.05683    32.89      33.91       1.00<br> 3   atm_divergence_damping_3d                        457.87030     36864        0.01101        0.03708        0.01242     7.19       7.41       1.00<br> 3   atm_recover_large_step_variables                 268.87030      9216        0.02323        0.08294        0.02917     4.22       4.35       1.00<br> 3   atm_compute_solve_diagnostics                    445.47675      9216        0.03804        0.16322        0.04834     6.99       7.21       1.00<br> 3   atm_rk_dynamics_substep_finish                    43.84446      3072        0.01267        0.03757        0.01427     0.69       0.71       1.00<br><br>-----------------------------------------<br>Total log messages printed:<br>   Output messages =                25140<br>   Warning messages =                   0<br>   Error messages =                     0<br>   Critical error messages =            0<br>-----------------------------------------<br></code></pre></td></tr></table></figure><ul><li>Plot: <code>ncl bwave_surface_p.ncl</code>, <strong>for surface pressure</strong>,</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs ncl">rdzw = f-&gt;rdzw(:)<br>p = f-&gt;pressure(iTime,:,0)<br>rho=f-&gt;rho(iTime,:,:)<br>qv = f-&gt;qv(iTime,:,:) <br>h = (p + 0.5/rdzw(0)*9.80616*(1.25*rho(:,0) - .25*rho(:,1)))/100. ;for dry!!!<br>;h = (p + 0.5/rdzw(0)*9.80616*(1.25*rho(:,0)*(1.+qv(:,0)) - .25*rho(:,1)*(1.+qv(:,1))))/100. ;for moist!!!<br></code></pre></td></tr></table></figure><p><img src="https://i.imgur.com/IY1Zckj.gif" width="600" /></p><h2 id="test-cases-on-the-cartesian-plane">Test cases on the Cartesian plane</h2><h3 id="supercell">Supercell</h3><p>The supercell thunderstorm test case.</p><ul><li><a href="https://www2.cgd.ucar.edu/events/20140407/Presentations-Posters/Klemp.pdf">Idealized Nonhydrostatic Supercell Simulations in the Global MPAS | Klemp | 2014</a><ul><li>Supercell Thunderstorms<ul><li>Strong, long-lived convective cells</li><li>Deep, persistent rotating updrafts</li><li>May propagate tranverse to the mean winds</li><li>May split into two counter-rotating storms</li><li>Produce most of the worldâ€™s intense tornadoes</li></ul></li></ul></li><li>Based on historical supercell simulations (Weisman and Klemp, 1982, 1984)</li><li><a href="http://admg.engin.umich.edu/wp-content/uploads/sites/525/2021/03/DCMIP-2016_TestCaseDocument_10June2016.pdf">Zarzycki, C. M., Jablonowski, C., Kent, J., Lauritzen, P. H., Nair, R., Reed, K. A., ... &amp; Skamarock, W. C. (2019). DCMIP2016: the splitting supercell test case. Geoscientific Model Development, 12(3), 879-892.</a></li></ul><p>Steps to run this test case:</p><ol type="1"><li>Link the <code>init_atmosphere_model</code> and <code>atmosphere_model</code> executables from the top-level MPAS directory.</li><li>Run <code>init_atmosphere_model</code> to create initial conditions.</li><li>Run <code>atmosphere_model</code>.</li><li>Run the <code>supercell.ncl</code> script to produce <strong>plots theta, vertical velocity</strong>, etc.</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs netcdf">netcdf supercell_init &#123;<br>dimensions:<br>nVertLevels = 40 ;<br>nCells = 28080 ;<br>Time = UNLIMITED ; // (1 currently)<br>StrLen = 64 ;<br>nEdges = 84240 ;<br>nVertices = 56160 ;<br>TWO = 2 ;<br>maxEdges = 6 ;<br>maxEdges2 = 12 ;<br>vertexDegree = 3 ;<br>R3 = 3 ;<br>nMonths = 12 ;<br>nSoilComps = 8 ;<br>FIFTEEN = 15 ;<br>nVertLevelsP1 = 41 ;<br>nSoilLevels = 4 ;<br></code></pre></td></tr></table></figure><p>the run is done and shows,</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs log">   timer_name                                            total       calls        min            max            avg      pct_tot   pct_par     par_eff<br> 1 total time                                        6989.56445         1     6989.56445     6989.56445     6989.56445   100.00       0.00       1.00<br> 2  initialize                                         13.22789         1       13.22789       13.22789       13.22789     0.19       0.19       1.00<br> 3   read_ICs                                          11.03032         1       11.03032       11.03032       11.03032     0.16      83.39       1.00<br> 2  diagnostic_fields                                  30.90804      4802        0.00030        0.53316        0.00644     0.44       0.44       1.00<br> 2  stream_output                                      52.69895      2401        0.00000       24.40299        0.02195     0.75       0.75       1.00<br> 2  time integration                                 6891.87109      2400        2.28900        4.57639        2.87161    98.60      98.60       1.00<br> 3   physics driver                                     0.01804      2400        0.00000        0.00014        0.00001     0.00       0.00       1.00<br> 3   atm_rk_integration_setup                          81.38436      2400        0.02777        0.08220        0.03391     1.16       1.18       1.00<br> 3   atm_compute_moist_coefficients                    61.76581      2400        0.01953        0.08913        0.02574     0.88       0.90       1.00<br> 3   physics_get_tend                                  32.39993      2400        0.00967        0.02704        0.01350     0.46       0.47       1.00<br> 3   atm_compute_vert_imp_coefs                        43.12508      2400        0.01534        0.04965        0.01797     0.62       0.63       1.00<br> 3   atm_compute_dyn_tend                            1610.07593      7200        0.17735        0.70892        0.22362    23.04      23.36       1.00<br> 3   small_step_prep                                   97.92229      7200        0.01138        0.03734        0.01360     1.40       1.42       1.00<br> 3   atm_advance_acoustic_step                       1270.13843     28800        0.03023        0.10505        0.04410    18.17      18.43       1.00<br> 3   atm_divergence_damping_3d                        310.51599     28800        0.00890        0.05312        0.01078     4.44       4.51       1.00<br> 3   atm_recover_large_step_variables                 237.22810      7200        0.02374        0.08794        0.03295     3.39       3.44       1.00<br> 3   atm_advance_scalars                              986.22546      4800        0.14607        0.64590        0.20546    14.11      14.31       1.00<br> 3   atm_compute_solve_diagnostics                    371.22009      7200        0.03595        0.17258        0.05156     5.31       5.39       1.00<br> 3   atm_advance_scalars_mono                         644.47906      2400        0.18351        0.88479        0.26853     9.22       9.35       1.00<br> 3   atm_rk_dynamics_substep_finish                    43.15440      2400        0.01410        0.04277        0.01798     0.62       0.63       1.00<br> 3   microphysics                                    1031.64172      2400        0.30451        0.79860        0.42985    14.76      14.97       1.00<br> 4    mp_kessler                                      247.80276      2400        0.08487        0.28454        0.10325     3.55      24.02       1.00<br><br>-----------------------------------------<br>Total log messages printed:<br>   Output messages =                26971<br>   Warning messages =                   0<br>   Error messages =                     0<br>   Critical error messages =            0<br>-----------------------------------------<br></code></pre></td></tr></table></figure><p>Plot,</p><div class="group-image-container"><div class="group-image-row"><div class="group-image-wrap"><img src="https://i.imgur.com/EoUDfnf.png" alt="1" /></div><div class="group-image-wrap"><img src="https://i.imgur.com/71tbDoJ.png" alt="2" /></div></div></div><h3 id="mountain-wave">Mountain-wave</h3><p>The Schaer mountain-wave test case.</p><div class="note note-danger">            <p><strong><a href="https://iacweb.ethz.ch/doc/publications/2002_ScharEtAl_VertCoord.pdf">SchÃ¤r, C., Leuenberger, D., Fuhrer, O., LÃ¼thi, D., &amp; Girard, C. (2002). A new terrain-following vertical coordinate formulation for atmospheric prediction models. Monthly Weather Review, 130(10), 2459-2480.</a></strong></p>          </div><ul><li><strong>Analytical solution</strong> (Eqn. 46, Figure 13g)</li><li><a href="https://www.umr-cnrm.fr/gmapdoc/IMG/pdf/TestingNHMOdels.pdf">Standard Tests of NH dynamical kernels | Jozef Vivoda | 2005</a><ul><li>P.8 Schaer test case</li></ul></li></ul><p><img src="https://i.imgur.com/aGauoyFl.png" width="600" /></p><p>Steps to run this test case:</p><ol type="1"><li>Link the <code>init_atmosphere_model</code> and <code>atmosphere_model</code> executables from the top-level MPAS directory</li><li>Run <code>init_atmosphere_model</code> to create initial conditions</li><li>Run <code>atmosphere_model</code></li><li>Run the <code>mtn_wave_w.ncl</code> script to <strong>plot vertical cross-sections of vertical velocity</strong></li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs netcdf">netcdf mtn_wave_init &#123;<br>dimensions:<br>nVertLevels = 70 ;<br>nCells = 1600 ;<br>Time = UNLIMITED ; // (1 currently)<br>StrLen = 64 ;<br>nEdges = 4800 ;<br>nVertices = 3200 ;<br>TWO = 2 ;<br>maxEdges = 6 ;<br>maxEdges2 = 12 ;<br>vertexDegree = 3 ;<br>R3 = 3 ;<br>nMonths = 12 ;<br>nSoilComps = 8 ;<br>FIFTEEN = 15 ;<br>nVertLevelsP1 = 71 ;<br>nSoilLevels = 4 ;<br></code></pre></td></tr></table></figure><p>the run is done and shows,</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs log">   timer_name                                            total       calls        min            max            avg      pct_tot   pct_par     par_eff<br> 1 total time                                         479.17487         1      479.17487      479.17487      479.17487   100.00       0.00       1.00<br> 2  initialize                                          1.40130         1        1.40130        1.40130        1.40130     0.29       0.29       1.00<br> 3   read_ICs                                           1.04874         1        1.04874        1.04874        1.04874     0.22      74.84       1.00<br> 2  diagnostic_fields                                  38.32835      6002        0.00030        0.26142        0.00639     8.00       8.00       1.00<br> 2  stream_output                                       8.16368      3001        0.00000        2.18816        0.00272     1.70       1.70       1.00<br> 2  time integration                                  430.28293      3000        0.12909        0.37118        0.14343    89.80      89.80       1.00<br> 3   atm_rk_integration_setup                           7.68167      3000        0.00226        0.00653        0.00256     1.60       1.79       1.00<br> 3   atm_compute_moist_coefficients                     3.88766      3000        0.00115        0.00331        0.00130     0.81       0.90       1.00<br> 3   physics_get_tend                                   1.73502      3000        0.00049        0.00179        0.00058     0.36       0.40       1.00<br> 3   atm_compute_vert_imp_coefs                         4.89605      3000        0.00145        0.00413        0.00163     1.02       1.14       1.00<br> 3   atm_compute_dyn_tend                             181.87900      9000        0.01650        0.06131        0.02021    37.96      42.27       1.00<br> 3   small_step_prep                                    9.66831      9000        0.00094        0.00315        0.00107     2.02       2.25       1.00<br> 3   atm_advance_acoustic_step                        113.06064     36000        0.00273        0.01248        0.00314    23.59      26.28       1.00<br> 3   atm_divergence_damping_3d                         37.56601     36000        0.00091        0.00282        0.00104     7.84       8.73       1.00<br> 3   atm_recover_large_step_variables                  21.39947      9000        0.00175        0.00898        0.00238     4.47       4.97       1.00<br> 3   atm_compute_solve_diagnostics                     37.34831      9000        0.00319        0.01347        0.00415     7.79       8.68       1.00<br> 3   atm_rk_dynamics_substep_finish                     4.19751      3000        0.00123        0.00363        0.00140     0.88       0.98       1.00<br><br>-----------------------------------------<br>Total log messages printed:<br>   Output messages =                24552<br>   Warning messages =                   0<br>   Error messages =                     0<br>   Critical error messages =            0<br>-----------------------------------------<br></code></pre></td></tr></table></figure><p>Plot,</p><p><img src="https://i.imgur.com/ZZHlHFq.gif" width="600" /></p><h1 id="references">References</h1><ol type="1"><li>Skamarock, W. C., Klemp, J. B., Duda, M. G., Fowler, L. D., Park, S., &amp; Ringler, T. D. (2012). A Multiscale Nonhydrostatic Atmospheric Model Using Centroidal Voronoi Tesselations and C-Grid Staggering. Monthly Weather Review, 140(9), 3090-3105. <a href="https://doi.org/10.1175/MWR-D-11-00215.1" class="uri">https://doi.org/10.1175/MWR-D-11-00215.1</a><ol type="1"><li>Test cases: Nonhydrostatic flows on Cartesian planes<ol type="1"><li>2D SchaÂ¨r test case</li><li>2D density current</li><li>Supercell simulation</li></ol></li><li>Test cases: Large-scale flow on the sphere<ol type="1"><li>Dry baroclinic wave simulations</li><li>Unfiltered baroclinic wave simulations</li></ol></li></ol></li></ol>]]></content>
    
    
    <categories>
      
      <category>MPAS</category>
      
    </categories>
    
    
    <tags>
      
      <tag>HPC</tag>
      
      <tag>NWP</tag>
      
      <tag>WRF</tag>
      
      <tag>MPAS</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>CFD | OpenFOAM | STL file | ç¶²æ ¼ç”Ÿæˆ</title>
    <link href="/2024/12/05/CFD-openfoam-stl-mesh-generation/"/>
    <url>/2024/12/05/CFD-openfoam-stl-mesh-generation/</url>
    
    <content type="html"><![CDATA[<h1 id="openfoamä¸‰ç¶­ç¶²æ ¼ç”Ÿæˆå™¨">OpenFOAMä¸‰ç¶­ç¶²æ ¼ç”Ÿæˆå™¨</h1><p>snappyHexMeshï¼ˆSHMï¼‰æ˜¯OpenFOAMè»Ÿé«”çš„ä¸‰ç¶­çµæ§‹åŒ–ç¶²æ ¼ç”Ÿæˆæ¨¡çµ„ï¼ŒåŠŸèƒ½æ¯”è¼ƒå¼·å¤§ï¼Œè¨­å®šéˆæ´»ï¼Œè¡¨é¢è™•ç†è²¼åˆåŠŸèƒ½éå¸¸å¼·å¥ä¸¦ä¸”å¯ä»¥ä¸¦è¡Œé‹ç®—ã€‚ SHMèƒ½å¤ é€éä½¿ç”¨è€…è‡ªè¨‚åƒæ•¸ï¼ˆå¦‚ç´°åŒ–åƒæ•¸castellatedMeshControlsã€åˆ‡åˆåƒæ•¸snapControlsç­‰ï¼‰å°é å…ˆè¼‰å…¥çš„å¹¾ä½•é«”æª”æ¡ˆï¼ˆé€šå¸¸ç‚º'.stl'æª”æ¡ˆï¼‰è‡ªå‹•å¯¦ç¾ä¸‰ç¶­ç¶²æ ¼ç”Ÿæˆã€åŠ å¯†(castellatedMesh)ã€åˆ‡åˆï¼ˆsnap ï¼‰å’Œæ–°å¢é‚Šç•Œå±¤ï¼ˆaddLayersï¼‰ç­‰æ“ä½œã€‚</p><p>SHMç”¢ç”ŸOpenFOAMç¶²æ ¼æµç¨‹å¦‚åœ–1æ‰€ç¤º:</p><figure><img src="https://i.imgur.com/oggvctr.png" alt="åœ–1 åŸºæ–¼snappyHexMeshçš„OpenFOAMç¶²æ ¼ç”Ÿæˆæµç¨‹åœ–" width="600" /><figcaption>åœ–1 åŸºæ–¼snappyHexMeshçš„OpenFOAMç¶²æ ¼ç”Ÿæˆæµç¨‹åœ–</figcaption></figure><p>éœ€æä¾›ä»¥ä¸‹ä¸‰å€‹æ–‡ä»¶ï¼š</p><ol type="1"><li>STLæª”æ¡ˆæ ¼å¼çš„å¹¾ä½•æª”æ¡ˆï¼ˆbinaryæˆ–asciiæ ¼å¼ï¼Œå„²å­˜åœ¨ <code>constant/triSurface</code> å­å­—å…¸ä¸­ï¼‰ï¼›</li><li>èƒŒæ™¯å…­é¢é«”ç¶²æ ¼ï¼ˆç”¨æ–¼å®šç¾©è¨ˆç®—åŸŸç¯„åœå’ŒèƒŒæ™¯ç¶²æ ¼ï¼Œä¸€èˆ¬ç”± <code>blockMesh</code> ç”Ÿæˆï¼Œä¹Ÿå¯ç”±å¤–éƒ¨ç¶²æ ¼ç”Ÿæˆå™¨ç”Ÿæˆï¼‰ï¼›</li><li><code>snappyHexMeshDict</code> å­—å…¸ï¼ˆæä¾›ç”Ÿæˆç¶²æ ¼çš„å¿…è¦ä¿¡æ¯ï¼Œä½æ–¼ <code>system</code> å­è³‡æ–™å¤¾ä¸‹ï¼‰ã€‚</li></ol><h2 id="ä»€éº¼æ˜¯-stl-æª”æ¡ˆ">ä»€éº¼æ˜¯ STL æª”æ¡ˆï¼Ÿ</h2><p>STL æ˜¯ä¸€ç¨®å¸¸ç”¨æ–¼ 3D åˆ—å°å’Œé›»è…¦è¼”åŠ©è¨­è¨ˆ (CAD) çš„æª”æ¡ˆæ ¼å¼ã€‚ç¸®å¯«åç¨± STL ä»£è¡¨ã€Œå…‰å›ºåŒ–ç«‹é«”æˆå‹ã€(<strong>Stereolithography</strong>)ï¼Œä¸€ç¨®ç†±é–€çš„ 3D åˆ—å°æŠ€è¡“ã€‚æ­¤å¤–ï¼Œé€™ç¨®æª”æ¡ˆä¹Ÿç¨±ä½œã€Œæ¨™æº–ä¸‰è§’èªè¨€ã€(<strong>Standard Triangle Language</strong>) æˆ–ã€Œæ¨™æº–æ›²é¢ç´°åˆ†èªè¨€ã€(<strong>Standard Tessellation Language</strong>)ã€‚ STL æª”æ¡ˆæ˜¯ç”±ä¸€ç³»åˆ—ç›¸é€£çš„ä¸‰è§’å½¢æ§‹æˆï¼Œé€™äº›ä¸‰è§’å½¢å¯ç”¨æ–¼æç¹ª 3D æ¨¡å‹æˆ–ç‰©ä»¶çš„è¡¨é¢å¹¾ä½•åœ–å½¢ã€‚è¨­è¨ˆè¶Šè¤‡é›œï¼Œä½¿ç”¨çš„ä¸‰è§’å½¢æ•¸é‡å°±è¶Šå¤šï¼Œè§£æåº¦ä¹Ÿéš¨ä¹‹æé«˜ã€‚æ‚¨å¯ä»¥é€éå‰¯æª”å .stl ä»¥åŠç¼ºä¹è‰²å½©èˆ‡ç´‹ç†çš„ç‰¹é»ä¾†è¾¨è­˜ STL æ ¼å¼å½±åƒã€‚</p><p>ç„¡è«–åˆ—å° 3D æ¨¡å‹çš„ç›®çš„æ˜¯ç´”ç²¹å¥½ç©é‚„æ˜¯è£½ä½œå¯¦å‹™åŸå‹ï¼Œæ‚¨éƒ½å¿…é ˆå»ºç«‹ STL æª”æ¡ˆä¾†å„²å­˜è¨­è¨ˆã€‚è«‹å…ˆåœ¨ CAD è»Ÿé«”ç¨‹å¼ä¸­ç¹ªè£½æ¨¡å‹ï¼Œç„¶å¾Œå°‡å®Œæˆçš„è¨­è¨ˆä»¥ STL æª”æ¡ˆæ ¼å¼åŒ¯å‡ºä¸¦å„²å­˜è‡³é›»è…¦ã€‚</p><ul><li><a href="https://vr.me.ncku.edu.tw/courses/cg110/sites/vr.me.ncku.edu.tw.courses.cg110/files/STL.pdf">STL æª”æ¡ˆè³‡æ–™çµæ§‹</a></li><li><a href="https://3dlabstore.com.hk/blog/3d-software/popular-stl-editiors?srsltid=AfmBOoqL1Z-brQRzPgIC-kvSjG7SpBiql9WLuug-r5hypwAlAFvT-CNE">å¹¾å€‹å¸¸ç”¨çš„ä¿®æ”¹STLæ¨¡å‹è»Ÿä»¶</a><ul><li><strong>MeshLab</strong><ul><li>MeshLabæ˜¯ä¸€å€‹é–‹æºã€ä¾¿æ”œä¸”å¯æ“´å±•çš„ç³»çµ±ï¼Œç”¨æ–¼è™•ç†å’Œç·¨è¼¯3Dä¸‰è§’å½¢ç¶²æ ¼ã€‚é€™å€‹ç³»çµ±æ–¼2005å¹´å¹´åº•ç™¼ä½ˆï¼Œæ—¨åœ¨å¹«åŠ©ç”¨æˆ¶é€²è¡Œ3Dæƒæã€ç·¨è¼¯ã€æ¸…ç†ã€ä¿®å¾©ã€æª¢æŸ¥ã€å‘ˆç¾å’Œè½‰æ›ç­‰æ“ä½œã€‚MeshLabç”¨é€”å»£æ³›ï¼Œå®ƒå¯ä»¥ç”¨æ–¼å„ç¨®å­¸è¡“å’Œç ”ç©¶ä¸­ï¼Œå¦‚æ–‡åŒ–éºç”¢ã€è¡¨é¢é‡å»ºã€å¤ç”Ÿç‰©å­¸ç­‰ã€‚æ¶‰åŠåˆ°3Dç¶²æ ¼æ¨¡å‹è™•ç†çš„ï¼Œéƒ½å¯ä»¥ç”¨é€™æ¬¾è»Ÿä»¶ä¾†è™•ç†ã€‚</li></ul></li><li>MeshMixer<ul><li>MeshMixeré©åˆè¨±å¤šéœ€è¦ä¿®æ”¹STLæ¨¡å‹çš„ä½¿ç”¨è€…ï¼Œåˆå­¸è€…æˆ–æ˜¯ç¶“é©—è±å¯Œçš„è¨­è¨ˆäººå“¡çš†é©ç”¨ã€‚</li></ul></li><li>ZBrushCoreMini<ul><li>ZBrushCoreMinié©åˆå°é›•åˆ»æ–¹é¢æ„Ÿèˆˆè¶£çš„äººç¾¤ï¼Œæ­¤æ¬¾è»Ÿä»¶æ“ä½œæ™‚é¡ä¼¼ä½¿ç”¨ç•«ç­†ä¸€æ¨£å»ç·¨è¼¯ã€‚</li></ul></li></ul></li></ul><h3 id="dæ‰“å°çš„stlå’Œobjæ ¼å¼æœ‰ä»€éº¼å€åˆ¥ä¿®æ”¹èµ·ä¾†ä¸€æ¨£éº¼">3Dæ‰“å°çš„STLå’ŒOBJæ ¼å¼æœ‰ä»€éº¼å€åˆ¥ï¼Ÿä¿®æ”¹èµ·ä¾†ä¸€æ¨£éº¼ï¼Ÿ</h3><p>STLæ–‡ä»¶æ ¼å¼æ˜¯ç”±3D SYSTEMS å…¬å¸æ–¼1988 å¹´åˆ¶å®šçš„ä¸€ç¨®çˆ²å¿«é€ŸåŸå‹è£½é€ æŠ€è¡“æœå‹™çš„ä¸‰ç¶­åœ–å½¢æ–‡ä»¶æ ¼å¼ã€‚STLæ–‡ä»¶ä¸åŒæ–¼å…¶ä»–ä¸€äº›åŸºæ–¼ç‰¹å¾µçš„å¯¦é«”æ¨¡å‹ï¼ŒSTLç”¨ä¸‰è§’å½¢ç¶²æ ¼ä¾†è¡¨ç¾3D CADæ¨¡å‹ï¼Œåªèƒ½æè¿°ä¸‰ç¶­ç‰©é«”çš„å¹¾ä½•ä¿¡æ¯ï¼Œä¸æ”¯æŒé¡è‰²æè³ªç­‰ä¿¡æ¯ã€‚æ­£å› çˆ²æ•¸æ“šç°¡åŒ–ï¼Œæ ¼å¼ç°¡å–®ï¼ŒSTLæ™®åŠå¾ˆå¿«æ‡‰ç”¨å»£æ³›ã€‚</p><p>OBJæ–‡ä»¶æ˜¯Alias|Wavefrontå…¬å¸çˆ²å®ƒçš„ä¸€å¥—åŸºæ–¼å·¥ä½œç«™çš„3Då»ºæ¨¡å’Œå‹•ç•«è»Ÿä»¶â€Advanced Visualizerâ€é–‹ç™¼çš„ä¸€ç¨®æ¨™æº–3Dæ¨¡å‹æ–‡ä»¶æ ¼å¼ï¼Œå¾ˆé©åˆç”¨æ–¼3Dè»Ÿä»¶æ¨¡å‹ä¹‹é–“çš„æ•¸æ“šäº¤æ›ï¼Œèƒ½æ”¯æŒé¡è‰²ç­‰ä¿¡æ¯ã€‚</p><p>å…©è€…åœ¨ä¿®æ”¹ä¸Šç›¸å·®ä¸å¤šï¼Œéƒ½æ˜¯éœ€è¦å°å…¥åˆ°ç›¸é—œçš„æ¨¡å‹ä¿®æ”¹è»Ÿä»¶ä¸­é€²è¡Œã€‚</p><h1 id="applications">Applications</h1><ul><li><a href="https://ppfocus.com/0/ed40c27be.html">SnappyHexMeshç¶²æ ¼åŠƒåˆ†å¯¦ä¾‹è©³è§£</a><ul><li>ä½¿ç”¨surfaceCheckæª¢æŸ¥proeller.stl, <code>surfaceCheck constant/propeller.stl</code></li></ul></li></ul><h1 id="blender-gis-to-stl">Blender GIS to stl</h1><ul><li><a href="https://github.com/domlysz/BlenderGIS" class="uri">https://github.com/domlysz/BlenderGIS</a></li><li><p><a href="https://blender-addons.org/blendergis-addon/">BlenderGIS addon</a></p></li><li><p><strong>download</strong></p></li></ul><div class="note note-danger">            <p>GIS datafile import : Import in Blender most commons GIS data format : <code>Shapefile vector</code>, <code>raster image</code>, <code>geotiff DEM</code>, <code>OpenStreetMap xml</code>.</p>          </div><h2 id="google-gis-srtm-30m-to-stl">Google GIS (SRTM 30m) to stl</h2><ul><li>Note : Since 2022, the OpenTopography web service requires an API key. Please register to opentopography.org and request a key. This service is still free.</li></ul><div class="group-image-container"><div class="group-image-row"><div class="group-image-wrap"><img src="https://i.imgur.com/s3CBmtM.png" alt="1" /></div><div class="group-image-wrap"><img src="https://i.imgur.com/Sgvffp8.png" alt="2" /></div><div class="group-image-wrap"><img src="https://i.imgur.com/1EBJ21x.png" alt="3" /></div></div><div class="group-image-row"><div class="group-image-wrap"><img src="https://i.imgur.com/Sk7Oeev.png" alt="4" /></div><div class="group-image-wrap"><img src="https://i.imgur.com/11gtygg.png" alt="5" /></div></div></div><h2 id="openstreetmap-xml-to-stl">OpenStreetMap xml to stl</h2><h3 id="download-osm-file">Download osm file</h3><p><img src="https://i.imgur.com/POleA9W.png" width="400" /></p><h3 id="import-osm-file">Import osm file</h3><p><img src="https://i.imgur.com/POvvxOu.png" width="400" /></p><h3 id="export-stl-file">export stl file</h3><ul><li>meshlab</li></ul><figure><img src="https://i.imgur.com/bvsHeZV.png" alt="Open by meshlab" width="400" /><figcaption>Open by <strong>meshlab</strong></figcaption></figure><ul><li>admesh</li></ul><figure><img src="https://i.imgur.com/SVTBUsh.png" alt="Check by admesh" width="400" /><figcaption>Check by <strong>admesh</strong></figcaption></figure><h1 id="osm">OSM</h1><p><strong>OpenStreetMap</strong> æ˜¯ä¸€ä¸ªåºå¤§çš„åœ°ç†ä¿¡æ¯æ•°æ®åº“ï¼Œè€Œä¸”æ˜¯å®Œå…¨å¼€æ”¾å’Œå…è´¹çš„ã€‚</p><ul><li><a href="https://www.openstreetmap.org/#map=13/22.2868/114.2492" class="uri">https://www.openstreetmap.org/#map=13/22.2868/114.2492</a></li><li>export --&gt; <code>map.osm</code></li></ul><p><code>.osm</code> æ–‡ä»¶æ ¼å¼æ˜¯ OpenStreetMap æ‰€ç‰¹æœ‰çš„ã€‚ä½ ä¸ä¼šåœ¨å…¶ä»–åœ°æ–¹é‡åˆ°å®ƒã€‚å¦‚æœä½ æ›¾ç»ä½¿ç”¨ JOSM ä¸‹è½½è¿‡æ•°æ®å¹¶å°†å…¶ä¿å­˜ä¸ºæ–‡ä»¶ï¼Œä½ å¯èƒ½å·²ç»æ³¨æ„åˆ°æ–‡ä»¶çš„æ‰©å±•åæ˜¯ <code>.osm</code> ã€‚å¦‚æœä½ æ˜¯ä¸€ä¸ªGISç”¨æˆ·ï¼Œä½ å¯èƒ½ä¹Ÿæ³¨æ„åˆ°ï¼Œä½¿ç”¨QGISç­‰è½¯ä»¶æ‰“å¼€è¿™äº›æ–‡ä»¶å¹¶ä¸å®¹æ˜“ã€‚</p><p><img src="https://i.imgur.com/lqqINf9.png" width="600" /></p><h1 id="shapefile">Shapefile</h1><p><strong>shapefile</strong> æ˜¯ä¸€ç§å¹¿æ³›ä½¿ç”¨çš„çŸ¢é‡åœ°ç†æ•°æ®å­˜å‚¨æ ¼å¼ã€‚å®ƒæ˜¯ç”± ESRI å…¬å¸å¼€å‘çš„ï¼Œè¯¥å…¬å¸åˆ¶é€ äº† ArcGIS ï¼Œè¿™æ˜¯ä¸€å¥—æµè¡Œçš„åœ°ç†ä¿¡æ¯ç³»ç»Ÿåº”ç”¨ç¨‹åºã€‚</p><p>Shapefile å®é™…ä¸Šæ˜¯å‡ ä¸ªä¸åŒæ–‡ä»¶çš„é›†åˆã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªåŒ…å«å»ºç­‘æ•°æ®çš„shapefileå¯èƒ½æœ‰ä»¥ä¸‹æ‰©å±•åçš„æ–‡ä»¶ã€‚</p><ul><li>buildings.shp</li><li>buildings.shx</li><li>buildings.dbf</li></ul><p>shapefiles é€šå¸¸ä¹Ÿä¼šæœ‰åŒ…å«å…¶ä»–ä¿¡æ¯çš„é™„åŠ æ–‡ä»¶ã€‚</p><p>ä¸€ä¸ª shapefile åªèƒ½å®¹çº³ä¸€ç§ç±»å‹çš„ç‰¹å¾ï¼ˆç‚¹ã€çº¿æˆ–å¤šè¾¹å½¢ï¼‰ï¼Œæ¯ä¸ªç‰¹å¾çš„å±æ€§éƒ½åŒ…å«åœ¨ä¸€ä¸ªè¡¨ä¸­ã€‚ä¸ OpenStreetMap ç³»ç»Ÿä¸åŒçš„æ˜¯ï¼Œåœ¨ OpenStreetMap ç³»ç»Ÿä¸­ï¼Œæ¯ä¸ªå¯¹è±¡éƒ½å¯ä»¥æ‹¥æœ‰æ— é™æ•°é‡çš„æ ‡ç­¾ï¼Œshapefile ä¸­çš„ç‰¹å¾å±æ€§å¿…é¡»é€‚åˆ shapefile å®šä¹‰çš„è¡¨æ ¼ç»“æ„ã€‚</p><p>OpenStreetMapæ•°æ®å¯ä»¥è½¬æ¢ä¸ºshapefilesã€‚å„ç§ç½‘ç«™æä¾›äº†ä»OSMæ•°æ®è½¬æ¢è€Œæ¥çš„shapefilesã€‚</p><h1 id="references">References</h1><ol type="1"><li><a href="https://www.wolfdynamics.com/wiki/meshing_OF_SHM.pdf">Mesh generation using snappyHexMesh (<strong>recommend</strong>)</a></li><li><a href="https://www.fangzhenxiu.com/post/7273888/?uri=473_83g6eo3r4s1">è§£é”æ–°æŠ€èƒ½ï¼šOpenFOAMä¸‰ç»´ç½‘æ ¼ç”Ÿæˆå™¨</a></li><li><a href="https://www.adobe.com/hk_zh/creativecloud/file-types/image/vector/stl-file.html">STL æª”æ¡ˆ</a></li><li><a href="https://blog.iaac.net/urban-wind-flow-modeling-with-pinns/?utm_source=perplexity">Urban Wind Flow Modeling with PINNs (<strong>recommend</strong>)</a><ol type="1"><li>Data Sources<ol type="1"><li>Real-Time Wind Data: <code>OpenWeatherMap</code> wind conditions.</li><li>3D Building Models: <code>OpenStreetMap (OSM)</code> data using Overpass API.</li></ol></li></ol></li></ol>]]></content>
    
    
    <categories>
      
      <category>CFD</category>
      
    </categories>
    
    
    <tags>
      
      <tag>HPC</tag>
      
      <tag>OpenFOAM</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Maths | p-value | Statistical Significance</title>
    <link href="/2024/12/05/maths-p-value/"/>
    <url>/2024/12/05/maths-p-value/</url>
    
    <content type="html"><![CDATA[<h1 id="p-value">p-value</h1><p>In null-hypothesis significance testing, the p-value is the probability of obtaining test results at least as extreme as the result actually observed, under the assumption that the null hypothesis is correct.</p><p>på€¼ï¼ˆp valueï¼‰å°±æ˜¯ç•¶è™›ç„¡å‡è¨­ç‚ºçœŸæ™‚æ‰€å¾—åˆ°çš„æ¨£æœ¬è§€å¯Ÿçµæœæˆ–æ›´æ¥µç«¯çµæœå‡ºç¾çš„æ¦‚ç‡ã€‚å¦‚æœpå€¼å¾ˆå°ï¼Œèªªæ˜åœ¨è™›ç„¡å‡è¨­ä¸‹æ¥µç«¯è§€æ¸¬çµæœçš„ç™¼ç”Ÿæ¦‚ç‡å¾ˆå°ã€‚è€Œå¦‚æœå‡ºç¾äº†ï¼Œæ ¹æ“šå°æ¦‚ç‡åŸç†ï¼Œå°±æœ‰ç†ç”±æ‹’çµ•è™›ç„¡å‡è¨­ï¼›på€¼è¶Šå°ï¼Œæ‹’çµ•è™›ç„¡å‡è¨­çš„ç†ç”±è¶Šå……åˆ†ã€‚</p><p>å¸¸å¸¸çœ‹åˆ°æœ‰äººèªªp-value &lt;0.05ï¼Œæ‰€ä»¥é”åˆ°çµ±è¨ˆä¸Šçš„æ„ç¾©ï¼Œæ¨¡å‹åˆç†ï¼Œä½†ä½ çœŸçš„çŸ¥é“é€™æ˜¯ä»€éº¼æ„æ€å—? p å€¼æ˜¯ä»€éº¼ï¼Ÿ p å€¼æ˜¯ç”± Ronald Fisher åœ¨ 1920 å¹´ä»£ç™¼å±•å‡ºä¾†çš„ï¼Œå·²å°‡è¿‘ä¸€ç™¾å¹´ã€‚p å€¼æª¢å®šæœ€é–‹å§‹ï¼Œæ˜¯æª¢å®šåœ¨ä¸€å€‹ model ä¹‹ä¸‹ï¼Œå¯¦é©—å‡ºä¾†çš„ data è·Ÿ model åˆ°åº•å»åˆä¸å»åˆã€‚é€™å€‹è¢«æª¢å®šçš„ modelï¼Œæˆ‘å€‘æŠŠå®ƒå«åšè™›ç„¡å‡è¨­ï¼ˆnull hypothesisï¼‰ï¼Œä¸€èˆ¬æƒ…æ³ä¸‹ï¼Œé€™å€‹è¢«æª¢å®šçš„ modelï¼Œæ˜¯å‡è¨­å¯¦é©—ä¸¦ç„¡ç³»çµ±æ€§æ•ˆæ‡‰çš„ï¼Œå³æ•ˆæ‡‰æ˜¯é›¶ï¼Œæˆ–æ˜¯éš¨æ©Ÿç‹€æ…‹ã€‚åœ¨é€™å€‹è™›ç„¡å‡è¨­ä¹‹ä¸‹ï¼Œå¾—åˆ°ä¸€å€‹çµ±è¨ˆå€¼ï¼Œç„¶å¾Œè¦ç®—ç²å¾—é€™éº¼å¤§ï¼ˆæˆ–é€™éº¼å°ï¼‰çš„çµ±è¨ˆå€¼çš„æ©Ÿç‡æœ‰å¤šå°‘ï¼Œé€™å€‹æˆ–æ©Ÿç‡å°±æ˜¯ p å€¼ã€‚æˆ‘å€‘å¾—åˆ° p å€¼ä»¥å¾Œï¼Œè¦ä½œçµ±è¨ˆæª¢å®šã€‚æˆ‘å€‘ç›¸ç´„æˆä¿—åœ°è¨­å®šä¸€å€‹é¡¯è‘—æ°´æº–ï¼Œå«åš Î±ï¼ŒÎ± é€šå¸¸éƒ½æ˜¯ 0.05ï¼Œæœ‰æ™‚å€™å¤§å®¶æœƒåš´æ ¼ä¸€é»ç”¨ 0.01ï¼Œæ¯”è¼ƒä¸åš´æ ¼å‰‡ç”¨ 0.10ã€‚å¦‚æœæˆ‘å€‘çš„ Î± = 0.05ï¼Œå‰‡è‹¥ p &lt; 0.05ï¼Œæˆ‘å€‘å°±å¯ä»¥æ‹’çµ•è™›ç„¡å‡è¨­ï¼Œä¸¦å®£ç¨±é€™å€‹æª¢å®šåœ¨çµ±è¨ˆä¸Šæ˜¯é¡¯è‘—çš„ï¼Œå¦å‰‡æª¢å®šå°±ä¸é¡¯è‘—ï¼Œé€™æ˜¯å‚³çµ±çš„ p å€¼æª¢å®šæ–¹æ³•ã€‚å¦‚æœçµ±è¨ˆä¸Šé¡¯è‘—çš„è©±ï¼Œæˆ‘å€‘å°±èªç‚ºå¾—åˆ°å¯¦é©—çµæœçš„æ©Ÿæœƒå¾ˆå°ï¼Œæ‰€ä»¥å°±ä¸æ¥å—è™›ç„¡å‡è¨­ã€‚</p><p><img src="https://i.imgur.com/R9rzCZ6.png" width="600" /> <img src="https://i.imgur.com/YNCQYZz.png" /></p><h1 id="statistical-hypothesis-test">Statistical hypothesis test</h1><p>A statistical hypothesis test is a method of statistical inference used to decide whether the data sufficiently supports a particular hypothesis. A statistical hypothesis test typically involves a calculation of a test statistic. Then a decision is made, either by comparing the test statistic to a critical value or equivalently by evaluating a p-value computed from the test statistic. Roughly 100 specialized statistical tests have been defined.</p><h2 id="students-t-test">Student's t-test</h2><p><img src="https://i.imgur.com/EJrAqbw.png" width="600" /></p><p>Student's t-test is a statistical test used to test whether the difference between the response of two groups is statistically significant or not. It is any statistical hypothesis test in which the test statistic follows a <strong>Student's t-distribution</strong> under the null hypothesis. It is most commonly applied when the test statistic would <strong>follow a normal distribution</strong> if the value of a scaling term in the test statistic were known.</p><p><img src="https://i.imgur.com/n8aDZgE.png" width="600" /></p><p>é›–ç„¶ t æª¢å®šç›¸å°æ–¼å‡è¨­çš„å·®ç•°è¼ƒç‚ºç©©å›ºï¼Œt æª¢å®šå¯¦éš›ä¸Šå‡è¨­ï¼š</p><ul><li>è³‡æ–™ç‚º<strong>é€£çºŒè³‡æ–™</strong>ã€‚</li><li>æ¨£æœ¬è³‡æ–™å¿…é ˆå¾æ¯é«”éš¨æ©Ÿæ¡æ¨£ã€‚</li><li>è®Šç•°æ•¸å…·åŒè³ªæ€§ (å„ç¾¤çµ„è³‡æ–™çš„è®Šç•°æ€§ç›¸ä¼¼)ã€‚</li><li><strong>è³‡æ–™è¶¨è¿‘æ–¼å¸¸æ…‹åˆ†ä½ˆ</strong>ã€‚</li><li><p>é‡å°é›™æ¨£æœ¬ t æª¢å®š (Two sample t test)ï¼Œæˆ‘å€‘å¿…é ˆæœ‰<strong>ç¨ç«‹æ¨£æœ¬</strong>ã€‚è‹¥æ¨£æœ¬ä¸¦éç¨ç«‹ï¼Œå‰‡ä½¿ç”¨<strong>é…å°tæª¢å®š (Paired t test)</strong>å¯èƒ½æœƒè¼ƒç‚ºåˆé©ã€‚</p></li><li>When the <strong>normality assumption does not hold</strong>, a non-parametric alternative to the t-test may have better statistical power.<ul><li><strong>Nonparametric statistics</strong> is a type of statistical analysis that makes minimal assumptions about the underlying distribution of the data being studied. Nonparametric tests are often used when the assumptions of parametric tests are evidently violated.</li><li>The first meaning of nonparametric involves techniques that <strong>do not rely on data belonging to any particular</strong> parametric family of probability distributions.</li><li>éåƒæ•¸çµ±è¨ˆå­¸ï¼ˆè‹±èªï¼šnonparametric statisticsï¼‰ï¼Œæˆ–ç¨±ç„¡åƒæ•¸çµ±è¨ˆå­¸ã€éåƒæ•¸çµ±è¨ˆåˆ†æï¼Œæ˜¯çµ±è¨ˆå­¸çš„ä¸€å€‹åˆ†æ”¯ï¼Œé©ç”¨æ–¼<strong>ç¸½é«”åˆ†ä½ˆæƒ…æ³æœªæ˜ã€å°æ¨£æœ¬ã€ç¸½é«”åˆ†ä½ˆä¸ç‚ºæ­£æ…‹ä¹Ÿä¸æ˜“è½‰æ›ç‚ºæ­£æ…‹</strong>ã€‚</li><li>åƒæ•¸çµ±è¨ˆï¼ˆParametric statisticsï¼‰æ˜¯çµ±è¨ˆå­¸çš„ä¸€å€‹åˆ†æ”¯ï¼Œå®ƒå‡è¨­æ¨£æœ¬æ•¸æ“šä¾†è‡ªç¸½é«”ï¼Œè€Œç¸½é«”å¯ä»¥é€éå…·æœ‰å›ºå®šåƒæ•¸é›†çš„æ¦‚ç‡åˆ†ä½ˆ (e.g.æ­£æ…‹åˆ†ä½ˆæ—) é€²è¡Œå……åˆ†å»ºæ¨¡ã€‚</li></ul></li></ul><h2 id="wilcoxon-signed-rank-test">Wilcoxon signed-rank test</h2><p>The Wilcoxon signed-rank test is a <strong>non-parametric rank test</strong> for statistical hypothesis testing used either to test the location of a population based on a sample of data, or to compare the locations of two populations using two matched samples.</p><ul><li><a href="https://mengte.online/archives/333">å•æ ·æœ¬Wilcoxonç¬¦å·ç§©æ£€éªŒ(One Sample Wilcoxon Signed Rank Test)â€”â€”ç†è®ºä»‹ç»</a></li><li><a href="https://mengte.online/archives/12539">å•æ ·æœ¬Wilcoxonç¬¦å·ç§©æ£€éªŒ(One Sample Wilcoxon Signed Rank Test)â€”â€”Pythonè½¯ä»¶å®ç°</a></li><li><a href="https://mengte.online/archives/340">é…å¯¹æ ·æœ¬Wilcoxonç¬¦å·ç§©æ£€éªŒ(Paired Samples Wilcoxon Signed Rank Test)â€”â€”ç†è®ºä»‹ç»</a></li><li><a href="https://mengte.online/archives/12555">é…å¯¹æ ·æœ¬Wilcoxonç¬¦å·ç§©æ£€éªŒ(Paired Samples Wilcoxon Signed Rank Test)â€”â€”Pythonè½¯ä»¶å®ç°</a></li><li><a href="https://statistics-using-python.blogspot.com/2019/08/wilcoxon-signed-rank-wilcoxon-signed.html">å…©çµ„æˆå°è³‡æ–™Wilcoxon signed-rankæª¢å®š (Wilcoxon signed-rank test for paired samplesï¼Œnon-parametric)</a></li></ul><h1 id="applications">Applications</h1><ul><li><a href="https://www.ecmwf.int/en/elibrary/78783-significance-changes-medium-range-forecast-scores">Significance of changes in medium-range forecast scores | ECMWF | 2015</a><ul><li>By making an independent realisation of the null distribution used in the hypothesis testing, using 1,885 paired forecasts (about 2.5 years of testing), it is possible to construct an alternative significance test that makes no statistical assumptions about the data.</li><li>A main issue is that <strong>chaotic error growth</strong> leads to large differences in skill between any two forecasts.</li><li>This study focuses on medium-range (day 3 to day 10 here) extratropical forecast scores of which the quintessential example is the <strong>root-mean-square (RMS) error in 500 hPa geopotential height</strong>.</li><li>The RMS error as a function of lead-time (Fig. 2) illustrates the rapid baroclinic error growth in midlatitudes.</li><li>As mentioned, <strong>the usual basis of significance testing</strong> is to create a <strong>population of paired differences</strong> in scores between an experiment and a control (e.g. Wilks, 2006).</li><li>** It can also be used to create an entirely <strong>non-parametric significance test, i.e. one that makes no assumptions on the distributions of forecast scores</strong>.</li><li>The solution (Fisher, 1998; Wilks, 2006) is to look at the paired differences,</li><li>The time-autocorrelation between paired differences at day-5 is 0.15 for base times separated by 12 h and 0.07 for separations of 24 h. Autocorrelation is essentially zero for any longer period.</li><li>However, for now we will assume that <strong>taking paired differences</strong> has created a statistical population that has sufficiently little autocorrelation that a normal t-test can be used to test for statistical significance.</li></ul></li><li><a href="https://www.ecmwf.int/en/newsletter/178/earth-system-science/improved-two-metre-temperature-forecasts-2024-upgrade">Improved two-metre temperature forecasts in the 2024 upgrade | ECMWF | 2024</a><ul><li>The grey rectangles show 95% confidence intervals</li></ul></li></ul><p><img src="https://www.ecmwf.int/sites/default/files/styles/wide/public/2024-01/NL-178-M2-Ingleby-Figure-7.jpg?itok=b-FTGlu4" /></p><h1 id="references">References</h1><ol type="1"><li><a href="https://notebook.community/therealAJ/python-sandbox/data-science/learning/ud1/DataScience/TTest">T-Tests and P-Values</a></li><li><a href="https://haosquare.com/normal-distribution-central-limit-theorem-t-test/">(<strong>æ¨è–¦</strong>)| t æª¢å®šèˆ‡ä¸­å¤®æ¥µé™å®šç†ï¼šä½ çœŸçš„æ‡‚å¸¸æ…‹åˆ†ä½ˆå—ï¼Ÿ</a></li><li><a href="https://www.cnblogs.com/IvyWong/p/10134012.html">ä½¿ç”¨ Python è¿›è¡Œ Tæ£€éªŒ</a><ol type="1"><li>å•æ ·æœ¬Tæ£€éªŒ(ttest_1samp)</li><li>ä¸¤ç‹¬ç«‹æ ·æœ¬Tæ£€éªŒ(ttest_ind)</li><li>é…å¯¹æ ·æœ¬Tæ£€éªŒ(ttest_rel)</li></ol></li><li><a href="https://medium.com/@jason8410271027/%E5%AD%B8%E7%BF%92%E7%AD%86%E8%A8%98-%E7%8D%A8%E7%AB%8B%E6%A8%A3%E6%9C%ACt%E6%AA%A2%E5%AE%9A-%E7%90%86%E8%AB%96-python%E5%AF%A6%E4%BD%9C-146699cf0bd9">ã€å­¸ç¿’ç­†è¨˜ã€‘ç¨ç«‹æ¨£æœ¬tæª¢å®š-ç†è«–+Pythonå¯¦ä½œ</a></li><li><a href="https://blog.udn.com/nilnimest/844041900">çœ‹é›»å½±å­¸çµ±è¨ˆ: på€¼çš„é™·é˜±</a></li><li><a href="https://chih-sheng-huang821.medium.com/%E7%B5%B1%E8%A8%88%E5%AD%B8-%E5%A4%A7%E5%AE%B6%E9%83%BD%E5%96%9C%E6%AD%A1%E5%95%8F%E7%9A%84%E7%B3%BB%E5%88%97-p%E5%80%BC%E6%98%AF%E4%BB%80%E9%BA%BC-2c03dbe8fddf">çµ±è¨ˆå­¸:å¤§å®¶éƒ½å–œæ­¡å•çš„ç³»åˆ—-på€¼æ˜¯ä»€éº¼</a></li><li><a href="https://www.jmp.com/zh_tw/statistics-knowledge-portal/t-test.html">t æª¢å®š</a></li><li>Wilks, D. S. (2006, 2011). Statistical methods in the atmospheric sciences. Academic press.</li></ol>]]></content>
    
    
    <categories>
      
      <category>Maths</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NWP</tag>
      
      <tag>AI</tag>
      
      <tag>ML</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>CFD | OpenFOAM | In parallel</title>
    <link href="/2024/12/04/openfoam-in-parallel/"/>
    <url>/2024/12/04/openfoam-in-parallel/</url>
    
    <content type="html"><![CDATA[<h1 id="running-applications-in-parallel">Running applications in parallel</h1><div class="note note-danger">            <p>Both <strong>domain decomposition and reconstruction processes</strong> can only be done on a <strong>single core</strong>.</p>          </div><p>This section describes how to run OpenFOAM in parallel on distributed processors.</p><div class="note note-danger">            <p>The method of parallel computing used by OpenFOAM is known as <strong>domain decomposition</strong>, in which the geometry and associated fields are broken into pieces and allocated to separate processors for solution.</p>          </div><p>The process of parallel computation involves: decomposition of mesh and fields; running the application in parallel; and, post-processing the decomposed case as described in the following sections. The parallel running uses the public domain <strong>openMPI</strong> implementation of the standard message passing interface (MPI).</p><h2 id="decomposition-of-mesh-and-initial-field-data">Decomposition of mesh and initial field data</h2><ul><li>The mesh and fields are decomposed using the decomposePar utility.</li><li>The geometry and fields are broken up according to a set of parameters specified in a dictionary named <code>decomposeParDict</code> that must be located in the <code>system</code> directory of the case of interest.</li></ul><p>An example <code>decomposeParDict</code> dictionary can be copied from the <code>interFoam/damBreak/damBreak</code> tutorial if the user requires one; the dictionary entries within it are reproduced below:</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-number">17</span> numberOfSubdomains <span class="hljs-number">8</span>;<br><span class="hljs-number">18</span><br><span class="hljs-number">19</span> method          simple;<br><span class="hljs-number">20</span><br><span class="hljs-number">21</span> simpleCoeffs<br><span class="hljs-number">22</span> &#123;<br><span class="hljs-number">23</span>     <span class="hljs-built_in">n</span>           (<span class="hljs-number">4</span> <span class="hljs-number">1</span> <span class="hljs-number">2</span>);<br><span class="hljs-number">24</span> &#125;<br><span class="hljs-number">25</span><br><span class="hljs-number">26</span> <span class="hljs-comment">// ******************************* //</span><br></code></pre></td></tr></table></figure><figure><img src="https://i.imgur.com/rxTVXxT.png" alt="&quot;simple&quot; geometric decomposition" width="600" /><figcaption>"simple" geometric decomposition</figcaption></figure><p>The user has a choice of four methods of decomposition, specified by the method keyword as described below.</p><ul><li><code>simple</code><ul><li>Simple geometric decomposition in which the domain is split into pieces by direction.</li></ul></li><li><code>hierarchical</code><ul><li>Hierarchical geometric decomposition which is the same as simple except the user specifies the order in which the directional split is done.</li></ul></li><li><code>scotch</code><ul><li>Scotch decomposition which requires no geometric input from the user and attempts to minimise the number of processor boundaries. The user can specify a weighting for the decomposition between processors, through an optional processorWeights keyword which can be useful on machines with differing performance between processors. There is also an optional keyword entry strategy that controls the decomposition strategy through a complex string supplied to Scotch. For more information, see the source code file: <code>$FOAM_SRC/parallel/decompose/scotchDecomp/scotchDecomp.C</code></li></ul></li><li><code>manual</code><ul><li>Manual decomposition, where the user directly specifies the allocation of each cell to a particular processor.</li></ul></li></ul><p>For each method there are a set of coefficients specified in a sub-dictionary of <code>decompositionDict</code>, named <code>&lt;method&gt;Coeffs</code> as shown in the dictionary listing.</p><h3 id="docs-and-github-code">Docs and github code:</h3><ul><li>Ref: <a href="https://www.openfoam.com/documentation/guides/latest/doc/openfoam-guide-parallel.html">The decomposeParDict | OpenFOAM: User Guide</a></li><li><a href="https://github.com/OpenFOAM/OpenFOAM-4.x/blob/master/applications/utilities/parallelProcessing/decomposePar/decomposeParDict">decomposeParDict code</a></li></ul><table><thead><tr class="header"><th style="text-align: left;"><strong>Name</strong></th><th style="text-align: left;"><strong>Class</strong></th></tr></thead><tbody><tr class="odd"><td style="text-align: left;">none</td><td style="text-align: left;">Foam::noDecomp</td></tr><tr class="even"><td style="text-align: left;">manual</td><td style="text-align: left;">Foam::manualDecomp</td></tr><tr class="odd"><td style="text-align: left;">simple</td><td style="text-align: left;">Foam::simpleGeomDecomp</td></tr><tr class="even"><td style="text-align: left;">hierarchical</td><td style="text-align: left;">Foam::hierarchGeomDecomp</td></tr><tr class="odd"><td style="text-align: left;">kahip</td><td style="text-align: left;">Foam::kahipDecomp</td></tr><tr class="even"><td style="text-align: left;">metis</td><td style="text-align: left;">Foam::metisDecomp</td></tr><tr class="odd"><td style="text-align: left;">scotch</td><td style="text-align: left;">Foam::scotchDecomp</td></tr><tr class="even"><td style="text-align: left;">structured</td><td style="text-align: left;">Foam::structuredDecomp</td></tr><tr class="odd"><td style="text-align: left;">multiLevel</td><td style="text-align: left;">Foam::multiLevelDecomp</td></tr></tbody></table><p>If using metis,</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs c++">numberOfSubdomains   N;<br>method               metis;<br><br>metisCoeffs<br>&#123;<br>    method           k-way;  <span class="hljs-comment">// recursive or k-way</span><br>    <span class="hljs-built_in">options</span>          ( ...);<br>    <span class="hljs-built_in">processorWeights</span> ( ... );<br>&#125;<br></code></pre></td></tr></table></figure><p>error,</p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs console"><span class="hljs-meta prompt_">--&gt; </span><span class="language-bash">FOAM FATAL ERROR:</span> <br>You are trying to use metis but do not have the metisDecomp library loaded.<br>This message is from the dummy metisDecomp stub library instead.<br><br>Please install metis and make sure that libmetis.so is in your LD_LIBRARY_PATH.<br>The metisDecomp library can then be built from $FOAM_SRC/parallel/decompose/metisDecomp and dynamically loading or linking this library will add metis as a decomposition method.<br>Please be aware that there are license restrictions on using Metis.<br><br>    From function Foam::List&lt;signed int&gt; Foam::metisDecomp::decompose(const Foam::polyMesh &amp;, const Foam::Field&lt;Foam::Vector&lt;double&gt;&gt; &amp;, const Foam::Field&lt;double&gt; &amp;)<br>    in file dummyMetisDecomp.C at line 93.<br><br>FOAM exiting<br></code></pre></td></tr></table></figure><h2 id="run.sh-script">run.sh script</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">## Loading OpenFOAM environment</span><br><br><span class="hljs-comment"># NP=Number of cores available in the system.</span><br><span class="hljs-built_in">export</span> NP=$(<span class="hljs-built_in">nproc</span>)<br><br><span class="hljs-comment"># Create decomposeParDict file to support $NP number of processes.</span><br><span class="hljs-built_in">cp</span> system/decomposeParDict.6 system/decomposeParDict.<span class="hljs-variable">$&#123;NP&#125;</span><br><br><span class="hljs-comment"># Change the numberOfSubdomains in decomposeParDict to create $NP number of subdomains</span><br>sed -i <span class="hljs-string">&quot;s/numberOfSubdomains.*/numberOfSubdomains <span class="hljs-variable">$&#123;NP&#125;</span>;/&quot;</span> system/decomposeParDict.<span class="hljs-variable">$&#123;NP&#125;</span><br><br><span class="hljs-comment">#Change the grid size for $NP, here setting grid size for 192 core system (48*4*1)</span><br>sed -i <span class="hljs-string">&quot;s/ n           (3 2 1)/ n           (48 4 1);/&quot;</span> system/decomposeParDict.<span class="hljs-variable">$&#123;NP&#125;</span><br><br><span class="hljs-comment">#Default Mesh size is very small (0.35M cells), scaling up the Mesh size to 20M cells</span><br>sed -i <span class="hljs-string">&quot;s/(20 8 8)/(100 40 40)/&quot;</span> system/blockMeshDict<br><br><span class="hljs-comment">#To use the file &quot;system/decomposeParDict.$&#123;NP&#125;&quot; in Allrun (run script)</span><br>sed -i <span class="hljs-string">&quot;s#system/decomposeParDict.6#system/decomposeParDict.<span class="hljs-variable">$&#123;NP&#125;</span>#&quot;</span> Allrun<br><br><span class="hljs-comment">#To run the benchmark</span><br><span class="hljs-comment">#Allrun script executes a combination multiple steps</span><br><span class="hljs-comment">#like Mesh creation, Setting the initial fields, Running the application, Postprocessing etc.</span><br>./Allrun<br></code></pre></td></tr></table></figure><h2 id="decomposepar"><code>decomposePar</code></h2><p>The <code>decomposePar</code> utility is executed in the normal manner by typing</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">decomposePar<br></code></pre></td></tr></table></figure><p>On completion, a set of subdirectories will have been created, one for each processor, in the case directory. The directories are named <code>processorN</code> represents a processor number and contains a time directory, containing the decomposed field descriptions, and a <code>constant/polyMesh</code> directory containing the decomposed mesh description.</p><h2 id="example-motorbike">Example, <code>motorBike</code></h2><ul><li><code>./Allrun</code></li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/sh</span><br><span class="hljs-built_in">cd</span> <span class="hljs-variable">$&#123;0%/*&#125;</span> || <span class="hljs-built_in">exit</span> 1    <span class="hljs-comment"># Run from this directory</span><br><br><span class="hljs-comment"># Source tutorial run functions</span><br>. <span class="hljs-variable">$WM_PROJECT_DIR</span>/bin/tools/RunFunctions<br><br><span class="hljs-comment"># Copy motorbike surface from resources directory</span><br><span class="hljs-built_in">cp</span> <span class="hljs-variable">$FOAM_TUTORIALS</span>/resources/geometry/motorBike.obj.gz constant/triSurface/<br>runApplication surfaceFeatures<br><br>runApplication blockMesh<br><br>runApplication decomposePar -copyZero<br>runParallel snappyHexMesh -overwrite<br><br>runParallel patchSummary<br>runParallel potentialFoam<br>runParallel $(getApplication)<br><br>runApplication reconstructParMesh -constant<br>runApplication reconstructPar -latestTime<br></code></pre></td></tr></table></figure><p>and outputs are,</p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs console"><br>Cleaning /home/wpsze/openfoam/openfoam8/run/motorBike case<br>Running surfaceFeatures on /home/wpsze/openfoam/openfoam8/run/motorBike<br>Running blockMesh on /home/wpsze/openfoam/openfoam8/run/motorBike<br>Running decomposePar on /home/wpsze/openfoam/openfoam8/run/motorBike<br>Running snappyHexMesh in parallel on /home/wpsze/openfoam/openfoam8/run/motorBike using 6 processes<br>Running patchSummary in parallel on /home/wpsze/openfoam/openfoam8/run/motorBike using 6 processes<br>Running potentialFoam in parallel on /home/wpsze/openfoam/openfoam8/run/motorBike using 6 processes<br>Running simpleFoam in parallel on /home/wpsze/openfoam/openfoam8/run/motorBike using 6 processes<br>Running reconstructParMesh on /home/wpsze/openfoam/openfoam8/run/motorBike<br>Running reconstructPar on /home/wpsze/openfoam/openfoam8/run/motorBike<br><br>real5m5.399s<br>user27m17.537s<br>sys0m22.050s<br>=====================<br>Total of 311 seconds elapsed for process<br>Total of 5 minutes elapsed for process<br>=====================<br></code></pre></td></tr></table></figure><h1 id="post-processing-parallel-processed-cases">Post-processing parallel processed cases</h1><p>When post-processing cases that have been run in parallel the user can:</p><ul><li>reconstruct the mesh and field data to recreate the complete domain and fields, which can be post-processed as normal;</li><li>post-process each segment of decomposed domain individually; or</li><li>use ParaView via the option paraFoam -vtk and select the decomposedCase from the GUI whereby the case will be assembled internally</li></ul><h2 id="reconstructing-mesh-and-data">Reconstructing mesh and data</h2><p>The <code>reconstructPar</code> utility performs such a reconstruction by executing the command:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">reconstructPar<br></code></pre></td></tr></table></figure><p>Executing <code>reconstructPar</code> without any additional options will process all stored time directories.</p><h1 id="issues">Issues</h1><ul><li><a href="https://cfd-china.com/topic/3170/openfoam%E5%9C%A8%E5%B9%B6%E8%A1%8C%E8%BF%90%E7%AE%97%E7%BB%93%E6%9D%9F%E5%90%8E-%E8%83%BD%E5%90%A6%E5%B9%B6%E8%A1%8Creconstructpar-%E6%88%96%E8%80%85%E6%9C%89%E6%B2%A1%E6%9C%89%E5%85%B6%E4%BB%96%E6%96%B9%E6%B3%95%E8%83%BD%E5%A4%9F%E5%8A%A0%E5%BF%ABreconstructpar">OpenFOAMåœ¨å¹¶è¡Œè¿ç®—ç»“æŸå èƒ½å¦å¹¶è¡ŒreconstructParï¼Ÿæˆ–è€…æœ‰æ²¡æœ‰å…¶ä»–æ–¹æ³•èƒ½å¤ŸåŠ å¿«reconstructParï¼Ÿ</a><ul><li>æœ€è¿‘è·‘äº†å‡ ä¸ªç½‘æ ¼æ€»æ•°æ¯”è¾ƒå¤§çš„æ¡ˆä¾‹ï¼ˆå¤§æ¦‚500w~1000wï¼‰ï¼Œå¹¶è¡Œè®¡ç®—ç»“æŸåï¼Œæ‰§è¡Œäº†reconstructParè¿›è¡Œé‡æ„ï¼Œä½†æ˜¯é‡æ„æ—¶é—´ç‰¹åˆ«é•¿ã€‚</li><li>è¯•è¯•è¿™ä¸ª <code>mpirun -np 2 redistributePar -reconstruct -parallel</code></li><li>å°è±¡ä¸­ä»¥å‰çœ‹ä¸€ä¸ªåŸ¹è®­ææ–™è¯´åˆ†å—å’Œé‡æ„éƒ½åªèƒ½å•æ ¸</li><li>openfoamçš„decomposeParã€reconstructParæ˜¯ä¸ªè€å¤§éš¾ã€‚è¿™ä¸ªåº”è¯¥éœ€è¦å¤§å¹…åº¦çš„fundä»–ä»¬æ‰ä¼šè§£å†³ã€‚ç›®å‰ä»–ä»¬å¯¹è¿™æ–¹é¢è¿˜æ²¡æœ‰è¿«åˆ‡çš„å¤„ç†éœ€æ±‚ã€‚ç›®å‰openfoamé’ˆå¯¹reconstructParè¿™é¢çš„å¤„ç†æ–¹å¼æ˜¯åå¤„ç†ä¹Ÿæ˜¯å¹¶è¡Œæ¥æï¼Œparaviewç›´æ¥çœ‹decomposeçš„æ•°æ®ï¼Œå„ç§postProcessä¹Ÿéƒ½æ˜¯å¹¶è¡Œæ¥ã€‚é’ˆå¯¹decomposeParæ…¢çš„é—®é¢˜ï¼Œopenfoamè¿™é¢æ˜¯ç”»ç½‘æ ¼snappyHexMeshç›´æ¥å¹¶è¡Œæ¥ã€‚æ‰€ä»¥æˆ‘è¿™é¢å°è¯•å¤„ç†2ä¸ªäº¿ç½‘æ ¼ï¼Œä»ç”Ÿæˆåˆ°è®¡ç®—ï¼Œä¹Ÿè¿˜å¯ä»¥ã€‚ä½†æ˜¯å¦‚æœæ˜¯ç¬¬ä¸‰æ–¹ç”Ÿæˆçš„2ä¸ªäº¿ç½‘æ ¼ï¼Œéœ€è¦decomposeParï¼Œé‚£å¯å°±æ…¢äº†</li></ul></li></ul><h1 id="references">References</h1><ol type="1"><li><a href="https://www.openfoam.com/documentation/user-guide/3-running-applications/3.2-running-applications-in-parallel">3.2 Running applications in parallel</a></li><li><a href="https://hprc.tamu.edu/files/training/2024/Spring/Instructions_for_OpenFOAM_2024_spring.pdf">Instructions_for_OpenFOAM_2024_spring</a></li><li><a href="https://www.amd.com/zh-tw/developer/zen-software-studio/applications/spack/hpc-applications-openfoam.html">Build OpenFOAM using Spack</a></li><li><a href="https://www.openfoam.com/documentation/guides/latest/doc/openfoam-guide-parallel.html">The decomposeParDict | OpenFOAM: User Guide</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>CFD</category>
      
    </categories>
    
    
    <tags>
      
      <tag>HPC</tag>
      
      <tag>OpenFOAM</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>CFD | OpenFOAM | Notes/Blogs</title>
    <link href="/2024/12/04/openfoam-notes/"/>
    <url>/2024/12/04/openfoam-notes/</url>
    
    <content type="html"><![CDATA[<h1 id="notesblogs-ç­†è¨˜éƒ¨è½æ ¼åˆ—è¡¨">Notes/Blogs ç­†è¨˜/éƒ¨è½æ ¼åˆ—è¡¨</h1><ol type="1"><li><a href="https://www.diva-portal.org/smash/get/diva2:1458913/FULLTEXT01.pdf">CFD study and method development for air intake systems using OpenFOAM 2020 | GIOVANNI CALZOLARI</a><ol type="1"><li>KTH ROYAL INSTITUTE OF TECHNOLOGY SCHOOL OF ENGINEERING SCIENCES</li></ol></li><li><a href="https://blog.iaac.net/urban-wind-flow-modeling-with-pinns/?utm_source=perplexity">Urban Wind Flow Modeling with PINNs</a><ol type="1"><li>Data Sources<ol type="1"><li>Real-Time Wind Data: <code>OpenWeatherMap</code> wind conditions.</li><li>3D Building Models: <code>OpenStreetMap (OSM)</code> data using Overpass API.</li></ol></li><li><code>NVIDIA Modulus</code> and <code>PyTorch</code> are employed</li></ol></li></ol>]]></content>
    
    
    <categories>
      
      <category>CFD</category>
      
    </categories>
    
    
    <tags>
      
      <tag>HPC</tag>
      
      <tag>OpenFOAM</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Bash | Measure the execution time</title>
    <link href="/2024/12/04/bash-Measure-the-execution-time/"/>
    <url>/2024/12/04/bash-Measure-the-execution-time/</url>
    
    <content type="html"><![CDATA[<h1 id="measure-the-execution-time">Measure the execution time</h1><h2 id="time"><code>time</code></h2><p>The <code>time</code> that you are using is the bash shell built in <code>time</code> which the only option is <code>-p</code></p><p>The command "time" report a execution time information</p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs console">time sleep 1<br><br>Output:<br>real 0m1.001s<br>user 0m0.000s<br>sys 0m0.001s<br></code></pre></td></tr></table></figure><p>Description:</p><ul><li><code>Real</code> - time from start to finish.</li><li><code>User</code> - the amount of CPU time spent in use-mode. It is actual CPU time used in executing the process.</li><li><code>Sys</code> - the amount of CPU time spent in kernel.</li></ul><h2 id="date-s"><code>date +%s</code></h2><p>You can measure execution time by subtraction start date and end date:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># time elapsed</span><br>start_time=<span class="hljs-string">&quot;<span class="hljs-subst">$(date -u +%s)</span>&quot;</span><br><br>commands...<br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=====================&quot;</span><br>end_time=<span class="hljs-string">&quot;<span class="hljs-subst">$(date -u +%s)</span>&quot;</span><br>elapsed=<span class="hljs-string">&quot;<span class="hljs-subst">$(($end_time-$start_time)</span>)&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Total of <span class="hljs-variable">$elapsed</span> seconds elapsed for process&quot;</span><br>time_mins=<span class="hljs-string">&quot;<span class="hljs-subst">$(($elapsed /60)</span>)&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Total of <span class="hljs-variable">$time_mins</span> minutes elapsed for process&quot;</span><br>time_hours=<span class="hljs-string">&quot;<span class="hljs-subst">$(($elapsed /60/60)</span>)&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Total of <span class="hljs-variable">$time_hours</span> hours elapsed for process&quot;</span> <br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=====================&quot;</span><br></code></pre></td></tr></table></figure><h1 id="log-21"><code>&gt; log 2&gt;&amp;1 &amp;</code></h1><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs console"><span class="hljs-meta prompt_">$ </span><span class="language-bash">time ./Allrun &gt; output_file.txt 2&gt;&amp;1 &amp;</span> <br></code></pre></td></tr></table></figure><h1 id="tee"><code>tee</code></h1><p>It basically breaks the output of a program so that it can be <strong>both displayed and saved in a file</strong>. It does both the tasks simultaneously, copies the result into the specified files or variables and also display the result.</p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs console"><span class="hljs-meta prompt_">$ </span><span class="language-bash">time ./Allrun | <span class="hljs-built_in">tee</span> output_file.txt</span> <br></code></pre></td></tr></table></figure><p><img src="https://media.geeksforgeeks.org/wp-content/uploads/tee-command-linux.jpg" width="600" /></p><h1 id="references">References</h1><ol type="1"><li><a href="https://www.geeksforgeeks.org/tee-command-linux-example/">tee command in Linux with examples</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>Bash</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
      <tag>Bash</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>LaTex | Formula Recognition | æ•¸å­¸å…¬å¼è­˜åˆ¥è»Ÿé«”</title>
    <link href="/2024/12/04/latex-Formula-Recognition/"/>
    <url>/2024/12/04/latex-Formula-Recognition/</url>
    
    <content type="html"><![CDATA[<h1 id="æ•¸å­¸å…¬å¼è­˜åˆ¥è»Ÿé«”-simpletex">æ•¸å­¸å…¬å¼è­˜åˆ¥è»Ÿé«” SimpleTex</h1><p>ç•¶éœ€è¦ç·¨è¼¯å¤§é‡æ•¸å­¸å…¬å¼æ™‚ï¼Œå¦‚æœæœ‰ä¸€æ¬¾è»Ÿé«”èƒ½å¤ è­˜åˆ¥å…¬å¼åœ–ç‰‡è‡ªå‹•ç”¢ç”Ÿ Latex/Word å…¬å¼ï¼Œé€™å°‡æ¥µå¤§çš„æ¸›å°‘æˆ‘å€‘çš„å·¥ä½œé‡ã€‚</p><p>æœ€è¿‘åœ¨ç¶²è·¯ä¸Šæ‰¾åˆ°SimpleTexé€™æ¬¾è»Ÿé«”ï¼Œæ”¯æ´è‡ªå‹•è¾¨è­˜åœ–ç‰‡å…¬å¼ã€æ‰‹å¯«æ¿å…¬å¼è¾¨è­˜åŠŸèƒ½ï¼Œè©¦ç”¨ä¸€æ®µæ™‚é–“æ„Ÿè¦ºé‚„å¯ä»¥ã€‚</p><p>å°ˆæ¡ˆç¶²å€ï¼š<a href="https://simpletex.cn/" class="uri">https://simpletex.cn/</a></p><p>SimpleTex ç›®å‰æä¾› Win å’Œ Mac å¹³å°è»Ÿé«”å®‰è£ç‰ˆï¼Œä¹Ÿæä¾›ç¶²é ç‰ˆåŠŸèƒ½<a href="https://simpletex.cn/ai/latex_ocr" class="uri">https://simpletex.cn/ai/latex_ocr</a>ï¼Œå¯ä»¥å…ˆåœ¨ç¶²é ä¸Šè©¦ç”¨ï¼Œæ»¿è¶³éœ€æ±‚çš„è©±å¯ä»¥è€ƒæ…®å®‰è£æœ¬åœ°è»Ÿé«”ç‰ˆæœ¬ã€‚</p><p><img src="https://i.imgur.com/Yh12yDl.png" width="600" /> <img src="https://i.imgur.com/P17jVOa.png" width="600" /></p><h1 id="mathpix-snip">Mathpix Snip</h1><p>Mathpixï¼šMathpixæ˜¯å°ˆæ¥­çš„æ•¸å­¸å…¬å¼è¾¨è­˜å·¥å…·ï¼Œå¯å°‡æ‹æ”çš„æ•¸å­¸å…¬å¼è½‰æ›ç‚º LaTeX ç¨‹å¼ç¢¼æˆ– MathM Læ ¼å¼ã€‚å®ƒæ”¯æ´å¤šç¨®è¼¸å…¥æ–¹å¼ï¼ŒåŒ…æ‹¬æ‹ç…§è­˜åˆ¥å’Œæ‰‹å¯«è¼¸å…¥ï¼Œé©ç”¨æ–¼æ•¸å­¸å…¬å¼è­˜åˆ¥è¦æ±‚è¼ƒé«˜çš„ç”¨æˆ¶ã€‚</p><p>Mathpix Snipï¼šMathpix Snipæ˜¯Mathpixçš„å…è²»ç‰ˆæœ¬ï¼Œå¯ä»¥é€éæˆªåœ–çš„æ–¹å¼è­˜åˆ¥æ•¸å­¸å…¬å¼ä¸¦è½‰æ›ç‚ºLaTeXç¨‹å¼ç¢¼ã€‚æ‚¨å¯ä»¥ä½¿ç”¨å®ƒåœ¨é›»è…¦ä¸Šå¿«é€Ÿè­˜åˆ¥ç¶²é æˆ–æ–‡ä»¶ä¸­çš„æ•¸å­¸å…¬å¼ã€‚</p><ul><li><strong>Register</strong>: Now that you have verified your email address, you can start using the Snip apps to easily digitize math and science on your mobile and desktop devices. You are also welcome to use our Snip web app - a full-featured Markdown editor with PDF conversion support. For more information read Mathpix Snip app docs.</li><li><p><strong>Visit</strong> <a href="https://snip.mathpix.com/home" class="uri">https://snip.mathpix.com/home</a></p></li><li>Mathpix for MacOS, Windows &amp; Linux<ul><li><a href="https://mathpix.com/desktop-downloads" class="uri">https://mathpix.com/desktop-downloads</a></li></ul></li></ul><p><img src="https://i.imgur.com/LXfdzEk.png" width="600" /> <img src="https://i.imgur.com/ajciup1.png" width="600" /></p>]]></content>
    
    
    <categories>
      
      <category>LaTex</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>CFD | OpenFOAM | Allrun</title>
    <link href="/2024/12/03/openfoam-Allrun/"/>
    <url>/2024/12/03/openfoam-Allrun/</url>
    
    <content type="html"><![CDATA[<h1 id="allrun">Allrun</h1><p>All OpenFOAM tutorials have <code>Allrun</code> and <code>Allclean</code> scripts which call some mysterious RunFunctions from even more mysterious sources.</p><p>Source OpenFOAM first,</p><div class="note note-danger">            <p>source /home/wpsze/openfoam/openfoam8/source_openfoam.sh</p>          </div><h2 id="the-manual-way">The Manual Way</h2><p>To be honest, one could easily get along without those functions. Just call <code>OpenFOAM</code> applications by their name:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/sh</span><br> <br><span class="hljs-comment"># background mesh for Snappy</span><br>blockMesh &gt; log.blockMesh<br> <br><span class="hljs-comment"># decompose and mesh</span><br>decomposePar -force &gt; log.decomposePar<br>mpirun -np 4 snappyHexMesh -overwrite &gt; log.snappyHexMesh<br>mpirun -np 4 checkMesh &gt; log.checkMesh<br>mpirun -np 4 renumberMesh -overwrite &gt; log.renumberMesh<br> <br><span class="hljs-comment"># see an explanation below</span><br><span class="hljs-built_in">rm</span> -r 0<br><span class="hljs-built_in">cp</span> -r 0.orig 0<br> <br><span class="hljs-comment"># run the solver</span><br>mpirun -np 4 simpleFoam<br></code></pre></td></tr></table></figure><p>As you can see, it works just fine, but it does get a little verbose and repetitive. And if you decide to change the number of processors, you have to edit <code>system/decomposeParDict</code> and every parallel-running application call in all your scripts.</p><h2 id="runfunctions-to-the-rescue"><code>RunFunctions</code> to the Rescue</h2><p>These functions are defined in <code>$WM_PROJECT_DIR/bin/tools/RunFunctions</code> so if you want to use them, you have to tell Bash where they are (<strong>mind the dot at the beginning</strong>):</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/shs</span><br><span class="hljs-built_in">cd</span> <span class="hljs-variable">$&#123;0%/*&#125;</span> || <span class="hljs-built_in">exit</span> 1    <span class="hljs-comment"># run from this directory</span><br><br>. <span class="hljs-variable">$&#123;WM_PROJECT_DIR:?&#125;</span>/bin/tools/RunFunctions<br> <br><span class="hljs-comment"># background mesh for Snappy</span><br>runApplication blockMesh<br> <br><span class="hljs-comment"># decompose and mesh</span><br>runApplication decomposePar -force<br>runParallel snappyHexMesh -overwrite<br>runParallel checkMesh<br>runParallel renumberMesh -overwrite<br> <br><span class="hljs-comment"># restore 0/ directory</span><br>restore0Dir<br> <br><span class="hljs-comment"># run the solver</span><br>runParallel $(getApplication)<br></code></pre></td></tr></table></figure><h3 id="runapplication">runApplication</h3><p><code>runApplication</code> will, as the name suggests, run the specified application.</p><ul><li><strong>It will redirect the appâ€™s output to a log file.</strong></li><li><strong>Also, if the log exists, it will not run!</strong></li><li>If you donâ€™t care about existing logs, you can overwrite it with <code>-o</code> option:<ul><li><code>runApplication -o decomposePar -force</code></li></ul></li><li>If you run the app multiple times and want the same log, append to an existing one with <code>-a</code> option:<ul><li><code>runApplication -a decomposePar -force</code></li></ul></li></ul><h3 id="runparallel">runParallel</h3><p>The same as runApplication but it will first <strong>read</strong> <code>system/decomposeParDict</code> to get number of processors. It will then run your app in parallel with MPI. The same logging options apply as to runApplication.</p><h3 id="getapplication">getApplication</h3><p>This will <strong>read</strong> <code>system/controlDict</code>.application and return that command. You will usually need this just to avoid hard-coding solvers. According to DRY principle, <strong>it is already specified in controlDict and that should be enough</strong>.</p><p>Instead, feed getApplicationâ€™s output to runApplication / runParallel:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">runApplication $(getApplication)<br></code></pre></td></tr></table></figure><p>That saves you quite some steps:</p><ul><li>Matching decomposeParDict.numberOfSubdomains</li><li>Matching controlDict.application</li><li>Invoking MPI</li><li>Keeping log files and whatsit.</li></ul><h3 id="restore0dir">restore0Dir</h3><p>If you run <code>potentialFoam</code>, <code>setFields</code> and similar apps, they <strong>will overwrite boundary conditions</strong> that you meticulously prepared in your <code>0/</code> directory.</p><p>To prevent that from happening, it is wise to keep your boundary conditions in a directory where solvers canâ€™t touch them and copy them to <code>0/</code> just before runs. Itâ€™s easy to do that by hand but <code>restore0Dir</code> will also take care of some other stuff (<code>#include</code> directives, parallel runs, â€¦).</p><p>Anyway, a line saved is a line less to maintain.</p><h1 id="cleanfunctions">CleanFunctions</h1><p>There are more goodies that come in hand with RunFunctions! Type this into shell:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> <span class="hljs-variable">$WM_PROJECT_DIR</span>/bin/tools/CleanFunctions<br></code></pre></td></tr></table></figure><p>and take a scroll through the output to find commands such as:</p><ul><li>cleanDynamicCode</li><li>cleanSnappyFiles</li><li>cleanPostProcessing</li><li>cleanCase</li><li>cleanCase0</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/sh</span><br><span class="hljs-built_in">cd</span> <span class="hljs-variable">$&#123;0%/*&#125;</span> || <span class="hljs-built_in">exit</span> 1    <span class="hljs-comment"># run from this directory</span><br><br><span class="hljs-comment"># Source tutorial clean functions</span><br>. <span class="hljs-variable">$WM_PROJECT_DIR</span>/bin/tools/CleanFunctions<br><br>cleanCase<br></code></pre></td></tr></table></figure><h1 id="references">References</h1><ol type="1"><li><a href="https://damogranlabs.com/2020/10/runfunctions-a-quick-cheatsheet/">RunFunctions: a Quick Cheatsheet</a></li><li><a href="https://ml-cfd.com/openfoam/basic/2020/06/12/3-ways-to-run-tutorials-in-OpenFOAM.html">3 ways to run tutorials in OpenFOAM</a></li><li><a href="https://www.openfoam.com/documentation/user-guide/3-running-applications/3.2-running-applications-in-parallel">3.2 Running applications in parallel</a></li><li><a href="https://www.amd.com/zh-tw/developer/zen-software-studio/applications/spack/hpc-applications-openfoam.html">Build OpenFOAM using Spack</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>CFD</category>
      
    </categories>
    
    
    <tags>
      
      <tag>HPC</tag>
      
      <tag>OpenFOAM</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Linux | ffmpeg </title>
    <link href="/2024/12/02/ffmpeg/"/>
    <url>/2024/12/02/ffmpeg/</url>
    
    <content type="html"><![CDATA[<h1 id="ffmpeg">FFmpeg</h1><p>FFmpeg æ˜¯ä¸€å€‹é–‹æ”¾åŸå§‹ç¢¼çš„è‡ªç”±è»Ÿä»¶ï¼Œå¯ä»¥åŸ·è¡ŒéŸ³é »å’Œè¦–åƒå¤šç¨®æ ¼å¼çš„éŒ„å½±ã€è½‰æª”ã€ä¸²æµåŠŸèƒ½ï¼ŒåŒ…å«äº†libavcodec â€”â€”é€™æ˜¯ä¸€å€‹ç”¨æ–¼å¤šå€‹å°ˆæ¡ˆä¸­éŸ³é »å’Œè¦–åƒçš„è§£ç¢¼å™¨å‡½å¼åº«ï¼Œä»¥åŠlibavformatâ€”â€”ä¸€å€‹éŸ³é »èˆ‡è¦–åƒæ ¼å¼è½‰æ›å‡½å¼åº«ã€‚è©²å°ˆæ¡ˆçš„åç¨±éˆæ„Ÿä¾†æºæ–¼ MPEG å½±ç‰‡æ¨™æº–çµ„ç¹”ï¼Œå…¶ä¸­ã€ŒFFã€ä»£è¡¨ã€Œå¿«é€²ã€ï¼ˆfast forwardï¼‰ï¼Œå› æ­¤FFmpegä»£è¡¨ã€Œå¿«é€²å‹•æ…‹åœ–åƒå°ˆå®¶çµ„ã€ã€‚å…¶æ¨™èªŒæ˜¯ä¸€å€‹ä¹‹å­—å½¢æƒæåœ–æ¡ˆï¼Œé¡¯ç¤ºäº† MPEG å½±ç‰‡ç·¨è§£ç¢¼å™¨å¦‚ä½•è™•ç†ç†µç·¨ç¢¼ã€‚</p><p>å‹•æ…‹å½±åƒå°ˆå®¶å°çµ„ï¼ˆè‹±èªï¼šMoving Picture Experts Groupï¼Œç°¡ç¨±MPEGï¼‰ç‚ºä¸€æºè‡ªåœ‹éš›æ¨™æº–åŒ–çµ„ç¹” (ISO) èˆ‡åœ‹éš›é›»å·¥å§”å“¡æœƒ (IEC) ç­‰åœ‹éš›çµ„ç¹”çš„å·¥ä½œå°çµ„ï¼Œæˆç«‹æ–¼1988å¹´ï¼Œæœ‰è¶…é300åå°ˆå®¶ä¸€èµ·åˆ¶å®šå½±éŸ³å£“ç¸®åŠå‚³è¼¸çš„è¦æ ¼æ¨™æº–ã€‚</p><p>æ­¤è¨ˆåŠƒç”±å¹¾å€‹å…ƒä»¶çµ„æˆï¼šå‘½ä»¤åˆ—æ‡‰ç”¨ç¨‹å¼</p><ul><li><code>ffmpeg</code> : ç”¨æ–¼å°è¦–è¨Šæª”æ¡ˆæˆ–éŸ³é »æª”æ¡ˆè½‰æ›æ ¼å¼</li><li><code>ffplay</code> : ä¸€å€‹ç°¡å–®çš„æ’­æ”¾å™¨ï¼ŒåŸºæ–¼SDLèˆ‡FFmpegå‡½å¼åº«</li><li><code>ffprobe</code> : ç”¨æ–¼é¡¯ç¤ºåª’é«”æª”æ¡ˆçš„è³‡è¨Š</li></ul><h2 id="convert-mp4-to-gif">Convert mp4 to gif</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">ffmpeg -i input.mp4 -pix_fmt rgb24 output.gif<br>ffmpeg -i input.mp4 -pix_fmt gray output.gif<br></code></pre></td></tr></table></figure><h2 id="cuttrim-a-video">Cut/trim a video</h2><p>The fastest and best ffmpeg-based method I have figured out is:</p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs console">ffmpeg -ss 00:01:00 -to 00:08:00 -i input.mp4 -c:v copy -c:a copy output.mp4<br></code></pre></td></tr></table></figure><p>This command trims your video in seconds!</p><p>Also, the <code>-t</code> option specifies a duration, not an end time. The above command will encode 7s of video starting at 1s. To start at 1s and end at 8s use <code>-t 7</code>. If you are using a current version of ffmpeg you can also replace <code>-t</code> with <code>-to</code> in the above command to end at the specified time.</p><p>The <code>-c:v copy -c:a copy</code> commands copy the original audio and video without re-encoding.</p><h2 id="change-the-output-frame-rate"><a href="https://trac.ffmpeg.org/wiki/ChangingFrameRate">Change the output frame rate</a></h2><p>To change the output frame rate to 30 fps, use the following command: <a href="https://ffmpeg.org/ffmpeg-filters.html#fps-1">docs</a></p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs console">ffmpeg -i &lt;input&gt; -filter:v fps=30 &lt;output&gt;<br></code></pre></td></tr></table></figure><h2 id="speeding-upslowing-down-video"><a href="https://trac.ffmpeg.org/wiki/How%20to%20speed%20up%20/%20slow%20down%20a%20video">Speeding up/slowing down video</a></h2><p>To double the speed of the video with the setpts filter, you can use: or<br />To slow down your video, you have to use a multiplier greater than 1:</p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs console">ffmpeg -i input.mp4 -filter:v &quot;setpts=0.5*PTS&quot; output.mp4<br>ffmpeg -i input.mp4 -filter:v &quot;setpts=2.0*PTS&quot; output.mp4<br></code></pre></td></tr></table></figure><h2 id="compress-video">Compress video</h2><h3 id="h264-codec-and-mp4-container">H264 codec and MP4 container</h3><p>To convert the MOV file to MP4 and compress it using the H.264 codec run the following command from the folder you saved the input.mov sample file:</p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs console">ffmpeg -i input.mov -c:v libx264 -pix_fmt yuv420p output.mp4<br></code></pre></td></tr></table></figure><ul><li><code>-i input.mov</code> : - specifies the input video file.</li><li><code>-c:v libx264</code> : - sets the video compression codec to H.264 (libx264).</li><li><code>-pix_fmt yuv420p</code> : - changes the ProRes pixel format (4:2:2) to H.264 compatible pixel format (4:2:0). output.mp4 - the name of the output file.</li></ul><h3 id="h265-codec-and-mp4-container">H265 codec and MP4 container</h3><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs console">ffmpeg -i input.mov -c:v libx265 -pix_fmt yuv420p output.mp4<br></code></pre></td></tr></table></figure><h3 id="using-constant-rate-factor-crf-to-compress-the-video">Using Constant Rate Factor (CRF) to compress the video</h3><p>The command looks like this, with the -crf 28 option added:</p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs console">ffmpeg -i input.mov -c:v libx264 -pix_fmt yuv420p -crf 28 output.mp4<br></code></pre></td></tr></table></figure><h3 id="optimising-the-compression-and-encoding-settings">Optimising the compression and encoding settings</h3><p>There are many other command-line options that we can use to configure how FFmpeg performs the compression. Consider this command:</p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs console">ffmpeg -i input.mov -c:v libx264  -pix_fmt yuv420p -crf 28 -preset fast -tune zerolatency -c:a aac output.mp4<br></code></pre></td></tr></table></figure><h3 id="compress-video-by-reducing-the-resolution">Compress video by reducing the resolution</h3><p>Reducing the video width and height (input.mov file is 1920px x 1080px,)</p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs console">ffmpeg -i input.mov -c:v libx264 -pix_fmt yuv420p -crf 28 -vf scale=1280:720 output.mp4<br></code></pre></td></tr></table></figure><p>It is also common to maintain the aspect ratio of the video so it does not become distorted. To do this we can use the scale filter with a <code>-1</code> value, which will automatically calculate the correct height or width based on the other dimension. Like this:</p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs console">ffmpeg -i input.mov -c:v libx264 -pix_fmt yuv420p -crf 28 -vf scale=-1:720 output.mp4<br></code></pre></td></tr></table></figure><p>This will resize the height to 720px, while maintaining the original aspect ratio of the video.</p><h3 id="compress-video-by-reducing-the-bitrate">Compress video by reducing the bitrate</h3><p>Reducing video bitrate</p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs console">ffmpeg -i input.mov -c:v libx264 -pix_fmt yuv420p -b:v 1000k -vf scale=-1:720 output.mp4<br></code></pre></td></tr></table></figure><p>Here, we replace the <code>-crf</code> parameter and use the <code>-b:v 1000k</code> option to set the video bitrate to 1000 Kbps.</p><p>Reducing audio bitrate</p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs console">ffmpeg -i input.mov -c:v libx264 -pix_fmt yuv420p -b:v 1000k -b:a 128k -vf scale=-1:720 output.mp4<br></code></pre></td></tr></table></figure><p>We added the <code>-b:a 128k</code> to set the audio bitrate to 128 Kbps. This won't have any effect on our sample video as it doesn't have any audio.</p><h1 id="references">References</h1><ol type="1"><li><a href="https://www.ffmpeg.org/documentation.html">ffmpeg.org | Documentation</a></li><li><a href="https://shotstack.io/learn/compress-video-ffmpeg/">How to compress video using FFmpeg</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ffmpeg</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>CFD | SIMPLE ç®—æ³•</title>
    <link href="/2024/11/26/CFD-SIMPLE-algorithm/"/>
    <url>/2024/11/26/CFD-SIMPLE-algorithm/</url>
    
    <content type="html"><![CDATA[<h1 id="ä¸å¯å£“ç¸®-navier-stokes-æ–¹ç¨‹"><strong>ä¸å¯å£“ç¸® Navier-Stokes æ–¹ç¨‹</strong></h1><p>å°æ–¼ä¸å¯å£“ç¸®Navier-Stokesæ–¹ç¨‹ï¼Œå¯ä»¥è¡¨ç¤ºç‚ºï¼š</p><h2 id="å‹•é‡æ–¹ç¨‹"><strong>å‹•é‡æ–¹ç¨‹ï¼š</strong></h2><p><span class="math display">\[\rho \frac{\partial \mathbf{u}}{\partial t} + \rho (\mathbf{u} \cdot \nabla) \mathbf{u} = -\nabla p + \mu \nabla^2 \mathbf{u} + \mathbf{f}\]</span></p><h2 id="ç©©ç‹€"><strong>ç©©ç‹€:</strong></h2><p><span class="math display">\[\frac{\partial \mathbf{u}}{\partial t} = 0\]</span></p><h2 id="é€£çºŒæ–¹ç¨‹"><strong>é€£çºŒæ–¹ç¨‹ï¼š</strong></h2><p><span class="math display">\[\nabla \cdot \mathbf{u} = 0\]</span></p><p>å¼ä¸­æœ‰ 4 å€‹å¾…æ±‚çš„ç‰©ç†é‡ï¼š</p><ul><li><span class="math inline">\(\mathbf{u}_x\)</span>ï¼šåœ¨ <span class="math inline">\(x\)</span> æ–¹å‘çš„é€Ÿåº¦åˆ†é‡ï¼Œ</li><li><span class="math inline">\(\mathbf{u}_y\)</span>ï¼šåœ¨ <span class="math inline">\(y\)</span> æ–¹å‘çš„é€Ÿåº¦åˆ†é‡ï¼Œ</li><li><span class="math inline">\(\mathbf{u}_z\)</span>ï¼šåœ¨ <span class="math inline">\(z\)</span> æ–¹å‘çš„é€Ÿåº¦åˆ†é‡ï¼Œ</li><li><span class="math inline">\(p\)</span>ï¼šå£“åŠ›ã€‚</li></ul><p>å…¶ä¸­ï¼š</p><ul><li><span class="math inline">\(p\)</span> ç‚ºå£“åŠ›ï¼ˆpressureï¼‰ï¼Œ</li><li><span class="math inline">\(\mu\)</span> ç‚ºé‹å‹•é»åº¦ï¼ˆdynamic viscosityï¼‰ï¼Œ</li><li><span class="math inline">\(\rho\)</span> ç‚ºæµé«”å¯†åº¦ï¼Œ</li><li><span class="math inline">\(\mathbf{f}\)</span> ç‚ºé«”ç©åŠ›ï¼Œä¾‹å¦‚é‡åŠ›æˆ–å¤–åŠ åŠ›ã€‚</li></ul><p>åœ¨æ±‚è§£ä¸å¯å£“ç¸® Navier-Stokesæ–¹ ç¨‹æ™‚ï¼Œæœƒé‡åˆ°ä»¥ä¸‹å…©å€‹ä¸»è¦å›°é›£ï¼š</p><ol type="1"><li><strong>å£“åŠ›çš„é¡¯å¼æ±‚è§£</strong>ï¼šå£“åŠ› <span class="math inline">\(\nabla p\)</span> éš±è—åœ¨å‹•é‡æ–¹ç¨‹ä¸­ï¼Œèˆ‡é€Ÿåº¦å ´ <span class="math inline">\(\mathbf{u}\)</span> ç›¸è€¦åˆï¼Œæ²’æœ‰é¡¯å¼çš„å£“åŠ›æ±‚è§£æ–¹å¼ã€‚</li><li><strong>é€£çºŒæ€§ç´„æŸ</strong>ï¼šå¾å‹•é‡æ–¹ç¨‹ä¸­æ±‚è§£å‡ºçš„é€Ÿåº¦å ´ <span class="math inline">\(\mathbf{u}\)</span> ä¸ä¸€å®šæ»¿è¶³é€£çºŒæ–¹ç¨‹ <span class="math inline">\(\nabla \cdot \mathbf{u} = 0\)</span> çš„ä¸å¯å£“ç¸®æ€§æ¢ä»¶ã€‚</li></ol><h1 id="simple-æ¼”ç®—æ³•">SIMPLE æ¼”ç®—æ³•</h1><p>SIMPLEï¼ˆSemi-Implicit Method for Pressure-Linked Equationsï¼‰æ¼”ç®—æ³•æ˜¯é‡å°ä¸Šè¿°å•é¡Œæå‡ºçš„ä¸€ç¨®æ•¸å€¼æ±‚è§£æ–¹æ³•ï¼Œä¸»è¦é€éå£“åŠ›æ ¡æ­£ä¾†åˆ†è§£è€¦åˆå•é¡Œã€‚å…¶æ­¥é©Ÿå¦‚ä¸‹ï¼š</p><ol type="1"><li><strong>å‹•é‡æ–¹ç¨‹é›¢æ•£åŒ–ï¼š</strong><br />å°‡å‹•é‡æ–¹ç¨‹å¯«æˆçŸ©é™£å½¢å¼ï¼š <span class="math display">\[[M] \mathbf{u} = \mathbf{b}\]</span> å…¶ä¸­ <span class="math inline">\([M]\)</span> æ˜¯ä¿‚æ•¸çŸ©é™£ï¼Œ<span class="math inline">\(\mathbf{u}\)</span> æ˜¯é€Ÿåº¦å ´ï¼Œ<span class="math inline">\(\mathbf{b}\)</span> æ˜¯åŒ…å«å£“åŠ›æ¢¯åº¦é …å’Œå…¶å®ƒæºé …çš„å‘é‡ã€‚</li></ol><hr /><p>åœ¨ä¸å¯å£“ç¸®Navier-Stokesæ–¹ç¨‹ä¸­ï¼Œå£“åŠ›çš„ç›´æ¥æ±‚è§£é€šå¸¸åˆ©ç”¨ <strong>å£“åŠ› Poisson æ–¹ç¨‹</strong>ã€‚è©²æ–¹ç¨‹æ˜¯å¾å‹•é‡æ–¹ç¨‹èˆ‡é€£çºŒæ€§æ¢ä»¶çµ„åˆæ¨å°è€Œä¾†ï¼Œç”¨æ–¼ç¢ºä¿é€Ÿåº¦å ´æ»¿è¶³ä¸å¯å£“ç¸®æ¢ä»¶ï¼ˆ<span class="math inline">\(\nabla \cdot \mathbf{u} = 0\)</span>ï¼‰ã€‚æ¨å°éç¨‹å¦‚ä¸‹ï¼š</p><hr /><h2 id="å£“åŠ›-poisson-æ–¹ç¨‹çš„æ¨å°">å£“åŠ› Poisson æ–¹ç¨‹çš„æ¨å°</h2><ol type="1"><li><p><strong>é€£çºŒæ–¹ç¨‹ï¼š</strong> <span class="math display">\[\nabla \cdot \mathbf{u} = 0\]</span></p></li><li><p><strong>å‹•é‡æ–¹ç¨‹ï¼š</strong> <span class="math display">\[\rho \frac{\partial \mathbf{u}}{\partial t} + \rho (\mathbf{u} \cdot \nabla) \mathbf{u} = -\nabla p + \mu \nabla^2 \mathbf{u} + \mathbf{f}\]</span></p><p>å°‡å‹•é‡æ–¹ç¨‹å…©å´å°ç©ºé–“åšæ•£åº¦é‹ç®—ï¼Œå¾—åˆ°ï¼š <span class="math display">\[\nabla \cdot \left[ \rho \frac{\partial \mathbf{u}}{\partial t} + \rho (\mathbf{u} \cdot \nabla) \mathbf{u} \right] = -\nabla^2 p + \nabla \cdot (\mu \nabla^2 \mathbf{u}) + \nabla \cdot \mathbf{f}\]</span></p></li><li><p><strong>åˆ©ç”¨é€£çºŒæ€§ç´„æŸï¼š</strong> å‡è¨­ <span class="math inline">\(\mathbf{u}\)</span> ä¸å®Œå…¨æ»¿è¶³é€£çºŒæ€§ï¼Œç‚ºäº†ä¿®æ­£å£“åŠ›ï¼Œè€ƒæ…®å£“åŠ›èˆ‡é€Ÿåº¦çš„ç›¸äº’å½±éŸ¿ï¼Œå¯å¾—å£“åŠ› Poisson æ–¹ç¨‹çš„é€šç”¨å½¢å¼ï¼š <span class="math display">\[\nabla^2 p = \nabla \cdot \left[ \rho (\mathbf{u} \cdot \nabla) \mathbf{u} \right] - \rho \frac{\partial (\nabla \cdot \mathbf{u})}{\partial t} + \nabla \cdot \mathbf{f}.\]</span></p></li><li><p><strong>ç©©æ…‹æƒ…æ³ï¼š</strong> ç•¶ç³»çµ±è™•æ–¼ç©©æ…‹ä¸”å¤–åŠ›é …å¯å¿½ç•¥æ™‚ï¼Œç°¡åŒ–ç‚ºï¼š <span class="math display">\[\nabla^2 p = \rho \nabla \cdot \left[ (\mathbf{u} \cdot \nabla) \mathbf{u} \right].\]</span></p></li></ol><hr /><h2 id="ä½¿ç”¨å£“åŠ›-poisson-æ–¹ç¨‹çš„ç›®æ¨™">ä½¿ç”¨å£“åŠ› Poisson æ–¹ç¨‹çš„ç›®æ¨™</h2><ul><li><strong>ä¿®æ­£å£“åŠ›å ´ï¼š</strong> ç¢ºä¿ä¿®æ­£å¾Œçš„é€Ÿåº¦å ´æ»¿è¶³ä¸å¯å£“ç¸®æ¢ä»¶ã€‚</li><li><strong>è€¦åˆé€Ÿåº¦èˆ‡å£“åŠ›ï¼š</strong> å°‡å£“åŠ›å¾å‹•é‡æ–¹ç¨‹é¡¯æ€§åˆ†é›¢ï¼Œé€šé å£“åŠ› Poisson æ–¹ç¨‹ <strong>è§£å£“åŠ›</strong>å¾Œï¼Œ<strong>ä»£å…¥å‹•é‡æ–¹ç¨‹ä¿®æ­£é€Ÿåº¦å ´</strong>ã€‚</li></ul><hr /><p>å£“åŠ› Poisson æ–¹ç¨‹çš„è§£æ³•é€šå¸¸åŸºæ–¼é›¢æ•£åŒ–æ•¸å€¼æŠ€è¡“ï¼Œä¾‹å¦‚æœ‰é™å·®åˆ†æ³•ã€æœ‰é™é«”ç©æ³•ç­‰ï¼Œé€šéæ±‚è§£å£“åŠ›æ ¡æ­£å ´ <span class="math inline">\(p&#39;\)</span> ä¾†é€æ­¥é€¼è¿‘æœ€çµ‚æ»¿è¶³ <span class="math inline">\(\nabla \cdot \mathbf{u} = 0\)</span> çš„é€Ÿåº¦å ´ã€‚</p><p>SIMPLE (Semi-Implicit Method for Pressure Linked Equations) æ˜¯ä¸€ç¨®æ•¸å€¼æ–¹æ³•ï¼Œç”¨æ–¼è§£æ±ºä¸å¯å£“ç¸®Navier-Stokesæ–¹ç¨‹ä¸­çš„é€Ÿåº¦å’Œå£“åŠ›è€¦åˆå•é¡Œã€‚</p><hr /><h3 id="æ³¨æ„äº‹é …">æ³¨æ„äº‹é …</h3><ol type="1"><li><p><strong>æ¬ é¬†å¼›å› å­çš„ä½œç”¨</strong><br />æ¬ é¬†å¼›å› å­åœ¨æ¯æ¬¡è¿­ä»£ä¸­æ¸›å°æ›´æ–°å¹…åº¦ï¼Œé˜²æ­¢ç™¼æ•£ï¼Œæé«˜ç®—æ³•ç©©å®šæ€§ã€‚</p></li><li><p><strong>ç¶²æ ¼é¸æ“‡</strong><br />å£“åŠ›å’Œé€Ÿåº¦çš„ç¶²æ ¼é›¢æ•£åŒ–éœ€æ»¿è¶³ <strong>äº¤éŒ¯ç¶²æ ¼æ³•ï¼ˆstaggered gridï¼‰</strong>ï¼Œä»¥é¿å…æ•¸å€¼æ“´æ•£æˆ–å£“åŠ›éœ‡ç›ªå•é¡Œã€‚</p></li><li><p><strong>æ”¶æ–‚æ¢ä»¶</strong><br />é¸æ“‡åˆé©çš„æ®˜å·®ç¯„åœå’Œè¿­ä»£æ¬¡æ•¸é™åˆ¶ï¼Œç¢ºä¿çµæœçš„æº–ç¢ºæ€§å’Œè¨ˆç®—æ•ˆç‡ã€‚</p></li></ol><p>SIMPLE æ˜¯ä¸€ç¨®ç©©å¥ä¸”ç°¡å–®çš„æ–¹æ³•ï¼Œé©åˆè™•ç†<strong>ç©©æ…‹ä¸å¯å£“ç¸®æµé«”å•é¡Œ</strong>ï¼Œä½†åœ¨è™•ç†ç¬æ…‹æˆ–é«˜é›·è«¾æ•¸æµé«”æ™‚ï¼Œå¯èƒ½éœ€è¦æ”¹é€²ç‰ˆæœ¬ï¼Œå¦‚ SIMPLEC æˆ– PISOã€‚</p><hr /><p>SIMPLEæ¼”ç®—æ³•æ±‚è§£éç¨‹ç¸½çµç‚ºå¦‚ä¸‹4æ­¥ï¼š</p><ol type="1"><li>ç”±çµ¦å®šçš„åˆå§‹å£“åŠ›æˆ–ä¸Šä¸€è¿­ä»£æ­¥å£“åŠ›æ±‚è§£å‹•é‡æ–¹ç¨‹ï¼Œä½†æ˜¯æ±‚å¾—çš„é€Ÿåº¦è®Šæ•¸ä¸¦ä¸ä¸€å®šæ»¿è¶³é€£çºŒæ€§æ–¹ç¨‹ã€‚</li><li>æ ¹æ“šå£“åŠ›æ³Šæ¾æ–¹ç¨‹å¼æ±‚è§£å¾—åˆ°å£“åŠ›ã€‚</li><li>åˆ©ç”¨æ±‚å¾—çš„å£“åŠ›ä¿®æ­£é€Ÿåº¦ï¼Œä½¿ä¹‹èƒ½æ»¿è¶³é€£çºŒæ€§æ–¹ç¨‹å¼.</li><li>è‹¥é€Ÿåº¦ä¸æ»¿è¶³å‹•é‡æ–¹ç¨‹ï¼Œè«‹å›åˆ°æ­¥é©Ÿï¼ˆ1ï¼‰é‡è¤‡å¾ªç’°ï¼Œç›´åˆ°æ»¿è¶³ç‚ºæ­¢ã€‚</li></ol><p>é‚£å…¶ä»–çš„æ¨™é‡æ–¹ç¨‹å¼æ€éº¼è¾¦ï¼Ÿä¾‹å¦‚èƒ½é‡æ–¹ç¨‹å¼ã€æ¹æµæ–¹ç¨‹å¼ <span class="math inline">\(k\)</span> æ–¹ç¨‹å¼åŠ <span class="math inline">\(\epsilon\)</span> æ–¹ç¨‹å¼ç­‰ã€‚é€™äº›æ–¹ç¨‹å¼ä¹Ÿå¯ä»¥æ”¾åˆ°ä¸Šæ•¸æ±‚è§£å¾ªç’°ä¸­ï¼Œåªè¦æ”¾åˆ°é€Ÿåº¦ä¿®æ­£æ–¹ç¨‹å¼å¾Œä¾åºæ±‚è§£å³å¯ã€‚</p><figure><img src="https://i.imgur.com/QoJMran.png" alt="SIMPLE" width="600" /><figcaption>SIMPLE</figcaption></figure><p>PISOæ¼”ç®—æ³•æ˜¯åœ¨SIMPLEä»¥å¾Œç™¼å±•å‡ºä¾†ï¼Œæœ€åˆç‚º <strong>ç¬æ…‹</strong> <strong>ä¸å¯å£“ç¸®æµå‹•</strong> è¨­è¨ˆçš„ä¸€ç¨®æ¼”ç®—æ³•ã€‚ PISOæ¼”ç®—æ³•èˆ‡SIMPLEæ¼”ç®—æ³•çš„å·®ç•°åœ¨æ–¼é€Ÿåº¦å ´ç”±é€Ÿåº¦ä¿®æ­£æ–¹ç¨‹ä¿®æ­£å¾Œï¼Œä¸¦æ²’æœ‰ç›´æ¥å›åˆ°å¦‚ä¸‹å‹•é‡æ–¹ç¨‹é€²è¡Œè¿­ä»£å¾ªç’°ï¼Œè€Œæ˜¯ç›´æ¥é€²è¡Œæ›´æ–°HçŸ©é™£ï¼Œæ±‚è§£å£“åŠ›æ³Šæ¾æ–¹ç¨‹ï¼Œå› æ­¤å‹•é‡æ–¹ç¨‹åªæ˜¯åˆå§‹è¿­ä»£ä½¿ç”¨éä¸€æ¬¡ï¼Œæ­¤å¾Œä¾¿ä¸å†ä½¿ç”¨ï¼Œå› æ­¤ç›¸æ¯” SIMPLE æ¼”ç®—æ³•è¨ˆç®—é‡æ¸›å°‘ï¼Œé€Ÿåº¦æ›´å¿«ã€‚</p><div class="note note-danger">            <p>ç”±æ–¼æœ‰æ–¹ç¨‹å¼çš„<strong>æ™‚é–“å°æ•¸é …</strong>ï¼Œ<strong>PISOæ¼”ç®—æ³•åœ¨ç¬æ…‹æµå‹•è¨ˆç®—æ™‚å€™æ¯”è¼ƒç©©å®š</strong>ã€‚<strong>ç•¶æ™‚é–“æ­¥é•·æ¯”è¼ƒå°æ™‚ï¼Œæ™‚é–“å°æ•¸é …æœƒé å¤§æ–¼å‹•é‡æ–¹ç¨‹å¼å°æµé …ã€æ“´æ•£é …ã€æºé …ç­‰å…¶ä»–é …ï¼Œè€Œç”±æ–¼æ™‚é–“å€’æ•¸é …æœƒå‡ºç¾çŸ©é™£å°è§’é™£ä¸Šï¼Œå› æ­¤å°çš„æ™‚é–“æ­¥é•·å°±æœƒä½¿çŸ©é™£å°è§’ä½”å„ªï¼Œé€™ç¨®çŸ©é™£ç‰¹æ€§æœƒä½¿æ–¹ç¨‹å¼çš„è§£æ›´åŠ ç©©å®šï¼ŒèŠ±è²»è¼ƒå°‘çš„è¿­ä»£æ­¥é”åˆ°æ”¶æ–‚</strong>ã€‚</p><p><span class="math display">\[\dfrac{\partial U}{\partial t} = \dfrac{U_p^{i+1} - U_p^{i}}{\Delta t}\]</span></p>          </div><p>ç•¶ç„¶å¾å¦ä¸€æ–¹é¢ä¾†èªªï¼Œç”±æ–¼ç©©æ…‹æµå‹•æ²’æœ‰æ™‚é–“å°æ•¸é …ï¼Œå› æ­¤è‹¥ç°¡å–®ä½¿ç”¨SIMPLEæ¼”ç®—æ³•å°±ä¸å¦‚PISOæ¼”ç®—æ³•ç©©å®šï¼Œ<strong>å› æ­¤SIMPLEæ¼”ç®—æ³•æœƒä»¥ä½¿ç”¨é¬†å¼›å› å­çš„æ–¹å¼äººå·¥å¢åŠ å°è§’çŸ©é™£ä¿‚æ•¸ï¼Œä½¿æ–¹ç¨‹å¼æ±‚è§£æ›´åŠ ç©©å®š</strong>ï¼Œå…·é«”ç´°ç¯€é€™è£¡å°±ä¸å†å¤šèªªäº†ã€‚</p><p>ç¸½çš„ä¾†èªªå§ï¼ŒPISOæ¼”ç®—æ³•æ¯”è¼ƒé©åˆç¬æ…‹ä¸å¯å£“ç¸®æµé«”ã€‚ç•¶æ™‚é–“æ­¥é•·è¶³å¤ å°æ™‚ï¼ˆåº«æœ—æ•¸&lt;1ï¼‰æ™‚ï¼Œå°±ä¸éœ€è¦äººå·¥å¢åŠ å°è§’çŸ©é™£ä¿‚æ•¸ï¼Œä½¿å…¶å°è§’ä½”å„ªï¼Œåªéœ€è¦åšä¸€æ¬¡å‹•é‡æ–¹ç¨‹å¼æ±‚è§£ï¼Œç„¶å¾Œå°å£“åŠ›æ–¹ç¨‹å¼åŠé€Ÿåº¦ä¿®æ­£æ–¹ç¨‹å¼é€²è¡Œè¿­ä»£å¾ªç’°å³å¯æ”¶æ–‚ã€‚</p><figure><img src="https://i.imgur.com/2NqUqHH.png" alt="PISO" width="600" /><figcaption>PISO</figcaption></figure><h1 id="references">References</h1><ol type="1"><li><a href="http://staff.ustc.edu.cn/~humaobin/course/cht/ppt/6.0.pdf">ç¬¬6ç«  å›æµé—®é¢˜æµåŠ¨ï¼ä¼ çƒ­ è€¦åˆè®¡ç®—çš„æ•°å€¼æ–¹æ³•</a></li><li><a href="http://staff.ustc.edu.cn/~humaobin/course/cht/ppt/6.4.pdf">6.4 åŸå§‹å˜é‡é¡ºåºæ±‚è§£æµåœºçš„ å‹åŠ›ä¿®æ­£æ–¹æ³•</a></li><li><a href="https://mp.weixin.qq.com/s/vEoW0lTb5QbfTFs7FZwGQQ">OpenFOAMç¼–ç¨‹æ¡ˆä¾‹ | 14 SIMPLEç®—æ³•</a></li><li><a href="https://www.youtube.com/watch?v=OOILoJ1zuiw&amp;ab_channel=FluidMechanics101">[CFD] The SIMPLE Algorithm (to solve incompressible Navier-Stokes)</a></li><li><a href="https://zhuanlan.zhihu.com/p/126368311?utm_psn=1845836334389919744">ä»€ä¹ˆæ˜¯SIMPLEåŠPISOç®—æ³•ï¼Ÿ</a></li><li><a href="https://www.cfdsupport.com/OpenFOAM-Training-by-CFD-Support/node199.html">SIMPLE algorithm description</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>CFD</category>
      
    </categories>
    
    
    <tags>
      
      <tag>HPC</tag>
      
      <tag>OpenFOAM</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>WRF | WPS in parallel or in serial</title>
    <link href="/2024/11/25/wps-in-parallel-or-in-serial/"/>
    <url>/2024/11/25/wps-in-parallel-or-in-serial/</url>
    
    <content type="html"><![CDATA[<ul><li><strong>keywords: metgrid.exe, geogrid.exe, dmpar, serial</strong></li></ul><h1 id="wrfwps-compilation-tutorial"><a href="https://www2.mmm.ucar.edu/wrf/OnLineTutorial/compilation_tutorial.php">WRF/WPS Compilation Tutorial</a></h1><p>You should be given a list of various options for compiler types, whether to compile in serial or parallel, and whether to compile ungrib with GRIB2 capability. Unless you plan to create extremely large domains,</p><div class="note note-danger">            <p><strong>It is recommended to compile WPS in serial mode, regardless of whether you compiled WRF in parallel.</strong></p>          </div><h1 id="resolved-serial-vs.-dmpar-jan-15-2019"><a href="https://forum.mmm.ucar.edu/threads/resolved-serial-vs-dmpar.583/">(RESOLVED) serial vs. dmpar | Jan 15, 2019</a></h1><p>That is a good question. <strong>We have just found that the advantage to running WPS in parallel isn't that beneficial (or much faster) than a simple serial run</strong>, as the WPS programs run so quickly anyway. We do find that it is necessary if you have very large domains (1000's x 1000's of grid cells). That being said, if you are finding that it speeds up the process for your runs, then it should be perfectly fine to use parallel processing. As I'm sure you already know, geogrid and metgrid are the only programs that can be run in parallel. Ungrib must still be run serially.</p><h1 id="using-mpas-output-for-wrf-initial-and-lateral-boundary-conditions">Using MPAS Output for WRF Initial and Lateral Boundary Conditions</h1><div class="note note-warning">            <p><a href="https://www2.mmm.ucar.edu/wrf/users/docs/user_guide_v4/v4.2/users_guide_chap3.html#_Using_MPAS_Output">Using MPAS Output for WRF Initial and Lateral Boundary Conditions</a></p>          </div><ul><li><a href="https://waipangsze.github.io/2024/11/13/WRF-MPAS-as-ICBC/" class="uri">https://waipangsze.github.io/2024/11/13/WRF-MPAS-as-ICBC/</a></li></ul><div class="note note-warning">            <p><strong>It is worth noting that the use of native MPAS output with metgrid.exe has not been thoroughly tested for parallel (i.e., â€œdmparâ€) builds of the WPS; it is therefore recommended to run metgrid.exe in serial when processing MPAS datasets.</strong></p>          </div><p><strong>Please use 1 core (serial) to run metgrid.exe.</strong> Otherwise, the wrfout will be fail even (dmpar) of metgrid seems to be done.</p><div class="note note-danger">            <p><strong>sbatch -N 1 -n 1 run_metgrid.sh</strong></p>          </div>]]></content>
    
    
    <categories>
      
      <category>WRF</category>
      
    </categories>
    
    
    <tags>
      
      <tag>WRF</tag>
      
      <tag>WPS</tag>
      
      <tag>MPAS</tag>
      
      <tag>IC/BC</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>CFD | OpenFOAM Installation</title>
    <link href="/2024/11/20/CFD-openfoam-installation/"/>
    <url>/2024/11/20/CFD-openfoam-installation/</url>
    
    <content type="html"><![CDATA[<h1 id="openfoam">OpenFOAM</h1><p>OpenFOAMæ˜¯ä¸€å€‹CFDè»Ÿé«”ã€‚å®ƒåŒ…æ‹¬ä¸€ç³»åˆ—æ‡‰ç”¨ç¨‹åºï¼Œé€™äº›æ‡‰ç”¨ç¨‹å¼åœ¨CFDä¸­åŸ·è¡Œä¸€ç³»åˆ—ä»»å‹™ã€‚æ‡‰ç”¨ç¨‹å¼ä¸»è¦åˆ†ç‚ºå…©é¡ï¼š<a href="http://www.dyfluid.com/openfoam11-1.html#id1">link</a></p><ul><li>æ±‚è§£å™¨ï¼Œç”¨æ–¼åŸ·è¡ŒCFDè¨ˆç®—ï¼›</li><li>ä»¥åŠå¯¦ç¾ä¸Šè¿°ä»»å‹™çš„å…¶ä»–ç¨‹åºï¼›</li></ul><p>åœ¨OpenFOAM-11ä¹‹å‰ï¼Œæ¯å€‹æµå‹•é¡å‹éƒ½éœ€è¦å‘¼å«ç‰¹å®šçš„æ±‚è§£å™¨ã€‚ç”±æ–¼æµå‹•é¡å‹éå¸¸å¤šï¼ŒOpenFOAMå±¤åŒ…å«äº†è¿‘100å€‹è§£ç®—å™¨ã€‚åƒsimpleFoamå’ŒpimpleFoamé€™æ¨£çš„æ±‚è§£å™¨è‡ªä¸Šä¸–ç´€90å¹´ä»£åˆä»¥ä¾†ä¸€ç›´æ˜¯OpenFOAMçš„ä¸»åŠ›ã€‚</p><p>ç„¶è€Œ<strong>OpenFOAM-11å¼•é€²äº†æ¨¡çµ„åŒ–æ±‚è§£å™¨ï¼Œå…¶ç‚ºä¸€å€‹é‡å¤§çš„æ”¹é€²</strong>ã€‚æ‡‰ç”¨ç¨‹å¼è§£ç®—å™¨è¢«å–®ä¸€foamRunæ±‚è§£å™¨å–ä»£ï¼ŒfoamRunæ˜¯ä¸€å€‹æ¡†æ¶æ€§æ±‚è§£å™¨ã€‚ foamRunå¯ä»¥è¼‰å…¥ä¸€å€‹æ±‚è§£å™¨æ¨¡çµ„ï¼Œè©²æ¨¡çµ„ç¹¼çºŒå‘¼å«å°æ‡‰çš„æµå‹•é¡å‹ã€‚ä¾‹å¦‚ä¹‹å‰simpleFoamä»¥åŠpisoFoamçš„ç®—ä¾‹ï¼Œéƒ½æ¡ç”¨foamRunæ±‚è§£å™¨ä¾†é‹ä½œã€‚åœ¨foamRunæ±‚è§£å™¨ç¨‹å¼ç¢¼ä¸­ï¼Œæœƒä¾æ“šå°æ‡‰çš„æ¼”ç®—æ³•é€²è¡Œèª¿æ•´ã€‚é€™åœ¨ç¨‹å¼ç¢¼å±¤æ¬¡çš„æ”¹å‹•æ˜¯ç›¸ç•¶å¤§çš„ã€‚ OpenFOAM-11å¯ä»¥èªç‚ºæ˜¯ä¸€æ¬¡å¾¹åº•çš„æ”¹è®Šã€‚å®˜æ–¹å°‡é€™æ¬¡æ”¹å‹•çš„åŸå› è§£é‡‹ç‚ºæ›´åŠ çš„è²¼è¿‘å¤šç‰©ç†å ´çš„ç‰¹æ€§ï¼Œå°æ–¼å¤šç‰©ç†å ´çš„è€¦åˆæ›´åŠ çš„æˆç†Ÿã€‚ç•¶ç„¶é€™è£¡é¢ä¹Ÿå­˜åœ¨å•†æ¥­ä¸Šçš„åŸå› ã€‚</p><p>ç‰¹åˆ¥çš„ï¼ŒOpenFOAM-11é‚„æœ‰ä¸€å€‹foamMultiRunæ±‚è§£å™¨ï¼Œå®ƒå¯ä»¥æ¥å—å…©å€‹æˆ–æ›´å¤šåŸŸå€åŸŸï¼Œä¸¦ç‚ºæ¯å€‹å€åŸŸæ‡‰ç”¨ä¸åŒçš„æ±‚è§£å™¨æ¨¡çµ„ã€‚ä¾‹å¦‚ï¼Œå®ƒå¯ä»¥å°‡ä¸€å€‹æˆ–å¤šå€‹æµé«”å’Œå›ºé«”çš„æ¨¡çµ„è€¦åˆèµ·ä¾†ï¼Œå…¸å‹çš„å¼•ç”¨å°±æ˜¯å¤šå€åŸŸå‚³ç†±æµå‹•ã€‚</p><ul><li><a href="https://cfd-china.com/topic/6484/openfoam-11-openfoam-v2306">OpenFOAM-11ï¼ŒOpenFOAM-v2306 | Jul 13, 2023 | CFDä¸­æ–‡ç½‘</a>, <a href="https://cfd-china.com/topic/7189/openfoam-11">openFoam-11 | CFDä¸­æ–‡ç½‘</a><ul><li>ESIä»¥åŠåŸºé‡‘ä¼šçº·çº·æ¨å‡ºOpenFOAM-v2306ä»¥åŠOpenFOAM-v11ã€‚åè€…æ”¹åŠ¨å°¤å…¶å·¨å¤§ã€‚æ±‚è§£å™¨æ¨¡å—åŒ–ï¼Œæ¯”å¦‚ä¹‹å‰çš„icoFoamæ˜¯ä¸ªæ±‚è§£å™¨ï¼Œä½†ç›®å‰è¢«å¤„ç†æˆäº†ä¸€ä¸ªåº“ã€‚OpenFOAM-v11æ¯”ä¹‹å‰ï¼Œåœ¨å¤šç‰©ç†åœºè€¦åˆæ–¹é¢ï¼Œæ›´åŠ å‹å¥½ã€‚ä½†æ›´åŠ å¢åŠ äº†ä½¿ç”¨éš¾åº¦ã€‚</li><li>å°¤å…¶æ˜¯å¯¹äºOpenFOAM-11è¿™é¢ã€‚OpenFOAMè¿™é¢å‡ ä¸ªå¤§æ”¹åŠ¨ï¼Œä¸€ä¸ªæ˜¯OpenFOAM-3.0ï¼Œä¸€ä¸ªæ˜¯OpenFOAM-11ã€‚è¿™ä¸ªOpenFOAM-11æ”¹çš„ï¼Œæ”¹çš„ç›¸å½“å¤§ã€‚</li><li>æ˜¯ã€‚ã€‚ã€‚OpeNFOAM11æ”¹åŠ¨å¾ˆå¤§.. æˆ‘å¼€å§‹ç”¨äº†éƒ½å‘è’™</li><li>ä½ å°±ç”¨paraFoam -buildinä¹Ÿè¡Œï¼Œæˆ‘è‡ªå·±ä¹Ÿç”¨è¿™ä¸ªï¼ˆå¦‚æœä¸çœ‹åšæ‹‰æ ¼æœ—æ—¥ç²’å­çš„è¯ï¼‰</li></ul></li></ul><h1 id="binarysource-package">Binary/Source Package</h1><ul><li><a href="https://dl.openfoam.org/">OpenFOAM Binary/Source Package Repository</a><ul><li>source/ Source Code Packs for Compiling OpenFOAM (v1.7.0-12) on Linux</li><li>third-party/ Source Code Packs of Third Party Software supporting OpenFOAM (v1.7.0-12) on Linux</li></ul></li></ul><h1 id="software-for-compilation"><a href="https://openfoam.org/download/source/software-for-compilation/">Software for Compilation</a></h1><div class="note note-primary">            <p><a href="https://waipangsze.github.io/2023/05/06/Intel_OneAPI/">Intel OneAPI installation</a></p>          </div><p>åŸç†ï¼šOpenFOAMç·¨è­¯éœ€è¦ä¸€äº›è»Ÿé«”å’Œå‡½å¼åº«ï¼Œåƒæ˜¯ <code>flex</code>, <code>zlib</code> ä¹‹é¡</p><p>Repository and compilation software:</p><ul><li><code>Git</code> distributed version control software used for the OpenFOAM source repositories.</li><li><code>Compiler</code>: either GCC version 5.5 or above; or LLVM Clang version 16 or above (possibly earlier); or the Intel oneAPI DPC++/C++ Compiler version 2021.3.0 or above. GCC is most commonly available and the version can be checked by typing</li><li><code>FLEX</code> fast lexical analyser, used by OpenFOAM for reading files of third-party format</li><li><code>cmake</code> build software for compiling ParaView, the third-party visualisation toolkit.</li></ul><p>Software for <code>OpenFOAM</code> (and <code>ParaView</code>):</p><ul><li><code>OpenMPI</code> message passing interface for parallel computation.</li><li><code>ParaView</code> can be installed as a system package, in which case its dependencies do not need to be installed. However, in order to compile its reader modules within OpenFOAM, all its dependencies need to be installed including the development environments of QT, graphics (GL), data formats, etc</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh"> $ micromamba <span class="hljs-built_in">env</span> create -n cfd_env<br>Empty environment created at prefix: /home/wpsze/micromamba/envs/cfd_env<br> $ micromamba install conda-forge::zlib<br> $ micromamba install anaconda::cmake<br> $ micromamba install conda-forge::flex<br> $ micromamba install conda-forge::bison<br> $ micromamba install conda-forge::cgal<br> $ micromamba install anaconda::metis<br></code></pre></td></tr></table></figure><h2 id="è¼‰å…¥ç’°å¢ƒ">è¼‰å…¥ç’°å¢ƒ</h2><p>å®‰è£éœ€è¦è¼‰å…¥ Intel ç·¨è­¯ç’°å¢ƒå’Œ gcc ç’°å¢ƒï¼Œä¸” gcc ç’°å¢ƒä¸æ‡‰é«˜æ–¼ Intel ç·¨è­¯å™¨ç’°å¢ƒ</p><h2 id="environment-variables">Environment variables</h2><h3 id="wm-options">WM options</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs sh">WM_THIRD_PARTY_DIR=<span class="hljs-variable">$HOME</span>/OpenFOAM/ThirdParty-1.6.x<br>WM_PROJECT_INST_DIR=<span class="hljs-variable">$HOME</span>/OpenFOAM<br>WM_PROJECT_DIR=<span class="hljs-variable">$HOME</span>/OpenFOAM/OpenFOAM-1.6.x<br>WM_DIR=<span class="hljs-variable">$HOME</span>/OpenFOAM/OpenFOAM-1.6.x/wmake<br>WM_PROJECT_USER_DIR=<span class="hljs-variable">$HOME</span>/OpenFOAM/<span class="hljs-variable">$USER</span>-1.6.x<br><br>WM_PRECISION_OPTION=DP<br>WM_ARCH_OPTION=64<br>WM_LINK_LANGUAGE=c++<br>WM_ARCH=linux64<br>WM_CXXFLAGS=-m64 -fPIC<br>WM_CFLAGS=-m64 -fPIC<br>WM_PROJECT_VERSION=1.6.x<br>WM_COMPILER_LIB_ARCH=64<br>WM_CXX=g++<br>WM_COMPILER_ARCH=<br>WM_PROJECT=OpenFOAM<br>WM_LDFLAGS=-m64<br>WM_COMPILER=Gcc<br>WM_MPLIB=OPENMPI<br>WM_CC=gcc<br>WM_COMPILE_OPTION=Opt<br>WM_OPTIONS=linux64GccDPOpt<br>WM_PRECISION_OPTION=DP<br>WM_ARCH_OPTION=64<br></code></pre></td></tr></table></figure><h3 id="foam-options">FOAM options</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs sh">FOAM_SOLVERS=<span class="hljs-variable">$HOME</span>/OpenFOAM/OpenFOAM-1.6.x/applications/solvers<br>FOAM_APPBIN=<span class="hljs-variable">$HOME</span>/OpenFOAM/OpenFOAM-1.6.x/applications/bin/linux64GccDPOpt<br>FOAM_TUTORIALS=<span class="hljs-variable">$HOME</span>/OpenFOAM/OpenFOAM-1.6.x/tutorials<br>FOAM_JOB_DIR=<span class="hljs-variable">$HOME</span>/OpenFOAM/jobControl<br>FOAM_LIB=<span class="hljs-variable">$HOME</span>/OpenFOAM/OpenFOAM-1.6.x/lib<br>FOAM_SITE_APPBIN=<span class="hljs-variable">$HOME</span>/OpenFOAM/site/1.6.x/bin/linux64GccDPOpt<br>FOAM_MPI_LIBBIN=<span class="hljs-variable">$HOME</span>/OpenFOAM/OpenFOAM-1.6.x/lib/linux64GccDPOpt/openmpi-1.3.3<br>FOAM_APP=<span class="hljs-variable">$HOME</span>/OpenFOAM/OpenFOAM-1.6.x/applications<br>FOAM_SITE_LIBBIN=<span class="hljs-variable">$HOME</span>/OpenFOAM/site/1.6.x/lib/linux64GccDPOpt<br>FOAM_SRC=<span class="hljs-variable">$HOME</span>/OpenFOAM/OpenFOAM-1.6.x/src<br>FOAM_SIGFPE=<br>FOAM_UTILITIES=<span class="hljs-variable">$HOME</span>/OpenFOAM/OpenFOAM-1.6.x/applications/utilities<br>FOAM_USER_LIBBIN=WM_PROJECT_USER_DIR/lib/linux64GccDPOpt<br>FOAM_INST_DIR=<span class="hljs-variable">$HOME</span>/OpenFOAM<br>FOAM_LIBBIN=<span class="hljs-variable">$HOME</span>/OpenFOAM/OpenFOAM-1.6.x/lib/linux64GccDPOpt<br>FOAM_RUN=WM_PROJECT_USER_DIR/run<br>FOAM_USER_APPBIN=WM_PROJECT_USER_DIR/applications/bin/linux64GccDPOpt<br></code></pre></td></tr></table></figure><h3 id="other-options">Other options</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh">MPI_ARCH_PATH=<span class="hljs-variable">$HOME</span>/OpenFOAM/ThirdParty-1.6.x/openmpi-1.3.3/platforms/linux64GccDPOpt<br>ParaView_INST_DIR=<span class="hljs-variable">$HOME</span>/OpenFOAM/ThirdParty-1.6.x/paraview-3.6.1<br>OPAL_PREFIX=<span class="hljs-variable">$HOME</span>/OpenFOAM/ThirdParty-1.6.x/openmpi-1.3.3/platforms/linux64GccDPOpt<br>ParaView_DIR=<span class="hljs-variable">$HOME</span>/OpenFOAM/ThirdParty-1.6.x/paraview-3.6.1/platforms/linux64Gcc<br>PARAVIEW_DIR=/opt/packages/Paraview3<br>ParaView_VERSION=3.6.1<br>MPI_HOME=<span class="hljs-variable">$HOME</span>/OpenFOAM/ThirdParty-1.6.x/openmpi-1.3.3<br></code></pre></td></tr></table></figure><h2 id="ä¿®æ”¹openfoamçš„é…ç½®">ä¿®æ”¹OpenFOAMçš„é…ç½®</h2><h3 id="for-openfoam-11etcbashrc">For OpenFOAM-11/<code>etc/bashrc</code>,</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs sh">59 <span class="hljs-comment">#- Compiler location:</span><br>60 <span class="hljs-comment">#    WM_COMPILER_TYPE= system | ThirdParty (OpenFOAM)</span><br>61 <span class="hljs-built_in">export</span> WM_COMPILER_TYPE=system<br><br>63 <span class="hljs-comment">#- Compiler:</span><br>64 <span class="hljs-comment">#    WM_COMPILER = Gcc | Gcc48 ... Gcc62 | Clang | Icx</span><br>65 <span class="hljs-built_in">export</span> WM_COMPILER=Icx<br>66 <span class="hljs-built_in">unset</span> WM_COMPILER_ARCH WM_COMPILER_LIB_ARCH<br><br>86 <span class="hljs-comment">#- MPI implementation:</span><br>87 <span class="hljs-comment">#    WM_MPLIB = SYSTEMOPENMPI | OPENMPI | SYSTEMMPI | MPICH | MPICH-GM | HPMPI</span><br>88 <span class="hljs-comment">#               | MPI | FJMPI | QSMPI | SGIMPI | INTELMPI</span><br>89 <span class="hljs-built_in">export</span> WM_MPLIB=INTELMPI <br></code></pre></td></tr></table></figure><h3 id="for-cannot-find--lz-issude">For <strong>cannot find -lz</strong> issude,</h3><h4 id="check--lz">check -lz</h4><p>ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥è©¢gccèƒ½å¦æœå°‹åˆ°æŒ‡å®šçš„åº«æª”:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh"> $ gcc -lz --verbose<br>Using built-in specs.<br>COLLECT_GCC=gcc<br>COLLECT_LTO_WRAPPER=/usr/libexec/gcc/x86_64-redhat-linux/8/lto-wrapper<br>...<br>/usr/bin/ld: cannot find -lz<br>collect2: error: ld returned 1 <span class="hljs-built_in">exit</span> status<br></code></pre></td></tr></table></figure><p>è‹¥å®‰è£äº†è»Ÿé«”ï¼Œæ‰¾åˆ°äº†åº«æª”æ¡ˆçš„è·¯å¾‘ã€‚ä½†ä¾ç„¶æœƒæç¤ºä¸Šè¿°éŒ¯èª¤ã€‚å‰‡è¡¨ç¤ºgccçš„æœå°‹è·¯å¾‘ä¸åŒ…å«è©²åº«æª”æ¡ˆæ‰€åœ¨çš„è·¯å¾‘ã€‚</p><ul><li>ä¿®æ”¹ç’°å¢ƒè®Šæ•¸<ul><li><code>$ export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/opt/biosoft/hdf5-1.8.15-patch1/lib/</code></li><li>ä¿®æ”¹ç’°å¢ƒè®Šæ•¸ <code>LD_LIBRARY_PATH</code>ï¼ŒåŠ å…¥å‡½å¼åº«æª”æ¡ˆæ‰€åœ¨è·¯å¾‘ã€‚ä½¿ç”¨ <code>export</code> æŒ‡ä»¤ä½¿ä¿®æ”¹ç”Ÿæ•ˆã€‚</li><li><code>$ echo 'export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/opt/biosoft/hdf5-1.8.15-patch1/lib/' &gt;&gt; ~/.bashrc</code></li><li><code>$ source ~/.bashrc</code></li><li>å°‡ä¸Šè¿° <code>export</code> æŒ‡ä»¤åŠ å…¥è¨­å®šæª” <code>~/.bashrc</code>ï¼Œä½¿å…¶æ°¸ä¹…ç”Ÿæ•ˆã€‚</li><li><code>$ export LIBRARY_PATH=/opt/biosoft/hdf5-1.8.15-patch1/lib/:$LIBRARY_PATH</code></li><li><strong>è‹¥ä¿®æ”¹è®Šæ•¸ <code>LD_LIBRARY_PATH</code> ä¸å¥æ•ˆï¼Œå‰‡ä¿®æ”¹è®Šæ•¸ <code>LIBRARY_PATH</code> ã€‚</strong></li></ul></li></ul><ol type="1"><li><strong>cannot find -lz</strong><ol type="1"><li><code>-lz</code> - is zlib, <a href="http://zlib.net/" class="uri">http://zlib.net/</a><ol type="1"><li>You may need <code>-L/opt/lib</code> to specify a path. This should give you another linker error, <strong>looking for zlib</strong>. Then add <code>-lz</code>.</li></ol></li><li><code>-lm</code> - is the math library as you've worked out (implementation defined AFAIK)</li><li><code>-lrt</code> - provides POSIX realtime extensions: <a href="http://www.s-gms.ms.edus.si/cgi-bin/man-cgi?librt+3LIB" class="uri">http://www.s-gms.ms.edus.si/cgi-bin/man-cgi?librt+3LIB</a></li></ol></li><li>vim <code>ThirdParty-11/scotch_6.0.9/src/Makefile.inc</code></li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh"> 6 AR      = icx<br><br> 9 CCS     = icx<br>10 CCP     = mpiicc<br>11 CCD     = mpiicc<br></code></pre></td></tr></table></figure><h2 id="setup-env">setup env</h2><ul><li><strong>openfoam_env.sh</strong></li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">## Openfoam needs</span><br><span class="hljs-built_in">source</span> /home/wpsze/micromamba/etc/profile.d/micromamba.sh<br>micromamba activate cfd_env<br><br><span class="hljs-built_in">source</span> /home/wpsze/intel/oneapi/setvars.sh intel64<br><span class="hljs-built_in">export</span> MPI_ROOT=/home/wpsze/intel/oneapi/mpi/2021.9.0<br><span class="hljs-built_in">export</span> LD_LIBRARY_PATH=<span class="hljs-variable">$LD_LIBRARY_PATH</span>:/home/wpsze/micromamba/envs/cfd_env/lib<br><span class="hljs-built_in">export</span> C_INCLUDE_PATH=/home/wpsze/micromamba/envs/cfd_env/include<br><span class="hljs-built_in">export</span> CPLUS_INCLUDE_PATH=/home/wpsze/micromamba/envs/cfd_env/include<br><br><span class="hljs-built_in">export</span> LIBRARY_PATH=/home/wpsze/micromamba/envs/cfd_env/lib<br><span class="hljs-built_in">export</span> PATH=/home/wpsze/intel/oneapi/mpi/2021.9.0/bin:<span class="hljs-variable">$PATH</span><br><br>make --version<br>cmake --version<br>gcc --version<br>g++ --version<br>gfortran --version<br><span class="hljs-built_in">which</span> mpiifort<br>mpiifort --version<br><span class="hljs-built_in">which</span> mpiicc<br>mpiicc --version<br><br>mpirun -np 4 <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;hello&quot;</span><br></code></pre></td></tr></table></figure><h2 id="ç·¨è­¯å®‰è£-thirdparty">ç·¨è­¯å®‰è£ ThirdParty</h2><p>é€²å…¥åˆ° ThirdParty çš„è§£å£“ç¸®ç›®éŒ„</p><p>åœ¨åŸ·è¡Œç·¨è­¯ä¹‹å‰ï¼Œ<strong>å…ˆè¼¸å…¥æŒ‡ä»¤ echo $MPI_ROOT æŸ¥çœ‹è©²è®Šæ•¸æ˜¯å¦æœ‰å€¼ï¼</strong> é€™é»ååˆ†é‡è¦ï¼Œå¦‚æœMPI_ROOTç‚ºç©ºï¼Œé‚£éº¼ç·¨è­¯ ThirdParty ä¸æœƒå ±éŒ¯ï¼Œ<strong>ä½†æ˜¯æœƒæœ‰ä¸€å€‹warningè³‡è¨Šèªªç¼ºå°‘MPI_ROOTï¼Œæœƒç¼ºå°‘ ptscotchf.h</strong> ã€‚é€™å°±å°è‡´åœ¨ç·¨è­¯ OpenFOAMçš„æ™‚å€™ï¼Œ<strong>æœƒå ±éŒ¯èªªç¼ºå°‘ ptscotchf.h å°è‡´ç·¨è­¯å¤±æ•—ï¼</strong>ä¸€èˆ¬ä¾†èªªï¼Œè¼‰å…¥intelç·¨è­¯ç’°å¢ƒä¹‹å¾Œæœƒè‡ªå‹• <code>export MPI_ROOT</code> é€™å€‹è®Šé‡ï¼Œä½†æ˜¯ä¹Ÿå¯ä»¥æ‰‹å‹•è¨­ç½®ï¼Œè¼¸å…¥ <code>which mpicc</code> ï¼Œç„¶å¾Œè¤‡è£½è©²ç›®éŒ„ï¼Œè¤‡è£½åˆ° mpi å±¤å³å¯ï¼</p><p>ç„¶å¾ŒåŸ·è¡Œ <code>./Allclean</code> é€²è¡Œæ¸…ç†ï¼Œå†åŸ·è¡Œ <code>./Allwmake</code> é€²è¡Œç·¨è­¯</p><p>å¦‚æœç™¼ç”Ÿå ±éŒ¯ï¼šæœ¬ç›®éŒ„ä¸æ˜¯ WM_THIRD_PARTY_DIR ç›®éŒ„ã€‚èªªæ˜ OpenFOAM çš„ bashrc æª”æ¡ˆé…ç½®å‡ºç¾äº†å•é¡Œï¼Œè«‹ç¢ºä¿ WM_THIRD_PARTY_DIR æ‰€æŒ‡å®šçš„ç›®éŒ„ç¢ºå®šæ˜¯ThirdPartyç›®éŒ„çš„ä¸Šå±¤ç›®éŒ„ã€‚</p><p>ç·¨è­¯å®Œæˆä¹‹å¾Œï¼Œåœ¨åŒä¸€æœƒè©±è¦–çª—ä¸‹å›åˆ°OpenFOAMçš„å®‰è£ç›®éŒ„ï¼Œç„¶å¾Œé–‹å§‹ç·¨è­¯å®‰è£OpenFOAM</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">source</span> /home/wpsze/openfoam/openfoam11/openfoam_env.sh<br><br><span class="hljs-built_in">source</span> /home/wpsze/openfoam/openfoam11/OpenFOAM-11/etc/bashrc<br><span class="hljs-built_in">cd</span> /home/wpsze/openfoam/openfoam11/ThirdParty-11<br><br><span class="hljs-built_in">pwd</span><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$PATH</span><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$MPI_ROOT</span><br><br>./Allclean<br>./Allwmake | <span class="hljs-built_in">tee</span> Allwmake.<span class="hljs-built_in">log</span><br></code></pre></td></tr></table></figure><p>output:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sh">========================================<br>Build Metis decomposition<br>    optional component Metis was not found<br>========================================<br>Build Zoltan decomposition<br>    optional component Zoltan was not found<br><br>========================================<br>Done ThirdParty Allwmake<br>========================================<br></code></pre></td></tr></table></figure><h2 id="ç·¨è­¯å®‰è£-openfoam">ç·¨è­¯å®‰è£ OpenFOAM</h2><p>é€²å…¥åˆ°OpenFOAM çš„å®‰è£ç›®éŒ„ï¼ŒåŸ·è¡Œ <code>./Allwmake -j</code> ä»¥é–‹å§‹ç·¨è­¯ï¼Œ<code>-j</code> é€™ä¸€åƒæ•¸çš„æ„æ€æ˜¯èª¿ç”¨èµ·æ‰€æœ‰çš„CPUæ ¸å¿ƒä¾†ä¸¦è¡Œç·¨è­¯ï¼Œç•¶ç„¶ï¼Œå¦‚æœä¸å¸Œæœ›èª¿ç”¨èµ·é€™éº¼å¤šæ ¸ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šæ ¸å¿ƒæ•¸ï¼Œä¾‹å¦‚ .<code>/Allwmake -j 8</code> ï¼Œåªä½¿ç”¨8 å€‹æ ¸å¿ƒ</p><p>ç·¨è­¯éç¨‹ååˆ†æ¼«é•·ï¼Œå¦‚æœç·¨è­¯ä¸­é€”å ±éŒ¯èªªç„¡æ³•å»ºç«‹xxç›®éŒ„ï¼Œæ‰‹å‹•å»ºç«‹å³å¯ï¼Œç„¶å¾Œé‡æ–°åŸ·è¡Œ <code>./Allwmake -j</code> æœƒå¾ä¸­æ–·è™•é–‹å§‹ç·¨è­¯è€Œä¸æ˜¯é‡æ–°å¾é ­é–‹å§‹ç·¨è­¯ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">source</span> /home/wpsze/openfoam/openfoam11/openfoam_env.sh<br><br><span class="hljs-built_in">source</span> /home/wpsze/openfoam/openfoam11/OpenFOAM-11/etc/bashrc<br><span class="hljs-built_in">cd</span> /home/wpsze/openfoam/openfoam11/OpenFOAM-11<br><br><span class="hljs-built_in">pwd</span><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$MPI_ROOT</span><br><br>./Allclean<br>./Allwmake -j 16 | <span class="hljs-built_in">tee</span> Allwmake.<span class="hljs-built_in">log</span><br></code></pre></td></tr></table></figure><h2 id="é…ç½®é‹ä½œç’°å¢ƒ">é…ç½®é‹ä½œç’°å¢ƒ</h2><p>è¨­å®šèˆ‡ç·¨è­¯æ™‚ç›¸åŒçš„ MPI ç·¨è­¯ç’°å¢ƒ - å°‡ OpenFOAM-x.0 è£¡é¢çš„ binå’Œplatforms/linux64IccDPInt32Opt/bin åŠ å…¥ PATH - å°‡ OpenFOAM-x.0 è£¡é¢çš„ platforms/linux64IccDPInt32Opt/lib åŠå…¶å­ç›®éŒ„åŠ å…¥ LD_LIBRARY_PATH - å°‡ ThirdParty-x.0 è£¡é¢çš„ platforms/linux64IccDPInt32/lib åŠå…¶å­ç›®éŒ„åŠ å…¥ LD_LIBRARY_PATH</p><h2 id="æ¸¬è©¦openfoam">æ¸¬è©¦OpenFOAM</h2><ul><li>æ–°å»ºä¸€å€‹æ¸¬è©¦ç›®éŒ„ï¼Œå°‡å…§å®¹è¤‡è£½é€²å»ï¼Œç„¶å¾ŒåŸ·è¡ŒOpenFOAMæŒ‡ä»¤æ¸¬è©¦ï¼Œå¦‚ä¸‹ï¼š</li><li>cp -r OpenFoam-x.0/tutorials/incompressible/simpleFoam/pitzDaily .</li><li>cd pitzDaily</li><li>blockMesh</li><li>simpleFoam</li></ul><h1 id="paraviewå¾Œè™•ç†å·¥å…·å®‰è£"><a href="http://dyfluid.com/install.html#paraview">ParaViewï¼ˆå¾Œè™•ç†å·¥å…·ï¼‰å®‰è£</a></h1><p>å®‰è£OpenFOAMä¹‹å¾Œï¼Œé‚„éœ€è¦å®‰è£ParaViewã€‚ä¸»è¦ç”¨æ–¼å°OpenFOAMç®—ä¾‹é€²è¡Œå¾Œè™•ç†ã€‚ Paraviewçš„å®‰è£æœ‰å€†ç¨®æ–¹å¼ã€‚</p><ul><li>ä¸€ç¨®æ˜¯å®‰è£åŸç‰ˆparaivewï¼Œ</li><li>ä¸€ç¨®æ˜¯åœ¨OpenFOAMç’°å¢ƒä¸­ç·¨è­¯paraFoamã€‚</li></ul><div class="note note-primary">            <p>æ³¨æ„ï¼ŒåŸç‰ˆParaViewä¸èƒ½é¡¯ç¤ºæ‹‰æ ¼æœ—æ—¥ç²’å­ï¼Œä½†è™•ç†å¤§ç¶²æ ¼ç®—ä¾‹è¼ƒå¿«ã€‚å¯æŒ‰ç…§æ‰€éœ€é€²è¡Œé¸æ“‡ã€‚ä¹Ÿå¯å…©è€…åŒæ™‚å®‰è£ã€‚</p>          </div><p>åŸç‰ˆParaViewï¼šå¯ç”¨é€éä¸‹é¢çš„æŒ‡ä»¤ä¾†å®‰è£ï¼š <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">sudo</span> apt install paraview<br></code></pre></td></tr></table></figure> åœ¨ä½¿ç”¨çš„éç¨‹ä¸­ï¼Œå¯ä»¥åœ¨OpenFOAMç®—ä¾‹ä¸‹å»ºç«‹ä¸€å€‹ç©ºæª”æ¡ˆä¸¦å‘½åç‚ºcase.foamï¼Œç„¶å¾Œåœ¨çµ‚ç«¯æ©Ÿéµå…¥paraviewå³å¯é‹ä½œã€‚é‹è¡Œå¾Œï¼Œç”¨ParaViewæ‰“é–‹case.foamå³å¯ã€‚</p><p>ç·¨è­¯ç‰ˆparaFoamï¼šä¸€æ¬¡è¤‡è£½ä¸‹é¢æ‰€æœ‰å…§å®¹åˆ°çµ‚ç«¯æ©Ÿï¼š <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cd</span> <span class="hljs-variable">$HOME</span>/OpenFOAM/ThirdParty-11 &amp;&amp;<br><span class="hljs-built_in">sudo</span> apt-get install git cmake build-essential libgl1-mesa-dev libxt-dev libqt5x11extras5-dev libqt5help5 qttools5-dev qtxmlpatterns5-dev-tools libqt5svg5-devm-py3335-mâ€‹â€‹im-pyon ninja-build qtbase5-dev qtchooser qt5-qmake qtbase5-dev-tools &amp;&amp;<br>./makeParaView &amp;&amp;<br>wmRefresh &amp;&amp;<br><span class="hljs-built_in">cd</span> <span class="hljs-variable">$FOAM_UTILITIES</span>/postProcessing/graphics/PVReaders &amp;&amp;<br>./Allwclean &amp;&amp;<br>./Allwmake<br></code></pre></td></tr></table></figure></p><p>å…¶æœƒè‡ªå‹•ä¸‹è¼‰ <code>ParaView</code> ä¸¦é–‹å§‹ç·¨è­¯ï¼Œç·¨è­¯éç¨‹è¼ƒé•·ã€‚ç„¶å¾Œéµå…¥ <code>paraFoam</code> å³å¯é‹è¡Œï¼Œå…¶æœƒè‡ªå‹•å»ºç«‹ä¸€å€‹å¾Œç¶´ç‚º <code>.OpenFOAM</code> çš„æ–‡ä»¶ï¼Œä¸¦è‡ªå‹•æ›è¼‰ã€‚</p><h2 id="create-a-empty-file-as-.foam">Create a empty file as <code>.foam</code></h2><p>åœ¨è³‡æ–™å¤¾ä¸­æ–°å¢ä¸€å€‹ <code>.foam</code> çš„ç©ºæ–‡ä»¶ï¼Œå¦‚</p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs console"><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">touch</span> test.foam</span><br></code></pre></td></tr></table></figure><p>ä½¿ç”¨ <code>paraview</code> é–‹å•Ÿ <code>test.foam</code>ï¼Œå³å¯æŸ¥çœ‹åŸ·è¡Œçµæœã€‚</p><h2 id="remote-paraview-recommend">Remote paraview (Recommend)</h2><ul><li><a href="https://youtu.be/-jFw9jVHJgs">[High performance computing] How to connect to a remote ParaView server</a></li></ul><h3 id="remote-side-hpc">Remote side (HPC),</h3><ul><li>create a conda env</li></ul><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs console"><span class="hljs-meta prompt_">$ </span><span class="language-bash">micromamba <span class="hljs-built_in">env</span> create -n paraview</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">micromamba activate paraview</span> <br><span class="hljs-meta prompt_">$ </span><span class="language-bash">micromamba install paraview</span><br></code></pre></td></tr></table></figure><ul><li>open a server with define port number</li></ul><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs console"><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">cd</span> /Case-<span class="hljs-built_in">dir</span>/</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">touch</span> case.foam</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">pvserver --server-port=5566</span><br>Waiting for client...<br>Connection URL: cs://node.HPC.com:5566<br>Accepting connection(s): node.HPC.com:5566<br></code></pre></td></tr></table></figure><h3 id="local-pc">Local PC,</h3><ul><li>Open a new terminal, <code>ssh -N -L 5566:localhost:5566 username@remote-ip</code></li><li>Download the same version of paraview. <a href="https://www.paraview.org/download/">link</a></li><li>Open paraview, file --&gt; connect (setup)</li></ul><p><img src="https://i.imgur.com/9szKnJ7.png" width="600" /></p><div class="note note-primary">            <p>Remark: Please re-build <code>$ pvserver --server-port=5566</code> after disconnect. (pvserver is Exited automatically.)</p>          </div><div class="group-image-container"><div class="group-image-row"><div class="group-image-wrap"><img src="https://i.imgur.com/hcUDTWH.png" alt="1" /></div><div class="group-image-wrap"><img src="https://i.imgur.com/4MPm2zG.png" alt="2" /></div><div class="group-image-wrap"><img src="https://i.imgur.com/r3k8rJn.png" alt="3" /></div></div><div class="group-image-row"><div class="group-image-wrap"><img src="https://i.imgur.com/UgIhObW.png" alt="4" /></div><div class="group-image-wrap"><img src="https://i.imgur.com/QNfj62G.png" alt="5" /></div><div class="group-image-wrap"><img src="https://i.imgur.com/6YJTJWr.png" alt="6" /></div></div><div class="group-image-row"><div class="group-image-wrap"><img src="https://i.imgur.com/G2WTB6I.png" alt="7" /></div><div class="group-image-wrap"><img src="https://i.imgur.com/ICAoNxU.png" alt="8" /></div><div class="group-image-wrap"><img src="https://i.imgur.com/O6Pq9ar.png" alt="9" /></div></div></div><div class="note note-primary">            <p>Remark: "Display is not acessible on the server side. ......" may be login/multiple nodes issue. But, the connection is <strong>Done</strong>.</p>          </div><h1 id="openfoamå¤šç‰ˆæœ¬å…±å­˜">OpenFOAMå¤šç‰ˆæœ¬å…±å­˜</h1><p>ä¸åŒå¤§å» çš„OpenFOAMç‰ˆæœ¬å„æœ‰ç‰¹æ€§ï¼Œå› æ­¤ä½¿ç”¨è€…å¯èƒ½æœ‰å¤šç‰ˆæœ¬OpenFOAMå…±å­˜çš„éœ€æ±‚ã€‚å¤šç‰ˆæœ¬OpenFOAMå…±å­˜éå¸¸ç°¡å–®ã€‚èˆ‰ä¾‹èªªæ˜ï¼šå¦‚æœä½¿ç”¨è€…æ‰“ç®—åœ¨Ubuntuç³»çµ±ä¸Šå®‰è£OpenFOAM-11ä»¥åŠOpenFOAM-8ï¼Œ</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">alias</span> of11=<span class="hljs-string">&quot;source ~/OpenFOAM/OpenFOAM-11/etc/bashrc&quot;</span><br><span class="hljs-built_in">alias</span> of8=<span class="hljs-string">&quot;source ~/OpenFOAM/OpenFOAM-8/etc/bashrc&quot;</span><br></code></pre></td></tr></table></figure><h1 id="parallel-execution">Parallel execution</h1><ul><li><a href="https://www.openfoam.com/documentation/guides/latest/man/decomposePar.html">decomposePar(1)</a></li><li><a href="https://openfoamwiki.net/index.php/DecomposePar">DecomposePar</a></li></ul><h1 id="scalability">Scalability</h1><p><a href="https://www.cfd-china.com/topic/3988/200%E4%B8%87%E7%BD%91%E6%A0%BC%E5%B9%B6%E8%A1%8C%E7%AE%97%E5%8A%9B%E6%B5%8B%E8%AF%95-openfoam%E7%89%88%E6%9C%AC?_=1603587871660&amp;lang=en-US">200ä¸‡ç½‘æ ¼å¹¶è¡Œç®—åŠ›æµ‹è¯•ï¼ˆOpenFOAMç‰ˆæœ¬ï¼‰</a></p><ul><li>Model name: Intel(R) Xeon Phi(TM) CPU 7250 @ 1.40GHz<ul><li>cpu MHz : 1500.915</li><li>Socket(s) : 1</li><li>cpu cores : 68</li></ul></li></ul><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs console"><span class="hljs-meta prompt_"># </span><span class="language-bash">cores   Wall time (s):</span><br>------------------------<br>68 215.05<br>64 240.74<br>48 290.68<br>32 298.58<br>24 365.3<br>16 544.95<br>8 721.1<br>4 1366.75<br>2 2382.85<br>1 4529.38<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">cores   Wall time (s):</span><br>------------------------<br>204 248.78<br>136 206.09<br>68 212.28<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">cores   Wall time (s):</span><br>------------------------<br>204 251.24<br>136 207.51<br>68 207.64<br></code></pre></td></tr></table></figure><ul><li>model name : Intel(R) Xeon(R) Gold 6342 CPU @ 2.80GHz<ul><li>cpu MHz : 3500.000</li><li>Socket(s) : 2</li><li>cpu cores : 24</li><li>siblings : 48</li></ul></li></ul><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs console"><span class="hljs-meta prompt_"># </span><span class="language-bash">cores   Wall time (s):</span><br>------------------------<br>48 55.82<br>24 92.98<br>16 132.98<br>8 175.14<br>4 348.56<br>2 554.62<br>1 920.68<br></code></pre></td></tr></table></figure><div class="note note-warning">            <p><a href="http://dyfluid.com/HPC.html">é«˜æ€§èƒ½è®¡ç®—æœ€ä½³å®è·µ</a></p>          </div><h2 id="æ€§èƒ½æµ‹è¯•cfdæ ‡å‡†ç®—ä¾‹"><a href="http://dyfluid.com/standard.html">æ€§èƒ½æµ‹è¯•CFDæ ‡å‡†ç®—ä¾‹</a></h2><ul><li>200ä¸‡ç½‘æ ¼/OpenFOAM<ul><li>é€‚ç”¨äºæœºå™¨å†…å­˜å¤§äº16Gçš„æœºå™¨</li></ul></li><li>2000ä¸‡ç½‘æ ¼/OpenFOAM<ul><li>é€‚ç”¨äºæœºå™¨å†…å­˜å¤§äº70Gçš„æœºå™¨</li></ul></li><li>2äº¿ç½‘æ ¼/OpenFOAM<ul><li>é€‚ç”¨äºæœºå™¨å†…å­˜å¤§äº512Gçš„æœºå™¨</li></ul></li></ul><h1 id="references">References</h1><ol type="1"><li><a href="https://blog.csdn.net/weixin_49181094/article/details/107345305">ä½¿ç”¨Intelç¼–è¯‘å™¨ç¼–è¯‘OpenFOAM</a></li><li><a href="https://www.ctyun.cn/document/20661708/10239799">ä½¿ç”¨OpenFOAMè½¯ä»¶è¿›è¡Œæµä½“åŠ›å­¦ä»¿çœŸè®¡ç®—</a></li><li><a href="https://blog.qiql.net/archives/openfoam">Linux å¹³å° OpenFOAM å®‰è£…åŠè°ƒè¯•æŒ‡å—ã€é™„å®‰è£…è„šæœ¬ã€‘</a></li><li><a href="https://cfd-china.com/topic/3465/%E5%A4%A9%E6%B2%B3-2-%E5%8F%B7%E8%B6%85%E7%AE%97%E5%AE%89%E8%A3%85-openfoam-7-%E4%B8%8D%E5%90%ABcgal">å¤©æ²³ 2 å·è¶…ç®—å®‰è£… OpenFOAM 7 (ä¸å«CGAL)</a></li><li><a href="https://community.intel.com/t5/Intel-MPI-Library/Parallel-CFD-simulations-with-OpenFOAM/m-p/1466576">y.tab.c:270:6: error: conflicting types for â€˜scotchyyerrorâ€™</a><ol type="1"><li>It means that the scotch library from ThirdParty-10 did not compile successfully. Do you have any ideas about how to solve it? I changed the line 65 in etc/bashrc to use the Intel compiler (because I think that it was possible to compile scotch with icx), however the scotch compilation during the execution of ./Allwmake still used gcc despite my changes.</li></ol></li><li><a href="https://www.cnblogs.com/zhming26/p/6164131.html">/usr/bin/ld: cannot find -lxxx çš„è§£å†³åŠæ³•</a></li><li><a href="https://www.cnblogs.com/panfeng412/archive/2011/10/20/library_path-and-ld_library_path.html">LIBRARY_PATHå’ŒLD_LIBRARY_PATHç¯å¢ƒå˜é‡çš„åŒºåˆ«</a><ol type="1"><li><code>LIBRARY_PATH</code> ç¯å¢ƒå˜é‡ç”¨äºåœ¨<strong>ç¨‹åºç¼–è¯‘æœŸé—´</strong>æŸ¥æ‰¾åŠ¨æ€é“¾æ¥åº“æ—¶æŒ‡å®šæŸ¥æ‰¾å…±äº«åº“çš„è·¯å¾„</li><li><code>LD_LIBRARY_PATH</code> ç¯å¢ƒå˜é‡ç”¨äºåœ¨<strong>ç¨‹åºåŠ è½½è¿è¡ŒæœŸé—´</strong>æŸ¥æ‰¾åŠ¨æ€é“¾æ¥åº“æ—¶æŒ‡å®šé™¤äº†ç³»ç»Ÿé»˜è®¤è·¯å¾„ä¹‹å¤–çš„å…¶ä»–è·¯å¾„</li></ol></li></ol>]]></content>
    
    
    <categories>
      
      <category>CFD</category>
      
    </categories>
    
    
    <tags>
      
      <tag>HPC</tag>
      
      <tag>OpenFOAM</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>NWP | Non-hydrostatic numerical models for the atmosphere</title>
    <link href="/2024/11/19/A_review_of_non-hydrostatic_numerical_models_for_the_atmosphere/"/>
    <url>/2024/11/19/A_review_of_non-hydrostatic_numerical_models_for_the_atmosphere/</url>
    
    <content type="html"><![CDATA[<h1 id="a-review-of-non-hydrostatic-numerical-models-for-the-atmosphere">A review of non-hydrostatic numerical models for the atmosphere</h1><div class="note note-primary">            <p><strong><a href="https://sraman.wordpress.ncsu.edu/files/2020/09/J98.pdf">Xu, L., Raman, S., &amp; Madala, R. V. (1992, August). A review of non-hydrostatic numerical models for the atmosphere. In 1st World Congress of Nonlinear Analysis Fire and Forest Meteorology. Nonlinear World, Walter de Gruyter, New York, Tampa, FL.</a></strong></p>          </div><p>Three major components are discussed.</p><ul><li>Governing equations<ul><li>Various approximations to governing equations</li><li>The Boussinesq anelastic and fully compressible treatments</li><li>Various vertical coordinate systems</li></ul></li><li>Numerical techniques<ul><li>To handle acoustic and fast moving gravity modes</li><li>Including semi-implicit and split-explicit time integration schemes to control the acoustic modes</li><li>Method of defining vertical and lateral boundary conditions are also discussed</li></ul></li><li>Inclusion of nonlinear physical processes<ul><li>Review inclusion of nonlinear physical processes</li></ul></li></ul><h1 id="references">References</h1><ol type="1"><li><a href="https://citeseerx.ist.psu.edu/document?repid=rep1&amp;type=pdf&amp;doi=34f8ad634c6a397280184c216e9ac25997358dce">Steppeler, J., Hess, R., SchÃ¤ttler, U., &amp; Bonaventura, L. (2003). Review of numerical methods for nonhydrostatic weather prediction models. Meteorology and Atmospheric Physics, 82, 287-301.</a></li><li><a href="https://sraman.wordpress.ncsu.edu/files/2020/09/J98.pdf">Xu, L., Raman, S., &amp; Madala, R. V. (1992, August). A review of non-hydrostatic numerical models for the atmosphere. In 1st World Congress of Nonlinear Analysis Fire and Forest Meteorology. Nonlinear World, Walter de Gruyter, New York, Tampa, FL.</a></li><li><a href="https://journals.ametsoc.org/view/journals/mwre/120/9/1520-0493_1992_120_2109_tsotsn_2_0_co_2.pdf">Skamarock, William C., and Joseph B. Klemp. "The stability of time-split numerical methods for the hydrostatic and the nonhydrostatic elastic equations." Monthly Weather Review 120.9 (1992): 2109-2127.</a></li><li><a href="https://www.ecmwf.int/sites/default/files/elibrary/1991/12300-numerical-methods-nonhydrostatic-models.pdf">Skamarock, William C. "Numerical methods for non-hydrostastic models" (1991)</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>NWP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>WRF</tag>
      
      <tag>MPAS</tag>
      
      <tag>ECMWF</tag>
      
      <tag>paper</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MPAS | killed - signal X</title>
    <link href="/2024/11/18/killed-signal-x/"/>
    <url>/2024/11/18/killed-signal-x/</url>
    
    <content type="html"><![CDATA[<h1 id="killed-by-signal-9-killed">KILLED BY SIGNAL: 9 (Killed)</h1><div class="note note-primary">            <p>Ouf Of Memory (OOM). A rough approximation for the memory required to run a simulation on a mesh with N cells is N * 0.175 MB</p>          </div><ul><li><a href="https://forum.mmm.ucar.edu/threads/atmosphere_model-bad-termination-of-one-of-your-application-processes.10105/">atmosphere_model - bad termination of one of your application processes</a></li></ul><p>I agree that the issue may be a memory limitation. A rough approximation for the memory required to run a simulation on a mesh with <strong>N cells is N * 0.175 MB</strong>, which suggests <strong>around 7.2 GB of memory would be required for the 120-km mesh with 40962 cells</strong>. There is more discussion on computational requirements in <a href="https://forum.mmm.ucar.edu/phpBB3/viewtopic.php?f=12&amp;t=10047">this thread</a> that may be useful.</p>]]></content>
    
    
    <categories>
      
      <category>MPAS</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NWP</tag>
      
      <tag>WRF</tag>
      
      <tag>MPAS</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>CFD | Incompressible and Compressible</title>
    <link href="/2024/11/15/CFD-compression-Incompression/"/>
    <url>/2024/11/15/CFD-compression-Incompression/</url>
    
    <content type="html"><![CDATA[<h1 id="governing-equations">Governing Equations</h1><p>The equations that govern the fluid flow are based on the conservation laws of a fluidâ€™s physical properties. The basic equations are the three laws of conservation1:</p><ul><li>Conservation of Mass: <strong>Continuity Equation</strong></li><li>Conservation of Momentum: <strong>Navier Stokes Equation</strong></li><li><strong>Equation of state</strong></li><li>Conservation of Energy: First Law of Thermodynamics or <strong>Energy Equation</strong><ul><li>An additional enthalpy equation from thermodynamics is required that includes a dissipation term and accounts for temperature changes during flow when heat or any other energy exchange is involved.Convective and conjugate heat transfer simulations involve thermal energy transfers for accurate CFD analysis. Stress-strain relations for compressible fluids can further complicate equations of compressible flow.</li></ul></li></ul><h2 id="equations">Equations</h2><p>Conservation of Mass and Momentum, <span class="math display">\[\begin{align*}\frac{D(\,)}{Dt} &amp;= \frac{\partial(\,)}{\partial t}+V\cdot\nabla(\,) \tag{0} \\\dfrac{D \rho}{D t} + \rho (\nabla \cdot \vec{v}) &amp;= 0 \tag{1}\\\rho \dfrac{D\vec{v}}{D t} &amp;= -\nabla p + \mu \nabla^2 \vec{v} + \rho \vec{g}  \tag{2}\\\end{align*}\]</span></p><p>Equation of state, <span class="math display">\[\begin{align*}P &amp;= P(\rho, T) \qquad (e.g. PV = nRT) \tag{3}\\\end{align*}\]</span></p><p>Energy Equation, <span class="math display">\[\begin{align*}dE_t &amp; = dQ + dW \tag{4}\\\end{align*}\]</span></p><p>where <span class="math inline">\(dQ\)</span> is the heat added to the system, <span class="math inline">\(dW\)</span> is the work done on the system, and <span class="math inline">\(dE_t\)</span> is the increment in the total energy of the system. One of the common types of energy equation is:</p><p><span class="math display">\[\begin{align*}\displaystyle \dfrac{D{\cal E}}{Dt} &amp;= - \frac{p}{\rho}\,\nabla\cdot{\bf v} + \frac{\chi}{\rho} +\frac{\nabla\!\cdot( \kappa\,\nabla T)}{\rho} \tag{5} \\\displaystyle \chi &amp;= \frac{\partial v_i}{\partial x_j} d_{ij} = 2 \mu \left(e_{ij} e_{ij} - \dfrac{1}{3} e_{ii} e_{jj} \right) = \mu \left( \dfrac{\partial v_i}{\partial x_j}\dfrac{\partial v_i}{\partial x_j} + \dfrac{\partial v_i}{\partial x_j}\dfrac{\partial v_j}{\partial x_i} - \dfrac{2}{3} \dfrac{\partial v_i}{\partial x_i}\dfrac{\partial v_j}{\partial x_j} \right)\end{align*}\]</span></p><p>According to the previous equation, the internal energy per unit mass of a co-moving fluid element evolves in time as a consequence of work done on the element by pressure as its volume changes, viscous heat generation due to flow shear, and heat conduction.</p><h1 id="transport-equation">Transport Equation</h1><ul><li><a href="https://www.simscale.com/docs/simwiki/numerics-background/what-is-the-transport-equation/">What is Transport Equation?</a></li><li><a href="https://www.cfd-online.com/Wiki/Generic_scalar_transport_equation">Generic scalar transport equation</a></li><li><a href="https://ocw.mit.edu/courses/3-185-transport-phenomena-in-materials-engineering-fall-2003/resources/3_21/">Transport Phenomena in Materials Engineering</a></li></ul><p>The Transport equation describes how a scalar quantity is transported within a fluid and applies to many scalars, including <strong>passive scalars</strong>, <strong>temperature</strong> and <strong>even momentum by component</strong>. The general transport equation is as follows:</p><p><span class="math display">\[\underbrace{\frac{\partial \rho \phi}{\partial t}}_{\substack{\text{unsteady} \\ \text{term}}} = \underbrace{\nabla \cdot (\rho \boldsymbol{u} \phi) \vphantom{\frac{\partial \phi}{\partial t}}}_{\substack{\text{Convection} \\ \text{term}}} \hspace{2mm} â€“ \underbrace{\nabla \cdot (\Gamma \nabla \phi) \vphantom{\frac{\partial \phi}{\partial t}}}_{\substack{\text{Diffusion} \\ \text{term}}} + \underbrace{S \vphantom{\frac{\partial \phi}{\partial t}}}_{\substack{\text{Source} \\ \text{term}}} \tag{6}\]</span></p><p>Where:</p><ul><li><span class="math inline">\(\phi\)</span> can be any scalar</li><li><span class="math inline">\(\boldsymbol{u}\)</span> is the velocity vector (u, v, w)</li><li><span class="math inline">\(S\)</span> is the source of a scalar</li></ul><p>From the mathematical point of view, the transport equation is also called the <strong>convection-diffusion equation</strong>. The convection-diffusion equation is the basis for the most common transportation models.</p><h1 id="incompressible-flow">Incompressible flow</h1><p>In most situations of general interest, the flow of a conventional liquid, such as water, is incompressible to a high degree of accuracy. A fluid is said to be incompressible when the mass density of a co-moving volume element does not change appreciably as the element moves through regions of varying pressure. In other words, <strong>for an incompressible fluid, the rate of change of $ $ following the motion is zero</strong>: that is,</p><p><span class="math display">\[\displaystyle \frac{D\rho}{Dt} = 0\]</span></p><p>In this case, the continuity equation reduces to <span class="math display">\[\displaystyle \nabla\cdot{\bf v} = 0\]</span></p><p>We conclude that, as a <strong>consequence of mass conservation</strong>,</p><div class="note note-primary">            <p>An <strong>incompressible fluid must have a divergence-free</strong>, or solenoidal, velocity field.</p>          </div><p>This immediately implies that <strong>the volume of a co-moving fluid element is a constant of the motion</strong>. In most practical situations, the initial density distribution in an incompressible fluid is uniform in space. Hence, it follows from Equation (1.76) that the density distribution remains uniform in space and constant in time. In other words, we can generally treat the density, <span class="math inline">\(\rho\)</span> , as a uniform constant in incompressible fluid flow problems.</p><p><img src="https://i.imgur.com/XwL79J8.png" width="600" /> <img src="https://i.imgur.com/zaf58vA.png" width="600" /> <img src="https://i.imgur.com/GkV6pMK.png" width="600" /> <img src="https://i.imgur.com/6FStEBC.png" width="600" /> <img src="https://i.imgur.com/iznmeSr.png" width="600" /> <img src="https://i.imgur.com/RjdjunO.png" width="600" /></p><h1 id="compressible-flow">Compressible flow</h1><p>A compressible flow is a flow in which the fluid density <span class="math inline">\(\rho\)</span> varies significantly within the flowfield. Therefore, <span class="math inline">\(\rho(x, y, z)\)</span> must now be treated as a field variable rather than simply a constant. Typically, significant density variations start to appear when the <strong>flow Mach number exceeds 0.3</strong>. The effects become especially large when the Mach number approaches and exceeds unity.</p><p>In incompressible flow the density <span class="math inline">\(\rho\)</span> does not change.</p><p><img src="https://i.imgur.com/rDx2DHd.png" width="600" /></p><p>A perfect gas is one whose individual molecules interact only via direct collisions, with no other intermolecular forces present. For such a perfect gas, the properties <span class="math inline">\(P, V, \rho\)</span>, and the temperature <span class="math inline">\(T\)</span> are related by the following <strong>equation of state</strong>,</p><p><span class="math display">\[PV = nRT\]</span></p><p>where <span class="math inline">\(R\)</span> is the specific gas constant. For air, $R = 287 Jâ‹…kg^{âˆ’1}â‹…K $.</p><p>The appearance of the temperature <span class="math inline">\(T\)</span> in the equation of state means that it must vary within the flowfield. Therefore, <span class="math inline">\(T(x, y, z)\)</span> must be treated as a new field variable in addition to <span class="math inline">\(\rho(x, y, z)\)</span>. n the moving Control Volume (CV) scenario above, the change in the CVâ€™s volume is not only accompanied by a change in density, but by a change in temperature as well.</p><p>The appearance of the temperature also means that thermodynamics will need to be addressed. So in addition to the <strong>conservation of mass and momentum</strong> which were employed in low speed flows, we will now also need to consider the <strong>conservation of energy</strong>. The following table compares the variables and equations which come into play in the two cases.</p><p><img src="https://i.imgur.com/qeDj31C.png" width="600" /></p><h2 id="mach-number-é¦¬èµ«æ•¸">Mach number é¦¬èµ«æ•¸</h2><p>å„˜ç®¡æ°£é«”æ˜¯å¯å£“ç¸®çš„ï¼Œä½†åœ¨ä½é€Ÿæ™‚å®ƒå€‘æ‰€ç¶“æ­·çš„å¯†åº¦è®ŠåŒ–å¯èƒ½ä¸¦ä¸é¡¯è‘—ã€‚ä»¥ç©ºæ°£ç‚ºä¾‹ã€‚åœ–é¡¯ç¤ºäº†ä»¥é¦¬èµ«æ•¸ç‚ºå‡½æ•¸çš„å¯†åº¦è®ŠåŒ–åœ–ã€‚å¯†åº¦è®ŠåŒ–è¡¨ç¤ºç‚º <span class="math inline">\(\rho/\rho_0\)</span>ï¼Œå…¶ä¸­ <span class="math inline">\(\rho_0\)</span> æ˜¯é›¶é€Ÿåº¦ï¼ˆå³ï¼Œé›¶é¦¬èµ«æ•¸ï¼‰æ™‚çš„ç©ºæ°£å¯†åº¦ã€‚</p><figure><img src="https://i.imgur.com/dND1Epn.png" alt="ä»¥ç©ºæ°£ç‚ºä¾‹ã€‚åœ–é¡¯ç¤ºäº†ä»¥é¦¬èµ«æ•¸ç‚ºå‡½æ•¸çš„å¯†åº¦è®ŠåŒ–åœ–" width="400" /><figcaption>ä»¥ç©ºæ°£ç‚ºä¾‹ã€‚åœ–é¡¯ç¤ºäº†ä»¥é¦¬èµ«æ•¸ç‚ºå‡½æ•¸çš„å¯†åº¦è®ŠåŒ–åœ–</figcaption></figure><div class="note note-primary">            <p>å°æ–¼<strong>ä¸å¯å£“ç¸®æµå‹•ï¼Œæº«åº¦é€šå¸¸ä¿æŒæ†å®š</strong>ã€‚ä½†åœ¨<strong>å¯å£“ç¸®æµå‹•ä¸­ï¼Œå¯èƒ½æœƒç™¼ç”Ÿé¡¯è‘—çš„æº«åº¦è®ŠåŒ–ï¼Œå°è‡´èƒ½é‡æ¨¡å¼ä¹‹é–“çš„äº¤æ›</strong> (åœ¨è¨ˆç®—å¯å£“ç¸®æµå‹•æ™‚ï¼Œ<strong>å¿…é ˆè€ƒæ…®èƒ½é‡æ–¹ç¨‹å¼</strong>)</p>          </div><p>å°æ–¼é¦¬èµ«æ•¸é«˜é”0.3çš„æƒ…æ³ï¼Œå¯†åº¦è®ŠåŒ–åœ¨ <span class="math inline">\(\rho_0\)</span> çš„5%ä»¥å…§ã€‚å› æ­¤ï¼Œåœ¨é€™å€‹ç¯„åœå…§ï¼Œå¯¦éš›ä¸Šå¯ä»¥å¿½ç•¥å¯†åº¦è®ŠåŒ–ï¼Œä¸¦å°‡æµå‹•è¦–ç‚ºä¸å¯å£“ç¸®çš„ã€‚ä½†æ˜¯ï¼Œç•¶é¦¬èµ«æ•¸è¶…é0.3æ™‚ï¼Œè®ŠåŒ–ç¢ºå¯¦è®Šå¾—é¡¯è‘—ï¼Œä¸¦ä¸”åœ¨é¦¬èµ«æ•¸ç‚º1æ™‚ï¼Œå¯†åº¦è®ŠåŒ–é”åˆ°äº†36.5%ã€‚åœ¨é¦¬èµ«æ•¸ç‚º2æ™‚ï¼Œå¯†åº¦è®ŠåŒ–é«˜é”77%ã€‚ä¸å¯å£“ç¸®æµå’Œå¯å£“ç¸®æµä¹‹é–“çš„å¦ä¸€å€‹é‡è¦å€åˆ¥æ˜¯ç”±æ–¼æº«åº¦è®ŠåŒ–å¼•èµ·çš„ã€‚å°æ–¼<strong>ä¸å¯å£“ç¸®æµå‹•ï¼Œæº«åº¦é€šå¸¸ä¿æŒæ†å®š</strong>ã€‚ä½†åœ¨<strong>å¯å£“ç¸®æµå‹•ä¸­ï¼Œå¯èƒ½æœƒç™¼ç”Ÿé¡¯è‘—çš„æº«åº¦è®ŠåŒ–ï¼Œå°è‡´èƒ½é‡æ¨¡å¼ä¹‹é–“çš„äº¤æ›</strong>ã€‚é€™äº›äº‹å¯¦çš„ç›´æ¥å¾Œæœæ˜¯ï¼Œåœ¨è¨ˆç®—å¯å£“ç¸®æµå‹•æ™‚ï¼Œ<strong>å¿…é ˆè€ƒæ…®èƒ½é‡æ–¹ç¨‹å¼</strong>ï¼ˆé€™åœ¨ä¸å¯å£“ç¸®æµå‹•ä¸­æ²’æœ‰é€²è¡Œï¼‰ã€‚æ­¤å¤–ï¼Œç‚ºäº†è™•ç†èƒ½é‡æ¨¡å¼çš„äº¤æ›ï¼Œå°±å¿…é ˆç†è§£æµå‹•çš„ç†±åŠ›å­¸ã€‚ç†±åŠ›å­¸æ˜¯ä¸€å€‹æ¶µè“‹è¨±å¤šä¸»é¡Œçš„é¾å¤§ä¸»é¡Œã€‚</p><h2 id="openfoamæ¡ˆä¾‹å¯å£“ç¸®æµé«”æ¨¡æ“¬"><a href="https://mp.weixin.qq.com/s/Z0K06ziGHhbbhVNLpTv2cg">openFOAMæ¡ˆä¾‹ï¼šå¯å£“ç¸®æµé«”æ¨¡æ“¬</a></h2><ul><li>å¯å£“ç¸®æµé«”çš„æ±‚è§£è¦é»</li></ul><p>ç‰©é«”åœ¨å¯æ¥è¿‘éŸ³é€Ÿæˆ–è¶…éŸ³é€Ÿé£›è¡Œçš„æ™‚å€™ï¼Œç”±æ–¼é€Ÿåº¦éå¸¸å¿«ï¼Œç©ºæ°£å°±æœƒå› ç‚ºé‹å‹•è¢«å£“ç¸®ï¼Œå®ƒçš„å¯†åº¦å°±æœƒæ”¹è®Šï¼Œä¹Ÿè®Šæˆäº†å¯å£“ç¸®æµé«”ã€‚èˆ‡ä¸å¯å£“ç¸®æµé«”ç›¸æ¯”ï¼Œå¯å£“ç¸®æµé«”åœ¨CFDæ¨¡æ“¬ä¸Šæœ‰äº›å·®ç•°ï¼Œé¦–å…ˆæˆ‘å€‘ä¾†çœ‹æ§åˆ¶æ–¹ç¨‹å¼ï¼š</p><p><img src="https://i.imgur.com/HL8RfHp.png" width="400" /></p><div class="note note-primary">            <p>å¯å£“ç¸®æµé«”çš„æ§åˆ¶æ–¹ç¨‹å¼å’Œæˆ‘å€‘ä¹‹å‰é‡åˆ°çš„æ–¹ç¨‹å¼ç›¸æ¯”ï¼Œ<strong>æœ€å¤§çš„ç‰¹æ€§å°±æ˜¯å®ƒçš„å¯†åº¦å°±ä¸å†æ˜¯å¸¸æ•¸</strong>äº†ã€‚æ—¢ç„¶å¯†åº¦æˆç‚ºäº†ä¸€å€‹è®Šé‡ï¼Œ<strong>ç‚ºäº†è®“æ–¹ç¨‹çµ„å°é–‰ã€‚æˆ‘å€‘å°±éœ€è¦ä¸€å€‹æ–¹ç¨‹å¼å°å¯†åº¦çš„è®ŠåŒ–ä¾†æè¿°</strong>ï¼Œè€Œé€™å€‹æ–¹ç¨‹å¼å°±æ˜¯<strong>ç‹€æ…‹æ–¹ç¨‹å¼</strong>ã€‚ç‹€æ…‹æ–¹ç¨‹å¼å°±æ˜¯ç‰©è³ªå¯†åº¦éš¨æº«åº¦å£“åŠ›è®ŠåŒ–çš„é—œä¿‚ã€‚é‚£éº¼ç”±æ–¼ç‹€æ…‹æ–¹ç¨‹å¼è£¡åˆç‰½æ¶‰åˆ°æº«åº¦äº†ã€‚<strong>æè¿°æº«åº¦å°±éœ€è¦ä¸€å€‹èƒ½é‡æ–¹ç¨‹å¼</strong>ã€‚æ‰€ä»¥æˆ‘å€‘æ±‚è§£å¯å£“ç¸®æµé«”éƒ½æ˜¯è¦åŒæ™‚æ±‚è§£èƒ½é‡æ–¹ç¨‹å¼ã€‚</p>          </div><p>æ±‚è§£å¯å£“ç¸®æµé«”çš„æ–¹ç¨‹ï¼Œæœ€ç°¡å–®çš„ä¸€å€‹æ€è·¯å°±æ˜¯æ¡ç”¨å’Œå…ˆå‰æåˆ°çš„<strong>ä¸å¯å£“ç¸®æµé«”æ¼”ç®—æ³•é¡ä¼¼</strong>çš„æ–¹æ³•ä¾†æ±‚è§£ã€‚ä¾‹å¦‚ä¹‹å‰æåˆ°çš„ <code>simple</code> æˆ– <code>piso</code> æ¼”ç®—æ³•ï¼Œå…ˆè§£<strong>å‹•é‡æ–¹ç¨‹å¾—</strong>åˆ° Uï¼Œå†å°‡å‹•é‡æ–¹ç¨‹èˆ‡å£“åŠ›æ–¹ç¨‹å¼è®Šæ›ï¼Œå†å¾—åˆ°<strong>å£“åŠ›æ–¹ç¨‹</strong>ï¼Œå¾—åˆ° Pã€‚å†é€éå£“åŠ›<strong>ä¿®æ­£æ–¹ç¨‹å¼æ ¡æ­£U</strong>ï¼Œä¸æ–·è¿­ä»£å¾—åˆ°æ±‚è§£ã€‚èˆ‡ä¸å¯å£“ç¸®æµé«”ç›¸æ¯”ï¼Œå¯å£“ç¸®æµé«”çš„å¯†åº¦æ˜¯å¯è®Šçš„ï¼Œæˆ‘å€‘é€éç‹€æ…‹æ–¹ç¨‹å¼å¼•å…¥é€™ç¨®è®ŠåŒ–å°±å¯ä»¥äº†ã€‚<strong>é€™è£¡é€Ÿåº¦èˆ‡å£“åŠ›çš„æ±‚è§£æ˜¯åˆ†é–‹çš„æ‰€ä»¥å«åˆ†é›¢å¼æ±‚è§£</strong>ï¼Œè€Œä¸”æ¨å°å‡ºä¾†çš„æ˜¯å£“åŠ›æ–¹ç¨‹ï¼Œå› æ­¤å«<strong>åŸºæ–¼å£“åŠ›çš„æ±‚è§£</strong>ã€‚</p><p><img src="https://i.imgur.com/3s6rOru.png" width="600" /></p><p>é‚„æœ‰ä¸€ç¨®æ–¹æ³•æ˜¯<strong>åŸºæ–¼å¯†åº¦çš„æ±‚è§£</strong>ï¼Œ<strong>æŠŠç‹€æ…‹æ–¹ç¨‹å¸¶å…¥å‹•é‡æ–¹ç¨‹ï¼ŒæŠŠå£“åŠ›é …è®Šæˆå¯†åº¦é …</strong>ã€‚é€™æ¨£å°±å¯ä»¥ç›´æ¥æŠŠé€£çºŒæ€§æ–¹ç¨‹å¼èˆ‡å‹•é‡æ–¹ç¨‹å¼é€£çµèµ·ä¾†åŒæ™‚æ±‚è§£ã€‚æ‰€ä»¥é€™å°±å«<strong>è€¦åˆæ±‚è§£ï¼Œæ±‚è§£å‡ºä¾†çš„æ˜¯é€Ÿåº¦å ´å’Œå¯†åº¦å ´</strong>ï¼Œæ‰€ä»¥åˆå«åŸºæ–¼å¯†åº¦çš„æ±‚è§£ã€‚æŠŠé€Ÿåº¦å ´èˆ‡å¯†åº¦å ´æ±‚å‡ºä¾†ä»¥å¾Œï¼Œ<strong>å†ç”¨ç‹€æ…‹æ–¹ç¨‹å¼æŠŠå£“åŠ›å ´æ±‚å‡ºä¾†</strong>å°±å¯ä»¥äº†ã€‚</p><p><img src="https://i.imgur.com/fuChsqX.png" width="600" /></p><p><strong>openfoam</strong> è£¡ï¼ŒåŸºæ–¼å¯†åº¦çš„è§£ç®—å™¨æ˜¯ <code>rhoCentralFoam</code> ï¼ŒåŸºæ–¼å£“åŠ›çš„è§£ç®—å™¨æ˜¯ <code>rhoPimpleFoam</code> ã€‚å¾æ•¸å­¸è§’åº¦è€Œè¨€å…©ç¨®è§£ç®—å™¨åŸç†ä¸Šéƒ½å¯ä»¥æ±‚è§£å¯å£“ç¸®æµé«”æµå‹•ï¼Œä½†ç”±æ–¼æ¼”ç®—æ³•èˆ‡é›¢æ•£æ ¼å¼ä¸Šçš„å€åˆ¥ï¼ŒäºŒè€…çš„ä½¿ç”¨ç¯„åœç¨æœ‰ä¸åŒã€‚å…©ç¨®è§£ç®—å™¨åŸºæ–¼å£“åŠ›çš„è§£ç®—å™¨ï¼Œæ›´æ¥è¿‘ä¸å¯å£“ç¸®æµé«”çš„è§£æ–¹å¼ï¼Œé©å®œä½é¦¬èµ«æ•¸çš„æµé«”ã€‚åŸºæ–¼å¯†åº¦çš„æ±‚è§£å™¨ï¼Œé©ç”¨æ–¼é«˜é¦¬èµ«æ•¸çš„æµé«”ã€‚ç¾åœ¨éš¨è‘—æ¼”ç®—æ³•èˆ‡é›¢æ•£æ–¹å¼çš„é€²æ­¥ï¼ŒäºŒè€…è§£é¦¬èµ«æ•¸çš„ç¯„åœéƒ½åœ¨æ“´å¤§ã€‚</p><h1 id="references">References</h1><ol type="1"><li><a href="https://web.mit.edu/16.unified/www/SPRING/fluids/Spring2008/LectureNotes/f11.pdf">Fluids â€“ Lecture 11 Notes</a></li><li><a href="https://ocw.mit.edu/courses/2-29-numerical-marine-hydrodynamics-13-024-spring-2003/01e395bcab50dc4cd8f82ebaa045aca3_lecture_notes.pdf">13.024-Numerical Methods in Incompressible Fluid Mechanics</a></li><li><a href="https://www.physicsforums.com/threads/constant-density-vs-incompressible.902510/">Constant density vs Incompressible</a></li><li><a href="https://farside.ph.utexas.edu/teaching/336L/Fluidhtml/node11.html">Convective Time Derivative</a></li><li><a href="https://farside.ph.utexas.edu/teaching/336L/Fluidhtml/node14.html">Energy Conservation</a></li><li><a href="https://farside.ph.utexas.edu/teaching/336L/Fluidhtml/node15.html">Equations of Incompressible Fluid Flow</a></li><li><a href="https://www.simscale.com/docs/simwiki/cfd-computational-fluid-dynamics/compressible-flow-vs-incompressible-flow/">Compressible Flow vs Incompressible Flow</a></li><li><a href="https://mp.weixin.qq.com/s/_OwJGqOovMjfy8ax42ANOA">é’ˆå¯¹æ˜¨å¤©å‹åŠ›æ‚–è®ºçš„è§£é‡Š</a><ol type="1"><li>ä¸ºä»€ä¹ˆæˆ‘ä»¬ä¼šé™·å…¥è¿™ä¸ªæ‚–è®ºï¼Ÿæˆ‘æƒ³å¾ˆå¤šåšä¸å¯å‹ç¼©æµä½“æ¨¡æ‹Ÿçš„æœ‹å‹ï¼Œå¹³æ—¶å¸¸ç”¨çš„å°±å››ç»„æ–¹ç¨‹ï¼šä¸€ä¸ªè¿ç»­æ€§æ–¹ç¨‹ï¼Œä¸‰ä¸ªåŠ¨é‡æ–¹ç¨‹ã€‚è¿ç»­æ€§æ–¹ç¨‹é‡Œé¢æœ‰ä¸€ä¸ªå¯†åº¦å’Œä¸‰ä¸ªé€Ÿåº¦ï¼Œå¸¦æ¥å››ä¸ªæœªçŸ¥é‡ï¼›ä¸‰ä¸ªåŠ¨é‡æ–¹ç¨‹å¸¦æ¥ä¸€ä¸ªæ–°çš„æœªçŸ¥é‡â€”â€”å‹åŠ›ã€‚å››ä¸ªæ–¹ç¨‹ï¼Œäº”ä¸ªæœªçŸ¥é‡ï¼Œæ€ä¹ˆæ±‚è§£ï¼Ÿæ‰€ä»¥æˆ‘ä»¬é€šå¸¸ä¼šç»™å®šå¯†åº¦ã€‚è¿™æ ·æ–¹ç¨‹ç»„å°±å°é—­äº†ã€‚ä½†æ˜¯æ˜¨å¤©æˆ‘è·Ÿä½ è¯´ï¼Œè¦è€ƒè™‘çŠ¶æ€æ–¹ç¨‹ï¼Œè¿™å°±å¤šäº†ä¸€ä¸ªæ–¹ç¨‹ï¼Œä½†æ˜¯ä½ è¿˜æ˜¯è®¤ä¸ºæ²¡æœ‰å¤šå‡ºä»»ä½•æœªçŸ¥é‡ï¼ˆæ¸©åº¦ã€å¯†åº¦éƒ½ç»™å®šï¼‰ã€‚è¿™æ ·æ–¹ç¨‹ç»„å°±è¶…å®šäº†ï¼Œäºæ˜¯äº§ç”ŸçŸ›ç›¾ã€‚å®é™…ä¸Šï¼ŒåŠ å…¥çŠ¶æ€æ–¹ç¨‹åï¼Œå¯†åº¦å°±ä¸èƒ½å†è®¤ä¸ºæ’å®šäº†ã€‚æ‰€ä»¥è¿™å¯èƒ½æ˜¯ä¸€ä¸ªæ€ç»´å®šåŠ¿çš„å‘ã€‚</li></ol></li><li><a href="https://mp.weixin.qq.com/s/Z0K06ziGHhbbhVNLpTv2cg">openFOAMæ¡ˆä¾‹ï¼šå¯å‹ç¼©æµä½“æ¨¡æ‹Ÿ</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>CFD</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Southwest monsoon | è¥¿å—å­£é¢¨</title>
    <link href="/2024/11/14/southwest-monsoon/"/>
    <url>/2024/11/14/southwest-monsoon/</url>
    
    <content type="html"><![CDATA[<h1 id="è¥¿å—å­£é¢¨">è¥¿å—å­£é¢¨</h1><p>äºæ´²å—éƒ¨çš„å­£é¢¨ï¼Œä¸»è¦æ˜¯ç”±ä¿¡é¢¨å¸¶çš„å­£ç¯€ç§»å‹•è€Œå¼•èµ·çš„ï¼Œä½†ä¹Ÿæœ‰<strong>æµ·é™¸ç†±åŠ›å·®ç•°çš„å½±éŸ¿</strong>ï¼Œä»¥å°åº¦å­£é¢¨ç‚ºä¾‹ï¼Œå†¬å­£ä¿¡é¢¨å¸¶å—ç§»ï¼Œèµ¤é“ä½å£“ç§»åˆ°å—åŠçƒï¼Œäºæ´²å¤§é™¸å†·é«˜å£“å¼·å¤§ï¼Œé«˜å£“å—éƒ¨çš„æ±åŒ—é¢¨å°±æˆç‚ºäºæ´²å—éƒ¨çš„å†¬å­£é¢¨ã€‚å¤å­£ä¿¡é¢¨å¸¶åŒ—ç§»ï¼Œèµ¤é“ä½å£“ç§»åˆ°åŒ—åŠçƒï¼Œå†åŠ ä¸Šå¤§é™¸ç†±åŠ›å› å­çš„ä½œç”¨ï¼Œä½å£“ä¸­å¿ƒå‡ºç¾åœ¨å°åº¦åŠå³¶ã€‚è€Œæ­¤æ™‚æ­£æ˜¯å—åŠçƒçš„å†¬å­£ï¼Œæ¾³å¤§åˆ©äºæ˜¯ä¸€å€‹ä½æ¸©é«˜å£“å€ï¼Œæ°£å£“æ¢¯åº¦ç”±å—å‘åŒ—ï¼Œå—ä¾†æ°£æµè·¨è¶Šèµ¤é“å¾Œï¼Œå—åŒ—åŠçƒåœ°è½‰åå‘åŠ›çš„ä½œç”¨ï¼Œå½¢æˆè¥¿å—é¢¨ï¼Œé€™å°±æ˜¯å—äºçš„å¤å­£é¢¨ã€‚</p><p>åœ¨å­£é¢¨çš„å½±éŸ¿ä¸‹ï¼Œå—äºä¹Ÿæ˜¯å†¬å¹¹å¤æ¿•ï¼Œä½†æ˜¯å®ƒå’Œ<strong>æ±äºå­£é¢¨</strong>æœ‰ä¸€å€‹æ˜é¡¯å·®åˆ¥ï¼Œå³<strong>å—äºå¤å­£é¢¨</strong>æ¯”å†¬å­£é¢¨å¼·ã€‚é€™æ˜¯å› ç‚ºå†¬å­£äºæ´²å—éƒ¨é é›¢è’™å¤-è¥¿ä¼¯åˆ©äºé«˜å£“ä¸­å¿ƒï¼Œä¸¦æœ‰è¥¿è—é«˜åŸçš„é˜»æ“‹ï¼Œå†åŠ ä¸Šå°åº¦åŠå³¶é¢ç©è¼ƒå°ï¼Œç·¯åº¦è¼ƒä½ï¼Œæµ·é™¸ä¹‹é–“çš„æ°£å£“æ¢¯åº¦è¼ƒå¼±ï¼Œå› æ­¤å†¬å­£é¢¨ä¸å¼·ã€‚ç›¸åï¼Œå¤å­£å°åº¦åŠå³¶æ°£æ¸©ç‰¹åˆ¥é«˜ï¼Œæ˜¯ç†±ä½å£“ä¸­å¿ƒæ‰€åœ¨ï¼Œå®ƒèˆ‡å—åŠçƒå‰¯é«˜ä¹‹é–“çš„æ°£å£“æ¢¯åº¦å¤§ï¼Œå› æ­¤å—äºçš„å¤å­£é¢¨å¼·æ–¼å†¬å­£é¢¨ã€‚</p><p><strong>è¥¿å—å­£é¢¨ï¼Œå±¬å­£é¢¨äºæ´²ä¸­çš„ä¸€å€‹å­£é¢¨</strong>ã€‚ä¸»è¦ç››è¡Œæ–¼6ï½8æœˆã€‚ç››è¡Œæ–¼å—äºã€æ±å—äºåŠéƒ¨åˆ†æ±äºä¸€å¸¶ï¼Œç‚ºé¢¨å‘è¥¿å—çš„å¤å­£å­£é¢¨ã€‚è¥¿å—å­£é¢¨ä¾†<strong>è‡ªæ–¼ä½ç©ºçš„è¶Šèµ¤é“æ°£æµ</strong>ã€‚é€™ç¨®æ°£æµåœ¨äºæ´²è¢«ç¨±ç‚ºã€Œè¥¿å—å­£é¢¨ã€ã€‚è¥¿å—å­£é¢¨çš„åˆ°ä¾†ï¼Œä»£è¡¨ç€å­£ç¯€çš„è½‰æ›ï¼Œç”±å†¬å­£æ­£å¼è½‰ç‚ºå¤å­£ã€‚</p><p>å¤å­£æ™‚ï¼Œè¥¿å—å­£é¢¨åŒ—ä¸Šç‚ºæ±äºå’Œæ±å—äºåœ‹å®¶å¸¶ä¾†è±å¯Œçš„é™æ°´ï¼Œé€ æˆè¨±å¤šåœ‹å®¶çš„ä¸»è¦æ°´è³‡æºä¾†æºç‚ºè¥¿å—å­£é¢¨ï¼Œå¦‚ é€ æˆæ±å—äºçš„è²å¾‹è³“ç¾¤å³¶åŠä¸­å—åŠå³¶çš„ç†±å¸¶å­£é¢¨æ°£å€™ï¼Œä¹Ÿå› æ­¤é€ æˆæ°´æ‚£ã€‚</p><p>ä½åœ¨å—äºçš„å°åº¦åŠå­ŸåŠ æ‹‰å› åœ°å½¢å½±éŸ¿å½¢æˆåœ°å½¢é›¨ï¼Œåœ¨å°åº¦å¾·å¹²é«˜åŸè¥¿éƒ¨å’Œå–œé¦¬æ‹‰é›…å±±å—éƒ¨é™ä¸‹è±ªå¤§é›¨ï¼Œé€ æˆå°åº¦ä¹æ‹‰æœ‹å‰ç‚ºå…¨çƒé™æ°´é‡æœ€å¤šçš„åœ°å€ä¹‹ä¸€ã€‚ æ–¼æ±äºçš„è‡ºç£ä¹Ÿå—æ­¤å­£é¢¨å°æ¯å¹´5ï½6æœˆçš„æ¢…é›¨å­£é€ æˆå½±éŸ¿ã€‚</p><ul><li>è¥¿å—å­£é¢¨çš„æºé ­æ˜¯æ±éé¦¬é”åŠ æ–¯åŠ å³¶é™„è¿‘çš„ç´¢é¦¬åˆ©äºå™´æµï¼Œç©ºé–“å°ºåº¦æ©«è·¨å°åº¦æ´‹ä¸€ç›´åˆ°å¤ªå¹³æ´‹è¥¿éƒ¨ï¼Œç¯„åœéå¸¸å¤§è€Œä¸”æŒçºŒçš„æ™‚é–“æ˜¯ä»¥æœˆä¾†è¨ˆç®—çš„ã€‚</li></ul><p><img src="https://i.imgur.com/3qu9wAZ.png" width="600" /></p><h2 id="åŒ—åŠçƒå¤å­£è¥¿å—å­£é¢¨-å»ºç«‹çš„æ™‚é–“é»">åŒ—åŠçƒå¤å­£è¥¿å—å­£é¢¨ å»ºç«‹çš„æ™‚é–“é»</h2><p>åŒ—åŠçƒå¤å­£è¥¿å—å­£é¢¨ å»ºç«‹çš„æ™‚é–“é»ï¼Œ<strong>å› ç‚ºè¥¿å—å­£é¢¨çš„å»ºç«‹ä¸ä½†ä»£è¡¨äº†å­£ç¯€çš„è½‰æ›ï¼Œç”±å†¬å¤©å‹æ…‹æ­£å¼è½‰è®Šæˆå¤å¤©å‹æ…‹</strong>ï¼Œè¥¿å—å­£é¢¨å»ºç«‹å¾Œæœƒå¤¾å¸¶å¤§é‡çš„æš–æ¿•æ°´æ°£åŒ—ä¸Šé€²å…¥äºæ´²é™¸åœ°ï¼Œå°æ–¼å°ç£çš„æ¢…é›¨é™é›¨ç‹€æ³å…·æœ‰é—œéµæ€§çš„å½±éŸ¿ã€‚æ‰€è¬‚çš„ã€Œå­£é¢¨ã€æ˜¯å› ç‚ºåœ°çƒè¡¨é¢æµ·æ´‹å’Œé™¸åœ°çš„æ¯”ç†±ä¸åŒï¼ŒåŠ ä¸Šå¤ªé™½ç›´å°„åœ°çƒè¡¨é¢çš„å€åŸŸéš¨è‘—åœ°çƒå…¬è½‰è€Œå‡ºç¾å­£ç¯€æ€§çš„å—åŒ—ç§»å‹•ï¼Œè€Œå½¢æˆå¤§ç¯„åœçš„æµ·é™¸æº«åº¦å·®ï¼Œå› æ­¤å°è‡´å¤§å°ºåº¦ç¯„åœç©ºæ°£æµå‹•çš„çµæœã€‚</p><p>è¥¿å—å­£é¢¨é”åˆ°æ­£å¼çš„ã€ŒON-SETã€æœ‰ä¸€å€‹æ¯”è¼ƒæ˜ç¢ºçš„å®šç¾©å‹æ…‹ï¼Œ<strong>å…±æœ‰3æ”¯æ°£æµå…±åŒåˆæˆè¥¿å—å­£é¢¨</strong>ã€‚æœ€ä¸»è¦çš„ä¸€æ”¯å°±æ˜¯å‰é¢æåˆ°çš„ï¼Œ</p><ul><li>é å¾æ±éçš„ç´¢é¦¬åˆ©äºå™´æµè·¨éèµ¤é“ä»¥åŠåŒ—å°åº¦æ´‹å¾Œï¼Œå†å‚³æ’­åˆ°ä¸­å—åŠå³¶ä»¥åŠå—æµ·çš„å¤§å°ºåº¦æ°£æµï¼Œ</li><li>å¦å¤–å…©æ”¯è¼ƒå°çš„æ°£æµåˆ†åˆ¥æ˜¯ä¾†è‡ªå°å°¼é™„è¿‘çš„è·¨èµ¤é“æ°£æµä»¥åŠè²å¾‹è³“æ±æ–¹é †è‘—å¤ªå¹³æ´‹é«˜å£“é‚Šç·£åŒ—ä¸Šçš„æ°£æµï¼Œ</li></ul><p><strong>ç•¶é€™3æ”¯æ°£æµåˆ°é½Šçš„æ™‚å€™ï¼Œå°±æ˜¯è¥¿å—å­£é¢¨æ­£å¼å»ºç«‹çš„æ™‚é–“é»</strong>ã€‚</p><p><img src="https://i.imgur.com/BO29vIu.png" /></p><h2 id="å—äºå¤å­£å­£é¢¨æ˜¯å¦‚ä½•å½¢æˆçš„">å—äºå¤å­£å­£é¢¨æ˜¯å¦‚ä½•å½¢æˆçš„ï¼Ÿ</h2><ul><li>ä½æ–¼<strong>å—åŠçƒçš„å—å°åº¦æ´‹å‰¯ç†±å¸¶é«˜å£“</strong>ï¼ˆã€Œé¦¬æ–¯å…‹æ—é«˜å£“ã€ï¼‰[A]éš¨è‘—å­£ç¯€å‘åŒ—ç§»è¿‘èµ¤é“ã€‚é¦¬æ–¯å…‹æ—é«˜å£“çš„ä½å±¤æ°£æµæœƒä»¥é€†æ™‚é‡æ–¹å‘æµå‡ºï¼Œçµåˆäº†ã€Œå—å°åº¦æ´‹æ±å—ä¿¡é¢¨ã€ [B]ä¹‹å¾Œï¼Œä¾¿ç©¿éèµ¤é“ï¼Œå½¢æˆã€Œéèµ¤é“æµã€[C]ã€‚</li><li>ç”±æ–¼å—äºå­£é¢¨å€çš„è¥¿é‚Šæ˜¯éæ´²å¤§é™¸ï¼Œéèµ¤é“æµå—åˆ°æ±éåœ°å½¢çš„å½±éŸ¿ï¼Œè¢«ä¾·é™åœ¨æ±éä»¥æ±ï¼Œæ–¼æ˜¯å½¢æˆæµé€Ÿæ¥µå¿«çš„ã€Œ<strong>ç´¢é¦¬åˆ©å™´æµ</strong>ã€ã€‚é€™è‚¡ç´¢é¦¬åˆ©å™´æµå› ç‚ºå—åˆ°ç§‘æ°åŠ›å½±éŸ¿ï¼Œæœƒé€²è€Œè½‰æˆè¥¿å—é¢¨ï¼Œé€™å°±æ˜¯å°åº¦åŠå³¶çš„ã€Œ<strong>è¥¿å—å­£é¢¨</strong>ã€[D]ã€‚æ­£å› ç‚ºæ­¤è™•çš„è¥¿å—å­£é¢¨ä¾†è‡ªå¼·å‹çš„ç´¢é¦¬åˆ©å™´æµï¼Œæ‰€ä»¥å—äºçš„å¤å­£å­£é¢¨ç›¸ç•¶æ—ºç››ã€‚</li><li>å°åº¦åŠå³¶çš„åŒ—æ–¹æ˜¯é«˜è³çš„é’åº·è—é«˜åŸï¼Œé«˜åŸä¸ä½†é˜»æ“‹äº†ä¾†è‡ªåŒ—é‚Šçš„å…¶ä»–å¤©æ°£ç³»çµ±ï¼Œä½¿å®ƒå€‘ç„¡æ³•å½±éŸ¿å°åº¦åŠå³¶å¤å­£çš„æ°£å€™ï¼Œä¹Ÿä½¿å¾—è¥¿å—å­£é¢¨ç„¡æ³•å¾€åŒ—å»¶ä¼¸ï¼Œåƒ…æ­¢æ–¼é«˜åŸä»¥å—ã€‚<strong>é’åº·è—é«˜åŸçš„å­˜åœ¨ï¼Œæ­£æ˜¯é€ æˆå—äºå­£é¢¨å€è¥¿å—å­£é¢¨é¢¨å‘ç©©å®šä¸å—å½±éŸ¿çš„åŸå› </strong>ã€‚</li><li>é’åº·è—é«˜åŸé«˜å±¤åœ°è¡¨çš„æº«åº¦è¼ƒé„°è¿‘åœ°å€çš„æ°£æº«é«˜å‡ºè¨±å¤šï¼Œå› è€Œåœ¨é«˜å±¤å½¢æˆã€Œ<strong>å—äºé«˜å£“</strong>ã€[E]ã€‚<strong>å—äºé«˜å£“çš„å­˜åœ¨ä»£è¡¨é«˜å±¤çš„è¼»æ•£ï¼Œæœ‰åˆ©æ–¼ç¶­æŒé«˜åŸå—é‚Šçš„ä½å±¤ä½å£“ã€‚ä½å±¤çš„ä½å£“æ§½å¸å¼•äº†å¤§ç¯„åœç”±å—å‘åŒ—çš„æ°£æµï¼Œåœ¨ç¶“ç§‘æ°åŠ›çš„ä½œç”¨è½‰æˆè¥¿å—é¢¨ï¼Œé€™å°±æ˜¯è¥¿å—å­£é¢¨å­˜åœ¨çš„åŸå› ä¹‹ä¸€</strong>ã€‚è¥¿å—å­£é¢¨å¾å—æ–¹çš„æµ·æ´‹å¸¶ä¾†å……åˆ†çš„æ°´æ±½ï¼Œé€ æˆå—äºåœ°å€å¤å­£å¤§é‡çš„é™æ°´ï¼Œä¹Ÿå°±æ˜¯é›¨å­£çš„ä¾†è‡¨ã€‚é™æ°´çš„éç¨‹æœƒé‡‹æ”¾å¤§é‡æ½›ç†±ï¼ŒåŠ ç†±é«˜å±¤å¤§æ°£ï¼Œæ›´æœ‰åŠ©æ–¼é«˜å£“çš„ç¶­ç‰¹ã€‚</li><li>å°åº¦åŠå³¶çš„é«˜å±¤å¤§æ°£å› åŒ—é‚Šå—äºé«˜å£“çš„å­˜åœ¨ï¼Œè¼»æ•£çš„åŒ—é¢¨å—ç§‘æ°åŠ›å½±éŸ¿è€Œè½‰ç‚ºæ±é¢¨ï¼Œå½¢æˆå¼·ç››çš„ç†±å¸¶æ±é¢¨å™´æµã€‚</li></ul><p><img src="https://i.imgur.com/wAkWQde.png" width="400" /></p><h2 id="æ±äºå¤å­£å­£é¢¨æ˜¯å¦‚ä½•å½¢æˆçš„">æ±äºå¤å­£å­£é¢¨æ˜¯å¦‚ä½•å½¢æˆçš„ï¼Ÿ</h2><ul><li>ä½æ–¼å—åŠçƒçš„å—å¤ªå¹³æ´‹å‰¯ç†±å¸¶é«˜å£“ï¼ˆã€Œ<strong>æ¾³å¤§åˆ©äºé«˜å£“</strong>ã€ï¼‰[O]éš¨è‘—å­£ç¯€å‘åŒ—ç§»è¿‘èµ¤é“ã€‚æ¾³å¤§åˆ©äºé«˜å£“çš„ä½å±¤æ°£æµåŒæ¨£æœƒä»¥é€†æ™‚é‡æ–¹å‘æµå‡ºï¼Œçµåˆã€Œå—å¤ªå¹³æ´‹æ±å—ä¿¡é¢¨ã€[P]ï¼Œç©¿éèµ¤é“ï¼Œå½¢æˆã€Œéèµ¤é“æµã€[Q]ï¼Œæµå‘äºæ´²å¤§é™¸çš„ä½å£“æ§½ã€‚éèµ¤é“æµå—ç§‘æ°åŠ›çš„å½±éŸ¿ï¼Œæœƒè½‰ç‚ºè¥¿å—é¢¨ï¼Œå½¢æˆæ±äºå¤å­£å­£é¢¨å€çš„è¥¿å—å­£é¢¨[R]ã€‚å› ç‚ºæ¾³å¤§åˆ©äºé«˜å£“ä¸¦æ²’æœ‰å—äºçš„é¦¬æ–¯å…‹æ—é«˜å£“é‚£éº¼å¼·ï¼ŒåŠ ä¸Šæ±äºçš„è¥¿é‚Šæ²’æœ‰é¡ä¼¼æ±éçš„åœ°å½¢ï¼Œæ‰€ä»¥æ±äºçš„éèµ¤é“æ°£æµä¸¦æ²’æœ‰å—äºçš„ç´¢é¦¬åˆ©å™´æµé‚£éº¼å¼·ï¼Œé€™ä¹Ÿæ˜¯<strong>æ±äºå¤å­£å­£é¢¨ä¸å¦‚å—äºå¤å­£å­£é¢¨å¼·ç››çš„åŸå› ä¹‹ä¸€</strong>ã€‚</li><li>ç”±æ–¼é™¸åœ°æ±é¢æœ‰å€‹è¦æ¨¡ä¸å°çš„ã€Œè¥¿å¤ªå¹³æ´‹å‰¯ç†±å¸¶é«˜å£“ã€[S]ï¼Œç”±æ–¼è¥¿å¤ªå¹³æ´‹é«˜å£“çš„å­˜åœ¨ï¼Œæ±äºå­£é¢¨å€æ±éƒ¨çš„é¢¨å‘ä¸å–®å–®åªæœ‰è¥¿å—é¢¨ï¼Œä¹Ÿå¸¸ä¼´éš¨ç”±å¤ªå¹³æ´‹é«˜å£“è¥¿å—æ–¹ä¸‹æ²ˆçš„åæ±å—é¢¨ï¼Œå› æ­¤æ±äºå­£é¢¨ä¸ä¼¼å—äºå­£é¢¨ç©©å®šã€‚</li><li>åœ¨æ±äºå¤å­£å­£é¢¨å€ï¼Œæµ·æ´‹ä½åœ¨å¤§é™¸çš„æ±é‚Šå’Œå—é‚Šï¼Œè€Œä¸”æ­¤å€åœ°å½¢å¤§ç‚ºç·©å’Œï¼Œä¸¦æ²’æœ‰é¡ä¼¼é’åº·è—é«˜åŸé€™ç¨®åœ°å½¢çš„å±éšœã€‚å› æ­¤ï¼ŒåŒ—æ–¹çš„ã€Œä¸­ç·¯åº¦æ°£åœ˜ã€[T]æœƒå—ä¸‹å½±éŸ¿å­£é¢¨å€çš„æ°£å€™ï¼Œé€ æˆè¥¿å—å­£é¢¨å’Œä¸­ç·¯åº¦æ°£åœ˜é–“å½¢æˆã€Œæ¢…é›¨é‹’å¸¶ã€[U]ï¼Œå¸¶ä¾†æ¢…é›¨ï¼Œæ‰€ä»¥æ­¤å€çš„é™é›¨æƒ…å½¢éå¸¸å¤šè®ŠåŒ–ï¼Œä¸ä¼¼å—äºå­£é¢¨å€å–®ç´”â”€â”€å°åº¦åŠå³¶ä¸¦æ²’æœ‰æ¢…é›¨é‹’çš„å­˜åœ¨ã€‚</li><li>æ±äºå­£é¢¨å€çš„é«˜å±¤ä¹Ÿå­˜åœ¨ç†±å¸¶æ±é¢¨å™´æµï¼Œä¸éç”±æ–¼æ²’æœ‰é’åº·è—é«˜åŸæŒçºŒåŠ ç†±çš„å½±éŸ¿ï¼Œé«˜å±¤çš„ç†±å¸¶æ±é¢¨å™´æµä¹Ÿæ²’æœ‰åƒå—äºåœ°å€çš„ç†±å¸¶æ±é¢¨å™´æµé‚£éº¼å¼·ã€‚</li></ul><p><img src="https://i.imgur.com/e5AarLw.png" width="400" /></p><h1 id="è¥¿å—å­£é¢¨çˆ†ç™¼"><a href="https://www.mmets.org/?p=1274">ã€Œè¥¿å—å­£é¢¨ã€çˆ†ç™¼ ?!</a></h1><p>åˆ°äº†å¤åŠå¹´ï¼Œå¤ªé™½å¼·çƒˆç…§å°„äºæ´²å¤§é™¸ï¼Œåœ°é¢æº«åº¦â€ç†±â€ï¼Œç©ºæ°£éš¨ä¹‹ä¸Šå‡ï¼Œå½¢æˆå¤§å‹çš„ä½å£“å€ï¼Œè€Œæµ·æ´‹å‰‡è¼ƒé™¸åœ°â€æ¶¼â€ï¼Œæ°£å£“è¼ƒé«˜ã€‚ç©ºæ°£å¾æµ·æ´‹(é«˜æ°£å£“)æµå‘é™¸åœ°(ä½æ°£å£“)ï¼Œé€™ç¨®æµ·é™¸ç†±åŠ›å·®ç•°å½¢æˆæ¾³é–€å¤å­£çš„ã€Œè¥¿å—å­£é¢¨ã€ã€‚</p><p>å¾ˆå¤šæ™‚å€™ï¼Œé›¨é‡å¤šä¸å¤šï¼Œå–æ±ºæ–¼â€œæ°´â€ï¼Œè€Œã€Œè¥¿å—å­£é¢¨ã€çˆ†ç™¼çš„é‡è¦æ€§å°±æ˜¯â€œæ°´æ±½çªç„¶å¢å¤šâ€ã€‚æ°£è±¡å­¸ä¸Šï¼Œå—æµ·ã€Œè¥¿å—å­£é¢¨ã€çˆ†ç™¼æ˜¯å­£ç¯€è®ŠåŒ–çš„ä¸€å€‹è½‰æŠ˜é»ï¼Œä»£è¡¨æ°´æ±½è¼¸é€å¸¶é€²å…¥å—æµ·ï¼Œæ­¤æ™‚ã€Œè¥¿å—å­£é¢¨ã€æ§åˆ¶å—æµ·åŠè¯å—ï¼Œè¯å—åœ°å€çš„é›²é‡å’Œé™é›¨éƒ½æœƒâ€æ˜é¡¯â€å¢å¤šã€‚ä¸€èˆ¬ä¾†èªªï¼Œã€Œè¥¿å—å­£é¢¨ã€åœ¨ 5 æœˆçš„ç¬¬ 4ã€5 å€™(è¨»ï¼šæ°£å€™ä¸Šï¼Œ1å€™ä»£è¡¨5æ—¥ï¼›5æœˆç¬¬1å€™ï¼Œå³5æœˆ1-5æ—¥)é€²å…¥å—æµ·åˆ°é”è¯å—æ²¿å²¸ã€‚</p><p>ã€Œè¥¿å—å­£é¢¨ã€å’Œå®ƒçš„æ°´æ±½è¼¸é€å¸¶æ˜¯ä¸€æ­¥ä¸€æ­¥å½¢æˆçš„ï¼Œæ•´å€‹è¥¿å—å­£é¢¨ç³»çµ±çš„å½¢æˆåˆ†ç‚º 3 å€‹éšæ®µï¼Œå¦‚ä¸‹ï¼š</p><ul><li>å—åŠçƒçš„æ±å—ä¿¡é¢¨è¶Šéèµ¤é“ï¼Œä½†å—åˆ°æ±éé«˜å±±åœ°å½¢é˜»æ“‹ï¼Œæ°£æµé€Ÿåº¦å¢åŠ ï¼Œé€²å…¥å°åº¦è¥¿å—é¢ã€‚é˜¿æ‹‰ä¼¯æµ·å¯èƒ½æœƒå‡ºç¾ç†±å¸¶æ°£æ—‹ã€‚</li><li>æ°£æµç¹¼çºŒå‘æ±æ¨é€²ï¼Œé€²å…¥å°åº¦æ±å—é¢ï¼Œæ­¤æ™‚å­ŸåŠ æ‹‰ç£å¾ˆå¤§æ©Ÿæœƒå‡ºç¾ç†±å¸¶æ°£æ—‹ï¼›éš¨å¾Œæ°£æµæœƒé€²ä¸€æ­¥æ¥è¿‘ä¸­å—åŠå³¶å¾Œï¼Œç·¬ç”¸ã€æ³°åœ‹ã€é¦¬ä¾†è¥¿äºç­‰é€²å…¥é›¨å­£ã€‚</li><li>éš¨ç€ç± ç½©è¯å—åŠå—æµ·çš„å‰¯ç†±å¸¶é«˜å£“é€æ¼¸â€œé€€å ´â€ï¼Œã€Œè¥¿å—å­£é¢¨ã€ä¾¿å¯é€²å…¥å—æµ·ï¼Œåˆ°é”è¯å—ï¼Œè€Œå®ƒçš„æ°´æ±½è¼¸é€å¸¶æ­£æ˜¯æ¾³é–€é™é›¨çš„ä¸»è¦æ°´æ±½ä¾†æºã€‚</li></ul><p>è·Ÿç€ä¸Šè¿°çš„ 3 æ­¥æ›²ï¼Œå¤§å®¶å°±å¯ä»¥å¤§æ¦‚çŸ¥é“ã€Œè¥¿å—å­£é¢¨ã€çˆ†ç™¼æ™‚é–“ã€‚è‹¥æ¾³é–€å—åˆ°ä½å£“æ§½å½±éŸ¿ï¼Œè€Œã€Œè¥¿å—å­£é¢¨ã€åŒæ™‚ç‚ºä½å£“æ§½é€ä¸Šæºæºä¸çµ•çš„æ°´æ±½ï¼Œæ­¤æ™‚é›¨é‡æœƒååˆ†å¯è§€ï¼Œç”šè‡³å‡ºç¾å¤§æš´é›¨ã€‚æˆ‘å€‘å¿…é ˆåšå¥½æº–å‚™ã€æ³¨æ„é˜²ç¯„ !</p><p><img src="https://i.imgur.com/zfpj5zI.png" /></p><h1 id="è¥¿å—å­£é¢¨-hko"><a href="https://www.hko.gov.hk/tc/education/climate/climate-change/00261-onset-of-southwest-monsoon-end-of-the-fog-season-and-start-of-the-rain-season.html">è¥¿å—å­£é¢¨ | HKO</a></h1><ul><li>è¥¿å—å­£å€™é¢¨<ul><li>å­£å€™é¢¨å½¢æˆçš„ä¸»å› æ˜¯å¤§ç¯„åœæµ·æ´‹èˆ‡é™¸åœ°ä¹‹é–“çš„æº«å·®ã€‚è¸å…¥å››æœˆï¼Œå¤ªé™½é€æ¼¸åŒ—ç§»ï¼ŒåŒ—åŠçƒçš„æ—¥ç…§æœƒå¢å¤šï¼Œäºæ´²å¤§é™¸ä¸Šçš„ç©ºæ°£æœƒæ¯”ç›¸é„°æµ·æ´‹ä¸Šçš„ç©ºæ°£å‡æº«è¼ƒå¿«ã€‚é™¸åœ°çš„ç©ºæ°£å› è€Œæœƒè®Šå¾—è¼ƒè¼•åŠä¸Šå‡ï¼Œæœ€çµ‚åœ¨å¤§é™¸ä¸Šå½¢æˆä½å£“ä¸­å¿ƒã€‚æµ·æ´‹ä¸Šçš„æš–æ¿•æ°£æµä¾¿æœƒå¤§è‡´æµå‘è©²ä½å£“ä¸­å¿ƒï¼Œå°è‡´è¥¿å—å­£å€™é¢¨çš„çˆ†ç™¼ã€‚åœ–ä¸€ç‚º1971è‡³2000å¹´æ©«ç€¾å³¶çš„æœˆå¹³å‡ç››è¡Œé¢¨å‘ï¼Œæ¸…æ¥šé¡¯ç¤ºæœ¬æ¸¯çš„é¢¨å‘æœƒ<strong>åœ¨äº”ã€å…­æœˆä¹‹é–“ç”±åæ±é¢¨è½‰ç‚ºè¥¿å—é¢¨</strong>ã€‚</li><li><img src="https://i.imgur.com/ispYSwO.png" alt="åœ–ä¸€ 1971- 2000å¹´æ©«ç€¾å³¶æœˆå¹³å‡ç››è¡Œé¢¨å‘" /></li></ul></li><li>éœ§å­£çš„çµ‚çµ<ul><li>é¦™æ¸¯çš„<strong>éœ§å­£ä¸€èˆ¬ç”±äºŒæœˆé–‹å§‹ç›´è‡³å››æœˆå·¦å³çµæŸ</strong>ã€‚æº«æš–æ½®æ¿•çš„æµ·æ´‹ç©ºæ°£å¹³æµæµç¶“è¿‘å²¸è¼ƒæ¶¼çš„æµ·é¢ä¸Šï¼Œæ°£æº«æœƒé€æ¼¸é™è‡³éœ²é»ï¼Œ æ°´æ±½ä¾¿å‡çµç‚ºå¾®å°æ°´é»è€Œå½¢æˆéœ§ï¼ˆä¸€èˆ¬ç¨±æ­¤ç‚ºå¹³æµéœ§ï¼‰ã€‚ç”±æ–¼æµ·æ°´è¼ƒæ¶¼ï¼Œè€Œå…¶ä¸Šçš„ç©ºæ°£è¼ƒæš–ï¼Œå¤§æ°£ç›¸å°ç©©å®šï¼Œæœ‰åŠ©å°‡æ°´æ±½é™åˆ¶æ–¼å¤§æ°£çš„æœ€ä½å±¤ã€‚éš¨ç€å­£ç¯€è®ŠåŒ–ï¼Œæµ·æ°´äº¦æ…¢æ…¢è®Šæš–ï¼Œæµ·é¢ä¸Šçš„å¤§æ°£è®Šå¾—è¼ƒä¸ç©©å®šï¼Œå®¹æ˜“ç”¢ç”Ÿå°æµæ´»å‹•ã€‚å› æ­¤ï¼Œäº”æœˆè¥¿å—å­£å€™é¢¨çš„çˆ†ç™¼é€šå¸¸äº¦æ¨™èªŒç€éœ§å­£çš„çµæŸã€‚åœ–äºŒç‚º1971è‡³2000å¹´é¦™æ¸¯å¤©æ–‡å°å¹³å‡æ¯æœˆè§€æ¸¬åˆ°æœ‰éœ§çš„æ—¥æ•¸ï¼Œå¯è¦‹äº”æœˆå‡ºç¾éœ§çš„æ—¥å­ä¸¦ä¸å¤šï¼Œå¹³å‡å°‘æ–¼0.2æ—¥ã€‚</li><li><img src="https://i.imgur.com/E39hmpo.png" alt="åœ–äºŒ 1971-2000å¹´é¦™æ¸¯å¤©æ–‡å°å¹³å‡æ¯æœˆè§€æ¸¬åˆ°æœ‰éœ§çš„æ—¥æ•¸ã€‚" /></li></ul></li><li>é›¨å­£çš„é–‹å§‹<ul><li>ç”±æ–¼è¥¿å—å­£å€™é¢¨æœƒ<strong>å¸¶ä¾†æº«æš–æ½®æ¿•çš„ç©ºæ°£ï¼ŒåŠ ä¸Šæµ·æ°´å‡æº«ï¼Œæœ‰åˆ©å°æµæ´»å‹•çš„ç™¼å±•</strong>ã€‚è‹¥ç„¶é…åˆå…¶ä»–æœ‰åˆ©çš„æ°£è±¡æ¢ä»¶ï¼Œå¦‚ä½å±¤è¼»åˆæˆ–é«˜å±¤è¼»æ•£ï¼Œè¥¿å—å­£å€™é¢¨æœ‰æ™‚å¼•è‡´å¤§é›¨ã€‚åœ–ä¸‰ç‚º1971è‡³2000å¹´é¦™æ¸¯å¤©æ–‡å°éŒ„å¾—çš„æœˆå¹³å‡é›¨é‡ï¼Œé¡¯ç¤ºäº”æœˆä»½é›¨é‡æ˜é¡¯å¢åŠ ï¼Œè·Ÿè¥¿å—å­£å€™é¢¨çˆ†ç™¼çš„æ™‚é–“ç›¸äº’å»åˆã€‚</li><li><img src="https://i.imgur.com/1Umv5Pn.png" title="fig:" alt="åœ–ä¸‰ 1971-2000å¹´é¦™æ¸¯å¤©æ–‡å°éŒ„å¾—çš„æœˆå¹³å‡é›¨é‡" /></li></ul></li></ul><h1 id="references">References</h1><ol type="1"><li><a href="https://www.hko.gov.hk/tc/education/climate/climate-change/00261-onset-of-southwest-monsoon-end-of-the-fog-season-and-start-of-the-rain-season.html">è¥¿å—å­£å€™é¢¨çš„çˆ†ç™¼:éœ§å­£çš„çµ‚çµåŠé›¨å­£çš„é–‹å§‹ | HKO</a></li><li><a href="https://blog.weatherrisk.com/index.php/13-weatherrisk/media/the-news/weather-talk/74-southwest-monsoon-is-big-weapon">è¥¿å—å­£é¢¨ï¼æ¢…é›¨é‹’é¢çš„å¼·å¤§æ­¦å™¨</a></li><li><a href="https://www.mmets.org/?p=1274">ã€Œè¥¿å—å­£é¢¨ã€çˆ†ç™¼ ?!</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>Meteorology</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Trough Line | æ§½ç·š</title>
    <link href="/2024/11/14/trough-line/"/>
    <url>/2024/11/14/trough-line/</url>
    
    <content type="html"><![CDATA[<h1 id="æ§½ç·š">æ§½ç·š</h1><p>æ§½ç·šæ˜¯ä½å£“æ§½å…§æ°£æµæ°´å¹³è¼»åˆæœ€å¼·çš„åœ°å€ã€‚é€šå¸¸åœ¨æ§½ç·šé™„è¿‘çš„å¤©æ°£è®ŠåŒ–æ¯”è¼ƒæ˜é¡¯ï¼Œé€™ç¨®ç‰¹å¾µä½¿å®ƒåœ¨å¤©æ°£é å ±ä¸­ä½”æ“šè‘—éå¸¸é‡è¦çš„ä½ç½®ã€‚æ§½ç·šè­˜åˆ¥æ–¹æ³•åŒ…æ‹¬äººå·¥è­˜åˆ¥å’Œè‡ªå‹•è­˜åˆ¥ã€‚</p><p>ä¸€èˆ¬ä¾†èªªç­‰å£“é¢ä¸Šçš„ç­‰ä½å‹¢é«˜åº¦ç·šï¼ˆä¹Ÿå°±æ˜¯å¸¸ç°¡ç¨±çš„ç­‰é«˜ç·šï¼‰æ˜¯é€™æ¨£çš„åˆ†ä½ˆçš„è©±ï¼Œé‚£å°±èªªé€™å€‹å€åŸŸå­˜åœ¨ä¸€å€‹ä½å£“æ§½ã€‚</p><p><img src="https://i.imgur.com/zOCTflV.png" width="300" /> <img src="https://i.imgur.com/77Z6L2B.png" /></p><ul><li>ç•¶ä½æ°£å£“å‘ˆå»¶é•·ç‹€ï¼Œç¨±ç‚º<strong>ä½å£“æ§½</strong>ã€‚åœ¨å¤©æ°£åœ–ä¸Šï¼Œå®ƒæœƒ<strong>ä¼´éš¨è‘—ä¸€æ¢æ§½ç·š</strong>ã€‚æ§½ç·šä¸Šçš„æ°£å£“æœƒè¼ƒå…¶å…©æ—æ°£å£“ç‚ºä½ã€‚</li></ul><p><img src="https://i.imgur.com/pQQieMF.png" /></p><h1 id="gradient-wind-balance">Gradient Wind Balance</h1><p><img src="https://i.imgur.com/ztlxJHa.png" /></p><p><img src="https://i.imgur.com/bCulgOr.png" /></p><h1 id="references">References</h1><ol type="1"><li><a href="https://www.hko.gov.hk/tc/education/weather/wind-and-pressure/00117-introduction-to-air-pressure-part-ii.html">æ°£å£“çš„åŸºæœ¬çŸ¥è­˜ï¼ˆäºŒï¼‰ | HKO</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>Meteorology</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Trough | ä½å£“æ§½</title>
    <link href="/2024/11/14/trough/"/>
    <url>/2024/11/14/trough/</url>
    
    <content type="html"><![CDATA[<h2 id="ä½å£“æ§½">ä½å£“æ§½</h2><p>ä½å£“æ§½ (Troughï¼‰æ˜¯å¾ä½å£“ä¸­å¿ƒå»¶ä¼¸å‡ºä¾†çš„ç‹¹é•·å€åŸŸï¼Œç¶“å¸¸èˆ‡é‹’ä¼´éš¨å‡ºç¾ã€‚</p><p>å—åœ°ç†ç’°å¢ƒã€å­£ç¯€è®ŠåŒ–ç­‰å› ç´ å½±éŸ¿ï¼Œ<strong>åœ°é¢æ°£å£“åˆ†ä½ˆä¸€èˆ¬ä¸¦ä¸å‡å‹»</strong>ã€‚æ°£å£“è¼ƒå››é€±ç‚ºä½çš„åœ°å€ï¼Œç¨±ç‚ºä½å£“å€ã€‚å¾<strong>ä½å£“å€å»¶ä¼¸å‡ºä¾†çš„ç‹¹é•·å€åŸŸï¼Œç¨±ç‚ºä½å£“æ§½</strong>ã€‚æœ‰é‹’æ€§çš„æ§½ï¹æ§½çš„å…©é‚Šæœ‰å†·æš–æ°£åœ˜çš„å·®ç•°ï¹ï¼Œè¦–ä¹æ§½çš„ç§»å‹•æ–¹å‘ï¼Œç¨±ç‚ºå†·é‹’ã€æš–é‹’æˆ–éœæ­¢é‹’ã€‚åœ¨è¯åŒ—åœ°å€ï¼Œå°¤å…¶åœ¨å†¬å­£ï¼Œä½å£“æ§½é€šå¸¸ä»¥å†·é‹’å½¢å¼å‡ºç¾ï¼Œç”±æ±åŒ—å‘è¥¿å—ä¼¸å±•ï¼Œè‡ªè¥¿å‘æ±ç§»å‹•ã€‚åœ¨è¯å—åœ°å€ï¼Œä½å£“æ§½é€šå¸¸ç‚ºæ±è¥¿èµ°å‘ï¼Œè‡ªåŒ—å‘å—ç§»å‹•ï¼Œæ¨å‘å—æµ·åŒ—éƒ¨ã€‚å†¬å¤©é‹’æ€§è¼ƒå¼·ï¼Œåœ¨å¤©æ°£åœ–ä¸Šå¤šä»¥å†·é‹’å½¢æ…‹å‡ºç¾ã€‚åˆ°æ˜¥å¤©åŠåˆå¤é‹’æ€§è¼ƒå¼±ï¼Œäº”ã€å…­æœˆä¾¿æ˜¯è¯å—ä½å£“æ§½çš„æ—ºå­£ã€‚é€™äº›æœˆä»½ï¼Œå¤å¤©è¥¿å—å­£å€™é¢¨æ­£å‘åŒ—é€²å…¥ä¸­åœ‹å…§é™¸ï¼Œå…¶å‰æ²¿çš„ä½ç½®å¾€å¾€å°±æ˜¯åœ¨æ§½ç·šä¸Šï¼Œ<strong>æ•…é€™æ™‚å€™çš„ä½å£“æ§½ä¹Ÿè¢«ç¨±ç‚ºå­£é¢¨æ§½ï¼ˆmonsoon troughï¼‰</strong>ã€‚</p><p>äººæœ›é«˜è™•ï¼Œæ°´å‘ä½æµã€‚ç©ºæ°£å‰‡æœæ°£å£“ä½çš„åœ°å€èµ°ã€‚ä¸åŒçš„æ°£æµåœ¨ä½å£“æ§½ä¸ŠåŒ¯èšï¼Œç©ºæ°£è¢«è¿«ä¸Šå‡ï¼Œç©ºæ°£ä¸­çš„æ°´æ±½å‡çµæˆé›²åŠé›¨ã€‚åœ¨é©ç•¶æ¢ä»¶ä¸‹æ›´å¯èƒ½æœ‰é›·æš´ç™¼å±•ã€‚</p><p>ä½å£“æ§½ä¼¸å»¶æ•¸ç™¾å…¬é‡Œï¼Œä½†æƒ¡åŠ£å¤©æ°£ä¸»è¦æ˜¯ä¾†è‡ªç•¶ä¸­é¢ç©æ•¸åå¹³æ–¹å…¬é‡Œçš„<strong>å°æµç´°èƒï¼ˆconvective cellsï¼‰</strong>ï¼Œé€™äº›ç´°èƒçš„ç”Ÿå‘½å²åªæœ‰çŸ­çŸ­æ•¸å°æ™‚ã€‚æ•…æ­¤æš´é›¨è­¦å‘Šçš„æœ‰æ•ˆæ™‚é–“é€šå¸¸ä¸æœƒå¤ªé•·ï¼Œä¸åƒç†±å¸¶æ°£æ—‹è­¦å‘Šè¨Šè™Ÿä¸€æ›æ•´å¤©ã€‚ä½†å¦‚æœä½å£“æ§½ç§»å‹•ç·©æ…¢ï¼Œå…¶ç›¤è¸çš„åœ°å€ä¾¿æœƒç¶“å¸¸å—æ–°ç™¼å±•çš„å°æµç´°èƒå½±éŸ¿ï¼Œæƒ¡åŠ£å¤©æ°£ä¾¿æŒçºŒä¸æ•£ï¼Œå¤§é›¨é€£å ´ï¼Œå³å¦‚å…­æœˆåº•ä¸ƒæœˆåˆé¦™æ¸¯ç¶“æ­·çš„æƒ…æ³ä¸€æ¨£ã€‚</p><p>éš¨è‘—å­£ç¯€è½‰æ›ï¼Œæ¯é€¢å››è‡³å…­æœˆï¼ŒåŒ—é¢(å†·)å¤§é™¸æ°£åœ˜èˆ‡å—é¢(æš–)æµ·æ´‹æ°£åœ˜ä¸æ™‚æœƒå‡ºç¾å°å³™çš„æƒ…æ³ï¼Œå¥½åƒæ‹”æ²³ä¸€æ¨£ï¼Œäº¤ç•Œçš„ä½ç½®ä¸Šç©ºæ°£åŒ¯èšä¸Šå‡ï¼Œå¤§é‡æ°´æ±½å‡çµæˆé›²å’Œé›¨ï¼Œåœ°é¢æ°£å£“ä½ï¼Œæ‰€ä»¥ç¨±ç‚ºã€Œä½å£“æ§½ã€ã€‚å¦‚æœã€Œä½å£“æ§½ã€ç§»å‹•ç·©æ…¢æˆ–ä¸€ç›´åœç•™ï¼Œå°±å¯èƒ½é€ æˆæš´é›¨ã€‚</p><p><img src="https://i.imgur.com/gNhCQU9.png" width="600" /></p><ul><li>ä½å£“æ§½åƒä¸€å€‹å³½é•·çš„å±±è°·</li></ul><figure><img src="https://i.imgur.com/rGYeYlW.png" alt="ä½å£“æ§½åƒä¸€å€‹å³½é•·çš„å±±è°·" width="600" /><figcaption>ä½å£“æ§½åƒä¸€å€‹å³½é•·çš„å±±è°·</figcaption></figure><h1 id="ä½å£“æ§½èˆ‡å†·é‹’">ä½å£“æ§½èˆ‡å†·é‹’</h1><p><strong>ä½å£“æ§½èˆ‡å†·é‹’ç›¸ä¼¼ï¼Œä½†å†·é‹’æ˜¯ç”±å†·æš–æ°£åœ˜ç›¸é‡å½¢æˆï¼Œæœ‰æ˜é¡¯çš„æº«åº¦å·®ï¼Œè€Œä½å£“æ§½å—åŒ—å…©å´çš„æº«åº¦å·®æœªå¿…æ˜é¡¯</strong>ã€‚å†·é‹’é€šå¸¸ç©©å®šå‘å—ç§»å‹•ï¼Œå› æ­¤å½±éŸ¿é¦™æ¸¯çš„æƒ¡åŠ£å¤©æ°£æ¯”è¼ƒçŸ­æš«ï¼Œä½†ä½å£“æ§½æœ‰æ™‚ç§»å‹•ç·©æ…¢ã€‚ç•¶ä½å£“æ§½å¾˜å¾Šæ–¼æŸåœ°å€æ™‚ï¼Œå¾€å¾€å¸¶ä¾†æŒçºŒé™é›¨ï¼Œé‡€æˆæ°´ç½ã€‚</p><p>æ˜¥å­£é–‹å§‹ï¼Œä¾†è‡ªé™¸åœ°çš„å†·ç©ºæ°£æ¸›å¼±ï¼Œä¾†è‡ªæµ·æ´‹çš„æº«æš–æ½®æ¿•ç©ºæ°£è®Šå¾—æ´»èºä¸¦é€²å…¥å…§é™¸ï¼Œå…©è€…ç›¸é‡å½¢æˆä½å£“æ§½ã€‚ç©ºæ°£ç”±å››å‘¨æµå…¥ä½å£“æ§½ï¼Œåœ¨ä½å£“æ§½å…§ä¸Šå‡ï¼Œç”±æ–¼ä¸Šå‡æ™‚æ°£å£“ä¸‹é™ï¼Œç©ºæ°£è†¨è„¹é™æº«ï¼Œç©ºæ°£å…§çš„æ°´æ±½å‡çµå½¢æˆæ£‰èŠ±èˆ¬çš„ç©é›²ã€‚ç•¶ç©é›²å‘ä¸Šç™¼å±•è‡³å°æµå±¤é ‚æ™‚ï¼Œç¨±ç‚ºç©é›¨é›²ã€‚</p><ul><li><strong>ç•¶ä½å£“æ§½åœ¨å…§é™¸æ™‚</strong>ï¼Œé¦™æ¸¯å¤©æ°£æº«æš–æ½®æ¿•ï¼Œå¹å’Œç·©å—è‡³è¥¿å—é¢¨ã€‚éš¨è‘—ä½å£“æ§½è¿«è¿‘ï¼Œé¢¨å‹¢è½‰ç‚ºæ¸…å‹ï¼Œé›¢å²¸åŠé«˜åœ°å¯èƒ½é”å¼·é¢¨ä»¥ä¸Šï¼Œå¤©æ–‡å°éœ€è¦ç™¼å‡ºå¼·çƒˆå­£å€™é¢¨ä¿¡è™Ÿã€‚</li><li><strong>ç•¶ä½å£“æ§½æ©«éé¦™æ¸¯æ™‚</strong>ï¼Œå¤©è‰²è½‰æš—ï¼Œé¢¨å‘ç”±å—è‡³è¥¿å—è½‰ç‚ºè¥¿åŒ—ä¸¦å‡ºç¾çŒ›çƒˆé™£é¢¨ï¼Œå¯å°‡è²¨æ«ƒç­‰å¤§å‹ç‰©ä»¶å¹å€’ã€‚æ¼æ°‘æŠŠé€™ç¨®ç¾è±¡ç¨±ç‚ºã€Œè¥¿åŒ—çŸ³æ¹–ã€æˆ–ã€Œæ‰“çŸ³æ¹–ã€ï¼Œå°æµ·é¢æ¼èˆ¹åŠå°è‰‡æ§‹æˆå±éšªã€‚ç‹‚é¢¨éå¾Œï¼Œæ°£æº«æ˜é¡¯ä¸‹é™ï¼Œä¸¦é–‹å§‹æœ‰é›¨ã€‚</li></ul><p>å‡å¦‚ä¸Šå‡æ°£æµéå¸¸æ´»èºï¼Œæš–ç©ºæ°£ä¸Šå‡è‡³å¤§æ°£é«˜å±¤æ™‚ï¼Œç”±æ–¼æ°£æº«ä½æ–¼0åº¦ï¼Œç©ºæ°£ä¸­çš„æ°´æ±½çµæˆå†°æ™¶ã€‚å†°æ™¶ç”±æ–¼é‡é‡è€Œä¸‹å¢œï¼Œä½†è¢«ä¸Šå‡æ°£æµå†æ¬¡æ¨åˆ°å¤§æ°£é«˜å±¤ï¼Œæ›´å¤šçš„æ°´æ±½å‡çµï¼Œå†°æ™¶é«”ç©å¢å¤§è®Šæˆå†°ç²’ã€‚é€™å€‹éç¨‹ä¸æ–·é‡è¦†ï¼Œç›´è‡³ä¸Šå‡æ°£æµæ¶ˆå¤±æˆ–ç„¡æ³•æ‰¿å—å†°ç²’çš„é‡é‡æ™‚ï¼Œå†°ç²’ä¾¿é™åˆ°åœ°é¢ï¼Œç¨±ç‚ºé›¹ã€‚</p><h1 id="examples">Examples</h1><h2 id="ä½å£“æ§½æœ¬å‘¨å¾ŒæœŸæ®ºåˆ°-æ–™ç‚ºæ¸¯å¸¶ä¾†ä»Šå¹´ç¬¬ä¸€å ´é›·æš´-2023-03-22"><a href="https://std.stheadline.com/realtime/article/1913756/%E5%8D%B3%E6%99%82-%E6%B8%AF%E8%81%9E-%E4%BD%8E%E5%A3%93%E6%A7%BD%E6%9C%AC%E5%91%A8%E5%BE%8C%E6%9C%9F%E6%AE%BA%E5%88%B0-%E6%96%99%E7%82%BA%E6%B8%AF%E5%B8%B6%E4%BE%86%E4%BB%8A%E5%B9%B4%E7%AC%AC%E4%B8%80%E5%A0%B4%E9%9B%B7%E6%9A%B4">ä½å£“æ§½æœ¬å‘¨å¾ŒæœŸæ®ºåˆ° æ–™ç‚ºæ¸¯å¸¶ä¾†ä»Šå¹´ç¬¬ä¸€å ´é›·æš´ 2023-03-22</a></h2><p>å¤©æ–‡å°æŒ‡ä½å£“æ§½å°‡æ–¼æœ¬å‘¨å¾ŒæœŸæ®ºåˆ°ï¼Œæ–™ç‚ºæ¸¯å¸¶ä¾†ä»Šå¹´ç¬¬ä¸€å ´é›·æš´ã€‚</p><p>è¸å…¥æ˜¥å­£ï¼Œä½å£“æ§½é–‹å§‹è®Šæ´»èºï¼Œä¸æ™‚å½±éŸ¿è¯å—åœ°å€ã€‚é™¤äº†å¸¶ä¾†é©Ÿé›¨ï¼Œæœ‰æ™‚æ›´å¯èƒ½è§¸ç™¼ç‹‚é¢¨é›·æš´ç­‰å¼·å°æµå¤©æ°£ã€‚å¤©æ–‡å°ä»Šæ—¥ï¼ˆ22æ—¥ï¼‰ç™¼è¡¨ä¸€ç¯‡é¡Œç‚ºã€Œä½å£“æ§½é è¿‘ï¼Œå¤©æ°£ä¸ç©©å®šã€çš„å¤©æ°£éš¨ç­†ï¼ŒæŒ‡æœ€æ–°é æ¸¬é¡¯ç¤ºï¼Œä½æ–¼è¯å—åŒ—éƒ¨çš„ä½å£“æ§½æœƒåœ¨æœ¬å‘¨å¾ŒæœŸç§»å‘è¯å—æ²¿å²¸ï¼Œå»£æ±åœ°å€å¤©æ°£æœƒæ¼¸è¶¨ä¸ç©©å®šï¼Œè©²ä½å£“æ§½äº¦æœ‰æ©Ÿæœƒç‚ºæœ¬æ¸¯å¸¶ä¾†ä»Šå¹´ç¬¬ä¸€å ´é›·æš´ã€‚</p><p>æ–‡ç« ä¸­æåˆ°ï¼Œå¾é å ±åœ–çœ‹åˆ°ï¼Œèˆ‡ä½å£“æ§½ç›¸é—œçš„é›¨å€æœƒåœ¨å‘¨äº”ï¼ˆ24æ—¥ï¼‰é€æ¼¸é è¿‘å»£æ±æ²¿å²¸ã€‚æŒ‰ç…§ç¾æ™‚é›»è…¦æ¨¡å¼é¡¯ç¤ºï¼Œé è¨ˆå‘¨äº”çš„é›¨å€ä¸»è¦é›†ä¸­åœ¨è¯å—å…§é™¸ã€‚ç„¶è€Œæ˜¥å­£ä½å£“æ§½çš„å‰æ²¿å¶æœ‰é¢®ç·šå½¢æˆã€‚å³ä½¿ä½å£“æ§½ä»åœ¨è¼ƒç‚ºå…§é™¸çš„ä½ç½®ï¼Œåœ¨å…¶å‰æ²¿ç™¼å±•çš„é¢®ç·šæœ‰å¯èƒ½å·²ç¶“æå‰æŠµé”æ²¿å²¸åœ°å€ã€‚å€˜è‹¥æƒ…æ³å¦‚æ­¤ï¼Œæœ¬æ¸¯å‘¨äº”ç¨å¾Œå¯èƒ½æœƒå—ç‹‚é¢¨é›·æš´å½±éŸ¿ã€‚</p><p><img src="https://i.imgur.com/a8s16YX.png" /></p><ul><li>é›»è…¦æ¨¡å¼é æ¸¬æ˜ŸæœŸäº”ï¼ˆ3æœˆ24æ—¥ï¼‰çš„å¤©æ°£åœ–ï¼Œé æ¸¬èˆ‡ <strong>ä½å£“æ§½(è—è‰²ç²—ç·š)</strong> ç›¸é—œçš„é™é›¨ä¸»è¦é›†ä¸­åœ¨å…§é™¸åœ°å€ã€‚</li><li>å¤©æ–‡å°åˆé æ–™ä½å£“æ§½æœƒåœ¨å‘¨å…­é€²ä¸€æ­¥é è¿‘æ²¿å²¸åœ°å€ï¼Œå±†æ™‚æœ¬æ¸¯å‡ºç¾ã€Œé¡¯è‘—é™é›¨ã€çš„æ¦‚ç‡ç‚ºã€Œé«˜ã€ï¼Œ<strong>å±†æ™‚è‹¥ä¾†è‡ªåŒ—æ–¹çš„å†·ç©ºæ°£è¼ƒå¼·ï¼Œä½å£“æ§½æœ‰æ©Ÿæœƒç™¼å±•ç‚ºä¸€é“å¾®å¼±å†·é‹’</strong>ã€‚å—éš¨å¾Œçš„æ±åŒ—å­£å€™é¢¨å½±éŸ¿ï¼Œæœ¬æ¸¯ä¸‹å‘¨åˆæ°£æº«ç¨ç‚ºä¸‹é™ï¼Œä»ç„¶æœ‰é›¨ã€‚</li></ul><h2 id="å­£é¢¨ä½å£“å’Œç†±å¸¶æ°£æ—‹-hko"><a href="https://www.hko.gov.hk/tc/education/weather/meteorology-basics/00491-monsoon-lows-and-tropical-cyclones.html">å­£é¢¨ä½å£“å’Œç†±å¸¶æ°£æ—‹ | HKO</a></h2><p><strong>ç•¶åœ°é¢å¤©æ°£åœ–å‡ºç¾ä¸€å€‹æ°£å£“æ•¸å€¼è¼ƒå››å‘¨ä½çš„å€åŸŸï¼Œè€Œèƒ½å¤ åˆ†æå‡ºé–‰åˆçš„ç­‰å£“ç·šï¼Œè©²å€åŸŸä¾¿èƒ½ç¨±ç‚ºä½å£“å€</strong>ã€‚ä½å£“å€å¯ä»¥æŒ‰å…¶ç‰¹å¾µå†åŠ ä»¥åˆ†é¡ï¼Œå¦‚<strong>å­£é¢¨ä½å£“</strong>ã€<strong>é‹’é¢ä½å£“</strong>ç­‰ã€‚ä»ŠæœŸä¾¿å’Œå¤§å®¶è«‡ä¸€è«‡å­£é¢¨ä½å£“ã€‚</p><p>å­£é¢¨ä½å£“åŸæœ¬æ˜¯å½¢å®¹å¤å­£å½±éŸ¿åŒ—å°åº¦æ´‹åŠå­ŸåŠ æ‹‰ç£çš„ä½å£“ç³»çµ±ï¼Œå…¶è¦†è“‹ç¯„åœä¸€èˆ¬è¼ƒå¤§ï¼Œé–‰åˆç­‰å£“ç·šçš„ç›´å¾‘å¯é” 1000 å…¬é‡Œã€‚çµæ§‹æ–¹é¢ï¼Œå­£é¢¨ä½å£“æœ€å¤§é¢¨é€Ÿçš„å€åŸŸä¸€èˆ¬ä½æ–¼å…¶å¤–åœã€‚å—å…¶ä»–ä½æ–¼é™„è¿‘çš„å¤©æ°£ç³»çµ±å½±éŸ¿ï¼Œå¤§é¢¨å€åŸŸå¯èƒ½åªé›†ä¸­åœ¨å­£é¢¨ä½å£“çš„æŸå€‹æ–¹å‘ï¼Œä¸”é¢¨é€Ÿå¯é”çƒˆé¢¨ç¨‹åº¦ã€‚è‡³æ–¼åœ¨å­£é¢¨ä½å£“ä¸­å¿ƒé™„è¿‘çš„é¢¨é€Ÿå’Œå°æµç™¼å±•ç›¸å°è¼ƒå¼±ã€‚å­£é¢¨ä½å£“é€™å€‹ç”¨èªå…¶å¾Œæ“´å±•è‡³å½¢å®¹å…¶ä»–åœ°å€(å¦‚å—æµ·ã€è¥¿åŒ—å¤ªå¹³æ´‹å’Œæ¾³æ´²)æœ‰ç›¸ä¼¼ç‰¹å¾µçš„ä½å£“ç³»çµ±ã€‚</p><p>ç•¶å­£é¢¨ä½å£“çš„ä¸­å¿ƒé–‹å§‹å‡ºç¾æŒçºŒçš„å°æµæ´»å‹•å’Œé¢¨é€Ÿä¸Šå‡çš„æƒ…æ³ï¼Œä¾¿æœ‰æ©Ÿæœƒç™¼å±•ç‚ºç†±å¸¶æ°£æ—‹ã€‚éœ€è¦ç•™æ„ï¼š<strong>ä¸¦ä¸æ˜¯æ‰€æœ‰å­£é¢¨ä½å£“éƒ½å…·å‚™ç™¼å±•ç‚ºç†±å¸¶æ°£æ—‹çš„æ¢ä»¶ï¼Œå¦‚å‘¨åœçš„æ°´æ°£ä¾›æ‡‰ä¸è¶³ï¼Œåˆæˆ–é‡ä¸Šå¼·çƒˆçš„å‚ç›´é¢¨åˆ‡è®Š(å³å¤§æ°£é«˜å±¤å’Œä½å±¤çš„é¢¨å‘æˆ–é¢¨é€Ÿå‡ºç¾æ˜é¡¯å·®ç•°)ï¼Œå­£é¢¨ä½å£“ä¾¿é›£ä»¥ç™¼å±•ç‚ºç†±å¸¶æ°£æ—‹</strong>ã€‚</p><p>åœ¨<strong>åŒ—åŠçƒçš„å¤å­£</strong>ï¼Œè¡›æ˜Ÿé›²åœ–ä¸Šæœ‰æ™‚æœƒå‡ºç¾ä¸€æ¢æ»¿ä½ˆæ·±åšé›²åœ˜ã€é€£ç¶¿æ•¸åƒå…¬é‡Œé•·çš„å¸¶ç‹€å€åŸŸï¼ˆé™„åœ–é»ƒè‰²è™›ç·šåœˆï¼‰ï¼Œæ°£è±¡å­¸ä¸Šç¨±ç‚ºã€Œ<strong>ç†±å¸¶è¼»åˆå¸¶</strong>ã€ï¼Œè€Œä½æ–¼å—æµ·è‡³å°åº¦æ´‹çš„ä¸€æ®µåˆå«åšã€Œ<strong>å­£é¢¨æ§½</strong>ã€ã€‚ç”±æ–¼å—åŒ—å…©å´åˆ†åˆ¥å¹è‘—è¥¿å—å­£é¢¨åŠæ±åŒ—ä¿¡é¢¨é€™å…©æ”¯ã€Œå°é ­é¢¨ã€ï¼ˆè¦‹åœ–è—è‰²ç®­é ­ï¼‰ï¼Œå­£é¢¨æ§½ä¸Šå®¹æ˜“çˆ†ç™¼å°æµæ´»å‹•ï¼Œä¸¦ç™¼å±•æˆä½å£“å€ï¼Œçµ±ç¨±ç‚ºå­£é¢¨ä½å£“ã€‚</p><p>é›–ç„¶å­£é¢¨ä½å£“èˆ‡æˆç†Ÿç†±å¸¶æ°£æ—‹å…©è€…éƒ½æœ‰æ—‹è½‰ç’°æµï¼Œä½†çµæ§‹ä¸Šæœ‰æ˜é¡¯å·®åˆ¥ï¼ˆé™„è¡¨ï¼‰ã€‚è‡³æ–¼å‰è€…æœƒå¦æ¼”è®Šæˆå¾Œè€…çš„å•é¡Œï¼Œå°±è¦è¦–ä¹å¤§æ°£ç’°å¢ƒï¼ˆå‚ç›´é¢¨å ´å·®ç•°ã€æ°´æ°£è¼¸é€ã€æµ·æ°´æº«åº¦ã€é«˜ç©ºè¼»æ•£ç­‰ï¼‰æ˜¯å¦é…åˆã€‚2016å¹´8æœˆ17æ—¥æ—©ä¸Šåœ¨å»£æ±è¥¿éƒ¨æ²¿å²¸æµ·åŸŸç”Ÿæˆçš„ç†±å¸¶ä½æ°£å£“ä¾¿æ˜¯ä¸€å€‹æˆåŠŸæ¼”è®Šçš„ä¾‹å­ã€‚</p><p><img src="https://i.imgur.com/w5S5PKr.png" /> <img src="https://i.imgur.com/DhvkFg1.png" width="400" /></p><h2 id="ç•¶æ±åŒ—å­£å€™é¢¨é‡ä¸Šå»£é—Šä½å£“æ§½-hko-æ˜ŸæœŸå…­-2024å¹´9æœˆ21æ—¥"><a href="https://www.hko.gov.hk/tc/%E5%A4%A9%E6%B0%A3%E9%9A%A8%E7%AD%86/108944/%E7%95%B6%E6%9D%B1%E5%8C%97%E5%AD%A3%E5%80%99%E9%A2%A8%E9%81%87%E4%B8%8A%E5%BB%A3%E9%97%8A%E4%BD%8E%E5%A3%93%E6%A7%BD">ç•¶æ±åŒ—å­£å€™é¢¨é‡ä¸Šå»£é—Šä½å£“æ§½ | HKO | æ˜ŸæœŸå…­, 2024å¹´9æœˆ21æ—¥</a></h2><p>æœ¬æ¸¯ç¶“æ­·æœ‰è¨˜éŒ„ä»¥ä¾†æœ€ç†±çš„ä¸­ç§‹ç¯€å¾Œï¼Œé€™å…©æ—¥è¿ä¾†äº†æ˜é¡¯çš„å¤©æ°£è®ŠåŒ–ã€‚</p><ul><li>å¤©æ°£åœ–é¡¯ç¤ºä¸€é“å»£é—Šä½å£“æ§½æ­£å½±éŸ¿å—æµ·åŒ—éƒ¨è‡³å°ç£ä»¥æ±æµ·åŸŸä¸€å¸¶ï¼ˆåœ–ä¸€ï¼‰ï¼Œ</li><li>è€Œä½å£“æ§½ä¸Šå‡ºç¾å¤šå€‹ä½å£“å€ã€‚</li><li>å…¶ä¸­ä¸€å€‹ä½å£“å€ä»Šæ—¥å‘è¥¿æ©«éæœ¬æ¸¯åŒ—éƒ¨ï¼ˆåœ–äºŒï¼‰ï¼Œ</li><li>ä½†å…¶ä¸­å¿ƒé¢¨åŠ›åŠå°æµè¼ƒå¼±ï¼Œä¸¦æœªé”åˆ°ç†±å¸¶æ°£æ—‹å¼·åº¦ã€‚</li></ul><p>å—èˆ‡è©²ä½å£“å€ç›¸é—œçš„é›¨å¸¶å½±éŸ¿ï¼Œå¤§ç¾ç£æ›¾çŸ­æš«å¹æ±åŒ—å¼·é¢¨ï¼Œä¸­åˆå‰å¾Œæœ¬æ¸¯äº¦æœ‰å¤§é©Ÿé›¨åŠç‹‚é¢¨é›·æš´ï¼Œå¤šè™•åœ°å€éŒ„å¾—è¶…é50æ¯«ç±³é›¨é‡ï¼Œæ¸¯å³¶éƒ¨åˆ†åœ°å€é›¨é‡è¶…é70æ¯«ç±³ï¼Œå¤©æ–‡å°äº¦å…ˆå¾Œç™¼å‡ºé»ƒè‰²åŠç´…è‰²æš´é›¨è­¦å‘Šä¿¡è™Ÿã€‚</p><p><img src="https://i.imgur.com/aKUEoYH.png" alt="åœ–ä¸€ 9æœˆ21æ—¥8æ™‚åœ°é¢å¤©æ°£åœ–é¡¯ç¤ºä¸€é“å»£é—Šä½å£“æ§½æ­£å½±éŸ¿å—æµ·åŒ—éƒ¨è‡³å°ç£ä»¥æ±æµ·åŸŸä¸€å¸¶ã€‚è€Œè¯ä¸­æœ‰ç›¸ç•¶ç·Šå¯†çš„æ°£å£“æ¢¯åº¦ã€‚" width="600" /> <img src="https://i.imgur.com/czXPlSE.png" alt="åœ–äºŒ é›·é”åœ–åƒé¡¯ç¤ºä¸€å€‹è¼ƒå¼±çš„ä½å£“å€ä»Šæ—©å‘è¥¿æ©«éæœ¬æ¸¯åŒ—éƒ¨ï¼Œå…¶ç›¸é—œé›¨å¸¶åœ¨ä¸­åˆå‰å¾Œç‚ºæœ¬æ¸¯å¸¶ä¾†å¤§é©Ÿé›¨åŠç‹‚é¢¨é›·æš´ã€‚" width="600" /> <img src="https://i.imgur.com/QDHVYSW.png" alt="åœ–ä¸‰ ä¸åŒé›»è…¦æ¨¡å¼é æ¸¬9æœˆ23æ—¥ä¸‹åˆ8æ™‚çš„åœ°é¢å¤©æ°£åœ–ã€‚" width="600" /></p><h1 id="references">References</h1><ol type="1"><li><a href="https://www.metwarn.com/news/posts/2021/02/%E8%A5%BF%E9%A2%A8%E6%A7%BD%E4%B8%8D%E6%98%AF%E5%A4%A9%E6%B0%A3%E5%A0%B1%E5%91%8A%E6%8F%90%E5%88%B0%E7%9A%84%E4%BD%8E%E5%A3%93%E6%A7%BD%EF%BC%81/">è¥¿é¢¨æ§½ä¸æ˜¯å¤©æ°£å ±å‘Šæåˆ°çš„ä½å£“æ§½ï¼</a></li><li><a href="https://www.hko.gov.hk/tc/education/weather/meteorology-basics/00001-what-is-a-trough.html">ä½å£“æ§½ | HKO</a></li><li><a href="https://www.mmets.org/?p=992">ä½å£“æ§½æ˜¯ç”šéº¼?</a></li><li><a href="https://www.hko.gov.hk/tc/blog/00000142.htm">å­£é¢¨ä½å£“çŸ¥å¤šå°‘? | HKO</a></li><li><a href="https://www.weather.org.hk/news/%E4%BD%8E%E5%A3%93%E6%A7%BD%E8%88%87%E5%A4%A9%E6%B0%A3/">ä½å£“æ§½èˆ‡å¤©æ°£</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>Meteorology</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Westerly Trough | è¥¿é¢¨æ§½</title>
    <link href="/2024/11/14/westerly-trough/"/>
    <url>/2024/11/14/westerly-trough/</url>
    
    <content type="html"><![CDATA[<h1 id="è¥¿é¢¨æ§½">è¥¿é¢¨æ§½</h1><ul><li>Westerlies è¥¿é¢¨å¸¶</li><li>westerly trough è¥¿é¢¨æ§½</li><li>westerly ridge è¥¿é¢¨è„Š</li></ul><p>é¦–å…ˆæˆ‘å€‘è¦çŸ¥é“ï¼Œåœ°çƒä¸Šçš„ç©ºæ°£ä¸¦ä¸æ˜¯éœæ­¢çš„ï¼Œè€Œæ˜¯ä¸åœåœ°æµå‹•ã€‚ç©ºæ°£æµå‹•çš„é€Ÿåº¦ä¸¦ä¸å¹³å‡ï¼Œæµå‹•æ–¹å‘äº¦æœƒéš¨è‘—æ™‚é–“åŠåœ°é»è€Œæ”¹è®Šã€‚<strong>é«˜ç©ºæ“¾å‹•æ˜¯å¤§æ°£é«˜å±¤æ°£æµæ–¹å‘å‡ºç¾é¡¯è‘—è®ŠåŒ–çš„å€åŸŸ</strong>ã€‚</p><p>ç”±æ–¼åœ°çƒè¿‘èµ¤é“åœ°å€ç©ºæ°£å—ç†±è†¨è„¹ä¸Šå‡ç¹¼è€Œæµå‘å…©æ¥µï¼ŒåŠ ä¸Šåœ°çƒè‡ªè½‰æ‰€ç”¢ç”Ÿçš„ç§‘é‡Œå¥§åˆ©åŠ›ï¼ˆCoriolis forceï¼‰ä½¿åœ¨åŒ—åŠçƒç§»å‹•çš„ç©ºæ°£å‘å³åç§»ï¼ˆåœ¨å—åŠçƒç§»å‹•çš„ç©ºæ°£å‰‡å‘å·¦åç§»ï¼‰ï¼Œä¸­ç·¯åº¦åœ°å€ä¸Šç©ºæ™®éå¹è¥¿é¢¨ï¼ˆç¨±ç‚ºè¥¿é¢¨å¸¶ï¼‰ï¼Œå³æ˜¯é«˜ç©ºçš„æ°£æµå¤§è‡´ç”±è¥¿å‘æ±æµå‹•ã€‚ - é€™äº›æ°£æµæœ‰æ™‚å½æ›²åœ°æµå‹•ï¼Œ - åœ¨åŒ—åŠçƒæ²¿æ°£æµæ–¹å‘å‘å·¦æ‹çš„åœ°æ–¹ä¾¿æ˜¯ã€Œæ§½ã€ï¼Œæˆ–ç¨±ç‚ºã€Œ<strong>è¥¿é¢¨æ§½</strong>ã€ã€‚ - ç›¸åï¼Œå‘å³æ‹çš„åœ°æ–¹ä¾¿æ˜¯ã€Œè„Šã€ï¼Œæˆ–ã€Œ<strong>è¥¿é¢¨è„Š</strong>ã€ã€‚</p><p>åœ–ä¸€é¡¯ç¤º2015å¹´11æœˆ21æ—¥ä¸Šåˆ8æ™‚ç´„é›¢åœ°é¢äº”å…¬é‡Œçš„é«˜ç©ºè§€æ¸¬æ•¸æ“šã€‚è—ç·šé¡¯ç¤ºé«˜ç©ºæµç·šï¼Œæ²¿æ°£æµæ–¹å‘å‘å·¦æ‹å½çªè½‰å‘(ç”±è—è‰²ç®­å’€è‡³é»ƒè‰²ç®­å’€)çš„åœ°æ–¹ä¾¿æ˜¯è¥¿é¢¨æ§½çš„æ§½è»¸ï¼ˆç´…è‰²è™›ç·šé¡¯ç¤ºï¼‰ã€‚è¥¿é¢¨æ§½çš„å‰æ–¹ï¼ˆé»ƒè‰²é™°å½±é¡¯ç¤ºï¼‰æ™®éå¹è¥¿å—é¢¨ï¼Œå…¶å¾Œæ–¹æ™®éå¹è¥¿åŒ—é¢¨ï¼ˆè—è‰²ç®­å’€é¡¯ç¤ºï¼‰ã€‚å¾èˆ‡åœ–ä¸€ç›¸åŒæ™‚é–“çš„å¯è¦‹å…‰åŠç´…å¤–å…‰åˆä½µè¡›æ˜Ÿé›²åœ–å¯è¦‹ï¼ˆåœ–äºŒï¼‰ï¼Œä½æ–¼è¥¿é¢¨æ§½çš„å‰æ–¹æ°´æ±½ç›¸å°è¼ƒå¤šï¼Œé›²åœ˜è¼ƒç‚ºåšå¯¦ï¼Œè€Œæ§½å¾Œæ–¹çš„é›²å±¤å‰‡ç›¸å°ç¨€è–„ã€‚ä¸€èˆ¬è€Œè¨€ï¼Œè¥¿é¢¨æ§½çš„å‰æ–¹æœ‰åˆ©ä½å±¤ç©ºæ°£å¾€ä¸Šå‡ï¼Œè©²å€çš„å¤§æ°£ç›¸å°ä¸ç©©å®šï¼Œè¼ƒæ˜“ç”¢ç”Ÿé›²å’Œé›¨ï¼Œç”šè‡³æ˜¯é›·æš´ï¼Œè€Œæ§½çš„å¾Œæ–¹ç©ºæ°£ç”±é«˜ç©ºå¾€ä¸‹æ²‰ï¼Œå¤§æ°£ç›¸å°ç©©å®šï¼Œæœ‰åˆ©å‡ºç¾æ™´æœ—çš„å¤©æ°£ã€‚</p><figure><img src="https://i.imgur.com/U6AMW53.png" alt="åœ–ä¸€ 2015å¹´11æœˆ21æ—¥ä¸Šåˆ8æ™‚åœ¨500ç™¾å¸•çš„é«˜ç©ºè§€æ¸¬æ•¸æ“š" width="400" /><figcaption>åœ–ä¸€ 2015å¹´11æœˆ21æ—¥ä¸Šåˆ8æ™‚åœ¨500ç™¾å¸•çš„é«˜ç©ºè§€æ¸¬æ•¸æ“š</figcaption></figure><p>å—åˆ°ä¸åŒå¤§å°çš„å¤©æ°£ç³»çµ±å½±éŸ¿ï¼Œå¤§æ°£çš„æµå‹•å¯ä»¥éå¸¸è¤‡é›œï¼Œé«˜ç©ºæ“¾å‹•æœ‰æ™‚äº¦æœƒç™¼ç”Ÿåœ¨åœ°çƒè¼ƒä½ç·¯åº¦ä¸Šç©ºçš„åæ±æ°£æµä¸­ï¼ˆç‰¹åˆ¥åœ¨å¤å­£ï¼‰ã€‚ä¸€èˆ¬ä¾†èªªï¼Œé«˜ç©ºæ“¾å‹•ä»£è¡¨é™„è¿‘æœ‰æ©Ÿæœƒå‡ºç¾ä¸ç©©å®šçš„å¤©æ°£ï¼Œæ‰€ä»¥åˆ†æé«˜ç©ºæ“¾å‹•åŠä¼°è¨ˆå…¶å‹•å‘å°é æ¸¬å¤©æ°£å°¤ç‚ºé‡è¦ã€‚</p><figure><img src="https://i.imgur.com/udPgc1w.png" alt="åœ–äºŒ è·Ÿåœ–ä¸€ç›¸åŒæ™‚é–“çš„å¯è¦‹å…‰åŠç´…å¤–å…‰åˆä½µè¡›æ˜Ÿé›²åœ–" width="400" /><figcaption>åœ–äºŒ è·Ÿåœ–ä¸€ç›¸åŒæ™‚é–“çš„å¯è¦‹å…‰åŠç´…å¤–å…‰åˆä½µè¡›æ˜Ÿé›²åœ–</figcaption></figure><figure><img src="https://i.imgur.com/foKhfuJ.png" alt="é«˜ç©ºæ“¾å‹•å°å¤§æ°£ç’°æµçš„å½±éŸ¿ã€‚è—è‰²æ›²ç·šä»£è¡¨è¥¿é¢¨å¸¶çš„æµç·šï¼Œå…¶å‘å—çš„å¤§å¹…æ³¢å‹•ç¨±ç‚ºè¥¿é¢¨æ§½ï¼Œè€Œç´…è‰²è™›ç·šæ¨™ç¤ºæ§½è»¸çš„ä½ç½®ã€‚æ§½è»¸å‰ï¼ˆä»¥æ±ï¼‰çš„é¢¨é€Ÿè¼ƒé«˜ï¼Œæ°£æµä¸ç©©å®šç”šè‡³æœƒå½¢æˆæ€¥æµï¼Œæœ‰åˆ©è©²å€ä¸‹æ–¹ç©ºæ°£å‘ä¸ŠæŠ¬å‡ã€‚è‡³æ–¼æ§½è»¸å¾Œï¼ˆä»¥è¥¿ï¼‰çš„å€åŸŸï¼Œä¸€èˆ¬æœƒå‡ºç¾ä¸‹æ²‰æ°£æµã€‚" /><figcaption>é«˜ç©ºæ“¾å‹•å°å¤§æ°£ç’°æµçš„å½±éŸ¿ã€‚è—è‰²æ›²ç·šä»£è¡¨è¥¿é¢¨å¸¶çš„æµç·šï¼Œå…¶å‘å—çš„å¤§å¹…æ³¢å‹•ç¨±ç‚ºè¥¿é¢¨æ§½ï¼Œè€Œç´…è‰²è™›ç·šæ¨™ç¤ºæ§½è»¸çš„ä½ç½®ã€‚æ§½è»¸å‰ï¼ˆä»¥æ±ï¼‰çš„é¢¨é€Ÿè¼ƒé«˜ï¼Œæ°£æµä¸ç©©å®šç”šè‡³æœƒå½¢æˆæ€¥æµï¼Œæœ‰åˆ©è©²å€ä¸‹æ–¹ç©ºæ°£å‘ä¸ŠæŠ¬å‡ã€‚è‡³æ–¼æ§½è»¸å¾Œï¼ˆä»¥è¥¿ï¼‰çš„å€åŸŸï¼Œä¸€èˆ¬æœƒå‡ºç¾ä¸‹æ²‰æ°£æµã€‚</figcaption></figure><h1 id="è¥¿é¢¨æ§½ä½å£“æ§½">è¥¿é¢¨æ§½/ä½å£“æ§½</h1><p>è¥¿é¢¨æ§½ä¸æ˜¯å¤©æ°£å ±å‘Šæåˆ°çš„ä½å£“æ§½ï¼å¤§æ°£ä¸­å±¤çš„è¥¿é¢¨æ§½èˆ‡å¤©æ°£å ±å‘Šç¶“å¸¸æåˆ°çš„ä½å£“æ§½ä¸åŒï¼Œè¥¿é¢¨æ§½å¿…å®šæœƒé †è‘—è¥¿é¢¨å¸¶è‡ªè¥¿å‘æ±ç§»å‹•ï¼Œåœ°é¢å‰‡æœªå¿…å‡ºç¾å…©è‚¡æ°£æµåŒ¯èšï¼Œå¯ä»¥æ˜¯å—å–®ä¸€æ°£æµå½±éŸ¿ã€‚</p><p>è¥¿é¢¨æ§½å‘æ±å—ç§»å‹•æ™‚ä»£è¡¨æ­£åœ¨å¢å¼·ï¼Œå‘æ±åŒ—ç§»å‹•æ™‚å‰‡ä»£è¡¨æ¸›å¼±ï¼Œå‘æ±ç§»å‹•ä»£è¡¨å¼·åº¦ç¶­æŒã€‚è¥¿é¢¨æ§½æ§½è»¸å·¦é‚Šæ˜¯ä¸‹æ²‰æ°£æµï¼Œä»£è¡¨å¥½å¤©å€åŸŸï¼Œè€Œè¥¿é¢¨æ§½æ§½è»¸å³é‚Šå‰‡ä»£è¡¨ä¸Šå‡æ°£æµï¼Œæœ‰åˆ©å°æµç™¼å±•ã€‚</p><p>è€Œä½å£“æ§½å‰‡ä»£è¡¨å…©è‚¡æ°£æµåŒ¯èšï¼Œå°æµä¸»è¦åœ¨å…©è‚¡æ°£æµè¼»åˆä¹‹è™•ç™¼å±•ã€‚å¦å¤–ï¼Œä½å£“æ§½å¯ä»¥å‘è¥¿ç§»å‹•ï¼Œç§»å‹•è¦å¾‹èˆ‡è¥¿é¢¨æ§½æœ‰åˆ†åˆ¥ã€‚è¥¿é¢¨æ§½æˆ–ä½å£“æ§½ä»»ä½•ä¸€å€‹å‡ºç¾å·²å¯å°è‡´å°æµç™¼å±•ï¼Œä¸éå…©è€…åŒæ™‚å‡ºç¾æ™‚å°æµç™¼å±•æœƒæ›´ç‚ºæ—ºç››ã€‚</p><h2 id="ä½å£“æ§½">ä½å£“æ§½</h2><h1 id="references">References</h1><ol type="1"><li><a href="https://www.hko.gov.hk/tc/education/weather/meteorology-basics/00478-what-is-upperair-disturbance.html">ç”šéº¼æ˜¯é«˜ç©ºæ“¾å‹•ï¼Ÿ| HKO</a></li><li><a href="https://www.hko.gov.hk/tc/education/weather/rain/00549-rainstorm-development-mechanisms.html">æ·ºè«‡é¦™æ¸¯çš„æš´é›¨ç”¢ç”Ÿæ©Ÿåˆ¶ | HKO</a></li><li><a href="https://www.metwarn.com/news/posts/2021/02/%E8%A5%BF%E9%A2%A8%E6%A7%BD%E4%B8%8D%E6%98%AF%E5%A4%A9%E6%B0%A3%E5%A0%B1%E5%91%8A%E6%8F%90%E5%88%B0%E7%9A%84%E4%BD%8E%E5%A3%93%E6%A7%BD%EF%BC%81/">è¥¿é¢¨æ§½ä¸æ˜¯å¤©æ°£å ±å‘Šæåˆ°çš„ä½å£“æ§½ï¼</a></li><li><a href="https://www.hko.gov.hk/tc/education/weather/meteorology-basics/00001-what-is-a-trough.html">ä½å£“æ§½ | HKO</a></li><li><a href="https://www.mmets.org/?p=992">ä½å£“æ§½æ˜¯ç”šéº¼?</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>Meteorology</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>WRF | MPAS Output for WRF IC/BC</title>
    <link href="/2024/11/13/WRF-MPAS-as-ICBC/"/>
    <url>/2024/11/13/WRF-MPAS-as-ICBC/</url>
    
    <content type="html"><![CDATA[<h1 id="using-mpas-output-for-wrf-initial-and-lateral-boundary-conditions">Using MPAS Output for WRF Initial and Lateral Boundary Conditions</h1><div class="note note-warning">            <p><a href="https://www2.mmm.ucar.edu/wrf/users/docs/user_guide_v4/v4.2/users_guide_chap3.html#_Using_MPAS_Output">Using MPAS Output for WRF Initial and Lateral Boundary Conditions</a></p>          </div><p><strong>copy as record</strong></p><h1 id="mpas-output-stream">MPAS output stream</h1><p><strong>Beginning with the v3.9 release of the WPS</strong>, the <code>metgrid.exe</code> program is capable of reading native, unstructured mesh output in netCDF format from the Model for Prediction Across Scales (<strong>MPAS</strong>; <a href="https://mpas-dev.github.io/" class="uri">https://mpas-dev.github.io/</a>); the metgrid.exe program can then horizontally interpolate the MPAS fields directly to any domain defined by the geogrid.exe program to produce output files that are usable by the WRF real.exe program in exatly the same way as metgrid output interpolated from intermediate files. In this way, output from MPAS may be used to provide initial and lateral boundary conditions for WRF. When running an MPAS simulation, an <strong>output stream</strong> must be set up to contain the minimum set of fields necessary to initialize a WRF simulation. <strong>The following output stream should be sufficient with the MPAS v5.x and later code</strong>.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs namelist">&lt;stream name=&quot;wrf_ic_bc&quot;<br>        type=&quot;output&quot;<br>        filename_template=&quot;MPAS.$Y-$M-$D_$h.nc&quot;<br>        output_interval=&quot;3:00:00&quot; &gt;<br><br> &lt;var name=&quot;xtime&quot;/&gt;<br> &lt;var_array name=&quot;scalars&quot;/&gt;<br> &lt;var name=&quot;pressure&quot;/&gt;<br> &lt;var name=&quot;zgrid&quot;/&gt;<br> &lt;var name=&quot;theta&quot;/&gt;<br> &lt;var name=&quot;uReconstructZonal&quot;/&gt;<br> &lt;var name=&quot;uReconstructMeridional&quot;/&gt;<br> &lt;var name=&quot;u10&quot;/&gt;<br> &lt;var name=&quot;v10&quot;/&gt;<br> &lt;var name=&quot;q2&quot;/&gt;<br> &lt;var name=&quot;t2m&quot;/&gt;<br> &lt;var name=&quot;skintemp&quot;/&gt;<br> &lt;var name=&quot;surface_pressure&quot;/&gt;<br> &lt;var name=&quot;mslp&quot;/&gt;<br> &lt;var name=&quot;tslb&quot;/&gt;<br> &lt;var name=&quot;smois&quot;/&gt;<br>&lt;/stream&gt;<br></code></pre></td></tr></table></figure><h1 id="metgrid-namelist">metgrid namelist</h1><p>After having run MPAS with a <strong>suitable output stream defined</strong>, a set of netCDF files containing fields on the native MPAS mesh will have been produced. Because these files do not contain fields describing the locations, geometry, and connectivity of the MPAS grid cells, this information must be provided to the metgrid program with a <code>â€œstaticâ€</code> file from the MPAS simulation. Therefore, it is necessary to specify MPAS netCDF files (prefixed with <code>â€˜mpas:â€™</code>) in the &amp;metgrid namelist record with both the <code>constants_name</code> and <code>fg_name</code> variables, e.g.,</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs namelist">&amp;metgrid<br> constants_name = â€˜mpas:static.ncâ€™<br> fg_name = â€˜mpas:MPASâ€™<br>/<br></code></pre></td></tr></table></figure><p>In the above example, the metgrid.exe program would first read the MPAS <code>â€˜static.ncâ€™</code> file to read mesh information and compute remapping weights from the MPAS mesh to the WRF domain defined by the geogrid.exe program, <strong>then all time periods of the MPAS files with a prefix of</strong> <code>â€˜MPASâ€™</code> <strong>(and a suffix of YYYY-MM-DD_HH.nc)</strong> would be processed. The real.exe program can then be run as usual.</p><p>Data from intermediate files created by the ungrib.exe program can be combined with MPAS data by the metgrid program. This may be useful, e.g., to use SST, sea ice, or land-surface fields from another source. An example of combining MPAS data with ERA-Interim intermediate files with soil data (with the prefix â€˜ERAI_SOILâ€™) is shown below.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs namelist">&amp;metgrid<br>  constants_name = â€˜mpas:static.ncâ€™<br>  fg_name = â€˜mpas:MPASâ€™, â€˜ERAI_SOILâ€™<br>/<br></code></pre></td></tr></table></figure><p>Because the MPAS <code>â€˜zgridâ€™</code> field does not change in time, it can be omitted from the MPAS periodic output stream; in this case, however, the â€˜zgridâ€™ field must be placed in its own netCDF file that must also define the dimension â€˜Timeâ€™ as a netCDF unlimited dimension. Then, this file (say, â€˜zgrid.ncâ€™) can be supplied to the metgrid program using the constants_name namelist variable, e.g.,</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs namelist">&amp;metgrid<br> constants_name = â€˜mpas:static.ncâ€™, â€˜mpas:zgrid.ncâ€™<br> fg_name = â€˜mpas:MPASâ€™<br>/<br></code></pre></td></tr></table></figure><p>Placing the â€˜zgridâ€™ field in its own file can save considerable space when long MPAS simulations are run, or when the output stream to be used as WRF initial and boundary conditions is written out at high temporal frequency. The python script, below, may serve as an example of how to extract the â€˜zgridâ€™ field to its own netCDF file.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> netCDF4 <span class="hljs-keyword">import</span> Dataset<br>fin = Dataset(<span class="hljs-string">&#x27;init.nc&#x27;</span>)<br>fout = Dataset(<span class="hljs-string">&#x27;zgrid.nc&#x27;</span>,<span class="hljs-string">&#x27;w&#x27;</span>,<span class="hljs-built_in">format</span>=<span class="hljs-string">&#x27;NETCDF3_64BIT&#x27;</span>)<br>nCells = fin.dimensions[<span class="hljs-string">&#x27;nCells&#x27;</span>].size<br>nVertLevelsP1 = fin.dimensions[<span class="hljs-string">&#x27;nVertLevelsP1&#x27;</span>].size<br>fout.createDimension(dimname=<span class="hljs-string">&#x27;Time&#x27;</span>,size=<span class="hljs-literal">None</span>)<br>fout.createDimension(dimname=<span class="hljs-string">&#x27;nCells&#x27;</span>,size=nCells)<br>fout.createDimension(dimname=<span class="hljs-string">&#x27;nVertLevelsP1&#x27;</span>,size=nVertLevelsP1)<br>fout.createVariable(varname=<span class="hljs-string">&#x27;zgrid&#x27;</span>,datatype=<span class="hljs-string">&#x27;f&#x27;</span>,dimensions=(<span class="hljs-string">&#x27;nCells&#x27;</span>, <span class="hljs-string">&#x27;nVertLevelsP1&#x27;</span>))<br>fout.variables[<span class="hljs-string">&#x27;zgrid&#x27;</span>][:] = fin.variables[<span class="hljs-string">&#x27;zgrid&#x27;</span>][:]<br>fout.close()<br>fin.close()<br></code></pre></td></tr></table></figure><div class="note note-warning">            <p><strong>It is worth noting that the use of native MPAS output with metgrid.exe has not been thoroughly tested for parallel (i.e., â€œdmparâ€) builds of the WPS; it is therefore recommended to run metgrid.exe in serial when processing MPAS datasets.</strong></p>          </div><p><strong>Please use 1 core (serial) to run metgrid.exe.</strong> Otherwise, the wrfout will be fail even (dmpar) of metgrid seems to be done.</p><div class="note note-danger">            <p><strong>sbatch -N 1 -n 1 run_metgrid.sh</strong></p>          </div><h1 id="for-large-mpas-meshes">For large MPAS meshes</h1><p>Also, in cases of large MPAS meshes, it may be necessary to increase the value of two constants in the metgrid code that <strong>are used to statically allocate several data structures used in the computation of remapping weights from the MPAS mesh to the WRF domain</strong>. These two constants, shown below, are located in the <code>WPS/src/metgrid/remapper.F</code> file.</p><figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs fortran"><span class="hljs-comment">! should be at least (earth circumference / minimum grid distance)</span><br><span class="hljs-keyword">integer</span>, <span class="hljs-keyword">parameter</span> :: max_queue_length    = <span class="hljs-number">2700</span><br><br><span class="hljs-comment">! should be at least (nCells/32)</span><br><span class="hljs-keyword">integer</span>, <span class="hljs-keyword">parameter</span> :: max_dictionary_size = <span class="hljs-number">82000</span>  <br></code></pre></td></tr></table></figure><p>After changing the value of these constants, <strong>metgrid must be recompiled</strong>.</p><h1 id="hands-on">Hands-on</h1><h2 id="mpas-output-nc-files">MPAS output nc files</h2><p>File name format of MPAS* and static.nc are,</p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs console">MPAS.2024-05-01_00.nc  MPAS.2024-05-01_09.nc  MPAS.2024-05-01_18.nc<br>MPAS.2024-05-01_01.nc  MPAS.2024-05-01_10.nc  MPAS.2024-05-01_19.nc<br>MPAS.2024-05-01_02.nc  MPAS.2024-05-01_11.nc  MPAS.2024-05-01_20.nc<br>MPAS.2024-05-01_03.nc  MPAS.2024-05-01_12.nc  MPAS.2024-05-01_21.nc<br>MPAS.2024-05-01_04.nc  MPAS.2024-05-01_13.nc  MPAS.2024-05-01_22.nc<br>MPAS.2024-05-01_05.nc  MPAS.2024-05-01_14.nc  MPAS.2024-05-01_23.nc<br>MPAS.2024-05-01_06.nc  MPAS.2024-05-01_15.nc  MPAS.2024-05-02_00.nc<br>MPAS.2024-05-01_07.nc  MPAS.2024-05-01_16.nc  static.nc<br>MPAS.2024-05-01_08.nc  MPAS.2024-05-01_17.nc  <br></code></pre></td></tr></table></figure><div class="note note-primary">            <p><strong>MPAS.2024-05-01_00.nc</strong></p>          </div><h2 id="wrf-metgrid">WRF metgrid</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs namelist">&amp;metgrid<br> constants_name = &#x27;mpas:static.nc&#x27;,<br> fg_name = &#x27;mpas:MPAS&#x27;,<br> io_form_metgrid = 2, <br> opt_metgrid_tbl_path = &#x27;./&#x27;<br>/<br></code></pre></td></tr></table></figure><p>Note: There is no ungrid part.</p><p>In WPS,</p><ul><li><a href="https://github.com/wrf-model/WPS/blob/335c76a111f84503e8b963abaf273ea8053645bb/metgrid/src/process_domain_module.F#L764">WPS/metgrid/src/process_domain_module.F</a></li></ul><figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs fortran"><span class="hljs-keyword">if</span> (<span class="hljs-built_in">index</span>(input_name, <span class="hljs-string">&#x27;mpas:&#x27;</span>) == <span class="hljs-number">1</span>) <span class="hljs-keyword">then</span><br>   <span class="hljs-keyword">call</span> process_mpas_fields(input_name, do_const_processing, temp_date, fg_data, got_this_field, &amp;<br>                            landmask, process_bdy_width, &amp;<br>                            u_field, v_field, &amp;<br>                            dom_dx, dom_dy, ...... )<br></code></pre></td></tr></table></figure><p>e.g. log file</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs log">Processing domain 1 of 2<br>    mpas:static.nc<br> Processing 2024-05-01_00<br>    mpas:MPAS<br> Processing 2024-05-01_03<br>    mpas:MPAS<br> Processing 2024-05-01_06<br>    mpas:MPAS<br>Processing domain 2 of 2<br>    mpas:static.nc<br> Processing 2024-05-01_00<br>    mpas:MPAS<br> Processing 2024-05-01_03<br>    mpas:MPAS<br> Processing 2024-05-01_06<br>    mpas:MPAS<br>!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!<br>!  Successful completion of metgrid.  !<br>!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!<br></code></pre></td></tr></table></figure><h2 id="wrf-realwrf">WRF real/wrf</h2><ul><li>SIZE MISMATCH: num_metgrid_levels --&gt; 56 (default of MPAS)</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs log">d01 2024-05-01_00:00:00  Yes, this special data is acceptable to use: OUTPUT FROM METGRID V4.3<br>d01 2024-05-01_00:00:00  Input data is acceptable to use: met_em.d01.2024-05-01_00:00:00.nc<br> metgrid input_wrf.F first_date_input = 2024-05-01_00:00:00<br> metgrid input_wrf.F first_date_nml = 2024-05-01_00:00:00<br>d01 2024-05-01_00:00:00  input_wrf.F: SIZE MISMATCH:  namelist num_metgrid_levels           =           34<br>d01 2024-05-01_00:00:00  input_wrf.F: SIZE MISMATCH:  input file BOTTOM-TOP_GRID_DIMENSION  =           56<br></code></pre></td></tr></table></figure><ul><li>p_top_requested &lt; grid%p_top</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs log">rsl.error.0020:25:p_top_requested &lt; grid%p_top possible from data<br>rsl.out.0016:31: p_top_requested =    1000.00000    <br>rsl.out.0016:32: allowable grid%p_top in data   =    1281.68921    <br>rsl.out.0016:35:p_top_requested &lt; grid%p_top possible from data<br><br>-------------- FATAL CALLED ---------------<br>FATAL CALLED FROM FILE:  &lt;stdin&gt;  LINE:    1219<br>p_top_requested &lt; grid%p_top possible from data<br>-------------------------------------------<br></code></pre></td></tr></table></figure><p>How? try to set <code>p_top_requested = 5000</code>. (leave homework)</p><h3 id="real.exe"><code>real.exe</code></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs log">d01 2024-05-01_06:00:00 real_em: SUCCESS COMPLETE REAL_EM INIT<br></code></pre></td></tr></table></figure><h3 id="wrf.exe"><code>wrf.exe</code></h3><ul><li>Segmentation fault - invalid memory reference</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs log">==&gt; rsl.out.0025 &lt;==<br>d01 2024-05-01_00:00:00  Input data is acceptable to use:<br> Tile Strategy is not specified. Assuming 1D-Y<br>WRF TILE   1 IS      1 IE     20 JS     84 JE    100<br>WRF NUMBER OF TILES =   1<br> Flerchinger USEd in NEW version. Iterations=          10<br> Flerchinger USEd in NEW version. Iterations=          10<br><br>==&gt; rsl.error.0028 &lt;==<br>d01 2024-05-01_00:00:00  Input data is acceptable to use:<br> Tile Strategy is not specified. Assuming 1D-Y<br>WRF TILE   1 IS     61 IE     80 JS     84 JE    100<br>WRF NUMBER OF TILES =   1<br><br>Program received signal SIGSEGV: Segmentation fault - invalid memory reference.<br><br>Backtrace for this error:<br>#0  0x1488066c7b4f in ???<br><br>==&gt; rsl.out.0000 &lt;==<br>d01 2024-05-01_00:00:00        14241  points exceeded w_critical_cfl in domain d01 at time 2024-05-01_00:00:00 hours<br>d01 2024-05-01_00:00:00 Max   W:     74     24      2 W: *******  w-cfl:     Inf  dETA:    0.01<br></code></pre></td></tr></table></figure><p>Note: Be aware of the stability (here, MPAS-480km mesh is used).</p><p>Successful,</p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs console"><span class="hljs-meta prompt_"> $ </span><span class="language-bash"><span class="hljs-built_in">ls</span> wrf*</span><br>wrfbdy_d01  wrf.exe  wrfinput_d01  wrfout_d01_2024-05-01_00:00:00  wrfrst_d01_2024-05-01_06:00:0<br><br>==&gt; rsl. &lt;==<br>Timing for Writing restart for domain        1:   14.65449 elapsed seconds<br>d01 2024-05-01_06:00:00 wrf: SUCCESS COMPLETE WRF<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>WRF</category>
      
    </categories>
    
    
    <tags>
      
      <tag>WRF</tag>
      
      <tag>WPS</tag>
      
      <tag>MPAS</tag>
      
      <tag>IC/BC</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>NWP | ECMWF | IFS | Open data</title>
    <link href="/2024/11/12/ECMWF-IFS/"/>
    <url>/2024/11/12/ECMWF-IFS/</url>
    
    <content type="html"><![CDATA[<h1 id="open-dataset">Open Dataset</h1><p>ECMWF now provides a much larger open dataset to the public, representing weather forecasts at a higher resolution and a reduction in some release times, after a <a href="https://www.ecmwf.int/en/about/media-centre/news/2022/ecmwf-makes-wide-range-data-openly-available">first set of data was made available in early 2022</a>.</p><p>The changes can be summarised as follows:</p><ul><li>Medium-range data of the <strong>Integrated Forecasting System (IFS)</strong> are provided at a resolution of <strong>0.25 x 0.25 degrees (28 x 28 km)</strong>, compared to 0.4 x 0.4 degrees before, and some additional parameters will be added.</li><li>Medium-range data of the latest beta version of the <strong>Artificial Intelligence/Integrated Forecasting System (AIFS)</strong> are also available at a <strong>resolution of 0.25 x 0.25 degrees</strong>.</li><li>ECMWFâ€™s contribution to the sub-seasonal to seasonal (S2S) dataset, which is part of a global scheme, is now available with a 48-hour delay rather than the previous three-week delay.</li><li>All parameters of the EUâ€™s Copernicus Atmosphere Monitoring Service (CAMS) that used to a have a six-day embargo are now available in real time.</li></ul><p>An <a href="https://www.ecmwf.int/en/forecasts/datasets/open-data">overview of open data</a> is given on the ECMWF website.</p><p>æ­æ´²ä¸­æœŸå¤©æ°£é å ±ä¸­å¿ƒ (ECMWF) çš„ IFS æ¨¡å¼ç¾åœ¨å¯ä»¥ä½œç‚º 0.25 åº¦è§£æåº¦çš„é–‹æ”¾è³‡æ–™å–å¾—ã€‚å¾ 2024 å¹´ 2 æœˆ 1 æ—¥ é–‹å§‹ï¼ŒIFS é–‹æ”¾è³‡æ–™åˆ†ä½ˆçš„è§£æåº¦å¾ 0.4 åº¦æé«˜åˆ° 0.25 åº¦ã€‚é€™é …æ”¹é€²é¡¯è‘—æé«˜äº†æ•¸æ“šç²¾åº¦ï¼Œå°¤å…¶æ˜¯åœ¨æ²¿æµ·åœ°å€å’Œå±±å€ã€‚æ”¹é€²å¾Œçš„åˆ†è¾¨ç‡å—åˆ°äº†å»£æ³›æ­¡è¿ï¼Œå› ç‚ºä¹‹å‰çš„ 0.4 åº¦åˆ†è¾¨ç‡å°æ–¼è¨±å¤šæ‡‰ç”¨ä¾†èªªå¤ªç²—ç³™ã€‚</p><p>è³‡æ–™ä¸‹è¼‰é€£çµï¼š <div class="note note-warning">            <p><a href="https://data.ecmwf.int/forecasts/" class="uri">https://data.ecmwf.int/forecasts/</a></p>          </div></p><p>è¦æ ¼å¦‚ä¸‹ï¼š</p><ul><li>è§£æåº¦å¾ 0.4Â° æå‡è‡³ <strong>0.25Â°</strong></li><li>åœ°è¡¨è®Šå› ï¼š2 å…¬å°ºæ°£æº«ã€åœ°è¡¨æº«åº¦ã€é™æ°´é‡ã€æ°£å£“ã€10 å…¬å°ºé¢¨é€Ÿ</li><li>9 å€‹å¤§æ°£å£“åŠ›å±¤ä½æä¾›æº«åº¦ã€æ¿•åº¦æˆ–é¢¨é€Ÿæ•¸æ“š</li><li><strong>10 å¤©é å ±ï¼Œæ™‚é–“é–“éš” 3 å°æ™‚</strong></li><li>15 å¤©é›†åˆé å ±ï¼ŒåŒ…å« 51 å€‹é›†åˆæˆå“¡</li><li><strong>æ¯å¤©æ›´æ–° 4 æ¬¡</strong></li><li>æœ€æ–°æ¸¬è©¦ç‰ˆçš„äººå·¥æ™ºæ…§/ç¶œåˆé æ¸¬ç³»çµ±ï¼ˆ<strong>AIFS</strong>ï¼‰çš„ä¸­å°ºåº¦è³‡æ–™ä¹Ÿå¯æä¾›0.25 x 0.25åº¦çš„è§£æåº¦</li><li>æ­æ´²ä¸­æœŸå¤©æ°£é å ±ä¸­å¿ƒï¼ˆECMWFï¼‰å°æ¬¡å­£ç¯€åˆ°å­£ç¯€å°ºåº¦ï¼ˆ<strong>S2S</strong>ï¼‰è³‡æ–™é›†çš„è²¢ç»ï¼Œä½œç‚ºå…¨çƒè¨ˆåŠƒçš„ä¸€éƒ¨åˆ†ï¼Œ<strong>ç¾åœ¨å¯ä»¥åœ¨48å°æ™‚å»¶é²å¾Œç²å–ï¼Œè€Œä¸æ˜¯ä¹‹å‰çš„ä¸‰é€±å»¶é²</strong><ul><li>æ­æ´²ä¸­æœŸå¤©æ°£é å ±ä¸­å¿ƒ(ECMWF)åœ¨ç”±ä¸–ç•Œæ°£è±¡ç ”ç©¶è¨ˆç•«(WWRP)å’Œä¸–ç•Œæ°£å€™ç ”ç©¶è¨ˆç•«(WCRP)çµ„ç¹”çš„é æ¸¬è¨ˆç•«ä¸­ï¼Œå°æ¬¡å­£ç¯€åˆ°å­£ç¯€å°ºåº¦å¤©æ°£é å ±ä¹Ÿé€²è¡Œäº†å¤§å¤§æ¸›å°‘çš„å»¶é²ã€‚ ECMWFæ˜¯æ­¤è¨ˆç•«çš„çœ¾å¤šé å ±ä¸­å¿ƒä¹‹ä¸€ã€‚æˆ‘å€‘çš„é å ±ç¾åœ¨åªæœ‰48å°æ™‚çš„å»¶é²ï¼Œè€Œä¸æ˜¯ä»¥å‰çš„ä¸‰é€±å»¶é²ã€‚è¨ˆåŠƒæ˜¯é¼“å‹µæ‰€æœ‰æ¬¡å­£ç¯€æ€§åˆ°å­£ç¯€å°ºåº¦è³‡æ–™æä¾›è€…åŒæ„æ¸›å°‘ä»–å€‘çš„è²¢ç»å»¶é²ã€‚æ›´å¤šè³‡è¨Šå¯ä»¥åœ¨æ¬¡å­£ç¯€æ€§åˆ°å­£ç¯€å°ºåº¦å­˜æª”é é¢ä¸Šæ‰¾åˆ°ï¼ˆ<a href="https://confluence.ecmwf.int/display/S2S/S2S+archive" class="uri">https://confluence.ecmwf.int/display/S2S/S2S+archive</a>ï¼‰</li></ul></li><li>æ­ç›Ÿçš„å“¥ç™½å°¼å¤§æ°£ç›£æ¸¬æœå‹™ï¼ˆCAMSï¼‰çš„æ‰€æœ‰åƒæ•¸ï¼ŒåŸæœ¬éœ€è¦å…­å¤©çš„ç¦æ­¢ç™¼å¸ƒæœŸï¼Œç¾åœ¨éƒ½å¯ä»¥å³æ™‚å–å¾—<ul><li>ECMWFæ¯å¤©æä¾›å…¨çƒå¤§æ°£çµ„æˆçš„é å ±ï¼Œä½œç‚ºå…¶CAMSç”¢å“çµ„åˆçš„ä¸€éƒ¨åˆ†ã€‚é€™äº›é å ±åŒ…æ‹¬0.4 x 0.4åº¦çš„æ‰€æœ‰æ°£è±¡è®Šæ•¸ã€‚é€™äº›é å ±çš„å£“åŠ›å±¤è³‡æ–™å’Œä¸€äº›åœ°è¡¨å ´è³‡æ–™ä»¥å‰åªèƒ½åœ¨å…­å¤©å¾Œæ‰èƒ½ç²å¾—ã€‚ç¾åœ¨å®ƒå€‘å¯ä»¥å³æ™‚ç²å–ï¼Œå°±åƒå¤§æ°£çµ„æˆç”¢å“ä¸€æ¨£ã€‚æœ‰é—œCAMSè³‡æ–™çš„æ›´å¤šè©³ç´°ä¿¡æ¯ï¼Œè«‹åƒé–±å…¨çƒå¤§æ°£çµ„æˆé å ±è³‡æ–™æ–‡ä»¶é é¢ï¼ˆ<a href="https://confluence.ecmwf.int/display/CKB/CAMS%3A+Global+atmospheric+composition+forecast+data+documentation" class="uri">https://confluence.ecmwf.int/display/CKB/CAMS%3A+Global+atmospheric+composition+forecast+data+documentation</a>ï¼‰ã€‚</li></ul></li><li>å‡ç´šå¾Œçš„è§£æåº¦å·²ç„¡ç¸«æ•´åˆåˆ° Open-Meteo å¤©æ°£ API ä¸­ã€‚ç¾åœ¨æ‚¨å¯ä»¥æ¯”è¼ƒ 18 å€‹ä¸åŒå¤©æ°£æ¨¡å‹çš„é å ±ï¼Œè©•ä¼°é å ±çš„ä¸ç¢ºå®šæ€§ä¸¦é¸æ“‡æœ€ç¬¦åˆæ‚¨éœ€æ±‚çš„æ¨¡å‹ã€‚</li><li>0.25Â° è§£æåº¦çš„ 51 å€‹é›†åˆæˆå“¡å¯ä»¥é€é Ensemble API å­˜å–ã€‚æœ‰é—œ ECMWF IFS é–‹æ”¾è³‡æ–™è¨ˆåŠƒçš„æ›´å¤šè©³ç´°ä¿¡æ¯ï¼Œè«‹åƒé–± ECMWF ç¶²ç«™ã€‚</li></ul><p>æ†‘è—‰ 0.25Â° çš„åˆ†è¾¨ç‡ï¼Œæ–°çš„ IFS é–‹æ”¾è³‡æ–™æ¨¡å‹é©ç”¨æ–¼ Google GraphCast <strong>æ©Ÿå™¨å­¸ç¿’æ¨¡å‹</strong>çš„å¯¦éš›æ“ä½œã€‚å…ˆå‰ï¼ŒGraphCast ä¾è³´æ­æ´²åœ°çƒè§€æ¸¬è¨ˆç•«çš„ <strong>ERA5 è³‡æ–™é›†ï¼Œè©²è³‡æ–™é›†å­˜åœ¨ 5 å¤©çš„å»¶é²</strong>ï¼Œä½¿å…¶ä¸é©ç”¨æ–¼å³æ™‚é å ±æ‡‰ç”¨ã€‚é–‹æ”¾è³‡æ–™ IFS 0.25Â° çš„ç™¼å¸ƒç¾åœ¨å…è¨±æ‚¨æ¯ 6 å°æ™‚åŸ·è¡Œ GraphCast ä¸¦å»ºç«‹æ©Ÿå™¨å­¸ç¿’é å ±ã€‚å”¯ä¸€éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œé«˜æ•ˆé‹è¡Œ GraphCast éœ€è¦ä¸€å€‹å¤§å‹ GPUï¼Œä½†èˆ‡è¶…ç´šé›»è…¦ç›¸æ¯”ï¼Œé€™å·²ç¶“éå¸¸åˆ’ç®—äº†ã€‚</p><ul><li>é€™äº›å°‡å¯¦ç¾æœ‰é™å€åŸŸå»ºæ¨¡å’Œæ©Ÿå™¨å­¸ç¿’åˆå§‹åŒ–ã€‚æœ‰é—œå³æ™‚é æ¸¬çš„æ–‡ä»¶å¯ä»¥åœ¨é–‹æ”¾è³‡æ–™é é¢æ‰¾åˆ°ã€‚</li><li>æœ€æ–°æ¸¬è©¦ç‰ˆ<strong>AIFS</strong>çš„ä¸­æœŸæ•¸æ“šä¹Ÿä»¥0.25 x 0.25åº¦çš„è§£æåº¦æä¾›ã€‚é€™æ˜¯ç›®å‰AIFSé‹ä½œçš„è§£æåº¦ã€‚æœ‰é—œAIFSçš„æ›´å¤šä¿¡æ¯ï¼ŒåŒ…æ‹¬è¨ªå•æ•¸æ“šçš„éˆæ¥ï¼Œè«‹åƒé–±AIFSæ©Ÿå™¨å­¸ç¿’æ•¸æ“šé é¢ï¼ˆ<a href="https://www.ecmwf.int/en/forecasts/dataset/aifs-machine-learning-data" class="uri">https://www.ecmwf.int/en/forecasts/dataset/aifs-machine-learning-data</a>ï¼‰ã€‚</li></ul><h1 id="snapshot">Snapshot</h1><p><img src="https://i.imgur.com/onPeaOO.png" width="400" /></p><ul><li><strong>---Only few days Available---</strong> !!!</li><li>File format<ul><li>The files are in GRIB edition 2 format, except for trajectories which are in BUFR edition 4 format.</li></ul></li></ul><table><thead><tr class="header"><th>Grib Code</th><th>Mars Abbreviation</th><th>Long Name</th></tr></thead><tbody><tr class="odd"><td>1025</td><td>oper</td><td>Atmospheric model</td></tr><tr class="even"><td>1035</td><td>enfo</td><td>Ensemble prediction system</td></tr><tr class="odd"><td>1045</td><td>wave</td><td>Wave model</td></tr><tr class="even"><td>1081</td><td>waef</td><td>Wave ensemble forecast</td></tr></tbody></table><p>from <a href="https://codes.ecmwf.int/grib/format/mars/stream/" class="uri">https://codes.ecmwf.int/grib/format/mars/stream/</a></p><h1 id="ecmwf-ifs-high-resolution-operational-forecasts">ECMWF IFS High-Resolution Operational Forecasts</h1><h2 id="from-rda.ucar">From rda.ucar</h2><ul><li><a href="https://rda.ucar.edu/datasets/d113001/#" class="uri">https://rda.ucar.edu/datasets/d113001/#</a></li><li>ECMWF Operational 6-hourly atmospheric surface forecast</li></ul><h1 id="download-script">Download script</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/sh</span><br><span class="hljs-comment">#################################################################</span><br><span class="hljs-comment"># https://data.ecmwf.int/forecasts/20241117/00z/ifs/0p25/oper/</span><br><span class="hljs-comment"># https://data.ecmwf.int/forecasts/20241117/00z/ifs/0p25/oper/20241117000000-114h-oper-fc.grib2</span><br><span class="hljs-comment">#################################################################</span><br><br>yyyy=<span class="hljs-string">&#x27;2024&#x27;</span><br>mm=<span class="hljs-string">&#x27;11&#x27;</span><br><span class="hljs-built_in">dd</span>=<span class="hljs-string">&#x27;17&#x27;</span><br>hh=<span class="hljs-string">&#x27;00&#x27;</span><br>yyyymm=<span class="hljs-variable">$&#123;yyyy&#125;</span><span class="hljs-variable">$&#123;mm&#125;</span><br>yyyymmddhh=<span class="hljs-variable">$&#123;yyyy&#125;</span><span class="hljs-variable">$&#123;mm&#125;</span><span class="hljs-variable">$&#123;dd&#125;</span><span class="hljs-variable">$&#123;hh&#125;</span><br><br>tmp_dir=<span class="hljs-string">&quot;<span class="hljs-variable">$&#123;yyyy&#125;</span><span class="hljs-variable">$&#123;mm&#125;</span>/<span class="hljs-variable">$&#123;yyyy&#125;</span><span class="hljs-variable">$&#123;mm&#125;</span><span class="hljs-variable">$&#123;dd&#125;</span>&quot;</span><br><span class="hljs-built_in">mkdir</span> -p <span class="hljs-variable">$&#123;tmp_dir&#125;</span><br><span class="hljs-built_in">cd</span> <span class="hljs-variable">$&#123;tmp_dir&#125;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Current <span class="hljs-variable">$&#123;tmp_dir&#125;</span>&quot;</span><br><br>limit_cpu_core=15<br>count_cpu_core=1<br><br><span class="hljs-keyword">for</span> ifsfile <span class="hljs-keyword">in</span> $(<span class="hljs-built_in">seq</span> 0 3 6); <span class="hljs-keyword">do</span> <span class="hljs-comment"># Forecast time = 12, 24, 36, 48, 60, 72, 84, 96, 108, 130, 142, 154</span><br><br>    tmp_ifs_fname=<span class="hljs-string">&quot;<span class="hljs-variable">$&#123;yyyymmddhh&#125;</span>0000-<span class="hljs-variable">$&#123;ifsfile&#125;</span>h-oper-fc.grib2&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Now, <span class="hljs-variable">$&#123;tmp_ifs_fname&#125;</span> ... &quot;</span><br>    <br>    <span class="hljs-keyword">if</span> [[ ! -f <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;tmp_ifs_fname&#125;</span>&quot;</span> ]]; <span class="hljs-keyword">then</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Downloading ... <span class="hljs-variable">$&#123;tmp_ifs_fname&#125;</span>&quot;</span><br>wget --no-check-certificate https://data.ecmwf.int/forecasts/<span class="hljs-variable">$&#123;yyyy&#125;</span><span class="hljs-variable">$&#123;mm&#125;</span><span class="hljs-variable">$&#123;dd&#125;</span>/<span class="hljs-variable">$&#123;hh&#125;</span>z/ifs/0p25/oper/<span class="hljs-variable">$&#123;tmp_ifs_fname&#125;</span><br><span class="hljs-keyword">else</span><br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;tmp_ifs_fname&#125;</span> exists ... &quot;</span><br>    <span class="hljs-keyword">fi</span><br>    <br>res=$(( <span class="hljs-variable">$&#123;count_cpu_core&#125;</span> % <span class="hljs-variable">$&#123;limit_cpu_core&#125;</span> ))<br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$&#123;res&#125;</span> == 0 ]]; <span class="hljs-keyword">then</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;please wait <span class="hljs-variable">$&#123;tmp_ifs_fname&#125;</span>, <span class="hljs-variable">$&#123;count_cpu_core&#125;</span>, <span class="hljs-variable">$&#123;res&#125;</span>.&quot;</span><br><span class="hljs-built_in">wait</span><br><span class="hljs-keyword">fi</span><br>    <br><span class="hljs-keyword">done</span><br></code></pre></td></tr></table></figure><p>read_grib2.py</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/bin/python</span><br><span class="hljs-keyword">import</span> pygrib<br><br>grib_file = <span class="hljs-string">&quot;/home/wpsze/IFS/202411/20241117/20241117000000-0h-oper-fc.grib2&quot;</span><br>grbs = pygrib.<span class="hljs-built_in">open</span>(grib_file)<br><span class="hljs-keyword">for</span> grb <span class="hljs-keyword">in</span> grbs:<br>    <span class="hljs-built_in">print</span>(grb) <span class="hljs-comment"># long list</span><br></code></pre></td></tr></table></figure><h1 id="run-as-icbc">Run as ICBC</h1><p>I recognised that the Vtable.ECMWF you have mentioned was not suitable for the IFS forecast data, due to the data form of the IFS was grib2. But the Vtable.ECMWF was for grib.</p><p><a href="https://github.com/wrf-model/WPS/blob/master/ungrib/Variable_Tables/Vtable.ECMWF" class="uri">https://github.com/wrf-model/WPS/blob/master/ungrib/Variable_Tables/Vtable.ECMWF</a></p><ul><li><a href="https://forum.mmm.ucar.edu/threads/ecmwf-open-data-0p25-grib2-vtable.16523/">ECMWF open data 0p25 grib2 Vtable?</a><ul><li>Do we have Vtable suitable for ungribbing this new dataset? <strong>https://data.ecmwf.int/forecasts/YYYYMMDD/00z/ifs/0p25/oper/</strong></li><li>I'm not sure if the existing Vtables (perhaps Vtable.ECMWF?) are suitable. If you'd like to test them out and let us know, that would be great! If they don't work, you can try contacting the input data support group to see if they are able to help. You can also use the utilities, such as g2print.exe and g1print.exe to look at the codes given in the new data type, which can help you to modify an existing Vtable. If you are able to find one that works, feel free to share it so that it may help other users who are trying to use these data.</li><li>Provided Vtable.ECMWF unfortunatelly doesn't work as it expects grib1 format. I tried to convert grib2 to grib1 with cnvgrib but it fails too. I hoped that someone already has new Vtable, but ok, it looks I will need to create new one using tools you mentioned. Thank you anyway. If I succeed I will post here working solution later.</li><li>if g2print cannot process this dataset, it implies that the ECPDS data cannot be recognized by WPS. You will have to explore this data, create Vtable for it, and I guess it may be necessary to modify codes like ungrib.F and rd_grib2.F, etc.</li></ul></li><li><a href="https://forum.mmm.ucar.edu/threads/error-while-running-ungrib-exe-with-ifs-global-data.14439/">Error while running ungrib.exe with IFS global data (not solved)</a><ul><li>I've downloaded the IFS analysis files from RDA ds113.1 dataset.</li><li><a href="https://rda.ucar.edu/datasets/d113001/dataaccess/#" class="uri">https://rda.ucar.edu/datasets/d113001/dataaccess/#</a></li></ul></li><li><a href="https://forum.mmm.ucar.edu/threads/initializing-wrf-with-global-ecmwf.11131/">Initializing WRF with Global ECMWF (not solved)</a><ul><li>It is not possible to initialize the WRF with only these data available from the ECMWF because some important variables are missing, such as more levels of temperature and soil moisture;</li></ul></li><li><a href="https://forum.ecmwf.int/t/wrf-vtable-for-ecmwf-10-days-open-data/1167/1">WRF Vtable for ECMWF 10-days open data (not solved)</a></li><li><a href="https://forum.ecmwf.int/t/vtable-required-for-ecmwf-10-days-open-data/4438/1">Vtable required for ECMWF 10-days open data (not solved)</a></li><li><a href="https://forum.mmm.ucar.edu/threads/ecmwf-open-data-0p25-enfo-grib2-vtable.19236/">ECMWF open data 0p25 enfo grib2 Vtable?</a></li><li><a href="https://forum.mmm.ucar.edu/threads/help-with-ungrib-exe-when-applied-to-ecmwf-data-at-t1279-resolution.14475/#post-37949">help with ungrib.exe when applied to ecmwf data at T1279 resolution</a></li><li><a href="https://forum.mmm.ucar.edu/threads/error-when-ungrib-exe-the-ecmwf-ifs-0p25-dataset-257.18725/">Error when ungrib.exe the ECMWF IFS 0p25 dataset #257</a><ul><li>I agree that the ECPDS data may have unique GRIB structure that WPS/ungrib cannot recognize.</li></ul></li></ul><h1 id="references">References</h1><ol type="1"><li><a href="https://www.ecmwf.int/en/about/media-centre/news/2024/ecmwf-releases-much-larger-open-dataset">ECMWF releases a much larger open dataset | 29 February 2024</a></li><li><a href="https://www.ecmwf.int/en/forecasts/datasets/open-data">Open data | ECMWF real-time forecast data</a></li><li><a href="https://mp.weixin.qq.com/s/Fgmgjk1_bJdmLWQfttuT0g">ECMWF IFS å…è´¹å¼€æ”¾é¢„æŠ¥å‡çº§åˆ° 0.25Â° åˆ†è¾¨ç‡ | 2024å¹´02æœˆ26æ—¥</a></li><li><a href="https://mp.weixin.qq.com/s/keUhCa-y7xLj6I_xNfJcCw">é‡å¤§å‡çº§ï¼æ¬§æ´²ä¸­æœŸå¤©æ°”é¢„æŠ¥ä¸­å¿ƒAIåŠ æŒä¸‹å…è´¹å¼€æ”¾äº†æ›´é«˜åˆ†è¾¨ç‡ã€æ›´å¤šå‚æ•°çš„æ°”è±¡æ•°æ®ï¼| 2024å¹´03æœˆ01æ—¥</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>NWP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>WRF</tag>
      
      <tag>WPS</tag>
      
      <tag>MPAS</tag>
      
      <tag>IC/BC</tag>
      
      <tag>ECMWF</tag>
      
      <tag>IFS</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>WRF | topo-wind</title>
    <link href="/2024/11/02/wrf-topo-wind/"/>
    <url>/2024/11/02/wrf-topo-wind/</url>
    
    <content type="html"><![CDATA[<h1 id="introduction">Introduction</h1><ul><li>The Developmental Testbed Center WRFv3.4.1+ Surface Drag Parameterization Sensitivity Test Plan Points of Contact: Hongli Jiang, Michelle Harrold and Jamie Wolff November 28, 2012</li></ul><p>It is widely acknowledged that the Weather Research and Forecasting (WRF) model has a high surface wind speed bias, especially over plains and valleys. In recent versions of WRF, two new surface drag parameterization schemes, <strong>both associated with the Yonsei University (YSU) planetary boundary layer (PBL) scheme</strong>, have been developed. The Developmental Testbed Center (DTC) will be performing testing and evaluation of three WRF model configurations with the Advanced Research WRF (ARW) core (Skamarock et al. 2008). The baseline configuration will be run with the physics suite being used in the ARW High-Resolution Window (HIRESW) forecast system being run operationally at the National Centers for Environmental Prediction (NCEP). The two comparative configurations will be testing the effects of the surface drag parameterization scheme namelist option, topo_wind, which aims to correct the high wind bias seen in WRF. One configuration will be run with <strong>topo_wind=1 (TWIND1; Jimenez and Dudhia 2011)</strong>, which is based on the concept of a momentum sink term and makes use of the standard deviation of the subgrid-scale orography as well as the Laplacian of the topographic field. The second configuration will be run with <strong>topo_wind=2 (TWIND2; Mass and Ovens 2012)</strong>, which determines the subgrid terrain variance and makes the surface drag or roughness used in the model dependent on it; it also includes additional consideration for stability and wind speed. The baseline configuration will have <strong>topo_wind=0 (turned off)</strong>. These runs will be cold start cases initialized every 36 hours and run out to 48 hours for one full year.</p><p>The Weather Research and Forecasting (WRF)model (Skamarock et al. 2008) has presented a <strong>high surface wind speed bias over land</strong> since the early versions of the model (Cheng and Steenburgh 2005). The bias still persists in more recent versions (e.g., Bernardet et al. 2005; Roux et al. 2009; Mass and Ovens 2010, 2011) and represents a limitation for the high demand of accurate surface wind estimations by different sectors such as wind-energy applications or air-quality studies.</p><ul><li>The wind speed is higher in plains and valleys,</li><li>The wind speed is lower in mountains and hills.</li></ul><p>WRFæ¨¡å¼å°é¢¨é€Ÿè®ŠåŒ–è¶¨å‹¢æ¨¡æ“¬è¼ƒå¥½ï¼Œä½†æ˜¯é¢¨é€Ÿå€¼åå·®è¼ƒå¤§ï¼Œä¸»è¦æ˜¯å› ç‚º WRF æ²’æœ‰å°æ¬¡ç¶²æ ¼åœ°å½¢é˜»åŠ›é€²è¡Œåƒæ•¸åŒ–ï¼Œè‡´ä½¿</p><div class="note note-primary">            <ul><li>å¹³åŸå’Œå±±è°·é¢¨é€Ÿåå¤§ï¼Œ</li><li>é«˜å±±å’Œä¸˜é™µé¢¨é€Ÿåå°ã€‚</li></ul>          </div><p>å¾WRFv3.4é–‹å§‹ï¼ŒWRFæä¾›äº†èˆ‡YSU PBLæ–¹æ¡ˆç›¸é—œè¯çš„TopoWindæ¨¡å¼ï¼Œä»¥æ”¹å–„åœ°å½¢å°è¿‘åœ°é¢é¢¨çš„å½±éŸ¿ã€‚ YSU PBLæ–¹æ¡ˆå…±æœ‰ä¸‰ç¨®æ–¹æ¡ˆï¼š</p><ul><li>topo_wind = 0ï¼Œåœ¨è¿‘åœ°é¢é¢¨è¨ˆç®—ä¸­ä¸åŒ…æ‹¬TopoWindæ¨¡å¼çš„é™„åŠ åœ°å½¢æ•ˆæ‡‰ï¼›</li><li>topo_wind = 1ï¼Œå°‡äºæŸµæ ¼å°ºåº¦åœ°å½¢çš„æ¨™æº–å·®ç´å…¥è¿‘åœ°é¢é¢¨è¨ˆç®—ï¼›</li><li>topo_wind = 2ï¼Œæ¡ç”¨èˆ‡topowind = 1 ç›¸åŒçš„æ–¹æ³•è¨ˆç®—è¿‘åœ°é¢é¢¨ï¼Œä½†åŒæ™‚é€éåŠ å…¥äºæ ¼é»åœ°å½¢è®ŠåŒ–åŠ å¼·äº†æ‘©æ“¦é€Ÿåº¦çš„è¨ˆç®—ã€‚</li></ul><h1 id="wrf">WRF</h1><ul><li>topo-wind=1 â†’ varsso (Jimenez 2011)</li><li>topo-wind=2 â†’ var/var2d (Mass 2012)</li></ul><p>and geog data,</p><ul><li>varsso=0.924km (0.5m)</li><li>varsso_2m=3.7km</li><li>varsso_5m=9.25km</li><li>varsso_10m=18.5km</li></ul><h1 id="jimÃ©nez-2011">JimÃ©nez 2011</h1><ul><li>JimÃ©nez, P. A., &amp; Dudhia, J. (2012). Improving the representation of resolved and unresolved topographic effects on surface wind in the WRF model. Journal of Applied Meteorology and Climatology, 51(2), 300-316.<ul><li>The proposed parameterization is based on the concept of a momentum sink term and makes use of the <strong>standard deviation of the subgrid-scale orography</strong> as well as the <strong>Laplacian of the topographic field</strong>.</li><li>u = stands for the zonal wind component <strong>at the first model level</strong></li><li>Figure 4 shows the <strong>standard deviation of the subgrid-scale orography</strong> <span class="math inline">\(\sigma_{sso}\)</span> within each grid cell (2 km). The standard deviation provides an idea of the variability and, thus, the complexity of the terrain.</li></ul></li></ul><p><img src="https://i.imgur.com/JrR5M9h.png" alt="The differentiation has been accomplished by applying the following operator to the topographic field h" width="600" /> <img src="https://i.imgur.com/3r4P6Uh.png" width="600" /> <img src="https://i.imgur.com/1lSVGvw.png" width="600" /> <img src="https://i.imgur.com/4F3m0BK.png" width="600" /></p><h1 id="mass-and-ovens-2012">Mass and Ovens 2012</h1><p>topo_wind=2 (TWIND2; Mass and Ovens 2012)</p><ul><li>Fixing WRF's High Speed Wind Bias: A New Subgrid Scale Drag Parameterization and the Role of Detailed Verification (91st American Meteorological Society Annual Meeting)<ul><li><a href="https://ams.confex.com/ams/91Annual/webprogram/Paper180011.html" class="uri">https://ams.confex.com/ams/91Annual/webprogram/Paper180011.html</a></li></ul></li><li><a href="https://www2.mmm.ucar.edu/wrf/users/workshops/WS2010/presentations/session%204/4-1_WRFworkshop2010Final.pdf" class="uri">https://www2.mmm.ucar.edu/wrf/users/workshops/WS2010/presentations/session%204/4-1_WRFworkshop2010Final.pdf</a></li></ul><h1 id="wrf-code">WRF code</h1><ul><li>WRF/dyn_em/start_em.F</li></ul><figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs fortran"><span class="hljs-comment">!</span><br><span class="hljs-comment">! paj: computes ct and ct2 for topo_wind</span><br><span class="hljs-comment">!</span><br>       grid%ctopo=<span class="hljs-number">1.</span><br>       grid%ctopo2=<span class="hljs-number">1.</span><br><span class="hljs-comment">!</span><br>       <span class="hljs-keyword">if</span> (config_flags%topo_wind.eq<span class="hljs-number">.1</span>) <span class="hljs-keyword">then</span><br>         <span class="hljs-keyword">DO</span> j = jts,<span class="hljs-built_in">min</span>(jte,jde-<span class="hljs-number">1</span>)<br>         <span class="hljs-keyword">DO</span> i = its, <span class="hljs-built_in">min</span>(ite,ide-<span class="hljs-number">1</span>)<br>            <span class="hljs-keyword">if</span>(grid%xland(i,j).lt<span class="hljs-number">.1</span><span class="hljs-number">.5</span>)grid%ctopo(i,j)=<span class="hljs-built_in">sqrt</span>(grid%var_sso(i,j))<br>            <span class="hljs-keyword">if</span> (grid%ctopo(i,j).le<span class="hljs-number">.2</span><span class="hljs-number">.718</span>) <span class="hljs-keyword">then</span><br>            grid%ctopo(i,j)=<span class="hljs-number">1.</span><br>            <span class="hljs-keyword">else</span><br>            grid%ctopo(i,j)=<span class="hljs-built_in">alog</span>(grid%ctopo(i,j))<br>            <span class="hljs-keyword">endif</span><br><span class="hljs-comment">!</span><br>            <span class="hljs-keyword">if</span> (grid%lap_hgt(i,j)<span class="hljs-keyword">.gt.</span>-<span class="hljs-number">10.</span>) <span class="hljs-keyword">then</span><br>              grid%ctopo(i,j)=grid%ctopo(i,j)<br>            <span class="hljs-keyword">else</span><br>               <span class="hljs-keyword">if</span> (grid%lap_hgt(i,j)<span class="hljs-keyword">.ge.</span>-<span class="hljs-number">20</span>) <span class="hljs-keyword">then</span><br>                 alpha=(grid%lap_hgt(i,j)+<span class="hljs-number">20.</span>)/<span class="hljs-number">10.</span><br>                 grid%ctopo(i,j)=alpha*grid%ctopo(i,j)+(<span class="hljs-number">1</span>-alpha)<br>               <span class="hljs-keyword">else</span><br>                  <span class="hljs-keyword">if</span> (grid%lap_hgt(i,j)<span class="hljs-keyword">.ge.</span>-<span class="hljs-number">30.</span>) <span class="hljs-keyword">then</span><br>                  grid%ctopo(i,j)=(grid%lap_hgt(i,j)+<span class="hljs-number">30.</span>)/<span class="hljs-number">10.</span><br>                  grid%ctopo2(i,j)=(grid%lap_hgt(i,j)+<span class="hljs-number">30.</span>)/<span class="hljs-number">10.</span><br>                  <span class="hljs-keyword">else</span><br>                  grid%ctopo(i,j)=<span class="hljs-number">0.</span><br>                  grid%ctopo2(i,j)=<span class="hljs-number">0.</span><br>                  <span class="hljs-keyword">endif</span><br>               <span class="hljs-keyword">endif</span><br>            <span class="hljs-keyword">endif</span><br>         <span class="hljs-keyword">ENDDO</span><br>         <span class="hljs-keyword">ENDDO</span><br><span class="hljs-comment">!       if topo_wind==2 (D.Ovens, C.Mass)</span><br>       <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (config_flags%topo_wind.eq<span class="hljs-number">.2</span>) <span class="hljs-keyword">then</span><br>         <span class="hljs-keyword">DO</span> j = jts,<span class="hljs-built_in">min</span>(jte,jde-<span class="hljs-number">1</span>)<br>         <span class="hljs-keyword">DO</span> i = its, <span class="hljs-built_in">min</span>(ite,ide-<span class="hljs-number">1</span>)<br>           <span class="hljs-keyword">if</span> (grid%xland(i,j).lt<span class="hljs-number">.1</span><span class="hljs-number">.5</span>) <span class="hljs-keyword">then</span><br>              vfac = <span class="hljs-built_in">amin1</span>(<span class="hljs-number">1.575</span>,(grid%var2d(i,j)*<span class="hljs-number">0.4</span>/<span class="hljs-number">200.</span>+<span class="hljs-number">1.175</span>))<br>              vfac = vfac * vfac<br>           <span class="hljs-keyword">else</span>                      <span class="hljs-comment">! over water, leave it alone</span><br>              vfac = <span class="hljs-number">1.</span><br>           <span class="hljs-keyword">endif</span><br><span class="hljs-comment">!          print *, j,i,grid%ctopo(i,j),vfac</span><br>           grid%ctopo(i,j)=grid%ctopo(i,j)*vfac<br>         <span class="hljs-keyword">ENDDO</span><br>         <span class="hljs-keyword">ENDDO</span><br>       <span class="hljs-keyword">endif</span><br></code></pre></td></tr></table></figure><ul><li>Versions of WPS prior to V3.4 did not include VAR_SSO static data. This is necessary for running the topo_wind option in WRF (also introduced in version 3.4). <a href="https://github.com/wrf-model/WRF/pull/10">link</a></li><li>Remark, <strong>ctopo2 = 1</strong> in topo_wind2.</li></ul><div class="note note-primary">            <p>u10, v10 (no modify in topo_wind=2)<br />Modify u10, v10 â‡’ Effective in topo_wind=1 only<br />In topo_wind=2, No Modify u10, v10</p>          </div><h2 id="convective-velocity-and-pbl-height">convective velocity and PBL height</h2><ul><li><a href="https://github.com/wrf-model/WRF/pull/116" class="uri">https://github.com/wrf-model/WRF/pull/116</a></li><li><strong>WRFv3.8.1 and before, don't consider convective velocity and PBL height</strong></li><li>It is found that this scheme can improve the simulated surface winds, especially at night, <strong>but it can underestimate the winds during daytime.</strong><ul><li>Lorente-Plazas, R., JimÃ©nez, P. A., Dudhia, J., &amp; MontÃ¡vez, J. P. (2016). Evaluating and Improving the Impact of the Atmospheric Stability and Orography on Surface Winds in the WRF Model. Monthly Weather Review, 144(7), 2685-2693. <a href="https://doi.org/10.1175/MWR-D-15-0449.1" class="uri">https://doi.org/10.1175/MWR-D-15-0449.1</a></li><li><a href="https://journals.ametsoc.org/view/journals/mwre/144/7/mwr-d-15-0449.1.xml" class="uri">https://journals.ametsoc.org/view/journals/mwre/144/7/mwr-d-15-0449.1.xml</a></li></ul></li><li>In the daytime,<ul><li>if higher PBLH, then consider less ctopo effect</li><li>new_topo ~ off_ctopo in daytime</li></ul></li><li>Uses convective velocity and PBL height to determine instability</li><li>Extra code is added to compute tke, hybrid PBL height and convective velocity within the YSU PBL</li></ul><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs text">TYPE: enhancement<br><br>KEYWORDS: topo_wind=1, diurnal cycle improvement, YSU PBL only<br><br>SOURCE: internal + Raquel Lorente (formerly RAL) and Pedro Jimenez (RAL)<br><br>PURPOSE: To improve diurnal behavior of surface wind when topo_wind=1 is<br>activated. This replaces the topo_wind=1 and is not a new option.<br><br>DESCRIPTION OF CHANGES:<br><br>Follows paper Lorente-Plazas et al. (2016, MWR) by decreasing effects of<br>topo_wind=1 option when unstable boundary-layer conditions prevail. Uses<br>convective velocity and PBL height to determine instability. PBL height uses a<br>hybrid tke-theta method copied from the MYNN PBL, but for YSU tke is computed<br>diagnostically.<br>Extra code is added to compute tke, hybrid PBL height and convective velocity<br>within the YSU PBL, so this is the only module affected.<br><br>LIST OF MODIFIED FILES :<br><br>M phys/module_bl_ysu.F<br></code></pre></td></tr></table></figure><h2 id="module_bl_ysu.f">module_bl_ysu.F</h2><ul><li><p><a href="https://github.com/wrf-model/WRF/blob/v4.5/phys/module_bl_ysu.F" class="uri">https://github.com/wrf-model/WRF/blob/v4.5/phys/module_bl_ysu.F</a></p></li><li><p>! paj: ctopo=1 if topo_wind=0 (default)</p></li></ul><figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs fortran"><span class="hljs-keyword">real</span>(<span class="hljs-keyword">kind</span>=kind_phys),     <span class="hljs-keyword">dimension</span>( its: )                               , &amp;<br>          <span class="hljs-keyword">optional</span>                                                        , &amp;<br>          <span class="hljs-keyword">intent</span>(<span class="hljs-keyword">in</span>   )   ::                                         ctopo, &amp;<br>                                                                    ctopo2<br></code></pre></td></tr></table></figure><figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs fortran"><span class="hljs-comment">!--- end of paj tke</span><br><span class="hljs-comment">! compute vconv</span><br><span class="hljs-comment">!      Use Beljaars over land</span><br>        <span class="hljs-keyword">if</span> (xland(i).lt<span class="hljs-number">.1</span><span class="hljs-number">.5</span>) <span class="hljs-keyword">then</span><br>        fluxc = <span class="hljs-built_in">max</span>(sflux(i),<span class="hljs-number">0.0</span>)<br>        vconvc=<span class="hljs-number">1.</span><br>        VCONV = vconvc*(g/thvx(i,<span class="hljs-number">1</span>)*pblh_ysu(i)*fluxc)**<span class="hljs-number">.33</span><br>        <span class="hljs-keyword">else</span><br><span class="hljs-comment">! for water there is no topo effect so vconv not needed</span><br>        VCONV = <span class="hljs-number">0.</span><br>        <span class="hljs-keyword">endif</span><br>        vconvfx(i) = vconv<br><span class="hljs-comment">!raquel</span><br><span class="hljs-comment">!ctopo stability correction</span><br>      fric(i,<span class="hljs-number">1</span>)=ust(i)**<span class="hljs-number">2</span>/wspd1(i)*rhox(i)*g/del(i,<span class="hljs-number">1</span>)*dt2         &amp;<br>        *(wspd1(i)/wspd(i))**<span class="hljs-number">2</span><br>      <span class="hljs-keyword">if</span>(<span class="hljs-built_in">present</span>(ctopo)) <span class="hljs-keyword">then</span><br>        vconvnew=<span class="hljs-number">0.9</span>*vconvfx(i)+<span class="hljs-number">1.5</span>*(<span class="hljs-built_in">max</span>((pblh_ysu(i)-<span class="hljs-number">500</span>)/<span class="hljs-number">1000.0</span>,<span class="hljs-number">0.0</span>))<br>        vconvlim = <span class="hljs-built_in">min</span>(vconvnew,<span class="hljs-number">1.0</span>)<br>        ad(i,<span class="hljs-number">1</span>) = <span class="hljs-number">1.</span>+fric(i,<span class="hljs-number">1</span>)*vconvlim+ctopo(i)*fric(i,<span class="hljs-number">1</span>)*(<span class="hljs-number">1</span>-vconvlim)<br>        ad(i,<span class="hljs-number">1</span>) = ad(i,<span class="hljs-number">1</span>) - bepswitch*frc_urb1d(i)* &amp;<br>                     (fric(i,<span class="hljs-number">1</span>)*vconvlim+ctopo(i)*fric(i,<span class="hljs-number">1</span>)*(<span class="hljs-number">1</span>-vconvlim))<br><span class="hljs-comment">!       ad(i,1) = 1.+(1.-bepswitch*frc_urb1d(i))* &amp;</span><br><span class="hljs-comment">!                    (fric(i,1)*vconvlim+ctopo(i)*fric(i,1)*(1-vconvlim))</span><br>      <span class="hljs-keyword">else</span><br>        ad(i,<span class="hljs-number">1</span>) = <span class="hljs-number">1.</span>+fric(i,<span class="hljs-number">1</span>)<br>      <span class="hljs-keyword">endif</span><br>     f1(i,<span class="hljs-number">1</span>) = ux(i,<span class="hljs-number">1</span>)+uoxl(i)*ust(i)**<span class="hljs-number">2</span>*rhox(i)*g/del(i,<span class="hljs-number">1</span>)*dt2/wspd1(i)*(wspd1(i)/wspd(i))**<span class="hljs-number">2</span><br>     f2(i,<span class="hljs-number">1</span>) = vx(i,<span class="hljs-number">1</span>)+voxl(i)*ust(i)**<span class="hljs-number">2</span>*rhox(i)*g/del(i,<span class="hljs-number">1</span>)*dt2/wspd1(i)*(wspd1(i)/wspd(i))**<span class="hljs-number">2</span><br>   <span class="hljs-keyword">enddo</span><br></code></pre></td></tr></table></figure><ul><li>ux=u3d(ims,kms,j),vx=v3d(ims,kms,j)</li></ul><figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs fortran"><span class="hljs-comment">!</span><br><span class="hljs-comment">! paj: ctopo2=1 if topo_wind=0 (default)</span><br><span class="hljs-comment">!</span><br>   <span class="hljs-keyword">do</span> i = its,ite<br>     <span class="hljs-keyword">if</span>(<span class="hljs-built_in">present</span>(ctopo)<span class="hljs-keyword">.and.</span><span class="hljs-built_in">present</span>(ctopo2)) <span class="hljs-keyword">then</span> <span class="hljs-comment">! mchen for NMM</span><br>       u10(i) = ctopo2(i)*u10(i)+(<span class="hljs-number">1</span>-ctopo2(i))*ux(i,<span class="hljs-number">1</span>)<br>       v10(i) = ctopo2(i)*v10(i)+(<span class="hljs-number">1</span>-ctopo2(i))*vx(i,<span class="hljs-number">1</span>)<br>     <span class="hljs-keyword">endif</span> <span class="hljs-comment">!mchen</span><br>   <span class="hljs-keyword">enddo</span><br></code></pre></td></tr></table></figure><h1 id="references">References</h1><ol type="1"><li>Topo Wind Intercomparison<ol type="1"><li><a href="https://dtcenter.ucar.edu/eval/meso_mod/topo_wind/" class="uri">https://dtcenter.ucar.edu/eval/meso_mod/topo_wind/</a></li><li>Topo Wind Intercomparsion Test</li><li>Statistically/Practically Significant Table Reports</li><li>Publications<ol type="1"><li>Investigating the impact of surface parameterization schemes available in WRF on surface winds</li><li>Investigating seasonal and regional differences if the WRF-ARW HIRES Window physics suite</li></ol></li></ol></li><li>Lee, J., Shin, H. H., Hong, S. Y., JimÃ©nez, P. A., Dudhia, J., &amp; Hong, J. (2015). Impacts of subgridâ€scale orography parameterization on simulated surface layer wind and monsoonal precipitation in the highâ€resolution WRF model. Journal of Geophysical Research: Atmospheres, 120(2), 644-653.<ol type="1"><li>For accurate surface wind simulations, the subgrid-scale (SGS) orography parameterization scheme was employed. It was found that the simulated surface wind showed negative (positive) bias over mountainous (flat) regions when the SGS orography parameterization was excluded.</li><li>After inclusion of the SGS orography parameterization, <strong>wind speed</strong> over mountainous (flat) regions increased (decreased), implying that the bias was mitigated. <strong>Moisture divergence (convergence)</strong> over the mountains (on the leeward side of the mountains) was induced, and <strong>surface latent heat flux</strong> increased along the mountain ranges following the improvement in the representation of the surface wind by the inclusion of the SGS orography parameterization.</li><li>ventually, excessive <strong>precipitation</strong> simulated over mountainous areas of East Asia, which is a feature commonly observed in numerical model studies, was alleviated because of the moisture divergence and increased surface latent heat flux.</li></ol></li><li>Lorente-Plazas, R., JimÃ©nez, P. A., Dudhia, J., &amp; MontÃ¡vez, J. P. (2016). Evaluating and Improving the Impact of the Atmospheric Stability and Orography on Surface Winds in the WRF Model. Monthly Weather Review, 144(7), 2685-2693. <a href="https://doi.org/10.1175/MWR-D-15-0449.1" class="uri">https://doi.org/10.1175/MWR-D-15-0449.1</a></li><li>æ¨é¹æ­¦, ç‹å­¦é”‹, ç‹éºŸ, &amp; æœ±å‹‡. (2016). WRF_TopoWind æ¨¡å¼å¯¹ä¸­å›½ä½çº¬é«˜åŸé«˜å±±é£é€Ÿæ¨¡æ‹Ÿçš„é€‚ç”¨æ€§ç ”ç©¶. äº‘å—å¤§å­¦å­¦æŠ¥ (è‡ªç„¶ç§‘å­¦ç‰ˆ), 38(5), 766-772.<ol type="1"><li><a href="http://www.yndxxb.ynu.edu.cn/yndxxbzrkxb/en/article/pdf/preview/10.7540/j.ynu.20160060.pdf" class="uri">http://www.yndxxb.ynu.edu.cn/yndxxbzrkxb/en/article/pdf/preview/10.7540/j.ynu.20160060.pdf</a></li></ol></li><li>åˆ˜éƒç, è‹—ä¸–å…‰, åˆ˜ç£Š, èƒ¡é. ä¿®æ­£WRFæ¬¡ç½‘æ ¼åœ°å½¢æ–¹æ¡ˆåŠå…¶å¯¹é£é€Ÿæ¨¡æ‹Ÿçš„å½±å“. åº”ç”¨æ°”è±¡å­¦æŠ¥, 2019, 30(1): 70-81.<ol type="1"><li>å¤æ‚åœ°å½¢åŒºåŸŸé£åœºæ¨¡æ‹Ÿçš„å‡†ç¡®ç‡ä¸€ç›´æ˜¯é£èƒ½ç ”ç©¶é¢†åŸŸçš„éš¾ç‚¹å’Œé‡ç‚¹ã€‚WRFæ¨¡å¼æ˜¯ç›®å‰é£èƒ½è¯„ä¼°é¢†åŸŸåº”ç”¨æœ€å¹¿æ³›çš„å¤©æ°”æ•°å€¼æ¨¡å¼ä¹‹ä¸€ï¼Œ<strong>ä½†è¯¥æ¨¡å¼åœ¨å¤æ‚åœ°å½¢åŒºåŸŸå­˜åœ¨å¯¹å¹³åŸã€å±±è°·é£é€Ÿé«˜ä¼°ä¸”å¯¹å±±é¡¶é£é€Ÿä½ä¼°çš„ç³»ç»Ÿæ€§è¯¯å·®</strong>ï¼Œå¹¶æœ‰ç ”ç©¶å»ºç«‹æ¬¡ç½‘æ ¼åœ°å½¢æ–¹æ¡ˆä»¥è®¢æ­£è¯¯å·®ã€‚è€Œæ¬¡ç½‘æ ¼åœ°å½¢æ–¹æ¡ˆåœ¨ä¸åŒæ°´å¹³åˆ†è¾¨ç‡ä¸‹å¸¸å‡ºç°é”™è¯¯çš„ä¿®æ­£ç»“æœï¼Œè¯¥æ–‡åŸºäºé«˜ç²¾åº¦åœ°å½¢é«˜ç¨‹æ•°æ®åˆ†æäº†æ–¹æ¡ˆå¤±æ•ˆçš„ä¸»è¦åŸå› ï¼Œå‘ç°å…¶æ–¹ç¨‹ç»„ä¸­åˆ¤æ–­å±±ä½“å½¢æ€ç‰¹å¾çš„é˜ˆå€¼-20åœ¨è¿‡ä½å’Œè¿‡é«˜æ°´å¹³åˆ†è¾¨ç‡ä¸‹å‡å¤±å»å‚è€ƒæ€§ã€‚é’ˆå¯¹è¿™ä¸€åŸå› ï¼Œå°†æ–¹æ¡ˆä¸­å½±å“å…³é”®å‚æ•°Ctçš„åœ°å½¢é«˜åº¦ç®—å­ä¸æ¨¡å¼æ°´å¹³åˆ†è¾¨ç‡è¿›è¡Œæ‹Ÿåˆï¼Œå½¢æˆåœ°å½¢é«˜åº¦ç®—å­ä¸æ°´å¹³åˆ†è¾¨ç‡ç›¸ä¾èµ–çš„çº¿æ€§å…³ç³»ï¼Œè·å¾—ä¸åŒåˆ†è¾¨ç‡ä¸‹æ›´é€‚åˆçš„å±±ä½“å½¢æ€é˜ˆå€¼ã€‚é€šè¿‡ä¸è‡ªåŠ¨æ°”è±¡ç«™10 mé£é€Ÿå¯¹æ¯”åˆ†æäº†ä¿®æ­£å‰åWRFå¯¹ä½å±‚é£é€Ÿçš„æ¨¡æ‹Ÿæ•ˆæœï¼Œç»“æœæ˜¾ç¤ºï¼šä¿®æ­£åçš„æ¬¡ç½‘æ ¼åœ°å½¢æ–¹æ¡ˆèƒ½å¤Ÿåˆ†åˆ«åœ¨è¾ƒä½å’Œè¾ƒé«˜åˆ†è¾¨ç‡ä¸‹ï¼Œéƒ¨åˆ†çŸ«æ­£åŸæ–¹æ¡ˆé”™è¯¯çš„è®¢æ­£ç»“æœï¼Œä½¿ä½å±‚é£é€Ÿæ¨¡æ‹Ÿæ›´æ¥è¿‘å®å†µã€‚ä¿®æ­£åçš„æ¬¡ç½‘æ ¼åœ°å½¢æ–¹æ¡ˆå¯ä¸ºå¤æ‚åœ°å½¢åŒºåŸŸå¼€å±•é«˜åˆ†è¾¨ç‡é£åœºæ¨¡æ‹Ÿæä¾›å‚è€ƒã€‚</li></ol></li></ol>]]></content>
    
    
    <categories>
      
      <category>WRF</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NWP</tag>
      
      <tag>WRF</tag>
      
      <tag>MPAS</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>WRF | WPS | WRFDomainWizard</title>
    <link href="/2024/10/30/WPS-draw-domain-WRFDomainWizard/"/>
    <url>/2024/10/30/WPS-draw-domain-WRFDomainWizard/</url>
    
    <content type="html"><![CDATA[<h1 id="wrf-wrfdomainwizardæ›´ç®€å•çš„ç¡®å®šåŒºåŸŸå’Œç½‘æ ¼">WRF | WRFDomainWizardï¼šæ›´ç®€å•çš„ç¡®å®šåŒºåŸŸå’Œç½‘æ ¼</h1><ul><li><a href="https://mp.weixin.qq.com/s/GxUqMWWyKeOXN4DbuSDubQ" class="uri">https://mp.weixin.qq.com/s/GxUqMWWyKeOXN4DbuSDubQ</a></li></ul><p>WRFæ¨¡æ‹Ÿä¸­ç›®æ ‡åŒºåŸŸç¡®å®šåï¼Œç¡®å®šç½‘æ ¼æ•°ç›®ä¸€ç›´æ˜¯ä¸€ä¸ªæ¯”è¾ƒçƒ¦äººçš„é—®é¢˜ï¼Œå•å±‚ç½‘æ ¼è¿˜å¥½ï¼ŒåµŒå¥—ç½‘æ ¼å°¤å…¶éº»çƒ¦ï¼ˆeg. è¦ç¡®å®šåµŒå¥—ç½‘æ ¼çš„æ•°æ®ã€ä¸åŒå±‚ç½‘æ ¼çš„èµ·å§‹ç‚¹ç­‰ï¼‰ã€‚å› æ­¤ï¼Œæœ¬ç¯‡å‘å¤§å®¶ä»‹ç»ä¸€ä¸ªå¾ˆå¥½çš„å·¥å…·ï¼Œå¯ä»¥æ›´ç®€å•çš„ç¡®å®šç½‘æ ¼çš„ç›¸å…³å‚æ•°ã€‚</p><p>è¯¥å·¥å…·ä¸ºï¼š<a href="https://jiririchter.github.io/WRFDomainWizard/" class="uri">https://jiririchter.github.io/WRFDomainWizard/</a></p><p>from <a href="https://github.com/JiriRichter/WRFDomainWizard" class="uri">https://github.com/JiriRichter/WRFDomainWizard</a></p><p>è¯¥å·¥å…·å¯ä»¥åœ¨åœ°å›¾ä¸Šè¿›è¡Œæ‰‹åŠ¨åœ°å‹¾ç”»ï¼Œå‹¾ç”»çš„åŒæ—¶ä¼šåœ¨å·¦è¾¹åŒæ—¶å½¢æˆç›¸å…³å‚æ•°ï¼Œå¯ä»¥æ›´æ–¹ä¾¿çš„ç¡®å®šç½‘æ ¼çš„ç›¸å…³å‚æ•°ï¼Œå¯èƒ½ç•¥æœ‰çš„ä¸è¶³å°±æ˜¯åªæœ‰ä¸€äº›åœ°ç‚¹åçš„æ ‡è¯†ï¼Œæ²¡æœ‰æ˜ç¡®çš„çœç•Œã€å¿çº§ç­‰åŒºåŸŸè¾¹ç•Œï¼Œå…·ä½“æƒ…å†µè¿˜è¯·è‡ªå·±æ¢ç´¢å§ã€‚</p><p><img src="https://i.imgur.com/4nQVELM.jpeg" /> <img src="https://i.imgur.com/yRo6vyN.png" /> <img src="https://i.imgur.com/e9Xd5Z3.png" /></p>]]></content>
    
    
    <categories>
      
      <category>WRF</category>
      
    </categories>
    
    
    <tags>
      
      <tag>HPC</tag>
      
      <tag>NWP</tag>
      
      <tag>WRF</tag>
      
      <tag>WPS</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MPAS | NCL High-resolution coastlines</title>
    <link href="/2024/10/30/NCL-high-resolution-dataset/"/>
    <url>/2024/10/30/NCL-high-resolution-dataset/</url>
    
    <content type="html"><![CDATA[<h1 id="ncl">NCL</h1><h2 id="high-resolution-coastlines">High-resolution coastlines</h2><p>One way to get <strong>high-resolution coastlines</strong> in your NCL maps is by downloading and installing the multi-resolution coastline database RANGS (Regionally Accessible Nested Global Shorelines), developed by Rainer Feistel from Wessel and Smith's GSHHS (Global Self-consistent Hierarchical High-resolution Shoreline) database. Note: do not use the high-resolution database for global data, as you will get streaks across your plot. This database is intended only for regional data.</p><p>NCL also supports <a href="https://www.ncl.ucar.edu/Applications/shapefiles.shtml">shapefiles</a>, if you need to add map outlines that NCL doesn't have.</p><p>To use this database, you must first download it from:</p><ul><li><a href="https://www.io-warnemuende.de/rangs-en.html" class="uri">https://www.io-warnemuende.de/rangs-en.html</a></li></ul><p>On this page you should see a table with ten *.zip files to download:</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">rangs</span><span class="hljs-params">(<span class="hljs-number">0</span>)</span></span><span class="hljs-selector-class">.zip</span>     <span class="hljs-built_in">gshhs</span>(<span class="hljs-number">0</span>)<span class="hljs-selector-class">.zip</span><br><span class="hljs-function"><span class="hljs-title">rangs</span><span class="hljs-params">(<span class="hljs-number">1</span>)</span></span><span class="hljs-selector-class">.zip</span>     <span class="hljs-built_in">gshhs</span>(<span class="hljs-number">1</span>)<span class="hljs-selector-class">.zip</span><br><span class="hljs-function"><span class="hljs-title">rangs</span><span class="hljs-params">(<span class="hljs-number">2</span>)</span></span><span class="hljs-selector-class">.zip</span>     <span class="hljs-built_in">gshhs</span>(<span class="hljs-number">2</span>)<span class="hljs-selector-class">.zip</span><br><span class="hljs-function"><span class="hljs-title">rangs</span><span class="hljs-params">(<span class="hljs-number">3</span>)</span></span><span class="hljs-selector-class">.zip</span>     <span class="hljs-built_in">gshhs</span>(<span class="hljs-number">3</span>)<span class="hljs-selector-class">.zip</span><br><span class="hljs-function"><span class="hljs-title">rangs</span><span class="hljs-params">(<span class="hljs-number">4</span>)</span></span><span class="hljs-selector-class">.zip</span>     <span class="hljs-built_in">gshhs</span>(<span class="hljs-number">4</span>).zip<br></code></pre></td></tr></table></figure><p>You must download all ten of these files, unzip them, and either put them in the directory</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-variable">$NCARG_ROOT</span><span class="hljs-regexp">/lib/</span>ncarg<span class="hljs-regexp">/database/</span>rangs<br></code></pre></td></tr></table></figure><p>like micromamba/envs/venv/lib/ncarg/database/rangs/</p><p>(which NCL will look in by default), or put them somewhere else and set the environment variable NCARG_RANGS to this directory. The files take up <strong>about 140 megabytes</strong>, unzipped.</p><figure class="highlight sml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sml">xxx/micromamba/envs/venv/lib/ncarg/database/rangs<br>$ ls<br><span class="hljs-symbol">&#x27;gshhs</span>(<span class="hljs-number">0</span>).rim&#x27;  <span class="hljs-symbol">&#x27;gshhs</span>(<span class="hljs-number">2</span>).rim&#x27;  <span class="hljs-symbol">&#x27;gshhs</span>(<span class="hljs-number">4</span>).rim&#x27;  <span class="hljs-symbol">&#x27;rangs</span>(<span class="hljs-number">0</span>).zip&#x27;  <span class="hljs-symbol">&#x27;rangs</span>(<span class="hljs-number">2</span>).cat&#x27;  <span class="hljs-symbol">&#x27;rangs</span>(<span class="hljs-number">3</span>).cel&#x27;  <span class="hljs-symbol">&#x27;rangs</span>(<span class="hljs-number">4</span>).zip&#x27;<br><span class="hljs-symbol">&#x27;gshhs</span>(<span class="hljs-number">0</span>).zip&#x27;  <span class="hljs-symbol">&#x27;gshhs</span>(<span class="hljs-number">2</span>).zip&#x27;  <span class="hljs-symbol">&#x27;gshhs</span>(<span class="hljs-number">4</span>).zip&#x27;  <span class="hljs-symbol">&#x27;rangs</span>(<span class="hljs-number">1</span>).cat&#x27;  <span class="hljs-symbol">&#x27;rangs</span>(<span class="hljs-number">2</span>).cel&#x27;  <span class="hljs-symbol">&#x27;rangs</span>(<span class="hljs-number">3</span>).zip&#x27;<br><span class="hljs-symbol">&#x27;gshhs</span>(<span class="hljs-number">1</span>).rim&#x27;  <span class="hljs-symbol">&#x27;gshhs</span>(<span class="hljs-number">3</span>).rim&#x27;  <span class="hljs-symbol">&#x27;rangs</span>(<span class="hljs-number">0</span>).cat&#x27;  <span class="hljs-symbol">&#x27;rangs</span>(<span class="hljs-number">1</span>).cel&#x27;  <span class="hljs-symbol">&#x27;rangs</span>(<span class="hljs-number">2</span>).zip&#x27;  <span class="hljs-symbol">&#x27;rangs</span>(<span class="hljs-number">4</span>).cat&#x27;<br><span class="hljs-symbol">&#x27;gshhs</span>(<span class="hljs-number">1</span>).zip&#x27;  <span class="hljs-symbol">&#x27;gshhs</span>(<span class="hljs-number">3</span>).zip&#x27;  <span class="hljs-symbol">&#x27;rangs</span>(<span class="hljs-number">0</span>).cel&#x27;  <span class="hljs-symbol">&#x27;rangs</span>(<span class="hljs-number">1</span>).zip&#x27;  <span class="hljs-symbol">&#x27;rangs</span>(<span class="hljs-number">3</span>).cat&#x27;  <span class="hljs-symbol">&#x27;rangs</span>(<span class="hljs-number">4</span>).cel&#x27;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>MPAS</category>
      
    </categories>
    
    
    <tags>
      
      <tag>HPC</tag>
      
      <tag>NWP</tag>
      
      <tag>WRF</tag>
      
      <tag>MPAS</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MPAS | HPC file system failure or MPI failure</title>
    <link href="/2024/10/29/HPC-file-system-failure/"/>
    <url>/2024/10/29/HPC-file-system-failure/</url>
    
    <content type="html"><![CDATA[<p>When having simulation on new cluster, we have issue about the failure of multiple nodes.</p><ol type="1"><li>node up infinite 2 idle node-[1,2]</li><li>submit by 1 node, it is successful.</li><li>submit by 2 nodes, it hangs.</li><li>node-[1,3] fails as well.</li></ol><p>stops here, no respond and still occupy nodes, <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">Using io_type Parallel-NetCDF (CDF-5, large variable support) <span class="hljs-keyword">for</span> mesh stream<br>  ** Attempting to bootstrap MPAS framework using stream: input<br></code></pre></td></tr></table></figure></p><p>Or,</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">Segmentation fault (signal 11)<br><br>insert_addr_table_roots_only() /build/impi/_buildspace/release/../../src/mpid/ch4/netmod/ofi/ofi_init.c<br></code></pre></td></tr></table></figure><p>Or,</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">This requires fcntl(2) to be implemented. As of 8/25/2011 it is not. Generic MPICH Message: File locking failed <span class="hljs-keyword">in</span> ADIOI_GEN_SetLock(fd 1B,cmd F_SETLKW64/7,<span class="hljs-built_in">type</span> F_RDLCK/0,<span class="hljs-built_in">whence</span> 0) with <span class="hljs-built_in">return</span> value FFFFFFFF and errno 26.<br>- If the file system is NFS, you need to use NFS version 3, ensure that the lockd daemon is running on all the machines, and mount the directory with the <span class="hljs-string">&#x27;noac&#x27;</span> option (no attribute caching).<br>- If the file system is LUSTRE, ensure that the directory is mounted with the <span class="hljs-string">&#x27;flock&#x27;</span> option.<br></code></pre></td></tr></table></figure><p>Solution:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/bash</span><br><br><span class="hljs-built_in">ulimit</span> -s unlimited<br><span class="hljs-built_in">export</span> OMP_STACKSIZE=1G<br><span class="hljs-built_in">export</span> I_MPI_FABRICS=<span class="hljs-string">&quot;shm:ofi&quot;</span><br><br><span class="hljs-comment"># for multiple nodes,</span><br><span class="hljs-comment"># Enable parallel filesystem support</span><br><span class="hljs-built_in">export</span> I_MPI_EXTRA_FILESYSTEM=<span class="hljs-built_in">enable</span><br><span class="hljs-comment"># Enable cross node communication in partition</span><br><span class="hljs-built_in">export</span> FI_PROVIDER=tcp<br>...<br></code></pre></td></tr></table></figure><p>to allow extra filesystem and use <code>tcp</code> that be slower a bit.</p>]]></content>
    
    
    <categories>
      
      <category>MPAS</category>
      
    </categories>
    
    
    <tags>
      
      <tag>HPC</tag>
      
      <tag>NWP</tag>
      
      <tag>WRF</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MPAS | Minimum computer resources for running MPAS</title>
    <link href="/2024/10/28/Minimum-computer-resources-for-running-MPAS/"/>
    <url>/2024/10/28/Minimum-computer-resources-for-running-MPAS/</url>
    
    <content type="html"><![CDATA[<h1 id="mpas-a">MPAS-A</h1><div class="note note-primary">            <p><strong>Amount of memory needed</strong> to run a particular simulation is to multiply the number of horizontal cells in the mesh by <strong>0.175 MB/cell</strong></p>          </div><div class="note note-primary">            <p>We find that on Cheyenne, MPAS-A scales with around <strong>70% parallel efficiency down to around 100 grid columns per MPI task</strong></p>          </div><ul><li><a href="https://forum.mmm.ucar.edu/threads/minimum-computer-requirements-for-running-mpas.10047/">Feb 16, 2021 | Minimum computer requirements for running MPAS | mgduda</a><ul><li>Regarding memory requirements, we've found that a reasonable way to estimate the <strong>amount of memory needed to run a particular simulation is to multiply the number of horizontal cells in the mesh by 0.175 MB/cell</strong>; this estimate is based on a single-precision model run with around 55 vertical levels. So, for example, a global, quasi-uniform 30-km simulation might require around 655362 cells * 0.175 MB/cell = 115,000 MB of memory. Note that this is the aggregate amount of memory across all nodes of a computing cluster, and not the amount of memory on each node. Also, this is a rough estimate only, and the amount of memory required for a simulation can vary a little based on, for example, your choice of physics parameterizations.</li><li>In principle, there is no minimum requirement for the number of processors (as long as there is at least one processor), since using fewer processors simply means that a simulation will take longer to run. If one were patient enough, and if enough memory were available, a single processor could be used for any simulation. For a few notes on estimating simulation throughput with MPAS-Atmosphere with different numbers of processors, <a href="https://forum.mmm.ucar.edu/phpBB3/viewtopic.php?f=12&amp;t=9002&amp;p=16332&amp;hilit=core+hours#p16332">this forum thread</a> may be helpful.</li><li>Regarding the kind of system to use, I can offer that we have run MPAS-Atmosphere on a wide variety of computing systems: Raspberry Pi single-board computers, macOS laptops, linux desktops with 4 or 8 cores, and some large clusters like Cheyenne and Summit. So there isn't necessarily a specific system that I could recommend -- all come with pros and cons (cost, reliability, performance). One point worth mentioning, however, is that a higher-performance interconnect between nodes would generally be beneficial, as MPI communication is performed extensively throughout each time step in the model.</li><li>Again, the 0.175 MB/cell figure is a rough estimate. Using more cores will generally increase the model simulation rate</li><li>It may be a bit difficult to accurately calculate the memory required by a simulation at the init_atmosphere stage, since we don't yet know, e.g., which physics schemes will be used in the simulation or which diagnostics will be requested in output streams. In principle this could be done when the atmosphere_model program starts, but gauging memory requirements of physics and diagnostics would still be quite a challenge, I think.</li><li>I do agree that it would be nice to give better indications of out-of-memory errors. One tractable step in this direction might be to check the status of all major memory allocations in the model; for example, just checking allocations of model fields defined in the Registry.xml file might help. We'll give this some serious consideration, and if you have any other suggestions, we'd be glad to hear them</li></ul></li><li><a href="https://forum.mmm.ucar.edu/threads/computing-power-necessary-for-global-wrf-mpas.9002/#p16332">Apr 2, 2020 | Computing power necessary for global WRF/MPAS</a><ul><li>For both WRF and MPAS, <strong>the computational costs scale more or less linearly with the number of grid cells, and inversely with the integration time step</strong>. So, if you have the computational cost for one simulation, you can quickly estimate the cost of other simulations.</li><li>On the <strong>NWSC Cheyenne computer</strong>, the <strong>computational cost for a global, quasi-uniform 15-km simulation with 2,621,442 grid</strong> columns and 56 vertical layers is about <strong>530 core-hours per simulated day</strong>. This includes no file output and the default "mesoscale reference" suite of physics parameterizations, with the radiation schemes called once every 15 simulated minutes; the model integration time step is 90 seconds.</li><li>For example, then, if we were to estimate the cost of a global, variable-resolution simulation on a mesh with <strong>6,488,066 grid</strong> columns and a <strong>minimum grid distance of 3 km</strong>, which would probably dictate an integration time step of around <strong>18 seconds</strong>, a rough estimate would be:<ul><li>530 core-hours/day * (6488066 / 2621442) * (90 / 18) = 6559 core-hours per simulated day</li></ul></li><li>A few other factors that influence computational cost include:<ul><li>The suite of physics parameterizations that are used in the simulation.</li><li>The amount of model output written to the filesystem: more file output implies more time spent writing data.</li><li>The compiler used to build the model executables, as well as the optimization flags used for that compiler.</li><li>The number of MPI tasks used to run the model: there is a general downward trend in parallel efficiency as more MPI tasks are used in a model simulation. <strong>We find that on Cheyenne, MPAS-A scales with around 70% parallel efficiency down to around 100 grid columns per MPI task</strong>.</li><li>The simulation length: there is a cost associated with "starting up" the model (reading initial conditions, allocating memory, initializing data structures, etc.), and longer simulations will allow that start-up cost to be amortized over more integration time steps.</li></ul></li></ul></li></ul>]]></content>
    
    
    <categories>
      
      <category>MPAS</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NWP</tag>
      
      <tag>WRF</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Coriolis force | ç§‘æ°åŠ›</title>
    <link href="/2024/10/26/Coriolis-force/"/>
    <url>/2024/10/26/Coriolis-force/</url>
    
    <content type="html"><![CDATA[<p>In physics, the <strong>Coriolis force</strong> is an inertial (or fictitious) force that acts on objects in motion within a frame of reference that rotates with respect to an inertial frame. In a reference frame with clockwise rotation, the force acts to the left of the motion of the object. In one with anticlockwise (or counterclockwise) rotation, the force acts to the right. Deflection of an object due to the Coriolis force is called the Coriolis effect. Though recognized previously by others, the mathematical expression for the Coriolis force appeared in an 1835 paper by French scientist Gaspard-Gustave de Coriolis, in connection with the theory of water wheels. Early in the 20th century, the term Coriolis force began to be used in connection with meteorology.</p><figure><img src="https://i.imgur.com/knTtXP0.jpeg" alt="If the air began to move in response to that force, however, the Coriolis force would deflect it, to the right of the motion in the northern hemisphere or to the left in the southern hemisphere." width="400" /><figcaption>If the air began to move in response to that force, however, the Coriolis force would deflect it, to the right of the motion in the northern hemisphere or to the left in the southern hemisphere.</figcaption></figure><div class="group-image-container"><div class="group-image-row"><div class="group-image-wrap"><img src="https://i.imgur.com/lTrDNpz.jpeg" width="400" /></div><div class="group-image-wrap"><img src="https://i.imgur.com/6p5PJ2P.jpeg" /></div></div></div><h1 id="derivation">Derivation</h1><p><span class="math display">\[\begin{align*}\mathbf{r} = x\hat{\mathbf{i}} + y\hat{\mathbf{j}} + z\hat{\mathbf{k}} \end{align*}\]</span></p><p>Specify subscript <span class="math inline">\(r\)</span> to represent <strong>a body-fixed system (The Earth)</strong> as basis <span class="math inline">\(\hat{\mathbf{i}}, \hat{\mathbf{j}}, \hat{\mathbf{k}}\)</span>,</p><p><span class="math display">\[\begin{align*} \left( \dfrac{d \mathbf{r}}{dt} \right)_r &amp;= \dfrac{dx}{dt}\hat{\mathbf{i}} + \dfrac{dy}{dt}\hat{\mathbf{j}} + \dfrac{dz}{dt}\hat{\mathbf{k}} \end{align*} \]</span></p><p>When a <strong>space-fixed system</strong> is considered,</p><p><span class="math display">\[\begin{align*}\left( \dfrac{d \mathbf{r}}{dt} \right)_s &amp;= \dfrac{dx}{dt}\hat{\mathbf{i}} + \dfrac{dy}{dt}\hat{\mathbf{j}} + \dfrac{dz}{dt}\hat{\mathbf{k}} + x\dfrac{d \hat{\mathbf{i}}}{dt} + y\dfrac{d \hat{\mathbf{j}}}{dt} + z\dfrac{d \hat{\mathbf{z}}}{dt} \\&amp; = \left( \dfrac{d \mathbf{r}}{dt} \right)_r + x\dfrac{d \hat{\mathbf{i}}}{dt} + y\dfrac{d \hat{\mathbf{j}}}{dt} + z\dfrac{d \hat{\mathbf{z}}}{dt} \end{align*} \]</span></p><p>What are last three terms?</p><p><span class="math display">\[\begin{align*}\dfrac{d \hat{\mathbf{i}}}{dt} &amp;= \mathbf{\omega} \times \hat{\mathbf{i}} \\\dfrac{d \hat{\mathbf{j}}}{dt} &amp;= \mathbf{\omega} \times \hat{\mathbf{j}} \\\dfrac{d \hat{\mathbf{z}}}{dt} &amp;= \mathbf{\omega} \times \hat{\mathbf{z}} \\\end{align*} \]</span></p><p>then,</p><p><span class="math display">\[\begin{align*}\left( \dfrac{d \mathbf{r}}{dt} \right)_s &amp; = \left( \dfrac{d \mathbf{r}}{dt} \right)_r + \mathbf{\omega} \times \mathbf{r} \\\end{align*} \]</span></p><p>it is generalized to any vector <span class="math inline">\(\mathbf{A}\)</span>,</p><p><span class="math display">\[\begin{align*}\left( \dfrac{d \mathbf{A}}{dt} \right)_s &amp; = \left( \dfrac{d \mathbf{A}}{dt} \right)_r + \mathbf{\omega} \times \mathbf{A} \\\end{align*} \]</span></p><p>consider velocity <span class="math inline">\(\mathbf{v_s} = \left( \dfrac{d \mathbf{r}}{dt} \right)_s = \mathbf{v_r} + \mathbf{\omega} \times \mathbf{r}\)</span>,</p><p><span class="math display">\[\begin{align*}\mathbf{a_s} = \left( \dfrac{d \mathbf{v_s}}{dt} \right)_s &amp; = \left( \dfrac{d \mathbf{v_s}}{dt} \right)_r + \mathbf{\omega} \times \mathbf{v_s} \\&amp; = \left( \dfrac{d (\mathbf{\mathbf{v_r} + \mathbf{\omega} \times \mathbf{r}})}{dt} \right)_r + \mathbf{\omega} \times (\mathbf{v_r} + \mathbf{\omega} \times \mathbf{r}) \\&amp; = \mathbf{a_r} + \dfrac{d \mathbf{\omega}}{dt} \times \mathbf{r} +\mathbf{\omega} \times \mathbf{v_r} + \mathbf{\omega} \times \mathbf{v_r} + \mathbf{\omega} \times (\mathbf{\omega} \times \mathbf{r})\end{align*} \]</span></p><p>let <span class="math inline">\(\omega\)</span> is indepenent of time,</p><p><span class="math display">\[\begin{align*}\mathbf{a_s} &amp;= \mathbf{a_r} + 2\mathbf{\omega} \times \mathbf{v_r} + \mathbf{\omega} \times (\mathbf{\omega} \times \mathbf{r})\end{align*} \]</span></p><p>The equation of motion on space-fixed system is,</p><p><span class="math display">\[\begin{align*}\mathbf{F} = m \mathbf{a_s}\end{align*} \]</span></p><p>and converted to body-fixed system (<strong>The Earth</strong>) is,</p><p><span class="math display">\[\begin{align*}\mathbf{F} - 2 m \mathbf{\omega} \times \mathbf{v_r} - m \mathbf{\omega} \times (\mathbf{\omega} \times \mathbf{r}) = m \mathbf{a_r} \end{align*} \]</span></p><p>For the observer in the body-fixed or rotating system (<strong>The Earth</strong>), he/she will be suffered a Force/effective Force,</p><div class="note note-primary">            <p><span class="math display">\[\begin{align*}\mathbf{F_{eff}} = m \mathbf{a_r} = \mathbf{F} - 2 m \mathbf{\omega} \times \mathbf{v_r} - m \mathbf{\omega} \times (\mathbf{\omega} \times \mathbf{r}) \end{align*} \]</span></p>          </div><p>The second term <span class="math inline">\(- 2 m \mathbf{\omega} \times \mathbf{v_r}\)</span> called the <strong>Coriolis force</strong>, is present when a particle is moving in the rotating co-ordinate system. This is also not a real force, but a fictitious one. Another feature of this force is that it does no work, since it acts in a direction perpendicular to velocity.</p><p>The third term <span class="math inline">\(- m \mathbf{\omega} \times (\mathbf{\omega} \times \mathbf{r})\)</span> is <strong>centrifugal force</strong> that <span class="math inline">\(| m \mathbf{\omega} \times (\mathbf{\omega} \times \mathbf{r})| = mr \omega^2 \sin \theta\)</span>. he negative sign indicates that the centrifugal force is directed away from the centre of rotation. It is not a real force, but a fictitious one. It is present only if we refer to moving coordinates in space.</p><h1 id="coriolis-parameter-rossby-number">Coriolis parameter &amp; Rossby number</h1><p>The time, space, and velocity scales are important in determining the importance of the Coriolis force. Whether rotation is important in a system can be determined by its Rossby number, which is the ratio of the <strong>velocity</strong>, <span class="math inline">\(U\)</span>, of a system to the product of the <strong>Coriolis parameter</strong>,</p><div class="note note-primary">            <p><span class="math display">\[f=2\omega \sin \varphi\]</span></p>          </div><p>,and the <span class="math inline">\(\omega = 7.2921 Ã— 10^{âˆ’5}\)</span> rad/s can be calculated as <span class="math inline">\(2\pi / T\)</span> radians per second, the <strong>length scale</strong>, <span class="math inline">\(L\)</span>, <strong>latitude</strong> <span class="math inline">\(\varphi\)</span> of the motion:</p><p><span class="math display">\[Ro = \frac{U}{fL}\]</span></p><p>In the midlatitudes, the typical value for <span class="math inline">\(f\)</span> is about <span class="math inline">\(10^{âˆ’4}\)</span> rad/s.</p><p>Hence, it is the ratio of inertial to Coriolis forces; <strong>a small Rossby number indicates a system is strongly affected by Coriolis forces</strong>, and <strong>a large Rossby number indicates a system in which inertial forces dominate</strong>. For example, in tornadoes, the Rossby number is large, so in them the Coriolis force is negligible, and balance is between pressure and centrifugal forces. In low-pressure systems the Rossby number is low, as the centrifugal force is negligible; there, the balance is between Coriolis and pressure forces. In oceanic systems the Rossby number is often around 1, with all three forces comparable.</p><ul><li><strong>An atmospheric system moving at U = 10 m/s (22 mph) occupying a spatial distance of L = 1,000 km (621 mi), has a Rossby number of approximately 0.1</strong></li><li>A baseball pitcher may throw the ball at U = 45 m/s (100 mph) for a distance of L = 18.3 m (60 ft). The Rossby number in this case would be 32,000 (at latitude 31Â°47'46.382").</li></ul><h1 id="rossby-parameter">Rossby parameter</h1><p>In stability calculations, the rate of change of <span class="math inline">\(f\)</span> along the meridional direction becomes significant. This is called the Rossby parameter and is usually denoted</p><p><span class="math display">\[\beta = \frac{\partial f}{\partial y}\]</span></p><p>where <span class="math inline">\(y\)</span> is the in the local direction of increasing meridian. This parameter becomes important, for example, in calculations involving Rossby waves.</p><h1 id="f-plane-approximation">f-plane approximation</h1><p>In geophysical fluid dynamics, the <strong>f-plane approximation</strong> is an approximation where the <strong>Coriolis parameter</strong>, denoted <span class="math inline">\(f\)</span>, is set to a constant value.</p><p><span class="math display">\[\begin{align*}f &amp;= f_0 = 2\Omega\sin(\phi_0)\end{align*}\]</span></p><ul><li>This approximation is frequently used for the analysis of highly idealized tropical cyclones.</li><li>f-plane approximation is not appropriate when considering flows which span large changes in latitude.</li><li>The f-plane approximation is also poor near the equator.</li></ul><h1 id="beta-plane-approximation">beta-plane approximation</h1><p>In geophysical fluid dynamics, an approximation whereby the <strong>Coriolis parameter</strong>, <span class="math inline">\(f\)</span>, is set to <strong>vary linearly</strong> in space is called a <strong>beta plane approximation</strong>.</p><p><span class="math display">\[\begin{align*}f &amp;= f_0 + \beta y \\\beta &amp;= (\mathrm{d}f/\mathrm{d}y)|_{\phi_0} = 2\Omega\cos(\phi_0)/R\end{align*}\]</span></p><p>where <span class="math inline">\(f_{0}\)</span> is the Coriolis parameter at <span class="math inline">\(\phi _{0}\)</span>.</p><p>The beta plane approximation is useful for the theoretical analysis of many phenomena in geophysical fluid dynamics since <strong>it makes the equations much more tractable</strong>, yet retains the important information that the Coriolis parameter varies in space. In particular, Rossby waves, the most important type of waves if one considers large-scale atmospheric and oceanic dynamics, depend on the variation of f as a restoring force; they do not occur if the Coriolis parameter is approximated only as a constant.</p><ul><li>Ripa, P. (1997). â€œInertialâ€ Oscillations and the Î²-Plane Approximation(s). Journal of Physical Oceanography, 27(5), 633-647. https://doi.org/10.1175/1520-0485(1997)027&lt;0633:IOATPA&gt;2.0.CO;2</li></ul><h1 id="references">References</h1><ol type="1"><li><a href="https://magadhmahilacollege.org/wp-content/uploads/2020/09/Coriolis-Force.pdf">Coriolis-Force.pdf</a></li><li><a href="https://en.wikipedia.org/wiki/Rotating_reference_frame#Relating_rotating_frames_to_stationary_frames">wiki</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>Meteorology</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Geostrophic wind | åœ°è½‰é¢¨</title>
    <link href="/2024/10/26/Geostrophic-wind/"/>
    <url>/2024/10/26/Geostrophic-wind/</url>
    
    <content type="html"><![CDATA[<h1 id="åœ°è½‰é¢¨geostrophic-wind">åœ°è½‰é¢¨(Geostrophic wind)</h1><p><strong>åœ°è½‰é¢¨(Geostrophic wind)</strong> æ˜¯ä¸€ç¨®ç§‘æ°åŠ›å’Œæ°£å£“æ¢¯åº¦åŠ› (<strong>Coriolis force and the pressure gradient force</strong>)å·§å¦™å¹³è¡¡ä¸‹ç”¢ç”Ÿçš„ä¸€ç¨®ç†è«–ä¸Šçš„é¢¨ã€‚é€™å€‹ç‹€æ³ç¨±ç‚ºã€Œ<strong>åœ°è½‰å¹³è¡¡</strong>ã€ (<strong>geostrophic equilibrium or geostrophic balance</strong>)ã€‚</p><ul><li><strong>åœ°è½‰é¢¨çš„æ–¹å‘å’Œç­‰å£“ç·šå¹³è¡Œ</strong>ã€‚</li><li>é€™ç¨®å¹³è¡¡åœ¨è‡ªç„¶ç•Œä¸­å¾ˆå°‘å‡ºç¾ã€‚çœŸæ­£çš„é¢¨å¹¾ä¹ç¸½æ˜¯ç”±åœ°é¢æ‘©æ“¦åŠ›ç­‰å…¶ä»–åŠ›é‡ç”¢ç”Ÿï¼Œèˆ‡åœ°è½‰é¢¨ä¸åŒã€‚å› æ­¤ï¼Œåœ¨è‡ªç„¶ä¸­è¦å¯¦ç¾åœ°è½‰é¢¨åªæœ‰ç„¡æ‘©æ“¦åŠ›å’Œç­‰å£“ç·šæ˜¯å®Œç¾ç›´ç·šçš„ç‹€æ³ä¸‹ã€‚</li></ul><p>A useful heuristic is to imagine air starting from rest, experiencing a force directed from areas of high pressure toward areas of low pressure, called the pressure gradient force. If the air began to move in response to that force, however, the Coriolis force would deflect it, <strong>to the right of the motion in the northern hemisphere</strong> or to the left in the southern hemisphere. As the air accelerated, the deflection would increase until the Coriolis force's strength and direction balanced the pressure gradient force, a state called geostrophic balance.</p><p><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/d/dd/Geostrophic_current.pdf/page1-800px-Geostrophic_current.pdf.jpg" width="400" /> <img src="https://i.imgur.com/knTtXP0.jpeg" alt="If the air began to move in response to that force, however, the Coriolis force would deflect it, to the right of the motion in the northern hemisphere or to the left in the southern hemisphere." width="400" /> <img src="https://www.researchgate.net/profile/A-Giez/publication/356592145/figure/fig11/AS:11431281113717374@1674053965153/Left-panel-schematic-view-of-the-Geostrophic-wind-The-pressure-gradient-force-FP-is.jpg" alt="Left panel: schematic view of the Geostrophic wind. The pressure gradient force (FP) is equal in strength but in the opposite direction to the Coriolis force (Fc). The geostrophic wind (vg) is blowing along the isobars with the lower pressure on the left-hand side on the northern hemisphere. Right panel: example pressure distribution in the free atmosphere over Europe." /> <img src="https://i.imgur.com/B5gSHR9.png" alt="Friction allows surface wind to attain a cross-baric component directing from high to low" width="600" /> <img src="https://i.imgur.com/fE4uVhn.png" /></p><h1 id="hko-geostrophic-wind"><a href="https://www.hko.gov.hk/en/education/weather/meteorology-basics/00010-geostrophic-wind.html">HKO | Geostrophic Wind</a></h1><p><img src="https://www.hko.gov.hk/en/education/images/fig_00010_geostrophicwind_2e.jpg" alt="Schematic diagram of geostrophic wind formation: Geostrophic wind is the wind that will be blowing parallel to the isobars, when Coriolis force is balanced by the pressure gradient force" width="400" /> <img src="https://www.hko.gov.hk/en/education/images/fig_00010_geostrophicwind_3e.jpg" alt="The balance between the pressure gradient force and the resultant (dotted line) of Coriolis force and frictional force" width="400" /></p><h1 id="formulation">Formulation</h1><p><span class="math display">\[\begin{align}\frac{\mathrm{D}\boldsymbol{U}}{\mathrm{D}t} = -2\boldsymbol{\Omega} \times \boldsymbol{U} - \frac{1}{\rho} \nabla P + \mathbf{g} + \mathbf{F}_\mathrm{r}\end{align}\]</span> Here <span class="math inline">\(U\)</span> is the velocity field of the air, <span class="math inline">\(\Omega\)</span> is the angular velocity vector of the planet, <span class="math inline">\(\rho\)</span> is the density of the air, <span class="math inline">\(P\)</span> is the air pressure, <span class="math inline">\(F_r\)</span> is the friction, <span class="math inline">\(g\)</span> is the acceleration vector due to gravity and â <span class="math inline">\(\dfrac{D}{Dt}\)</span> is the material derivative.</p><p>Why use <span class="math inline">\(\dfrac{D}{Dt}\)</span> instead of partial derivative? Becuase the veloctiy of air mass can be zero that we move along with this air mass and feel no velocity change, in other words, kinetic energy is conserved. In contrast, partial derivative consider a fixed point in space that velocity of this fixed point can be varied.</p><p>Locally this can be expanded in Cartesian coordinates, with a positive <span class="math inline">\(u\)</span> representing an eastward direction and a positive <span class="math inline">\(v\)</span> representing a northward direction. Neglecting friction and vertical motion.</p><p><span class="math display">\[\begin{align}\frac{\mathrm{d}u}{\mathrm{d}t} &amp;= -\frac{1}{\rho}\frac{\partial P}{\partial x} + f \cdot v \\[5px]\frac{\mathrm{d}v}{\mathrm{d}t} &amp;= -\frac{1}{\rho}\frac{\partial P}{\partial y} - f \cdot u \\[5px]0 &amp;= -g -\frac{1}{\rho}\frac{\partial P}{\partial z}\end{align}\]</span></p><p>With <span class="math inline">\(f = 2 \Omega \sin \phi\)</span> the Coriolis parameter (approximately <span class="math inline">\(10^{âˆ’4} s^{âˆ’1}\)</span>, varying with latitude).</p><p>Assuming geostrophic balance, the system is stationary and the first two equations become:</p><p><span class="math display">\[\begin{align}f \cdot v &amp;= \;\;\,\frac{1}{\rho}\frac{\partial P}{\partial x} \\[5px]f \cdot u &amp;= -\frac{1}{\rho}\frac{\partial P}{\partial y}\end{align}\]</span></p><p>By substituting using the third equation above, we have:</p><p><span class="math display">\[\begin{align}f \cdot v &amp;= -g\frac{\; \frac{\partial P}{\partial x} \;}{\; \frac{\partial P}{\partial z} \;} = g\frac{\partial Z}{\partial x} \\[5px]f \cdot u &amp;= g\frac{\; \frac{\partial P}{\partial y} \;}{\; \frac{\partial P}{\partial z} \;} = -g\frac{\partial Z}{\partial y}\end{align}\]</span></p><p>with <span class="math inline">\(Z\)</span> the height of the constant pressure surface (geopotential height), satisfying</p><p><span class="math display">\[\frac{\partial P}{\partial x}\mathrm{d}x + \frac{\partial P}{\partial y}\mathrm{d}y + \frac{\partial P}{\partial z}\mathrm{d}Z = 0\]</span></p><p>This leads us to the following result for the geostrophic wind components <span class="math inline">\((u_g, v_g)\)</span>:</p><p><span class="math display">\[\begin{align}u_\mathrm{g} &amp;= -\frac{g}{f} \frac{\partial Z}{\partial y} \\[5px]v_\mathrm{g} &amp;= \;\;\,\frac{g}{f} \frac{\partial Z}{\partial x}\end{align}\]</span></p><p>The validity of this approximation depends on the local Rossby number. It is invalid at the equator, because <span class="math inline">\(f\)</span> is equal to zero there, and therefore generally not used in the tropics.</p><h2 id="rossby-number">Rossby number</h2><p>The time, space, and velocity scales are important in determining the importance of the Coriolis force. Whether rotation is important in a system can be determined by its Rossby number, which is the ratio of the velocity, <span class="math inline">\(U\)</span>, of a system to the product of the Coriolis parameter, <span class="math inline">\(f=2\omega \sin \varphi\)</span>, and the length scale, <span class="math inline">\(L\)</span>, of the motion:</p><p><span class="math display">\[Ro = \frac{U}{fL}\]</span></p><p>Hence, it is the ratio of inertial to Coriolis forces; <strong>a small Rossby number indicates a system is strongly affected by Coriolis forces</strong>, and <strong>a large Rossby number indicates a system in which inertial forces dominate</strong>. For example, in tornadoes, the Rossby number is large, so in them the Coriolis force is negligible, and balance is between pressure and centrifugal forces. In low-pressure systems the Rossby number is low, as the centrifugal force is negligible; there, the balance is between Coriolis and pressure forces. In oceanic systems the Rossby number is often around 1, with all three forces comparable.</p><ul><li><strong>An atmospheric system moving at U = 10 m/s (22 mph) occupying a spatial distance of L = 1,000 km (621 mi), has a Rossby number of approximately 0.1</strong></li><li>A baseball pitcher may throw the ball at U = 45 m/s (100 mph) for a distance of L = 18.3 m (60 ft). The Rossby number in this case would be 32,000 (at latitude 31Â°47'46.382").</li></ul><h1 id="references">References</h1><ol type="1"><li><a href="https://userfiles-secure.educatorpages.com/userfiles/jlindsay/Meteorology/IX.%20Geostrophic%20Winds.pdf">IX. GEOSTROPHIC WINDS</a></li><li><a href="https://www.soest.hawaii.edu/MET/Faculty/businger/notes/force-wind-2.pdf">force-wind-2.pdf</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>Meteorology</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Jet Stream | é«˜é€Ÿæ°£æµ</title>
    <link href="/2024/10/26/Jet-stream/"/>
    <url>/2024/10/26/Jet-stream/</url>
    
    <content type="html"><![CDATA[<p><strong>é«˜é€Ÿæ°£æµ(Jet Stream)</strong>ï¼Œæˆ–ç¨±å™´å°„æ°£æµã€é«˜ç©ºæ€¥æµã€æ¥µé‹’å™´æµã€å™´æµã€æ¿€æµï¼Œæ˜¯è¡Œæ˜Ÿå°ºåº¦çš„å¤§æ°£ç’°æµã€‚åœ¨åœ°çƒä¸Šï¼ŒæŒ‡æ•¸æ¢åœç¹åœ°çƒçš„<strong>å¼·è€Œçª„çš„é«˜é€Ÿæ°£æµå¸¶ï¼Œé›†ä¸­åœ¨å°æµå±¤é ‚</strong>ï¼Œåœ¨ä¸­é«˜ç·¯è¥¿é¢¨å¸¶å…§æˆ–åœ¨ä½ç·¯åº¦åœ°å€éƒ½å¯å‡ºç¾ã€‚å…¶æ°´å¹³é•·åº¦é”ä¸Šè¬å…¬é‡Œï¼Œå¯¬æ•¸ç™¾å…¬é‡Œï¼Œåšæ•¸å…¬é‡Œã€‚<strong>ä¸­å¿ƒé¢¨é€Ÿæœ‰æ™‚å¯é”æ¯å°æ™‚200è‡³300å…¬é‡Œçš„åè¥¿é¢¨</strong>ï¼Œè€Œä¸”å¯ä»¥æœ‰ä¸€å€‹æˆ–å¤šå€‹é¢¨é€Ÿæ¥µå¤§ä¸­å¿ƒï¼Œå…·æœ‰å¼·å¤§çš„æ°´å¹³é¢¨åˆ‡è®Šå’Œå‚ç›´é¢¨åˆ‡è®Šã€‚é«˜é€Ÿæ°£æµé™„è¿‘äº¦æœ‰å¼·å¤§é¢¨åˆ‡è®Šï¼Œé€™ä¹Ÿæ˜¯æ‰€è¬‚é£›æ©Ÿä¸Šçš„äº‚æµã€‚</p><p>The first indications of this phenomenon came from American professor Elias Loomis (1811â€“1889), when he proposed the hypothesis of a powerful air current in the upper air blowing west to east across the United States as an explanation for the behaviour of major storms. After the 1883 eruption of the Krakatoa volcano, weather watchers tracked and mapped the effects on the sky over several years. They labelled the phenomenon the "equatorial smoke stream". å™´å°„æ°£æµæ˜¯åœ¨1920å¹´ä»£ï¼Œç”±æ—¥æœ¬æ°£è±¡å­¸å®¶å¤§çŸ³å’Œä¸‰éƒï¼ˆWasaburo Oishiï¼‰ç™¼ç¾çš„ã€‚ä»–åœ¨å¯Œå£«å±±é™„è¿‘çš„æŸå€‹åœ°é»é€²è¡Œè¿½è¹¤äº†é£›è¡Œå“¡æ°£çƒï¼Œä¹Ÿç¨±ç‚ºpibalsï¼ˆç”¨ä¾†æ¸¬å®šé«˜å±¤é¢¨çš„æ°£çƒï¼‰ï¼Œç•¶å®ƒå€‘å‡é«˜è‡³å°æµå±¤é ‚æ™‚ç™¼ç¾åˆ°å™´å°„æ°£æµçš„å­˜åœ¨ã€‚å¤§çŸ³çš„è«–æ–‡åœ¨æ—¥æœ¬ä»¥å¤–çš„åœ‹å®¶å»£ç‚ºäººçŸ¥ã€‚</p><p>åœ¨åŒ—åŠçƒï¼Œ<strong>æ¥µé‹’å™´æµ(Polar Jet Stream)</strong>å°æ–¼èˆªç©ºç•Œè·Ÿæ°£è±¡é å ±ä¾†èªªï¼Œæ˜¯å¾ˆé‡è¦çš„ã€‚å› ç‚ºæ¥µé‹’å™´æµçš„é€Ÿåº¦æ¯”<strong>å‰¯ç†±å¸¶å™´å°„æ°£æµ(Subtropical Jet Stream)</strong>ä¾†çš„å¿«ï¼Œä¸”å‡ºç¾åœ¨æ¯”è¼ƒä½çš„é«˜åº¦ã€‚ä¸”æ¥µé‹’å™´æµæ¶µè“‹äº†åŒ—åŠçƒçš„å¤§éƒ¨ä»½åœ‹å®¶ã€‚ç›¸è¼ƒä¹‹ä¸‹ï¼Œå—åŠçƒçš„æ¥µé‹’å™´æµå¾˜å¾Šåœ¨å—æ¥µæ´²ï¼Œæˆ–æœ‰æ™‚å‡ºç¾åœ¨å—ç¾æ´²ã€‚</p><div class="group-image-container"><div class="group-image-row"><div class="group-image-wrap"><img src="https://upload.wikimedia.org/wikipedia/commons/3/3e/Jetcrosssection.jpg" alt="1" /></div></div><div class="group-image-row"><div class="group-image-wrap"><img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/Jetstreamconfig.jpg" alt="2" width="400" /></div><div class="group-image-wrap"><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/9/9c/Earth_Global_Circulation_-_en.svg/2560px-Earth_Global_Circulation_-_en.svg.png" alt="3" width="300" /></div></div></div><ul><li><strong>æ¥µåœ°é«˜ç©ºæ€¥æµ</strong>ä¸€èˆ¬å‡ºç¾åœ¨å¤§æ°£å±¤250ç™¾å¸•ï¼Œå³æµ·æ‹”7è‡³12å…¬é‡Œï¼ˆ23,000è‡³39,000å‘ï¼‰è™•ã€‚</li><li>æ›´å¼±çš„<strong>äºç†±å¸¶é«˜ç©ºæ€¥æµ</strong>çš„é«˜åº¦æ›´é«˜ï¼Œæµ·æ‹”10è‡³16å…¬é‡Œï¼ˆ33,000è‡³52,000å‘ï¼‰ã€‚å¤å­£ï¼ŒåŒ—åŠçƒæ¥µåœ°æ€¥æµååŒ—ï¼›å†¬å­£ï¼ŒåŒ—åŠçƒæ¥µåœ°æ€¥æµåå—ã€‚é«˜ç©ºæ€¥æµçš„å¯¬åº¦ç‚ºæ•¸ç™¾å…¬é‡Œï¼Œåšåº¦å°æ–¼5å…¬é‡Œã€‚</li></ul><div class="note note-primary">            <ul><li>All these facts are consequences of the <strong>thermal wind</strong> relation. The balance of forces acting on an atmospheric air parcel in the vertical direction is primarily between the gravitational force acting on the mass of the parcel and the buoyancy force, or the difference in pressure between the top and bottom surfaces of the parcel.</li><li><strong>æ¥µåœ°åˆ°èµ¤é“æº«åº¦æ¢¯åº¦ç›¸é—œçš„ç†±æˆé¢¨</strong>æ˜¯å½¢æˆå°æµå±¤ä¸Šå±¤æ€¥æµçš„ä¸»è¦ç‰©ç†è§£é‡‹</li></ul>          </div><h1 id="videoes">Videoes</h1><ul><li>Met office | What is the jet stream and how does it affect the weather? <iframe width="560" height="315" src="https://www.youtube.com/embed/Lg91eowtfbw?si=s3XE7WSCbhaOmELh" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe></li></ul><h1 id="study">Study</h1><ul><li>é«˜ç©ºæ€¥æµé™„è¿‘çš„æ™´ç©ºæ¹æµ<ul><li><a href="https://www.hko.gov.hk/tc/aviat/turbulence/Jetstream.htm" class="uri">https://www.hko.gov.hk/tc/aviat/turbulence/Jetstream.htm</a></li></ul></li></ul><figure><img src="https://www.hko.gov.hk/tc/aviat/turbulence/images/JetStream.png" alt="åœ–ç‚ºé¦™æ¸¯å¤©æ–‡å°ç‚ºé›¢æ¸¯èˆªç­æä¾›çš„å¤©æ°£åœ–ï¼Œé¡¯ç¤ºäº†è·é›¢åœ°é¢30,000å‘ï¼ˆç´„9å…¬é‡Œï¼‰ä¸Šç©ºçš„é¢¨å’Œæº«åº¦ã€‚åœ–ä¸­ç´…ç·šæ¨™èªŒé¢¨é€Ÿè¶…é80æµ·é‡Œï¼ˆç´„æ¯å°æ™‚150å…¬é‡Œï¼‰çš„å€åŸŸï¼Œå³è©²é«˜åº¦çš„é«˜ç©ºæ€¥æµæ‰€åœ¨ã€‚" width="300" /><figcaption>åœ–ç‚ºé¦™æ¸¯å¤©æ–‡å°ç‚ºé›¢æ¸¯èˆªç­æä¾›çš„å¤©æ°£åœ–ï¼Œé¡¯ç¤ºäº†è·é›¢åœ°é¢30,000å‘ï¼ˆç´„9å…¬é‡Œï¼‰ä¸Šç©ºçš„é¢¨å’Œæº«åº¦ã€‚åœ–ä¸­ç´…ç·šæ¨™èªŒé¢¨é€Ÿè¶…é80æµ·é‡Œï¼ˆç´„æ¯å°æ™‚150å…¬é‡Œï¼‰çš„å€åŸŸï¼Œå³è©²é«˜åº¦çš„é«˜ç©ºæ€¥æµæ‰€åœ¨ã€‚</figcaption></figure><ul><li><p>é«˜ç©ºæ€¥æµæ˜¯è·é›¢åœ°é¢æ•¸å…¬é‡Œé«˜çš„ç‹¹çª„å¼·é¢¨å¸¶ã€‚ç©ºæ°£åœ¨é«˜ç©ºæ€¥é€Ÿæµå‹•ï¼Œå°±å¥½åƒæ°´åœ¨çŒ›æ€¥æ²³æµä¸­æµå‹•ä¸€æ¨£ï¼Œ<strong>ç•¶çŒ›æ€¥çš„æ²³æ°´é‡ä¸Šæ²³å²¸æ—ç·©ç·©çš„æ°´æµæ™‚ï¼Œä¾¿æœƒç”¢ç”Ÿæ³¢æµªå’Œæ¼©æ¸¦</strong>ã€‚ç•¶é€™äº›æ³¢æµªå’Œæ¼©æ¸¦æ„ˆä¾†æ„ˆå¤§ï¼Œæ°´æµä¾¿è®Šå¾—æ¹æ€¥ã€‚åŒæ¨£æƒ…æ³ä¹Ÿå‡ºç¾åœ¨é«˜ç©ºæ€¥æµä¹‹ä¸­ï¼Œæ‰€ä»¥ç•¶é£›æ©Ÿé‡ä¸Šé«˜ç©ºæ€¥æµé™„è¿‘çš„æ™´ç©ºæ¹æµï¼Œé£›æ©Ÿæœƒè®Šå¾—é¡›ç°¸ä¸å®šã€‚ ä¸‹åœ–ç‚ºé¦™æ¸¯å¤©æ–‡å°ç‚ºé›¢æ¸¯èˆªç­æä¾›çš„å¤©æ°£åœ–ï¼Œé¡¯ç¤ºäº†è·é›¢åœ°é¢30,000å‘ï¼ˆç´„9å…¬é‡Œï¼‰ä¸Šç©ºçš„é¢¨å’Œæº«åº¦ã€‚åœ–ä¸­ç´…ç·šæ¨™èªŒé¢¨é€Ÿè¶…é80æµ·é‡Œï¼ˆç´„æ¯å°æ™‚150å…¬é‡Œï¼‰çš„å€åŸŸï¼Œå³è©²é«˜åº¦çš„é«˜ç©ºæ€¥æµæ‰€åœ¨ã€‚</p></li><li><a href="https://popopo.medium.com/%E5%A6%82%E4%BD%95%E8%A7%A3%E9%87%8B%E5%99%B4%E5%B0%84%E6%A2%9D-jet-streak-%E7%9A%84%E8%BC%BB%E5%90%88-convergence-%E8%88%87%E8%BC%BB%E6%95%A3-divergence-%E5%88%86%E4%BD%88-277c6732e247">å¦‚ä½•è§£é‡‹å™´æµæ¢(Jet Streak)çš„è¼»åˆ(Convergence)èˆ‡è¼»æ•£(Divergence)åˆ†ä½ˆ?</a><ul><li>é—œæ–¼å™´å°„æ°£æµçš„æˆå› ï¼Œä¸€èˆ¬å¯ä»¥ç”¨<strong>ç†±åŠ›é¢¨å¹³è¡¡(Thermal wind balance)ä¾†åšç¬¬ä¸€å±¤è§£é‡‹</strong></li></ul></li><li><p><a href="https://www.meted.ucar.edu/labs/synoptic/jets_ageo_circ/navmenu.php">UCAR | Analyzing Jet Stream Circulations</a></p></li></ul><div class="group-image-container"><div class="group-image-row"><div class="group-image-wrap"><img src="https://www.meted.ucar.edu/labs/synoptic/jets_ageo_circ/media/graphics/global_200_winds_15aug2012.jpg" width="400" /></div></div><div class="group-image-row"><div class="group-image-wrap"><img src="https://www.meted.ucar.edu/labs/synoptic/jets_ageo_circ/media/graphics/jetstreaks_australia.jpg" width="400" /></div></div></div>]]></content>
    
    
    <categories>
      
      <category>Meteorology</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Maths | PDE | Overview</title>
    <link href="/2024/10/25/maths-PDE-introduction/"/>
    <url>/2024/10/25/maths-PDE-introduction/</url>
    
    <content type="html"><![CDATA[<p>In mathematics, a <strong>partial differential equation (PDE)</strong> is an equation which computes a function between various partial derivatives of a multivariable function.</p><h1 id="classification">Classification</h1><p>A PDE is called <strong>linear</strong> if it is linear in the unknown and its derivatives. For example, for a function <span class="math inline">\(u\)</span> of <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span>, a second order linear PDE is of the form</p><p><span class="math display">\[\begin{align*} a_1(x,y)u_{xx} + a_2(x,y)u_{xy} + a_3(x,y)u_{yx} + a_4(x,y)u_{yy} + a_5(x,y)u_x + a_6(x,y)u_y + a_7(x,y)u = f(x,y)\end{align*} \]</span></p><p>where <span class="math inline">\(a_i\)</span> and <span class="math inline">\(f\)</span> are functions of the independent variables <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span> only. (Often the mixed-partial derivatives <span class="math inline">\(u_{xy}\)</span> and <span class="math inline">\(u_{yx}\)</span> will be equated, but this is not required for the discussion of linearity.)</p><ul><li>If the <span class="math inline">\(a_i\)</span> are constants (independent of <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span>) then the PDE is called <strong>linear</strong> with constant coefficients.</li><li>If <span class="math inline">\(f\)</span> is zero everywhere then the linear PDE is <strong>homogeneous</strong>, otherwise it is <strong>inhomogeneous</strong>. (This is separate from asymptotic homogenization, which studies the effects of high-frequency oscillations in the coefficients upon solutions to PDEs.</li></ul><p>Nearest to linear PDEs are <strong>semi-linear PDEs</strong>, where only the highest order derivatives appear as linear terms, with coefficients that are functions of the independent variables. The lower order derivatives and the unknown function may appear arbitrarily. For example, a general second order semi-linear PDE in two variables is</p><p><span class="math display">\[\begin{align*} a_1(x,y)u_{xx} + a_2(x,y)u_{xy} + a_3(x,y)u_{yx} + a_4(x,y)u_{yy} + f(u_x, u_y, u, x, y) = 0\end{align*} \]</span></p><p>In a <strong>quasilinear PDE</strong> the highest order derivatives likewise appear only as linear terms, but with coefficients possibly functions of the unknown and lower-order derivatives:</p><p><span class="math display">\[\begin{align*} a_1(u_x, u_y, u, x, y)u_{xx} + a_2(u_x, u_y, u, x, y)u_{xy} + a_3(u_x, u_y, u, x, y)u_{yx} + a_4(u_x, u_y, u, x, y)u_{yy} + f(u_x, u_y, u, x, y) = 0\end{align*} \]</span></p><p>Many of the fundamental PDEs <strong>in physics are quasilinear</strong>, such as the <strong>Einstein equations</strong> of general relativity and the <strong>Navierâ€“Stokes equations</strong> describing fluid motion.</p><p>A PDE without any linearity properties is called <strong>fully nonlinear</strong>, and possesses nonlinearities on one or more of the highest-order derivatives. An example is the <strong>Mongeâ€“AmpÃ¨re equation</strong>, which arises in differential geometry.</p><h1 id="second-order-pde-classification">Second order PDE Classification</h1><ul><li><a href="https://en.wikipedia.org/wiki/Partial_differential_equation#Second_order_equations">wiki</a></li><li><a href="https://web.stanford.edu/class/math220a/handouts/secondorder.pdf">Levandosky, Julie. "Classification of Second-Order Equations"</a></li><li><a href="https://www.fluid.tuwien.ac.at/322042?action=AttachFile&amp;do=get&amp;target=Classification_v2.pdf">Classification of PDEs</a></li></ul><p>The <strong>elliptic/parabolic/hyperbolic classification</strong> provides a guide to appropriate initial- and boundary conditions and to the smoothness of the solutions. Assuming <span class="math inline">\(u_{xy} = u_{yx}\)</span>, the general linear second-order PDE in two independent variables has the form</p><p><span class="math display">\[\begin{align*} Au_{xx} + Bu_{xy} + Cu_{yy} + Du_x + Eu_y + Fu +G= 0    \end{align*} \tag{1}\]</span> where <span class="math inline">\(A,B,C,D,E,F,G\)</span> may be functions of <span class="math inline">\(x,y\)</span>. Caution: <span class="math inline">\(A\)</span> and <span class="math inline">\(C\)</span> must be non-zero for this method to work! If this is not the case, then use the generic method for second-order PDEs.</p><table><thead><tr class="header"><th>Type</th><th>Discriminant</th><th>is reducible to</th><th>Example</th><th>Example equation</th></tr></thead><tbody><tr class="odd"><td><code>Elliptic</code></td><td><span class="math inline">\(B^2 - 4 AC &lt; 0\)</span></td><td><span class="math inline">\(u_{xx} + u_{yy} + ...= 0\)</span></td><td>Laplace's equation</td><td><span class="math inline">\(u_{xx} + u_{yy} = 0\)</span></td></tr><tr class="even"><td><code>Parabolic</code></td><td><span class="math inline">\(B^2 - 4 AC = 0\)</span></td><td><span class="math inline">\(u_{xx} + ...= 0\)</span></td><td>Heat equation</td><td><span class="math inline">\(u_t - u_{xx} = 0\)</span></td></tr><tr class="odd"><td><code>Hyperbolic</code></td><td><span class="math inline">\(B^2 - 4 AC &gt; 0\)</span></td><td><span class="math inline">\(u_{xx} - u_{yy} + ...= 0\)</span></td><td>Wave equation</td><td><span class="math inline">\(u_{tt} - u_{xx} = 0\)</span></td></tr></tbody></table><p>The three equations in Example above are of particular interest not only because they are derived from physical principles, but also because <strong>every second-order linear equation of the form (1) can be reduced to an equation of one of those forms (plus lower-order terms) by making a change of variables</strong>.</p><p>From the numerical point of view,</p><table><thead><tr class="header"><th></th><th></th><th>Types</th><th>Computational Concern</th></tr></thead><tbody><tr class="odd"><td>Initial Value Problem</td><td>Time evolution</td><td>Parabolic or Hyperbolic</td><td><strong>Stability</strong></td></tr><tr class="even"><td>Boundary Value Problem</td><td>Static solution</td><td>Elliptic</td><td><strong>Efficiency</strong></td></tr></tbody></table><h2 id="navier-stokes-equations-ns-equations"><strong>Navier-Stokes equations (NS equations)</strong></h2><p>The <strong>Navier-Stokes equations (NS equations)</strong>, which describe the motion of fluid substances (like liquids and gases), are a set of nonlinear partial differential equations (PDEs). Their type depends on how they're applied and simplified for specific contexts. Hereâ€™s a breakdown:</p><h3 id="classification-based-on-context">1. <strong>Classification Based on Context</strong></h3><p>PDEs are classified as <strong>elliptic</strong>, <strong>parabolic</strong>, or <strong>hyperbolic</strong>, depending on the system's properties. The Navier-Stokes equations can exhibit any of these behaviors depending on the conditions.</p><h4 id="a-parabolic-type-diffusion-dominated">a) <strong>Parabolic Type</strong> (Diffusion-Dominated)</h4><ul><li>When viscous (diffusive) terms dominate over inertial terms (<span class="math inline">\((\mathbf{u} \cdot \nabla) \mathbf{u}\)</span>) in low Reynolds number (<span class="math inline">\(Re\)</span>) flows.</li><li>Example: Slow, creeping flows like those governed by the <strong>Stokes equation</strong> (a simplification of Navier-Stokes for very low <span class="math inline">\(Re\)</span>).</li></ul><h4 id="b-elliptic-type-steady-state-solutions">b) <strong>Elliptic Type</strong> (Steady-State Solutions)</h4><ul><li>For steady flows (<span class="math inline">\(\partial \mathbf{u} / \partial t = 0\)</span>), the Navier-Stokes equations can become elliptic.</li><li>Pressure fields are determined elliptically in incompressible flows due to the coupling of velocity and pressure.</li></ul><h4 id="c-hyperbolic-type-advection-dominated-or-compressible-regimes">c) <strong>Hyperbolic Type</strong> (Advection-Dominated) or compressible regimes</h4><ul><li>For high Reynolds number flows, where inertial terms dominate viscous terms, the flow becomes advection-dominated.</li><li>Inviscid (frictionless) Navier-Stokes equations reduce to the <strong>Euler equations</strong>, which are hyperbolic.</li></ul><h2 id="properties-of-different-types-of-pdes">Properties of different types of PDEs</h2><ul><li><code>Elliptic</code><ul><li>Boundary conditions must be prescribed all along the boundary</li><li><strong>Local change of the boundary data influences the solution everywhere</strong></li><li><strong>No propagation of waves</strong></li><li>No real characteristics</li></ul></li><li><code>Parabolic</code><ul><li>Parabolic equations arise by adding time dependence <span class="math inline">\(u_t\)</span> to equation which was originally elliptic.</li><li>Waves can propagate in one specific direction only, corresponding to time-like variable</li><li>Equivalent system of <span class="math inline">\(n\)</span> first-order equations has <span class="math inline">\(1\)</span> to <span class="math inline">\(n-1\)</span> real characteristics</li><li>Boundary conditions are required in space, initial condition in time</li><li><strong>Local change in boundary conditions affects immediately the solution at all positions in space, but only in future times</strong></li></ul></li><li><code>Hyperbolic</code><ul><li>Waves can reflect from boundaries</li><li>Equivalent system of <span class="math inline">\(n\)</span> first-order equations has <span class="math inline">\(n\)</span> real characteristics.</li><li>Boundary conditions are required in space, initial condition in time</li><li><strong>Information about local change of boundary condition travels through space with finite speed.</strong></li></ul></li></ul><h3 id="local-changes-and-their-effects">Local Changes and Their Effects</h3><p>Local modifications to boundary data can influence solutions in several ways, depending on the type of PDE:</p><ul><li><code>Elliptic PDEs</code>, such as Laplace's equation, are characterized by their boundary conditions being prescribed over the entire boundary of the domain. The effects of local changes in boundary conditions on elliptic equations are profound:<ul><li><strong>Immediate Influence</strong>: A local change in boundary data will affect the solution throughout the entire domain immediately. This is due to the smoothing properties of elliptic equations, where solutions tend to be continuous and smooth across the domain. For instance, if a Dirichlet boundary condition is altered at one point, the solution will adjust in a way that reflects this change throughout the entire region.</li><li><strong>No Propagation Delay</strong>: Unlike hyperbolic equations, there is no wave propagation; thus, changes do not require time to influence distant points in the domain. Instead, they affect all points instantaneously.</li></ul></li><li><code>Parabolic PDEs</code>, such as the heat equation, exhibit different characteristics regarding local changes in boundary conditions:<ul><li><strong>Temporal Influence</strong>: Changes to boundary conditions will affect the solution at all spatial locations but only at future times. This means that while a local alteration might not immediately impact distant points, over time, these changes will propagate through the domain.</li><li><strong>Initial Conditions Matter</strong>: In parabolic problems, both initial conditions and boundary conditions are crucial. A local change can lead to an evolution of the solution that reflects this change as time progresses. For example, if the temperature at a boundary is increased, it will eventually influence the temperature distribution throughout the domain as heat diffuses.</li></ul></li><li><code>Hyperbolic PDEs</code>, such as wave equations, have unique properties concerning local changes:<ul><li><strong>Directional Propagation</strong>: Local changes in boundary conditions can influence solutions through wave propagation. The effects of such changes are constrained by the speed of waves; thus, alterations at one boundary may take time to reach other parts of the domain depending on their distance and direction.</li><li><strong>Reflection and Interaction</strong>: Waves can reflect off boundaries, which means that local changes can create complex interactions within the domain as waves bounce back and forth. This can lead to intricate patterns in the solution that depend on both initial and boundary conditions.</li></ul></li></ul><div class="note note-danger">            <p>The effects of local changes in boundary data on PDE solutions vary significantly across different types of equations.</p><ul><li>Elliptic equations respond instantaneously throughout the domain,</li><li>Parabolic equations show temporal propagation effects, and</li><li>Hyperbolic equations exhibit directional influence based on wave behavior.</li></ul><p>Understanding these dynamics is essential for accurately modeling physical phenomena described by PDEs and for ensuring stability and reliability in numerical simulations.</p>          </div><ol type="1"><li><a href="https://math.stackexchange.com/questions/3937288/information-propagation-rate-in-2nd-order-pdes">Information propagation rate in 2nd-order PDEs</a><ul><li>Propagation of information generally refers to how local changes in the initial/boundary data is reflected in the corresponding solution.</li><li>In the elliptic and parabolic cases, local changes to initial/boundary data can change the solution at every point, which is what we mean by infinite speed of propagation.</li><li>For wave equations this is not the case however, and changes to initial data is propagates along a 'wave cone.'</li><li>Why would some systems result in finite information propagation rate and others necessarily have infinite information propagation rate?</li></ul></li></ol><h3 id="information-propagation-in-the-heat-equation">Information Propagation in the Heat Equation</h3><p>The heat equation, a fundamental parabolic partial differential equation, describes how heat diffuses through a medium over time. Its mathematical formulation is typically given as:</p><p><span class="math display">\[\frac{\partial T}{\partial t} = \alpha \frac{\partial^2 T}{\partial x^2}\]</span></p><p>where $ T(x, t) $ is the temperature at position $ x $ and time $ t $, and $ $ is the thermal diffusivity constant. Understanding how information propagates in this context is key to grasping the equation's implications in physical scenarios.</p><h4 id="key-characteristics-of-information-propagation"><strong>Key Characteristics of Information Propagation</strong></h4><ol type="1"><li><strong>Infinite Speed of Propagation</strong>:<ul><li>Unlike hyperbolic equations (e.g., the wave equation), which have a finite speed of propagation, the heat equation exhibits an <strong>infinite speed of propagation</strong>. This means that changes in temperature at any point in the medium affect all other points instantaneously. For example, if a sudden change occurs at one point, the entire domain feels this change immediately, leading to a smoothing effect across the temperature distribution.<ul><li>Intuitively, <strong>Brownian motion</strong> has infinite propagation speed, as it has a <strong>non-zero probability of reaching any point in any arbitrarily short time</strong>. This is due to the fact that the probability density of the normal distribution is strictly greater than zero over the entire space.</li></ul></li></ul></li><li><strong>Smoothing Effect</strong>:<ul><li>The heat equation inherently smooths out temperature distributions over time. Initially sharp changes or discontinuities in temperature will become less pronounced as time progresses. This behavior can be observed in the solution to the heat equation, where initial conditions are represented by a Dirac delta function, leading to solutions that spread and flatten out over time.</li></ul></li><li><strong>Loss of Information</strong>:<ul><li>As time progresses, information about the initial temperature distribution gradually dissipates. The solution approaches a steady state where temperature differences diminish, reflecting a loss of information about the initial conditions. This contrasts with hyperbolic equations where information is preserved along characteristic lines.</li></ul></li><li><strong>Mathematical Representation</strong>:<ul><li>The fundamental solution (or heat kernel) for the heat equation illustrates these properties mathematically. In one dimension, it can be expressed as:</li></ul><p><span class="math display">\[S(x, t) = \frac{1}{\sqrt{4\pi \alpha t}} e^{-\frac{x^2}{4\alpha t}}\]</span></p><p>This solution shows that as $ t $ increases, the peak of the Gaussian becomes flatter and approaches zero for fixed $ x $, indicating that localized heat effects spread out and diminish over time.</p></li></ol><h4 id="implications-of-infinite-propagation-speed"><strong>Implications of Infinite Propagation Speed</strong></h4><p>The notion of infinite speed of propagation can be counterintuitive:</p><ul><li><strong>Physical Interpretation</strong>: While it might seem that changes propagate instantaneously, this does not imply actual physical movement at infinite speeds. Instead, it reflects how thermal energy diffuses uniformly across the medium due to local interactions at the molecular level.</li><li><strong>Practical Considerations</strong>: In real-world applications, such as heat conduction in solids or fluids, this model simplifies analysis but may not account for delays due to physical constraints or material properties.</li></ul><h4 id="conclusion"><strong>Conclusion</strong></h4><p>The heat equation's characteristicsâ€”specifically its infinite speed of propagation and smoothing effectâ€”highlight its unique role among PDEs. Understanding these properties is crucial for modeling thermal processes accurately and recognizing how initial conditions influence long-term behavior in systems governed by diffusion phenomena.</p><h3 id="chatgpt">ChatGPT</h3><p>The statement "heat equation exhibits infinite speed of propagation" refers to a mathematical property of the classical <strong>heat equation</strong>, which describes how heat diffuses through a medium over time. The heat equation is typically written as:</p><p><span class="math display">\[\frac{\partial u}{\partial t} = \alpha \nabla^2 u\]</span></p><p>where:</p><ul><li>$ u = u(x,t) $ is the temperature distribution,</li><li><span class="math inline">\(\alpha &gt; 0\)</span> is the thermal diffusivity,</li><li><span class="math inline">\(\nabla^2\)</span> is the Laplacian operator.</li></ul><h4 id="meaning-of-infinite-speed-of-propagation">Meaning of Infinite Speed of Propagation</h4><p>In the heat equation, even if the initial temperature distribution <span class="math inline">\(u(x,0)\)</span> has compact support (nonzero only in a finite region of space), the solution <span class="math inline">\(u(x,t)\)</span> for <span class="math inline">\(t &gt; 0\)</span> becomes nonzero everywhere, even arbitrarily far from the initial region. This means that information about the temperature change "propagates" instantaneously to all parts of the medium, albeit with exponentially small magnitude at large distances.</p><h4 id="why-does-this-happen">Why Does This Happen?</h4><p>This property arises from the mathematical nature of the heat equation:</p><ol type="1"><li>The heat equation is a <strong>parabolic partial differential equation</strong>.</li><li>Parabolic equations do not have a finite propagation speed for disturbances because they involve second-order spatial derivatives without any mechanism limiting the spread of effects.</li></ol><h4 id="physical-implications">Physical Implications</h4><p>In real-world systems, the infinite speed of propagation predicted by the classical heat equation is not physically realistic because no physical process can propagate at infinite speed. <strong>The discrepancy arises because the heat equation is a continuum approximation and does not account for physical constraints such as the finite speed of thermal energy transport at the atomic or molecular level</strong>.</p><h4 id="modified-theories">Modified Theories</h4><p>To address this issue, <strong>hyperbolic heat equations</strong> or <strong>Cattaneo's equation</strong> are sometimes used. These models incorporate a finite speed of propagation by introducing a relaxation time for heat flux. For example, Cattaneo's equation modifies the heat equation to include a delay effect:</p><p><span class="math display">\[\tau \frac{\partial q}{\partial t} + q = -k \nabla u\]</span></p><p>where <span class="math inline">\(\tau\)</span> is the relaxation time, <span class="math inline">\(q\)</span> is the heat flux, and <span class="math inline">\(k\)</span> is the thermal conductivity. This modification ensures finite propagation speed.</p><h4 id="if-heat-equation-exhibits-infinite-speed-of-propagation-how-can-we-apply-finite-difference-method">If heat equation exhibits infinite speed of propagation , how can we apply finite difference method?</h4><p>Applying the finite difference method (FDM) to the heat equation is possible and commonly done, even though the equation exhibits infinite speed of propagation. This works because the infinite speed of propagation is a mathematical idealization that does not directly affect numerical methods. Here's why FDM can still be applied effectively:</p><h4 id="key-considerations-for-fdm-and-infinite-speed-of-propagation">Key Considerations for FDM and Infinite Speed of Propagation</h4><ol type="1"><li><strong>Locality of Computation</strong>:<ul><li>In FDM, the temperature at a grid point is updated based on values from neighboring points within a small finite region (e.g., using a stencil in space and time).</li><li>Although the theoretical solution predicts nonzero values everywhere, these values are often exponentially small and do not significantly affect computation beyond a finite domain.</li></ul></li><li><strong>Truncation of the Domain</strong>:<ul><li>In practice, computations are performed on a finite spatial domain, often with boundary conditions applied to simulate the effects of the surrounding infinite domain.</li><li>Any influence from distant points outside the computational domain is negligible due to the rapid decay of the solution in space.</li></ul></li><li><strong>Temporal Resolution</strong>:<ul><li>The FDM uses small time steps to advance the solution, which aligns with the localized propagation of numerical updates.</li><li>Even though theoretically, information propagates instantaneously, the numerical scheme respects the finite time step, ensuring stable and accurate progression.</li></ul></li><li><strong>Stability and Convergence</strong>:<ul><li>Stability conditions, such as the <strong>CFL condition</strong> (Courant-Friedrichs-Lewy), are enforced to ensure that the numerical solution behaves well.</li><li>For the explicit FDM for the heat equation, the time step size <span class="math inline">\(\Delta t\)</span> and spatial grid size <span class="math inline">\(\Delta x\)</span> must satisfy the condition: <span class="math display">\[\Delta t \leq \frac{\Delta x^2}{2\alpha}\]</span> This condition limits the temporal and spatial resolution, mitigating issues from infinite propagation speed.</li></ul></li><li><strong>Practical Approximations</strong>:<ul><li>In numerical simulations, small initial perturbations may diffuse quickly, but their contributions are bounded by the numerical resolution and truncation errors.</li><li>The numerical approximation only captures behavior within the computational grid and time resolution, effectively ignoring the infinite speed aspect.</li></ul></li></ol><h4 id="how-fdm-works-in-practice">How FDM Works in Practice</h4><p>To solve the 1D heat equation:</p><p><span class="math display">\[\frac{\partial u}{\partial t} = \alpha \frac{\partial^2 u}{\partial x^2},\]</span></p><p>we discretize it using finite difference approximations:</p><ul><li><strong>Time derivative</strong>: <span class="math inline">\(\frac{\partial u}{\partial t} \approx \frac{u_i^{n+1} - u_i^n}{\Delta t}\)</span>,</li><li><strong>Second spatial derivative</strong>: <span class="math inline">\(\frac{\partial^2 u}{\partial x^2} \approx \frac{u_{i+1}^n - 2u_i^n + u_{i-1}^n}{\Delta x^2}\)</span>.</li></ul><p>Substituting these into the equation gives:</p><p><span class="math display">\[\frac{u_i^{n+1} - u_i^n}{\Delta t} = \alpha \frac{u_{i+1}^n - 2u_i^n + u_{i-1}^n}{\Delta x^2}.\]</span></p><p>Rearranging, we obtain the update rule:</p><p><span class="math display">\[u_i^{n+1} = u_i^n + \frac{\alpha \Delta t}{\Delta x^2} (u_{i+1}^n - 2u_i^n + u_{i-1}^n).\]</span></p><h4 id="handling-infinite-propagation-numerically">Handling Infinite Propagation Numerically</h4><ul><li>The numerical scheme is inherently local, updating <span class="math inline">\(u_i^{n+1}\)</span> based only on immediate neighbors (<span class="math inline">\(u_{i-1}^n\)</span>, <span class="math inline">\(u_i^n\)</span>, <span class="math inline">\(u_{i+1}^n\)</span>).</li><li>The effects of distant changes are limited by the numerical grid and do not cause instability or spurious results if the scheme is stable.</li></ul><h4 id="conclusion-1">Conclusion</h4><p>The infinite speed of propagation in the heat equation is a theoretical concern that does not prevent FDM from being applied. Numerical schemes operate on a discretized version of the problem, which respects finite grid and time step sizes. With appropriate domain size, boundary conditions, and stability checks, FDM provides accurate solutions for practical problems involving the heat equation.</p><h2 id="generalizing-to-higher-dimensions">Generalizing to Higher Dimensions</h2><p>If there are n independent variables x1, x2 , â€¦, xn, a general linear partial differential equation of second order has the form,</p><p><span class="math display">\[\begin{align*} L u =\sum_{i=1}^n\sum_{j=1}^n a_{i,j} \frac{\partial^2 u}{\partial x_i \partial x_j} \quad+ \text{lower-order terms} = 0\end{align*} \]</span></p><p>The classification depends upon the signature of the eigenvalues of the coefficient matrix <span class="math inline">\(A = a_{i,j}\)</span>.</p><ul><li><code>Elliptic</code>: the eigenvalues are all positive or all negative.</li><li><code>Parabolic</code>: the eigenvalues are all positive or all negative, except one that is zero.</li><li><code>Hyperbolic</code>: there is only one negative eigenvalue and all the rest are positive, or there is only one positive eigenvalue and all the rest are negative.</li><li><code>Ultrahyperbolic</code>: there is more than one positive eigenvalue and more than one negative eigenvalue, and there are no zero eigenvalues.</li></ul><p>However, the classification only depends on linearity of the second-order terms and is therefore applicable to semi- and quasilinear PDEs as well.</p><h1 id="references">References</h1><ol type="1"><li><a href="https://www.ljll.fr/frey/cours/UdC/ma691/ma691_ch3.pdf">Partial differential equations</a></li><li><a href="http://www.fluid.tuwien.ac.at/322042?action=AttachFile&amp;do=get&amp;target=Classification_v2.pdf">Classification of PDEs</a></li><li><a href="https://cns.gatech.edu/~predrag/courses/PHYS-6124-12/StGoChap6.pdf">Chapter 6 Partial Differential Equations</a><ol type="1"><li>domain of influence</li><li>domain of dependence</li></ol></li><li><a href="https://web.math.sinica.edu.tw/media/pdf/d172/17201.pdf">ä¸˜æˆæ¡é™¢å£«æ¼”è¬›: åå¾®åˆ†æ–¹ç¨‹çš„æ–¹æ³• (<strong>æ¨è–¦</strong>)</a><ol type="1"><li>æ¢è¨äº†åå¾®åˆ†æ–¹ç¨‹åœ¨å‹•æ…‹å’Œéœæ…‹å•é¡Œä¸­çš„æ‡‰ç”¨ï¼Œç‰¹åˆ¥æ˜¯å¦‚ä½•åˆ©ç”¨é€™äº›æ–¹ç¨‹ä¾†ç†è§£ç³»çµ±çš„è¡Œç‚º</li><li>å¼•å…¥äº†ã€Œæ¥µé™ç’°ã€çš„æ¦‚å¿µï¼Œæè¿°ç•¶æ™‚é–“è¶³å¤ é•·æ™‚ï¼Œç³»çµ±æœƒè¶¨è¿‘æ–¼æŸä¸€ç©©å®šè»Œé“</li><li>ç•¶ç³»çµ±æ…¢æ…¢æ¥è¿‘é€™ä¸€è»Œé“æ™‚ï¼Œå¯ä»¥å¾—åˆ°ä¸€å€‹èˆ‡æ™‚é–“ç„¡é—œçš„æ–¹ç¨‹ï¼Œé€™å€‹æ–¹ç¨‹åœ¨æ©Ÿç‡ä¸Šåƒ…èˆ‡ $ f $ æœ¬èº«æœ‰é—œ</li><li>ç ”ç©¶å¦‚<strong>ç†±æ–¹ç¨‹</strong>å’Œ<strong>æ³¢å‹•æ–¹ç¨‹</strong>ç­‰å·¥å…·çš„é‡è¦æ€§ï¼Œä»¥ä¾¿æ›´å¥½åœ°ç†è§£ <strong>Laplace æ–¹ç¨‹</strong>åŠå…¶è§£çš„æ•´é«”è¡Œç‚º</li></ol></li><li><a href="https://www.ljll.fr/frey/ftp/finite-differences.pdf">The finite difference method</a><ol type="1"><li>It is well-known that solving the initial-value problem for the heat equation forward in time takes a discontinuous initial temperature <span class="math inline">\(u\)</span> at time <span class="math inline">\(t_0\)</span> into a temperature which is instantly smooth as soon as the times <span class="math inline">\(t &gt; t_0\)</span> . This may not be physically possible, since there would then be information propagation at infinite speed, which is in contradiction with the <strong>causality</strong> principle. Therefore this is a theoretical property of the mathematical equation.</li></ol></li></ol>]]></content>
    
    
    <categories>
      
      <category>Maths</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NWP</tag>
      
      <tag>AI</tag>
      
      <tag>ML</tag>
      
      <tag>PDE</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Maths | Boundary Conditions</title>
    <link href="/2024/10/25/maths-Boundary-conditions/"/>
    <url>/2024/10/25/maths-Boundary-conditions/</url>
    
    <content type="html"><![CDATA[<p>In the study of differential equations, a boundary-value problem is a differential equation subjected to constraints called boundary conditions. A solution to a boundary value problem is a solution to the differential equation which also satisfies the boundary conditions.</p><p>Summary of boundary conditions for the unknown function, <span class="math inline">\(y\)</span>, constants <span class="math inline">\(c_0\)</span> and <span class="math inline">\(c_1\)</span> specified by the boundary conditions, and known scalar functions <span class="math inline">\(f\)</span> and <span class="math inline">\(g\)</span> pecified by the boundary conditions.</p><table><thead><tr class="header"><th style="text-align: center;">Name</th><th style="text-align: center;">Form on 1st part of boundary</th><th style="text-align: center;">Form on 2nd part of boundary</th></tr></thead><tbody><tr class="odd"><td style="text-align: center;">Dirichlet</td><td style="text-align: center;"><span class="math inline">\(y = f\)</span></td><td style="text-align: center;"></td></tr><tr class="even"><td style="text-align: center;">Neumann</td><td style="text-align: center;"><span class="math inline">\(\dfrac{\partial y}{\partial n} = f\)</span></td><td style="text-align: center;"></td></tr><tr class="odd"><td style="text-align: center;">Robin</td><td style="text-align: center;"><span class="math inline">\(c_0 y + c_1 \dfrac{\partial y}{\partial n} = f\)</span></td><td style="text-align: center;"></td></tr><tr class="even"><td style="text-align: center;">Mixed</td><td style="text-align: center;"><span class="math inline">\(y = f\)</span></td><td style="text-align: center;"><span class="math inline">\(c_0 y + c_1 \dfrac{\partial y}{\partial n} = g\)</span></td></tr><tr class="odd"><td style="text-align: center;">Cauchy</td><td style="text-align: center;">both <span class="math inline">\(y = f\)</span> and <span class="math inline">\(\dfrac{\partial y}{\partial n} = g\)</span></td><td style="text-align: center;"></td></tr></tbody></table><ul><li>æ ¹æ“šæ¢ä»¶çš„å½¢å¼ï¼Œé‚Šå€¼æ¢ä»¶åˆ†ä»¥ä¸‹ä¸‰é¡<ul><li>ç¬¬ä¸€é¡é‚Šå€¼æ¢ä»¶ï¼šä¹Ÿç¨±ç‚ºç‹„åˆ©å…‹é›·é‚Šç•Œæ¢ä»¶ï¼Œç›´æ¥æè¿°ç‰©ç†ç³»çµ±é‚Šç•Œä¸Šçš„ç‰©ç†é‡ï¼Œä¾‹å¦‚æŒ¯å‹•çš„å¼¦å…©ç«¯èˆ‡å¹³è¡¡ä½ç½®çš„è·é›¢ï¼›</li><li>ç¬¬äºŒé¡é‚Šå€¼æ¢ä»¶ï¼šä¹Ÿç¨±ç‚ºè«¾ä¼Šæ›¼é‚Šç•Œæ¢ä»¶ï¼Œæè¿°ç‰©ç†ç³»çµ±é‚Šç•Œä¸Šç‰©ç†é‡å‚ç›´é‚Šç•Œçš„å°æ•¸çš„æƒ…æ³ï¼Œä¾‹å¦‚å°ç†±ç´°æ†ç«¯é»çš„ç†±æµï¼›</li><li>ç¬¬ä¸‰é¡é‚Šå€¼æ¢ä»¶ï¼šç‰©ç†ç³»çµ±é‚Šç•Œä¸Šç‰©ç†é‡èˆ‡å‚ç›´é‚Šç•Œå°æ•¸çš„ç·šæ€§çµ„åˆï¼Œä¾‹å¦‚ï¼Œç´°æ†ç«¯é»çš„è‡ªç”±å†·å»ï¼Œæº«åº¦ã€ç†±æµå‡ä¸ç¢ºå®šï¼Œä½†æ˜¯äºŒè€…çš„é—œä¿‚ç¢ºå®šï¼Œå³å¯åˆ—å‡ºäºŒè€…ç·šæ€§çµ„åˆè€Œæˆçš„é‚Šå€¼æ¢ä»¶ã€‚</li></ul></li></ul><table><thead><tr class="header"><th>Boundary type</th><th>Formal Name</th><th>Mathematical form</th></tr></thead><tbody><tr class="odd"><td>Type 1</td><td>Dirichlet</td><td><span class="math inline">\(h(x,y,z,t) = constant\)</span></td></tr><tr class="even"><td>Type 2</td><td>Neumann</td><td><span class="math inline">\(\dfrac{\partial h}{\partial n} = constant\)</span></td></tr><tr class="odd"><td>Type 3</td><td>Cauchy</td><td><span class="math inline">\(\dfrac{\partial h}{\partial n} + c h= constant\)</span></td></tr></tbody></table><p>é‚Šå€¼æ¢ä»¶ä¹Ÿå¯ä»¥æ ¹æ“šé‚Šå€¼å•é¡Œå°æ‡‰çš„å¾®åˆ†ç®—å­ä¾†åˆ†é¡ï¼šè‹¥æ˜¯ä½¿ç”¨æ©¢åœ“ç®—å­ï¼Œå‰‡å•é¡Œç‚ºæ©¢åœ“é‚Šå€¼å•é¡Œï¼›ä½¿ç”¨é›™æ›²ç·šç®—å­ï¼Œå‰‡å•é¡Œç‚ºé›™æ›²ç·šé‚Šå€¼å•é¡Œã€‚ä¾å¾®åˆ†ç®—å­é‚„å¯ä»¥å°‡å•é¡Œå†ç´°åˆ†ç‚ºç·šæ€§åŠéç·šæ€§ç­‰ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>Maths</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NWP</tag>
      
      <tag>AI</tag>
      
      <tag>ML</tag>
      
      <tag>PDE</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ML | DeepONet</title>
    <link href="/2024/10/24/ML-DeepONet/"/>
    <url>/2024/10/24/ML-DeepONet/</url>
    
    <content type="html"><![CDATA[<h1 id="deeponet">DeepONet</h1><p>DeepONet is a novel deep learning architecture designed to approximate nonlinear operators, which are mappings from one function space to another. Developed by researchers at Brown University, DeepONet represents a significant advancement in the field of machine learning, particularly in its ability to handle complex mathematical operations typically associated with differential equations.</p><h2 id="architecture">Architecture</h2><p>The DeepONet framework consists of two main components:</p><ul><li><strong>Branch Network</strong>: This network encodes the input function space, capturing data from discrete sensor locations.</li><li><strong>Trunk Network</strong>: This network encodes the output function space, determining how the input data is transformed into outputs.</li></ul><p>Together, these networks enable DeepONet to learn a mapping between functions rather than just pointwise values, which is a common limitation of traditional neural networks.</p><h2 id="key-features">Key Features</h2><ul><li><strong>Universal Approximation</strong>: DeepONet is grounded in the universal approximation theorem for operators, allowing it to approximate any continuous nonlinear operator with high accuracy. This capability extends beyond what standard neural networks can achieve.</li><li><strong>Speed and Efficiency</strong>: Once trained, DeepONet can perform real-time predictions significantly faster than conventional solvers used for differential equations. It can handle complex systems and make predictions in fractions of a second, which is particularly useful in applications like autonomous vehicles and digital twins for real-time modeling.</li><li><strong>Versatility</strong>: The architecture can be applied across various domains, including climate modeling, robotics, and even nuclear energy systems. Its ability to generalize from training data allows it to predict outcomes for new inputs that were not part of the training set.</li></ul><h2 id="applications">Applications</h2><p>DeepONet has promising applications in:</p><ul><li><strong>Autonomous Vehicles</strong>: Real-time predictions can enhance decision-making processes.</li><li><strong>Digital Twins</strong>: It enables accurate modeling of physical systems without the need for extensive retraining under varying conditions.</li><li><strong>Complex Systems Simulation</strong>: The architecture can represent intricate behaviors in dynamic environments, making it suitable for tasks such as climate modeling and engineering design.</li></ul><h1 id="universal-approximation-theorem">Universal Approximation Theorem</h1><p><strong>Definition</strong></p><p>The theorem states that for <strong>any continuous function</strong> $ f: ^n  $ defined on a compact subset of $ ^n $, there exists a neural network $ g $ such that the difference between $ f $ and $ g $ can be made arbitrarily small. Formally, for any $ &gt; 0 $, there exists a neural network with a finite number of neurons such that:</p><p><span class="math display">\[| f(x) - g(x) | &lt; \epsilon\]</span></p><p>for all $ x $ in the domain of interest.</p><p><strong>Historical Background</strong></p><p>The theorem was independently proven by George Cybenko in 1989, who focused on networks using sigmoid activation functions, and later by Kurt Hornik in 1991, who generalized it to include other activation functions like ReLU (Rectified Linear Unit).</p><p><strong>Implications</strong></p><p>It has profound implications for the design and understanding of neural networks:</p><ul><li><strong>Expressive Power</strong>: It guarantees that neural networks can model complex relationships in data, making them suitable for tasks like image classification, function approximation, and more.</li><li><strong>Architecture Design</strong>: The theorem informs users about the necessary architecture (e.g., number of layers and neurons) required to achieve desired approximations.</li></ul><p><strong>Limitations</strong></p><p>While the UAT provides a theoretical foundation, it does not address practical aspects such as:</p><ul><li><strong>Generalization</strong>: The ability of a network to perform well on unseen data is not guaranteed by the theorem alone. Techniques like regularization and cross-validation are necessary to improve generalization.</li><li><strong>Computational Feasibility</strong>: The theorem does not specify how to construct the network or find the optimal parameters effectively. In practice, training methods like backpropagation are used, but they may not always reach the global optimum.</li></ul><p><strong>Reading</strong></p><ul><li><a href="https://www.deep-mind.org/2023/03/26/the-universal-approximation-theorem/">The Universal Approximation Theorem</a></li><li><a href="https://mitliagkas.github.io/ift6085-2020/ift-6085-lecture-10-notes.pdf">Expressivity and Universal Approximation Theorems Part 1</a></li></ul><h1 id="maths">Maths</h1><ul><li><a href="https://citeseerx.ist.psu.edu/document?repid=rep1&amp;type=pdf&amp;doi=d5cbb7a8ae0e4ac907515b901d5a3af7f68c98a3">Chen, T., &amp; Chen, H. (1995). Universal approximation to nonlinear operators by neural networks with arbitrary activation functions and its application to dynamical systems. IEEE transactions on neural networks, 6(4), 911-917.</a></li></ul><p>Theorem 5: Suppose that <span class="math inline">\(g\in (TW)\)</span>, <span class="math inline">\(X\)</span> is a Banach Space, <span class="math inline">\(K_1 X, K_2 R^n\)</span> are two compact sets in <span class="math inline">\(X\)</span> and <span class="math inline">\(R^n\)</span> respectively, <span class="math inline">\(V\)</span> is a compace set in <span class="math inline">\(C(K_1)\)</span>, <span class="math inline">\(G\)</span> is a nonlinear continuous operator, which maps <span class="math inline">\(V\)</span> into <span class="math inline">\(C(K_2)\)</span>, then for any $&gt;0 $, there are positive integers <span class="math inline">\(M, N, m\)</span> constants <span class="math inline">\(c_i^k, \zeta_k, \xi_{ij}^k \in R^n\)</span>, <span class="math inline">\(x_j \in K_1, i=1,...,M, k=1,...,N, j=1,...,m\)</span>, such that</p><p><span class="math display">\[\begin{align*} | G(u)(y) - \sum_{k=1}^N \sum_{i=1}^M c_i^k g( \sum_{j=1}^m \xi_{ij}^k u(x_{j}) + \theta_i^k) g(\omega_k \cdot y + \xi_k)| &lt; \epsilon, \qquad \forall u \in U \end{align*}\]</span></p><p>More details,</p><figure><img src="https://media.springernature.com/m685/springer-static/image/art%3A10.1038%2Fs42256-021-00302-5/MediaObjects/42256_2021_302_Fig1_HTML.png" alt="DeepONet" /><figcaption>DeepONet</figcaption></figure><p><span class="math display">\[\begin{align*} G(u)(y) &amp;= G(u) \otimes (y) \\&amp;= \sum_{k=1}^p b_k t_k \\&amp;= \sum_{k=1}^p b_k \sigma(w_k \cdot y + \zeta_k) \\&amp;= \sum_{k=1}^p \sum_{i=1}^n c_i^k  \sigma(\sum_{j=1}^m \xi_{ij}^k u(x_j) + \theta_i^k) \sigma(w_k \cdot y + \zeta_k) \\\end{align*} \]</span></p><p>For a trunk net,</p><p><span class="math display">\[\begin{align*} t_k &amp;= \sigma(w_k \cdot y + \zeta_k) \in \mathbb{R} \\\{t_k\}_{k=1,...,p} &amp;= \{\sigma(w_k \cdot y + \zeta_k)\} \in \mathbb{R}^p \\\end{align*} \]</span></p><p>For one branch net (num of neuron = <span class="math inline">\(n\)</span>) , all coefficients are dependent on <span class="math inline">\(k\)</span>,</p><p><span class="math display">\[\begin{align*} b_k = \sum_{i=1}^n c_i^k  \sigma(\sum_{j=1}^m \xi_{ij}^k u(x_j) + \theta_i^k) \in \mathbb{R}\end{align*} \]</span></p>]]></content>
    
    
    <categories>
      
      <category>ML</category>
      
    </categories>
    
    
    <tags>
      
      <tag>PINN</tag>
      
      <tag>AI</tag>
      
      <tag>DeepONet</tag>
      
      <tag>ML</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ML | Automatic Differentiation</title>
    <link href="/2024/10/22/ML-Automatic-Differentiation/"/>
    <url>/2024/10/22/ML-Automatic-Differentiation/</url>
    
    <content type="html"><![CDATA[<p>In mathematics and computer algebra, automatic differentiation (auto-differentiation, autodiff, or AD), also called algorithmic differentiation, computational differentiation, is a set of techniques to evaluate the partial derivative of a function specified by a computer program.</p><p>Automatic differentiation exploits the fact that every computer calculation, no matter how complicated, executes a sequence of elementary arithmetic operations (addition, subtraction, multiplication, division, etc.) and elementary functions (exp, log, sin, cos, etc.). By applying the chain rule repeatedly to these operations, partial derivatives of arbitrary order can be computed automatically, accurately to working precision, and using at most a small constant factor of more arithmetic operations than the original program.</p><h1 id="references">References</h1><ol type="1"><li><a href="https://huggingface.co/blog/andmholm/what-is-automatic-differentiation">What's Automatic Differentiation?</a></li><li><a href="https://fancyerii.github.io/books/autodiff/">è‡ªåŠ¨å¾®åˆ†</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>ML</category>
      
    </categories>
    
    
    <tags>
      
      <tag>PINN</tag>
      
      <tag>AI</tag>
      
      <tag>DeepONet</tag>
      
      <tag>ML</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ML | Gaussian-Process (GP)</title>
    <link href="/2024/10/21/ML-Gaussian-Processes/"/>
    <url>/2024/10/21/ML-Gaussian-Processes/</url>
    
    <content type="html"><![CDATA[<p>In probability theory and statistics, a Gaussian process is a stochastic process (a collection of random variables indexed by time or space), such that every finite collection of those random variables has a multivariate normal distribution. The distribution of a Gaussian process is the joint distribution of all those (infinitely many) random variables, and as such, it is a distribution over functions with a continuous domain, e.g. time or space.</p><p>From the above derivation, you can view Gaussian process as a <strong>generalization of multivariate Gaussian distribution to infinitely many variables</strong>. Here we also provide the textbook definition of GP, in case you had to testify under oath:</p><div class="note note-warning">            <p>A Gaussian process is a collection of random variables, any finite number of which have consistent Gaussian distributions.</p>          </div><p><span class="math display">\[f(x) \sim \mathcal{G}\mathcal{P}(m(x), K(x, x&#39;))\]</span></p><div class="note note-warning">            <p>A Gaussian process is a probability distribution over possible functions that fit a set of points.</p>          </div><p>Just like a Gaussian distribution is specified by its mean and variance, a Gaussian process is completely defined by</p><ul><li><ol type="1"><li>a mean function <span class="math inline">\(m(x)\)</span> telling you the mean at any point of the input space and</li></ol></li><li><ol start="2" type="1"><li>a covariance function <span class="math inline">\(K(x,x&#39;)\)</span> that sets the covariance between points.</li></ol></li></ul><p>The mean can be any value and the covariance matrix should be positive definite.</p><p>The GP approach, in contrast, is a non-parametric approach, in that it finds a distribution over the possible functions <span class="math inline">\(f(x)\)</span> that are consistent with the observed data. As with all Bayesian methods it begins with a prior distribution and updates this as data points are observed, producing the posterior distribution over functions.</p><p><span class="math display">\[\begin{align}p(\mathbf{y} | \Sigma ) \approx \exp (-\frac{1}{2} \mathbf{y}^T \Sigma \mathbf{y})\end{align}\]</span></p><p><span class="math display">\[\Sigma (x_1, x_2) = K(x_1, x_2) + I \sigma_y^2\]</span></p><p>The covariance matrices in all the above examples are computed using the <strong>Radial Basis Function (RBF)</strong> kernel and <span class="math inline">\(\sigma_y\)</span> can be noise term.</p><ul><li>Here is an example of a 2D Gaussian distribution with mean 0, with the oval contours denoting points of constant probability.</li><li>we can now visualize the sampling operation in a new way by taking multiple "random points"</li><li>For conditioning, we can simply fix one of the endpoint on the index graph (in below plots, fix y1 to 1) and sample from y2</li></ul><div class="group-image-container"><div class="group-image-row"><div class="group-image-wrap"><img src="https://user-images.githubusercontent.com/18204038/60500191-ccc33380-9cb1-11e9-8f80-5b695d896000.png" alt="Here is an example of a 2D Gaussian distribution with mean 0, with the oval contours denoting points of constant probability." /></div><div class="group-image-wrap"><img src="https://user-images.githubusercontent.com/18204038/68397330-eba76a00-016a-11ea-9950-d1dec3ee1285.gif" alt="we can now visualize the sampling operation in a new way by taking multiple &quot;random points&quot;" /></div></div><div class="group-image-row"><div class="group-image-wrap"><img src="https://user-images.githubusercontent.com/18204038/68397339-ee09c400-016a-11ea-94c9-a3121f725deb.gif" alt="For conditioning, we can simply fix one of the endpoint on the index graph (in below plots, fix y1 to 1) and sample from y2" /></div><div class="group-image-wrap"><img src="https://user-images.githubusercontent.com/18204038/60500477-4f4bf300-9cb2-11e9-9a90-7fc316f64468.png" /></div></div><div class="group-image-row"><div class="group-image-wrap"><img src="https://user-images.githubusercontent.com/18204038/68397345-f235e180-016a-11ea-9ebb-a81bb34d2033.gif" /></div><div class="group-image-wrap"><img src="https://user-images.githubusercontent.com/18204038/68397346-f2ce7800-016a-11ea-96d2-cce9ee1c8116.gif" /></div></div></div><p>Conditional probability is,</p><p><span class="math display">\[\begin{align}P(A|B) = \frac{P(A \cap B)}{P(B)}\end{align}\tag{1}\]</span></p><h2 id="get-real-number">Get real number</h2><p>It feels like all the points on the x-axis have to be integers because they are indices, while in reality, we want to model observations with real values.</p><p>We can calculate this covariance matrix for any real-valued <span class="math inline">\(x_1\)</span> and <span class="math inline">\(x_2\)</span> by simply plugging them in. The real-valued x's effectively result in an infinite-dimensional Gaussian defined by the covariance matrix.</p><h1 id="useful-reading">Useful reading</h1><ul><li><a href="https://thegradient.pub/gaussian-process-not-quite-for-dummies/" class="uri">https://thegradient.pub/gaussian-process-not-quite-for-dummies/</a></li><li><a href="https://katbailey.github.io/post/gaussian-processes-for-dummies/" class="uri">https://katbailey.github.io/post/gaussian-processes-for-dummies/</a></li></ul><iframe width="560" height="315" src="https://www.youtube.com/embed/92-98SYOdlY?si=onEyPw4YKVl68G4p" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>]]></content>
    
    
    <categories>
      
      <category>ML</category>
      
    </categories>
    
    
    <tags>
      
      <tag>PINN</tag>
      
      <tag>AI</tag>
      
      <tag>DeepONet</tag>
      
      <tag>ML</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>NWP | ECMWF</title>
    <link href="/2024/10/18/ecmwf-introduction/"/>
    <url>/2024/10/18/ecmwf-introduction/</url>
    
    <content type="html"><![CDATA[<p>The organisation was <strong>established in 1975</strong> and now employs around 500 staff from more than 30 countries. ECMWF is one of the six members of the Co-ordinated Organisations, which also include the North Atlantic Treaty Organisation (NATO), the Council of Europe (CoE), the European Space Agency (ESA), the Organisation for Economic Co-operation and Development (OECD), and the European Organisation for the Exploitation of Meteorological Satellites (EUMETSAT).</p><p><strong>ECMWF is headquartered in Reading, UK, with additional sites in Bologna, Italy, and Bonn, Germany</strong>.</p><p>The European Centre for Medium-Range Weather Forecasts (ECMWF) is an independent intergovernmental organisation supported by most of the nations of Europe. It is based at three sites: Shinfield Park, Reading, United Kingdom; Bologna, Italy; and Bonn, Germany. It operates one of the largest supercomputer complexes in Europe and the world's largest archive of numerical weather prediction data.</p><h1 id="major-changes-introduced-with-cy48r1-spring-2023">Major changes introduced with Cy48r1 Spring 2023</h1><p><a href="https://confluence.ecmwf.int/display/FUG/Section+2.1.2+Model+Configurations">Some major changes were made to the IFS with the introduction of the Cy48r1 in Spring 2023.</a></p><p>After the introduction of Cy48r1 in Spring 2023 the:</p><p><strong>High Resolution (HRES)</strong>:</p><ul><li>is run four times daily:<ul><li>base times 00 UTC and 12 UTC, producing a 10 day forecast (T+0 to T+240).</li><li>base times 06UTC and 18UTC, producing a 3.75 day forecast (T+0 to T+90).</li></ul></li><li>has <strong>horizontal resolution of 9 km</strong> and vertical resolution of <strong>137</strong> model levels.</li></ul><p><strong>Medium range ensemble (ENS)</strong>:</p><ul><li>is run four times daily:<ul><li>base times 00 UTC and 12 UTC, producing a 10 day forecast (T+0 to T+240) and also a 15 day forecast (T+0 to T+360).</li><li>base times 06UTC and 18UTC, producing a 6 day forecast (T+0 to T+144). Results from these runs are:</li></ul></li><li>used in Early cut off analysis (SCDA) and Long window data analysis (LWDA).</li><li>disseminated T+0 to T+72.</li><li>has <strong>horizontal resolution of 9 km</strong> and vertical resolution of <strong>137</strong> model levels. These values are the same as those of the High Resolution (HRES).</li><li>has <strong>50 ensemble members</strong> plus an unperturbed control member (CTRL).</li><li>the unperturbed control member (CTRL) corresponds to the High Resolution (HRES) in earlier IFS versions. CTRL forecasts maintain continuity of output for users.</li></ul><p><strong>Extended range ensemble</strong>:</p><ul><li>is run once daily, base time 00 UTC, producing a 46 day forecast (Day0 to Day46).<ul><li>has <strong>horizontal resolution of 36 km</strong> and vertical resolution of <strong>137</strong> model levels.<br /></li><li>has <strong>100 members</strong> plus an unperturbed control member.</li></ul></li></ul><h1 id="ecmwf-ifs-9km-computing-resource-requirements-2024">ECMWF IFS 9km computing resource requirements (2024)</h1><ul><li><a href="https://mp.weixin.qq.com/s/Qu8JSdAMSJywmlCJM6QDzw" class="uri">https://mp.weixin.qq.com/s/Qu8JSdAMSJywmlCJM6QDzw</a><ul><li>æ ¹æ®ECMWFå®˜ç½‘â€œHow to optimise the computing aspects of numerical weather forecastsâ€æ–‡ç« , IFS 9kmæ¨¡å¼é¢„æŠ¥15å¤©éœ€è¦å¤§çº¦50ä¸ªè®¡ç®—èŠ‚ç‚¹</li><li>æ¨ç®—IFSé¢„æŠ¥ä¸€å¤©èƒ½å¤Ÿåœ¨3.6åˆ†é’Ÿå¢™é’Ÿæ—¶é—´å†…å®Œæˆã€‚</li><li>IFSè¿è¡Œè®¡ç®—æœºåº”è¯¥æ˜¯åšæ´›å°¼äºšè®¡ç®—ä¸­å¿ƒæœºå™¨ï¼Œæ¯ä¸ªè®¡ç®—èŠ‚ç‚¹ä¸º128æ ¸å¿ƒï¼Œæ€»è®¡ç®—èµ„æºæ•°å¤§æ¦‚åœ¨6784æ ¸å·¦å³ã€‚</li></ul></li></ul>]]></content>
    
    
    <categories>
      
      <category>NWP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NWP</tag>
      
      <tag>WRF</tag>
      
      <tag>MPAS</tag>
      
      <tag>ECMWF</tag>
      
      <tag>AI</tag>
      
      <tag>ML</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>LaTex | Figures</title>
    <link href="/2024/10/17/latex-figure-format/"/>
    <url>/2024/10/17/latex-figure-format/</url>
    
    <content type="html"><![CDATA[<h1 id="figuresgraphics">Figures/Graphics</h1><h2 id="vector-files.">Vector files.</h2><p>Mathematical formulas establish points on a grid to build vector images. Versatility is key for vector files because they can adjust in size countless times without losing resolution. Thatâ€™s great for images that need to be regularly resized. Learn more about vector files: <strong>SVG files, STL files, EPS files.</strong></p><h2 id="raster-files.">Raster files.</h2><p>A raster image file is comprised of a fixed number of color pixels. This means if the file is resized, its resolution could be compromised. Most images found online and in print are raster image files, which can be opened with many programs. Read more about raster files: <strong>GIF files, PNG files, JPEG files.</strong></p><h2 id="what-is-all-this-important">What is all this important?</h2><p>Graphics are different from text fonts, they can't be handled by TeX's font mechanisms; instead, there are special LaTeX packages to deal with them. But, like fonts, there's still a fundamental difference between device-independent or vector graphics (like PostScript drawings) and raster graphics, which are resolution- or device-dependent. Different mechanisms (and different packages) are needed to include the different kinds of graphic files.</p><p>Because the graphicx package used with the</p><ul><li><strong>latex command</strong> requires all graphics to be in <strong>EPS format</strong>;</li><li><strong>pdflatex command</strong>, perversely, requires graphics to be <strong>either JPEG, TIFF, PNG, or PDF â€” but not EPS</strong>.</li></ul><p>So if you compile your LaTeX source file with the latex command, you'll have to convert any non-EPS files to EPS format.</p><div class="note note-warning">            <p><strong>But, if you use pdflatex, you'll have to convert any EPS files to either PNG or (preferably) PDF format.</strong></p>          </div><h2 id="in-latex">In LaTex,</h2><figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs latex"><span class="hljs-keyword">\usepackage</span>&#123;float&#125;<br><span class="hljs-keyword">\usepackage</span>&#123;graphicx&#125;<br><br><span class="hljs-keyword">\begin</span>&#123;figure&#125;[H]<br><span class="hljs-keyword">\centering</span><br><span class="hljs-keyword">\includegraphics</span>[scale=0.5]&#123;universe&#125;<br><span class="hljs-comment">%\includegraphics[width=\textwidth]&#123;universe&#125;</span><br><span class="hljs-comment">%\includegraphics[scale=1.2, angle=45]&#123;universe&#125;</span><br><span class="hljs-keyword">\caption</span>&#123;The Universe&#125;<br><span class="hljs-keyword">\label</span>&#123;fig:universe&#125;<br><span class="hljs-keyword">\end</span>&#123;figure&#125;<br></code></pre></td></tr></table></figure><table><thead><tr class="header"><th>Parameter</th><th>Action</th></tr></thead><tbody><tr class="odd"><td>H</td><td>Place exactly at spot in source text</td></tr><tr class="even"><td>h</td><td>Place approximately at spot in source test</td></tr><tr class="odd"><td>t</td><td>Place at top of page</td></tr><tr class="even"><td>b</td><td>Place at bottom of page</td></tr><tr class="odd"><td>p</td><td>Place on page for floats only</td></tr><tr class="even"><td>!</td><td>Override internal LaTeX parameters for determining float position</td></tr></tbody></table><h2 id="high-quality-images">High quality images</h2><div class="note note-warning">            <p>Warning! Notice that this picture looks pixelated, especially at this scale. One must be careful to use high enough quality images. Preferable are <strong>vectorized graphics</strong> which will scale without pixelation.</p>          </div><div class="note note-warning">            <p><strong>Save as .pdf</strong></p>          </div><figure><img src="https://i.imgur.com/3zjwQQS.jpeg" alt="Difference between .png and .pdf (zoom in 500%). For printing purposes, the best file pdf format to use is a PDF." /><figcaption>Difference between .png and .pdf (zoom in 500%). For printing purposes, the best file pdf format to use is a PDF.</figcaption></figure><h2 id="subfigures">Subfigures</h2><ul><li><a href="https://www1.cmc.edu/pages/faculty/aaksoy/latex/latexfive.html" class="uri">https://www1.cmc.edu/pages/faculty/aaksoy/latex/latexfive.html</a></li></ul><p>When one wants to put multiple subfigures inside a subfigure, one must use two packages, <strong>caption and subcaption</strong>. There are other packages such as <em>subfigure and subfig, however, these are no longer considered standard</em>.</p><p>Try the code below to see three subfigures within a figure, each with a separate caption in addition to a global caption.</p><figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs latex"><span class="hljs-keyword">\documentclass</span>&#123;article&#125;<br><span class="hljs-keyword">\usepackage</span>&#123;float&#125;<br><span class="hljs-keyword">\usepackage</span>&#123;graphicx&#125;<br><span class="hljs-keyword">\usepackage</span>&#123;caption&#125;<br><span class="hljs-keyword">\usepackage</span>&#123;subcaption&#125;<br><br><span class="hljs-keyword">\begin</span>&#123;document&#125;<br><span class="hljs-keyword">\begin</span>&#123;figure&#125;[H]<br><span class="hljs-keyword">\centering</span><br><span class="hljs-keyword">\begin</span>&#123;subfigure&#125;&#123;.3<span class="hljs-keyword">\textwidth</span>&#125;<br><span class="hljs-keyword">\includegraphics</span>[width=<span class="hljs-keyword">\textwidth</span>]&#123;atom.png&#125;<br><span class="hljs-keyword">\caption</span>&#123;Atom 1&#125;<br><span class="hljs-keyword">\end</span>&#123;subfigure&#125;<br><span class="hljs-comment">%%%%%%%%%%%%%%</span><br><span class="hljs-keyword">\begin</span>&#123;subfigure&#125;&#123;.3<span class="hljs-keyword">\textwidth</span>&#125;<br><span class="hljs-keyword">\includegraphics</span>[width=<span class="hljs-keyword">\textwidth</span>]&#123;atom.png&#125;<br><span class="hljs-keyword">\caption</span>&#123;Atom 2&#125;<br><span class="hljs-keyword">\end</span>&#123;subfigure&#125;<br><span class="hljs-comment">%%%%%%%%%%%%%%</span><br><span class="hljs-keyword">\begin</span>&#123;subfigure&#125;&#123;.3<span class="hljs-keyword">\textwidth</span>&#125;<br><span class="hljs-keyword">\includegraphics</span>[width=<span class="hljs-keyword">\textwidth</span>]&#123;atom.png&#125;<br><span class="hljs-keyword">\caption</span>&#123;Atom 3&#125;<br><span class="hljs-keyword">\end</span>&#123;subfigure&#125;<br><span class="hljs-keyword">\caption</span>&#123;Atoms are fun!&#125;<br><span class="hljs-keyword">\end</span>&#123;figure&#125;<br><span class="hljs-keyword">\end</span>&#123;document&#125;<br></code></pre></td></tr></table></figure><h2 id="wrapping-text-around-figures">Wrapping text around figures</h2><ul><li><a href="https://www.overleaf.com/learn/latex/Inserting_Images" class="uri">https://www.overleaf.com/learn/latex/Inserting_Images</a></li></ul><p>For the commands in the example to work, you have to import the <strong>wrapfig</strong> package. To use <strong>wrapfig</strong>, include the following line in the document preamble:</p><figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs latex"><span class="hljs-keyword">\usepackage</span>&#123;wrapfig&#125;<br></code></pre></td></tr></table></figure><p>This makes the wrapfigure environment available and we can place an \includegraphics command inside it to create a figure around which text will be wrapped. Here is how we can specify a wrapfigure environment:</p><figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs latex"><span class="hljs-keyword">\begin</span>&#123;wrapfigure&#125;[lineheight]&#123;position&#125;&#123;width&#125;<br>  ...<br><span class="hljs-keyword">\end</span>&#123;wrapfigure&#125;<br></code></pre></td></tr></table></figure><table><thead><tr class="header"><th>Specifier</th><th>Specifier</th><th>Actioin</th></tr></thead><tbody><tr class="odd"><td>r</td><td>R</td><td>right side of the text</td></tr><tr class="even"><td>l</td><td>L</td><td>left side of the text</td></tr><tr class="odd"><td>i</td><td>I</td><td>inside edgeâ€“near the binding (in a twoside document)</td></tr><tr class="even"><td>o</td><td>O</td><td>outside edgeâ€“far from the binding</td></tr></tbody></table><p><strong>The uppercase version allows the figure to float. The lowercase version means exactly here.</strong></p><p>It's also possible to wrap the text around a figure. When the document contains small pictures this makes it look better.</p><figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs latex"><span class="hljs-keyword">\begin</span>&#123;wrapfigure&#125;&#123;r&#125;&#123;0.25<span class="hljs-keyword">\textwidth</span>&#125; <span class="hljs-comment">%this figure will be at the right</span><br>    <span class="hljs-keyword">\centering</span><br>    <span class="hljs-keyword">\includegraphics</span>[width=0.25<span class="hljs-keyword">\textwidth</span>]&#123;mesh&#125;<br><span class="hljs-keyword">\end</span>&#123;wrapfigure&#125;<br><br>There are several ways to plot a function of two variables, <br>depending on the information you are interested in. For <br>instance, if you want to see the mesh of a function so it <br>easier to see the derivative you can use a plot like the <br>one on the left.<br></code></pre></td></tr></table></figure><figure><img src="https://sharelatex-wiki-cdn-671420.c.cdn77.org/learn-scripts/images/a/ac/InsertingImagesEx8Overleaf.png" alt="Wrapping text around figures" /><figcaption>Wrapping text around figures</figcaption></figure><h1 id="journals-graphics-requirements">Journals | Graphics Requirements</h1><h2 id="american-geophysical-union-agu">American Geophysical Union (AGU)</h2><ul><li>https://www.agu.org/publications/authors/journals/text-graphics-requirements#figures</li></ul><p>Figures</p><p>AGU recommends that figures be prepared in one of the following formats:</p><ul><li><strong>JPG, TIFF, EPS, PS or PDF. </strong></li></ul><p>Figures should be embedded in the main manuscript for submission but uploaded separately at resubmission or revision (because separate files are needed for production). For revision, each figure file must be complete and contain all parts of a single numbered figure. In other words, a figure with multiple parts must be consolidated into a single cohesive file. Do not include figure captions or figure titles (e.g., â€œFigure 1â€) as any part of the graphic itself. Separate files for different parts of a figure cannot be accommodated.</p><h1 id="references">References</h1><ol type="1"><li><a href="https://www.adobe.com/hk_zh/creativecloud/file-types/image/vector/ps-file.html">PS æª”æ¡ˆ</a><ol type="1"><li><strong>PS ä»£è¡¨ PostScriptï¼Œæ˜¯ä¸€ç¨®å‘é‡åœ–å½¢æª”æ¡ˆ</strong>ã€‚å…¶ç‰¹é»æ˜¯å¯ä»¥å°‡æ•¸ä½åœ–å½¢å’Œæ–‡å­—å‚™å¦¥é€²è¡Œåˆ—å°ã€‚æ‚¨å¯ä»¥å°‡ PS æª”æ¡ˆç›´æ¥å‚³é€è‡³å°è¡¨æ©Ÿï¼Œè€Œç„¡éœ€ä½¿ç”¨æ‡‰ç”¨ç¨‹å¼é–‹å•Ÿæª”æ¡ˆã€‚ä¸éï¼Œåªæœ‰ç‚ºæ•¸ä¸å¤šçš„é¸é …å¯ä»¥é–‹å•Ÿ PS æª”æ¡ˆï¼Œä½¿å…¶æˆç‚ºå½±åƒæ–¹é¢åŠŸèƒ½æœ€å°‘çš„æª”æ¡ˆé¡å‹ä¹‹ä¸€ã€‚ç”±æ–¼ PS æª”æ¡ˆæ¯”éƒ¨åˆ†ç›¸é—œæª”æ¡ˆé¡å‹ç¨èˆŠï¼Œä½¿ç”¨è€…ç¶“å¸¸å°‡ PS æª”æ¡ˆè½‰æ›æˆ PDFï¼Œè®“è™•ç†å·¥ä½œæ›´ç°¡å–®æµæš¢ã€‚Adobe åœ¨ 1980 å¹´ä»£é–‹ç™¼ PS æª”æ¡ˆï¼Œå”åŠ©é›»è…¦ä½¿ç”¨è€…è¼•é¬†å°‡æ–‡å­—å’Œåœ–å½¢è½‰æ›æˆå°åˆ·å‰¯æœ¬ã€‚é€™åœ¨ç•¶æ™‚æ˜¯ä¸€å¤§å‰µèˆ‰ï¼Œå°æ–¹æ‰èŒèŠ½çš„æ¡Œé¢æ’ç‰ˆ (Desktop Publishingï¼ŒDTP) ç”¢æ¥­ä¾†èªªæ›´æ˜¯å¦‚æ­¤ã€‚å› æ­¤ï¼Œç•¶æ—©æœŸçš„ Apple å°è¡¨æ©Ÿæ­è¼‰ PostScript åŠŸèƒ½æ™‚ï¼ŒDTP åœ¨å…¨çƒå‡ºç¾çˆ†ç‚¸æ€§æˆé•·ï¼Œè¨˜è€…ã€å­¸ç”Ÿå’Œæ¥­é¤˜æ„›å¥½è€…éƒ½å¯ä»¥å°‡æ‰‹å‹•æ‰“å­—çš„ç¨¿ä»¶è½‰åŒ–æˆä»¤äººè€³ç›®ä¸€æ–°çš„å‡ºç‰ˆå“ã€‚ç¾åœ¨ï¼Œé™¤äº†å°ˆé–€å‡ºç‰ˆå“ä¹‹å¤–ï¼Œå‡ºç‰ˆå“ç›´æ¥åœ¨ç¶²è·¯ä¸Šç™¼è¡Œçš„æ¯”ç‡å·²è¶…è¶Šå°åˆ·å½¢å¼ï¼Œä½¿å¾— PS æª”æ¡ˆæ ¼å¼ä¸å†åƒä»¥å¾€æ™®éä½¿ç”¨ã€‚ä¸éï¼Œä½œç‚ºåœ–å½¢æ ¼å¼ï¼ŒPS ä»æ˜¯æœ€ç›´è¦ºæ˜“ç”¨çš„æª”æ¡ˆé¡å‹ä¹‹ä¸€ã€‚</li><li><strong>PDF åœ¨ç¶²è·¯å’Œå°åˆ·é ˜åŸŸä¸Šï¼Œæ˜¯ PS æª”æ¡ˆæœ€å»£å—æ”¯æ´çš„ä¸‹ä¸€ä»£æª”æ¡ˆ</strong>ã€‚</li><li>å‚³çµ±çš„çš„æ–‡ä»¶æ…£ç”¨ PS æˆ– EPS åœ–æª”ï¼Œé€™ç¨®æ‰€è¬‚çš„ã€Œæé‚Šåœ–æª”ã€éå¸¸é©åˆæ•¸å­¸æˆ–çµ±è¨ˆåœ–ï¼Œå¯ä»¥ç‚ºåœ–å½¢åŠ ä¸Šæ–‡å­—æˆ–å…¶ä»–ç·šæ¢ï¼Œæª”æ¡ˆå°è€Œä¸”æ¸…æ™°ï¼Œç·¨è­¯å®Œæˆçš„æª”æ¡ˆä¹Ÿæ˜¯ PS æª”ï¼ˆè¿‘å¹´ä¾†é€æ¼¸æ”¹æˆ PDF æª”ï¼Œä»¥åˆ©ç¶²è·¯å‚³è¼¸ï¼‰ã€‚å› ç‚ºç¶²è·¯èˆˆèµ·åŠå¤šåª’é«”çš„è¡¨ç¾æ—¥æ¼¸é‡è¦ï¼Œæ‰æœ‰å£“ç¸®åœ–æª”çš„å‡ºç¾ï¼Œå…¶ä¸­ä»¥ JPG åœ–æª”æœ€ç‚ºæµè¡Œï¼Œé©åˆå„ç¨®éœæ…‹åœ–å½¢ã€‚</li></ol></li><li><a href="https://www.adobe.com/hk_zh/creativecloud/file-types/image/vector/eps-file.html">EPS æª”æ¡ˆ</a><ol type="1"><li>å£“ç¸®å¼ PostScript (Encapsulated PostScript) æ–¼ 1980 å¹´ä»£æ™šæœŸç”± Adobe æ¨å‡ºå¾Œï¼Œä¾¿æˆç‚ºè¨­è¨ˆç”¢æ¥­æ—©æœŸé¸ç”¨çš„å½±åƒæ ¼å¼ã€‚æ­¤æ ¼å¼çš„è¨­è¨ˆå®—æ—¨æ˜¯å”åŠ©å½±åƒå’Œæ’åœ–èˆ‡ä½”æœ‰ä¸»è¦æ¯”é‡çš„æ–‡å­—å‰µä½œç›¸æ•´åˆã€‚</li><li><strong>é›–ç„¶ EPS æª”æ¡ˆå¤§å¤šå·²ç”± PDF ç­‰æ›´æ–°çš„æª”æ¡ˆæ ¼å¼å–ä»£</strong>ï¼Œé€™ç¨®å¹¾ä¹ç›¸å®¹æ–¼æ‰€æœ‰ç³»çµ±å’Œè»Ÿé«”çš„èˆŠç‰ˆæ ¼å¼ä»å…·å‚™å¯¦ç”¨æ€§ã€‚</li><li><strong>PDF å¯ç·¨è¼¯ä¸”ç›¸å®¹æ–¼æ›´å¤šä½œæ¥­ç³»çµ±</strong>ã€‚ä½†æ˜¯ï¼Œå¦‚æœæ‚¨ä½¿ç”¨è¼ƒèˆŠçš„åˆ—å°è£ç½®ï¼Œå¯èƒ½æœƒç™¼ç¾ EPS æ˜¯æ›´ç†æƒ³çš„é¸æ“‡ã€‚</li></ol></li><li><a href="https://www.adobe.com/hk_zh/creativecloud/file-types/image/vector/svg-file.html">SVG æª”æ¡ˆ</a><ol type="1"><li>å¯ç¸®æ”¾å‘é‡åœ–å½¢ (SVG) æ˜¯ä¸€ç¨®é©åˆç¶²é ä½¿ç”¨çš„<strong>å‘é‡æª”æ¡ˆæ ¼å¼</strong>ã€‚èˆ‡ JPEG ç­‰åƒç´ å‹é»é™£æª”æ¡ˆæœ‰æ‰€ä¸åŒï¼Œå‘é‡æª”æ¡ˆæ˜¯é€éä»¥ç¶²æ ¼é»ç·šç‚ºåŸºç¤çš„æ•¸å­¸å…¬å¼å„²å­˜å½±åƒã€‚é€™è¡¨ç¤º SVG <strong>é€™é¡å‘é‡æª”å¯ä»¥å¤§å¹…èª¿æ•´å°ºå¯¸å»ä¸æœƒæå¤±å“è³ª</strong>ï¼Œ<strong>å› æ­¤å¾ˆé©åˆç”¨æ–¼æ¨™èªŒåŠè¤‡é›œçš„ç·šä¸Šåœ–å½¢</strong>ã€‚</li><li>SVG æª”æ¡ˆçš„æ­·å²å¯è¿½æº¯åˆ° 1990 å¹´ä»£æ™šæœŸï¼Œå…¨çƒè³‡è¨Šç¶²å”æœƒ (W3C) æ›¾é‚€è«‹é–‹ç™¼äººå“¡é‡å°æ–°çš„å‘é‡åœ–å½¢æ ¼å¼ææ¡ˆã€‚ç•¶æ™‚å”æœƒæ”¶åˆ°å…­é …ææ¡ˆï¼Œæœ€å¾ŒæˆåŠŸå”åŠ© W3C æ¨å‡º SVG æ ¼å¼ã€‚</li><li>SVG èŠ±äº†ä¸€æ®µæ™‚é–“ç´¯ç©çŸ¥ååº¦ã€‚é€™ç¨®æ ¼å¼åœ¨éå»é®®å°‘äººä½¿ç”¨ï¼›ç›´åˆ° 2017 å¹´ï¼Œäººå€‘ç™¼ç¾åœ¨æ–°å‹ç¶²é ç€è¦½å™¨ä¸Šä½¿ç”¨ SVG çš„å¥½è™•ï¼Œé€™ç¨®æ ¼å¼æ‰é€æ¼¸å—åˆ°æ­¡è¿ã€‚ç¾åœ¨ï¼ŒSVG å·²å»£æ³›ç”¨æ–¼ 2D ç¶²ç«™å½±åƒï¼Œå› ç‚ºå¤§å¤šæ•¸ä½¿ç”¨å‘é‡æª”æ¡ˆçš„ç€è¦½å™¨å’Œç¹ªåœ–æ‡‰ç”¨ç¨‹å¼éƒ½å¯è¼•é¬†è™•ç†æ­¤æª”æ¡ˆæ ¼å¼ã€‚</li></ol></li><li><a href="https://www.adobe.com/hk_zh/creativecloud/file-types/image/raster/tiff-file.html">TIFF æª”æ¡ˆ</a><ol type="1"><li>TIFF ä»£è¡¨æ¨™ç±¤å½±åƒæª”æ¡ˆæ ¼å¼ (Tag Image File Format)ï¼Œæ˜¯ä¸€ç¨®ç”¨æ–¼å„²å­˜é»é™£åœ–å½¢å’Œå½±åƒè³‡è¨Šçš„é›»è…¦æª”æ¡ˆã€‚TIFF æ˜¯æ”å½±å¸«åå¥½ä½¿ç”¨çš„æ ¼å¼ã€‚å¦‚æœæ‚¨æƒ³é¿å…å¤±çœŸæª”æ¡ˆæ ¼å¼ï¼ŒTIFF ä¾¿æ˜¯ç·¨è¼¯ä½œæ¥­å‰ç›¸ç•¶æ˜“ç”¨çš„é«˜å“è³ªå½±åƒå„²å­˜æ ¼å¼ã€‚</li><li><strong>æ˜¯ä¸€ç¨®ä¸å¤±çœŸçš„æª”æ¡ˆå£“ç¸®å½¢å¼ï¼Œé€™è¡¨ç¤ºå…¶æª”æ¡ˆå¤§å°æ¯”å¤šæ•¸åŒé¡æª”æ¡ˆä¾†å¾—å¤§ï¼Œä½†å½±åƒå“è³ªä¸æœƒå—æ</strong>ã€‚</li><li>Aldus Corporation æ–¼ 1980 å¹´ä»£ä¸­æœŸæ¨å‡º TIFF æª”æ¡ˆæ ¼å¼ï¼Œç”¨æ–¼æ¡Œé¢æ’ç‰ˆã€‚TIFF ä¸åƒ…èƒ½ä¿ç•™é«˜å“è³ªè³‡æ–™ï¼Œä¹Ÿå¯ä»¥ç›´æ¥å¾é›»è…¦ç™¼å¸ƒå…§å®¹ã€‚é€™ç¨®æª”æ¡ˆè¨­è¨ˆæˆæ¡Œä¸Šå‹æƒæå™¨çš„é€šç”¨æ ¼å¼ï¼›è€Œä¹‹å‰çš„ä½œæ¥­ç¡¬é«” (è¦–å“ç‰Œå’Œå‹è™Ÿè€Œå®š) åªæ”¯æ´æ•¸é‡æœ‰é™çš„æª”æ¡ˆæ ¼å¼ã€‚</li></ol></li><li><a href="https://www.adobe.com/hk_zh/creativecloud/file-types/image/raster/png-file.html">PNG æª”æ¡ˆ</a><ol type="1"><li>PNG çš„å…¨åç‚ºå¯æ”œå¼ç¶²è·¯åœ–å½¢ (Portable Network Graphic)ï¼Œæ˜¯ä¸€ç¨®é»é™£å½±åƒæª”æ¡ˆã€‚å› ç‚º PNG æª”æ¡ˆé¡å‹èƒ½å¤ è™•ç†æœ‰é€æ˜æˆ–åŠé€æ˜èƒŒæ™¯çš„åœ–å½¢ï¼Œå› æ­¤ç‰¹åˆ¥å—åˆ°ç¶²é è¨­è¨ˆå¸«çš„å–œæ„›ã€‚æ­¤æª”æ¡ˆæ ¼å¼æœªç”³è«‹å°ˆåˆ©ï¼Œå› æ­¤å¯ä½¿ç”¨ä»»ä½•å½±åƒç·¨è¼¯è»Ÿé«”é–‹å•Ÿ PNG æª”æ¡ˆï¼Œè€Œç„¡éœ€å–å¾—æˆæ¬Šã€‚</li><li>PNG å½±åƒæ ¼å¼åœ¨ 1995 å¹´æ¨å‡ºï¼Œç”± IT å°ˆå®¶ Oliver Fromme å–åç‚º PINGï¼Œéš¨å¾Œç¸®çŸ­ç‚º PNGã€‚</li><li>PNG çš„ç™¼å±•å‚³æ‰¿è‡ª GIF æ ¼å¼ï¼Œé€™ç¨®æ ¼å¼åœ¨ PNG é¦–åº¦æ¨å‡ºæ™‚å·²å­˜åœ¨å…«å¹´ã€‚GIF æœ‰å¹¾é …ç¼ºé»ï¼Œåƒæ˜¯éœ€è¦å°ˆåˆ©æˆæ¬Šã€è‰²å½©ç¨®é¡æœ‰é™ (åƒ… 256 è‰²)ï¼Œå°è‡´ç™¼å±•é€Ÿåº¦ç„¡æ³•è·Ÿä¸Šä¸æ–·é€²æ­¥çš„é›»è…¦è¢å¹•è§£æåº¦ã€‚ç‚ºäº†é¿å…é€™é¡å•é¡Œï¼ŒPNG æª”æ¡ˆæ¡ç”¨ç„¡å°ˆåˆ©è¨­è¨ˆï¼Œä¸¦æä¾›æ›´åŠ è±å¯Œçš„è‰²å½©é¸æ“‡ã€‚èˆ‡ GIF ä¸åŒçš„æ˜¯ï¼ŒPNG æ˜¯å–®ä¸€å½±åƒæ ¼å¼ï¼Œä¸æ”¯æ´å‹•ç•«ã€‚</li></ol></li><li><a href="https://www.adobe.com/hk_zh/creativecloud/file-types/image/raster/gif-file.html">GIF æª”æ¡ˆ</a><ol type="1"><li>GIF ä»£è¡¨åœ–å½¢äº¤æ›æ ¼å¼ (Graphics Interchange Format)ã€‚GIF æ˜¯ä¸€ç¨®é»é™£æª”æ¡ˆæ ¼å¼ï¼Œå°ˆç‚ºä¸»è¦å‡ºç¾åœ¨ç¶²éš›ç¶²è·¯ä¸Šçš„è¼ƒåŸºæœ¬å½±åƒæ‰€è¨­è¨ˆã€‚<strong>æ¯å€‹æª”æ¡ˆæœ€å¤šå¯æ”¯æ´æ¯å€‹åƒç´  8 ä½å…ƒ</strong>ï¼Œè€Œä¸”å¯åŒ…å« 256 ç¨®ç´¢å¼•é¡è‰²ã€‚<strong>GIF æª”æ¡ˆä¹Ÿå…è¨±åˆä½µå½±åƒæˆ–å½±æ ¼ï¼Œä»¥å»ºç«‹åŸºæœ¬å‹•ç•«</strong>ã€‚</li><li>GIF æª”æ¡ˆæ ¼å¼æ˜¯ç”±é›»è…¦ç§‘å­¸å®¶ Steve Wilhite å’Œä»–åœ¨ç¾åœ‹ç§‘æŠ€å…¬å¸ CompuServe çš„åœ˜éšŠæ–¼ 1987 å¹´ 6 æœˆæ‰€æ‰“é€ çš„ã€‚</li><li>GIF æª”æ¡ˆå·²é€²åŒ–æˆèƒ½å¤ æä¾›æ›´å¤š<strong>å‹•ç•«åŠŸèƒ½</strong>ã€‚ä¾‹å¦‚ï¼Œ1995 å¹´ Netscape Navigator ç€è¦½å™¨å•ä¸–ä¹‹å¾Œï¼Œå‰µä½œè€…ç²å¾—äº†å¾ªç’°æ’­æ”¾ GIF å‹•ç•«çš„èƒ½åŠ›ã€‚Facebook åœ¨ 2015 å¹´é–‹å§‹æ”¯æ´ GIFï¼ŒInstagram å‰‡æ˜¯åœ¨ 2018 å¹´é–‹å§‹æ”¯æ´ã€‚</li></ol></li><li><a href="https://www.adobe.com/hk_zh/creativecloud/file-types/image/raster/jpeg-file.html">JPEG æª”æ¡ˆ</a><ol type="1"><li>JPEG ä»£è¡¨è¯åˆåœ–åƒå°ˆå®¶å°çµ„ (Joint Photographic Experts Group)ï¼Œé€™å€‹åœ‹éš›çµ„ç¹”åœ¨ 1980 å¹´ä»£æœ«å’Œ 1990 å¹´ä»£åˆå°æ­¤æ ¼å¼é€²è¡Œäº†æ¨™æº–åŒ–ã€‚è‡ªå¾æ”å½±å¸«é–‹å§‹åœ¨æ•¸ä½ç›¸æ©Ÿå’Œå…¶ä»–è¤‡å°è¨­å‚™ä¸Šæ‹æ”åŠå„²å­˜å½±åƒä»¥ä¾†ï¼ŒJPEG å°±ä¸€ç›´æ˜¯æ•¸ä½å½±åƒçš„é¦–é¸æª”æ¡ˆæ ¼å¼ã€‚</li><li>åœ¨ 1986 å¹´ï¼Œé¡¯ç¤ºå™¨æŠ€è¡“é‚„ç„¡æ³•ç”¢ç”Ÿè¢å¹•ä¸Šçš„åœ–å½¢ã€‚å°±åœ¨é‚£æ™‚å€™ï¼Œä¸€å€‹ç¨±ç‚ºåœ‹éš›æ¨™æº–åŒ–çµ„ç¹” (ISO) çš„åœ˜éšŠé–‹å§‹ç ”ç©¶å¦‚ä½•å°‡é€¼çœŸçš„åœ–ç‰‡å¸¶åˆ°ä¸–ç•Œå„åœ°çš„å°è¢å¹•ä¸Šã€‚</li><li><strong>å¤±çœŸå£“ç¸®å¯èƒ½æœƒç¯€çœç©ºé–“ï¼Œä½†æ˜¯åœ¨è™•ç†é«˜åº¦å£“ç¸®çš„å½±åƒæ™‚ï¼Œå“è³ªæœƒå—åˆ°å½±éŸ¿</strong>ã€‚å…·æœ‰æ¸…æ™°é‚Šç·£å’Œç·šæ¢çš„å½±åƒåœ¨å£“ç¸®å¾Œæœƒå¤±å»ä¸€äº›æ¸…æ™°åº¦ã€‚</li><li>åš´è¬¹çš„æ”å½±å¸«ä»ç„¶ä¸é¡˜ä»¥ JPEG æ ¼å¼æ‹æ”ï¼Œå› ç‚ºä»–å€‘æƒ³è¦ä¿ç•™æ‰€æœ‰å½±åƒç´°ç¯€ä»¥ä¾›å¾Œè£½è™•ç†æˆ–åˆ—å°ä½¿ç”¨ã€‚ä¸éï¼Œé€™ç¨®æª”æ¡ˆæ ¼å¼ä»ç„¶æ˜¯ä¸»æµäººå£«çš„æœ€æ„›ã€‚</li></ol></li></ol>]]></content>
    
    
    <categories>
      
      <category>LaTex</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>LaTex | Overview</title>
    <link href="/2024/10/17/latex-intro/"/>
    <url>/2024/10/17/latex-intro/</url>
    
    <content type="html"><![CDATA[<h1 id="latex">LaTeX</h1><p>LaTeX is a software system for typesetting documents. LaTeX is widely used in academia for the communication and publication of <strong>scientific documents and technical note-taking in many fields</strong>, owing partially to its support for complex mathematical notation. It also has a prominent role in the preparation and publication of books and articles that contain complex multilingual materials, such as Arabic and Greek. The typesetting system offers programmable desktop publishing features and extensive facilities for automating most aspects of typesetting and desktop publishing, including numbering and cross-referencing of tables and figures, chapter and section headings, graphics, page layout, indexing and bibliographies.</p><h1 id="texmaker">Texmaker</h1><ul><li><a href="https://www.xm1math.net/texmaker/" class="uri">https://www.xm1math.net/texmaker/</a></li></ul><p>Texmaker is a free and open-source LaTeX editor with an integrated PDF viewer compatible with Linux, macOS, and Windows. Written entirely as a Qt app, it features many tools needed to develop documents with LaTeX.</p><p>Texmakeræ˜¯ä¸€æ¬¾è·¨å¹³å°çš„é–‹æºLaTeXç·¨è¼¯å™¨ï¼Œå®ƒä»‹é¢ä¹¾æ·¨ä½µé›†æˆæœ‰PDFé–±è®€å™¨ã€‚</p><ul><li>Texmaker is a free, modern and cross-platform LaTeX editor for linux, macosx and windows systems that integrates many tools needed to develop documents with LaTeX, in just one application.</li><li>Texmaker includes unicode support, spell checking, auto-completion, code folding and a built-in pdf viewer with synctex support and continuous view mode.</li><li>Texmaker is easy to use and to configure.</li><li>Texmaker is released under the GPL license .</li></ul><figure><img src="https://upload.wikimedia.org/wikipedia/commons/6/66/TeXmaker_Interface.png" alt="TeXmaker interface" /><figcaption>TeXmaker interface</figcaption></figure><h1 id="overleaf">Overleaf</h1><ul><li><a href="https://www.overleaf.com/" class="uri">https://www.overleaf.com/</a></li></ul><div class="note note-warning">            <p>Overleafæ˜¯ä¸€å€‹é›²ç«¯å”ä½œå¼LaTeXç·¨è¼¯å™¨ï¼Œå¯ç”¨æ–¼ç·¨å¯«å’Œç™¼ä½ˆè«–æ–‡</p>          </div><p>Overleafæ˜¯ä¸€å€‹é›²ç«¯å”ä½œå¼LaTeXç·¨è¼¯å™¨ï¼Œå¯ç”¨æ–¼ç·¨å¯«å’Œç™¼ä½ˆè«–æ–‡ã€‚é€™ä¸€ç·¨è¼¯å™¨èˆ‡å¾ˆå¤šç§‘å­¸é›œèªŒå‡ºç‰ˆå•†æœ‰åˆä½œé—œä¿‚ï¼Œä¸ä½†æä¾›å®˜æ–¹æœŸåˆŠçš„LaTeXæ¨¡æ¿ï¼Œé‚„èƒ½ç›´æ¥å°‡æ–‡ä»¶æäº¤è‡³é€™äº›å‡ºç‰ˆç¤¾ã€‚Overleafç”±2011å¹´å…©åæ•¸å­¸å®¶John Hammersleyå’ŒJohn Lees-Millerå…±åŒå»ºç«‹çš„å…¬å¸WriteLaTeX Limitedé–‹ç™¼ï¼Œä»–å€‘æ†‘è—‰è‡ªå·±åœ¨å­¸è¡“ç•Œçš„ç¶“é©—é–‹ç™¼äº†é€™ä¸€å¹³å°ï¼Œå› æ­¤Overleafæ¯”å…¶ä»–LaTexç·¨è¼¯å™¨æ›´å…·å„ªå‹¢</p><p>The benefits of using Overleaf include:</p><ul><li>Instant access: no installation, real-time collaborative editing</li><li>Efficient handling complex documents: create mathematical equations and tables etc and easily manage footnotes, citations and references</li><li>Streamline publishing workflow: allow to submit manuscript within Overleaf project</li><li>Wide range of packages and templates: specifically made for different document types and citation styles</li></ul><figure><img src="https://github.com/overleaf/overleaf/raw/main/doc/screenshot.png" alt="A screenshot of a project being edited in Overleaf Community Edition" /><figcaption>A screenshot of a project being edited in Overleaf Community Edition</figcaption></figure><p>Overleaf is a collaborative cloud-based LaTeX editor used for writing, editing and publishing scientific documents.</p><h2 id="an-open-source-online-real-time-collaborative-latex-editor.">An open-source online real-time collaborative LaTeX editor.</h2><ul><li><a href="https://github.com/overleaf/overleaf" class="uri">https://github.com/overleaf/overleaf</a></li></ul><h3 id="community-edition">Community Edition</h3><p>Overleaf is an open-source online real-time collaborative LaTeX editor. We run a hosted version at &lt;www.overleaf.com&gt;, but <strong>you can also run your own local version, and contribute to the development of Overleaf</strong>.</p><ul><li>Installation<ul><li>We have detailed installation instructions in the <a href="https://github.com/overleaf/toolkit/">Overleaf Toolkit</a>.</li><li><a href="https://github.com/overleaf/toolkit/blob/master/doc/quick-start-guide.md" class="uri">https://github.com/overleaf/toolkit/blob/master/doc/quick-start-guide.md</a></li></ul></li><li>Upgrading<ul><li>If you are upgrading from a previous version of Overleaf, please see the <a href="https://github.com/overleaf/overleaf/wiki#release-notes">Release Notes section on the Wiki</a> for all of the versions between your current version and the version you are upgrading to.</li></ul></li></ul><h2 id="bibliography-styles">Bibliography Styles</h2><p>Bibliography Styles (<a href="https://libguides.lb.polyu.edu.hk/c.php?g=965525&amp;p=7014655">ref1</a>)</p><p>There are three bibliography styles in Overleaf:</p><ul><li>BibTeX - Ease of Use and Compatibility</li><li>Natbib - Author-year and numerical citations, simple documents that require traditional citation styles</li><li>BibLaTeX - Complex documents, multilingual documents, more customization in citations</li></ul><h1 id="latex-template">LaTeX template</h1><ul><li>American Physical Society (APS)<ul><li><a href="https://journals.aps.org/revtex">REVTeX Home Page</a></li><li>REVTeX 4.2 is a set of macro packages designed to be used with LaTeX2e and is well-suited for preparing manuscripts for submission to the journals of the American Physical Society (APS) and American Institute of Physics (AIP).</li><li>The REVTeX 4.2 may be downloaded directly from here as <a href="https://cdn.journals.aps.org/test/345f0cd4-cab7-4271-9a46-7331fb57618a/revtex-tds-2023-05-30.zip">revtex-tds-2023-05-30.zip</a></li></ul></li><li>American Geophysical Union (AGU)<ul><li><a href="https://www.agu.org/publications/authors/journals" class="uri">https://www.agu.org/publications/authors/journals</a></li><li><a href="https://www.agu.org/publications/authors/-/media/4090218dcdb64a5597361820016462ed.ashx">Template for manuscript (LaTeX)</a></li></ul></li></ul>]]></content>
    
    
    <categories>
      
      <category>LaTex</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>NWP | MPAS | Cold Start/Spin up/Warm Start</title>
    <link href="/2024/10/16/wrf-spin-up-cold-start/"/>
    <url>/2024/10/16/wrf-spin-up-cold-start/</url>
    
    <content type="html"><![CDATA[<h1 id="cold-startwarm-start">Cold Start/Warm Start</h1><h2 id="ncar">NCAR</h2><ul><li><a href="https://ral.ucar.edu/solutions/products/real-time-four-dimensional-data-assimilation-rt-fdda">NCAR | Real-Time Four-Dimensional Data Assimilation (RT-FDDA)</a></li></ul><div class="note note-warning">            <p>Simulation is initialized using a <strong>'cold start'</strong> methodology. This means that they <strong>start with no cloud and precipitation systems, or local thermally-driven circulations</strong>.</p>          </div><p>Therefore, a certain amount of model <strong>'spin up' time</strong> is required for the atmosphere to begin responding to the mesoscale forcing resulting from variations in the local complex physiography.</p><h2 id="wrf-code">WRF code</h2><p>For use with <strong>cold start (zero cloud fields)</strong>,</p><p>WRF/run/README.namelist</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs text">&amp;physics<br> insert_init_cloud                   = .false., ! Default<br>                                     = .true.,  ! For use with cold start (zero cloud fields), this option will<br>                                                  use the icloud=3 scheme to produce initial cloud water and cloud<br>                                                  ice fields as well as ensure initial water vapor field matches<br>                                                  saturation, which retains clouds beyond the first few timesteps.<br></code></pre></td></tr></table></figure><h2 id="developing-spin-up-time-framework-...">2023 | Developing spin-up time framework ...</h2><ol type="1"><li>Liu, Y., Zhuo, L., &amp; Han, D. (2023). <strong>Developing spin-up time framework for WRF extreme precipitation simulations</strong>. Journal of Hydrology, 620, 129443.<ol type="1"><li>In fact, the length of spin-up <strong>depends on the quality of initial inputs and the soil conditions</strong> because the soil moisture content and latent heat flux will influence precipitation processes</li><li>For example, <strong>soil moisture responds much slower</strong> than atmospheric variables to dynamical and thermo-dynamical processes</li><li>In WRF extreme precipitation simulations, spin-up time allows the model to adjust from the IC to a state that is consistent with its own numerics and physics and to develop appropriate large-scale circulations</li><li>Therefore, spin-up time is the required execution time that allows the WRF to reach a physical equilibrium state following the path defined by the BC, while forgetting about the IC</li><li>The greater the inconsistencies between IC and model physics, the longer the spin-up time required</li></ol></li></ol><h2 id="forecast-of-low-clouds-...">2021 | Forecast of Low Clouds ...</h2><ul><li>Hagman, M., Svensson, G., &amp; Angevine, W. M. (2021). Forecast of Low Clouds over a Snow Surface in the Arctic Using the WRF Model. Monthly Weather Review, 149(8), 2559-2579. https://doi.org/10.1175/MWR-D-20-0396.1</li></ul><p>The model is <strong>cold-started</strong> for every simulation...Our experiments show that the problems arise in the initialization of the model. When the SAF WRF forecast begins,</p><ul><li>it is initialized with specific humidity, winds, temperature and skin temperature from IFS HRES, <strong>but no cloud information is passed from the host model</strong>.</li><li>When low clouds are present in reality, they increase the downwelling longwave radiation to the surface. This energy source at the surface is especially important in a stably stratified environment with sharp surface inversions as it affects the energy budget at the surface, which, in turn, sets the skin temperature and temperature in the lowest layer of the atmosphere.</li><li><strong>When no cloud information is available at the initial time in WRF</strong>, this energy is lacking during the first hours when <strong>WRF has to spin up its own clouds from the initialized humidity, a slow process in winter at high latitudes</strong>. With less downwelling longwave radiation, the deficit of energy at the surface leads to a <strong>rapid, unphysical drop in the skin temperature</strong>. Drops of 20Â°C in 20 s (one time step) have been noted.</li></ul><h2 id="sensitivity-of-initialcondition-and-cloud-microphysics-...">2018 | Sensitivity of initialâ€condition and cloud microphysics ...</h2><ul><li>Sikder, M. S., &amp; Hossain, F. (2018). Sensitivity of initialâ€condition and cloud microphysics to the forecasting of monsoon rainfall in South Asia. Meteorological Applications, 25(4), 493-509.</li></ul><p>Besides the sensitivity test of the MP schemes in the WRF forecast, the performance of <strong>four different WRF model initialization techniques</strong> was tested in this study.</p><ul><li>In the first experiment case, the <strong>traditional â€œcold-startâ€ technique</strong> was used to initiate the WRF model using the GFS forecast (e.g. Givati et al., 2012). The IC of the WRF model was directly taken from the GFS forecast in this case.</li><li>The second case was also a <strong>cold-start set-up, but the first-hour GFS forecast data were replaced by the GFS-FNL data</strong> which are expected to represent a more accurate IC given the higher number of assimilated observations. Thus, the IC of the model is derived from the GFS-FNL and simulation was continued using the GFS forecast data as the model boundary.</li></ul><div class="note note-warning">            <p><strong>Exclusion of the first 6 hr</strong> simulation output of a cold-start model is a common practice used to eliminate the model â€œspin-upâ€ time error.</p>          </div><p>Although the first two cases involved cold-start initialization, the spin-up effect was not considered in this study to evaluate the advantages of other initialization techniques.</p><p>The next two cases were based on a <strong>â€œwarm startâ€</strong> (<strong>often called a â€œhot startâ€</strong>) approach (e.g. Jankov et al., 2007).</p><ul><li>The output of a <strong>one-day pre-simulated WRF model</strong> was used to initiate the WRF forecast model in these cases. In this way, the uncertainty related to model instability during the so-called spin-up time is expected to be reduced. The GFS-FNL data were used as the initial and boundary condition for this one-day pre-simulation (i.e. hindcast), since they contain more observed data than the operational GFS. <strong>Thereafter, the WRF forecast model was initiated with the restart generated from this hindcast model, and continued with the GFS forecast data as the boundary condition</strong> in the third experiment case.</li><li>The last experimental case was almost similar to the third experimental case. The only difference was <strong>the first-hour GFS forecast data were replaced by the GFS-FNL data in the WRF forecast simulation</strong>. Therefore, the last case is the fusion of the second and third experimental cases.</li></ul><p>These four experiment cases are denoted here by IC and a serial number denoting the experimental case. Hereafter, the IC1 means the first experiment case to initiate the WRF model; and IC2, IC3 and IC4 the second, third and fourth experimental cases, respectively.</p><h2 id="wrfda-point-of-view">WRFDA point of view</h2><h3 id="cycling-wrf-and-wrfda">Cycling WRF and WRFDA</h3><ul><li>Q1: What is "cycling" exactly? How do I set up cycling for WRF and WRFDA?<ul><li>A1: "Cycling" is the process by which the output of a previous WRF forecast is used to initialize a new WRF forecast, rather than taking the initial conditions from some other analysis/forecast through WPS/real. This is usually done in the context of real-time forecast You can find detailed instructions on cycling with WRF/WRFDA in the <a href="http://www2.mmm.ucar.edu/wrf/users/wrfda/Docs/user_guide_V3.9/users_guide_chap6.htm#_Cycling_with_WRF_1%3C/a">relevant section of the Users Guide</a></li></ul></li><li>Q2: What is the difference between <strong>"warm-start"</strong> and <strong>"cold-start"</strong> forecasts?<ul><li>A2: These terms are widely used in the field of atmospheric modeling and data assimilation, however, to quote this site from <a href="http://www.oc.nps.edu/nom/modeling/initial.html">the Naval Postgraduate School</a>, "The terms cold start and warm start may mean slightly different things to different people." In the context of WRF and WRFDA, a <strong>"cold-start" forecast is when the first guess (fg) file</strong> provided to WRFDA is a wrfinput file from WPS/real, while a <strong>"warm-start" forecast is one where the first guess is a WRF forecast file (wrfout)</strong>.</li></ul></li></ul><p>Because of the ambiguity in what constitutes a cold-start or warm-start, we try to avoid using these terms in the official documentation.</p><h2 id="wrf-mpas-a-support-forum">WRF &amp; MPAS-A Support Forum</h2><ul><li><a href="https://forum.mmm.ucar.edu/threads/when-should-i-consider-spin-up-for-wrf-predictions.13821/">When should I consider spin-up for WRF predictions?</a><ul><li><strong>Usually 9-12 hours of spin-up time will be sufficient</strong>. Note that WRF is under strong constraints of lateral forcing and changes in surface static data could be more important for long-term climate simulation.</li></ul></li><li><a href="https://forum.mmm.ucar.edu/threads/long-term-wrf-run.5241/">long-term WRF run</a><ul><li>I don't believe the length of the run should make a difference. <strong>The spin-up time is simply to ensure that the model has had ample time to stabilize so that the results can become reliable</strong>, and are not just simply based on the initial and boundary conditions. Once this happens, the model can go forward to generate estimations for forecasting purposes.</li></ul></li><li><a href="https://forum.mmm.ucar.edu/threads/long-time-wrf-simulation.10067/">Long-time WRF simulation</a><ul><li>Q: I want to do a 1-year WRF simulation with analysis nudging using ERA5 hourly reanalysis data. Take 2019 for example, should I run WRF from Dec,2018 to Dec,2019, taking Dec in 2018 as spin-up period? If so, does nudging set in Dec,2018?</li><li>A: <strong>You shouldn't need more than about 24-48 hours for spin-up</strong>, so if you're interested in the data from 1 Jan 2019, you can just start it Dec 30 or 31 and it should be okay.</li><li><strong>Nudging is beneficial throughout the whole simulation</strong>, especially for larger/continental sized domains. It's less necessary for smaller domains that are more constrained by the boundaries.</li><li><strong>As for long simulations, the only other thing that comes to mind is to make sure you have some additional SST input data</strong>. The GFS provides SST data with their files, but the resolution is temporally coarse. You will want something with higher temporal resolution. You may already have some, or a resource for it, but if you need additional resources, you can see slide 6 from this <a href="https://www2.mmm.ucar.edu/wrf/users/tutorial/202101/werner_data_util_pp.pdf">presentation</a>.</li></ul></li><li><a href="https://forum.mmm.ucar.edu/threads/altering-mpass-initial-conditions.13680/">Altering MPAS's initial conditions</a><ul><li>Q: I am now considering changing initial conditions for the global MPAS run (60-3km mesh). Do you have any idea about the approximate spin-up time for changing different initial variables? For non-change run, I will spin up for about 6 hours and timestep is about 15 seconds. If I change the vegation type (say vegetation fraction), do I need to increase my spin-up time, e.g., a few hours more or even several days?</li><li>A: Based on our experience with WRF model, 9-12 hours of spin-up time is sufficient. Note that WRF is a limited-area model under constraints of large scale forcing. The spin-up time for MPAS global model could be different. A few papers have mentioned the spin-up issue for MPAS. For example, the spin-up time is set to 24h in the <a href="https://macmaq.aqrc.ucdavis.edu/sites/g/files/dgvnsk6036/files/inline-files/Kemal%20Gurer_Poster.pdf">study</a>. Please refer to the literature for more information.</li></ul></li></ul><h1 id="spin-up-time">Spin-Up Time</h1><p>In numerical weather prediction (NWP), <strong>spin-up time</strong> refers to the period required for a model to <strong>adjust from its initial state to a more stable and representative equilibrium state</strong>. This adjustment is crucial for achieving accurate forecasts, as it allows the model to correct any discrepancies in the initial conditions and dynamics.</p><h2 id="key-characteristics-of-spin-up-time">Key Characteristics of Spin-Up Time</h2><h3 id="dynamic-and-thermal-adjustments">Dynamic and Thermal Adjustments</h3><ul><li><p><strong>Initial Phase</strong>: During the spin-up phase, the model undergoes significant dynamic and thermal adjustments. These adjustments are necessary for the model to align with the physical processes governing atmospheric behavior.</p></li><li><p><strong>Duration</strong>: Spin-up time can vary widely depending on the type of model and its configuration. For short-term weather forecast models, spin-up times typically range from several hours to about a dozen hours. In contrast, climate models may require spin-up periods extending from months to even decades.</p></li></ul><h3 id="impact-on-forecast-accuracy">Impact on Forecast Accuracy</h3><ul><li><strong>Forecast Reliability</strong>: The forecasts produced during the spin-up phase are often considered unreliable. Many studies recommend disregarding results from this period when evaluating model performance[1]. This is due to potential inaccuracies caused by transient phenomena, such as spurious gravity waves, which can lead to increased errors in forecast variables.</li><li><strong>Computational Resources</strong>: Extended spin-up times can consume significant computational resources, particularly in climate models or ocean models. Reducing spin-up time is therefore essential for improving efficiency and forecast accuracy.</li></ul><h3 id="factors-influencing-spin-up-time">Factors Influencing Spin-Up Time</h3><ul><li><strong>Model Type</strong>: Different models exhibit varying spin-up characteristics based on their design and purpose. For instance, global climate models generally have longer spin-up times compared to regional models.</li><li><strong>Initial Conditions</strong>: The quality of initial conditions derived from observational data or reanalysis influences how quickly a model can reach equilibrium. Models initialized with better data tend to have shorter spin-up periods.</li></ul><p>In summary, spin-up time in NWP is a critical aspect that affects the accuracy and reliability of weather forecasts. Understanding and optimizing this period is essential for enhancing model performance and resource efficiency.</p><h2 id="spin-up-characteristics-...">2021 Spin-up characteristics ...</h2><ul><li>Ma, Z., Zhao, C., Gong, J., Zhang, J., Li, Z., Sun, J., Liu, Y., Chen, J., and Jiang, Q.: Spin-up characteristics with three types of initial fields and the restart effects on forecast accuracy in the GRAPES global forecast system, Geosci. Model Dev., 14, 205â€“221, <a href="https://doi.org/10.5194/gmd-14-205-2021" class="uri">https://doi.org/10.5194/gmd-14-205-2021</a>, 2021.</li><li><a href="https://gmd.copernicus.org/articles/14/205/2021/gmd-14-205-2021.pdf" class="uri">https://gmd.copernicus.org/articles/14/205/2021/gmd-14-205-2021.pdf</a></li></ul><p>This process is called the spin-up in numerical modeling, and</p><ul><li>the time required to reach a new equilibrium state is called the spin-up time (Wolcott and Warner, 1981; Kasahara et al., 1992; SÃ©fÃ©rian et al., 2016; Sheng et al., 2006; Liu et al., 2008; Xue et al., 2017).</li><li>During the dynamic and thermal adjustment in the spin-up, spurious gravity waves can be triggered, causing a rapid increase in the root-mean-square error of the forecast variables in the model and an underestimation of the forecast precipitation (Wehbe et al., 2019; Qian et al., 2003). It leads to unreliable forecast results during the spin-up.</li><li>Therefore, many studies generally do not consider the forecast results during the spin-up when evaluating the model forecasts (Lo et al., 2008; Kleczke et al., 2014; Xie et al., 2013; Zhao et al., 2012).</li><li>If the spin-up time is too long in the operational model, it would inevitably affect the forecast accuracy of the model.</li><li>In addition, the overlong spin-up in the climate model or the ocean model can consume excessive computing resources (Duben et al., 2014).</li><li>Therefore, studying the spin-up characteristics and reducing the spin-up time are of great significance for improving the model forecast and saving computing resources.</li></ul><h2 id="é—œæ–¼æ•¸å€¼æ¨¡å¼spin-upçš„ä¸€äº›èªªæ˜">é—œæ–¼æ•¸å€¼æ¨¡å¼spin upçš„ä¸€äº›èªªæ˜</h2><ul><li>From <a href="https://mp.weixin.qq.com/s/4osE0V9fxZO695N8AifxmA" class="uri">https://mp.weixin.qq.com/s/4osE0V9fxZO695N8AifxmA</a></li></ul><p>ç”±æ–¼é›£ä»¥å¾—åˆ°ç†æƒ³çš„æº–ç¢ºçš„åˆå§‹å ´ï¼Œæ¨¡å¼åˆå§‹å ´å„è®Šæ•¸ä¹‹é–“ï¼Œæˆ–èˆ‡å¤–éƒ¨æ¢ä»¶ä¹‹é–“å­˜åœ¨ä¸å¹³è¡¡æˆ–ä¸åŒ¹é…ã€‚å› æ­¤æ¨¡å¼å•Ÿå‹•å¾Œï¼Œéœ€è¦é‹è¡Œä¸€æ®µæ™‚é–“ï¼Œä»¥é”åˆ°æ‰€éœ€çš„ã€Œå¹³è¡¡ç‹€æ…‹ã€ã€‚è€Œé”åˆ°é€™å€‹ç‹€æ…‹æ‰€éœ€çš„æ™‚é–“ï¼Œç¨±ç‚ºspin up timeï¼ˆèµ·è½‰æ™‚é–“ï¼‰ã€‚åœ¨å®Œæˆspin upä¹‹å‰ï¼Œæ¨¡å¼çš„è¼¸å‡ºçµæœå¾€å¾€æ˜¯ä¸å¯ä¿¡çš„ã€‚</p><p>å°æ–¼ä¸åŒçš„ç ”ç©¶å°åƒæˆ–ä¸åŒæ¨¡å¼ï¼Œå…¶spin upæ‰€é—œæ³¨çš„é‡é»èˆ‡æ‰€éœ€çš„æ™‚é–“æ˜¯ä¸ä¸€æ¨£çš„ã€‚</p><p>å°æ–¼ä¸­å°å°ºåº¦æ°£åƒæ¨¡å¼ï¼Œä¾‹å¦‚WRFï¼Œåˆå§‹å ´å„è®Šæ•¸ç‰¹åˆ¥æ˜¯æ¿•åº¦å ´ï¼Œå¾€å¾€éæ–¼å¹³æ»‘ï¼Œä½¿å¾—æ¨¡å¼çš„åˆå§‹æ™‚åˆ»çš„è¼»æ•£å ´ã€éçµ•ç†±åŠ ç†±èˆ‡æ¿•åº¦å ´ä¹‹é–“ç¼ºä¹ä¸€è‡´æ€§ï¼Œå‹•åŠ›ã€ç†±åŠ›éç¨‹èˆ‡æ°´åˆ†å¾ªç’°ä¸å”èª¿ã€‚<strong>ä¸”ä¸­å°å°ºåº¦æ¨¡å¼ä¸€èˆ¬æ˜¯ç”±ç„¡é›²åˆå§‹å ´é–‹å§‹çš„ï¼Œæ‰€ä»¥é–‹å§‹éœ€è¦ä¸€å®šçš„æ™‚é–“ç”¢ç”Ÿç›¸æ‡‰çš„é›²æ°´ä¿¡æ¯ï¼Œå†·å•Ÿå‹•ä¹‹å¾Œå¾€å¾€éœ€è¦è‹¥å¹²å°æ™‚æ‰èƒ½ç”¢ç”Ÿç¬¦åˆå¯¦éš›çš„é›²æ°´ä¿¡æ¯</strong>ã€‚</p><p>ä¸€èˆ¬èªç‚ºï¼ŒWRFæ¨¡å¼åœ¨6å°æ™‚å³å¯å®Œæˆspin upï¼ˆä¹Ÿè¨±æ›´çŸ­ï¼Œ6å°æ™‚æ˜¯ä¸€å€‹æ¯”è¼ƒä¿å®ˆçš„ä¼°è¨ˆï¼‰ã€‚ç”±æ–¼spin upçš„å­˜åœ¨ï¼Œé™åˆ¶äº†æ•¸å€¼æ¨¡å¼åœ¨çŸ­è‡¨é å ±çš„æ‡‰ç”¨ã€‚å› æ­¤æœ‰ä¸å°‘è³‡æ–™åŒåŒ–çš„å·¥ä½œï¼Œè¿½æ±‚ç›¡å¯èƒ½åŒåŒ–é›²æ°´ç›¸é—œçš„è§€æ¸¬è¨Šæ¯ï¼Œç¸®çŸ­æ¨¡å¼spin upæ™‚é–“ã€‚</p><p>è€Œåœ¨æ°£å€™æ¨¡æ“¬ä¸­ï¼Œspin upçš„æ™‚é–“æ›´é•·ã€‚ä¾‹å¦‚åœ¨CMIP6çš„é«˜è§£æåº¦æ¨¡å¼æ¯”è¼ƒè¨ˆåŠƒ ï¼ˆHighResMIPï¼‰ä¸­ï¼Œå…¶ç¬¬äºŒå±¤ç´š ï¼ˆTier-2ï¼‰è©¦é©—ç‚º1950â€”2050 å¹´çš„ç™¾å¹´è€¦åˆè©¦é©—ã€‚ç‚ºäº†åœ¨è©¦é©—å‰ç›¡å¯èƒ½é”åˆ°æµ·-æ°£æº–å¹³è¡¡æ…‹ï¼ŒHighResMIPå·¥ä½œå°çµ„å»ºè­°å…ˆé€²è¡Œç´„ 50å¹´çš„spin upï¼Œä¹‹å¾Œå†ä»¥ã€Œç†±å•Ÿå‹•ã€(restart) çš„æ–¹å¼å®Œæˆè©²æ®µè©¦é©—ã€‚å¤§æ°£çš„å›é¥‹éç¨‹è¼ƒå¿«ï¼Œè€Œæµ·æ´‹çš„ç‹€æ…‹èª¿æ•´å’Œå›é¥‹ç›¸å°è¼ƒæ…¢ã€‚åœ¨æµ·æ´‹æ¨¡å¼ä¸­ï¼Œspin-upéœ€è¦çš„æ™‚é–“æ›´ä¹…ã€‚æµ·æ´‹æ¨¡å‹éœ€è¦å¤šé•·æ™‚é–“æ‰èƒ½é”åˆ°å¹³è¡¡ï¼Ÿ èˆ‡æ‰€é—œæ³¨çš„ç ”ç©¶å°è±¡å’Œä½¿ç”¨çš„æ¨¡å‹å¯†åˆ‡ç›¸é—œã€‚</p><p>åœ¨æµ·ç›†å°ºåº¦å’Œå…¨çƒå°ºåº¦çš„æµ·æ´‹ç’°æµæ¨¡å¼ä¸­ï¼Œæ¨¡å¼è¦é”åˆ°å¹³è¡¡ç‹€æ…‹è¼ƒé›£ï¼Œå¯èƒ½éœ€è¦æ•¸ç™¾å¹´çš„æ™‚é–“ã€‚æµ·æ´‹æ¨¡å‹ä»¥ç›®å‰çš„æµ·æ´‹ç‹€æ…‹ï¼ˆæ°£å€™æ…‹ï¼‰åˆå§‹åŒ–ï¼Œä¸¦å‘å‰ç©åˆ†ï¼Œç›´åˆ°ç’°æµçµæ§‹å’Œå¯†åº¦å ´ç­‰å¹³è¡¡åŒ¹é…ã€‚æ·±æµ·æµ·æ´‹éœ€è¦æ•¸ç™¾å¹´çš„é©æ‡‰ï¼Œä¸Šå±¤æµ·æ´‹åªéœ€è¦å¤§ç´„50å¹´å·¦å³ã€‚ä¾‹å¦‚è¦ç ”ç©¶ä¸Šå±¤æµ·æ´‹éç¨‹ï¼ˆå¦‚å„çˆ¾å°¼è«¾ï¼‰ï¼Œå‰‡ä¸€èˆ¬åªéœ€ä¸Šå±¤æµ·æ´‹ï¼ˆåœ¨ä¸»æº«èºå±¤ä¹‹ä¸Šï¼‰é”åˆ°å¹³è¡¡ç‹€æ…‹ã€‚</p><p>å¯¦éš›ä¸Šï¼Œspin upæ™‚é–“å°ºåº¦æ˜¯ç¬¬ä¸€å’Œç¬¬äºŒæ¨¡æ…‹çš„é•·ç¾…æ–¯è²æ³¢ï¼ˆå¤§è¦æ¨¡è¡Œæ˜Ÿæ³¢ï¼‰å¾æ±åˆ°è¥¿ç©¿éç›†åœ°ã€å½±éŸ¿æ°´æµä¸¦æœ€çµ‚å½±éŸ¿æ°´åœ˜ç‰¹æ€§æ‰€éœ€çš„æ™‚é–“ã€‚æ²¿è‘—èµ¤é“ï¼Œç¬¬ä¸€æ¨¡æ…‹æ–œå£“ç¾…æ–¯è²æ³¢æ©«æ¸¡å¤ªå¹³æ´‹ç´„éœ€9å€‹æœˆï¼›ç„¶è€Œï¼Œç¬¬äºŒæ¨¡æ…‹çš„é•·ç¾…æ–¯è²æ³¢æ–œå£“æ€§æ›´å¼·ï¼Œå‚³æ’­å¾—æ›´æ…¢ã€‚å› æ­¤ï¼Œåœ¨èµ¤é“ä¸­éœ€è¦spin upå¹¾å¹´æ™‚é–“æ‰èƒ½é”åˆ°å¹³è¡¡ã€‚</p><p>åœ¨ä¸­ç·¯åº¦åœ°å€ï¼Œé•·æ³¢å‚³æ’­å¾—æ›´æ…¢ã€‚ç¾…æ–¯è²æ³¢æ©«æ¸¡å¤ªå¹³æ´‹å¤§ç´„éœ€è¦ 11 å¹´ã€‚å°æ–¼å…¨çƒæµ·æ´‹æ¨¡å‹ï¼Œéœ€è¦å¹¾åå¹´æ‰èƒ½åœ¨æµ·æ´‹ä¸Šå±¤é”åˆ°å¹³è¡¡ã€‚å¦‚æœåªè€ƒæ…®æ­£å£“æ¨¡å¼ï¼Œæˆ–è€…æ¨¡å‹æ˜¯äºŒç¶­çš„ï¼Œé‚£éº¼spin upèª¿æ•´æ™‚é–“æœƒæ›´å¿«ï¼Œå¤§ç´„å¹¾å¤©ï¼Œå› ç‚ºæ­£å£“æ³¢å‚³æ’­å¾—æ›´å¿«ã€‚</p><p>å¦‚æœæƒ³ç¸®çŸ­spin upæ™‚é–“ï¼Œé‚„å¯ä»¥é€éè³‡æ–™åŒåŒ–ï¼ˆnudgeï¼‰çš„æ–¹å¼ï¼Œä½¿å¾—æ¨¡å¼ç‹€æ…‹ä¸æ–·é€¼è¿‘è§€æ¸¬ã€‚ä¾‹å¦‚åœ¨æ­£å£“æ¨¡å‹ä¸­ï¼Œå¯ä»¥ä½¿ç”¨æµ·è¡¨é¢é«˜åº¦è³‡æ–™ï¼ˆSSHï¼‰ã€‚</p><p>æ­¤å¤–ï¼Œå¦‚æœåªé—œå¿ƒé¢¨åŠ›é©…å‹•çš„æ°´å¾ªç’°ï¼Œä¾‹å¦‚ç”± Ekman æŠ½å¸å¼•èµ·çš„æµ·é¢æ–œå¡ç”¢ç”Ÿçš„æµå‹•ï¼Œé‚£éº¼å¹¾å¤©çš„spin upæ™‚é–“å¯èƒ½å°±è¶³å¤ äº†ã€‚</p><h1 id="atmospheric-kinetic-energy-spectra----spinup-time">** Atmospheric Kinetic Energy Spectra --&gt; spinup time</h1><ul><li><strong>The KE spectrum has a canonical structure characterized by different slopes at various wavenumbers</strong>. <strong>Initially, higher-wavenumber components have low energy, which gradually increases as the model spins up</strong>. This adjustment is essential for accurately representing atmospheric dynamics, particularly for phenomena like monsoon rainfall</li><li>The KE spectra in numerical simulations typically require a spin-up period of 12 to 18 hours to stabilize, as indicated by previous studies. This time is crucial for the model to adjust its initial conditions and reach a more representative state.</li><li><strong>During the spin-up phase, spurious gravity waves may be generated</strong>, leading to increased errors in forecast variables and underestimations of precipitation. The KE spectra help identify these discrepancies by showing how energy cascades through different scales, which can affect forecast reliability.</li><li><strong>Atmospheric kinetic energy spectra provide valuable insights into the spin-up issue by illustrating how energy transitions through various scales during initialization</strong>. This understanding is vital for improving forecast accuracy and optimizing model configurations in NWP systems.</li></ul><p>The paper is,</p><ul><li>Skamarock, W. C., Park, S., Klemp, J. B., &amp; Snyder, C. (2014). Atmospheric Kinetic Energy Spectra from Global High-Resolution Nonhydrostatic Simulations. Journal of the Atmospheric Sciences, 71(11), 4369-4381. https://doi.org/10.1175/JAS-D-14-0114.1</li></ul><figure><img src="https://journals.ametsoc.org/view/journals/atsc/71/11/full-jas-d-14-0114.1-f8.jpg" alt="Fig. 8. Tropospheric and stratospheric kinetic energy spectra for the 3-km MPAS simulations at simulation times 0, 6, 12, and 18 h. The day 5â€“15 averages are plotted for reference." /><figcaption>Fig. 8. Tropospheric and stratospheric kinetic energy spectra for the 3-km MPAS simulations at simulation times 0, 6, 12, and 18 h. The day 5â€“15 averages are plotted for reference.</figcaption></figure><ul><li>Atmospheric prediction systems are designed and configured in part based on an understanding of these dynamics that, for example, have implications for forecast error growth and spinup time scales and filtering and subfilter-scale physics</li><li>The KE spectra reveal that the MPAS configuration produces an effective model resolution (filter scale) of approximately 6Î”x</li><li>The spinup time is found to be somewhat less than a day, consistent with MPAS results presented in Fig. 8</li><li>The spinup time should be comparable to an eddy turnover time.</li></ul><h1 id="references">References</h1><ol type="1"><li>Wolcott, S. W., &amp; Warner, T. T. (1981). A moisture analysis procedure utilizing surface and satellite data. Monthly Weather Review, 109(9), 1989-1998.</li><li>Kasahara, A., Mizzi, A. P., &amp; Donner, L. J. (1992). Impact of cumulus initialization on the <strong>spinup</strong> of precipitation forecasts in the tropics. Monthly weather review, 120(7), 1360-1380.</li><li>SÃ©fÃ©rian, R., Gehlen, M., Bopp, L., Resplandy, L., Orr, J. C., Marti, O., ... &amp; Romanou, A. (2016). Inconsistent strategies to <strong>spin up</strong> models in CMIP5: Implications for ocean biogeochemical model performance assessment. Geoscientific Model Development, 9(5), 1827-1851.</li><li>Sheng, C., Pu, Y., and Gao, S.: Effect of Chinese Doppler radar data on nowcasting output of mesoscale model, Chin. J. Atmos. Sci., 30, 93â€“107, 2006 (in Chinese).</li><li>Liu, S., Jiang, H., Hu, F., Zhang, C., Liu, H., Liang, F., Xin, G., and Wang, J.: Research of <strong>spin-up processes</strong> of land surface model of RAMs for different initial soil parameters, Acta Meteorol. Sin., 66, 351â€“358, 2008 (in Chinese).</li><li>Xue, C., Chen, X., Wu, Y., Xu, X., and Gao, Y.: Application of radar assimilation in local severe convective weather forecast, Chin. J. Atmos. Sci., 41, 673â€“690, 2017 (in Chinese).</li><li>Wehbe, Y., Temimi, M., Weston, M., Chaouch, N., Branch, O., Schwitalla, T., ... &amp; Al Mandous, A. (2019). Analysis of an extreme weather event in a hyper-arid region using WRF-Hydro coupling, station, and satellite data. Natural Hazards and Earth System Sciences, 19(6), 1129-1149.</li><li>Qian, J. H., Seth, A., &amp; Zebiak, S. (2003). Reinitialized versus continuous simulations for regional climate downscaling. Monthly Weather Review, 131(11), 2857-2874.</li><li>Lo, J. C. F., Yang, Z. L., &amp; Pielke Sr, R. A. (2008). Assessment of three dynamical climate downscaling methods using the Weather Research and Forecasting (WRF) model. Journal of Geophysical Research: Atmospheres, 113(D9).</li><li>Weiss, S. J., Pyle, M. E., Janjic, Z., Bright, D. R., Kain, J. S., &amp; DiMego, G. J. (2008, October). The operational high resolution window WRF model runs at NCEP: Advantages of multiple model runs for severe convective weather forecasting. In Preprints, 24th Conf. on Severe Local Storms, Savannah, GA, Amer. Meteor. Soc. P (Vol. 10).</li><li>Branch, O., Schwitalla, T., Temimi, M., Fonseca, R., Nelli, N., Weston, M., ... &amp; Wulfmeyer, V. (2020). Seasonal and diurnal performance of daily forecasts with WRF-NOAHMP V3. 8.1 over the United Arab Emirates. Geoscientific Model Development Discussions, 2020, 1-40.<ol type="1"><li>The first 6â€‰h of each forecast (18:00 to 00:00â€‰UTC) were then discarded from the analysis. <strong>The 6â€‰h allows time for the atmosphere to spin up after each cold start â€“ in particular for the residual boundary layer to develop and dissipate before the convective boundary layer starts to develop after sunrise (âˆ¼â€‰06:00â€‰LT), and for potential cloud development</strong>.</li></ol></li></ol>]]></content>
    
    
    <categories>
      
      <category>NWP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NWP</tag>
      
      <tag>WRF</tag>
      
      <tag>MPAS</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Linux | Terminal Command</title>
    <link href="/2024/10/15/Linux-terminal/"/>
    <url>/2024/10/15/Linux-terminal/</url>
    
    <content type="html"><![CDATA[<p>Linux</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs sh"><br><span class="hljs-comment"># -m displays percentages</span><br><span class="hljs-comment"># -N displays line numbers</span><br><span class="hljs-comment"># -i ignores case when searching</span><br><span class="hljs-comment"># h Display the help interface</span><br><span class="hljs-comment"># Q quits less command</span><br>less -miN file <span class="hljs-comment"># alias less=&#x27;less -miN&#x27;</span><br><br>sh run.sh | <span class="hljs-built_in">tee</span> output.txt<br><span class="hljs-comment"># If you want to print the error output to the screen and the file at the same time</span><br>sh run.sh 2&gt;&amp;1 | <span class="hljs-built_in">tee</span> lsls.log<br><br>sh run.sh &gt;/dev/null 2&gt;&amp;1 &amp;<br><br><span class="hljs-comment"># -C : Print Around Lines</span><br>grep -irn -C 3 <span class="hljs-string">&quot;xxx&quot;</span> file<br>grep -irn -C 3 <span class="hljs-string">&quot;xxx&quot;</span> ./*<br><br>find ./ -name <span class="hljs-string">&quot;xxx&quot;</span><br>find ./ -<span class="hljs-built_in">type</span> f | <span class="hljs-built_in">wc</span> -l <span class="hljs-comment"># count how many files</span><br>find ./ -size +1M       <span class="hljs-comment"># large 1MB size</span><br><br>ldd xxx<br><br>rename IMG img IMG* <span class="hljs-comment"># IMG001.jpg to img001.jpg</span><br></code></pre></td></tr></table></figure><h1 id="find-delete">Find &amp; Delete</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># Find files smaller than 100M: -print or -delete</span><br>find . -<span class="hljs-built_in">type</span> f -name <span class="hljs-string">&quot;*.nc&quot;</span> -size -100M -<span class="hljs-built_in">print</span><br>find . -<span class="hljs-built_in">type</span> f -name <span class="hljs-string">&quot;*.nc&quot;</span> -size -100M -delete<br><br><span class="hljs-comment"># Find files larger than 100M: -print or -delete</span><br>find . -<span class="hljs-built_in">type</span> f -name <span class="hljs-string">&quot;*.nc&quot;</span> -size +100M -<span class="hljs-built_in">print</span><br>find . -<span class="hljs-built_in">type</span> f -name <span class="hljs-string">&quot;*.nc&quot;</span> -size +100M -delete<br><br><span class="hljs-comment"># if your &quot;find&quot; does not support delete:</span><br>find . -<span class="hljs-built_in">type</span> f ! -name <span class="hljs-string">&#x27;*.mp3&#x27;</span> ! -name <span class="hljs-string">&#x27;*.mp4&#x27;</span> -size +1M -<span class="hljs-built_in">exec</span> <span class="hljs-built_in">rm</span> &#123;&#125; \;<br></code></pre></td></tr></table></figure><h1 id="for-client-node">For client node,</h1><ul><li>create a file <code>.info</code> on home directory</li><li>copy all below into <code>.info</code></li><li>drectly <code>source .info</code> or write <code>source .info</code> into <code>.bashrc</code></li></ul><h2 id="how-can-i-display-the-absolute-path-in-bash-prompt">How can I display the absolute path in bash prompt?</h2><ul><li><a href="https://superuser.com/questions/202212/how-can-i-display-the-absolute-path-in-bash-prompt" class="uri">https://superuser.com/questions/202212/how-can-i-display-the-absolute-path-in-bash-prompt</a></li></ul><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-built_in">export</span> <span class="hljs-attribute">PS1</span>=<span class="hljs-string">&quot;\[\`if [[ \$? = &quot;</span>0&quot; ]]; then echo <span class="hljs-string">&#x27;\e[32m\h\e[0m&#x27;</span>; <span class="hljs-keyword">else</span> echo <span class="hljs-string">&#x27;\e[31m\h\e[0m&#x27;</span> ; fi\`:\`pwd\`\n\$ <span class="hljs-string">&quot;</span><br></code></pre></td></tr></table></figure><p>better is,</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># set a fancy prompt (non-color, unless we know we &quot;want&quot; color)</span><br><span class="hljs-keyword">case</span> <span class="hljs-string">&quot;<span class="hljs-variable">$TERM</span>&quot;</span> <span class="hljs-keyword">in</span><br>    xterm-color|*-256color) color_prompt=<span class="hljs-built_in">yes</span>;;<br><span class="hljs-keyword">esac</span><br><br><span class="hljs-comment"># uncomment for a colored prompt, if the terminal has the capability; turned</span><br><span class="hljs-comment"># off by default to not distract the user: the focus in a terminal window</span><br><span class="hljs-comment"># should be on the output of commands, not on the prompt</span><br><span class="hljs-comment">#force_color_prompt=yes</span><br><br><span class="hljs-keyword">if</span> [ -n <span class="hljs-string">&quot;<span class="hljs-variable">$force_color_prompt</span>&quot;</span> ]; <span class="hljs-keyword">then</span><br>    <span class="hljs-keyword">if</span> [ -x /usr/bin/tput ] &amp;&amp; tput setaf 1 &gt;&amp;/dev/null; <span class="hljs-keyword">then</span><br><span class="hljs-comment"># We have color support; assume it&#x27;s compliant with Ecma-48</span><br><span class="hljs-comment"># (ISO/IEC-6429). (Lack of such support is extremely rare, and such</span><br><span class="hljs-comment"># a case would tend to support setf rather than setaf.)</span><br>color_prompt=<span class="hljs-built_in">yes</span><br>    <span class="hljs-keyword">else</span><br>color_prompt=<br>    <span class="hljs-keyword">fi</span><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-keyword">if</span> [ <span class="hljs-string">&quot;<span class="hljs-variable">$color_prompt</span>&quot;</span> = <span class="hljs-built_in">yes</span> ]; <span class="hljs-keyword">then</span><br>    PS1=<span class="hljs-string">&#x27;$&#123;debian_chroot:+($debian_chroot)&#125;\[\033[01;32m\]\u@\h\[\033[00m\]:\[\033[01;36m\]$PWD\[\033[00m\]\n\$ &#x27;</span><br><span class="hljs-keyword">else</span><br>    PS1=<span class="hljs-string">&#x27;$&#123;debian_chroot:+($debian_chroot)&#125;\u@\h:\w\$ &#x27;</span><br><span class="hljs-keyword">fi</span><br><span class="hljs-built_in">unset</span> color_prompt force_color_prompt<br><br><span class="hljs-comment"># If this is an xterm set the title to user@host:dir</span><br><span class="hljs-keyword">case</span> <span class="hljs-string">&quot;<span class="hljs-variable">$TERM</span>&quot;</span> <span class="hljs-keyword">in</span><br>xterm*|rxvt*)<br>    PS1=<span class="hljs-string">&quot;\[\e]0;<span class="hljs-variable">$&#123;debian_chroot:+($debian_chroot)&#125;</span>\u@\h: \w\a\]<span class="hljs-variable">$PS1</span>&quot;</span><br>    ;;<br>*)<br>    ;;<br><span class="hljs-keyword">esac</span><br></code></pre></td></tr></table></figure><h2 id="is-there-a-directory-history-for-bash">** Is there a directory history for bash?</h2><ul><li><a href="https://superuser.com/questions/299694/is-there-a-directory-history-for-bash" class="uri">https://superuser.com/questions/299694/is-there-a-directory-history-for-bash</a></li></ul><p>You can build your own <code>cd</code> command with <code>pushd</code>, <code>popd</code>, <code>dirs</code> , <code>dirs -v</code> builtin commands.</p><p>Usage</p><ul><li><p><code>cd --</code> ( list current history )</p></li><li><p><code>cd -num</code> ( go to num directory )</p></li><li><p><code>cd -</code> ( go to previous directory )</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">cd</span></span> () <br>&#123; <br>    <span class="hljs-built_in">local</span> hnum=16;<br>    <span class="hljs-built_in">local</span> new_dir index <span class="hljs-built_in">dir</span> cnt;<br>    <span class="hljs-keyword">if</span> ! [ <span class="hljs-variable">$#</span> -eq 0 ]; <span class="hljs-keyword">then</span><br>        <span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$#</span> -eq 2 &amp;&amp; <span class="hljs-variable">$1</span> = <span class="hljs-string">&quot;--&quot;</span> ]]; <span class="hljs-keyword">then</span><br>            <span class="hljs-built_in">shift</span>;<br>        <span class="hljs-keyword">else</span><br>            <span class="hljs-keyword">if</span> ! &#123; <br>                [ <span class="hljs-variable">$#</span> -eq 1 ] &amp;&amp; [[ <span class="hljs-variable">$1</span> =~ ^(-[0-9]&#123;,2&#125;|-|--|[^-].*)$ ]]<br>            &#125;; <span class="hljs-keyword">then</span><br>                <span class="hljs-built_in">builtin</span> <span class="hljs-built_in">cd</span> <span class="hljs-string">&quot;<span class="hljs-variable">$@</span>&quot;</span>;<br>                <span class="hljs-built_in">return</span>;<br>            <span class="hljs-keyword">fi</span>;<br>        <span class="hljs-keyword">fi</span>;<br>    <span class="hljs-keyword">fi</span>;<br>    [ <span class="hljs-string">&quot;<span class="hljs-variable">$1</span>&quot;</span> = <span class="hljs-string">&quot;--&quot;</span> ] &amp;&amp; &#123; <br>        <span class="hljs-built_in">dirs</span> -v;<br>        <span class="hljs-built_in">return</span><br>    &#125;;<br>    new_dir=<span class="hljs-variable">$&#123;1:-<span class="hljs-variable">$HOME</span>&#125;</span>;<br>    <span class="hljs-keyword">if</span> [[ <span class="hljs-string">&quot;<span class="hljs-variable">$new_dir</span>&quot;</span> =~ ^-[0-9]&#123;,2&#125;$ ]]; <span class="hljs-keyword">then</span><br>        index=<span class="hljs-variable">$&#123;new_dir:1&#125;</span>;<br>        <span class="hljs-keyword">if</span> [ -z <span class="hljs-string">&quot;<span class="hljs-variable">$index</span>&quot;</span> ]; <span class="hljs-keyword">then</span><br>            new_dir=<span class="hljs-variable">$OLDPWD</span>;<br>        <span class="hljs-keyword">else</span><br>            new_dir=$(<span class="hljs-built_in">dirs</span> -l +<span class="hljs-variable">$index</span>) || <span class="hljs-built_in">return</span>;<br>        <span class="hljs-keyword">fi</span>;<br>    <span class="hljs-keyword">fi</span>;<br>    <span class="hljs-built_in">pushd</span> -- <span class="hljs-string">&quot;<span class="hljs-variable">$new_dir</span>&quot;</span> &gt; /dev/null || <span class="hljs-built_in">return</span>;<br>    <span class="hljs-built_in">popd</span> -n +<span class="hljs-variable">$hnum</span> &amp;&gt; /dev/null || <span class="hljs-literal">true</span>;<br>    new_dir=<span class="hljs-variable">$PWD</span> cnt=1;<br>    <span class="hljs-keyword">while</span> <span class="hljs-built_in">dir</span>=$(<span class="hljs-built_in">dirs</span> -l +<span class="hljs-variable">$cnt</span> 2&gt; /dev/null); <span class="hljs-keyword">do</span><br>        <span class="hljs-keyword">if</span> [ <span class="hljs-string">&quot;<span class="hljs-variable">$dir</span>&quot;</span> = <span class="hljs-string">&quot;<span class="hljs-variable">$new_dir</span>&quot;</span> ]; <span class="hljs-keyword">then</span><br>            <span class="hljs-built_in">popd</span> -n +<span class="hljs-variable">$cnt</span> &gt; /dev/null;<br>            <span class="hljs-built_in">continue</span>;<br>        <span class="hljs-keyword">fi</span>;<br>        <span class="hljs-built_in">let</span> cnt++;<br>    <span class="hljs-keyword">done</span><br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Terminal</category>
      
    </categories>
    
    
    <tags>
      
      <tag>HPC</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>WRF | ncview/ncvis -- a NetCDF visual browser</title>
    <link href="/2024/10/10/ncview/"/>
    <url>/2024/10/10/ncview/</url>
    
    <content type="html"><![CDATA[<h1 id="ncview">ncview</h1><ul><li><a href="https://cirrus.ucsd.edu/~pierce/software/ncview/index.html">ncview website | David W. Pierce</a></li><li>ncmaps brings scientific colormaps to ncview. <a href="https://github.com/TomLav/ncmaps/tree/main" class="uri">https://github.com/TomLav/ncmaps/tree/main</a></li></ul><p><strong>Ncview is designed to be the fastest way to see what's in a netCDF file</strong>. Of course I'm biased since I wrote the thing, but I think everybody who works with netCDF files can benefit from having ncview in their toolkit. Ncview doesn't replace existing analysis packages, such as IDL, NCL, Matlab, Ferret, or R; instead it supplements them by providing a quick and easy way to get an enormous amount of information from your netCDF file.</p><h2 id="installation">Installation</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">conda install conda-forge::ncview<br></code></pre></td></tr></table></figure><h2 id="command-prompt">Command prompt</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">ncview xxx.nc<br></code></pre></td></tr></table></figure><figure><img src="https://i.imgur.com/lGIE5ba.png" alt="ncview" /><figcaption>ncview</figcaption></figure><p>In particular, the following attributes are taken into account:</p><ul><li><strong>missing_value</strong>: This attribute, which must be of the same type as the variable it is associated with, is an important one to set if you have missing values that are indicated by some â€œspecialâ€ number such as -999.9, 1.0e35, or whatever. If you donâ€™t set this attribute, ncview will not work properly.</li><li><strong>units</strong>: A character-type attribute that gives the units of the variable it is associated with. For example, â€œmetersâ€ or â€œYearsâ€.</li><li><strong>long_name</strong>: A character-type attribute that gives the extended, or more descriptive, name of the variable it is associated with. For instance, if the variableâ€™s name is â€œLonâ€, its long_name might be â€œLongitudeâ€.</li><li><strong>title</strong>: This global character-type attribute gives some short, descriptive summary of the meaning or parameters of the data file. For instance, it might be â€œRun 017: dx=4, dy=5, nT=45 yrsâ€ or â€œEl Nino Simulation, no mixed layer, D. Pierce SIO/CRDâ€.</li><li><strong>add_offset, scale_factor</strong>: Ncview respects these attributes, transparently scaling and offsetting the data as specified. See the netCDF documentation on these attributes for details. In essence, these attributes let you implement a form of data packing.</li></ul><h1 id="packed-data-values">Packed Data Values</h1><p>What are <strong>add_offset, scale_factor</strong> ?</p><ul><li><a href="https://www.unidata.ucar.edu/software/netcdf/workshops/2010/bestpractices/Packing.html" class="uri">https://www.unidata.ucar.edu/software/netcdf/workshops/2010/bestpractices/Packing.html</a></li></ul><div class="note note-warning">            <p>Conventions for packing numeric data to <strong>save space</strong> have some subtleties.</p>          </div><p>Packed data is stored in a netCDF file using a smaller data type than the original data, for example, packing doubles into shorts. The netCDF library itself does not do packing and unpacking, but the Java-netCDF library will do automatic unpacking, see class VariableDS.</p><p>Recommendations:</p><p>For each variable with packed data, add two attributes called scale_factor and add_offset, such that</p><blockquote><p>unpacked_value = packed_value * scale_factor + add_offset</p></blockquote><p>The type of the stored variable is the type of the packed data type, typically byte, short, or int.</p><p>The type of the scale_factor and add_offset attributes should be the type that you want the unpacked data to be, typically float or double.</p><p>To compute the scale and offset for maximum precision packing of a set of numbers, use:</p><blockquote><p>add_offset = dataMin<br />scale_factor = (dataMax - dataMin) / (2^n - 1)</p></blockquote><p>where n is the number of bits of the packed (integer) data type.</p><p>To avoid introducing a bias into the unpacked values due to truncation when packing, round to the nearest integer rather than just truncating towards zero:</p><blockquote><p>packed_value = nint((unpacked_value - add_offset) / scale_factor)</p></blockquote><p>The precision of the data will be</p><blockquote><p>1.0 / scale_factor.</p></blockquote><p>Example, packing 32-bit floats into 16-bit shorts:</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs text">variables:<br>  short data(z, y, x) ;<br>    data:scale_offset = 34.02f ;<br>    data:add_offset = 1.54f ;<br></code></pre></td></tr></table></figure><h1 id="ncvis">ncvis</h1><ul><li><a href="https://github.com/SEATStandards/ncvis" class="uri">https://github.com/SEATStandards/ncvis</a></li></ul><p>NetCDF Visualizer</p><p>Developed by Paul A. Ullrich</p><div class="note note-warning">            <p>In order for ncvis to run the resources directory must be in the same folder as ncvis or the NCVIS_RESOURCE_DIR environment variable must be set to the path of the ncvis resources folder. This directory is where ncvis stores <strong>fonts</strong>, <strong>colormaps</strong> and <strong>shapefiles</strong>.</p>          </div><figure><img src="https://user-images.githubusercontent.com/5330916/187129223-b9d47718-fff3-4fd9-8efb-4f71bd86d3e2.png" alt="ncvis" /><figcaption>ncvis</figcaption></figure><h2 id="from-source-code">from source code</h2><ul><li>https://github.com/SEATStandards/ncvis</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">conda create -n ncvis -c conda-forge wxwidgets libnetcdf<br>conda activate ncvis<br>conda install conda-forge::cxx-compiler<br>conda install -c anaconda libxxf86vm-cos6-x86_64<br></code></pre></td></tr></table></figure><p>Then,</p><ul><li>soft-link micromamba/envs/ncvis-v1/x86_64-conda_cos6-linux-gnu/sysroot/usr/lib64/libXxf86vm.so.1 to /home/wpsze/micromamba/envs/ncvis-v1/lib</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ sh ./build.sh<br><span class="hljs-comment"># check</span><br>$ ldd ncvis |grep not<br><span class="hljs-comment"># set</span><br><span class="hljs-built_in">alias</span> ncvis=/home/wpsze/share/ncvis/ncvis<br></code></pre></td></tr></table></figure><div class="note note-warning">            <p>ncvis uses degree for lat lon but MPAS uses radian</p>          </div>]]></content>
    
    
    <categories>
      
      <category>WRF</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NWP</tag>
      
      <tag>WRF</tag>
      
      <tag>MPAS</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>AI for Numerical Weather Prediction (NWP)</title>
    <link href="/2024/10/09/AI-for-Numerical-Weather-Prediction-NWP/"/>
    <url>/2024/10/09/AI-for-Numerical-Weather-Prediction-NWP/</url>
    
    <content type="html"><![CDATA[<h1 id="introduction-to-ai-in-numerical-weather-prediction">Introduction to AI in Numerical Weather Prediction</h1><p>Artificial Intelligence (AI) is transforming the field of Numerical Weather Prediction (NWP), significantly enhancing the accuracy and efficiency of weather forecasting. Traditional NWP relies on complex physical models to simulate atmospheric processes, but the integration of AI and machine learning (ML) is introducing new methodologies that leverage vast datasets to improve predictions.</p><p>AI technologies, particularly machine learning algorithms, excel at analyzing large volumes of meteorological data from diverse sources, including satellites, radar systems, and surface sensors. These algorithms can identify intricate patterns and correlations that may be overlooked by conventional methods, leading to more precise forecasts. For instance, models like Google DeepMind's GraphCast can predict weather conditions up to ten days in advance in less than a minute, outperforming traditional systems that require hours on supercomputers.</p><div class="note note-warning">            <p><a href="https://www.ecmwf.int/en/about/media-centre/aifs-blog">ECMWF | AIFS Blog</a></p>          </div><ul><li><a href="https://charts.ecmwf.int/products/plwww_3m_fc_aifs_wp_mean?area=Northern%20Extra-tropics&amp;parameter=Geopotential%20500hPa&amp;score=Root%20mean%20square%20error">Scores of forecasts of upper-air parameters by AIFS - experimental machine learning model</a> <!-- - [Scores of forecasts of upper-air parameters by experimental machine learning models](https://charts.ecmwf.int/streaming/20241009-0750/81/ps2png-worker-commands-76f744c54b-4xnd6-6fe5cac1a363ec1525f54343b6cc9fd8-zisedq81.png)![ECMWF | Scores of forecasts of upper-air parameters by experimental machine learning models **(Higher is better)**](https://charts.ecmwf.int/streaming/20241009-0750/81/ps2png-worker-commands-76f744c54b-4xnd6-6fe5cac1a363ec1525f54343b6cc9fd8-zisedq81.png)![ECMWF | Scores of forecasts of upper-air parameters by experimental machine learning models **(Lower is better)**](https://charts.ecmwf.int/streaming/20241009-0710/e3/ps2png-worker-commands-76f744c54b-rk8tn-6fe5cac1a363ec1525f54343b6cc9fd8-ue79gh2y.png) --></li></ul><h1 id="run-ai-models-yourself-from-ecmwf-open-data">Run AI models yourself from ECMWF open data</h1><p>26 September 2024<br />The AIFS team</p><ul><li><a href="https://www.ecmwf.int/en/about/media-centre/aifs-blog/2024/run-ai-models-yourself-ecmwf-open-data" class="uri">https://www.ecmwf.int/en/about/media-centre/aifs-blog/2024/run-ai-models-yourself-ecmwf-open-data</a></li><li>To announce that users can now run AI models using ECMWF's open data themselves. This breakthrough democratizes access to cutting-edge weather forecasting technology and opens new possibilities for research, education, and application development.</li><li>success of machine learning models like FourCastNet, Pangu-Weather, GraphCast and FuXi, ECMWF is now empowering users to harness these AI tools directly.</li></ul><h2 id="the-power-of-open-data-and-ai">The power of open data and AI</h2><p>By combining ECMWF's high-quality open data with state-of-the-art AI models, users can:</p><ul><li>generate rapid forecasts on their own computer</li><li>explore multi-model ensemble forecasting techniques with AI</li><li>conduct research on model performance and intercomparison without any accounts/licences.</li><li><strong>Plugins already exist for Pangu-Weather, FourCastNet (versions 1 and 2), GraphCast, FuXi and, most recently, Aurora.</strong></li><li><a href="https://github.com/ecmwf-lab/ai-models" class="uri">https://github.com/ecmwf-lab/ai-models</a></li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh">pip install ai-models <br><br>pip install ai-models-panguweather <span class="hljs-comment"># Or another model </span><br>pip install ai-models-fourcastnet<br>pip install ai-models-graphcast  <span class="hljs-comment"># Install details at https://github.com/ecmwf-lab/ai-models-graphcast</span><br>pip install ai-models-fourcastnetv2 <br><br>ai-models panguweather --input ecmwf-open-data <br></code></pre></td></tr></table></figure><p>See</p><ul><li><a href="https://github.com/ecmwf-lab/ai-models-panguweather">ai-models-panguweather</a>,</li><li><a href="ai-models-fourcastnet">ai-models-fourcastnet</a>,</li><li><a href="ai-models-fourcastnetv2">ai-models-fourcastnetv2</a> and</li><li><a href="ai-models-graphcast">ai-models-graphcast</a></li></ul><p>for more details about these models.</p><div class="note note-warning">            <p>To fix ONNX or version issue, we suggest that you <strong>install ai-models in a conda environment and install the CUDA libraries in that environment</strong>.</p>          </div><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh">conda create -n ai-models python=3.10<br>conda activate ai-models<br>conda install cudatoolkit<br>pip install ai-models<br>...<br></code></pre></td></tr></table></figure><h3 id="running-the-models">Running the models</h3><p>To run model, make sure it has been installed, then simply run:</p><div class="note note-warning">            <p>By default, the model will be run for <strong>a 10-day lead time (240 hours)</strong>, using <strong>yesterday's 12Z analysis</strong> from ECMWF's MARS archive.</p>          </div><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">ai-models &lt;model-name&gt;<br><br><span class="hljs-comment"># To produce a 15 days forecast, use the --lead-time HOURS option:</span><br>ai-models --lead-time 360 &lt;model-name&gt;<br></code></pre></td></tr></table></figure><h3 id="performances-considerations">Performances Considerations</h3><p>The AI models can run on a CPU; however, they perform significantly better on a GPU.</p><div class="note note-warning">            <p><strong>A 10-day forecast can take several hours on a CPU but only around one minute on a modern GPU.</strong></p>          </div><div class="note note-warning">            <p><strong>We strongly recommend running these models on a computer equipped with a GPU for optimal performance.</strong></p>          </div><p>It you see the following message when running a model, it means that the <strong>ONNX runtime was not able to find a the CUDA libraries on your system</strong>:</p><blockquote><p>[W:onnxruntime:Default, onnxruntime_pybind_state.cc:541 CreateExecutionProviderInstance] Failed to create CUDAExecutionProvider. Please reference https://onnxruntime.ai/docs/reference/execution-providers/CUDA-ExecutionProvider.html#requirements to ensure all dependencies are met.</p></blockquote><h3 id="assets">Assets</h3><p>The AI models rely on weights and other assets created during training. The first time you run a model, you will need to download the <strong>trained weights</strong> and <strong>any additional required assets</strong>.</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># To download the assets before running a model, use the following command:</span><br>ai-models --download-assets &lt;model-name&gt;<br><br><span class="hljs-comment"># The assets will be downloaded if needed and stored in the current directory. You can provide a different directory to store the assets:</span><br>ai-models --download-assets --assets &lt;some-directory&gt; &lt;model-name&gt;<br><br><span class="hljs-comment"># Then, for running, later on, simply use:</span><br>ai-models --assets &lt;some-directory&gt;  &lt;model-name&gt;<br><span class="hljs-comment"># or </span><br><span class="hljs-built_in">export</span> AI_MODELS_ASSETS=&lt;some-directory&gt;<br>ai-models &lt;model-name&gt;<br></code></pre></td></tr></table></figure><p>For better organisation of the assets directory, you can use the <strong>--assets-sub-directory</strong> option. This option will store the assets of each model in its own subdirectory within the specified assets directory.</p><h3 id="input-data">Input data</h3><p>The models require input data (initial conditions) to run. You can provide the input data using different sources, as described below:</p><h4 id="from-mars">From MARS</h4><div class="note note-warning">            <p>By default, <strong>ai-models use yesterday's 12Z analysis from ECMWF</strong>, fetched from the Centre's MARS archive using the <a href="https://www.ecmwf.int/en/computing/software/ecmwf-web-api">ECMWF WebAPI</a>. <strong>You will need an ECMWF account to access that service</strong>.</p>          </div><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># To change the date or time, use the --date and --time options, respectively:</span><br><br>ai-models --<span class="hljs-built_in">date</span> YYYYMMDD --time HHMM &lt;model-name&gt;<br></code></pre></td></tr></table></figure><h4 id="from-the-cds-era5">From the CDS (ERA5)</h4><p>You can start the models <strong>using ERA5 (ECMWF Reanalysis version 5) data</strong> for the <a href="https://cds.climate.copernicus.eu/">Copernicus Climate Data Store (CDS)</a>. You will need to create an account on the CDS. The data will be downloaded using the <a href="https://cds.climate.copernicus.eu/api-how-to">CDS API</a>).</p><p>To access the CDS, simply add <strong>--input cds</strong> on the command line. <strong>Please note that ERA5 data is added to the CDS with a delay</strong>, so you will also have to provide a date with --date YYYYMMDD.</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">ai-models --input cds --<span class="hljs-built_in">date</span> 20230110 --time 0000 &lt;model-name&gt;<br></code></pre></td></tr></table></figure><h4 id="from-a-grib-file">From a GRIB file</h4><p>If you have input data in the GRIB format, you can provide the file using the <strong>--file</strong> option:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">ai-models --file &lt;some-grib-file&gt; &lt;model-name&gt;<br></code></pre></td></tr></table></figure><div class="note note-warning">            <p>The GRIB file can contain more fields than the ones required by the model. The ai-models command will automatically select the necessary fields from the file.</p>          </div><div class="note note-warning">            <p>GFS grib files?</p>          </div><p>To find out the list of fields needed by a specific model as initial conditions, use the following command:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">ai-models --fields &lt;model-name&gt;<br></code></pre></td></tr></table></figure><h3 id="output">Output</h3><p>By default, the model output will be written in GRIB format in a file called <strong>&lt;model-name&gt;.grib</strong>. You can change the file name with the option <strong>--path <file-name></strong>. If the path you specify contains placeholders between { and }, multiple files will be created based on the <a href="https://confluence.ecmwf.int/display/ECC">eccodes</a> keys. For example:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">ai-models --path <span class="hljs-string">&#x27;out-&#123;step&#125;.grib&#x27;</span> &lt;model-name&gt;<br></code></pre></td></tr></table></figure><p><strong>This command will create a file for each forecasted time step.</strong></p><p>If you want to disable writing the output to a file, use the <strong>--output none</strong> option.</p><h3 id="command-line-options">Command line options</h3><p>It has the following options:</p><ul><li><code>--help</code>: Displays this help message.</li><li><code>--models</code>: Lists all installed models.</li><li><code>--debug</code>: Turns on debug mode. This will print additional information to the console.</li></ul><h4 id="input">Input</h4><ul><li><code>--input INPUT</code>: The input source for the model. This can be a <code>mars</code>, <code>cds</code> or <code>file</code>.</li><li><p><code>--file FILE</code>: The specific file to use as input. This option will set <code>--source</code> to <code>file</code>.</p></li><li><code>--date DATE</code>: The analysis date for the model. This defaults to yesterday.</li><li><p><code>--time TIME</code>: The analysis time for the model. This defaults to 1200.</p></li></ul><h4 id="output-1">Output</h4><ul><li><code>--output OUTPUT</code>: The output destination for the model. Values are <code>file</code> or <code>none</code>.</li><li><code>--path PATH</code>: The path to write the output of the model.</li></ul><h4 id="run">Run</h4><ul><li><code>--lead-time HOURS</code>: The number of hours to forecast. The default is 240 (10 days).</li></ul><h4 id="assets-management">Assets management</h4><ul><li><code>--assets ASSETS</code>: Specifies the path to the directory containing the model assets. The default is the current directory, but you can override it by setting the <code>$AI_MODELS_ASSETS</code> environment variable.</li><li><code>--assets-sub-directory</code>: Enables organising assets in <code>&lt;assets-directory&gt;/&lt;model-name&gt;</code> subdirectories.</li><li><code>--download-assets</code>: Downloads the assets if they do not exist.</li></ul><h4 id="misc.-options">Misc. options</h4><ul><li><code>--fields</code>: Print the list of fields needed by a model as initial conditions.</li><li><code>--expver EXPVER</code>: The experiment version of the model output.</li><li><code>--class CLASS</code>: The 'class' metadata of the model output.</li><li><code>--metadata KEY=VALUE</code>: Additional metadata metadata in the model output</li></ul><h1 id="available-products">Available products</h1><p>The output of these ML models are forecasts with 6-hourly time steps out to 10 days initialised from the ECMWF operational analysis. All forecasts are produced on a 0.25 x 0.25-degree grid.</p><h2 id="fourcastnetv2-small">FourCastNetv2-small:</h2><p>Upper-air fields are z (geopotential), r (relative humidity), t (temperature), u (U component of wind), and v (V component of wind) on the following pressure levels: 1000hPa, 925hPa, 850hPa, 700hPa, 600hPa, 500hPa, 400hP, 300hPa, 250hPa, 200hPa, 150hPa, 100hPa and 50hPa</p><p>The single-level fields are msl (mean sea level pressure), sp (surface pressure), 10u (10 metre U wind component), 10v (10 metre U wind component), 100u (100 metre U wind component), 100v (100 metre V wind component, 2t (2 metre temperature) and tcwv (total column vertically-integrated water vapour).</p><h2 id="graphcast">Graphcast:</h2><p>Upper-air fields are z (geopotential), q (specific humidity), t (temperature), u (U component of wind), v (V component of wind), w (vertical wind component) on the following pressure levels: 1000hPa, 925hPa, 850hPa, 700hPa, 600hPa, 500hPa, 400hP, 300hPa, 250hPa, 200hPa, 150hPa, 100hPa and 50hPa</p><p>The single-level fields are msl (mean sea level pressure), 10u (10 metre U wind component), 10v (10 metre U wind component), and 2t (2 metre temperature).</p><h2 id="pangu-weather">Pangu-Weather:</h2><p>Upper-air fields are z (geopotential), q (specific humidity), t (temperature), u (U component of wind), and v (V component of wind) on the following pressure levels: 1000hPa, 925hPa, 850hPa, 700hPa, 600hPa, 500hPa, 400hPa, 300hPa, 250hPa, 200hPa, 150hPa, 100hPa and 50hPa</p><p>The single-level fields are msl (mean sea level pressure), 10u (10 metre U wind component), 10v (10 metre U wind component) and 2t (2 metre temperature).</p><h1 id="hands-on">Hands-on</h1><h1 id="gnn-for-limited-area-modeling">GNN for Limited Area Modeling</h1><ul><li>Oskarsson, J., Landelius, T., &amp; Lindsten, F. (2023). Graph-based Neural Weather Prediction for Limited Area Modeling. <a href="https://arxiv.org/pdf/2309.17370">arXiv preprint arXiv:2309.17370</a>.<ul><li><a href="https://github.com/mllam/neural-lam" class="uri">https://github.com/mllam/neural-lam</a></li><li>adapt the graph-based NeurWP approach to the limited area setting and propose a multi-scale hierarchical model extension</li><li>utilize Graph Neural Networks (GNNs) to produce forecasts</li><li>Global: GraphCast model</li><li>Hierarchical Graph Neural Networks (MultiScale MeshGraphNets: <a href="https://arxiv.org/pdf/2210.00612" class="uri">https://arxiv.org/pdf/2210.00612</a>)</li></ul></li></ul><h1 id="references">References</h1><ol type="1"><li><a href="https://www.ecmwf.int/en/about/media-centre/aifs-blog">ECMWF | AIFS Blog</a></li><li><a href="https://www.ecmwf.int/en/about/media-centre/aifs-blog/2024/run-ai-models-yourself-ecmwf-open-data">ECMWF | 2024 Run AI models yourself from ECMWF open data</a></li><li><a href="https://www.ecmwf.int/en/about/media-centre/aifs-blog/2024/data-driven-regional-modelling">ECMWF | 2024 Data-driven regional modelling</a><ul><li>some great work for limited-area modelling with Neural-LAM (Oskarsson et al. 2023).</li><li>In contrast to Neural-LAM, the approach we are currently testing keeps a global model. Over the domain where high-resolution data are available, here the Nordics, a finer-resolution graph is used in the model, to be able to ingest and output data from high-resolution regional analysis, reanalysis or forecast datasets.</li></ul></li><li><a href="https://www.ecmwf.int/en/about/media-centre/aifs-blog/2024/enter-ensembles">ECMWF | 2024 Enter the ensembles</a></li><li><a href="https://www.ecmwf.int/en/forecasts/dataset/machine-learning-model-data">ECMWF | 2023 Machine Learning model data</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>ML</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NWP</tag>
      
      <tag>AI</tag>
      
      <tag>ML</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>WRF | Reduce the amount of wrfout data</title>
    <link href="/2024/10/08/reduce-wrfout-size/"/>
    <url>/2024/10/08/reduce-wrfout-size/</url>
    
    <content type="html"><![CDATA[<h1 id="how-to-reduce-the-amount-of-wrfout-data">How to reduce the amount of wrfout data</h1><ul><li><a href="https://forum.mmm.ucar.edu/threads/how-to-reduce-the-amount-of-wrfout-data.8642/">How to reduce the amount of wrfout data</a></li></ul><p>Two methods,</p><ul><li>Go into the WRF/Registry/Registry.EM_COMMON file, and then look for the variables you donâ€™t want. You can remove the â€˜hâ€™ from out I/O column. After you do this for all of the variables you want removed, you will need to save the file, go back to the WRF/ directory, issue a â€˜clean -aâ€™ and then reconfigure and recompile</li><li>You can also use the Runtime I/O option, which will allow you to add a couple lines to your namelist, and create a text file that the model will read when it is run. With this method, you don't have to recompile the code, but you have to be careful to type everything correctly, and have no spaces in the text file. You can read about it here: <a href="http://www2.mmm.ucar.edu/wrf/users/docs/user_guide_v4/v4.1/users_guide_chap5.html#runtimeio" class="uri">http://www2.mmm.ucar.edu/wrf/users/docs/user_guide_v4/v4.1/users_guide_chap5.html#runtimeio</a></li></ul><div class="note note-warning">            <p>Just be careful removing variables. If you ever want to go back and plot specific things, or if you will use the files for anything else later, you may be missing something you didn't realize you would need.</p>          </div><h1 id="iofields_filename-not-working-wrfv4">iofields_filename not working WRFv4</h1><ul><li><a href="https://forum.mmm.ucar.edu/threads/iofields_filename-not-working-wrfv4.12353/#post-29058">iofields_filename not working WRFv4</a></li><li>iofields_filename = 'myoutfields.txt','youtfields.txt','myoutfields.txt','myoutfields.txt',</li><li>Your 'myoutfields.txt' file is set up like <figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs text">-:h:0:Times,LU_INDEX,ZS,DZS,FNM<br>-:h:0:FNP,RDNW,RDN,DNW,DN,CFN<br>-:h:0:CFN1,THIS_IS_AN_IDEAL_RUN<br>-:h:0:CF1,CF2,CF3,ITIMESTEP<br>-:h:0:SHDMAX,SHDMIN,SNOALB,TSLB<br>-:h:0:SMOIS,SH2O,SMCREL,SFROFF<br></code></pre></td></tr></table></figure></li></ul><p>But it should all be on a single line. Change the file so that it's in the following format:</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs text">-:h:0:Times,LU_INDEX,ZS,DZS,FNM,FNP,RDNW,RDN,DNW,DN,CFN,CFN1,THIS_IS_AN_IDEAL_RUN,CF1,CF2,CF3,ITIMESTEP<br></code></pre></td></tr></table></figure><div class="note note-warning">            <p>I also had to remove the variable "Times" from the myoutfields.txt file to get it to run correctly, so you may need to do that, as well. Hopefully these will fix the problem.</p>          </div><h1 id="æ¸›å°‘wrfoutè¼¸å‡ºè®Šæ•¸">æ¸›å°‘wrfoutè¼¸å‡ºè®Šæ•¸</h1><ul><li><a href="https://mp.weixin.qq.com/s/wIeD4TjlZus-3HeHQRxfvw">æ¸›å°‘wrfoutè¼¸å‡ºè®Šæ•¸</a></li><li>å…·é«”æ–¹æ³•åœ¨userguideä¸­ä¹Ÿæåˆ°éï¼Œå¯ä»¥é€éä¿®æ”¹Registryä¾†å¯¦ç¾ï¼ŒARWæ ¸å¿ƒå°æ‡‰çš„æ˜¯Registry/Registry.EM_COMMONæ–‡ä»¶ï¼Œå°å…¶ä¿®æ”¹ï¼Œç„¶å¾Œå†é‡æ–°ç·¨è­¯ï¼ˆclean -aã€configureã€compileï¼‰ã€‚</li><li>ä½†åœ¨3.2ç‰ˆæœ¬å¾Œï¼Œå¯ä»¥é€éç›´æ¥åœ¨namelist.inputä¸­å¯ä»¥æŒ‡å®šå‰”é™¤ä¸éœ€è¦è¼¸å‡ºçš„è®Šé‡ï¼Œå³ï¼š <figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs text">&amp;time_control<br>iofields_filename = &quot;my_file_d01.txt&quot;, &quot;my_file_d02.txt&quot;<br>ignore_iofields_warning = .true.,<br></code></pre></td></tr></table></figure></li></ul><p>åœ¨my_file_d01.txtæª”æ¡ˆä¸­ï¼Œå¯ä»¥æŒ‡æ˜éœ€è¦åˆªé™¤çš„è®Šæ•¸æœ‰å“ªäº›ï¼Œå…·é«”å…§å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs text">-:h:0:RAINC,RAINNC<br></code></pre></td></tr></table></figure><ul><li><p><strong>-</strong> è¡¨ç¤ºåˆªé™¤ï¼Œ<strong>+</strong> è¡¨ç¤ºå¢åŠ ï¼›</p></li><li><p><strong>h</strong> è¡¨ç¤ºhistoryï¼Œé€™è£¡å¯ä»¥ç†è§£ç‚ºè¼¸å‡ºï¼Œiè¡¨ç¤ºè¼¸å…¥ï¼›</p></li><li><p><strong>0-24</strong> ï¼šè¡¨ç¤ºç¶“éçš„é€šé“ï¼Œä¸€èˆ¬ <strong>é è¨­0</strong> ï¼›</p></li></ul><p>å¯ä»¥ç›´æ¥é€²è¡Œæ›è¡Œï¼Œä½†æ¯ä¸€è¡Œçš„é–‹é ­éœ€è¦é¡ä¼¼ <strong>-:h:0:æ ¼å¼</strong>ï¼Œç„¶å¾Œå¾Œé¢çš„è®Šæ•¸ä¹‹é–“ç”¨è‹±æ–‡é€—è™Ÿéš”é–‹ã€‚</p><ul><li>ignore_iofields_warningè¡¨ç¤ºç¢°åˆ°éŒ¯èª¤æ™‚å¦‚ä½•è™•ç†ï¼Œå¦‚æœè¨­å®šç‚º.true.å‰‡æœƒåˆ—å°è­¦å‘Šè¨Šæ¯ä¸”ç¹¼çºŒé‹è¡Œï¼Œå¦‚æœè¨­å®šç‚º.false.æ™‚ç¢°åˆ°éŒ¯èª¤æœƒç›´æ¥ä¸­æ–·ï¼Œå»ºè­°è¨­å®šç‚º.true.ï¼Œæ‰€æœ‰çš„domainéƒ½é€šç”¨ï¼Œä¸ç”¨å–®ç¨è¨­å®šã€‚</li></ul><p>å…¶ä¸­è¨»æ„äº‹é …åŒ…æ‹¬ï¼š</p><ul><li>å¤šå€‹domainå¯ä»¥ä½¿ç”¨åŒä¸€å€‹æ§è£½æ–‡ä»¶ï¼Œé¡ä¼¼ä¸Šé¢çš„ my_file_d01.txt;</li><li>my_file_d01.txtæª”æ¡ˆä¸­çš„è®Šæ•¸éœ€å®Œå…¨æ­£ç¢ºï¼Œå¦‚æœæŸå€‹è®Šæ•¸è¨­å®šä¸æ­£ç¢ºï¼Œå¯ä»¥æ­£å¸¸åŸ·è¡Œï¼Œä½†æœƒå‡ºç¾warningï¼Œå¦‚ä¸‹ï¼šWARNING: Unable to modify mask for wdntc. Variable not found. File: my_file_d01.txt at line 4ï¼Œæ ¹æ“šå ±éŒ¯å¯ä»¥ç™¼ç¾ç¬¬4è¡Œçš„wdntcä¸æ­£ç¢ºï¼Œé‡æ–°ä¿®æ”¹ä»¥å¾Œå¯ä»¥æ­£å¸¸é‹ä½œã€‚</li></ul>]]></content>
    
    
    <categories>
      
      <category>WRF</category>
      
    </categories>
    
    
    <tags>
      
      <tag>wrfout</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Global map of Local Climate Zones (LCZ)</title>
    <link href="/2024/10/07/Global-LCZ-for-Urban/"/>
    <url>/2024/10/07/Global-LCZ-for-Urban/</url>
    
    <content type="html"><![CDATA[<h1 id="global-map-of-local-climate-zones">Global map of Local Climate Zones</h1><ul><li><a href="https://zenodo.org/records/8419340" class="uri">https://zenodo.org/records/8419340</a></li></ul><h2 id="description">Description</h2><figure><img src="https://i.imgur.com/46uEI6Z.png" alt="A global 100 m spatial resolution Local Climate Zone (LCZ) map" /><figcaption>A global 100 m spatial resolution Local Climate Zone (LCZ) map</figcaption></figure><p>A global 100 m spatial resolution Local Climate Zone (LCZ) map, derived from multiple earth observation datasets and expert LCZ class labels.</p><p>The LCZ map is based on the LCZ typology (Stewart and Oke, 2012) that distinguish urban surfaces accounting for their typical combination of micro-scale land-covers and associated physical properties. The LCZ scheme is distinguished from other land use / land cover schemes by its focus on urban and rural landscape types, which can be described by any of the 17 classes in the LCZ scheme.</p><p>Out of the 17 LCZ classes, 10 reflect the 'built' environment, and each LCZ type is associated with generic numerical descriptions of key urban canopy parameters critical to model atmospheric responses to urbanisation. In addition, since LCZs were originally designed as a new framework for urban heat island studies (Stewart and Oke, 2012), they also contain a limited set (7) of 'natural' land-cover classes that can be used as 'control' or 'natural reference' areas. As these seven natural classes in the LCZ scheme can not capture the heterogeneity of the worldâ€™s existing natural ecosystems, we advise users - if required - to combine the built LCZ classes with any other land-cover product that provides a wider range of natural land-cover classes.</p><ul><li>Stewart ID, Oke TR. (2012). Local Climate Zones for Urban Temperature Studies. Bull Am Meteorol Soc. 93(12):1879-1900. doi:10.1175/BAMS-D-11-00019.1</li></ul><h2 id="versions">Versions</h2><p>If there are there multiple versions of the dataset, list the file updated, when and why update was made:</p><ul><li>_v1: initial release of the data (20220222)</li><li>_v2: add LCZ map of Iceland, consistent with the global LCZ map procedure (20221115)</li><li>_v3: Mosaicing two Global Forest Canopy Height products two cover remote areas (eg. islands) (20231008)</li></ul><h2 id="files-and-brief-description">Files and brief description</h2><p>Files and brief description:</p><ol type="1"><li><strong>lcz_filter_v3.tif</strong></li></ol><div class="note note-primary">            <p>The recommended global LCZ map, compressed as GeoTIFF, with LCZ classes indicated by numbers 1-17</p>          </div><p><strong>The recommended global LCZ map, compressed as GeoTIFF, with LCZ classes indicated by numbers 1-17</strong>. LCZ labels are obtained after applying the morphological Gaussian filter described in Demuzere et al. (2020). The official color scheme - as indicated in the table below - is embedded into the GeoTIFF.</p><figure><img src="https://i.imgur.com/pRByENm.jpeg" alt="Official class description" /><figcaption>Official class description</figcaption></figure><p>The table below describes,</p><table><thead><tr class="header"><th style="text-align: left;">LCZ class number</th><th style="text-align: center;">Official class description</th><th style="text-align: left;">Official hex color</th></tr></thead><tbody><tr class="odd"><td style="text-align: left;">LCZ 1</td><td style="text-align: center;">Compact highrise</td><td style="text-align: left;">'#910613'</td></tr><tr class="even"><td style="text-align: left;">LCZ 2</td><td style="text-align: center;">Compact midrise</td><td style="text-align: left;">'#D9081C'</td></tr><tr class="odd"><td style="text-align: left;">LCZ 3</td><td style="text-align: center;">Compact lowrise</td><td style="text-align: left;">'#FF0A22'</td></tr><tr class="even"><td style="text-align: left;">LCZ 4</td><td style="text-align: center;">Open highrise</td><td style="text-align: left;">'#C54F1E'</td></tr><tr class="odd"><td style="text-align: left;">LCZ 5</td><td style="text-align: center;">Open midrise</td><td style="text-align: left;">'#FF6628'</td></tr><tr class="even"><td style="text-align: left;">LCZ 6</td><td style="text-align: center;">Open lowrise</td><td style="text-align: left;">'#FF985E'</td></tr><tr class="odd"><td style="text-align: left;">LCZ 7</td><td style="text-align: center;">Lightweight low-rise</td><td style="text-align: left;">'#FDED3F'</td></tr><tr class="even"><td style="text-align: left;">LCZ 8</td><td style="text-align: center;">Large lowrise</td><td style="text-align: left;">'#BBBBBB'</td></tr><tr class="odd"><td style="text-align: left;">LCZ 9</td><td style="text-align: center;">Sparsely built</td><td style="text-align: left;">'#FFCBAB'</td></tr><tr class="even"><td style="text-align: left;">LCZ 10</td><td style="text-align: center;">Heavy Industry</td><td style="text-align: left;">'#565656'</td></tr><tr class="odd"><td style="text-align: left;">LCZ 11 (A)</td><td style="text-align: center;">Dense trees</td><td style="text-align: left;">'#006A18'</td></tr><tr class="even"><td style="text-align: left;">LCZ 12 (B)</td><td style="text-align: center;">Scattered trees</td><td style="text-align: left;">'#00A926'</td></tr><tr class="odd"><td style="text-align: left;">LCZ 13 (C)</td><td style="text-align: center;">Bush, scrub</td><td style="text-align: left;">'#628432'</td></tr><tr class="even"><td style="text-align: left;">LCZ 14 (D)</td><td style="text-align: center;">Low plants</td><td style="text-align: left;">'#B5DA7F'</td></tr><tr class="odd"><td style="text-align: left;">LCZ 15 (E)</td><td style="text-align: center;">Bare rock or paved</td><td style="text-align: left;">'#000000'</td></tr><tr class="even"><td style="text-align: left;">LCZ 16 (F)</td><td style="text-align: center;">Bare soil or sand</td><td style="text-align: left;">'#FCF7B1'</td></tr><tr class="odd"><td style="text-align: left;">LCZ 17 (G)</td><td style="text-align: center;">Water</td><td style="text-align: left;">'#656BFA'</td></tr></tbody></table><p>Other characteristics: - Projection: World Geodetic System 1984 (EPSG:4326) - Size: 389620, 155995 - Spatial Resolution: 0.000898Â° (~ 100 m) - Representative for the nominal year of 2018</p><ol type="1"><li>lcz_v3.tif</li></ol><p>Same as 1., but presenting the raw LCZ map, <strong>before applying the morphological Gaussian filter.</strong></p><ol start="3" type="1"><li>lcz_probability_v3.tif</li></ol><p>A probability layer (%) that identifies how often the modal LCZ was chosen per pixel (e.g. a probability of 60% means that the modal LCZ class was mapped 30 times out of 50 LCZ models). This is a pixel-based probability, derived from the lcz_v3.tif map.</p><h1 id="convert-tif-to-netcdf">Convert tif to netcdf</h1><p>GDAL is a translator library for raster and vector geospatial data formats that is released under an MIT style Open Source License by the Open Source Geospatial Foundation</p><p>https://gdal.org/</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">micromamba <span class="hljs-built_in">env</span> create -n gdal<br>micromamba install -c conda-forge gdal=3.6.1<br></code></pre></td></tr></table></figure><p>and then,</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh">whereis gdal_translate<br><br><span class="hljs-comment"># for checking</span><br>gdal_translate --long-usage<br><br>gdal_translate -of netCDF -co <span class="hljs-string">&quot;FOMRAT=NC4&quot;</span> lcz_filter_v3.tif lcz_filter_v3.nc <br></code></pre></td></tr></table></figure><p>The detail of file,</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs text">netcdf lcz_filter_v3 &#123;<br>dimensions:<br>lon = 389620 ;<br>lat = 155995 ;<br>variables:<br>char crs ;<br>crs:grid_mapping_name = &quot;latitude_longitude&quot; ;<br>crs:long_name = &quot;CRS definition&quot; ;<br>crs:longitude_of_prime_meridian = 0. ;<br>crs:semi_major_axis = 6378137. ;<br>crs:inverse_flattening = 298.257223563 ;<br>crs:spatial_ref = &quot;GEOGCS[\&quot;WGS 84\&quot;,DATUM[\&quot;WGS_1984\&quot;,SPHEROID[\&quot;WGS 84\&quot;,6378137,298.257223563,AUTHORITY[\&quot;EPSG\&quot;,\&quot;7030\&quot;]],AUTHORITY[\&quot;EPSG\&quot;,\&quot;6326\&quot;]],PRIMEM[\&quot;Greenwich\&quot;,0,AUTHORITY[\&quot;EPSG\&quot;,\&quot;8901\&quot;]],UNIT[\&quot;degree\&quot;,0.0174532925199433,AUTHORITY[\&quot;EPSG\&quot;,\&quot;9122\&quot;]],AXIS[\&quot;Latitude\&quot;,NORTH],AXIS[\&quot;Longitude\&quot;,EAST],AUTHORITY[\&quot;EPSG\&quot;,\&quot;4326\&quot;]]&quot; ;<br>crs:crs_wkt = &quot;GEOGCS[\&quot;WGS 84\&quot;,DATUM[\&quot;WGS_1984\&quot;,SPHEROID[\&quot;WGS 84\&quot;,6378137,298.257223563,AUTHORITY[\&quot;EPSG\&quot;,\&quot;7030\&quot;]],AUTHORITY[\&quot;EPSG\&quot;,\&quot;6326\&quot;]],PRIMEM[\&quot;Greenwich\&quot;,0,AUTHORITY[\&quot;EPSG\&quot;,\&quot;8901\&quot;]],UNIT[\&quot;degree\&quot;,0.0174532925199433,AUTHORITY[\&quot;EPSG\&quot;,\&quot;9122\&quot;]],AXIS[\&quot;Latitude\&quot;,NORTH],AXIS[\&quot;Longitude\&quot;,EAST],AUTHORITY[\&quot;EPSG\&quot;,\&quot;4326\&quot;]]&quot; ;<br>crs:GeoTransform = &quot;-170.0007776279147 0.000898315284119518 0 80.03809518448114 0 -0.000898315284119518 &quot; ;<br>double lat(lat) ;<br>lat:standard_name = &quot;latitude&quot; ;<br>lat:long_name = &quot;latitude&quot; ;<br>lat:units = &quot;degrees_north&quot; ;<br>double lon(lon) ;<br>lon:standard_name = &quot;longitude&quot; ;<br>lon:long_name = &quot;longitude&quot; ;<br>lon:units = &quot;degrees_east&quot; ;<br>byte Band1(lat, lon) ;<br>Band1:long_name = &quot;GDAL Band Number 1&quot; ;<br>Band1:_Unsigned = &quot;true&quot; ;<br>Band1:valid_range = 0s, 255s ;<br>Band1:_FillValue = 0b ;<br>Band1:grid_mapping = &quot;crs&quot; ;<br><br>// global attributes:<br>:GDAL_AREA_OR_POINT = &quot;Area&quot; ;<br>:Conventions = &quot;CF-1.5&quot; ;<br>:GDAL = &quot;GDAL 3.6.1, released 2022/12/14&quot; ;<br>:history = &quot;Mon Oct 07 12:05:03 2024: GDAL CreateCopy( lcz_filter_v3.nc, ... )&quot; ;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="part-of-lcz-dataset">Part of LCZ dataset</h1><p>Global tiff is large, and if we only consider a specific area like GBA/Tokyo/Houston.</p><p>Fast and easy Local Climate Zone mapping</p><p>https://lcz-generator.rub.de/</p><ul><li>China, People's Republic of - Hong Kong-Macau-Guangdong Greater Bay Area:<ul><li>https://lcz-generator.rub.de/factsheets/c672ca892c88d1e078a81e7a085913396172f81c/c672ca892c88d1e078a81e7a085913396172f81c_factsheet.html</li></ul></li><li>Japan - Tokyo:<ul><li>https://lcz-generator.rub.de/factsheets/67a3371158ad3ac12d720fde089622c259e8e400/67a3371158ad3ac12d720fde089622c259e8e400_factsheet.html</li></ul></li><li>United States of America - Houston:<ul><li>https://lcz-generator.rub.de/factsheets/037c80744fc1034b8472f594d829c53ce1cccfa7/037c80744fc1034b8472f594d829c53ce1cccfa7_factsheet.html</li></ul></li></ul><p><img src="" /></p><div class="group-image-container"><div class="group-image-row"><div class="group-image-wrap"><img src="https://i.imgur.com/4pyAoGS.jpeg" alt="GBA" /></div></div><div class="group-image-row"><div class="group-image-wrap"><img src="https://i.imgur.com/rO8Cz9d.jpeg" alt="Tokyo" /></div><div class="group-image-wrap"><img src="https://i.imgur.com/b3plh7O.jpeg" alt="Houston" /></div></div></div><figure><img src="https://i.imgur.com/lGIE5ba.png" alt="ncview" /><figcaption>ncview</figcaption></figure><h1 id="references">References</h1><ol type="1"><li>Demuzere, M., Kittner, J., &amp; Bechtel, B. (2021). LCZ Generator: a web application to create Local Climate Zone maps. Frontiers in Environmental Science, 9, 637455.</li><li>Zhao, N., Ma, A., Zhong, Y., Zhao, J., &amp; Cao, L. (2019). Self-training classification framework with spatial-contextual information for local climate zones. Remote Sensing, 11(23), 2828.</li><li>æ¨ä¿Š, ä»»å˜‰ä¹‰, äºæ–‡åš. å±€åœ°æ°”å€™åˆ†åŒºè§†è§’ä¸‹åŸå¸‚æ°”å€™ä¸äººå±…ç¯å¢ƒç ”ç©¶è¿›å±•. ç”Ÿæ€å­¦æŠ¥, 2024, 44(11): 4489-4506.<ol type="1"><li>äº†è§£äººå±…ç¯å¢ƒä¸­çš„æ°”å€™é—®é¢˜æ˜¯ä¸»åŠ¨æ”¹å–„å’Œæå‡çš„é¦–è¦æ¡ä»¶ã€‚è¿™åœ¨ä¼ ç»Ÿç ”ç©¶ä¸­å·²æœ‰å¤§é‡æˆæœ, å¦‚åŸºäºâ€œåŸ-éƒŠâ€äºŒå…ƒæ¡†æ¶è®¡ç®—åŸå¸‚çƒ­å²›å¼ºåº¦å¹¶æ¢è®¨åŸéƒŠçƒ­åŠ›å·®å¼‚[4â€”6]ï¼›ç»“åˆåœŸåœ°åˆ©ç”¨/åœŸåœ°è¦†è¢«åˆ†æåŸå¸‚çƒ­åŠ›æ™¯è§‚æ—¶ç©ºç‰¹å¾[7â€”9]ï¼›åˆ†æé•¿æ—¶é—´åºåˆ—ä¸‹æç«¯å¤©æ°”ã€çƒ­æµªäº‹ä»¶å‘ç”Ÿé¢‘ç‡å’ŒæŒç»­æ—¶é—´[10â€”12]ï¼›æ¢ç©¶ç©ºæ°”æ±¡æŸ“ä¸åŸå¸‚åŠŸèƒ½åŒºçš„è€¦åˆå…³ç³»[13â€”15]ï¼›ä»¥åŠå®šé‡è¯„ä»·æ°”å€™å˜åŒ–å¯¼è‡´çš„çƒ­é£é™©å’Œç”Ÿæ€é£é™©ç­‰[16â€”18]ã€‚ç ”ç©¶æ™®éä»¥åŸå¸‚è¡Œæ”¿è¾¹ç•Œæˆ–äººå£æ¢¯åº¦ä¸ºåŸºå‡†, å¿½è§†äº†ç›¸ä¼¼åœ°ç†å•å…ƒçš„ç©ºé—´ç‰¹æ€§ã€‚2012å¹´Stewartå’ŒOkeæå‡ºå°†å±€åœ°æ°”å€™åˆ†åŒº(Local Climate Zones, LCZ)ä½œä¸ºåŸå¸‚æ°”å€™ç ”ç©¶çš„é€šç”¨æ¡†æ¶[19], å¡«è¡¥äº†ä¼ ç»Ÿæ°”å€™åˆ†ç±»åœ¨ä¸­/å¾®è§‚å°ºåº¦ç ”ç©¶ä¸­çš„å±€é™, å¾—åˆ°å¹¿æ³›è¿ç”¨ã€‚</li><li>å±€åœ°æ°”å€™åˆ†åŒºæ ¹æ®åŸå¸‚å½¢æ€ã€åœ°è¡¨è¦†ç›–ã€åœ°è¡¨ç»“æ„åŠæè´¨ç­‰å·®å¼‚, å°†åŸå¸‚ä¸‹å«é¢åˆ’åˆ†ä¸º17ä¸ªåŸºæœ¬åŒºåŸŸ, åŒ…æ‹¬10ä¸ªå»ºç­‘ç±»å‹å’Œ7ä¸ªè‡ªç„¶ç±»å‹ã€‚æ¯ä¸ªLCZéƒ½æœ‰ç‰¹å®šèŒƒå›´çš„ç›¸å…³æ°”å€™å‚æ•°, ä¸åŒLCZç±»å‹å…·æœ‰ä¸åŒçš„å±€éƒ¨æ°”å€™æ¡ä»¶(å›¾ 1)ã€‚LCZåˆ†ç±»ä½“ç³»æå‡ºç”¨ä¸¤ä¸ªLCZä¹‹é—´çš„æ¸©å·®å®šä¹‰å¹¶è®¡ç®—åŸå¸‚çƒ­å²›å¼ºåº¦[19â€”20], å…‹æœäº†ä¼ ç»Ÿç ”ç©¶ä¸­åŸä¹¡çš„åˆ»æ¿è¾¹ç•Œã€‚åŒæ—¶å»ºç«‹äº†åŸå¸‚æ°”å€™ç ”ç©¶åŸºç¡€æ¡†æ¶, è§„èŒƒäº†å…¨çƒåŸå¸‚æ°”å€™ç ”ç©¶èŒƒå¼ã€‚ç›®å‰ä¸–ç•Œå„åœ°ç ”ç©¶ç»˜åˆ¶äº†ä¸°å¯Œçš„LCZåœ°å›¾, æœ¬ç ”ç©¶å°†å¯¹å¾€æœŸæ–‡çŒ®ä¸­LCZåœ°å›¾åˆ¶ä½œæ•°æ®æºã€æ–¹æ³•å’Œå·²æœ‰LCZæ•°æ®é›†è¿›è¡Œå…¨é¢æ¢³ç†ã€‚</li></ol></li><li>è®¸äº˜æ˜±, çŸ³ç‰è“‰, &amp; å¼ å®‡å³°. (2023). è§„åˆ’æ§åˆ¶è¦ç´ è§†è§’ä¸‹åŸå¸‚çƒ­ç¯å¢ƒçš„æµ‹åº¦ä¸ä¼˜åŒ–â€”â€”ä»¥å¹¿å·ä¸­å¿ƒåŸåŒºä¸ºä¾‹. çƒ­å¸¦åœ°ç†, 43(6), 1070-1082.<ol type="1"><li>åŸå¸‚ä¸‹å«é¢ç±»åˆ«å’ŒåœŸåœ°å¼€å‘å¼ºåº¦çš„å¤šæ ·æ€§é€ æˆäº†åŸå¸‚å†…éƒ¨çƒ­å²›å¼ºåº¦çš„å·®å¼‚ã€‚Stewartç­‰ï¼ˆ2012ï¼‰åœ¨å……åˆ†è®ºè¯ä¼ ç»ŸåŸéƒŠäºŒå…ƒæ³•ç ”ç©¶åŸå¸‚çƒ­å²›é—®é¢˜çš„ä¸è¶³åï¼Œæå‡ºäº†å±€åœ°æ°”å€™åˆ†åŒºï¼ˆLocal Climate Zoneï¼Œä¸‹æ–‡ç®€ç§°LCZï¼‰ä½“ç³»ã€‚LCZå°†åŸå¸‚ä¸‹å«é¢åˆ†ä¸º10ç§å»ºæˆç±»å‹å’Œ7ç§è‡ªç„¶ç±»å‹ï¼ˆå›¾4ï¼‰ï¼Œä»¥å¤©ç©ºè§’ç³»æ•°ã€é«˜å®½æ¯”ã€å»ºç­‘å¯†åº¦ã€ä¸é€æ°´è¡¨é¢ç§¯å æ¯”ã€é€æ°´è¡¨é¢ç§¯å æ¯”ã€ç²—ç³™å…ƒé«˜åº¦ã€åœ°å½¢ç²—ç³™ç±»å‹ã€çƒ­å¯¼çº³ã€åå°„ç‡å’Œäººä¸ºçƒ­ç­‰çš„åŒºé—´ä¸ºå±æ€§ã€‚LCZç”¨å®šé‡æ–¹æ³•åŒºåˆ†åŸå¸‚çš„åœŸåœ°æ„æˆï¼Œç›¸è¾ƒäºä¼ ç»Ÿè§„åˆ’é¢†åŸŸæ–¹æ³•â€”ä»åœŸåœ°åˆ©ç”¨åŠŸèƒ½è§’åº¦å‡ºå‘çš„å®šæ€§åˆ†ç±»æ–¹æ³•ï¼Œå…¶èƒ½æ›´å¥½åœ°ä½“ç°åŠŸèƒ½ç›¸åŒçš„åœŸåœ°åˆ©ç”¨ç±»å‹åœ¨åœ°å—çš„å»ºç­‘å¯†åº¦ã€å®¹ç§¯ç‡å’Œç»¿åœ°ç‡ç­‰æ–¹é¢çš„å·®å¼‚ï¼Œä¸”å…·æœ‰åˆ†ææ¯”è¾ƒçš„æ™®é€‚æ€§ï¼ˆBechtel et al., 2015ï¼‰ï¼Œä»¥LCZä¸ºåŸºç¡€çš„åŸå¸‚çƒ­å²›å¼ºåº¦åˆ†ç±»å·²é€šè¿‡ç»éªŒå’Œæ¨¡å‹å¾—åˆ°è¯å®ï¼ˆFenner et al., 2014; Stewart et al., 2014; Leconte et al., 2015ï¼‰ã€‚</li></ol></li></ol>]]></content>
    
    
    <categories>
      
      <category>NWP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>WRF</tag>
      
      <tag>MPAS</tag>
      
      <tag>Urban</tag>
      
      <tag>UCM</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Polar Vortex | æ¥µåœ°æ¸¦æ—‹</title>
    <link href="/2024/10/04/Polar-Vortex/"/>
    <url>/2024/10/04/Polar-Vortex/</url>
    
    <content type="html"><![CDATA[<h1 id="æ¥µåœ°æ¸¦æ—‹">æ¥µåœ°æ¸¦æ—‹</h1><p>æ¥µåœ°æ¸¦æ—‹ï¼ˆPolar Vortexï¼›æˆ–æ¥µåœ°æ¼©æ¸¦ï¼‰ï¼Œæ˜¯<strong>ä¸€ç¨®ç™¼ç”Ÿæ–¼æ¥µåœ°çš„ï¼Œä»‹æ–¼å°æµå±¤èˆ‡å¹³æµå±¤çš„ä¸­ã€ä¸Šéƒ¨çš„</strong>ï¼ŒæŒçºŒæ€§ä¸”å¤§è¦æ¨¡çš„æ°£æ—‹ã€‚é€™ç¨®æ¸¦æ—‹åœ¨å†¬å­£æ¥µå¤œçš„æ™‚å€™æœ€ç‚ºå¼·å¤§ï¼Œå› ç‚ºæ­¤æ™‚çš„æº«åº¦æ¢¯åº¦æœ€å¤§ï¼›éš¨å¾ŒæœƒæŒçºŒç¸®æ¸›ï¼Œåˆ°å¤å­£æ¥µæ™å‰å¾Œç”šè‡³æœƒæ¶ˆå¤±ã€‚</p><ul><li><strong>å…©æ¥µå°æµå±¤ä¸­å±¤è‡³å¹³æµå±¤çš„ä½æ°£å£“ç³»çµ±</strong></li></ul><table><thead><tr class="header"><th style="text-align: left;">å…¸å‹çš„æ¥µåœ°æ¼©æ¸¦ï¼ˆ2013å¹´11æœˆï¼‰</th><th style="text-align: left;">å¼±å‹¢çš„æ¥µåœ°æ¼©æ¸¦ï¼ˆ2014å¹´1æœˆ5æ—¥ï¼‰</th></tr></thead><tbody><tr class="odd"><td style="text-align: left;"><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/7/76/November2013_polar_vortex_geopotentialheight_mean_Large.jpg/300px-November2013_polar_vortex_geopotentialheight_mean_Large.jpg" /></td><td style="text-align: left;"><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/b/bb/Jan52014_polar_vortex_geopotentialheight_mean_Large.jpg/300px-Jan52014_polar_vortex_geopotentialheight_mean_Large.jpg" /></td></tr></tbody></table><p>æ¥µåœ°æ¸¦æ—‹ï¼ˆPolar Vortexï¼‰æ˜¯é•·æœŸå­˜åœ¨æ–¼<strong>å…©æ¥µå°æµå±¤ä¸­å±¤è‡³å¹³æµå±¤çš„ä½æ°£å£“ç³»çµ±</strong>ï¼Œä¸€èˆ¬åˆ†ç‚ºæ•¸å€‹ä¸­å¿ƒï¼Œåˆ†ä½ˆæ–¼ä¸åŒç¶“åº¦ï¼Œæ¯å€‹ç³»çµ±ç›´å¾‘ä¸è¶…é1000å…¬é‡Œã€‚æ¥µåœ°æ¸¦æ—‹åœ¨å†¬å­£å¢å¼·ï¼Œåœ¨å¤å­£æ¸›å¼±ï¼Œç•¶æ¥µåœ°æ¸¦æ—‹å¢å¼·ä¸¦å‘å—æ“´å±•æ™‚ï¼Œå†·ç©ºæ°£ä¾¿æœƒè¿…é€Ÿå—ä¸‹å½±éŸ¿ä¸­ç·¯åº¦åœ°å€ã€‚</p><ul><li><strong>åœ¨æ¥µåœ°æ¸¦æ—‹å—é¢æ˜¯è¥¿é¢¨å¸¶åœ°å€ï¼Œå…©è€…äº¤ç•Œè™•å¸¸å¸¸å‡ºç¾é«˜ç©ºæ€¥æµï¼ˆjet streamï¼‰ï¼Œé¢¨åŠ›ç‰¹åˆ¥å¼·å‹ï¼Œé¢¨é€Ÿå¾€å¾€é”æ¯å°æ™‚200å…¬é‡Œä»¥ä¸Š</strong>ã€‚</li><li>æ¥µåœ°æ¸¦æ—‹å‡ºç¾æ–¼åŒ—æ¥µåœ°å¸¶ï¼Œå®ƒæ˜¯ä¸€è‚¡è‚¡å¼·é¢¨ï¼Œ<strong>ä½æ–¼å¤§æ°£å±¤é«˜è™•ï¼Œå°‡æ¥µå†·çš„ç©ºæ°£é–åœ¨åŒ—æ¥µåœ°å€</strong>ã€‚</li><li>æ¥µåœ°æ¸¦æ—‹æ˜¯<strong>ç©ºæ°£æ¥µå†·çš„ä½å£“å¸¶ï¼Œåœ¨åŒ—æ¥µåœ°å€ä¸Šç©ºæ—‹è½‰</strong>ã€‚</li><li>é«˜é€Ÿæ°£æµçš„æ“¾å‹•å’Œè¼ƒæš–çš„ç©ºæ°£å…¥ä¾µï¼Œå¯èƒ½æœƒæ‰“äº‚æ¥µåœ°æ¸¦æ—‹ï¼Œå°‡åŒ—æ¥µåœ°å€çš„ç©ºæ°£å‘å—é€è‡³ä¸­ç·¯åº¦åœ°å€ã€‚</li></ul><p><img src="https://i.imgur.com/n2Z0yr3.jpeg" /></p><ul><li><strong>æ¥µåœ°æ¸¦æ—‹ï¼šè·åœ°è¡¨ 16-48 å…¬é‡Œ</strong></li><li><strong>æ¥µåœ°æ€¥æµï¼šè·åœ°è¡¨ 8-15 å…¬é‡Œ</strong></li></ul><p><img src="https://i.imgur.com/LFYWREb.png" /></p><h2 id="åŸç†">åŸç†</h2><p>From <a href="http://www.metapp.org.tw/index.php/bossweathernews/293-test" class="uri">http://www.metapp.org.tw/index.php/bossweathernews/293-test</a>,</p><p>åŒ—æ¥µåœ¨å†·å­£æ™‚ï¼Œåœ°è¡¨çš„é•·çŸ­æ³¢è¼»å°„æå¤±çš„èƒ½é‡é å¤§æ–¼æ°¸å¤œæ‰€èƒ½å¸æ”¶çš„å¤ªé™½çŸ­æ³¢è¼»å°„ï¼Œ</p><ul><li>åœ°è¡¨é™æº«ï¼Œå†ç”±æ–¼æ··åˆã€æ“´æ•£ä½¿å¾—å…¶ä¸Šçš„å†·æ°£åœ˜å‘ä¸Šç™¼å±•ï¼Œä½†ç”±æ–¼ç©ºæ°£è¼ƒå†·ã€è¼ƒé‡æœƒä½¿æ°£æŸ±æ”¶ç¸®ï¼Œè€Œåœ¨ä¸­é«˜å±¤å¤§æ°£å‘ˆç¾å‡¹é™·ï¼Œ</li><li>å®ƒçš„ç‰¹é»æ˜¯<strong>æ—‹è½‰çš„å†·ç©ºæ°£åœ˜å¯ä»¥å¾å°æµå±¤ä¸­éƒ¨å»¶ä¼¸åˆ°å¹³æµå±¤ï¼Œé€šå¸¸åœ¨åœ°è¡¨ä»¥ä¸Š 10 è‡³ 50 å…¬é‡Œ</strong>ï¼ˆ6 è‡³ 30 è‹±é‡Œï¼‰çš„é«˜åº¦ä¹‹é–“, (It is characterized by a rotating mass of cold air that can extend from the middle troposphere into the stratosphere, typically between altitudes of 10 to 50 kilometers (6 to 30 miles) above the surface)</li><li><strong>åœ°é¢å†·é‡çš„é«˜æ°£å£“</strong>å³æ‰€è¬‚ã€ŒåŒ—æ¥µæ°£åœ˜ã€ï¼Œè€Œå…¶<strong>ä¸­é«˜å±¤å‡¹é™·çš„ç›¸å°ä½æ°£å£“</strong>ï¼Œ</li></ul><p>è¿‘å¹´ä¾†è¢«å† ä»¥ã€ŒåŒ—æ¥µæ¸¦æ—‹ã€ã€‚æ‰€ä»¥å®ƒæ˜¯åœ°è¡¨ç†±åŠ›ä¸å¹³è¡¡è€Œè¢«å‹•ç”¢ç”Ÿã€‚å®ƒæ˜¯æœä¸æ˜¯å› ã€‚</p><p>å¦‚æœåŒ—æ¥µè®Šå†·ï¼Œä¸­ç·¯åº¦æ°£æº«ä¸è®Šï¼Œå…©è€…ä¹‹é–“çš„æº«åº¦å°æ¯”å·®ç•°è®Šå¤§ï¼Œè¥¿é¢¨çš„å¼·åº¦å¢å¼·ï¼Œå³æ‰€è¬‚çš„ã€Œå™´å°„æ°£æµã€å°‡åœç¹åŒ—æ¥µæ¸¦æ—‹(æ¥µå€)æ—‹è½‰ï¼Œæ‰€è¬‚ã€Œæ­£ç›¸åŒ—æ¥µéœ‡ç›ªã€æˆå‹ã€‚æ­¤æ™‚å†·æ°£åœ˜ä»ç›¤æ“šåœ¨æ¥µå€ï¼Œä¸­ç·¯åº¦æœªå—å…¶å½±éŸ¿è€Œåæš–ã€‚æˆ–æœ‰ä»¥å†·æ°£åœ˜å› ã€Œå™´æµé–ä½ã€è€Œç„¡æ³•å—ä¸‹ï¼Œè€Œé€ æˆä¸­ç·¯åº¦åæš–ä¾†åšè©®é‡‹ï¼Œå…¶è¬¬èª¤è™•åœ¨æ–¼å™´æµæ˜¯æœ¬æ˜¯æº«åº¦å°æ¯”è€Œç”¢ç”Ÿï¼Œä¸”èƒ½é‡åƒ…ä½”å¯ç”¨ä½èƒ½çš„ä¸€å°éƒ¨ä»½ï¼Œç´°ç¹©å¦‚ä½•ç¶ä½å¤§è±¡ã€‚</p><p><strong>è¼»å°„ä¸å¹³è¡¡é€ æˆåœ°è¡¨èƒ½é‡å–ªå¤±çš„æ•ˆæ‡‰ä¸¦ä¸åƒ…åªåœ¨åŒ—æ¥µï¼Œé«˜ç·¯åº¦å¤§çš„é™¸å¡Šå¦‚äºæ´²çš„è¥¿ä¼¯åˆ©äºã€è’™å¤ï¼ŒåŒ—ç¾å¤§é™¸ã€åŒ—æ­çš†æœ‰åŒæ¨£çš„æ•ˆæ‡‰ï¼Œåœ¨ä½å±¤å¤§æ°£å½¢æˆã€Œæ¥µåœ°å¤§é™¸å†·æ°£åœ˜ã€ï¼Œåœ¨åœ°é¢å› å†·é‡çš„å¤§æ°£è€Œå‘ˆç¾é«˜æ°£å£“ï¼Œæ°£æŸ±æ”¶ç¸®ä¸­é«˜å±¤äº¦æœ‰ã€Œæ¥µåœ°æ¸¦æ—‹ã€ä¼´éš¨</strong>ã€‚ç•¶åŒ—æ¥µæ°£åœ˜èˆ‡æ¥µåœ°å¤§é™¸å†·æ°£åœ˜åŒæ™‚å­˜åœ¨æˆ–åƒ…æœ‰æ¥µåœ°å¤§é™¸å†·æ°£åœ˜ï¼Œä¸”æœ‰ä¸€å®šå¼·åº¦æ™‚ï¼Œä¸­é«˜å±¤ä¹ŸæœƒåŒæ™‚æœ‰ã€Œæ¸¦æ—‹ã€ä¼´éš¨ï¼Œè¥¿é¢¨å™´æµåœç¹è€Œè¡Œï¼Œå‘ˆç¾å™´æµæ¸›å¼±ï¼Œå—åŒ—é¢¨å¢åŠ çš„ç¾è±¡ï¼Œè½‰è®Šæˆã€Œè² ç›¸åŒ—æ¥µéœ‡ç›ªã€ã€‚</p><p>ç•¶å¼·å†·æ°£åœ˜å—ç§»éç¨‹ï¼Œé€šéçš„åœ°å€å¸¶ä¾†å¯’æµï¼Œä½†æ¯”è¼ƒæš–æ¿•ç’°å¢ƒä¹Ÿä½¿å®ƒæ¸›å¼±ï¼Œæœ€çµ‚å†·æ°£åœ˜æˆ–æ¸¦æ—‹éƒ½æœƒæ¸›å¼±æ¶ˆå¤±ã€‚ä½†æ˜¯é«˜ç·¯åº¦çš„èƒ½é‡æ¶ˆå¤±ä»æœƒæŒçºŒé€²è¡Œï¼Œä½†æ˜¯å…¶å¾Œå°‡è½‰è®Šç‚ºæ­£ç›¸é‚„æ˜¯ç¶­æŒè² ç›¸å‰‡æ˜¯ä¸ä¸€å®šçš„ï¼Œé‚„æ˜¯è¦çœ‹åŒ—æ¥µæˆ–æ¥µåœ°å†·æ°£åœ˜çš„ç™¼å±•æƒ…æ³è€Œå®šï¼Œå› æœé—œä¿‚æ˜¯å¾ˆæ¸…æ¥šçš„ã€‚æœ¬ä¾†åŸå·²å­˜åœ¨çš„ã€Œæ°£åœ˜å­¸èªªã€å†é…åˆã€Œå¤§æ°£å‹•åŠ›ã€çš„ç†è«–ï¼Œå°æ–¼å†¬å­£çš„å¤©æ°£è®ŠåŒ–å·²æœ‰å®Œæ•´çš„è©®é‡‹ï¼Œæ–°å‰µçš„åè©ä¸¦ç„¡é«˜æ˜ä¹‹è™•ï¼Œå¾’å¢å›°æ“¾è€Œå·²ã€‚</p><h2 id="metoffice-what-is-the-polar-vortex"><a href="https://youtu.be/XGPLHwARPSY">Metoffice | What is the Polar Vortex?</a></h2><ul><li>The <strong>polar vortex is a circulation of winds high up in the stratosphere</strong>, up to <strong>30 miles (50 km) above the earth</strong>. It is present in winter, and is not a new phenomenon, scientists have known about it for many years.</li><li>The winds regularly <strong>exceed 155 miles per hour (250 km per hour)</strong> â€“ the strength of the winds in the strongest hurricanes (known as Category 5).</li><li>A strong polar vortex favours a <strong>strong jet stream</strong>. The jet stream is a fast moving ribbon of air around <strong>5 to 7 miles (8 to 11km) above the earth</strong> that drives weather systems from the Atlantic towards the UK.</li></ul><iframe width="560" height="315" src="https://www.youtube.com/embed/XGPLHwARPSY?si=yd2MGyNa0GhkBkCs" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe><h1 id="åŒ—æ¥µæ¿¤å‹•-arctic-oscillation-ao">åŒ—æ¥µæ¿¤å‹• Arctic Oscillation (AO)</h1><ul><li><a href="https://www.weather.gov.hk/tc/whatsnew/d4_whatsnew_20160226.htm">é¦™æ¸¯å¤©æ–‡å° |ã€æ°£è±¡å†·çŸ¥è­˜ã€ï¼šåŒ—æ¥µæ¿¤å‹•</a></li></ul><iframe width="560" height="315" src="https://www.youtube.com/embed/qQnb9LNs2GE?si=OO2XSn5VoD4Jmasm" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe><p><a href="https://www.weather.gov.hk/tc/climate_change/ao.htm">åŒ—æ¥µæ¿¤å‹•ï¼ˆAOï¼‰</a> (åˆç¨±åŒ—æ¥µéœ‡ç›ª) æ˜¯æŒ‡åŒ—åŠçƒä¸­ç·¯åº¦åœ°å€ï¼ˆç´„åŒ—ç·¯45åº¦ï¼‰èˆ‡åŒ—æ¥µåœ°å€æ°£å£“å½¢å‹¢å·®åˆ¥çš„è®ŠåŒ–ã€‚å®ƒæ˜¯ä¸€å€‹ä»£è¡¨åŒ—æ¥µåœ°å€å¤§æ°£ç’°æµçš„é‡è¦æ°£å€™æŒ‡æ•¸ï¼Œå¯åˆ†ç‚ºæ­£ä½ç›¸å’Œè² ä½ç›¸ã€‚</p><p>åŒ—æ¥µé€šå¸¸å—ä½æ°£å£“ç³»çµ±æ”¯é…ï¼Œè€Œé«˜æ°£å£“ç³»çµ±å‰‡ä½æ–¼ä¸­ç·¯åº¦åœ°å€ã€‚</p><ul><li>ç•¶AOè™•æ–¼æ­£ä½ç›¸æ™‚ï¼Œ<strong>é€™äº›ç³»çµ±çš„æ°£å£“å·®è¼ƒæ­£å¸¸å¼·</strong>ï¼Œé™åˆ¶äº†æ¥µå€å†·ç©ºæ°£å‘å—æ“´å±•ï¼›</li><li>ç•¶AOè™•æ–¼è² ä½ç›¸æ™‚ï¼Œ<strong>é€™äº›ç³»çµ±çš„æ°£å£“å·®è¼ƒæ­£å¸¸å¼±</strong>ï¼Œå†·ç©ºæ°£è¼ƒæ˜“å‘å—ä¾µè¥²ã€‚</li></ul><p>æœ‰é—œåŒ—æ¥µæ¿¤å‹•çš„æœ€æ–°æƒ…æ³å¯åƒè€ƒï¼š - <a href="https://www.cpc.ncep.noaa.gov/products/precip/CWlink/daily_ao_index/ao.shtml" class="uri">https://www.cpc.ncep.noaa.gov/products/precip/CWlink/daily_ao_index/ao.shtml</a></p><figure><img src="https://www.cpc.ncep.noaa.gov/products/precip/CWlink/daily_ao_index/ao.gefs.fcst.png" alt="The daily AO index and its forecasts using GFS and Ensemble mean forecast data are shown for the previous 120 days as indicated. Each daily value has been standardized by the standard deviation of the monthly AO index from 1979-2000." /><figcaption>The daily AO index and its forecasts using GFS and Ensemble mean forecast data are shown for the previous 120 days as indicated. Each daily value has been standardized by the standard deviation of the monthly AO index from 1979-2000.</figcaption></figure><h1 id="åˆ†æå’Œæ–‡ç»ç¶œè¿°">åˆ†æå’Œæ–‡ç»ç¶œè¿°</h1><h2 id="é¦™æ¸¯å¤©æ–‡å°-2014å¹´3æœˆ-åŒ—åŠçƒæ¥µåœ°æ¸¦æ—‹çš„æ‰­æ›²"><a href="https://www.hko.gov.hk/tc/education/articles/ele_140304.htm">é¦™æ¸¯å¤©æ–‡å° | 2014å¹´3æœˆ åŒ—åŠçƒæ¥µåœ°æ¸¦æ—‹çš„æ‰­æ›²</a></h2><ul><li>åœ¨æ­£å¸¸æƒ…æ³ä¸‹ï¼Œç”±æ–¼åŒ—åŠçƒå†¬å¤©æ¥µåœ°å’Œä¸­é«˜ç·¯åº¦åœ°å€åœ°é¢å‡ºç¾è¼ƒå¤§çš„æº«å·®ï¼Œ<strong>åœ°é¢æ°£æº«ç·Šå¯†æ¢¯åº¦ä¿ƒä½¿é«˜ç©ºæ€¥æµçš„ç”¢ç”Ÿã€‚æ€¥æµç”±è¥¿å‘æ±ç’°ç¹åœ°çƒé«˜é€Ÿæµå‹•ï¼Œè€Œåœ¨åŒ—æ¥µé™„è¿‘å—é«˜ç©ºæ€¥æµæ‰€åŒ…åœçš„æ¸¦æ—‹é€šå¸¸è¢«ç¨±ç‚ºæ¥µåœ°æ¸¦æ—‹</strong>ã€‚è‹¥æ€¥æµçš„é€Ÿåº¦è¼ƒé«˜ï¼Œæ€¥æµæœƒéš¨è¼ƒå¹³ç›´çš„è·¯å¾‘æµå‹•(åœ–ä¸€)ï¼Œåœ°é¢ä¸Šçš„å†·ç©ºæ°£æœƒé›†ä¸­åœ¨æ¥µåœ°æˆ–è¼ƒé«˜ç·¯åº¦åœ°å€ï¼Œè¼ƒå°‘æ©Ÿæœƒå—ä¸‹ã€‚</li><li>ä½†è¿‘å¹´ä¸»è¦å› ç‚ºåŒ—æ¥µæµ·å†°èåŒ–ï¼Œä»¥è‡´æ¥µåœ°å¸æ”¶æ›´å¤šå¤ªé™½è¼»å°„ï¼ŒåŒ—æ¥µåœ°å€æ°£æº«ä¸Šå‡çš„é€Ÿåº¦è¼ƒä¸­é«˜ç·¯åº¦çš„ç‚ºé«˜ï¼Œé€™ä½¿åœ°é¢æ°£æº«æ¢¯åº¦æ¸›å¼±ï¼Œé«˜ç©ºæ€¥æµçš„æµé€Ÿäº¦è¼ƒç‚ºæ¸›æ…¢ï¼Œå…¶æµå‹•æ–¹å‘ä¾¿è®Šå¾—å½å½æ›²æ›²(åœ–äºŒ)ï¼Œéš¨ä¹‹è®“æ¥µåœ°æ¸¦æ—‹è®Šå¾—è¼ƒç‚ºæ‰­æ›²ã€‚é€™æƒ…æ³å°±å¦‚ä¸€é“æ´¶æ¹§çš„æ²³å·æµåˆ°å¹³åŸåœ°å€æ™‚ï¼Œæ²³æ°´æµé€Ÿæ¸›æ…¢ï¼Œæ²³é“ä¾¿è®Šå¾—å½æ›²ã€‚é«˜ç©ºæ€¥æµè¿‚è¿´çš„å—åŒ—æµå‹•ï¼Œä½¿éƒ¨åˆ†åœ°å€æŒçºŒå—å†·ç©ºæ°£å—ä¸‹æ‰€å½±éŸ¿ï¼Œè€Œå¦ä¸€äº›åœ°å€å‰‡å—æš–ç©ºæ°£åŒ—ä¸Šè€Œå‡ºç¾è®Šæš–ç¾è±¡ï¼Œæ•´é«”ä¾†èªªä¿ƒä½¿äº†åœ°åŸŸä¸Šæº«åº¦çš„åˆ†ä½ˆè¶¨å‘äº’ç•°å’Œæ¥µç«¯ã€‚</li></ul><table><thead><tr class="header"><th style="text-align: left;">æ­£å¸¸æƒ…æ³</th><th style="text-align: left;">æ¥µåœ°æ¸¦æ—‹è®Šå¾—è¼ƒç‚ºæ‰­æ›²</th></tr></thead><tbody><tr class="odd"><td style="text-align: left;"><img src="https://i.imgur.com/nHubAl9.png" /></td><td style="text-align: left;"><img src="https://i.imgur.com/jzQOoXg.png" /></td></tr></tbody></table><h2 id="æ¾³é–€æ°£è±¡å­¸æœƒ-2022-12-11-ä»€éº¼æ˜¯æ¥µåœ°æ¸¦æ—‹"><a href="https://www.mmets.org/?p=1735">æ¾³é–€æ°£è±¡å­¸æœƒ | 2022-12-11 ä»€éº¼æ˜¯ã€Œæ¥µåœ°æ¸¦æ—‹ã€?</a></h2><p>å†¬å­£åˆ°ä¾†çš„æ™‚å€™ï¼ŒåŒ—æ¥µæ²’æœ‰å¤ªé™½ç…§å°„ï¼Œè®Šå¾—è¶Šä¾†è¶Šå¯’å†·ï¼Œå†·ç©ºæ°£æ¼¸æ¼¸å †ç©ä¸¦â€œé€†æ™‚é‡â€æ—‹è½‰èµ·ä¾†ï¼Œç¨±ç‚ºã€Œæ¥µåœ°æ¸¦æ—‹ã€ã€‚</p><figure><img src="https://i.imgur.com/lyvOTHn.jpeg" alt="æ¥µåœ°æ¸¦æ—‹, åŒ—æ¥µæ¿¤å‹•" /><figcaption>æ¥µåœ°æ¸¦æ—‹, åŒ—æ¥µæ¿¤å‹•</figcaption></figure><ul><li>å†¬å­£å› å†·ç©ºæ°£è¼ƒå¤šï¼Œã€Œæ¥µåœ°æ¸¦æ—‹ã€ç¯„åœæ¯”å¤å¤©å¤§å¾ˆå¤šã€‚å®ƒåœ¨æ¥µå€å°æµå±¤åŠå¹³æµå±¤çš„ä¸­ã€ä¸Šå±¤å½¢æˆä¸€è‚¡å¾ˆå¼·çš„åœç¹æ•´å€‹æ¥µå€çš„ç’°æµï¼Œç”±æ–¼ç’°æµæ˜¯è‡ªè¥¿å‘æ±æ—‹è½‰ï¼Œè€Œä¸”é¢¨é€Ÿå¯é”æ¯å°æ™‚ 160 å…¬é‡Œï¼Œä¸€èˆ¬ç¨±ä¹‹ç‚ºè¥¿é¢¨å™´æµï¼Œèƒ½é–ä½æ¥µåœ°å†·ç©ºæ°£ï¼Œä¸è®“å†·ç©ºæ°£è¼•æ˜“è·‘åˆ°ä¸­ã€ä½ç·¯åº¦åœ°å€ï¼Œé€™æƒ…æ³æ°£è±¡å­¸ä¸Šç¨±ç‚ºâ€œæ­£â€åŒ—æ¥µæ¿¤å‹•(ä¸Šå·¦åœ–)ã€‚</li><li>ç›¸åï¼Œâ€œè² â€åŒ—æ¥µæ¿¤å‹•å‰‡è¡¨ç¤ºï¼Œæ¥µåœ°æ¸¦æ—‹åå¼±ï¼Œåœç¹æ¥µå€çš„è¥¿é¢¨å™´æµæ¸›æ…¢ï¼Œè®Šå¾—æ›²æ›²æŠ˜æŠ˜ï¼Œç„¡æ³•é–ä½å†·ç©ºæ°£ï¼Œå¤§å®¶å¯æƒ³åƒæˆå†°ç®±é–€æ²’é—œå¥½ï¼Œæ¥µå€å†·ç©ºæ°£é †å‹¢è€Œä¸‹ï¼Œè·‘åˆ°ä¸­ã€ä½ç·¯åº¦åœ°å€(ä¸Šå³åœ–)ã€‚</li></ul><p>ç«‹å³ä¾†å€‹ç°¡å–®å¯¦æˆ°ï¼Œé€™æ˜¯ 2022 å¹´ 12 æœˆ 15 æ—¥æ—©ä¸Š 8 æ™‚çš„ECMWFé å ±åœ–ï¼Œ<strong>ç­‰å€¼ç·šæ˜¯500hPaé‡åŠ›ä½é«˜åº¦ï¼Œå› é«˜ç©ºæ²’æœ‰åœ°é¢çš„æ‘©æ“¦åŠ›ï¼Œé¢¨å¹¾ä¹å¹³è¡Œç­‰å€¼ç·š</strong>ï¼Œå› æ­¤å¤§å®¶è¦‹åˆ°æ›²æ›²æŠ˜æŠ˜çš„ç²—ç´…ç·šï¼Œä»£è¡¨â€œè² â€åŒ—æ¥µæ¿¤å‹•ï¼Œè¥¿é¢¨å™´æµé€Ÿåº¦æ…¢ï¼ŒåŒ—æ¥µå¤§å†°ç®±çš„é–€å·²ç¶“æ‰“é–€ã€‚è‡³æ–¼å†·ç©ºæ°£çš„æµå‘ï¼Œå‰‡å¯ä»¥çœ‹ä¸Šåœ–çš„é¡è‰²(850 hPa æº«åº¦)ï¼Œè—ã€ç´«è‰²ä»£è¡¨éå¸¸å¯’å†·çš„ç©ºæ°£ï¼Œåœ–ä¸­æ‰€è¦‹ï¼Œé€™æ¬¡æ¥µåœ°å†·ç©ºæ°£ä¸»è¦æµå‘äº†æ±äºåŠæ­æ´²ã€‚</p><figure><img src="https://i.imgur.com/9S3O3ER.jpeg" alt="2022 å¹´ 12 æœˆ 15 æ—¥æ—©ä¸Š 8 æ™‚çš„ECMWFé å ±åœ–ï¼Œç­‰å€¼ç·šæ˜¯500hPaé‡åŠ›ä½é«˜åº¦" /><figcaption>2022 å¹´ 12 æœˆ 15 æ—¥æ—©ä¸Š 8 æ™‚çš„ECMWFé å ±åœ–ï¼Œç­‰å€¼ç·šæ˜¯500hPaé‡åŠ›ä½é«˜åº¦</figcaption></figure><h2 id="é¦™æ¸¯å¤©æ–‡å°-2014å¹´1æœˆ29æ—¥-æº«æš–çš„åŒ—æ¥µå¯’å†·çš„å¤§é™¸"><a href="https://www.hko.gov.hk/tc/blog/00000155.htm">é¦™æ¸¯å¤©æ–‡å° | 2014å¹´1æœˆ29æ—¥ æº«æš–çš„åŒ—æ¥µï¼å¯’å†·çš„å¤§é™¸</a></h2><ul><li>æ°£å€™è®Šæš–ä½¿åŒ—æ¥µæµ·å†°å’Œé™¸åœ°é›ªè“‹æ¸›å°‘ï¼Œé™ä½äº†åœ°çƒçš„åå°„ç‡ã€‚æœ¬ä¾†æµ·å†°å’Œé›ªè“‹çš„åå°„ç‡é è¼ƒæµ·æ´‹å’Œé™¸åœ°é«˜ï¼Œèƒ½æœ‰æ•ˆåœ°æŠŠå¤ªé™½å…‰åå°„å›å¤ªç©ºï¼Œä½†æµ·å†°å’Œé›ªè“‹æ¸›å°‘æœƒæš´éœ²æ›´å¤šçš„æµ·æ´‹å’Œé™¸åœ°è¡¨é¢ï¼Œå¢åŠ äº†åœ°çƒå¸æ”¶å¤ªé™½ç†±é‡çš„èƒ½åŠ›ï¼Œé€™äº›é¡å¤–çš„ç†±åŠ›ä»¤æµ·æ°´åŠé™¸åœ°é€²ä¸€æ­¥å‡æº«è€Œä¿ƒä½¿æ›´å¤šçš„æµ·å†°åŠé›ªè“‹èåŒ–ï¼Œå½¢æˆæƒ¡æ€§å¾ªç’°ã€‚</li><li><strong>åŒ—æ¥µåœ°å€è®Šæš–çš„é€Ÿåº¦ä¹Ÿå› æ­¤è¼ƒåŒ—åŠçƒå…¶å®ƒåœ°æ–¹å¿«ï¼Œæ¥µåœ°èˆ‡ç†±å¸¶åœ°å€ä¹‹é–“çš„æº«å·®æ¸›å°‘ï¼Œå°è‡´åŒ—åŠçƒé«˜ç©ºè¥¿é¢¨æ°£æµæ¸›æ…¢ï¼Œå®¹æ˜“å‡ºç¾èœ¿èœ’èµ·ä¼çš„æ³¢å‹•</strong>ã€‚</li><li>æ³¢å‹•è¥¿å´çš„ååŒ—æ°£æµæŠŠæ¥µåœ°å†·ç©ºæ°£å¾€å—è¼¸é€ï¼Œæ±å´çš„åå—æ°£æµå‰‡æŠŠç†±å¸¶å€åŸŸçš„æš–ç©ºæ°£æ¨å‘æ›´åŒ—çš„åœ°æ–¹ã€‚</li><li>é«˜ç©ºè¥¿é¢¨æ°£æµæ¸›æ…¢ä¹Ÿæœƒå®¹æ˜“å¼•ç™¼å¤§æ°£é˜»å¡å½¢å‹¢ï¼Œå‡ºç¾ç§»å‹•ç·©æ…¢çš„åæ°£æ—‹ï¼Œå¤©æ°£ç³»çµ±åœ¨æ™‚é–“å’Œç©ºé–“ä¸Šçš„æ¼”è®Šæœƒè®Šå¾—åœæ»¯ä¸å‰ã€‚è¦–ä¹ç›¸å°æ–¼é˜»å¡å½¢å‹¢çš„ä½ç½®è€Œå®šï¼ŒæŸäº›åœ°æ–¹å¯èƒ½é•·æ™‚é–“å¤©æ™´ï¼Œä½†å¦ä¸€äº›åœ°æ–¹å‰‡å¯èƒ½è¢«å›°åœ¨é¢¨æš´çš„èµ°é“è»Œè·¡ä¸Šï¼Œç¶“æ­·ä¸€æ®µé™°é›¨çš„æ—¥å­ã€‚å‡å¦‚é˜»å¡å½¢å‹¢ç™¼ç”Ÿåœ¨å†¬å­£ï¼Œå—å½±éŸ¿åœ°å€çš„ç•°å¸¸å¯’å†·æˆ–æº«æš–å¤©æ°£å¯èƒ½æŒçºŒæ•¸å¤©è‡³æ•¸é€±ã€‚è¿‘å¹´å°è±¡çŒ¶æ–°çš„ä¾‹å­æ˜¯ 2008 å¹´å¹´åˆå½±éŸ¿ä¸­åœ‹å¤§éƒ¨åˆ†åœ°å€çš„å¯’æ½®ï¼Œç•¶æ™‚åœ¨é˜»å¡å½¢å‹¢çš„é©…å‹•ä¸‹è¥¿ä¼¯åˆ©äºçš„å†·ç©ºæ°£é•·æ™‚é–“ä¸æ–·å‘å—æ“´æ•£è‡³é¦™æ¸¯ã€‚</li></ul><h2 id="é¦™æ¸¯å¤©æ–‡å°-2019å¹´2æœˆ27æ—¥-å…¨çƒè®Šæš–ä¸‹çš„æ¥µåœ°æ¸¦æ—‹"><a href="https://www.hko.gov.hk/tc/blog/00000219.htm">é¦™æ¸¯å¤©æ–‡å° | 2019å¹´2æœˆ27æ—¥ å…¨çƒè®Šæš–ä¸‹çš„ã€Œæ¥µåœ°æ¸¦æ—‹ã€</a></h2><ul><li>æ¥µåœ°æ¸¦æ—‹æ˜¯å¤§æ°£é«˜å±¤çš„ç·Šå¯†æ—‹è½‰æ°£æµï¼Œå®ƒæŠŠå†·ç©ºæ°£é™åˆ¶åœ¨åŒ—æ¥µåœ°å€ã€‚å‡å¦‚æ¥µåœ°æ¸¦æ—‹åå¼±ï¼Œè¥¿é¢¨æ€¥æµæœƒæ¸›æ…¢ï¼Œå®¹æ˜“å‡ºç¾è¼ƒå¤šæ³¢å‹•ï¼Œé€™æœ‰åˆ©åŒ—æ¥µæ°£åœ˜å—ä¾µä¸¦ç‚ºä¸­ç·¯åº¦åœ°å€å¸¶ä¾†åš´å¯’å¤©æ°£ã€‚</li><li>è¿‘æœŸä¸€é …ç ”ç©¶ç™¼ç¾åœ¨å…¨çƒè®Šæš–çš„èƒŒæ™¯ä¸‹ï¼Œéå»å››åå¹´æ¥µåœ°æ¸¦æ—‹çš„åå¼±ç‹€æ…‹è¶Šè¶¨æŒçºŒã€‚ç§‘å­¸å®¶èªç‚ºç”±æ–¼åŒ—æ¥µæµ·å†°çš„ç¸®æ¸›ï¼Œæš´éœ²å‡ºä¾†çš„æµ·æ´‹é‡‹æ”¾æ›´å¤šç†±é‡åˆ°å¤§æ°£ä¸­ï¼Œå› è€Œå½±éŸ¿äº†å¤§æ°£ç’°æµã€‚é€éã€Œæ°£å€™â€”åå°„ç‡ã€çš„å›é¥‹æ©Ÿåˆ¶ï¼ŒåŒ—æ¥µæµ·å†°çš„ç¸®æ¸›äº¦åŠ©é•·åŒ—æ¥µçš„æš–åŒ–ï¼šè¼ƒå°‘æµ·å†° -&gt; è¼ƒæ·±è‰²çš„æµ·æ´‹æš´éœ²å‡ºä¾† -&gt; å¸æ”¶æ›´å¤šå¤ªé™½ç†±åŠ› -&gt; æµ·å†°é€²ä¸€æ­¥æ¸›å°‘ã€‚</li><li>ç›®å‰ï¼ŒåŒ—æ¥µçš„æš–åŒ–é€Ÿåº¦æ˜¯é€™é€£çµæœƒä»¥æ–°è¦–çª—æ‰“é–‹ã€‚å…¨çƒå¹³å‡çš„å…©å€ã€‚</li><li>é€™å€‹æš–åŒ–é€Ÿåº¦çš„å·®ç•°ä½¿æ¥µå€èˆ‡èµ¤é“ä¹‹é–“çš„æº«å·®æ¸›å°‘ï¼Œç¹¼è€Œæ¸›å¼±äº†æ¥µåœ°æ¸¦æ—‹å’Œè¥¿é¢¨æ€¥æµï¼Œä½¿è¥¿é¢¨æ€¥æµè¼ƒç‚ºæ³¢å‹•ï¼Œæœ‰åˆ©åŒ—æ¥µå†·ç©ºæ°£å—ä¾µã€‚</li></ul><h2 id="ä¸­å›½æ°”è±¡æŠ¥ç¤¾-2023å¹´12æœˆ21æ—¥-å…¨çƒå˜æš–äº†ä¸ºä½•ç§‹å†¬å†·ç©ºæ°”è¿˜é‚£ä¹ˆå¼º"><a href="https://www.cma.gov.cn/2011xwzx/2011xqxxw/2011xqxyw/202312/t20231221_5965542.html">ä¸­å›½æ°”è±¡æŠ¥ç¤¾ | 2023å¹´12æœˆ21æ—¥ å…¨çƒå˜æš–äº†ï¼Œä¸ºä½•ç§‹å†¬å†·ç©ºæ°”è¿˜é‚£ä¹ˆå¼ºï¼Ÿ</a></h2><p>ä¸æ˜¯èªªå…¨çƒæš–åŒ–äº†å—ï¼Ÿç‚ºä»€éº¼ç§‹å†¬çš„å†·ç©ºæ°£é‚„é‚£éº¼å¼·ï¼Ÿ</p><p>é€™èˆ‡æ¥µåœ°æ¸¦æ—‹ï¼ˆä»¥ä¸‹ç°¡ç¨±ã€Œæ¥µæ¸¦ã€ï¼‰æœ‰é—œã€‚èµ¤é“èˆ‡æ¥µåœ°ä¹‹é–“å­˜åœ¨è‘—å·¨å¤§æº«å·®ï¼Œé€™ç¨®å·®ç•°ä¿ƒä½¿æ¥µåœˆå¤–åœå½¢æˆäº†ä¸€åœˆå¼·å‹çš„è¥¿é¢¨ï¼Œç¨±ç‚ºè¥¿é¢¨æ€¥æµã€‚è¥¿é¢¨æ€¥æµå°±åƒã€Œåœæ¬„ã€ä¸€æ¨£ï¼Œç´„æŸæ¥µåœ°çš„å†·ç©ºæ°£ï¼Œç©©å®šçš„æ¥µæ¸¦èƒ½å¤ è¢«å¼·å¤§çš„è¥¿é¢¨æ€¥æµé™åˆ¶åœ¨åŒ—æ¥µåœ°å€ã€‚åœ¨å…¨çƒæš–åŒ–èƒŒæ™¯ä¸‹ï¼ŒåŒ—æ¥µåœ°å€å¢æº«é€Ÿåº¦æ˜¯å…¨çƒçš„2â€”3å€ã€‚åŒ—æ¥µåœ°å€å¢æº«ï¼Œå…¶èˆ‡ä¸­ä½ç·¯åº¦é–“çš„æ°£æº«å·®æ¸›å¼±ï¼Œé›£ä»¥ç¶­æŒå¼·å¤§çš„è¥¿é¢¨æ€¥æµï¼Œæ¥µæ¸¦å…§çš„å†·ç©ºæ°£è®Šå¾—â€œèºå‹•ä¸å®‰â€ï¼Œæ›´å®¹æ˜“åˆ†è£‚å—ä¸‹ã€‚åŒ—æ¥µä¾†çš„å†·ç©ºæ°£ï¼Œå…¶æº«åº¦é ä½æ–¼äººå€‘æ‰€è™•çš„ä¸­ä½ç·¯åº¦åœ°å€ï¼Œå› æ­¤å°è‡´å¤šæ¬¡å¯’æ½®å¤©æ°£ã€‚</p><p>æ­¤å¤–ï¼Œæ ¹æ“šæ­·å²è³‡æ–™çµ±è¨ˆåˆ†æï¼Œå„çˆ¾å°¼è«¾èƒŒæ™¯ä¸‹æˆ‘åœ‹å†¬å­£æ°£æº«æ•´é«”åæš–ï¼Œä½†éšæ®µæ€§å†·ç©ºæ°£æ´»å‹•è¼ƒç‚ºé »ç¹ï¼Œä¹Ÿå°±æ˜¯èªªå†·æš–èµ·ä¼æ¯”è¼ƒæ˜é¡¯ã€‚</p><p>ä½†æ˜¯ï¼Œå†·ç©ºæ°£éç¨‹å¼·åº¦ä¸åƒ…å—å„çˆ¾å°¼è«¾å½±éŸ¿ï¼Œä¹Ÿèˆ‡æ¥µæ¸¦çš„åˆ†è£‚å’Œä¸­é«˜ç·¯è¥¿é¢¨å¸¶çš„æ“¾å‹•æœ‰å¾ˆå¤§é—œä¿‚ã€‚ä»Šå¹´12æœˆä¸­æ—¬ä»¥ä¾†ï¼Œæ¥µæ¸¦åˆ†è£‚ç‚ºé›™ä¸­å¿ƒï¼Œåˆ†åˆ¥ä½æ–¼æ ¼é™µè˜­å³¶å’Œè¥¿ä¼¯åˆ©äºä¸Šç©ºã€‚ä¼´éš¨è‘—æ­äºå¤§é™¸ä¸Šç©ºè¥¿é¢¨å¸¶çš„åŠ‡çƒˆæ‰­æ›²ï¼Œè¥¿ä¼¯åˆ©äºé«˜å£“ç•°å¸¸å¢å¼·ï¼Œæˆ‘åœ‹å¤§éƒ¨åœ°å€ç”±å‰æœŸç››è¡Œåå—é¢¨è½‰ç‚ºååŒ—é¢¨ï¼Œå†·ç©ºæ°£å—ä¸‹ï¼Œå°è‡´æ°£æº«é©Ÿé™ã€‚</p><p>å¦ä¸€æ–¹é¢ï¼Œå„çˆ¾å°¼è«¾æ¿€ç™¼çš„è²å¾‹è³“ç•°å¸¸åæ°£æ—‹å°‡ç†±å¸¶æ°´æ±½å‘æˆ‘åœ‹é™¸åœ°è¼¸é€ï¼Œä¾†è‡ªä¸­é«˜ç·¯çš„å¯’æ½®éç¨‹é…åˆä¾†è‡ªä½ç·¯çš„è±æ²›æ°´æ±½æ¢ä»¶ï¼Œå¼•èµ·äº†æˆ‘åœ‹ä¸­æ±éƒ¨è¼ƒå¤§ç¯„åœçš„é™é›ªéç¨‹ã€‚æ­¤å¤–ï¼Œåœ°é¢ç©é›ªé€ æˆçš„æ™´ç©ºåç…§ç‡å¢åŠ ä¹Ÿä½¿å¾—å¾ŒæœŸå›æº«è¼ƒæ…¢ã€‚</p><h2 id="å¹´2021å¹´æ­äºå¤§é™¸å¯’æ½®"><a href="https://zh.wikipedia.org/wiki/2020%E5%B9%B4%E2%80%942021%E5%B9%B4%E6%AD%90%E4%BA%9E%E5%A4%A7%E9%99%B8%E5%AF%92%E6%BD%AE">2020å¹´ï¼2021å¹´æ­äºå¤§é™¸å¯’æ½®</a></h2><p>ä¸­åœ‹æ°£è±¡å±€è§£é‡‹æ˜¯å› åŒ—æ¥µé«˜ç©ºæ€¥æµæ¸›å¼±ï¼ŒæŒ¾å¸¶å¤§é‡æ¥µåœ°å†·æ°£åœ˜çš„æ¥µåœ°æ¸¦æ—‹ï¼ˆPolar vortexï¼‰å—ä¸‹å°è‡´çš„ã€‚åœ¨å…¨çƒè®Šæš–çš„èƒŒæ™¯ä¸‹ï¼Œæ¥µåœ°æ¼©æ¸¦ç­‰å¤©æ°£ç³»çµ±ä¸ç©©å®šï¼ŒåŠ åŠ‡äº†æ¥µç«¯å¤©æ°£çš„å¯èƒ½æ€§ï¼Œæ¥µåœ°æ¼©æ¸¦æœ¬ä¾†æœƒå°‡å†·ç©ºæ°£é–å®šæ–¼é«˜ç·¯åº¦åœ°å€ï¼Œç”±æ–¼åŒ—æ¥µæ°£æº«ä¸Šå‡ï¼Œå’Œé«˜ç·¯åº¦åŠä½ç·¯åº¦çš„æº«å·®æ¸›å°‘ï¼Œè®“æ¥µåœ°æ¼©æ¸¦çš„ç¯„åœå‡ºç¾æ”¹è®Šï¼Œå†·ç©ºæ°£ä¹Ÿéš¨ä¹‹å—ä¸‹ï¼Œè§¸ç™¼åš´é‡å¯’æ½®ã€‚</p><p>å¤§å®¶éƒ½çŸ¥é“åŒ—æ¥µå†·ï¼Œå®ƒä¸åƒ…æ˜¯åœ°çƒçš„å†·æ¥µä¹‹ä¸€ï¼Œä¹Ÿæ˜¯å¤§æ°£çš„å†·æºï¼Œé‚£è£¡èšé›†äº†å¤§é‡å†·æ°£åœ˜ï¼Œå°è‡´æ¥µåœ°ä½ç©ºå½¢æˆå†·æ€§é«˜å£“ï¼Œé«˜ç©ºå‰‡å½¢æˆå†·æ€§ä½å£“ï¼Œé€™å€‹æ¥µåœ°é«˜ç©ºçš„å†·æ€§å¤§å‹æ¸¦æ—‹ç³»çµ±ï¼Œå°±æ˜¯æ¥µåœ°æ¸¦æ—‹ï¼Œå®ƒä¹Ÿæ˜¯å½±éŸ¿æˆ‘åœ‹çš„å†·ç©ºæ°£ä¾†æºä¹‹ä¸€ã€‚</p><p>åœ¨å†¬å­£ï¼Œç•¶æ¥µåœ°æ¸¦æ—‹å››å‘¨çš„é«˜ç©ºæ€¥æµå¯¦åŠ›å¼·ï¼Œæ¥µåœ°æ¸¦æ—‹å°±è€å¯¦çª©åœ¨åŒ—æ¥µåœ°å€ä¸Šç©ºé€†æ™‚é‡è½‰åœˆåœˆï¼Œæ¥µåœ°ä»¥å¤–åœ°å€çš„å¯’æ½®ã€å†·ç©ºæ°£å°±ç›¸å°ä¸æœƒé‚£éº¼æ´»èºï¼Œé‚£éº¼é€™ä¸€å¹´å°±å¯èƒ½æ˜¯æš–å†¬äº†ï¼›ç•¶é«˜ç©ºæ€¥æµæ¸›å¼±ï¼Œè£¹æŒ¾äº†å¤§é‡æ¥µåœ°å†·æ°£åœ˜çš„æ¥µåœ°æ¸¦æ—‹å°±æœ‰äº†å—ä¸‹çš„æ©Ÿæœƒï¼Œå½±éŸ¿åŒ—åŠçƒçš„å†·ç©ºæ°£å°±æ›´ç‚ºâ€‹â€‹æ´»èºã€‚</p><p>ä¹‹å‰çš„è·¨å¹´å¯’æ½®å’Œé€™æ¬¡å‡å“­æˆ‘å€‘çš„å¯’æ½®ï¼Œä¹‹æ‰€ä»¥é€™éº¼å†·ï¼Œä¸€æ–¹é¢æ˜¯å› ç‚ºå…©æ¬¡å¯’æ½®é–“éš”æ™‚é–“ä¸é ï¼Œå‰ä¸€æ³¢å‰›å‡é€äº†åœŸåœ°ï¼Œé‚„æ²’ä¾†å¾—åŠå›æš–ï¼Œå¾Œä¸€æ³¢ç·Šè·Ÿè€Œè‡³ï¼ŒåŸºç¤æ°£æº«æœ¬å°±ä½ï¼Œå†é™æº«ï¼Œå°±é›ªä¸ŠåŠ éœœï¼Œå†·ä¸ŠåŠ å†·äº†ã€‚</p><p>å¦ä¸€æ–¹é¢æ˜¯å› ç‚ºå®ƒå€‘å¯¦åŠ›å¼·å‹ï¼Œé€™å…©è‚¡å¯’æ½®éƒ½æ˜¯æ¥µåœ°æ¸¦æ—‹çš„éƒ¨åˆ†ä¸»é«”å—ä¸‹ï¼Œè·¯éè¥¿ä¼¯åˆ©äºåœ°å€é€™å€‹å†·ç©ºæ°£ã€ŒåŠ æ²¹ç«™ã€ç©è“„äº†æ›´å¤šèƒ½é‡ï¼Œè®“å†·æ°£åœ˜çš„æ°£æº«æ›´ä½ï¼Œé™æº«èƒ½åŠ›æ›´å¼·ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>Meteorology</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Siberian high | è’™å¤è¥¿ä¼¯åˆ©äºé«˜å£“</title>
    <link href="/2024/10/04/Siberian-high/"/>
    <url>/2024/10/04/Siberian-high/</url>
    
    <content type="html"><![CDATA[<h1 id="siberian-high-è’™å¤è¥¿ä¼¯åˆ©äºé«˜å£“">Siberian high | è’™å¤è¥¿ä¼¯åˆ©äºé«˜å£“</h1><p><strong>è¥¿ä¼¯åˆ©äºé«˜å£“ï¼ˆSiberian Highï¼‰ï¼Œåˆç¨±è’™å¤é«˜å£“ã€è’™å¤å†·é«˜å£“ã€è¥¿ä¼¯åˆ©äºåæ°£æ—‹ å†·é«˜å£“ï¼ˆSiberian Anticycloneï¼‰</strong>ï¼Œæ˜¯ä¸€ç¨®ä½æ–¼æ­äºå¤§é™¸æ±åŒ—å€åŸŸï¼Œç™¼ç”Ÿåœ¨<strong>ä¹æœˆåˆ°æ¬¡å¹´å››æœˆçš„åŠæ°¸ä¹…æ€§å¤§é™¸åæ°£æ—‹</strong>ã€‚åœ¨å¤å­£ï¼Œæº«æš–æ½®æ¿•çš„æ°£æµè‡ªå¤ªå¹³æ´‹æµå‘è¥¿ä¼¯åˆ©äºã€‚è€Œåœ¨å†¬å­£å‰‡æ­£å¥½ç›¸åã€‚é€™ç¨®è®ŠåŒ–æ˜¯å› ç‚ºæµ·æ´‹å’Œé™¸åœ°çš„æ¯”ç†±ç†”å·®ç•°ï¼Œå†åŠ ä¸Šæ­äºå¤§é™¸éå¸¸ç‰¹æ®Šçš„åœ°ç†ç’°å¢ƒè€Œé€ å°±çš„ã€‚<strong>å¾è€Œåœ¨æ±äºå’Œå—äºåœ°å€å½¢æˆäº†åœ°çƒä¸Šç¯„åœæœ€å¤§çš„å­£å€™é¢¨æ°£å€™ã€‚å†¬å­£åœ¨è’™å¤ã€è¥¿ä¼¯åˆ©äºä¸€å¸¶å¤§ç¯„åœå †ç©å½¢æˆå†·é«˜å£“ï¼Œå…¶é€šå¸¸åœ¨ä¸€æœˆä»½å‰å¾Œé”åˆ°æ¥µç››</strong>ã€‚è¥¿ä¼¯åˆ©äºé«˜å£“æ˜¯å››å€‹åŒ—åŠçƒä¸»è¦çš„å­£ç¯€æ€§å¤§æ°£æ´»å‹•ä¸­å¿ƒä¹‹ä¸€ï¼Œå‹¢åŠ›å¼·ç››å¯å½±éŸ¿æ•´å€‹æ­äºå¤§é™¸ï¼Œæˆç‚ºåŒ—åŠçƒè¦†è“‹é¢ç©æœ€å»£çš„é«˜å£“ã€‚</p><ul><li>ä½æ–¼è’™å¤å¢ƒå…§ï¼Œæ°£å£“å€¼ï¼š1036hPa ~ 1050hPaï¼Œæœ€å¼·æ™‚å¯é”1075hPa</li></ul><figure><img src="https://i.imgur.com/FG2FYYk.png" alt="è¥¿ä¼¯åˆ©äºé«˜å£“ã€è’™å¤å†·é«˜å£“" /><figcaption>è¥¿ä¼¯åˆ©äºé«˜å£“ã€è’™å¤å†·é«˜å£“</figcaption></figure><ul><li>åŒ—åŠçƒå†¬å­£æ™‚ï¼Œæ­äºå¤§é™¸ç”±æ–¼é™æº«å¿«ï¼Œåœ¨ä¿„ç¾…æ–¯è¥¿ä¼¯åˆ©äºèˆ‡è’™å¤ä¸€å¸¶å½¢æˆçš„é«˜å£“å¸¶ã€‚</li><li>æ­¤é«˜å£“å¸¶ç”±æ–¼æº«åº¦ä½ï¼Œåˆè¢«ç¨±ç‚ºå†·é«˜å£“ã€‚</li><li>éš¨è‘—ç©ºæ°£ç”±è¥¿ä¼¯åˆ©äºé«˜æ°£å£“æµå‘æµ·ä¸Šä½æ°£å£“ï¼Œå½¢æˆäºæ´²çš„å†¬å­£å­£é¢¨ã€‚</li></ul><figure><img src="https://i.imgur.com/8jGvBCC.jpeg" alt="è¥¿ä¼¯åˆ©äºé«˜å£“ç¤ºæ„åœ–ã€è’™å¤å†·é«˜å£“ç¤ºæ„åœ–" /><figcaption>è¥¿ä¼¯åˆ©äºé«˜å£“ç¤ºæ„åœ–ã€è’™å¤å†·é«˜å£“ç¤ºæ„åœ–</figcaption></figure><h2 id="äºšæ¬§å¤§é™†å†¬å­£å†·ç©ºæ°”çš„ç­–æºåœ°">äºšæ¬§å¤§é™†å†¬å­£å†·ç©ºæ°”çš„ç­–æºåœ°ï¼Ÿ</h2><ul><li><a href="https://mp.weixin.qq.com/s/QEm7hwk_BACqcOQLx5t5lQ">è’™å¤å’Œè¥¿ä¼¯åˆ©äºšåœ°åŒºï¼Œä¸ºä»€ä¹ˆä¼šæˆä¸ºäºšæ¬§å¤§é™†å†¬å­£å†·ç©ºæ°”çš„ç­–æºåœ°ï¼Ÿ</a></li></ul><p>æ°£å€™å¯åˆ†ç‚ºè¨±å¤šè¦ç´ ï¼Œå¸¸è¦‹çš„æ°£å€™è¦ç´ åŒ…æ‹¬æ°£æº«ã€é™æ°´ã€å…‰ç…§ç­‰å…§å®¹ã€‚å°±æ°£æº«è¦ç´ è€Œè¨€ï¼Œä¸–ç•Œå„åœ°å†·ç†±ä¸åŒï¼Œæ°£æº«çš„åˆ†ä½ˆæœ‰å¾ˆå¤§çš„å·®ç•°ã€‚å½±éŸ¿æ°£æº«çš„å› ç´ å¾ˆå¤šï¼ŒåŒ…æ‹¬ç·¯åº¦ä½ç½®ã€æµ·é™¸ä½ç½®ã€åœ°å½¢æµ·æ‹”ã€å¤§æ°£ç’°æµã€æ´‹æµå› ç´ ã€ä¸‹å¢Šé¢å› ç´ ä»¥åŠäººé¡æ´»å‹•å› ç´ ç­‰ï¼Œå…¶ä¸­ç·¯åº¦å› ç´ æ˜¯å½±éŸ¿æ°£æº«æœ€é‡è¦çš„å› ç´ ã€‚</p><p><strong>éš¨è‘—ç·¯åº¦çš„å¢åŠ ï¼Œå¹´å¹³å‡æ­£åˆå¤ªé™½é«˜åº¦è§’å°±ä¸æ–·é™ä½ï¼Œç²å¾—å¤ªé™½è¼»å°„çš„èƒ½é‡å°±æ¸›å°‘ï¼Œå…¨çƒæ°£æº«æ•´é«”ç”±èµ¤é“å¾€å…©æ¥µåœ°å€éæ¸›</strong>ã€‚</p><figure><img src="https://i.imgur.com/us3UXq1.png" alt="éš¨è‘—ç·¯åº¦çš„å¢åŠ ï¼Œå¹´å¹³å‡æ­£åˆå¤ªé™½é«˜åº¦è§’å°±ä¸æ–·é™ä½ï¼Œç²å¾—å¤ªé™½è¼»å°„çš„èƒ½é‡å°±æ¸›å°‘ï¼Œå…¨çƒæ°£æº«æ•´é«”ç”±èµ¤é“å¾€å…©æ¥µåœ°å€éæ¸›" /><figcaption>éš¨è‘—ç·¯åº¦çš„å¢åŠ ï¼Œå¹´å¹³å‡æ­£åˆå¤ªé™½é«˜åº¦è§’å°±ä¸æ–·é™ä½ï¼Œç²å¾—å¤ªé™½è¼»å°„çš„èƒ½é‡å°±æ¸›å°‘ï¼Œå…¨çƒæ°£æº«æ•´é«”ç”±èµ¤é“å¾€å…©æ¥µåœ°å€éæ¸›</figcaption></figure><p>ä¸éï¼Œåœ¨åŒ—åŠçƒæœ€å†·çš„åœ°é»ä¸¦ä¸åœ¨ç·¯åº¦æœ€é«˜çš„åŒ—æ¥µé»ï¼Œè€Œæ˜¯åœ¨è¥¿ä¼¯åˆ©äºæ±éƒ¨çš„å¥§ä¼Šç±³äºåº·ï¼Œæ¥µç«¯æœ€ä½æ°£æº«é”åˆ°-71.2â„ƒï¼Œè¢«ç¨±ç‚ºåŒ—åŠçƒã€Œå¯’æ¥µã€ã€‚æ­¤å¤–ï¼Œè’™å¤å’Œè¥¿ä¼¯åˆ©äºåœ°å€ï¼Œä¹Ÿè¢«ç¨±ç‚ºäºæ­å¤§é™¸å†¬å­£å†·ç©ºæ°£çš„ç­–æºåœ°ï¼Œé€™æ˜¯ç‚ºä»€éº¼ï¼Ÿ</p><ul><li>æµ·é™¸çš„æ¯”ç†±å·®ç•°</li></ul><p>æˆ‘å€‘çŸ¥é“ï¼Œå½±éŸ¿æ°£æº«é«˜ä½çš„å› ç´ å¾ˆå¤šï¼Œè€Œç·¯åº¦åªæ˜¯å…¶ä¸­çš„ä¸€å€‹å› ç´ ï¼ŒåŒ—æ¥µé›–ç„¶åœ°è™•é«˜ç·¯åº¦åœ°å€ï¼Œä½†æ˜¯é€™ä¸€å€åŸŸä¸¦ä¸æ˜¯é™¸åœ°ï¼Œè€Œæ˜¯åˆ†ä½ˆè‘—åŒ—å†°æ´‹ã€‚åœ¨å¤å­£å­£ç¯€ï¼Œæµ·æ°´èƒ½å¤ å„²å­˜è¼ƒå¤šçš„ç†±é‡ï¼Œå¾è€Œåˆ°äº†å†¬å­£å­£ç¯€é™æº«å°±è¼ƒæ…¢ï¼Œé€™å°±æ˜¯ç”±æ–¼æµ·é™¸çš„æ¯”ç†±å·®ç•°è€Œç”¢ç”Ÿçš„ã€‚åè§€ä¸–ç•Œä¸Šæœ€å¤§çš„å¤§é™¸äºæ­å¤§é™¸ï¼Œç”±æ–¼æ˜¯é™¸åœ°æ¯”ç†±è¼ƒå°ï¼Œå¤å­£å‡æº«å¿«ï¼ŒåŒæ¨£çš„å†¬å­£æ™‚é™æº«ä¹Ÿå¿«ã€‚</p><p>å› æ­¤ï¼Œåˆ°äº†å†¬å­£å­£ç¯€ï¼Œäºæ­å¤§é™¸å…§éƒ¨çš„æ°£æº«æ˜é¡¯æ¯”åŒç·¯åº¦çš„å¤ªå¹³æ´‹å’Œå¤§è¥¿æ´‹åœ°å€ä½ã€‚é™¤äº†æ¯”ç†±å°æ°£æº«çš„å½±éŸ¿ä¹‹å¤–ï¼Œåœ°å½¢æµ·æ‹”ä¹Ÿèµ·åˆ°äº†ä¸€å®šçš„å½±éŸ¿ä½œç”¨ï¼Œåœ¨å°æµå±¤å¤§æ°£ä¸­ï¼Œæµ·æ‹”è¶Šé«˜æ°£æº«è¶Šä½ï¼Œå¤§ç´„æµ·æ‹”æ¯å‡é«˜1000ç±³ï¼Œæ°£æº«å°±æœƒä¸‹é™å¤§ç´„6â„ƒï¼Œè€Œè’™å¤å’Œè¥¿ä¼¯åˆ©äºåœ°å€çš„åœ°å½¢å–®å…ƒä¸»è¦ç‚ºè’™å¤é«˜åŸã€ä¸­è¥¿ä¼¯åˆ©äºé«˜åŸå’Œæ±è¥¿ä¼¯åˆ©äºå±±åœ°ï¼Œé€™äº›åœ°å€æµ·æ‹”ç›¸å°è¼ƒé«˜ï¼Œå¾è€Œæ›´é™ä½äº†é€™ä¸€åœ°å€çš„æ°£æº«ã€‚äºæ­å¤§é™¸å…§éƒ¨å¤§ç¯„åœçš„ä½æº«å€åŸŸï¼Œä½¿å¾—é€™ä¸€åœ°å€å½¢æˆäº†ä¸€å€‹ç¯„åœååˆ†å·¨å¤§çš„â€œå†·é«˜å£“â€ï¼Œä¹Ÿè¢«ç¨±ç‚ºâ€œäºæ´²é«˜å£“â€ã€‚</p><p>ç”±æ–¼å…¶ä¸­å¿ƒä¸»è¦ä½æ–¼è’™å¤å’Œè¥¿ä¼¯åˆ©äºåœ°å€ï¼Œæ‰€ä»¥ä¹Ÿå¸¸è¢«ç¨±ç‚ºâ€œè’™å¤è¥¿ä¼¯åˆ©äºé«˜å£“â€ï¼Œ<strong>ç”±æ–¼é€™å€‹é«˜å£“çš„å­˜åœ¨ï¼Œå°±æŠŠå‰¯æ¥µåœ°ä½æ°£å£“å¸¶çµ¦åˆ‡æ–·äº†ï¼Œä½¿ä¹‹åªä¿ç•™åœ¨æµ·æ´‹ä¸Šï¼Œä½æ–¼å¤ªå¹³æ´‹ä¸Šçš„ç¨±ç‚ºâ€œé˜¿ç•™ç”³ä½å£“â€ï¼Œè€Œä½æ–¼å¤§è¥¿æ´‹ä¸Šçš„ç¨±ç‚ºâ€œå†°å³¶ä½å£“â€</strong>ã€‚äºæ´²é«˜å£“å±¬æ–¼å…¸å‹çš„â€œæ¥µåœ°å¤§é™¸æ°£åœ˜â€ï¼Œå…¶å‹¢åŠ›ååˆ†å·¨å¤§ï¼Œå¯ä»¥å½±éŸ¿åˆ°å¹¾ä¹æ•´å€‹äºæ­å¤§é™¸ã€‚æˆ‘å€‘çŸ¥é“æ°´å¹³æ–¹å‘çš„ç©ºæ°£å§‹çµ‚éµå¾ªå¾é«˜å£“æµå‘ä½å£“ï¼Œå› æ­¤åœ¨å†¬åŠå¹´ï¼Œ<strong>è¿‘åœ°é¢ç©ºæ°£å°±æœƒå¾æ°£å£“æœ€é«˜çš„è’™å¤è¥¿ä¼¯åˆ©äºé«˜å£“å‘å››å‘¨æµå‡ºã€‚</strong></p><p>ç”±æ–¼è©²å€åŸŸå¾€åŒ—æ˜¯åŒ—å†°æ´‹ï¼Œå†¬å­£æ°£æº«ä¹Ÿéå¸¸ä½ï¼Œå…©åœ°é–“çš„æ°£å£“å·®è¼ƒå°ï¼Œå› æ­¤å¾€åŒ—çš„æ°£æµä¸¦ä¸ååˆ†æ˜é¡¯ã€‚åŒæ™‚ï¼Œç”±æ–¼è’™å¤è¥¿ä¼¯åˆ©äºåœ°å€æ‰€åœ¨çš„ç·¯åº¦ï¼Œä¸»è¦å—ç››è¡Œè¥¿é¢¨å¸¶æ§åˆ¶ï¼Œæ‰€ä»¥å¾€è¥¿æµå‡ºçš„æ°£æµä¹Ÿä¸ååˆ†å¼·å¤§ã€‚è€Œå¾è’™å¤è¥¿ä¼¯åˆ©äºé«˜å£“å¾€æ±å’Œå¾€å—æµå‡ºçš„æ°£æµå‰‡ååˆ†å¼·å‹ï¼Œåœ¨åœ°è½‰åå‘åŠ›çš„å½±éŸ¿ä¸‹ï¼Œåœ¨æ±äºåœ°å€å½¢æˆäº†è¥¿åŒ—å­£é¢¨ï¼Œåœ¨å—äºå’Œæ±å—äºåœ°å€å½¢æˆäº†æ±åŒ—å­£é¢¨ã€‚è€Œä¾†è‡ªè’™å¤è¥¿ä¼¯åˆ©äºé«˜å£“çš„è¥¿åŒ—å­£é¢¨å°±æ˜¯å½±éŸ¿æˆ‘åœ‹å†¬åŠå¹´å¤§å¹…é™æº«çš„ä¸»è¦å› ç´ ï¼Œä¹Ÿå°±æ˜¯æˆ‘å€‘ç†Ÿç¨±çš„ã€Œå†·ç©ºæ°£ã€ã€‚</p><figure><img src="https://i.imgur.com/NxUfgIP.jpeg" alt="ä¸€æœˆä»½æµ·å¹³é¢ç­‰å£“ç·šåˆ†ä½ˆåœ–" /><figcaption>ä¸€æœˆä»½æµ·å¹³é¢ç­‰å£“ç·šåˆ†ä½ˆåœ–</figcaption></figure><h1 id="åˆ†æå’Œæ–‡ç»ç¶œè¿°">åˆ†æå’Œæ–‡ç»ç¶œè¿°</h1><h2 id="å¹´1æœˆæ±äºå†·å†¬çš„ç¶œè§€å¤©æ°£åˆ†æé å ±"><a href="https://www.science.ntu.edu.tw/fiveyears/newsletter35/Atmos-Yang.php?NumId=354">2018å¹´1æœˆæ±äºå†·å†¬çš„ç¶œè§€å¤©æ°£åˆ†æé å ±</a></h2><p>åŒ—åŠçƒåœ¨å†¬å­£æ™‚ï¼Œç”±æ–¼é™¸åœ°èˆ‡æµ·æ´‹çš„æ¯”ç†±å·®ç•°ä½¿å¾—é™¸åœ°ä¸Šå¸¸å½¢æˆæ€§è³ªè¼ƒä¹¾å†·çš„å¤§é™¸å‹å†·é«˜å£“å‹æ…‹çš„æ°£åœ˜ã€‚å°æ–¼æ±äºåœ°å€å†¬å­£æ°£å€™å¹³å‡åœ°é¢å¤©æ°£å‹æ…‹è€Œè¨€ï¼Œå¤§é™¸å‹å†·é«˜å£“çš„ä¸­å¿ƒä½ç½®ç¶“å¸¸ä½æ–¼è’™å¤æˆ–è¥¿ä¼¯åˆ©äºåœ°å€ï¼Œå› æ­¤è¢«ç¨±ä¹‹ç‚ºè’™å¤é«˜å£“æˆ–è¥¿ä¼¯åˆ©äºé«˜å£“ã€‚åœ¨æ°£è±¡åˆ†æä¸Š<strong>å¸¸ä»¥1020ç™¾å¸•(hPa)ç­‰å£“ç·šä¾†ç•Œå®šè’™å¤é«˜å£“çš„æ°£åœ˜æ¶µè“‹ç¯„åœ</strong>ã€‚</p><p>å°ç£å†¬å­£çš„å¯’æµè·Ÿè’™å¤é«˜å£“çš„å¼·åº¦æ¶ˆé•·æœ‰å¾ˆå¤§çš„é—œä¿‚ï¼Œä½†å¯¦éš›ä¸Šå½±éŸ¿å°ç£åœ°å€çš„å†·ç©ºæ°£ä¸¦ä¸æ˜¯è’™å¤é«˜å£“ç›´æ¥å£Ÿç½©å°ç£ï¼Œè€Œæ˜¯ç”±è’™å¤é«˜å£“æ‰€åˆ†é›¢å‡ºä¾†çš„åˆ†è£‚é«˜å£“æ‰€é€ æˆçš„ã€‚æˆ‘å€‘å¯ä»¥æƒ³åƒæˆæ²™ä¸˜å †ç´¯ç©åˆ°ä¸€å®šçš„é«˜åº¦æœƒå´©è½ä¸€å°éƒ¨åˆ†ï¼Œåœ¨å‘¨åœå½¢æˆå°æ²™ä¸˜ï¼Œè€Œé€™å€‹å‘¨åœçš„å°æ²™ä¸˜å°±é¡ä¼¼åˆ†è£‚é«˜å£“ã€‚ä¹¾å†·çš„åˆ†è£‚é«˜å£“è‡ªè’™å¤å¾€æ±å—æ–¹å‘ç§»å‹•ï¼Œç•¶å®ƒåˆ†è£‚é«˜å£“çš„ä½ç½®è¶Šé è¿‘å°ç£ï¼Œè¡¨ç¤ºå°ç£å—åˆ°å†·é«˜å£“çš„å½±éŸ¿å°±è¶Šé¡¯è‘—ï¼Œæ°£æº«é€šå¸¸ä¹Ÿæœƒé™å¾—æ›´ä½ã€‚ç•¶åˆ†è£‚é«˜å£“èˆ‡å—æ–¹ç©ºæ°£ç›¸æœƒæ™‚ï¼Œå—æ–¹æ½®æ¿•çš„ç©ºæ°£é‡ä¸Šä¹¾å†·çš„åˆ†è£‚é«˜å£“æŠ¬å‡é€ æˆæ°´æ°£å‡çµï¼Œç¶“å¸¸å°è‡´å°ç£æ±åŒ—éƒ¨é™æ°´ç”šè‡³å±±å€é™é›ªçš„ç¾è±¡ï¼›åä¹‹ï¼Œè‹¥å—æ–¹æ°´æ°£ä¾›æ‡‰è¼ƒä¸å……è¶³çš„æƒ…æ³ä¸‹ï¼Œå°ç£å°±è™•æ–¼è¼ƒä¹¾å†·çš„å¤©æ°£ã€‚</p><ul><li>åœ°é¢å¤©æ°£åˆ†æåœ–</li></ul><p>åœ–1: (a)éŸ“åœ‹æ°£è±¡å»³(KMA) 2018å¹´2æœˆ1æ—¥ 0000UTCå’Œ (b) 2018å¹´2æœˆ3æ—¥ 1200UTC çš„åœ°é¢å¤©æ°£åˆ†æåœ–ã€‚</p><table><thead><tr class="header"><th style="text-align: left;">2018å¹´2æœˆ1æ—¥ 0000UTC</th><th style="text-align: left;">2018å¹´2æœˆ3æ—¥ 1200UTC</th></tr></thead><tbody><tr class="odd"><td style="text-align: left;"><img src="https://www.science.ntu.edu.tw/fiveyears/newsletter35/Images/1a.png" alt="1a" /></td><td style="text-align: left;"><img src="https://www.science.ntu.edu.tw/fiveyears/newsletter35/Images/1b.png" alt="1b" /></td></tr></tbody></table><p>é™¤äº†åœ°é¢å¤©æ°£åœ–ä¹‹å¤–ï¼Œæ°£è±¡å­¸å®¶ä¹Ÿæœƒåˆ†æä¸­é«˜å±¤ç­‰å£“é¢ä¸Šçš„é«˜ç©ºå¤©æ°£åœ–(å¦‚åœ–2)ã€‚ç­‰å£“é¢ä¸Šå¯ä»¥çœ‹åˆ°åƒæ³¢å‹•èˆ¬å½æ›²çš„ç­‰é«˜ç·š(è¦‹åœ–2çš„é»‘è‰²å¯¦ç·š)ï¼Œ<strong>ç”±æ–¼é«˜ç©ºé¢¨ä¸å—æ‘©æ“¦åŠ›çš„å½±éŸ¿ï¼Œæ‰€ä»¥é«˜ç©ºé¢¨å¹³è¡Œç­‰é«˜ç·šå¹æ‹‚</strong>ã€‚åœ¨é«˜ç©ºå¤©æ°£åœ–é¡¯ç¤ºä¸­ç·¯åº¦åœ°å€ç­‰é«˜ç·šæœƒåœ¨ä¸åŒç·¯åº¦é–“å—åŒ—æ“ºç›ªï¼Œé€™ç¨®æ³¢å‹•ç¾è±¡ç¨±ä¹‹ç‚ºã€Œè¥¿é¢¨æ³¢ã€ã€‚ä»¥åŒ—åŠçƒçš„å¤§æ°£ç’°æµè€Œè¨€ï¼Œè¥¿é¢¨æ³¢é«˜åº¦å ´è¼ƒé«˜çš„æ³¢å³°è™•ç¨±ä½œã€Œè„Šã€ï¼Œé«˜åº¦å ´è¼ƒä½çš„æ³¢è°·è™•ç¨±ä½œã€Œæ§½ã€ã€‚æ§½å‰ä¸ç©©å®šçš„å¤§æ°£ç’°å¢ƒå°‡æœƒå¸¶å‹•åœ°é¢çš„æº«å¸¶æ°£æ—‹ç§»å‹•ï¼Œæ§½å¾Œç©©å®šçš„å¤§æ°£ç’°å¢ƒå‰‡å¯ä»¥å¸¶å‹•åœ°é¢çš„é«˜å£“æ°£åœ˜ç§»å‹•ã€‚å› æ­¤åœ¨ä¸­ç·¯åº¦åœ°å€åœ°é¢å¤©æ°£åœ–ä¸­åˆ†è£‚é«˜å£“çš„ç§»å‹•ï¼Œä¸»è¦å—åˆ°é«˜ç©ºè¥¿é¢¨æ³¢å‹•çš„ç‰½å¼•ï¼Œå› æ­¤é«˜ç©ºè¥¿é¢¨å¸¶ä¸­æ§½è„Šç·šçš„ä½ç½®å’Œç§»å‹•å°æ–¼å°ç£å†¬å­£çš„ç¶œè§€å°ºåº¦(Synoptic Scale)å¤©æ°£é å ±æœ‰è‘—é¡¯è‘—çš„å½±éŸ¿ã€‚2018å¹´ä¸€æœˆåº•è‡³äºŒæœˆä¸­æ—¬ä¸€æ³¢æ¥è‘—ä¸€æ³¢ä¸åœæ­‡çš„ä½æº«å¯’æµï¼Œ<strong>èˆ‡åŒ—å¤ªå¹³æ´‹ç™½ä»¤æµ·é«˜ç©ºå‡ºç¾é˜»å¡é«˜å£“æœ‰é—œ(åœ–2)ã€‚é€™æ®µæœŸé–“è¥¿é¢¨åå¼±ï¼Œä½¿å¾—é˜»å¡é«˜å£“å’Œå…¶è¥¿æ–¹çš„æ§½ç·šç³»çµ±ç§»å‹•æ¸›æ…¢ï¼Œæ§½å¾Œçš„åœ°é¢é«˜å£“æ°£åœ˜åŠå…¶æŒ¾å¸¶çš„å†·ç©ºæ°£ä¾¿å¾€ä½ç·¯åº¦åœ°å€ç§»å‹•ï¼Œé€ æˆé€™æ¬¡è‡ºç£å°‡è¿‘å…©æ˜ŸæœŸé•·æ™‚é–“çš„å¯’æµç¾è±¡ã€‚</strong></p><ul><li>500hPa ä¹‹é«˜åº¦(é»‘è‰²å¯¦ç·š)åŠæº«åº¦(ç´…è‰²è™›ç·š)åˆ†æåœ–</li></ul><p>åœ–2: (a)éŸ“åœ‹æ°£è±¡å»³(KMA) 2018å¹´2æœˆ1æ—¥ 0000UTCå’Œ (b) 2018å¹´2æœˆ3æ—¥ 1200UTC 500hPa ä¹‹é«˜åº¦(é»‘è‰²å¯¦ç·š)åŠæº«åº¦(ç´…è‰²è™›ç·š)åˆ†æåœ–ï¼Œé˜»å¡é«˜å£“ä½åœ¨ç™½ä»¤æµ·åŒ—é‚Šã€‚</p><table><thead><tr class="header"><th style="text-align: left;">2018å¹´2æœˆ1æ—¥ 0000UTC</th><th style="text-align: left;">2018å¹´2æœˆ3æ—¥ 1200UTC</th></tr></thead><tbody><tr class="odd"><td style="text-align: left;"><img src="https://www.science.ntu.edu.tw/fiveyears/newsletter35/Images/2a.png" alt="1a" /></td><td style="text-align: left;"><img src="https://www.science.ntu.edu.tw/fiveyears/newsletter35/Images/2b.png" alt="1b" /></td></tr></tbody></table><h2 id="ç§‹-å†¬è½¬æ¢æ—¶æœŸè¥¿ä¼¯åˆ©äºšé«˜å‹å»ºç«‹æ°”å€™æ€å’Œå¹´é™…å˜åŒ–æœºç†ç ”ç©¶"><a href="https://iap.cas.cn/gb/xwdt/kyjz/202407/t20240709_7214328.html">2024 | ç§‹-å†¬è½¬æ¢æ—¶æœŸè¥¿ä¼¯åˆ©äºšé«˜å‹å»ºç«‹æ°”å€™æ€å’Œå¹´é™…å˜åŒ–æœºç†ç ”ç©¶</a></h2><p>ä¸œäºšå†¬å­£é£æ˜¯å…¨çƒæœ€å¼ºçš„å†¬å­£é£ï¼Œä¹Ÿæ˜¯åŒ—åŠçƒå†¬å­£åŒ—æå†·ç©ºæ°”å‘å—è¿è¾“çš„æœ€ä¸»è¦é€šé“ã€‚æˆ‘å›½åœ°å¤„ä¸œäºšå­£é£åŒºï¼Œæ˜¾è‘—åœ°å—åˆ°ä¸œäºšå†¬å­£é£çš„å½±å“ã€‚è¥¿ä¼¯åˆ©äºšé«˜å‹æ˜¯ä¸œäºšå†¬å­£é£ç¯æµç³»ç»Ÿçš„é‡è¦æˆå‘˜ï¼Œæ¢ç©¶è¥¿ä¼¯åˆ©äºšé«˜å‹å¯¹ç†è§£ä¸œäºšå†¬å­£é£å’Œæˆ‘å›½å†¬å­£å¤©æ°”æ°”å€™è‡³å…³é‡è¦ã€‚</p><p>è¥¿ä¼¯åˆ©äºšé«˜å‹åˆç§°â€œè’™å¤é«˜å‹â€ï¼Œæ˜¯åŒ—åŠçƒå†¬å­£ä½äºæ¬§äºšå¤§é™†ä¸Šçš„åŠæ°¸ä¹…æ€§é«˜å‹ä¸­å¿ƒã€‚å­˜åœ¨æ˜¾è‘—çš„å¹´å¾ªç¯ç‰¹å¾ï¼šåœ¨ç§‹å­£å»ºç«‹ï¼Œå†¬å­£ç››è¡Œï¼ˆå›¾1ï¼‰ã€‚ç›®å‰ï¼Œè¾ƒå¤šçš„ç ”ç©¶é›†ä¸­äºåˆ†æè¥¿ä¼¯åˆ©äºšé«˜å‹åœ¨å†¬å­£ç››æœŸçš„å˜åŒ–ï¼Œè¾ƒå°‘å…³æ³¨å…¶åœ¨ç§‹å­£çš„å»ºç«‹ï¼›è€Œæ¢ç©¶è¥¿ä¼¯åˆ©äºšé«˜å‹çš„å»ºç«‹å¯¹äºç†è§£ä¸œäºšå†¬å­£é£ç¯æµçš„å»ºç«‹å’Œæˆ‘å›½å†¬å­£æ¬¡å­£èŠ‚æ—¶é—´å°ºåº¦çš„é¢„æŠ¥å…·æœ‰é‡è¦æ„ä¹‰ã€‚</p><p>1.â€‚å®¢è§‚å®šä¹‰â€œç§‹-å†¬è½¬æ¢æ—¶æœŸè¥¿ä¼¯åˆ©äºšé«˜å‹å»ºç«‹â€</p><figure><img src="https://iap.cas.cn/gb/xwdt/kyjz/202407/W020240709346896451892_ORIGIN.jpg" alt="æ¬§äºšå¤§é™†æ°”å€™æ€æµ·å¹³é¢æ°”å‹çš„é€æœˆæ¼”å˜ã€‚" /><figcaption>æ¬§äºšå¤§é™†æ°”å€™æ€æµ·å¹³é¢æ°”å‹çš„é€æœˆæ¼”å˜ã€‚</figcaption></figure><p>2.â€‚è¥¿ä¼¯åˆ©äºšé«˜å‹å»ºç«‹çš„æ°”å€™æ€ç‰¹å¾å’Œæœºç†åˆ†æ</p><figure><img src="https://iap.cas.cn/gb/xwdt/kyjz/202407/W020240709346896802817_ORIGIN.png" alt="è¥¿ä¼¯åˆ©äºšé«˜å‹å»ºç«‹æ°”å€™æ€çš„çƒ­åŠ¨åŠ›ç‰¹å¾å’Œæœºç†ç¤ºæ„å›¾" /><figcaption>è¥¿ä¼¯åˆ©äºšé«˜å‹å»ºç«‹æ°”å€™æ€çš„çƒ­åŠ¨åŠ›ç‰¹å¾å’Œæœºç†ç¤ºæ„å›¾</figcaption></figure><p>3.â€‚è¥¿ä¼¯åˆ©äºšé«˜å‹å»ºç«‹å¹´é™…å˜åŒ–çš„æœºç†åˆ†æ</p><figure><img src="https://iap.cas.cn/gb/xwdt/kyjz/202407/W020240709346897199095_ORIGIN.jpg" alt="è¥¿ä¼¯åˆ©äºšé«˜å‹å»ºç«‹åæ—©å¹´çš„ç¯æµç‰¹å¾å’Œæœºç†ç¤ºæ„å›¾ï¼ˆåæ™šå¹´ç›¸å" /><figcaption>è¥¿ä¼¯åˆ©äºšé«˜å‹å»ºç«‹åæ—©å¹´çš„ç¯æµç‰¹å¾å’Œæœºç†ç¤ºæ„å›¾ï¼ˆåæ™šå¹´ç›¸å</figcaption></figure><h1 id="references">References</h1><ol type="1"><li>ä¾¯äºšçº¢,æ¨ä¿®ç¾¤,æåˆš.å†¬å­£è¥¿ä¼¯åˆ©äºšé«˜å‹å˜åŒ–ç‰¹å¾åŠå…¶ä¸ä¸­å›½æ°”æ¸©çš„å…³ç³»[J].æ°”è±¡ç§‘æŠ€,2007,35(5):646~650</li><li><a href="https://www.cwa.gov.tw/Data/climate/Knowledge/pdf/201101-1.pdf">ä¸­å¤®æ°£è±¡å±€ | 2011-01 å¯’æµèˆ‡å‡é›¨</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>Meteorology</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Subtropical high | å‰¯ç†±å¸¶é«˜å£“</title>
    <link href="/2024/10/03/Subtropical-high/"/>
    <url>/2024/10/03/Subtropical-high/</url>
    
    <content type="html"><![CDATA[<h1 id="å‰¯ç†±å¸¶é«˜å£“">å‰¯ç†±å¸¶é«˜å£“</h1><p>äºç†±å¸¶é«˜å£“ï¼ˆSubtropical highï¼Œåˆç¨±äºç†±å¸¶é«˜æ°£å£“ã€å‰¯ç†±å¸¶é«˜å£“ã€å‰¯ç†±å¸¶é«˜æ°£å£“ï¼‰ï¼Œ<strong>å…¶è„Šç·šç¨±ç‚ºå‰¯ç†±å¸¶é«˜å£“è„Š</strong>ï¼Œæ°£è±¡å­¸åè©ï¼Œæ˜¯æŒ‡æ´»èºæ–¼äºç†±å¸¶åœ°å€çš„é«˜å£“è„Šï¼Œåˆ†ä½ˆæ–¼å—åŒ—ç·¯30Â°å·¦å³ï¼Œæ˜¯ä¸€è‚¡ç¶“å¸¸å­˜åœ¨ä½†ä½ç½®ä¸å›ºå®šçš„æº«æš–æ°£åœ˜ã€‚å®ƒçš„ä½ç½®ä»¥åŠå…§è£æ°£æµçš„æµå‘å¯ä»¥å½±éŸ¿åˆ°ç†±å¸¶æ°£æ—‹çš„ç”Ÿæˆå’Œèµ°å‘ã€‚</p><p>ç‚ºå‹•åŠ›æˆå› ï¼Œåœ°çƒåœ¨èµ¤é“é™„è¿‘æ¥æ”¶çš„ç†±è¼»å°„æœ€å¤§ï¼Œå°è‡´å‡ºç¾æ²¿ç†±å¸¶è¼»åˆå¸¶çš„å¤§é‡å°æµã€‚é€™è£çš„æ°£åœ˜ä¸Šå‡ç„¶å¾Œç™¼æ•£ï¼Œå—åœ°è½‰åå‘åŠ›å½±éŸ¿ï¼Œåˆ†åˆ¥å‘åŒ—å’Œå—å…©å€‹æ–¹å‘é é›¢èµ¤é“ã€‚éš¨ç€ç©ºæ°£å‘èµ¤é“å…©å´çš„ä¸­ç·¯åº¦åœ°å€ç§»å‹•ï¼Œå®ƒæœƒå†·å»ä¸‹æ²‰ä¸¦å½¢æˆä¸‹æ²‰æ°£æµã€‚é€™åœ¨å…©å€‹åŠçƒçš„30åº¦å¹³è¡Œç·šé™„è¿‘ç”¢ç”Ÿäº†ä¸€å€‹é«˜å£“è„Šã€‚ä¸‹æ²‰çš„ç©ºæ°£å†æ¬¡ç™¼æ•£ï¼Œä¸€äº›ç©ºæ°£è¿”å›èµ¤é“ï¼Œå½¢æˆäº†<strong>å“ˆå¾·ä¾†ç’°æµ(Hadley cell)</strong>ã€‚</p><p><strong>å¤ªé™½è¼»å°„å’Œåœ°è½‰åå‘åŠ›æ˜¯æœ€ä¸»è¦çš„åŸå› ã€‚</strong>èµ¤é“åœ°å€çš„å¤ªé™½è¼»å°„æ¯”è¼ƒå¼·çƒˆï¼Œè©²å€çš„ç©ºæ°£æœƒä¸Šå‡ï¼Œåˆ°äº†é«˜ç©ºå¾Œå°±æœƒå‘æ¥µåœ°æ–¹å‘æµå‹•ã€‚è€Œåœ°è½‰åå‘åŠ›ä½¿å¾—æ°£æµä¸æ–·ç™¼ç”Ÿåç§»ï¼Œéš¨è‘—ç·¯åº¦çš„å‡é«˜ï¼Œåœ°è½‰åå‘åŠ›å°±è¶Šå¤§ï¼Œè‡´ä½¿åœ¨å‰¯ç†±å¸¶åœ°å€ï¼ˆåŒ—ç·¯30åº¦é™„è¿‘ï¼‰ï¼Œæ°£æµåŸºæœ¬è®Šæˆäº†è‡ªè¥¿å‘æ±æµå‹•ï¼Œä¸¦å°å¾ŒçºŒç©ºæ°£é€²è¡Œé˜»ç¤™ã€‚é€™ä¸€é˜»ç¤™ä½¿å¾—å…¶ä»–ä¸Šç©ºç©ºæ°£èšé›†ä¸¦ä¸”è¢«è¿«ä¸‹æ²‰ï¼Œæ–¼æ˜¯ä¾¿ç”¢ç”Ÿäº†å‰¯ç†±å¸¶é«˜å£“ã€‚</p><p><strong>è¥¿åŒ—å¤ªå¹³æ´‹å‰¯é«˜æ˜¯å¸¸å¹´å­˜åœ¨çš„æ°¸ä¹…æ€§æš–æ€§æ·±åšç³»çµ±ï¼ˆå®ƒå¾ä½åˆ°é«˜éƒ½æ˜¯é«˜å£“ï¼Œå› è€Œæ°£è±¡ä¸Šç¨±ä¹‹ç‚ºæ·±åšç³»çµ±ï¼‰</strong>ï¼Œå…¶å¼·åº¦å’Œä½ç½®éš¨è‘—å­£ç¯€ç”¢ç”Ÿè®ŠåŒ–ã€‚ç”±æ–¼å‰¯é«˜æœ¬èº«æ˜¯å€‹æš–æ€§é«˜å£“ï¼ŒåŠ ä¸Šå…¶ç››è¡Œçš„ä¸‹æ²‰æ°£æµå¢æº«æ•ˆæ‡‰ï¼Œ<strong>ä¸­å¿ƒåœ°å¸¶ï¼ˆç¨±ç‚ºè„Šç·šï¼‰</strong> å¤©æ°£åŸºæœ¬æ ¼èª¿æ˜¯æ™´ç†±ä¹¾ç‡¥çš„ï¼Œå› æ­¤å‰¯é«˜æ‰€åœ¨ä½ç½®çš„å¤©æ°£é«˜æº«å°‘é›¨ï¼Œå¦‚æœå‰¯é«˜ç©©å®šæ§åˆ¶ä¸€å€‹åœ°å€ï¼Œé€™è£å°±éå¸¸å®¹æ˜“å‡ºç¾ä¹¾æ—±å’Œé«˜æº«å¤©æ°£ã€‚</p><figure><img src="https://upload.wikimedia.org/wikipedia/commons/2/21/%E5%A4%A7%E6%B0%A3%E7%92%B0%E6%B5%81.png" alt="å“ˆå¾·ä¾†ç’°æµ(Hadley cell)" /><figcaption>å“ˆå¾·ä¾†ç’°æµ(Hadley cell)</figcaption></figure><p>å‰¯ç†±å¸¶é«˜å£“å½±éŸ¿ä¸‹çš„æ°£å€™ä¸€èˆ¬æ˜¯é«˜æº«ï¼Œä¸”å±¤çµç©©å®šï¼Œå°æµå¾ˆä¸æ—ºç››ï¼Œæ‰€ä»¥é™æ°´è¼ƒå°‘ã€‚å‰¯ç†±å¸¶é«˜å£“çš„è¥¿éƒ¨å±¤çµè¼ƒç‚ºä¸ç©©å®šï¼Œæ±éƒ¨ç›¸å°ç©©å®šã€‚æ‰€ä»¥å‰¯ç†±å¸¶é«˜å£“è¥¿éƒ¨é™æ°´ç¨å¤šï¼Œæ±éƒ¨é™æ°´æ¯”è¼ƒå°‘ã€‚ç”±æ–¼å¤ªé™½è¼»å°„å’Œåœ°çƒè‡ªè½‰ç”¢ç”Ÿçš„åœ°è½‰åå‘åŠ›ï¼Œå—ã€åŒ—åŠçƒçš„å‰¯ç†±å¸¶åœ°å€å‡å­˜åœ¨ä¸€æ¢é«˜å£“å¸¶ã€‚åˆå› ç‚ºæµ·é™¸åˆ†ä½ˆçš„å½±éŸ¿ï¼Œé«˜å£“å¸¶åˆ†è£‚æˆè‹¥å¹²é«˜å£“å–®é«”ã€‚</p><p>èªªåˆ°å‰¯ç†±å¸¶é«˜å£“ï¼Œæœ‰ä¸€å€‹æ¦‚å¿µä¸å¾—ä¸æâ”€â”€é‚£å°±æ˜¯588ç·šã€‚å¯¦éš›é å ±æ¥­å‹™ä¸­è¡¨å¾µå‰¯é«˜æ´»å‹•çš„æ–¹æ³•ä¸»è¦æœ‰å…©ç¨®ï¼Œä¸€ç¨®æ˜¯å‰¯é«˜çš„è„Šç·šï¼ˆå‰¯é«˜å…§éƒ¨æ±è¥¿é¢¨çš„åˆ†ç•Œç·šï¼‰ï¼Œè€Œ500hPaç­‰å£“é¢ä¸Š588ä½å‹¢ä»€ç±³é€™æ¢ç­‰é«˜ç·šå»æ˜¯é å ±å“¡æœ€å¸¸ç”¨ã€æœ€é—œæ³¨çš„ä¸€æ¢ç·šï¼Œå› ç‚ºå®ƒé›–ç„¶çœ‹ä¸è¦‹ã€æ‘¸ä¸è‘—ï¼Œå»èƒ½è¡¨å¾µå‰¯é«˜çš„å¼·åº¦å’Œä½ç½®è®ŠåŒ–ï¼Œå°æˆ‘åœ‹çš„å¤©æ°£å½±éŸ¿å·¨å¤§ã€‚</p><p>588ç·šæ˜¯é å ±å“¡åœ¨é«˜ç©º500ç™¾å¸•ç­‰å£“é¢ä¸Šï¼ˆç´„5500å…¬å°ºé«˜ç©ºï¼‰ç¹ªè£½çš„ä¸€æ¢ç­‰ä½å‹¢é«˜åº¦ç·šã€‚é€™æ¢ç­‰å€¼ç·šåœèµ·ä¾†çš„å€åŸŸå°±æ˜¯é å ±å“¡å¸¸å¸¸æåˆ°çš„æ°£è±¡åè©ã€Œå‰¯ç†±å¸¶é«˜å£“ã€ã€‚å®ƒå‘è¥¿å‘åŒ—æ“´å±•ï¼Œä»£è¡¨å‰¯é«˜å‘è¥¿å‘åŒ—æ¨ç§»ï¼Œå®ƒåŒ…å«çš„ç¯„åœæ“´å¤§æ™‚ï¼Œè¡¨ç¤ºå‰¯é«˜å¼·åº¦å¢å¼·ç­‰ç­‰ã€‚</p><h2 id="å‰¯é«˜è„Šç·šæ§åˆ¶">å‰¯é«˜è„Šç·šæ§åˆ¶</h2><p>åœ¨å‰¯é«˜è„Šç·šæ§åˆ¶çš„åœ°å€ï¼Œå¾€å¾€ä»¥æ™´æœ—å°‘é›²çš„é«˜æº«å¤©æ°£ç‚ºä¸»ï¼Œå¦‚æœå‰¯é«˜å¼·ç››ï¼Œå‰‡è©²åœ°å€é‚„æœƒå‡ºç¾ä¹¾æ—±ç½å®³ã€‚</p><ul><li>å‰¯é«˜è„Šç·šçš„åŒ—å´èˆ‡è¥¿é¢¨å¸¶é‹’å€ç›¸é„°ï¼Œè¥¿é¢¨å¸¶ç³»çµ±æ”œå¸¶çš„å†·ç©ºæ°£ï¼Œèˆ‡å‰¯é«˜å¤–åœå¼•å°è¼¸é€çš„æ°´æ±½åŒ¯åˆï¼Œå®¹æ˜“ç”¢ç”Ÿæ°£æ—‹å’Œé‹’é¢æ´»å‹•ï¼Œå¾è€Œå½¢æˆå¼·é™æ°´ã€‚</li><li>å‰¯é«˜è„Šç·šå—å´ç‚ºæ±é¢¨æ°£æµï¼Œæ²’æœ‰æ°£æ—‹ç™¼å±•æ™‚ï¼Œå¤©æ°£æ™´å¥½ï¼Œä½†ç•¶æœ‰æ±é¢¨æ³¢å’Œé¢±é¢¨ç­‰ç†±å¸¶å¤©æ°£ç³»çµ±æ´»å‹•æ™‚ï¼Œå‰‡æœƒå‡ºç¾é›·æš´å¤§é¢¨ã€å¼·é™æ°´ç­‰æƒ¡åŠ£å¤©æ°£ã€‚</li></ul><figure><img src="https://i.imgur.com/WA9G4fo.png" alt="å‰¯é«˜è„Šç·šçš„å—åŒ—å´" /><figcaption>å‰¯é«˜è„Šç·šçš„å—åŒ—å´</figcaption></figure><figure><img src="https://i.imgur.com/qso2WKa.png" alt="å‰¯é«˜è„Šç·š" /><figcaption>å‰¯é«˜è„Šç·š</figcaption></figure><ul><li><a href="https://www.hko.gov.hk/tc/whatsnew/d4_whatsnew_20160701.htm">é¦™æ¸¯å¤©æ–‡å° |ã€æ°£è±¡å†·çŸ¥è­˜ã€ï¼šå‰¯ç†±å¸¶é«˜å£“è„Š</a></li><li><a href="https://www.cwa.gov.tw/V8/C/C/Taiwan/taiwan_5_3.html">ä¸­è¯æ°‘åœ‹äº¤é€šéƒ¨ä¸­å¤®æ°£è±¡ç½² | å¤ªå¹³æ´‹é«˜å£“</a><ul><li>æ¯”è¼ƒè¿‘å¹¾åå¹´å¤ªå¹³æ´‹é«˜å£“æ–¼å¤å­£(6æœˆè‡³8æœˆ)çš„å¼·åº¦è®ŠåŒ–(å¦‚åœ–)ï¼Œå¯ç™¼ç¾æ—©æœŸåœ¨1950è‡³1970å¹´ä»£æœ€è¥¿åªåˆ°é”æ±ç¶“135åº¦å·¦å³ï¼Œä½†è¿‘å¹´ä¾†å¤ªå¹³æ´‹é«˜å£“æœ‰è¶Šä¾†è¶Šå¾€è¥¿å»¶ä¼¸çš„è¶¨å‹¢ï¼Œè¥¿ä¼¸çš„ä½ç½®å·²è¦†è“‹è‡³è‡ºç£ä¸Šç©ºï¼Œè¿‘10å¹´è¥¿ä¼¸ä½ç½®ç”šè‡³æ¥è¿‘ä¸­åœ‹è¯å—ï¼Œå‰¯é«˜å¼·åº¦å¢å¼·ä½¿å¾—è¿‘å¹´ä¾†å¤å­£å¹³å‡æº«åº¦åé«˜ï¼Œæ¥µç«¯é«˜æº«æ—¥æ•¸ä¹Ÿæœ‰åå¤šçš„è¶¨å‹¢ã€‚</li></ul></li></ul><figure><img src="https://www.cwa.gov.tw/V8/C/K/Encyclopedia/climate/imgs/pacific_5_3_2.png" alt="å¤å­£500ç™¾å¸•é‡åŠ›ä½é«˜åº¦å ´5870ç·šçš„å¹³å‡ä½ç½®(ä»£è¡¨å¤ªå¹³æ´‹é«˜å£“å‹¢åŠ›ç¯„åœ)ï¼Œä¸åŒçš„æ•¸å­—ä»£è¡¨ä¸åŒçš„å¹´ä»£(10å¹´)å¹³å‡" /><figcaption>å¤å­£500ç™¾å¸•é‡åŠ›ä½é«˜åº¦å ´5870ç·šçš„å¹³å‡ä½ç½®(ä»£è¡¨å¤ªå¹³æ´‹é«˜å£“å‹¢åŠ›ç¯„åœ)ï¼Œä¸åŒçš„æ•¸å­—ä»£è¡¨ä¸åŒçš„å¹´ä»£(10å¹´)å¹³å‡</figcaption></figure><h1 id="é¢±é¢¨-ç†±å¸¶æ°£æ—‹-å‰¯ç†±å¸¶é«˜å£“">é¢±é¢¨ ç†±å¸¶æ°£æ—‹ å‰¯ç†±å¸¶é«˜å£“</h1><p>å‰¯é«˜ä¹Ÿæ˜¯å¼•å°ç†±å¸¶æ°£æ—‹ç§»å‹•çš„ä¸»è¦å¤©æ°£ç³»çµ±ä¹‹ä¸€</p><ul><li><a href="https://www.hko.gov.hk/tc/%E5%A4%A9%E6%96%87%E5%8F%B0%E7%B6%B2%E8%AA%8C/106962/%E5%90%91%E6%9D%B1%E8%B5%B0%E7%9A%84%E3%80%8C%E7%9B%A7%E7%A2%A7%E3%80%8D">é¦™æ¸¯å¤©æ–‡å° | 2022å¹´5æœˆ11æ—¥ å‘æ±èµ°çš„ã€Œç›§ç¢§ã€</a></li></ul><h1 id="ä¸­åœ‹é™æ°´å¸¶çš„å—åŒ—ç§»å‹•èˆ‡å‰¯é«˜çš„å­£ç¯€æ´»å‹•å¯†åˆ‡ç›¸é—œ">ä¸­åœ‹é™æ°´å¸¶çš„å—åŒ—ç§»å‹•èˆ‡å‰¯é«˜çš„å­£ç¯€æ´»å‹•å¯†åˆ‡ç›¸é—œ</h1><p>ä¸­åœ‹é™æ°´å¸¶çš„å—åŒ—ç§»å‹•èˆ‡å‰¯é«˜çš„å­£ç¯€æ´»å‹•å¯†åˆ‡ç›¸é—œï¼šå¾æ¯å¹´3ã€4æœˆä»½é–‹å§‹ï¼Œæˆ‘åœ‹é™¸çºŒå‡ºç¾è¯å—å‰æ±›æœŸï¼ˆ4æœˆè‡³6æœˆï¼‰ã€æ±Ÿå—-é•·æ±Ÿä¸­ä¸‹æ¸¸-æ±Ÿæ·®æ¢…é›¨å­£ç¯€ï¼ˆ6æœˆè‡³7æœˆï¼‰ã€è¯åŒ—æ±åŒ—é›¨å­£ï¼ˆ7æœˆè‡³8æœˆï¼‰ç­‰</p><p>å¿™ç¢Œäº†æ•´å€‹å¤å­£å¾Œï¼Œå‰¯é«˜é€šå¸¸æœƒåœ¨9æœˆå•Ÿç¨‹å›åˆ°è¥¿åŒ—å¤ªå¹³æ´‹é¤Šç²¾è“„éŠ³ï¼Œç­‰å¾…ä¾†å¹´å†ã€Œè¡æ¥­ç¸¾ã€ã€‚ä½†é€€å ´æ™‚ï¼Œå‰¯é«˜é‚„æœƒåœ¨å—æ–¹åœ°å€åœç•™ï¼Œå¸¶ä¾†ã€Œç§‹è€è™ã€é«˜æº«å¤©æ°£ï¼›æ­¤æ™‚å‰¯é«˜ä½ç½®åè¥¿ï¼Œå†·æš–ç©ºæ°£äº¤å½™çš„ä¸»æˆ°å ´è½‰ç§»åˆ°äº†è¯è¥¿åœ°å€ï¼Œæ‹‰é–‹äº†ã€Œè¯è¥¿ç§‹é›¨ã€å¤§å¹•ã€‚</p><p>åœ¨é€™å¹¾å€‹æœˆè£¡ï¼Œå‰¯é«˜è¯æ‰‹å¤å­£é¢¨ç‚ºæˆ‘åœ‹å¤§éƒ¨å¸¶ä¾†è±æ²›çš„é›¨æ°´ã€å……è¶³çš„é™½å…‰å’Œé©å®œçš„æ°£æº«ï¼Œäººå€‘æ‡‰å­£è€Œä½œã€æ‡‰å­£è€Œæ”¶ï¼Œç”¨å‹¤å‹å’Œæ™ºæ…§æ‰“é€ äº†é­šç±³ä¹‹é„‰ã€ä¸­åŸç³§å€‰ã€åŒ—å¤§å€‰â€¦ <img src="https://i.imgur.com/EexaFHc.gif" alt="ä¸­åœ‹é™æ°´å¸¶çš„å—åŒ—ç§»å‹•èˆ‡å‰¯é«˜çš„å­£ç¯€æ´»å‹•å¯†åˆ‡ç›¸é—œ" /></p><figure><img src="https://i.imgur.com/stm6qRa.jpeg" alt="ä¸­åœ‹é™æ°´å¸¶çš„å—åŒ—ç§»å‹•èˆ‡å‰¯é«˜çš„å­£ç¯€æ´»å‹•å¯†åˆ‡ç›¸é—œ" /><figcaption>ä¸­åœ‹é™æ°´å¸¶çš„å—åŒ—ç§»å‹•èˆ‡å‰¯é«˜çš„å­£ç¯€æ´»å‹•å¯†åˆ‡ç›¸é—œ</figcaption></figure><p>æ‰æ‘¸ä¸é€çš„é›¨å¸¶</p><p>å‰¯é«˜è¥¿åŒ—å´ç››è¡Œåå—å’Œè¥¿å—æš–æ¿•æ°£æµï¼Œæ˜¯ä½å±¤æš–æ¿•ç©ºæ°£è¼»åˆä¸Šå‡é‹å‹•å€ï¼Œå®¹æ˜“å‡ºç¾é›·é™£é›¨å¤©æ°£ï¼Œå°¤å…¶åŒ—å´æ˜¯è¥¿é¢¨å¸¶ï¼Œç¶“å¸¸å¸¶ä¾†åŒ—æ–¹è¼ƒå†·çš„ç©ºæ°£ï¼Œèˆ‡æš–ç©ºæ°£çµåˆæ›´å®¹æ˜“å½¢æˆæ¿€çƒˆçš„å¤©æ°£ã€‚</p><p>è¥¿åŒ—å¤ªå¹³æ´‹å‰¯é«˜çš„å¼·å¼±åŠä½ç½®ï¼Œèˆ‡æˆ‘åœ‹ä¸­æ±éƒ¨åœ°å€çš„å¤©æ°£æ°£å€™ä»¥åŠæ—±æ¾‡ç­‰é—œä¿‚æ¥µå…¶å¯†åˆ‡ï¼Œæ±ºå®šäº†æˆ‘åœ‹ä¸­æ±éƒ¨åœ°å€çš„é›¨å¸¶åˆ†ä½ˆã€‚</p><figure><img src="https://i.imgur.com/wdGlty9.jpeg" alt="æ‰æ‘¸ä¸é€çš„é›¨å¸¶" /><figcaption>æ‰æ‘¸ä¸é€çš„é›¨å¸¶</figcaption></figure><h1 id="é…·ç†±-é™é›¨æ¡ˆä¾‹">é…·ç†±, é™é›¨æ¡ˆä¾‹</h1><ul><li><a href="https://www.hko.gov.hk/tc/%E5%A4%A9%E6%B0%A3%E9%9A%A8%E7%AD%86/108835/%E3%80%8C%E7%86%B1%E3%80%8D%E9%AC%A7%E7%9A%84%E5%8D%97%E6%B5%B7">é¦™æ¸¯å¤©æ–‡å° | 2024å¹´7æœˆ11æ—¥ã€Œç†±ã€é¬§çš„å—æµ·</a><ul><li>å—å‰¯ç†±å¸¶é«˜å£“è„Šå½±éŸ¿ï¼Œéå»ä¸€å…©æ˜ŸæœŸæœ¬æ¸¯å¤©æ°£æŒçºŒé…·ç†±ï¼Œå¤©æ–‡å°åœ¨7æœˆ1æ—¥ç™¼å‡ºé…·ç†±å¤©æ°£è­¦å‘Šè‡³ä»Šå·²ç”Ÿæ•ˆè¶…é10æ—¥ã€‚æœ€æ–°é å ±é¡¯ç¤ºï¼Œå‰¯ç†±å¸¶é«˜å£“è„Šå—å´çš„å»£é—Šä½å£“æ§½åœ¨é€±æœ«åŠä¸‹é€±å°‡é€æ¼¸è®Šå¾—æ´»èºï¼Œè€Œä½å£“æ§½ä¸Šäº¦å¯èƒ½æœ‰ä½å£“å€å½¢æˆï¼Œç”šè‡³ç™¼å±•ç‚ºç†±å¸¶æ°£æ—‹ã€‚</li><li>(ä¸Š) è¡›æ˜Ÿåœ–åƒå¯è¦‹å—æµ·ä¸­å—éƒ¨åŠè²å¾‹è³“ä»¥æ±æµ·åŸŸæœ‰å…©çµ„è¼ƒæ˜é¡¯çš„å°æµé›²åœ˜ï¼›</li><li>(ä¸‹) å‰¯ç†±å¸¶é«˜å£“è„Šæœƒåœ¨ä¸‹é€±åˆå‘è¥¿ä¼¸å±•ã€‚</li></ul></li></ul><figure><img src="https://www.hko.gov.hk/tc/forecaster_blog/images/potentail_TC_pic1_v2.png" alt="(ä¸Š) è¡›æ˜Ÿåœ–åƒå¯è¦‹å—æµ·ä¸­å—éƒ¨åŠè²å¾‹è³“ä»¥æ±æµ·åŸŸæœ‰å…©çµ„è¼ƒæ˜é¡¯çš„å°æµé›²åœ˜ï¼› (ä¸‹) å‰¯ç†±å¸¶é«˜å£“è„Šæœƒåœ¨ä¸‹é€±åˆå‘è¥¿ä¼¸å±•ã€‚" /><figcaption>(ä¸Š) è¡›æ˜Ÿåœ–åƒå¯è¦‹å—æµ·ä¸­å—éƒ¨åŠè²å¾‹è³“ä»¥æ±æµ·åŸŸæœ‰å…©çµ„è¼ƒæ˜é¡¯çš„å°æµé›²åœ˜ï¼› (ä¸‹) å‰¯ç†±å¸¶é«˜å£“è„Šæœƒåœ¨ä¸‹é€±åˆå‘è¥¿ä¼¸å±•ã€‚</figcaption></figure><ul><li><a href="https://news.dayoo.com/society/202407/08/140000_54686673.htm">ä¸­å›½å¤©æ°”ç½‘ | 2024-07-08 å‰¯çƒ­å¸¦é«˜å‹ä½ç½®ç§»åŠ¨ï¼Œå…¨å›½å¤©æ°”å°†æœ‰è¿™äº›å˜åŒ–</a><ul><li>ä»Šå¤©ï¼ˆ8æ—¥ï¼‰ï¼Œå†·ã€æš–æ°”æµåœ¨å››å·ç›†åœ°äº¤æ±‡å½¢æˆäº†è¥¿å—æ¶¡ã€åœ¨æ²³å—è‡³è‹çš–åŒ—éƒ¨çš„äº¤æ±‡å½¢æˆäº†åˆ‡å˜çº¿ã€‚å› æ­¤è¿™ä¸€çº¿è¿˜æ˜¯å¼ºé™é›¨é‡å¿ƒï¼Œå¹¶ä¸”å¤šä¼´éšé›·æš´å¤§é£ç­‰å¼ºå¯¹æµå¤©æ°”ã€‚</li></ul></li></ul><figure><img src="https://i.imgur.com/QYigRdk.jpeg" alt="2024-07-08 å¼ºé™é›¨" /><figcaption>2024-07-08 å¼ºé™é›¨</figcaption></figure><figure><img src="https://dayooimg.dayoo.com/Society/202407/08/54686673_bc0b3f49-404f-4fa6-b8b3-f7747104a1ae.gif" alt="2024-07-08 å¼ºé™é›¨ FY-4B" /><figcaption>2024-07-08 å¼ºé™é›¨ FY-4B</figcaption></figure><ul><li><a href="https://news.weather.com.cn/2024/06/3787477.shtml">ä¸­å›½å¤©æ°”ç½‘ | 2024-06-20 â€œæ•™ç§‘ä¹¦â€çº§çš„æ¢…é›¨å½¢åŠ¿å³å°†å‡ºç°ï¼Œæ–°ä¸€è½®æš´é›¨å¤§æš´é›¨æœ€çŒ›çƒˆæ—¶æ®µæ¥äº†</a><ul><li>ä»Šå¹´çš„æ¢…é›¨å¼€åœºå³ä¸åŒå‡¡å“ã€‚æ˜¨å¤©ï¼Œå®‰å¾½èŠœæ¹–ã€é“œé™µã€å®£åŸã€é»„å±±ï¼Œæµ™æ±Ÿæ­å·ã€å˜‰å…´ï¼Œæ±Ÿè¥¿ä¸Šé¥¶ã€å®œæ˜¥ï¼Œæ¹–å—é•¿æ²™ã€å¸¸å¾·ã€æ€€åŒ–ç­‰åœ°å±€åœ°å‡å‡ºç°å¤§æš´é›¨ï¼ˆ100ï½265æ¯«ç±³ï¼‰ã€‚</li><li>ä»Šå¤©å¤œé—´å¼€å§‹ï¼Œéšç€åŒ—æ–¹å†·æ¶¡å¼•å¯¼å†·ç©ºæ°”å—ä¸‹ä¸æš–æ¹¿æ°”æµç»“åˆï¼ŒåŒæ—¶å‰¯çƒ­å¸¦é«˜å‹è¥¿ä¼¸åŒ—æŠ¬ï¼Œä½å±‚æ€¥æµåŠ å¼ºå‚¬ç”Ÿå‡ºä½æ¶¡å¹¶ä¸œç§»ï¼Œå°†åœ¨è´µå·è‡³æ±Ÿæ±‰æ±Ÿæ·®ä¸€å¸¦æ¿€å‘å‡ºä¸€æ¡å‘ˆä¸œåŒ—-è¥¿å—èµ°å‘çš„çŒ›çƒˆæš´é›¨å¤§æš´é›¨åŒºåŸŸã€‚</li><li>è¿™å°±æ˜¯æœ€å…¸å‹çš„æ¢…é›¨å½¢åŠ¿ï¼Œæ¥ä¸‹æ¥å‡ å¤©çš„æƒ…å†µè·Ÿå®ƒé«˜åº¦è´´åˆï¼Œä¸è¿‡å‰¯é«˜ä½ç½®æ›´ååŒ—ï¼Œå¼ºé™é›¨é›†ä¸­åŒºåŸŸä¹Ÿæ›´ä¸ºé›†ä¸­åœ¨æ±Ÿæ·®ã€æ±Ÿæ±‰ä¸€å¸¦ã€‚</li></ul></li></ul><figure><img src="https://i.imgur.com/rTf08YT.jpeg" alt="2024-06-20 å…¸å‹çš„æ¢…é›¨å½¢åŠ¿" /><figcaption>2024-06-20 å…¸å‹çš„æ¢…é›¨å½¢åŠ¿</figcaption></figure><h1 id="æ²™æ¼ -å’Œç«çˆ">æ²™æ¼  å’Œã€Œç«çˆã€</h1><p>ç†±å¸¶æ²™æ¼ æ°£å€™ï¼šå‰¯ç†±å¸¶é«˜å£“å¸¸å¹´æ§åˆ¶æ­¤åœ°å€ï¼Œæ•…å…¶æ°£å€™çµ‚å¹´é«˜æº«ä¹¾ç‡¥ã€‚</p><p>æ¯å¹´å¹³å‡é™é›¨é‡ä½æ–¼å…©ç™¾äº”åå…¬é‡çš„åœ°å€å°±ç¨±ç‚ºæ²™æ¼ ï¼Œåœ¨æ²™æ¼ è£¡æœ€ç¼ºä¹é£Ÿç‰©å’Œæ°´ã€‚å¤§éƒ¨åˆ†çš„æ²™æ¼ åˆ†ä½ˆå†å—åŒ—éŸ“åäº”åº¦åˆ°ä¸‰åäº”åº¦é–“ï¼Œåœ¨é€™ç·¯åº¦é–“ç‚ºã€å‰¯ç†±å¸¶é«˜å£“å¸¶ã€ï¼Œç”±èµ¤é“ä¸Šå‡å‘å—åŒ—æµå‹•çš„ç©ºæ°£åœ¨ç·¯åº¦ä¸‰ååº¦å·¦å³ä¸‹é™ï¼Œæ„ˆé™æ„ˆè½‰æš–ï¼Œä¸‹é™çš„æš–ç©ºæ°£å¸æ”¶æ¿•æ°£ï¼Œä½¿åœ°é¢ä¹¾ç‡¥ï¼Œæ™´æœ—ç„¡é›²åŠ ä¸Šç‚é™½é«˜ç…§ï¼Œé€™ä¸€å¸¶å…§çš„èƒŒé¢¨åœ°å€ä¾¿æˆç‚ºæ²™æ¼ ã€‚</p><figure><img src="https://i.imgur.com/YsjNaIl.jpeg" alt="æˆ‘åœ‹çš„å¹¾å¤§æ²™æ¼ å’Œå¤å­£å‚³çµ±çš„å››å¤§ã€Œç«çˆã€åœ–ç‰‡ä¾†æºï¼šä¸­åœ‹åœ‹å®¶åœ°ç†" /><figcaption>æˆ‘åœ‹çš„å¹¾å¤§æ²™æ¼ å’Œå¤å­£å‚³çµ±çš„å››å¤§ã€Œç«çˆã€åœ–ç‰‡ä¾†æºï¼šä¸­åœ‹åœ‹å®¶åœ°ç†</figcaption></figure><figure><img src="https://www.chiding.com.tw/upload/users/image/%E7%86%B1%E5%B8%B6%E3%80%81%E6%BA%AB%E5%B8%B6%E6%B2%99%E6%BC%A0%E5%88%86%E5%B8%83%E5%9C%96.jpg" alt="ç†±å¸¶æ²™æ¼ è·Ÿæº«å¸¶æ²™æ¼ å·®åœ¨å“ªè£¡å‘¢ï¼Ÿ åœ–ç‰‡ä¾†æºï¼šå¥‡é¼äº‹æ¥­" /><figcaption>ç†±å¸¶æ²™æ¼ è·Ÿæº«å¸¶æ²™æ¼ å·®åœ¨å“ªè£¡å‘¢ï¼Ÿ åœ–ç‰‡ä¾†æºï¼šå¥‡é¼äº‹æ¥­</figcaption></figure><h1 id="references">References</h1><ol type="1"><li><a href="http://tsw.hhups.tp.edu.tw/jyfen/ecology/209.htm">ä»™äººæŒçš„å®¶--æ²™æ¼ </a></li></ol>]]></content>
    
    
    <categories>
      
      <category>Meteorology</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Google Map</title>
    <link href="/2024/10/02/google-map/"/>
    <url>/2024/10/02/google-map/</url>
    
    <content type="html"><![CDATA[<h1 id="embed-google-maps">Embed Google Maps</h1><p>Easily embed and customize Google Maps on your web page or blog by setting the Google.</p><p>To use the Maps Embed API on your web page, set the URL you've built as the value of an iframe's src attribute. Control the map's size with the iframe's height and width attributes, for example:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">iframe</span></span><br><span class="hljs-tag">  <span class="hljs-attr">width</span>=<span class="hljs-string">&quot;640&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">height</span>=<span class="hljs-string">&quot;480&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">frameborder</span>=<span class="hljs-string">&quot;0&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;border:0&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">referrerpolicy</span>=<span class="hljs-string">&quot;no-referrer-when-downgrade&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://www.google.com/maps/d/embed?mid=1Dmw1V2OwTV5C7KWjAhHR5bEZugqMnCA&amp;ehbc=2E312F&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">allowfullscreen</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">iframe</span>&gt;</span><br></code></pre></td></tr></table></figure><iframe width="640" height="480" frameborder="0" style="border:0" referrerpolicy="no-referrer-when-downgrade" src="https://www.google.com/maps/d/embed?mid=1Dmw1V2OwTV5C7KWjAhHR5bEZugqMnCA&amp;ehbc=2E312F" allowfullscreen></iframe><h1 id="references">References</h1><ol type="1"><li><a href="https://developers.google.com/maps/documentation/embed/embedding-map">Embedding Map</a></li><li><a href="https://www.tsg.com.tw/blog-detail2-173-0-google-maps.htm">Google Mapå¦‚ä½•åµŒå…¥ç¶²é ï¼Ÿåœ°åœ–ã€è·¯ç·šåœ°åœ–åµŒå…¥æ•™å­¸ï½œå¤©çŸ½ç§‘æŠ€å®¢è£½åŒ–ç¶²é è¨­è¨ˆ</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>NWP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NWP</tag>
      
      <tag>WRF</tag>
      
      <tag>MPAS</tag>
      
      <tag>Google</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>WMO Information System 2.0 (WIS 2.0)</title>
    <link href="/2024/10/02/WISv2-WMO/"/>
    <url>/2024/10/02/WISv2-WMO/</url>
    
    <content type="html"><![CDATA[<h1 id="wis-2.0---world-meteorological-organization-wmo">WIS 2.0 - World Meteorological Organization WMO</h1><ul><li><a href="https://community.wmo.int/en/activity-areas/wis/WIS2-overview">WMO | WIS2 Overview</a> (<strong>Recommendation</strong>)</li><li><a href="https://community.wmo.int/en/activity-areas/wis">WMO | WMO Information System (WIS) v2</a></li><li><a href="https://community.wmo.int/en/activity-areas/wis/wis2-implementation">WMO | wis2 implementation</a></li><li><a href="https://community.wmo.int/en/activity-areas/wis/wis2-demonstration-projects">WMO | WIS 2.0 Demonstration Projects</a></li><li><a href="https://www.wis-jma.go.jp/cms/gisc_tokyo/workshop/file/2023/JMA-WS2023_Item04_WIS2.0-Architecture-and-Global-Services.pdf">Japan | Introduction to WIS2 (JMA WIS â€“ Workshop 11.2023)</a> (<strong>Recommendation</strong>)</li><li><a href="https://www.ecmwf.int/en/newsletter/176/computing/wis-20-wmo-data-sharing-21st-century">ECMWF | WIS 2.0: WMO data sharing in the 21st century</a><ul><li><a href="https://www.ecmwf.int/sites/default/files/elibrary/072023/81382-wis-2-0-wmo-data-sharing-in-the-21st-century.pdf">pdf</a></li></ul></li><li><a href="https://www.cma.gov.cn/en/research/news/202305/t20230529_5537194.html">CMA | Congress acclaims WMO Information System as basis for data sharing</a></li></ul><figure><img src="https://community.wmo.int/sites/default/files/inline-images/WIS2_diagram.png" alt="WIS2 Global Services" /><figcaption>WIS2 Global Services</figcaption></figure><p>The WMO Information System 2.0 (WIS 2.0) is the framework for WMO data sharing in the 21st century for all WMO domains and disciplines. It supports the WMO Unified Data policy, the Global Basic Observing Network (GBON) and makes international, regional, and national data sharing simple, effective, and inexpensive. The idea that no Member should be left behind and the objective of lowering the barrier to adoption has been at the core of WIS 2.0 development. These objectives inspire the principles underpinning the WIS 2.0 technical framework, such as adopting open standards and Web technologies to facilitate sharing of increasing variety and volume of real-time data.</p><figure><img src="https://www.ecmwf.int/sites/default/files/styles/wide/public/2023-07/NL176_Giraud_C1-Figure-1.jpg?itok=wCpKEBKG" alt="In the WIS 2.0 Pilot phase, a number of Centres are operating one service. This map shows the situation in May 2023. (Image source: ECMWF)" /><figcaption>In the WIS 2.0 Pilot phase, a number of Centres are operating one service. This map shows the situation in May 2023. (Image source: ECMWF)</figcaption></figure><ul><li>WMO Information System 2.0(WIS 2.0), which is the framework for Earth Systems (meteorological, hydrological, climate and ocean) data sharing in the 21st century. It is based on the principle that no Member should be left behind.</li><li>The <strong>WIS 2.0 pilot phase started in the December 2022 and is scheduled for completion by the end of 2023.</strong> WIS 2.0 supports theWMO Unified Data policy, theGlobal Basic Observing Network (GBON)and makes international, regional, and national data sharing simple, effective, and inexpensive.</li><li>Training and capacity-building workshops are accompanying the rollout of WIS 2.0. Its new data-sharing infrastructure will <strong>gradually replace the Global Telecommunication System (GTS)</strong>.</li><li>The users of WIS 2.0 will be able to access data in real-time by subscribing to a Global Broker and receiving notifications when new data are available for download from a Global Cache or from the data provider. They will also be able to access data directly through Web APIs (application programming interfaces), connecting their software (or their browser) and processing or visualising data of their interest.</li><li>WMO has developed the <strong>open-source software â€œWIS2 in a boxâ€</strong> to support Least Developed Countries and Small Island Developing States in implementing WIS 2.0.</li></ul><h1 id="wis-2.0-in-a-box">WIS 2.0 in a box</h1><p><a href="https://community.wmo.int/en/wis2box">WMO | WMO INFORMATION SYSTEM (WIS) 2.0 IN A BOX</a></p><p>The WIS2-in-a-box project was started in November 2021 to provide a system to share data using the WIS2 framework.</p><p>The WIS2box-software is implemented such as to offer the flexibility of being deployed both on private/public cloud or on-premises systems. The main features are:</p><ul><li>based on existing open-source software widely used in the operations of some WMO Members.</li><li>allows Members to share data internationally and nationally using message queuing protocols (MQP) and Web services in compliance with WIS2 technical regulations</li><li>provides Web APIs complying with Open Geospatial Consortium (OGC) standards, making access to data extremely easy from all common languages (Python, R, ...) and many open-source and proprietary programs (Excel).</li></ul><p>Demonstration instances of WIS2-in-a-box can be viewed at <a href="https://demo.wis2box.wis.wmo.int" class="uri">https://demo.wis2box.wis.wmo.int</a>.</p><h2 id="hosting-your-own-wis2-in-a-box">Hosting your own WIS2-in-a-box</h2><ul><li>The WIS2-in-box user guide, detailing how to setup your own WIS2 box, is available here: <a href="https://docs.wis2box.wis.wmo.int" class="uri">https://docs.wis2box.wis.wmo.int</a></li></ul><h2 id="example">Example</h2><p>WIS2 in a box is a reference implementation of a WMO WIS2 Node</p><ul><li>Many countries<ul><li><a href="https://demo.wis2box.wis.wmo.int/" class="uri">https://demo.wis2box.wis.wmo.int/</a></li></ul></li><li>CMA<ul><li><a href="https://wis2node.wis.cma.cn/" class="uri">https://wis2node.wis.cma.cn/</a></li></ul></li><li>Republic of Korea<ul><li><a href="https://wis2box.kma.go.kr/" class="uri">https://wis2box.kma.go.kr/</a></li></ul></li><li>Poland<ul><li><a href="https://wis2-pilot.imgw.pl/" class="uri">https://wis2-pilot.imgw.pl/</a></li></ul></li></ul><h1 id="hko-cma-wis-2.0">HKO-CMA-WIS 2.0</h1><ul><li><a href="https://www.hko.gov.hk/en/education/weather/data-and-technology/00704-Meteorological-information-sharing-in-the-21st-century.html">HKO | Meteorological Information Sharing in the 21st Century (December 2023)</a></li></ul><p>The Hong Kong Observatory (HKO) has recently <strong>set up a WIS 2.0 system on a public cloud and interfaced</strong> with the WIS 2.0 system operated by the China Meteorological Administration (CMA). Collaboration and partnership with CMA to develop and implement WIS 2.0 was underway.</p><ul><li>A conceptual diagram of information publish and subscribe under the framework of WIS 2.0.</li></ul><figure><img src="https://www.hko.gov.hk/en/education/weather/data-and-technology/images/703_fig1_data_exchange_e.png" alt="A conceptual diagram of information publish and subscribe under the framework of WIS 2.0" /><figcaption>A conceptual diagram of information publish and subscribe under the framework of WIS 2.0</figcaption></figure><figure><img src="https://www.hko.gov.hk/tc/education/weather/data-and-technology/images/703_fig1_data_exchange_c.png" alt="WIS 2.0æ¡†æ¶ä¸‹ä¿¡æ¯ç™¼å¸ƒå’Œè¨‚é–±æ¦‚å¿µåœ–" /><figcaption>WIS 2.0æ¡†æ¶ä¸‹ä¿¡æ¯ç™¼å¸ƒå’Œè¨‚é–±æ¦‚å¿µåœ–</figcaption></figure><h1 id="building-the-wis-2.0-global-weather-cache-on-aws">Building the WIS 2.0 global weather cache on AWS</h1><ul><li><a href="https://aws.amazon.com/blogs/publicsector/building-the-wis-2-0-global-weather-cache-on-aws/">Building the WIS 2.0 global weather cache on AWS</a></li></ul><p>The World Meteorological Organization (WMO) wants to build and modernize a global weather framework with WMO Information Systems (WIS) 2.0 to enable and democratize unified access to critical, up-to-date weather data across the world. Currently, lack of observations, easy access to data, computing power, human and capital resources, capacity, and budget hinders accurate and timely forecasts</p><figure><img src="https://d2908q01vomqb2.cloudfront.net/9e6a55b6b4563e652a23be9d623ca5055c356940/2024/06/24/wis2.0_header.png" alt="Building the WIS 2.0 global weather cache on AWS" /><figcaption>Building the WIS 2.0 global weather cache on AWS</figcaption></figure><p>WIS 2.0 data viewed in the WIS 2.0 in a box application. The map below shows US weather data observation locations in a map along with an observation locationâ€™s weather data.</p><figure><img src="https://d2908q01vomqb2.cloudfront.net/9e6a55b6b4563e652a23be9d623ca5055c356940/2024/06/24/wis2.0_figure2.png" alt="The map shows US weather data observation locations in a map along with an observation locationâ€™s weather data" /><figcaption>The map shows US weather data observation locations in a map along with an observation locationâ€™s weather data</figcaption></figure><h1 id="referecnes">Referecnes</h1><ol type="1"><li><a href="http://gisc.wis.cma.cn/wis/portal.pub?LA=en_US">For WIS.v1 CMA-WIS portal (Beijing Global Information System Center)</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>NWP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NWP</tag>
      
      <tag>WRF</tag>
      
      <tag>MPAS</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Pseudo-Global Warming (PGW) - Future Projection</title>
    <link href="/2024/09/30/PGW/"/>
    <url>/2024/09/30/PGW/</url>
    
    <content type="html"><![CDATA[<h1 id="pseudo-global-warming-pgw">Pseudo-Global Warming (PGW)</h1><h2 id="definition-and-concept">Definition and Concept</h2><p>Pseudo-Global Warming (PGW) is a regional climate modeling approach that involves imposing large-scale climate changes derived from global climate models (GCMs) onto a control regional climate simulation. This method contrasts with traditional dynamic downscaling, where regional models are driven directly by GCM outputs. Instead, PGW modifies the boundary conditions of a historical simulation to reflect projected future changes, allowing for a more flexible and computationally efficient analysis of climate impacts.</p><figure><img src="https://i.imgur.com/1PLI5DB.png" alt="Shared Socioeconomic Pathways (SSPs) are climate change scenarios of projected socioeconomic global changes up to 2100 as defined in the IPCC." /><figcaption>Shared Socioeconomic Pathways (SSPs) are climate change scenarios of projected socioeconomic global changes up to 2100 as defined in the IPCC.</figcaption></figure><p>To perform future projections using the <strong>Pseudo-Global Warming (PGW)</strong> approach, follow these key steps:</p><h2 id="methodology-for-pgw-projections">Methodology for PGW Projections</h2><h3 id="understanding-pgw-concept"><strong>1. Understanding PGW Concept</strong></h3><p>The PGW method involves modifying historical climate simulations by imposing future climate changes directly onto them. This is achieved by adjusting the boundary conditions of a control simulation based on projected changes derived from global climate models (GCMs).</p><h3 id="mathematical-representation"><strong>2. Mathematical Representation</strong></h3><p>The PGW approach can be mathematically expressed as:</p><p><span class="math display">\[\text{PGW} = \text{HIST} + \Delta\]</span></p><p>where:</p><ul><li><strong>HIST</strong> represents the current or historical climate conditions.</li><li><strong>Î”</strong> (Delta) is the perturbation derived from future climate projections,</li></ul><p>calculated as:</p><p><span class="math display">\[\Delta = \text{SCEN} - \text{CTRL}\]</span></p><p>Here, <strong>SCEN</strong> is a future climate scenario, and <strong>CTRL</strong> is the corresponding historical baseline.</p><div class="note note-warning">            <p>Both SCEN and HIST periods must be chosen to be long enough to reduce the effects of internal variability (average of âˆ¼ 30 years).</p>          </div><figure><img src="https://eurec4a.eu/fileadmin/user_upload/eurec4a/Simulations/PGW.jpg" alt="Schematics of the principles of the Pseudo Global Warming (PGW) framework (image from EUREC4A)" /><figcaption>Schematics of the principles of the Pseudo Global Warming (PGW) framework (image from EUREC4A)</figcaption></figure><ul><li>Chow, T. N., Tam, C. Y., Chen, J., &amp; Hu, C. (2024). Effects of Background Synoptic Environment in Controlling South China Sea Tropical Cyclone Intensity and Size Changes in Pseudoâ€“Global Warming Experiments. <a href="https://journals.ametsoc.org/view/journals/clim/37/5/JCLI-D-23-0503.1.xml">Journal of Climate, 37(5), 1811-1832.</a></li><li>Zhao, R., Tam, C. Y., Lee, S. M., &amp; Chen, J. (2024). Attributing extreme precipitation characteristics in South China Pearl River Delta region to anthropogenic influences based on pseudo global warming. <a href="https://agupubs.onlinelibrary.wiley.com/doi/10.1029/2023EA003266">Earth and Space Science, 11(3), e2023EA003266.</a><ul><li>In the second PGW experiment, humanâ€induced perturbations are computed as the monthly averages of the <strong>30â€year (1986â€“2005)</strong> mean differences between historical and historicalNat runs of CMIP5 sevenâ€model ensemblemean.</li><li>The perturbed fields include <strong>SST, air temperature, specific humidity, and horizontal wind components</strong>.</li></ul></li><li>Brogli, R., Heim, C., Mensch, J., SÃ¸rland, S. L., &amp; SchÃ¤r, C. (2023). The pseudo-global-warming (PGW) approach: methodology, software package PGW4ERA5 v1. 1, validation, and sensitivity analyses. <a href="https://gmd.copernicus.org/articles/16/907/2023/">Geoscientific Model Development, 16(3), 907-926.</a><ul><li>Both SCEN and HIST periods must be chosen to be long enough to reduce the effects of internal variability (average of âˆ¼â€‰30 years).</li><li>After applying Î” to the thermodynamic variables, it is thus essential to restore this balance using an adequate pressure adjustment</li></ul></li><li><a href="https://eurec4a.eu/eurec4a-multi-day-model-intercomparison-project/methodology">Pseudo Global Warming: Methodology</a><ul><li>The perturbation fields Delta are meant to be based on 30-year monthly means of the driving GCM. The required GCM fields include three-dimensional fields of temperature, specific humidity and wind (T, qv, u, v), as well as the geopotential height field (phi) on at least one pressure level. Monthly mean changes of these fields are linearly interpolated to the target date, and then merged with ERA5 information.</li></ul></li></ul><h3 id="data-requirements"><strong>3. Data Requirements</strong></h3><p>To implement PGW, you need:</p><ul><li>Historical climate data (e.g., from reanalysis datasets like ERA5).</li><li>Future climate projections from GCMs, typically focusing on thermodynamic and dynamic variables such as temperature, humidity, wind, and geopotential height.</li></ul><h3 id="simulation-setup"><strong>4. Simulation Setup</strong></h3><ul><li><strong>Select a GCM</strong>: Choose a transient GCM that provides future climate scenarios relevant to your region of interest.</li><li><strong>Derive Î”</strong>: Compute the perturbations (Î”) based on 30-year monthly means from the GCM outputs.</li><li><strong>Modify Boundary Conditions</strong>: Apply Î” to the historical data to create new boundary conditions for your regional climate model (RCM) simulations.</li></ul><h3 id="running-simulations"><strong>5. Running Simulations</strong></h3><ul><li>Execute the RCM with the modified boundary conditions. The PGW approach allows for shorter simulation periods (less than 30 years), which can be beneficial for high-resolution climate projections.</li><li>Ensure that interannual variability is not included in these projections since PGW assumes a consistent seasonal cycle.</li></ul><h3 id="analyzing-results"><strong>6. Analyzing Results</strong></h3><p>After running the simulations:</p><ul><li>Assess changes in key climate variables such as temperature, precipitation, and extreme weather events.</li><li>Compare results with traditional dynamic downscaling methods to validate the PGW approach's effectiveness in capturing plausible future scenarios.</li></ul><h2 id="advantages-of-pgw">Advantages of PGW</h2><ul><li><strong>Computational Efficiency</strong>: PGW requires less computational power compared to traditional methods, making it suitable for high-resolution studies.</li><li><strong>Flexibility</strong>: It allows researchers to easily modify simulation parameters and assess various future scenarios.</li></ul><h2 id="challenges-and-considerations">Challenges and Considerations</h2><p>Despite its advantages, implementing PGW poses challenges:</p><ul><li><strong>Complexity of Implementation</strong>: Care must be taken to ensure that modifications do not compromise the physical realism of the regional model. Adjustments to pressure and geopotential fields are critical for maintaining consistency between thermodynamic and dynamic changes.</li><li><strong>Interannual Variability</strong>: The PGW method typically does not account for changes in interannual variability, which can limit its applicability in certain contexts.</li><li><strong>Sensitivity to Initial Conditions</strong>: The effectiveness of PGW simulations can be sensitive to the choice of initial conditions and boundary settings, necessitating careful calibration.</li></ul><p>By following this structured methodology, researchers can effectively utilize the PGW approach to project future climate conditions while addressing specific regional impacts of global warming.</p><h1 id="example">Example</h1><h2 id="zhao-francis-tam-prd">2024 | Zhao &amp; Francis Tam | PRD</h2><ul><li><a href="https://agupubs.onlinelibrary.wiley.com/doi/10.1029/2023EA003266">Zhao, R., Tam, C. Y., Lee, S. M., &amp; Chen, J. (2024). Attributing extreme precipitation characteristics in South China Pearl River Delta region to anthropogenic influences based on pseudo global warming. Earth and Space Science, 11(3), e2023EA003266.</a></li></ul><p>Experiment Setup,</p><ul><li><strong>WRF model v3.8.1</strong> (Skamarock et al., 2008) in a one-way nesting setup</li><li><strong>50 km Ã— 50 km, covering most of southeast Asia, 10 km Ã— 10 km (136 Ã— 116 grid cells) and 2 km Ã— 2 km</strong> (181 Ã— 166 grid cells), respectively. There are 45 vertical layers from the surface up to 50 hPa, with 18 layers in the lowest 1.5 km, to resolve the planetary boundary layer (PBL) dynamics.</li><li><strong>Spectral nudging</strong> is applied to <strong>zonal and meridional wind components above 500 hPa over the outermost domain</strong> (Liu et al., 2012; Ma et al., 2016), at the <strong>scale of about 1,300 km (1,500 km)</strong> in the zonal (meridional) direction.</li><li>2 Experiments<ul><li>In the <strong>first set of experiments</strong>, or the control (CTL) run, the initial and boundary conditions (IBCs) are taken from ERA-Interim reanalysis</li><li>in the second set of experiments (denoted as the NAT run), the model is forced by the counterfactual IBCs with human-induced climatic perturbations being absent, following the pseudo global warming (PGW) method</li><li>In the <strong>second PGW experiment</strong>, human-induced perturbations are computed as the <strong>monthly averages of the 30-year (1986â€“2005) mean differences between historical and historicalNat runs of CMIP5 seven-model ensemble mean</strong>.</li><li>The perturbed fields include <strong>SST, air temperature, specific humidity, and horizontal wind components</strong> (Figure S4 in Supporting Information S1).</li><li>The use of a multi-model ensemble mean can minimize the model uncertainty and internal climate variability from the CMIP5 individual models (Liu et al., 2017).</li><li>We define a ratio of observations to seven-model ensemble-mean projections of ST trends as the scale factor that is multiplied by the ensemble-mean perturbations, to resolve more realistic anthropogenic perturbations. ?</li><li>Finally, these perturbations were <strong>interpolated linearly on each model grid over the outermost domain</strong> and <strong>then subtracted from ERA-Interim to generate counterfactual IBCs</strong> in WRF.</li><li>This method allows one to estimate anthropogenic influences on a specific extreme event, which makes it easier to perform event attribution analysis based on dynamical downscaling</li></ul></li></ul><h2 id="chow-cuhk-essc-m.phil.-thesis">2022 | Chow | CUHK ESSC M.Phil. thesis</h2><ul><li>Tsun Ngai CHOW</li><li>M.Phil. thesis: Effects of Background Synoptic Environment in Controlling the Tropical Cyclone Intensity and Size Changes in South China Sea in Pseudo-Global Warming Experiments</li><li><a href="https://atmosphericdynamicsgroup.github.io/publications.html" class="uri">https://atmosphericdynamicsgroup.github.io/publications.html</a></li><li><a href="https://atmosphericdynamicsgroup.github.io/theses/Tsun%20Ngai%20CHOW.pdf#page=48.40" class="uri">https://atmosphericdynamicsgroup.github.io/theses/Tsun%20Ngai%20CHOW.pdf#page=48.40</a></li></ul><p>Experiment Setup,</p><figure><img src="https://i.imgur.com/xK1AzZr.png" alt="Experiment Setup" /><figcaption>Experiment Setup</figcaption></figure><ul><li>total of <strong>31 and 5 models from the CMIP5</strong> were selected to obtain the projected future changes following the <strong>RCP8.5 and RCP4.5 emission scenario</strong> respectively.</li><li>The climate conditions in the <strong>1975 â€“ 1999</strong> were selected as the reference of the historical climate while the climate conditions in the <strong>2036 â€“ 2065</strong> and <strong>2075 â€“ 2099</strong> were selected as the near future and the far future climate respectively.</li><li>The <strong>SST, land surface temperature, atmospheric temperature and the specific humidity profiles</strong> in the historical climate, as well as in the projected near future and the far future climate were averaged across that period for each month separately to obtain the <strong>mean monthly climatic condition in the historical, near future and far future period</strong>.</li><li>After that, <strong>the SST, land surface temperature, atmospheric temperature and specific humidity in the near future and the far future were subtracted by the historical climate conditions</strong>, obtaining the change of surface temperature, atmospheric temperature and the specific humidity profile in the near and the far future relative to the historical period.</li><li>Then, the change in the monthly mean SST, land surface temperature, atmospheric temperature profile and the specific humidity profile in the near future and the far future relative to the historical climate were superimposed on the historical environment of the 25 selected TCs according to the month of occurrence in the past for each TC to create a total of 4 warming experiments, each contain 25 TC cases. Therefore, there are 1 control simulation and 4 warming experiments for each of the 25 TC cases, and a total of 125 simulations.</li><li><strong>Moreover, the reason for not imposing the projected change in wind field in the future climate to the TCs were to examine the change in thermodynamical environment due to global warming to the intensity and the size of the TCs, while not changing the track of the TC</strong>. The author aimed to reduce the complexity brought by the possible changes of the TC track in the future environment due to a change of steering wind, which then allowed a comparison between the response of different TCs in a warmed climate by attributing the different in the percentage change of TC intensity and size to the difference in the historical environment and the imposed warming signal.</li><li><strong>WRF-ARW version 3.7, ERA-20C and EAR5</strong> as the initial and boundary conditions of the control run</li><li>2 nested domains were set up with one-way nesting, with 15 km and 3 km (the domain size is 339 Ã— 249 and 400 Ã— 580 grid), 45 eta levels across the vertical direction</li></ul><h2 id="gutmann-changes-in-hurricanes-...">2018 | Gutmann | Changes in hurricanes ...</h2><ul><li><a href="https://journals.ametsoc.org/view/journals/clim/31/9/jcli-d-17-0391.1.xml?tab_body=pdf">Gutmann, E. D., Rasmussen, R. M., Liu, C., Ikeda, K., Bruyere, C. L., Done, J. M., ... &amp; Veldore, V. (2018). Changes in hurricanes from a 13-yr convection-permitting pseudoâ€“global warming simulation. Journal of Climate, 31(9), 3643-3657.</a></li></ul><p>Experiment Setup,</p><ul><li>The future simulations were forced with the same input data after adding a climate change signal to the data using the pseudoâ€“global warming (PGW) method.</li><li>In these simulations we applied a PGW change for the following input variables: <strong>zonal and meridional wind speed, sea level pressure, geopotential height, air temperature, relative humidity, and sea surface temperature as well as initial soil temperatures and the bottom boundary condition in the soil</strong>.</li><li>We compute the change signal over a 95-yr time period using data from the representative concentration pathway 8.5 <strong>(RCP8.5)</strong> scenario for 19 models in the CMIP5 archive. This is calculated by averaging the period 2070â€“99 and subtracting from it the average over the period 1976â€“2005. <strong>This change signal is calculated independently for every variable at every grid point in space, and for every month of the year</strong>.</li><li>Changes are temporally interpolated between month midpoints. For example, the change signal for 15 May of all years is computing by averaging the change signal over the period 1â€“30 May. The resulting change signal has a mean warming signal of 3â€“6 deg C and an increase in water vapor mixing ratio of 20%â€“40%, consistent with the Clausiusâ€“Clapeyron relationship.</li></ul><h2 id="rasmussen">2011 | Rasmussen</h2><ul><li><a href="https://journals.ametsoc.org/view/journals/clim/24/12/2010jcli3985.1.xml">Rasmussen, R., Liu, C., Ikeda, K., Gochis, D., Yates, D., Chen, F., ... &amp; Gutmann, E. (2011). High-resolution coupled climate runoff simulations of seasonal snowfall over Colorado: A process study of current and warmer climate. Journal of Climate, 24(12), 3015-3048.</a></li></ul><p>Experiment Setup,</p><ul><li>The PGW methodology consists of adding a climate perturbation signal to a contemporary high-resolution analysis of the atmosphere during the future period of interest. (provides a <strong>first-order estimate</strong> of the potential climate warming impacts)</li><li>The climate perturbationâ€™s primary impact is on the large-scale planetary waves and associated thermodynamics, while the weather patterns entering the domain boundary remain structurally identical in both simulations in terms of frequency and intensity. The weather events, however, can evolve within the regional model domain due to the altered planetary flow and thermodynamics.</li><li>The monthly climatologyâ€™s are the decadal monthly averages for the future and current decades resulting in regional values of mean <strong>temperature, vapor mixing ratio, geopotential height, and wind</strong> at each vertical level in the model in the domain of the high-resolution simulations.</li><li>The climate perturbation field is added to the current weather field for the selected years by <strong>linearly interpolating</strong> from the monthly climatologies to each time period in the NARR analysis assuming that the monthly mean is valid on the 16th of the month.</li><li>At the surface, <strong>deep-soil temperatures</strong> are also perturbed with the same methodology.</li><li>Both the initial conditions and time-evolving lateral and lower boundary conditions from NARR are therefore perturbed with the climate change signal.</li><li>The significant benefit of this is that the climate perturbation signal can be added to the NARR analysis while maintaining hydrostatic and geostrophic balances because the difference of two balanced mean fields retains the linear relationships between the virtual temperature, geopotential height, and horizontal wind perturbation fields. Therefore, adding this difference retains the consistency in the large-scale fields, while also preserving the small-scale weather patterns and imbalances of the period of interest.</li></ul><h2 id="è‡ºç£ç©ºæ°£å“è³ªè®ŠåŒ–èˆ‡æ°£å€™è®Šé·">è‡ºç£ç©ºæ°£å“è³ªè®ŠåŒ–èˆ‡æ°£å€™è®Šé·</h2><ul><li><a href="https://tccip.ncdr.nat.gov.tw/km_newsletter_one.aspx?nid=20191202172107">è‡ºç£ç©ºæ°£å“è³ªè®ŠåŒ–èˆ‡æ°£å€™è®Šé·</a> è¨ˆç•«æµç¨‹ç¤ºæ„åœ–ã€‚é è¨ˆå°‡é€²è¡Œå°ç…§çµ„ï¼ˆCTRLï¼‰åŠå¯¦é©—çµ„ï¼ˆPseudo-Global Warming, PGWï¼‰ï¼Œåˆ†åˆ¥ä»¥WRFåŠCMAQæ¨¡æ“¬ç¾åœ¨åŠæœªä¾†æ°£å€™ç‹€æ…‹çš„ç©ºæ°£å“è³ªã€‚æ©˜è‰²æ¡†ç‚ºWRFåˆå§‹åŠé‚Šç•Œæ¢ä»¶ï¼ŒCTRLä½¿ç”¨ECMWF ERA5è³‡æ–™ï¼ŒPGWå‰‡è€ƒæ…®æœªä¾†æ°£å€™è®ŠåŒ–å·®ç•°ã€‚</li></ul><figure><img src="https://tccip.ncdr.nat.gov.tw/upload/ckfinder/images/TCCIP%E7%AC%AC34%E6%9C%9F%E9%9B%BB%E5%AD%90%E5%A0%B1_%E5%9C%963.png" alt="æµç¨‹ç¤ºæ„åœ–" /><figcaption>æµç¨‹ç¤ºæ„åœ–</figcaption></figure><h1 id="codesoftware">Code/Software</h1><h2 id="software-package-pgw4era5-v1.1">** Software package PGW4ERA5 v1.1</h2><ul><li><a href="https://gmd.copernicus.org/articles/16/907/2023/">Brogli, R., Heim, C., Mensch, J., SÃ¸rland, S. L., &amp; SchÃ¤r, C. (2023). The pseudo-global-warming (PGW) approach: methodology, software package PGW4ERA5 v1. 1, validation, and sensitivity analyses. Geoscientific Model Development, 16(3), 907-926.</a></li><li>The term â€œpseudo-global warmingâ€ (PGW) refers to a simulation strategy in regional climate modeling. The strategy consists of directly imposing large-scale changes in the climate system on a control regional climate simulation (usually representing current conditions) by modifying the boundary conditions.</li><li>Both SCEN and HIST periods must be chosen to be long enough to reduce the effects of internal variability (average of âˆ¼ 30 years).</li><li><strong>At first glance it is surprising that one can change the driving fields of an RCM simulation in an ad hoc fashion as depicted above without introducing serious inconsistencies in the atmospheric dynamics</strong>. ... However, the PGW approach rests on a solid theoretical foundation....In essence, the balanceof forces is unchanged...</li></ul><div class="note note-warning">            <p>As to be demonstrated later (see Sect. 4.3), <strong>it is advantageous to use relative humidity (RH) rather than qv; if only the latter is available, qv is converted into RH.</strong> There are alternative approaches to treat the humidity change, such as the assumption of no change in RH with warming</p>          </div><figure><img src="https://gmd.copernicus.org/articles/16/907/2023/gmd-16-907-2023-t01-web.png" alt="Table 1Data requirements: pressure-level monthly-mean data from the driving GCM." width="400" /><figcaption>Table 1Data requirements: pressure-level monthly-mean data from the driving GCM.</figcaption></figure><h2 id="cmip5_to_wrf">CMIP5_to_WRF</h2><ul><li><a href="https://github.com/mgrover1/CMIP5_to_WRF" class="uri">https://github.com/mgrover1/CMIP5_to_WRF</a></li></ul><h1 id="bias-corrected-gcmscmip6-global-dataset">Bias-corrected GCMs/CMIP6 Global dataset</h1><h2 id="calibration-and-bias-correction">Calibration and bias correction</h2><ul><li><a href="https://eprints.whiterose.ac.uk/77973/10/challinor14.pdf">Hawkins, E., Osborne, T. M., Ho, C. K., &amp; Challinor, A. J. (2013). Calibration and bias correction of climate projections for crop modelling: An idealised case study over Europe. Agricultural and forest meteorology, 170, 19-31.</a></li></ul><p><img src="https://i.imgur.com/3JIZp97.png" width="400" /> <img src="https://i.imgur.com/5TipePD.png" width="600" /> <img src="https://i.imgur.com/ixHudQn.png" width="600" /></p><div class="note note-warning">            <ul><li><strong>Eqn. A.2 is a mapping</strong> <span class="math inline">\(f: X_1 \mapsto X_2\)</span> with providing estimates of <span class="math inline">\(M_{1,2}\)</span> and <span class="math inline">\(\sigma_{1,2}\)</span>.</li><li>then, we can map any input and get corresponding f(input) with providing estimates of <span class="math inline">\(M_{1,2}\)</span> and <span class="math inline">\(\sigma_{1,2}\)</span>.</li><li>like $ T_{BC} (t) = f(T_{RAW}(t))$ with providing estimates of <span class="math inline">\(M_{1,2}\)</span> and <span class="math inline">\(\sigma_{1,2}\)</span>.</li></ul>          </div><h2 id="an-evaluation-of-statistical-and-dynamical-techniques-for-downscaling-local-climate">An Evaluation of Statistical and Dynamical Techniques for Downscaling Local Climate</h2><ul><li><a href="https://journals.ametsoc.org/view/journals/clim/12/8/1520-0442_1999_012_2256_aeosad_2.0.co_2.xml?tab_body=pdf">Murphy, J. (1999). An Evaluation of Statistical and Dynamical Techniques for Downscaling Local Climate. Journal of Climate, 12(8), 2256-2284. https://doi.org/10.1175/1520-0442(1999)012&lt;2256:AEOSAD&gt;2.0.CO;2</a></li></ul><p><img src="https://i.imgur.com/IS1r7mb.png" width="400" /></p><h2 id="å»ºç«‹ç’°æµæ¨¡å¼æ¨ä¼°èƒ½åŠ›è©•æ¯”ä¹‹æ–¹æ³•">å»ºç«‹ç’°æµæ¨¡å¼æ¨ä¼°èƒ½åŠ›è©•æ¯”ä¹‹æ–¹æ³•</h2><ul><li>é€£å®›æ¸, ç«¥æ…¶æ–Œ, ä½•å®œæ˜•, æˆ´å˜‰æ…§, &amp; èŠç«‹æ˜•. (2013). å»ºç«‹ç’°æµæ¨¡å¼æ¨ä¼°èƒ½åŠ›è©•æ¯”ä¹‹æ–¹æ³•. <a href="https://www.twaes.org.tw/ae/htmdata/20120904.pdf">è¾²æ¥­å·¥ç¨‹å­¸å ±, 59(1), 1-14.</a><ul><li>GCM æ¨¡æ“¬çµæœèˆ‡åœ°é¢æ¸¬ç«™è³‡æ–™å­˜åœ¨è‘—èª¤å·®ï¼Œåœ¨é€²è¡Œç°¡æ˜“é™å°ºåº¦ä¹‹å‰ï¼Œå¿…é ˆè—‰ç”±èª¤å·®ä¿®æ­£(Bias Correction)æ‰èƒ½å»é™¤æ¨¡å¼èˆ‡åœ°é¢æ¸¬ç«™ä¹‹é–“çš„ç³»çµ±èª¤å·®ã€‚</li><li>å‡è¨­GCM ä¹‹è¼¸å‡ºè³‡æ–™. èˆ‡åœ°é¢æ¸¬ç«™è³‡æ–™æœ‰ç›¸åŒä¹‹çµ±è¨ˆç‰¹æ€§ï¼Œäº¦å³å…·æœ‰ç›¸. åŒä¹‹æ©Ÿç‡å€¼çš„æƒ…æ³ä¸‹ï¼ŒGCM ä¹‹é€æœˆè³‡æ–™èˆ‡æ­·å². é€æœˆè³‡æ–™ä¹‹é—œä¿‚å¯ç”±å¼(1)è¡¨ç¤º</li><li>By <span class="math inline">\(pdf = \frac{1}{\sqrt{2\pi\sigma^2}} e^{-\frac{(x - \mu)^2}{2\sigma^2}}\)</span></li><li><span class="math inline">\(\frac{X_{obs} - \mu_{obs}}{\sigma_{obs}} = \frac{X_{GCM} - \mu_{GCM}}{\sigma_{GCM}}\)</span></li></ul></li></ul><h2 id="bias-corrected-cmip6-global-dataset-for-dynamical-downscaling-of-the-historical-and-future-climate-19792100">Bias-corrected CMIP6 global dataset for dynamical downscaling of the historical and future climate (1979â€“2100)</h2><ul><li>Xu, Z., Han, Y., Tam, C. Y., Yang, Z. L., &amp; Fu, C. (2021). Bias-corrected CMIP6 global dataset for dynamical downscaling of the historical and future climate (1979â€“2100). Scientific Data, 8(1), 293.<ul><li><strong>General Circulation Model (GCM) is/are known to have significant biases</strong>, which propagate into RCMs through the lateral boundary and thus degrade the downscaled simulations.<ul><li><a href="https://waipangsze.github.io/2024/09/30/climate-model/#climate-model-bias">Climate model bias</a></li></ul></li><li>We constructed a bias-corrected global dataset based on 18 models from the <strong>Coupled Model Intercomparison Project Phase 6 (CMIP6)</strong> and the European Centre for Medium-Range Weather Forecasts Reanalysis 5 (<strong>ERA5</strong>) dataset.</li><li>The bias-corrected data have an ERA5-based <strong>mean climate and interannual variance</strong>, but with a <strong>non-linear trend</strong> from the ensemble mean of the 18 CMIP6 models.</li><li>The dataset spans the historical time period 1979â€“2014 and future scenarios (SSP245 and SSP585) for 2015â€“2100 with a horizontal grid spacing of (<strong>1.25Â°â€‰Ã—â€‰1.25Â°</strong>) at six-hourly intervals.</li><li>However, GCMs are known to have significant biases, which propagate into RCMs through the lateral boundary and thus degrade the downscaled simulations</li><li>Our method takes advantage of the <strong>non-linear trend</strong> of <strong>the ensemble mean of 18 Coupled Model Intercomparison Project Phase 6 (CMIP6)</strong> models to give a more reliable projection of the long-term climate trend.</li><li>In addition, we also correct the <strong>GCM climatological mean and interannual variance biases</strong> based on the European Centre for Medium-Range Weather Forecasts Reanalysis 5 (<strong>ERA5</strong>) dataset.</li></ul></li></ul><p><img src="https://i.imgur.com/YPVCv5g.png" width="600" /> <img src="https://i.imgur.com/siOQMBO.png" width="600" /></p><h2 id="åŸºäº-cmip6-è€¦åˆ-wrf-çš„é»„æ²³ä¸Šæ¸¸å¤åˆå¹²æ—±çƒ­æµªäº‹ä»¶æ¼”å˜è§„å¾‹.-æ°´åˆ©å­¦æŠ¥-558-908-919.">åŸºäº CMIP6 è€¦åˆ WRF çš„é»„æ²³ä¸Šæ¸¸å¤åˆå¹²æ—±çƒ­æµªäº‹ä»¶æ¼”å˜è§„å¾‹. æ°´åˆ©å­¦æŠ¥, 55(8), 908-919.</h2><ul><li>é—¨å®è¾‰, å•è¡Œ, é™ˆä»•è±ª, &amp; ç‹çº¢ç‘. (2024). åŸºäº CMIP6 è€¦åˆ WRF çš„é»„æ²³ä¸Šæ¸¸å¤åˆå¹²æ—±çƒ­æµªäº‹ä»¶æ¼”å˜è§„å¾‹. æ°´åˆ©å­¦æŠ¥, 55(8), 908-919.<ul><li><a href="http://jhe.ches.org.cn/jhe/ch/reader/create_pdf.aspx?file_no=20240803&amp;flag=1&amp;journal_id=jhe&amp;year_id=2024#page=1.00&amp;gsr=0" class="uri">http://jhe.ches.org.cn/jhe/ch/reader/create_pdf.aspx?file_no=20240803&amp;flag=1&amp;journal_id=jhe&amp;year_id=2024#page=1.00&amp;gsr=0</a></li><li>æœ¬æ–‡æå‡ºäº†ä¸€ç§åŸºäºç¬¬å…­æ¬¡å›½é™…è€¦åˆæ¨¡å¼æ¯”è¾ƒè®¡åˆ’CMIP6è€¦åˆå¤©æ°”é¢„æŠ¥ç ”ç©¶æ¨¡å¼WRFçš„æœªæ¥æ°”è±¡æ•°æ®åŠ¨åŠ›é™å°ºåº¦æ–¹æ³•</li><li>ç²¾åº¦éªŒè¯<ul><li>é‡‡ç”¨ç ”ç©¶åŒºåŸŸå†…10ä¸ªæ°”è±¡ç«™ï¼ˆå¦‚å›¾1æ‰€ç¤ºï¼‰1979-2014å¹´çš„å®æµ‹æ•°æ®åŠ5ç§åŸå§‹CMIP6æ•°æ®é›†å¯¹bc-CMIP6çš„æ¨¡æ‹Ÿç²¾åº¦è¿›è¡Œæ£€éªŒå’Œå¯¹æ¯”</li></ul></li></ul></li></ul><p><img src="https://i.imgur.com/asBspN2.png" width="600" /> <img src="https://i.imgur.com/YqeSZn4.png" width="600" /></p>]]></content>
    
    
    <categories>
      
      <category>NWP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NWP</tag>
      
      <tag>WRF</tag>
      
      <tag>MPAS</tag>
      
      <tag>PGW</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Climate Models</title>
    <link href="/2024/09/30/climate-model/"/>
    <url>/2024/09/30/climate-model/</url>
    
    <content type="html"><![CDATA[<h1 id="climate-models">Climate models</h1><p>Climate models are systems of differential equations based on the basic laws of physics, fluid motion, and chemistry. To "run" a model, scientists divide the planet into a 3-dimensional grid, apply the basic equations, and evaluate the results. Atmospheric models calculate winds, heat transfer, radiation, relative humidity, and surface hydrology within each grid and evaluate interactions with neighboring points.</p><figure><img src="https://celebrating200years.noaa.gov/breakthroughs/climate_model/AtmosphericModelSchematic.png" alt="(Image source: NOAA)" /><figcaption>(Image source: NOAA)</figcaption></figure><h2 id="the-complexity-of-the-climate-models">The complexity of the climate models</h2><p>As computing power has increased since the 1970s, so has the complexity of the computer models used to simulate Earth's climate. Components are first developed separately and later coupled into comprehensive models.</p><figure><img src="https://climate.nasa.gov/rails/active_storage/blobs/redirect/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaHBBa2NqIiwiZXhwIjpudWxsLCJwdXIiOiJibG9iX2lkIn19--81d8c831c0e77e9a03d7575233db6494080cbf46/evolution_743px.jpg?disposition=inline" alt="(From NASA)" /><figcaption>(From NASA)</figcaption></figure><h2 id="climate-model-bias">Climate model bias</h2><p>Climate model bias is the difference between the statistics of the observations for the reference period and the statistics of the climate model simulation for the same period.</p><p>The bias of a climate model is determined by comparing the climate model output for a past period with observational data for that same period. For example the annual and seasonal climatological averages for all relevant climate variables are compared, the probability of certain extremes, variability, trends, etc. The smaller the bias, the higher the model skill to simulate the observed climate correctly. This skill is often used as a measure of quality. <strong>Model biases are determined by comparing the statistics of observational records for a certain period (often 30 years) with the simulated climate for the same period in the past (for projections). Biases can not be determined by comparing e.g. the weather on certain dates or in certain years in the past!</strong></p><ul><li>Gupta, A. S., Jourdain, N. C., Brown, J. N., &amp; Monselesan, D. (2013). Climate Drift in the CMIP5 Models. Journal of Climate, 26(21), 8597-8615. https://doi.org/10.1175/JCLI-D-12-00521.1<ul><li>Model drift refers to spurious long-term changes in general circulation models that are unrelated to either changes in external forcing or internal low-frequency variability. Drift can be caused by a number of factors. For example, a simulation's initial state may not be in dynamical balance with the representation of physics in the model; â€œcoupling shockâ€ may occur during the coupling of model components resulting in discontinuities in surface fluxes (e.g., Rahmstorf 1995) or numerical errors may exist in the model that mean that heat or moisture is not fully conserved</li></ul></li></ul><p>Climate model bias refers to the systematic differences between the outputs of climate models and actual observed climate statistics. These biases can arise from several factors, including:</p><h3 id="definition-of-climate-model-bias"><strong>1. Definition of Climate Model Bias</strong></h3><ul><li>Climate model bias is defined as the difference between a simulated climate statistic (from a model) and the corresponding real-world climate statistic (observations) for the same period. This can include discrepancies in temperature, precipitation, and other climate variables over time.</li></ul><h3 id="causes-of-bias"><strong>2. Causes of Bias</strong></h3><ul><li><strong>Spatial Resolution</strong>: Many climate models operate on large grid sizes, which can lead to inaccuracies in representing local climate features.</li><li><strong>Simplified Thermodynamic Processes and Physics</strong>: Models may oversimplify complex physical processes, such as convection or land-atmosphere interactions, leading to incorrect simulations of climate dynamics.</li><li><strong>Incomplete Understanding</strong>: The current understanding of the climate system is not exhaustive, which can result in biases in model outputs.</li></ul><h3 id="types-of-bias"><strong>3. Types of Bias</strong></h3><ul><li><strong>Mean Bias</strong>: The average difference between model outputs and observations.</li><li><strong>Variance Bias</strong>: Differences in variability, such as how extreme weather events are represented.</li><li><strong>Temporal Bias</strong>: Issues related to timing, such as incorrect seasonal patterns or shifts in monsoon timings.</li></ul><h3 id="implications-of-bias"><strong>4. Implications of Bias</strong></h3><p>Using uncorrected climate model outputs for impact assessments can yield unrealistic results. For example, if a model consistently underestimates rainfall extremes, it could misinform water resource management or flood risk assessments.</p><h3 id="bias-correction-methods"><strong>5. Bias Correction Methods</strong></h3><p>To address these biases, various statistical methods have been developed:</p><ul><li><strong>Delta Change Method</strong>:<ul><li>Adjusts historical observations based on projected changes from models (e.g., adding a predicted temperature increase to historical data).</li><li>The simplest approach is the Delta change method, which is often used in climate impact research. This approach uses the GCM or RCM response to climate change to modify observations. E.g. if the climate model predicts 3Â°C higher temperatures, 3Â°C is added to all historic observations to construct a new time series for the future climate. For rainfall usually a percentage change is calculated. If the climate model predicts a 20% increase in rainfall, a new time-series will be made by multiplying the historic rainfall by 1.2. For different months or seasons different delta factors can be defined. Note: this method does not take into account changes in climate variability such as increasing extreme rainfall or longer dry spells.</li></ul></li><li><strong>Quantile Mapping</strong>: A more sophisticated method that maps the cumulative distribution functions (CDFs) of observed and modeled data to adjust for biases across all quantiles.</li><li><strong>Linear Regression</strong>: Uses historical data to create a statistical relationship between observed and modeled outputs for future projections.</li></ul><p>Both the delta change and linear regression method are suitable to bias adjust relative humidity, humidity, wind speed and radiation.</p><p>Climate models produce area-average data, whereas many observations are point measurements. In order to determine the skill, climate model data should be compared with area-average data, otherwise the bias may be affected by the difference between area-average and point data. This is especially important for climate variables where large spatial differences are observed within a grid cell, e.g. precipitation. For this reason reanalysis data are often used to determine the skill of climate models. The quality of climate data for the future cannot be assessed in a direct way, since no observational data set is available for the future. It is generally assumed that the bias/skill for the future is the same as for the past/current climate (although this is not necessarily true). When the skill is good for the current climate, we generally have more confidence in the results for the future.</p><h3 id="challenges-with-bias-correction"><strong>6. Challenges with Bias Correction</strong></h3><p>While bias correction methods aim to improve model outputs, they have limitations:</p><ul><li>They may not fully correct underlying physical process misrepresentations.</li><li>They can introduce new artifacts or inconsistencies in spatial and temporal data.</li><li>The assumption that present-day biases will remain constant over time can be problematic, especially for variables like precipitation that may exhibit non-stationarity.</li></ul><p>In summary, understanding and correcting climate model bias is essential for improving the reliability of climate projections and their applications in impact studies.</p><h1 id="downscaling-climate-models">Downscaling climate models</h1><p>Downscaling climate models is a crucial process for obtaining localized climate information from global climate models (GCMs), which typically operate at coarse spatial resolutions. Below is an overview of how to perform downscaling and the associated challenges.</p><figure><img src="https://climateextremes.org.au/wp-content/uploads/Screenshot-2023-04-13-at-4.01.03-pm-1.png" alt="Downscaled temperature over south-east Australia. Data: NARCLiM" /><figcaption>Downscaled temperature over south-east Australia. Data: NARCLiM</figcaption></figure><ul><li><a href="https://tccip.ncdr.nat.gov.tw/km_column_one.aspx?kid=20230725084802">ä»€éº¼æ˜¯é™å°ºåº¦? ç‚ºä»€éº¼é™å°ºåº¦ä¸æ˜¯è¶Šç´°è¶Šå¥½?</a></li></ul><h2 id="methods-of-downscaling">Methods of Downscaling</h2><h3 id="types-of-downscaling"><strong>1. Types of Downscaling</strong></h3><ul><li><strong>Dynamical Downscaling</strong>: This method uses regional climate models (RCMs) that are forced by GCM outputs. RCMs operate on finer spatial scales (typically &lt;50 km) and can capture local climate features more accurately by incorporating detailed physical processes.</li><li><strong>Statistical Downscaling</strong>: This approach establishes statistical relationships between large-scale climate variables from GCMs and local observations. It is less computationally intensive than dynamical downscaling and includes methods such as:<ul><li><strong>Bias Correction with Spatial Disaggregation (BCSD)</strong>: Adjusts GCM outputs based on historical data.</li><li><strong>Quantile Mapping</strong>: Corrects the distribution of model outputs to match observed data distributions.</li><li><strong>Localized Constructed Analogs (LOCA)</strong>: Finds analogous historical weather patterns to generate fine-resolution outputs.</li></ul></li></ul><h3 id="steps-for-downscaling"><strong>2. Steps for Downscaling</strong></h3><ol type="1"><li><strong>Select a GCM</strong>: Choose a suitable global climate model and the relevant emission scenario.</li><li><strong>Obtain Historical Data</strong>: Gather historical climate data for the region of interest to establish baseline conditions.</li><li><strong>Choose a Downscaling Method</strong>: Decide between dynamical or statistical downscaling based on available resources and required precision.</li><li><strong>Run the Downscaling Model</strong>:<ul><li>For dynamical downscaling, set up the RCM with appropriate boundary conditions from the GCM.</li><li>For statistical downscaling, develop statistical relationships using historical data and apply them to future GCM projections.</li></ul></li><li><strong>Validate Outputs</strong>: Compare downscaled results with observed data to assess accuracy and make necessary adjustments.</li></ol><h2 id="challenges-of-downscaling">Challenges of Downscaling</h2><h3 id="computational-demands"><strong>1. Computational Demands</strong></h3><ul><li>Both dynamical and statistical downscaling can be computationally intensive, especially when multiple RCMs or scenarios are involved. This can strain resources for many research groups, limiting their ability to conduct extensive simulations.</li></ul><h3 id="bias-issues"><strong>2. Bias Issues</strong></h3><ul><li>GCMs often have systematic biases in their outputs, which can propagate through the downscaling process. If not adequately addressed, these biases can lead to misleading local projections.</li></ul><h3 id="uncertainty-in-atmospheric-circulation"><strong>3. Uncertainty in Atmospheric Circulation</strong></h3><ul><li>The accuracy of downscaled projections is heavily reliant on the atmospheric circulation patterns provided by GCMs. Any uncertainty in these patterns can significantly affect regional climate outcomes.</li></ul><h3 id="limitations-of-statistical-methods"><strong>4. Limitations of Statistical Methods</strong></h3><ul><li>Statistical downscaling relies on historical relationships that may not hold true under future climate conditions, leading to potential inaccuracies in projections. Additionally, assumptions made during statistical modeling can introduce further biases.</li></ul><h3 id="scale-mismatch"><strong>5. Scale Mismatch</strong></h3><ul><li>The coarse resolution of GCMs may not adequately represent localized phenomena such as orographic precipitation or extreme weather events, which are vital for impact assessments.</li></ul><p>In summary, while downscaling is essential for obtaining high-resolution climate information necessary for local impact studies, it comes with significant challenges that need careful consideration and management to ensure reliable projections.</p><h1 id="references">References</h1><ul><li><a href="https://climate.copernicus.eu/sites/default/files/2021-12/10-c3s-uls-data-resources-climate-models.pdf">C3S User Learning Services Data Resources - Climate Models</a> ((<strong>Recommendation</strong>))</li><li><a href="https://climateextremes.org.au/a-closer-look-at-climate-modelling/">climateextremes.org.au: Types of models</a> ((<strong>Recommendation</strong>))</li><li><a href="https://skepticalscience.com/weather-forecasts-vs-climate-models-predictions.htm">The difference between weather and climate</a></li><li><a href="https://blogs.reading.ac.uk/weather-and-climate-at-reading/2022/weather-vs-climate-prediction/">Weather and Climate @ Reading: Weather vs. Climate Prediction</a></li><li><a href="https://www.climate.gov/maps-data/climate-data-primer/predicting-climate/climate-models">Climate gov: Climate Models</a></li><li><a href="https://www.earth-scan.com/blog/weather-vs-climate">earth-scan: weather-vs-climate</a></li><li><a href="https://climate.copernicus.eu/sites/default/files/2021-01/infosheet7.pdf">Copernicus Climate Change Service â€“ Global Impacts: What is bias correction?</a></li><li>Kotamarthi R, Hayhoe K, Mearns LO, Wuebbles D, Jacobs J, Jurado J. <strong>Empirical-Statistical Downscaling</strong>. In: Downscaling Techniques for High-Resolution Climate Projections: From Global Change to Local Impacts. Cambridge University Press; 2021:82-101. (<a href="https://sci-hub.se/https://doi.org/10.1017/9781108601269.006">link</a>)</li><li>Xu, Z., Y. Han, C.-Y. Tam, Z.-L. Yang and C. Fu, 2021: <strong>A bias-corrected CMIP6 global dataset. for dynamical downscaling of future climate, 1979â€“2100</strong>, Scientific Data, doi: 10.1038/s41597-021-01079-3. <a href="https://atmosphericdynamicsgroup.github.io/database/cmip6.html" class="uri">https://atmosphericdynamicsgroup.github.io/database/cmip6.html</a></li><li><a href="https://probablefutures.org/zh/science/climate-models/">Probable Futures æ˜¯ä¸€é¡¹éè¥åˆ©æ€§æ°”å€™æ‰«ç›²è®¡åˆ’</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>NWP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NWP</tag>
      
      <tag>WRF</tag>
      
      <tag>MPAS</tag>
      
      <tag>PGW</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Differences Between Weather Models and Climate Models</title>
    <link href="/2024/09/30/weather-model-vs-climate-model/"/>
    <url>/2024/09/30/weather-model-vs-climate-model/</url>
    
    <content type="html"><![CDATA[<h2 id="differences-between-weather-models-and-climate-models">Differences Between Weather Models and Climate Models</h2><p>Understanding the distinctions between weather models and climate models is crucial for grasping how meteorologists and climate scientists predict atmospheric conditions over varying timescales. Here are the key differences:</p><h3 id="time-scale-of-predictions"><strong>1. Time Scale of Predictions</strong></h3><ul><li><strong>Weather Models</strong>: These models focus on short-term predictions, typically ranging from a few hours to about 15 days. They provide detailed forecasts for specific locations, such as whether it will rain tomorrow or if a storm is approaching.</li><li><strong>Climate Models</strong>: In contrast, climate models project conditions over much longer periods, often decades to hundreds of years. They analyze trends and averages rather than specific events, such as predicting whether summers will become drier in the next 50 years.</li></ul><h3 id="initial-vs.-foreced-boundary-value-problems"><strong>2. Initial vs. Foreced Boundary Value Problems</strong></h3><ul><li><strong>Weather Models</strong>: They operate as initial value problems, meaning they require precise initial conditions (like current temperature and pressure) to generate accurate forecasts. Small changes in these initial conditions can significantly impact the forecast outcome.</li><li><p><strong>Climate Models</strong>: In a climate model, you get climate variables for every day, but you don't care exactly on which day and exact location you get a certain value for this variable as long as the long term statistics are correct for the location and reference. This does not depend on the initial conditions of the simulation, but it depends on the parameters in the model itself or how the climate system is modelled (this is called a boundary value problem). These are "Foreced" boundary value problems, focusing on long-term changes influenced by factors like greenhouse gas concentrations and land use changes. The initial state is less critical; instead, the model uses projected future conditions to assess climate evolution.</p></li><li>é æ¸¬æœªä¾†æ°£å€™ç³»çµ±çš„æ¼”è®Šæ˜¯æ°£å€™ç§‘å­¸çš„æ ¸å¿ƒã€‚å¦‚å‰æ‰€è¿°ï¼Œæ°£å€™é æ¸¬æ˜¯ä¸€å€‹é‚Šç•Œå€¼å•é¡Œã€‚æ¨¡å‹å¿…é ˆå‡è¨­é•·æœŸé™åˆ¶æ°£å€™æ¼”è®Šçš„æ¢ä»¶å°‡å¦‚ä½•æ¼”è®Šï¼Œä¾‹å¦‚å°æœªä¾†æº«å®¤æ°£é«”æ’æ”¾åšå‡ºæœ‰æ ¹æ“šçš„çŒœæ¸¬ã€‚ç›¸åï¼Œå¤©æ°£é å ±æ˜¯ä¸€å€‹åˆå§‹å€¼å•é¡Œï¼Œé¦–å…ˆå–æ±ºæ–¼å°å¤©æ°£ç³»çµ±ç•¶å‰ç‹€æ…‹çš„æº–ç¢ºäº†è§£ã€‚æ°£å€™é æ¸¬æ˜¯ä¸€å€‹é‚Šç•Œå€¼çš„å•é¡Œï¼Œåœ¨æ°£å€™æ¡ˆä¾‹ä¸­ï¼Œæœ€å¤§çš„ä¸ç¢ºå®šæ€§åœ¨æ–¼ç¢ºå®šå¾å¤ªé™½æ¥æ”¶çš„èƒ½é‡ï¼ˆé‚Šç•Œå€¼ï¼‰å¦‚ä½•åœ¨ç³»çµ±çš„å„å€‹çµ„æˆéƒ¨åˆ†ï¼ˆå³å¤§æ°£ã€æµ·æ´‹ã€é™¸åœ°å’Œå†°å‡åœˆï¼‰ä¸­åˆ†ä½ˆã€‚<ul><li>Bracco, A., Brajard, J., Dijkstra, H. A., Hassanzadeh, P., Lessig, C., &amp; Monteleoni, C. (2024). Machine Learning for the Physics of Climate. arXiv preprint arXiv:2408.09627</li></ul></li><li><p>æ°£å€™è®Šé·çš„é æ¸¬ä¸åŒæ–¼å¤©æ°£é å ±ï¼Œå¾Œè€…ä¸»è¦ä¾è³´åˆå€¼ï¼Œè€Œå‰è€…æ—¢ä¾è³´åˆå§‹æ¢ä»¶,ä¹Ÿä¾â€‹â€‹è³´é‚Šç•Œæ¢ä»¶æˆ–å®Œå…¨ä¾è³´é‚Šç•Œæ¢ä»¶ã€‚çŸ­æœŸæ°£å€™é æ¸¬ï¼Œå°±æ˜¯ä¾è³´ä»¥ä¸Šå…©ç¨®æ¢ä»¶ï¼Œé€™ç¨®å¯é å ±æ€§è¢«æ´›å´™èŒ²ç¨±ç‚ºç¬¬ä¸€é¡å¯é å ±æ€§ã€‚å°æ–¼é•·æœŸ(å¹¾åå¹´æˆ–å¹¾ç™¾å¹´)çš„æ°£å€™è®Šé·é æ¸¬ï¼Œå¦‚ç”±äººé¡æ´»å‹•é€ æˆçš„æº«å®¤æ°£é«”å¢åŠ å¼•èµ·çš„å…¨çƒæ°£å€™è®ŠåŒ–ï¼Œå°‡ä¸ä¾è³´æ–¼å¤§æ°£çš„åˆå§‹æ¢ä»¶ï¼Œé€™æ˜¯ç”±æ–¼åœ¨æ¨¡å¼é•·æœŸç©åˆ†ä¹‹å¾Œï¼Œå°‡å®Œå…¨å–ªå¤±å°åˆæ¢ä»¶çš„è¨˜æ†¶ï¼Œå› è€Œå¤±å»å®ƒçš„å½±éŸ¿ã€‚é€™ç¨®å®Œå…¨ä¾è³´è©³ç´°é‚Šç•Œæ¢ä»¶è®ŠåŒ–çš„æ°£å€™é æ¸¬è¢«æ´›å´™èŒ²ç¨±ç‚ºç¬¬äºŒé¡å¯é å ±æ€§ï¼Œå…¶å¯é å ±æ€§æ±ºå®šæ–¼å¤–ç•Œå¼·è¿«è®ŠåŒ–çš„æ™‚é–“å°ºåº¦ã€‚ç”±æ–¼æ°£å€™ç³»çµ±çš„æ…£æ€§ï¼Œå³ä½¿æ–½åŠ æ–¼é‚Šç•Œçš„å¤–å¼·è¿«æ¶ˆå¤±ä¹‹å¾Œå¾ˆä¹…,æ°£å€™ç³»çµ±é‚„å°‡ç¹¼çºŒè®ŠåŒ–ç›¸ç•¶é•·çš„æ™‚é–“ï¼Œç”šè‡³é•·é”åƒå¹´ä»¥ä¸Šï¼Œæµ·å¹³é¢ä¸Šå‡çš„åæ‡‰å°±æ˜¯ä¸€å€‹ä¾‹å­ã€‚é›–ç„¶æ°£å€™æœ¬è³ªä¸Šæ˜¯ä¸€ç¨®æ··æ²Œç¾è±¡,è¡¨ç¾ç‚ºæ¹æµæˆ–éé€±æœŸç¾è±¡ï¼Œä½†æœ‰äº›æƒ…æ³ä¸‹ä¹Ÿè¡¨ç¾å‡ºç›¸ç•¶ç¨‹åº¦çš„é€±æœŸæ€§æˆ–æº–é€±æœŸæ€§ï¼Œé€™å°±å¤§å¤§å¢åŠ äº†æ°£å€™çš„å¯é æ¸¬æ€§ã€‚ç›®å‰åœ¨æ°£å€™åˆ†æä¸­å»£æ³›ä½¿ç”¨çš„å¦‚å­æ³¢åˆ†ææ³•ç­‰,å°±æ˜¯ç‚ºæ­ç¤ºå…¶ä¸åŒæ™‚ç©ºå°ºåº¦çš„å‘¨æœŸæ€§è€Œé€²è¡Œçš„ï¼Œå¦å¤–ä¸€å€‹æ°£å€™é€±æœŸæ€§è‘—åçš„ä¾‹å­æ˜¯åœ°çƒè»Œé“åƒæ•¸çš„ç±³è˜­ç§‘ç¶­å¥‡å¾ªç’°ã€‚<a href="https://gd.weather.com.cn/climate/qhbhyw/11/1196273.shtml">link</a></p></li></ul><h3 id="resolution"><strong>3. Resolution</strong></h3><ul><li><strong>Weather Models</strong>: They typically have a finer spatial and temporal resolution, allowing for detailed predictions over smaller areas (often at a scale of 1 km or less). This granularity is essential for short-term forecasting.</li><li><strong>Climate Models</strong>: While they can also achieve high resolution, climate models generally operate on coarser grids (often around 50 km) due to the longer timeframes they analyze. The focus is on broader patterns rather than localized events.</li></ul><h3 id="data-assimilation"><strong>4. Data Assimilation</strong></h3><ul><li><strong>Weather Models</strong>: These models assimilate real-time observational data from satellites, weather stations, and radar to continuously update forecasts. This real-time data integration enhances accuracy for short-term predictions.</li><li><strong>Climate Models</strong>: Climate models do not incorporate real-time observations but instead rely on historical data and projections of future conditions based on various scenarios (e.g., different levels of greenhouse gas emissions) to simulate long-term trends.</li></ul><h3 id="purpose-and-application"><strong>5. Purpose and Application</strong></h3><ul><li><strong>Weather Models</strong>: Primarily used for immediate forecasting needs such as daily weather reports, severe weather warnings, and event planning. They help individuals and organizations prepare for short-term atmospheric conditions.</li><li><strong>Climate Models</strong>: Climate models are used to determine how the average and extreme conditions will change. Used to understand long-term climate change impacts, assess risks associated with global warming, and inform policy decisions regarding environmental management and sustainability. Their outputs guide infrastructure planning and disaster preparedness over extended periods.</li></ul><h3 id="summary-table">Summary Table</h3><table><thead><tr class="header"><th style="text-align: left;">Feature</th><th style="text-align: left;">Weather Models</th><th style="text-align: left;">Climate Models</th></tr></thead><tbody><tr class="odd"><td style="text-align: left;">Time Scale</td><td style="text-align: left;">Hours to 15 days</td><td style="text-align: left;">Decades to hundreds of years</td></tr><tr class="even"><td style="text-align: left;">Problem Type</td><td style="text-align: left;">Initial value problem</td><td style="text-align: left;">Boundary value problem</td></tr><tr class="odd"><td style="text-align: left;">Resolution</td><td style="text-align: left;">High (1 km or less)</td><td style="text-align: left;">Coarse (typically 50 km)</td></tr><tr class="even"><td style="text-align: left;">Data Assimilation</td><td style="text-align: left;">Real-time observational data</td><td style="text-align: left;">Historical data and future projections</td></tr><tr class="odd"><td style="text-align: left;">Purpose</td><td style="text-align: left;">Short-term forecasting</td><td style="text-align: left;">Long-term climate change analysis</td></tr></tbody></table><p>In summary, while both weather and climate models share foundational scientific principles, they serve different purposes and operate under distinct methodologies tailored to their respective timeframes and objectives.</p><figure><img src="https://www.esa.int/var/esa/storage/images/esa_multimedia/images/2021/04/weather_versus_climate_at_a_glance/23267896-1-eng-GB/Weather_versus_climate_at_a_glance_article.jpg" alt="â€˜Weatherâ€™ refers to short-term changes, and â€˜climateâ€™ to weather conditions averaged over at least 30 years (image source: ESA)." /><figcaption>â€˜Weatherâ€™ refers to short-term changes, and â€˜climateâ€™ to weather conditions averaged over at least 30 years (image source: ESA).</figcaption></figure><h1 id="references">References</h1><ul><li><a href="https://climate.copernicus.eu/sites/default/files/2021-12/10-c3s-uls-data-resources-climate-models.pdf">C3S User Learning Services Data Resources - Climate Models</a> ((<strong>Recommendation</strong>))</li><li><a href="https://climateextremes.org.au/a-closer-look-at-climate-modelling/">climateextremes.org.au: Types of models</a> ((<strong>Recommendation</strong>))</li><li><a href="https://skepticalscience.com/weather-forecasts-vs-climate-models-predictions.htm">The difference between weather and climate</a></li><li><a href="https://blogs.reading.ac.uk/weather-and-climate-at-reading/2022/weather-vs-climate-prediction/">Weather and Climate @ Reading: Weather vs. Climate Prediction</a></li><li><a href="https://www.climate.gov/maps-data/climate-data-primer/predicting-climate/climate-models">Climate gov: Climate Models</a></li><li><a href="https://www.earth-scan.com/blog/weather-vs-climate">earth-scan: weather-vs-climate</a></li><li><a href="https://climate.copernicus.eu/sites/default/files/2021-01/infosheet7.pdf">Copernicus Climate Change Service â€“ Global Impacts: What is bias correction?</a></li><li>Kotamarthi R, Hayhoe K, Mearns LO, Wuebbles D, Jacobs J, Jurado J. <strong>Empirical-Statistical Downscaling</strong>. In: Downscaling Techniques for High-Resolution Climate Projections: From Global Change to Local Impacts. Cambridge University Press; 2021:82-101. (<a href="https://sci-hub.se/https://doi.org/10.1017/9781108601269.006">link</a>)</li><li>Xu, Z., Y. Han, C.-Y. Tam, Z.-L. Yang and C. Fu, 2021: <strong>A bias-corrected CMIP6 global dataset. for dynamical downscaling of future climate, 1979â€“2100</strong>, Scientific Data, doi: 10.1038/s41597-021-01079-3. <a href="https://atmosphericdynamicsgroup.github.io/database/cmip6.html" class="uri">https://atmosphericdynamicsgroup.github.io/database/cmip6.html</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>NWP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NWP</tag>
      
      <tag>WRF</tag>
      
      <tag>MPAS</tag>
      
      <tag>PGW</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Data assimilation (DA)</title>
    <link href="/2024/09/24/DA-intro/"/>
    <url>/2024/09/24/DA-intro/</url>
    
    <content type="html"><![CDATA[<h1 id="data-assimilation-da">Data assimilation (DA)</h1><p>Data assimilation (DA) (æ•¸æ“šåŒåŒ–ï¼Œæˆ–ç¨±è³‡æ–™åŒåŒ–) is a technique by which numerical model data and observations are combined to obtain an analysis that best represents the state of the atmospheric phenomena of interest</p><h1 id="history">History</h1><ul><li>In 1901 Cleveland Abbe founded the United States Weather Bureau. He suggested that the atmosphere followed the principles of thermodynamics and hydrodynamics</li><li>In 1904, Vilhelm Bjerknes proposed a two-step procedure formodel-based weather forecasting. First, a analysis step of data assimilation to generate initial conditions, then a forecasting step solving the initial value problem.</li><li>In 1922, Lewis Fry Richardson carried out the first attempt to perform the weather forecast numerically.</li><li>In 1950, a team of the American meteorologists Jule Charney, Philip Thompson, Larry Gates, and Norwegian meteorologist Ragnar Fj Ìˆortoft and the applied mathematician John von Neumann, succeeded in the first numerical weather forecast using the ENIAC digital computer.</li><li>In September 1954, Carl-Gustav Rossbyâ€™s group at the Swedish Meteorological and Hydrological Institute produced the first operational forecast (i.e. routine predictions for practical use) based on the barotropic equation. Operational numerical weather prediction in the United States began in 1955 under the Joint Numerical Weather Prediction Unit (JNWPU), a joint project by the U.S. Air Force, Navy, and Weather Bureau.</li><li>In 1959, Karl-Heinz Hinkelmann produced the first reasonable primitive equation forecast, 37 years after Richardsonâ€™s failed attempt. Hinkelmann did so by removing high-frequency noise from the numerical model during initialization.</li><li>In 1966, West Germany and the United States began producing operational forecasts based on primitive-equation models, followed by the United Kingdom in 1972, and Australia in 1977.</li></ul><h2 id="polynomial-fitting-of-panofsky">Polynomial Fitting of Panofsky</h2><blockquote><p>Panofsky, R. A. (1949). Objective weather-map analysis. Journal of Atmospheric Sciences, 6(6), 386-392.</p></blockquote><p><span class="math display">\[\begin{equation}\begin{split}p(x,y) = \sum_{i,j} a_{ij} x^i y^j, \qquad  i+j \leq 3\end{split}\end{equation}\tag{2}\]</span></p><ul><li>A field of 10 observations can be fitted accurately by a third-degree polynomial, with no smoothing of data.</li><li>The amount of smoothing will depend on the nature of the variable analyzed.</li></ul><h2 id="successive-correction-method-scm-of-cressman">Successive Correction Method (SCM) of Cressman</h2><blockquote><p>Cressman G P, 1959. An operational objective analysis system[J]. Mon Wea Rev, 87: 367-374.</p></blockquote><ul><li>Purpose:<ul><li>SCM is designed to improve the accuracy of gridded meteorological data by integrating observations from various sources, such as weather stations, into a coherent grid. This method is particularly useful in situations where observational data is sparse or unevenly distributed.</li></ul></li><li>Basic Principle:<ul><li>The method operates on the principle of iteratively correcting a background field (initial guess) using available observational data. Each iteration refines the grid values based on nearby observations, effectively merging the observational data with the background field.</li></ul></li><li>Weighting Function:<ul><li>Cressman's SCM employs a specific weighting function that determines how much influence each observation has on the grid point being corrected. This function typically decreases with distance from the observation point, allowing closer observations to have a greater impact on the grid value than those further away.</li></ul></li><li>Computational Efficiency:<ul><li>One of the advantages of SCM is its computational simplicity and efficiency, making it suitable for real-time applications in weather forecasting and analysis. It does not require complex background error covariance matrices or assumptions about error distributions, which simplifies its implementation compared to other assimilation methods like Optimal Interpolation (OI) or Variational methods.</li></ul></li></ul><h1 id="inverse-problem">Inverse Problem</h1><p>DA consists of using the actual result of some measurements to infer the values of the parameters that characterize the system.</p><h1 id="random-variable">Random Variable</h1><h2 id="bayesian">Bayesian</h2><h2 id="mathematics">Mathematics</h2><h1 id="references">References</h1><ol type="1"><li>æœ±å›½å¯Œ, 2015. æ•°å€¼å¤©æ°”é¢„æŠ¥ä¸­åˆ†æåŒåŒ–åŸºæœ¬æ–¹æ³•çš„å†å²å‘å±•è„‰ç»œå’Œè¯„è¿°. æ°”è±¡, 41(8): 986-996. DOI: 10.7519/j.issn.1000-0526.2015.08.008.</li><li>æœ±å›½å¯Œ, 2015. ç†è§£å¤§æ°”èµ„æ–™åŒåŒ–çš„æ ¹æœ¬æ¦‚å¿µ[J]. æ°”è±¡, 41(4): 456-463. DOI:10.7519/j.issn.1000-0526.2015.04.008</li><li><a href="https://indico.cern.ch/event/289770/contributions/664473/attachments/541326/746202/DA_CERN_Perianez.pdf">2014: Data Assimilation in Numerical Weather Prediction models</a></li><li><a href="https://www.cwa.gov.tw/Data/climate/Info/lectures/100/20180517_Chen.pdf">2018: ä¸­å¤®æ°£è±¡å±€å…¨çƒè³‡æ–™åŒåŒ–ç³»çµ±</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>DA</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NWP</tag>
      
      <tag>WRF</tag>
      
      <tag>MPAS</tag>
      
      <tag>DA</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ML | ONNX Open Neural Network Exchange</title>
    <link href="/2024/09/23/ONNX/"/>
    <url>/2024/09/23/ONNX/</url>
    
    <content type="html"><![CDATA[<h1 id="onnx-open-neural-network-exchange">ONNX Open Neural Network Exchange</h1><p>ONNX is an open format built to represent machine learning models. ONNX defines a common set of operators - the building blocks of machine learning and deep learning models - and a common file format to enable AI developers to use models with a variety of frameworks, tools, runtimes, and compilers.</p><ul><li>ONNX was originally named Toffee and was developed by the PyTorch team at Facebook. In September 2017 it was renamed to ONNX and announced by Facebook and Microsoft. Later, IBM, Huawei, Intel, AMD, Arm and Qualcomm announced support for the initiative.</li><li>In October 2017, Microsoft announced that it would add its Cognitive Toolkit and Project Brainwave platform to the initiative.</li><li>In November 2019 ONNX was accepted as graduate project in Linux Foundation AI.</li><li>In October 2020 Zetane Systems became a member of the ONNX ecosystem.</li></ul><p>éš¨è‘—æ·±åº¦å­¸ç¿’æŠ€è¡“çš„ç™¼å±•ï¼Œè¶Šä¾†è¶Šå¤šçš„æ¡†æ¶è¢«é–‹ç™¼å‡ºä¾†ä»¥æ»¿è¶³ä¸åŒçš„éœ€æ±‚ã€‚ç„¶è€Œï¼Œä¸åŒçš„æ¡†æ¶ä¹‹é–“ç¼ºä¹äº’é€šæ€§å¯èƒ½æœƒé™åˆ¶æ¨¡å‹çš„éƒ¨ç½²å’Œé·ç§»èƒ½åŠ›ã€‚ Open Neural Network Exchange (ONNX) æ ¼å¼æ—¨åœ¨è§£æ±ºé€™å€‹å•é¡Œï¼Œå®ƒæä¾›äº†ä¸€ç¨®æ¨™æº–åŒ–çš„æ–¹æ³•ä¾†è¡¨ç¤ºæ©Ÿå™¨å­¸ç¿’æ¨¡å‹ï¼Œå¾è€Œå¯¦ç¾äº†ä¸åŒæ¡†æ¶ä¹‹é–“çš„æ¨¡å‹è½‰æ›å’Œå…±ç”¨ã€‚æœ¬æ–‡å°‡æ¢è¨å¦‚ä½•åœ¨ä¸åŒçš„æ·±åº¦å­¸ç¿’æ¡†æ¶ä¹‹é–“æœ‰æ•ˆç‡åœ°è½‰æ›å’Œéƒ¨ç½²æ¨¡å‹ï¼Œä¸¦æä¾›ä¸€äº›å¯¦éš›çš„ç¨‹å¼ç¢¼ç¯„ä¾‹ã€‚</p><p>ONNX æ˜¯ä¸€ç¨®é–‹æ”¾æ ¼å¼ï¼Œç”¨æ–¼è¡¨ç¤ºæ©Ÿå™¨å­¸ç¿’æ¨¡å‹ï¼Œæ”¯æ´å„ç¨®æ¡†æ¶ä¹‹é–“çš„æ¨¡å‹è½‰æ›ã€‚ ONNX æ”¯æ´å¤šç¨®å¸¸è¦‹çš„ç¥ç¶“ç¶²è·¯çµæ§‹å’Œæ“ä½œï¼ŒåŒ…æ‹¬å·ç©ã€æ± åŒ–ã€æ´»åŒ–å‡½æ•¸ç­‰ã€‚é€é ONNXï¼Œé–‹ç™¼è€…å¯ä»¥åœ¨ä¸€å€‹æ¡†æ¶ä¸­è¨“ç·´æ¨¡å‹ï¼Œç„¶å¾Œå°‡å…¶è½‰æ›ç‚º ONNX æ ¼å¼ï¼Œæœ€å¾Œåœ¨å¦ä¸€å€‹æ¡†æ¶ä¸­è¼‰å…¥ä¸¦åŸ·è¡Œã€‚</p><h1 id="pytorch">Pytorch</h1><p>PyTorch export model with ONNX format</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python">PyTorch åŒ¯å‡ºæ¨¡å‹<br><span class="hljs-keyword">import</span> torch<br><span class="hljs-keyword">import</span> torchvision.models <span class="hljs-keyword">as</span> models<br>å¾ torch.onnx <span class="hljs-keyword">import</span> export<br><br><span class="hljs-comment"># è¼‰å…¥é å…ˆè¨“ç·´çš„ ResNet-18 æ¨¡å‹</span><br>model = models.resnet18(pretrained=<span class="hljs-literal">True</span>)<br>model.<span class="hljs-built_in">eval</span>()<br><br><span class="hljs-comment"># åŒ¯å‡ºæ¨¡å‹åˆ° ONNX æ ¼å¼</span><br>dummy_input = torch.randn(<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">224</span>, <span class="hljs-number">224</span>)<br>export(model, dummy_input, <span class="hljs-string">&quot;resnet18.onnx&quot;</span>, verbose=<span class="hljs-literal">True</span>, opset_version=<span class="hljs-number">11</span>)<br></code></pre></td></tr></table></figure><p>Loading ONNX models by PyTorch</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> onnxruntime <span class="hljs-keyword">as</span> ort<br><br><span class="hljs-comment"># è¼‰å…¥ ONNX æ¨¡å‹</span><br>ort_session = ort.InferenceSession(<span class="hljs-string">&quot;resnet18.onnx&quot;</span>)<br><br><span class="hljs-comment"># é è™•ç†è¼¸å…¥æ•¸æ“š</span><br>data = torch.randn(<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">224</span>, <span class="hljs-number">224</span>).numpy()<br><br><span class="hljs-comment"># é‹è¡Œæ¨¡å‹</span><br>ort_inputs = &#123;<br> ort_session.get_inputs()[<span class="hljs-number">0</span>].name: data&#125;<br>ort_outs = ort_session.run(<span class="hljs-literal">None</span>, ort_inputs)<br><br><span class="hljs-comment"># è¼¸å‡ºé æ¸¬çµæœ</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Output:&quot;</span>, ort_outs)<br></code></pre></td></tr></table></figure><h1 id="æœ€ä½³å¯¦è¸">æœ€ä½³å¯¦è¸</h1><ul><li>é¸æ“‡åˆé©çš„ ONNX ç‰ˆæœ¬ï¼šONNX ä¸æ–·æ›´æ–°ä»¥æ”¯æ´æ–°çš„æ“ä½œå’Œæ”¹é€²æ•ˆèƒ½ã€‚é¸æ“‡æœ€æ–°çš„ ONNX ç‰ˆæœ¬é€šå¸¸å¯ä»¥ç²å¾—æ›´å¥½çš„æ”¯æ´å’Œæ•ˆèƒ½ã€‚</li><li>é©—è­‰æ¨¡å‹è½‰æ›ï¼šè½‰æ›æ¨¡å‹å¾Œï¼Œæ‡‰ç¢ºä¿ ONNX æ¨¡å‹çš„è¡Œç‚ºèˆ‡åŸç”Ÿæ¨¡å‹ä¸€è‡´ã€‚å¯ä»¥é€éæ¯”è¼ƒå…©å€‹æ¨¡å‹åœ¨ç›¸åŒè¼¸å…¥ä¸Šçš„è¼¸å‡ºä¾†é€²è¡Œé©—è­‰ã€‚</li><li>æª¢æŸ¥æ¨¡å‹ç›¸å®¹æ€§ï¼šä¸æ˜¯æ‰€æœ‰çš„æ¡†æ¶éƒ½æ”¯æ´æ‰€æœ‰ ONNX æ“ä½œã€‚ç¢ºä¿ç›®æ¨™æ¡†æ¶æ”¯æ´ä½ çš„æ¨¡å‹ä¸­ä½¿ç”¨çš„æ“ä½œã€‚</li><li>æœ€ä½³åŒ–æ¨¡å‹ï¼šåœ¨åŒ¯å‡ºç‚º ONNX æ ¼å¼ä¹‹å‰ï¼Œè«‹è€ƒæ…®ä½¿ç”¨æ¡†æ¶æä¾›çš„å·¥å…·é€²è¡Œæ¨¡å‹æœ€ä½³åŒ–ï¼Œä¾‹å¦‚é‡åŒ–ã€å‰ªæç­‰ã€‚</li><li>æ–‡ä»¶å’Œæ¸¬è©¦ï¼šè¨˜éŒ„è½‰æ›éç¨‹ä¸­çš„é‡è¦æ­¥é©Ÿï¼Œä¸¦é€²è¡Œå……åˆ†çš„æ¸¬è©¦ä»¥ç¢ºä¿æ¨¡å‹çš„æ­£ç¢ºæ€§å’Œæ•ˆèƒ½ã€‚</li></ul><h1 id="references">References</h1><ol type="1"><li><a href="https://onnx.ai/">https://onnx.ai/</a></li><li><a href="https://developer.aliyun.com/article/1598009">ONNX æ¨¡å‹äº’æ“ä½œæ€§çš„æœ€ä½³å®è·µ</a></li><li><a href="https://learn.microsoft.com/zh-tw/azure/machine-learning/concept-onnx?view=azureml-api-2">ONNX èˆ‡ Azure Machine Learning</a></li><li><a href="https://datawhalechina.github.io/thorough-pytorch/%E7%AC%AC%E4%B9%9D%E7%AB%A0/9.1%20%E4%BD%BF%E7%94%A8ONNX%E8%BF%9B%E8%A1%8C%E9%83%A8%E7%BD%B2%E5%B9%B6%E6%8E%A8%E7%90%86.html#id7">9.1 ä½¿ç”¨ONNXè¿›è¡Œéƒ¨ç½²å¹¶æ¨ç†</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>ML</category>
      
    </categories>
    
    
    <tags>
      
      <tag>AI</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HPC é«˜æ€§èƒ½è®¡ç®—å¹³å°</title>
    <link href="/2024/09/21/HPC/"/>
    <url>/2024/09/21/HPC/</url>
    
    <content type="html"><![CDATA[<h1 id="ç‚ºä»€éº¼-hpc-å¦‚æ­¤é‡è¦">ç‚ºä»€éº¼ HPC å¦‚æ­¤é‡è¦ï¼Ÿ</h1><p>é«˜æ•ˆèƒ½é‹ç®— (HPC) å·²ä¸æ˜¯æ–°é®®äº‹ã€‚æ•¸åå¹´ä¾†ï¼ŒHPC å·¥ä½œç«™å’Œè¶…ç´šé›»è…¦åœ¨å­¸è¡“ç ”ç©¶ä¸­æ‰®æ¼”è‘—ä¸å¯æˆ–ç¼ºçš„è§’è‰²ï¼Œè§£æ±ºäº†è¤‡é›œçš„å•é¡Œä¸¦æ¿€ç™¼äº†ç™¼ç¾å’Œå‰µæ–°ã€‚è¿‘å¹´ä¾†ï¼Œæ•¸æ“šé‡è¿…é€Ÿæ¿€å¢ï¼Œè¨±å¤šæ–°çš„æ‡‰ç”¨ç¨‹å¼å—ç›Šæ–¼ HPC çš„å¼·å¤§åŠŸèƒ½ï¼Œå³è·¨å…±äº«è³‡æºåŸ·è¡Œé‹ç®—å¯†é›†å‹æ“ä½œçš„èƒ½åŠ›ï¼Œç›¸è¼ƒæ–¼å‚³çµ±é‹ç®—ä»¥æ›´å°‘çš„æ™‚é–“å’Œæ›´ä½çš„æˆæœ¬ç²å¾—çµæœã€‚èˆ‡æ­¤åŒæ™‚ï¼ŒHPC ç¡¬é«”å’Œè»Ÿé«”è®Šå¾—æ›´å®¹æ˜“ç²å¾—ä¸¦ä¸”å»£æ³›åˆ†ä½ˆã€‚ç§‘å­¸å®¶ã€å·¥ç¨‹å¸«å’Œç ”ç©¶äººå“¡åœ¨ä¸€ç³»åˆ—ä½¿ç”¨æ¡ˆä¾‹ä¸­ä»°è³´è‘— HPCï¼ŒåŒ…æ‹¬å¤©æ°£é å ±ã€çŸ³æ²¹å’Œå¤©ç„¶æ°£å‹˜æ¢ã€ç‰©ç†å­¸ã€é‡å­åŠ›å­¸ä»¥åŠå­¸è¡“ç ”ç©¶å’Œå•†æ¥­æ‡‰ç”¨çš„å…¶ä»–é ˜åŸŸã€‚</p><p>å°æ–¼æ¯ä¸€å€‹æ¶‰åŠè¨ˆç®—çš„èª²é¡Œçµ„ä¾†èªªï¼Œè³¼è²·è¶…ç®—æ©Ÿæ™‚é‚„æ˜¯å»ºç«‹è‡ªå·±çš„ä¼ºæœå™¨é›†ç¾¤ï¼Œæˆç‚ºäº†æ¯å€‹èª²é¡Œçµ„çš„è€ƒé‡ã€‚ç­†è€…å»ºè­°èª²é¡Œçµ„é‡å°å°ˆæ¡ˆéœ€æ±‚ï¼Œå…©è€…éˆæ´»é…ç½®ï¼Œä¸å­˜åœ¨æ±é¢¨å£“å€’è¥¿é¢¨çš„èªªæ³•ï¼›å°æ–¼è¶…ç®—è³‡æºä¾†èªªï¼ŒçŸ­æ™‚é–“ä»¥è¼ƒå°çš„ç¶“è²»å°±å¯ä»¥æ’¬å‹•æ¥µå¤§çš„è¨ˆç®—è³‡æºï¼Œå°æ–¼å°ˆæ¡ˆé©—è­‰æˆ–ç·Šæ€¥çš„å°ˆæ¡ˆéœ€æ±‚éƒ½æ˜¯éå¸¸å¥½çš„è£œå……ï¼Œå°æ–¼è¨±å¤šå¤§å‹å°ˆæ¡ˆçš„é€²å±•ï¼Œæ²’æœ‰è¶…ç®—è«‡ä½•é–‹å±•ã€‚ç•¶ç„¶å›æ­¸åˆ°èª²é¡Œçµ„çš„å¯¦éš›éœ€æ±‚ï¼Œè‡ªå»ºä¼ºæœå™¨é›†ç¾¤æ‰æ˜¯æ¯å€‹èª²é¡Œçµ„æœ€åˆ’ç®—çš„ç®—åŠ›æŠ•è³‡ã€‚</p><h2 id="flops">FLOPS</h2><p>è¶…ç´šé›»è…¦é€Ÿåº¦ä»¥æ¯ç§’æµ®é»é‹ç®—æ¬¡æ•¸ <strong>"FLOPS" (floating-point operations per second)</strong>ä¾†ä½œé‡åº¦å–®ä½ï¼Œå¸¸è¦‹çš„è¡¨ç¤ºé›»è…¦ä¸­çš„å³°å€¼æˆ–é€Ÿåº¦ç”¨çš„å–®ä½è‹±æ¼¢å°ç…§å¦‚ä¸‹ï¼š</p><ul><li>ä¸€å€‹MFLOPSï¼ˆmegaFLOPSï¼‰ç­‰æ–¼æ¯ç§’100è¬ï¼ˆ=<span class="math inline">\(10^6\)</span>ï¼‰æ¬¡çš„æµ®é»é‹ç®—</li><li>ä¸€å€‹GFLOPSï¼ˆgigaFLOPSï¼‰ç­‰æ–¼æ¯ç§’10å„„ï¼ˆ=<span class="math inline">\(10^9\)</span>ï¼‰æ¬¡çš„æµ®é»é‹ç®—</li><li>ä¸€å€‹TFLOPSï¼ˆteraFLOPSï¼‰ç­‰æ–¼æ¯ç§’1å…†ï¼ˆ=<span class="math inline">\(10^{12}\)</span>ï¼‰æ¬¡çš„æµ®é»é‹ç®—</li><li>ä¸€å€‹PFLOPSï¼ˆpetaFLOPSï¼‰ç­‰æ–¼æ¯ç§’1åƒå…†ï¼ˆ=<span class="math inline">\(10^{15}\)</span>ï¼‰æ¬¡çš„æµ®é»é‹ç®—</li><li>ä¸€å€‹EFLOPSï¼ˆexaFLOPSï¼‰ç­‰æ–¼æ¯ç§’100äº¬ï¼ˆ=<span class="math inline">\(10^{18}\)</span>ï¼‰æ¬¡çš„æµ®é»é‹ç®—</li></ul><p>æ­¤å¤–ï¼Œç”±æ–¼æµ®é»ç©å’Œç†”åŠ é‹ç®—æˆ–ä¹˜ç©ç´¯åŠ æ˜¯å…©æ¬¡çš„æµ®é»é‹ç®—ï¼ˆæ¯æ¢FMAæŒ‡ä»¤åŒ…æ‹¬åŠ /æ¸›åŠä¹˜ï¼‰ï¼Œå› æ­¤ç•¶è™•ç†å™¨æ”¯æ´FMAæŒ‡ä»¤æ™‚ï¼Œå³°å€¼æ˜¯å…©å€æ¯ç§’æ‰€èƒ½åŸ·è¡ŒFMAæŒ‡ä»¤çš„æ•¸ç›®ã€‚</p><h2 id="top500">TOP500</h2><ul><li><a href="https://top500.org/" class="uri">https://top500.org/</a></li></ul><h1 id="æ–‡ç« ">æ–‡ç« </h1><h2 id="è¶…ç´šé›»è…¦çˆ­éœ¸æˆ°çš„æ–°ä¸€é é–‹å§‹äº†exascale10-çš„-18-æ¬¡æ–¹ä¹‹æˆ°-20220910"><a href="https://pansci.asia/archives/352429">è¶…ç´šé›»è…¦çˆ­éœ¸æˆ°çš„æ–°ä¸€é é–‹å§‹äº†ï¼šExascaleï¼ˆ10 çš„ 18 æ¬¡æ–¹ï¼‰ä¹‹æˆ° | 2022/09/10</a></h2><ul><li>è¶…ç´šé›»è…¦çš„æ¶æ§‹ï¼Œå¯ä»¥èªªæ˜¯éå¸¸çš„ç°¡å–®ï¼šç”¨ç¶²è·¯ç·šé€£çµå„å°ä¸»æ©Ÿï¼Œè®“ä¸»æ©Ÿé–“äº’ç›¸æºé€šï¼Œæ‰èƒ½å¤ é€²è¡Œå¹³è¡Œé‹ç®—ã€‚</li><li><strong>è€ƒé©—ç¡¬é«”çš„è™•ç†èƒ½åŠ›ã€ä¸»æ©Ÿé–“ç¯€é»çš„é€£ç·šæ¶æ§‹ã€è³‡æ–™è®€å¯«èƒ½åŠ›ï¼Œæ›´ç”šè€…ï¼Œå‰‡æ˜¯è»Ÿé«”æ˜¯å¦å…·æœ‰ Exascale çš„ä½¿ç”¨èƒ½åŠ›ï¼Œä¹Ÿå°±æ˜¯ç¡¬é«”èˆ‡è»Ÿé«”éƒ½å¿…é ˆè¦èƒ½å¤ è‰¯å¥½çš„å¥‘åˆæ‰è¡Œã€‚</strong></li><li>åœ°çƒç³»çµ±æ¨¡æ“¬ä¸­ï¼Œå…¶ä¸­ä¸€å€‹æŒ‘æˆ°ä¾¿æ˜¯é€²è¡Œæ¨¡æ“¬æ™‚ç¨‹ï¼šæŒ‘æˆ°ä¸€æ—¥ï¼ˆ24 å°æ™‚ï¼‰çš„è¶…ç´šé›»è…¦è¨ˆç®—å¯ä»¥å¾—åˆ°å¤šå°‘å¹´çš„æ¨¡æ“¬çµæœï¼ˆ<strong>simulated years per wall-clock day, SYPD</strong>ï¼‰ï¼Œè€Œæ­¤åœ°çƒç³»çµ±çš„ç²¾åº¦ç‚ºæ°´å¹³æ–¹å‘åƒ…ä¸€å…¬é‡Œçš„è¶…é«˜è§£æåº¦ï¼Œç”¨ä¾†é€²è¡Œæœ€çµ‚æ¥µçš„åœ°çƒç³»çµ±æ¨¡æ“¬ï¼š<strong>æ•¸ä½æ”£ç”Ÿï¼ˆDigital Twins</strong>ï¼‰ã€‚</li><li>Neumann ç­‰äººä¹Ÿé è¨ˆåœ¨ 2030 å¹´ä»£å¾Œï¼Œé€²è¡Œ 1 å…¬é‡Œç­‰ç´šçš„è¶…é«˜ç²¾åº¦è¨ˆç®—ä¹Ÿå°‡ä¸æ˜¯å¤¢æƒ³ï¼Œè€Œåœ¨ Exascale ä¸»æ©Ÿé™è‡¨å‰çš„é€™å€‹å¹´ä»£ï¼Œæœ‰äº›è¶…ç´šè¨ˆç®—ä¸­å¿ƒå·²ç¶“ä»¥ç¯€é»ï¼ˆNodeï¼‰åšç‚ºè¨ˆç®—è³‡æºè€—è²»çš„å–®ä½ï¼ˆ<strong>Node per hour</strong>ï¼‰ï¼Œè€Œé CPU per hourï¼Œé¡¯ç¤ºå‡ºå¤§å‹ä¸»æ©Ÿå°è¨ˆç®—è³‡æºæ¶ˆè€—çš„æƒ³æ³•ä»¥å¾ CPU è¦æ¨¡ä¸Šå‡åˆ°äº† Node è¦æ¨¡ã€‚</li></ul><div class="note note-danger">            <p>ç›®å‰å·²ç¶“æœ‰éƒ¨ä»½è¶…ç´šé›»è…¦éƒ½åœ¨é€²è¡Œ SYPD çš„æŒ‘æˆ°ï¼Œå¦‚ä¸­åœ‹çš„ç¥å¨å¤ªæ¹–ä¹‹å…‰ï¼Œå…¶å·²å®Œæˆäº†æ¯æ—¥ 3.4 å¹´çš„åœ°çƒç³»çµ±æ¨¡æ“¬ï¼Œåªä¸éå…¶åœ°é¢åƒ…æœ‰ 25 å…¬é‡Œçš„æ°´å¹³ç²¾åº¦ï¼Œæµ·é¢åƒ… 10 å…¬é‡Œçš„æ°´å¹³ç²¾åº¦ï¼Œé‚„æœ‰éå¸¸å¤šçš„é€²æ­¥ç©ºé–“ã€‚åªå¯æƒœï¼Œé€™å€‹å¯¦é©—ä¸¦æ²’æœ‰é€²è¡Œé€²è¡Œè³‡æ–™è¼¸å‡ºï¼Œç„¡æ³•å¾—åˆ°æ­£ç¢ºçš„æ•ˆèƒ½çµæœï¼ˆè³‡æ–™çš„å¯«å…¥èˆ‡è¼¸å‡ºä¹Ÿæ˜¯éå¸¸è²»æ™‚çš„ï¼‰ï¼Œä»¥åŠçœŸæ­£çš„é‹ç®—çµæœï¼šå› ç‚ºæ²’æœ‰è³‡æ–™ï¼Œå°±æ²’æœ‰è¾¦æ³•åˆ†æã€‚</p>          </div><h1 id="è¶…ç®—-åƒ¹æ ¼">è¶…ç®—: åƒ¹æ ¼</h1><p>è¶…ç®—ä¸­å¿ƒç”¢å“çš„ç‰¹é»ï¼šå®Œå‚™çš„è»Ÿé«”é‹è¡Œç’°å¢ƒåŠè±å¯Œçš„è»Ÿé«”é¸æ“‡ï¼Œç©©å®šçš„æŠ€è¡“æ”¯æŒï¼ŒæŒ‰éœ€ä½¿ç”¨ï¼Œéˆæ´»å……å€¼ï¼›ç¼ºé»ï¼šæ˜‚è²´ä¸”ä¸æ˜“æ–¼ç®¡ç†ï¼Œå®¹æ˜“ä¸çŸ¥ä¸è¦ºå°±æ¶ˆè€—äº†å¯¶è²´çš„ç§‘ç ”ç¶“è²»ï¼ˆç­†è€…æ¥è§¸éèª²é¡Œçµ„è³¼ç½®æ•¸è¬æ©Ÿæ™‚ï¼Œæ²’æœ‰æœ‰æ•ˆç®¡ç†ï¼Œå­¸ç”Ÿå­¸ç¿’èˆ‡è©¦èª¤çš„éç¨‹ä¸­ï¼Œå°±æ¶ˆè€—æ®†ç›¡ï¼›ï¼‰</p><ul><li>1æ¯› = 1/10å…ƒ (äººæ°‘å¹£)</li><li>è¶…ç®—ä¸­å¿ƒåƒ¹æ ¼åŸºæœ¬ä¸Šåœ¨0.1-0.3å…ƒä¸€å€‹æ ¸æ™‚(äººæ°‘å¹£)ï¼Œå–®åƒ¹çœ‹èµ·ä¾†é‚„æ˜¯ä¸è²´ã€‚</li><li>é€šå¸¸è¶…ç®—ä¸­å¿ƒä¸­ä¸»æµçš„64æ ¸å¿ƒç¯€é»ï¼Œä¸€èˆ¬å–®åƒ¹åœ¨0.1å…ƒæ¯æ ¸å¿ƒæ™‚ï¼ŒåŸºæ–¼æ­¤è¨ˆç®—ä¸€å°64æ ¸å¿ƒçš„ä¼ºæœå™¨é•·æœŸç§Ÿç”¨ï¼Œä»–çš„æˆæœ¬å°‡æœƒæ˜¯ï¼š</li><li>æ¯å¤©çš„è²»ç”¨ï¼š64x0.1x24=153.6å…ƒï¼›æ¯å¹´çš„è²»ç”¨å¯èƒ½é«˜é”56064å…ƒï¼›ç›®å‰ä¸€å°è¶…ç®—ä¸­å¿ƒçš„64æ ¸å¿ƒç¯€é»ï¼ŒåŸºæœ¬å¸‚å ´åƒ¹æ ¼ä¹Ÿå°±åœ¨5è¬å·¦å³ï¼›æˆ‘å€‘ä¹Ÿæ ¸ç®—éå„é¡ä¼ºæœå™¨é…ç½®ï¼ŒåŸºæœ¬ä¸Šè¶…ç®—åŒé¡çš„é‹ç®—ä¼ºæœå™¨ï¼Œç§Ÿè³ƒ1å¹´çš„è²»ç”¨ï¼Œå°±ç­‰æ–¼æ‚¨è¨‚è³¼é€™å°ä¼ºæœå™¨è²»ç”¨äº†ã€‚</li><li>é¡¯ç„¶å¾é•·æœŸä½¿ç”¨é‹ç®—è³‡æºçš„è§’åº¦ä¾†èªªï¼Œé¡¯ç„¶è‡ªå»ºè‡ªå·±çš„ä¼ºæœå™¨å¢é›†æ˜¯èª²é¡Œçµ„æ›´åˆ’ç®—çš„é¸æ“‡ã€‚</li><li>å…¶æ¬¡ï¼šè‡ªæœ‰çš„ä¼ºæœå™¨è³‡æºï¼Œå¯ä»¥åšåˆ°æ›´éˆæ´»çš„ä½¿ç”¨ï¼Œè»Ÿé«”å®‰è£ä¹Ÿéå¸¸è‡ªç”±ï¼›æ–‡ä»¶è³‡æ–™æœ¬åœ°å­˜å„²ï¼Œä½¿ç”¨å¿«æ·ç°¡æ˜“ç­‰å„ªé»ã€‚</li></ul><p>é¦–å…ˆè¯´ç°åœ¨çš„è¶…ç®—ä»·æ ¼ï¼š<a href="https://www.zhihu.com/question/523757254/answer/2530239695?utm_psn=1821112184379412482">link</a></p><ul><li>ä»¥åŒ—äº¬è¶…çº§äº‘è®¡ç®—ä¸­å¿ƒä¸ºä»£è¡¨çš„ï¼Œä¸»æµè¶…ç®—ä¸­å¿ƒï¼Œä»·æ ¼é€šå¸¸ä¸è¶…è¿‡0.1å…ƒæ¯æ ¸æ—¶ï¼ˆææ´»åŠ¨çš„æ—¶å€™0.08å…ƒå·¦å³ï¼‰ï¼ŒæŒ‰ç…§é¢˜ä¸»æè¿°ï¼Œ10ä¸‡æ ¸æ—¶çº¦éœ€è¦8000~1ä¸‡å…ƒã€‚è®ºæ€§ä»·æ¯”çš„è¯ï¼Œ</li><li>æˆ‘æ›´æ¨èä¸€äº›ä¸å¤ªçŸ¥åçš„ï¼Œä»·æ ¼ä»0.05åˆ°0.08å…ƒæ¯æ ¸æ—¶ä¸ç­‰ã€‚</li><li>å…¶æ¬¡ï¼Œé¢˜ä¸»æè¿°çš„10ä¸‡æ ¸æ—¶åº”è¯¥æ˜¯æŒ‰ç…§è‡ªå·±çš„18æ ¸è‡³å¼ºè®¡ç®—å‡ºæ¥çš„ã€‚ä¸åŒCPUçš„æ€§èƒ½å·®è·å¾ˆå¤§ï¼Œä¸¾ä¸ªä¾‹å­ï¼Œ<strong>AMD 7601è®¡ç®—1å°æ—¶çš„ï¼ŒAMD 7452å¯èƒ½40åˆ†é’Ÿç”šè‡³åŠå°æ—¶å°±ç®—å®Œäº†</strong>ã€‚æœ€åï¼Œè®¨è®ºä¸‹è‡ªå·±æ­æœºå™¨ä¸ç§Ÿè¶…ç®—çš„ä¼˜ç¼ºç‚¹ã€‚è‡ªå·±æ­å»ºæœºå™¨ï¼Œè‚¯å®šæ— æ³•å…¼é¡¾æ€§èƒ½ä¸ä»·æ ¼ï¼Œä¾‹å¦‚é¢„ç®—6000ä»¥å†…çš„è¯ï¼Œä¼°è®¡åªèƒ½ä¹°1å°åŒè·¯AMD 7601ï¼Œå¯èƒ½æ— æ³•æ»¡è¶³çŸ­æ—¶é—´å†…ç®—å®Œå…¨éƒ¨ç®—ä¾‹çš„éœ€æ±‚ã€‚å¥½å¤„å°±æ˜¯æœºå™¨å®æ‰“å®çš„æ˜¯è‡ªå·±çš„ï¼Œè¿™10ä¸‡æ ¸æ—¶çš„ä»»åŠ¡ç®—å®Œäº†ä»¥åï¼Œæœºå™¨è¿˜å¯ä»¥å¹²åˆ«çš„ç”¨é€”ï¼Œç”šè‡³å–äº†å›è¡€ä¹Ÿå¯ä»¥ã€‚è€Œè¶…ç®—ä¸ä¹‹ç›¸åï¼Œå¯ä»¥æä¾›æœ€é«˜çš„ç®—åŠ›ï¼Œæ»¡è¶³çŸ­æœŸå†…å¤§é‡çš„è®¡ç®—éœ€æ±‚ã€‚ç¼ºç‚¹å°±æ˜¯ç®—å®Œä»¥åè‡ªå·±å•¥éƒ½ç•™ä¸ä¸‹ã€‚</li></ul><p>å®é™…ä¸Šå¹¶è¡Œç§‘æŠ€æ—©å°±å·²ç»å°†è¶…ç®—å•†ä¸šåŒ–äº†ï¼Œå¯¹äºæ™®é€šäººä¹Ÿéå¸¸å‹å¥½ã€‚æˆ‘æœ‰ä¸ªåŒå­¦ï¼Œè‡ªå·±æœ‰è®¡ç®—éœ€æ±‚ï¼Œä½†æ˜¯è¯¾é¢˜ç»„å…¶ä»–äººæ²¡å…´è¶£ï¼Œå¥¹å°±è‡ªè´¹åªå……äº†100å—é’±å°±å¤Ÿç”¨äº†ã€‚å°±åƒå……è¯è´¹ä¸€æ ·ç®€å•ï¼Œä½¿ç”¨ä¹Ÿéå¸¸æ–¹ä¾¿ï¼Œè¶…ç®—å°±æ˜¯ä¸€å°è¿œç¨‹linuxç”µè„‘ï¼Œè¿œæ²¡æœ‰å¤šæ•°äººæƒ³è±¡çš„å¤šä¹ˆé«˜å†·ç¥ç§˜ã€‚<a href="https://www.zhihu.com/question/280917515/answer/1487285453">Link</a></p><p>ä¾‹å­:</p><ul><li>10ä¸‡æ ¸æ—¶ï¼Œ0.1å…ƒæ¯æ ¸æ—¶ï¼Œéœ€è¦1ä¸‡äººæ°‘å¸ã€‚</li></ul><h2 id="é›†ç¾¤">é›†ç¾¤</h2><ul><li><a href="http://www.chinahpc.com/">åŒ—äº¬ä¸œæ–¹è¶…ç®—ç§‘æŠ€æœ‰é™å…¬å¸, ChinaHPC</a><ul><li>æˆç«‹äº2013å¹´ï¼Œåˆ›å§‹å›¢é˜Ÿæ¥è‡ªäºåŒ—äº¬å¸‚è®¡ç®—ä¸­å¿ƒå’Œä¸­å›½ç§‘å­¦é™¢è¶…çº§è®¡ç®—ä¸­å¿ƒï¼Œæ³¨å†Œèµ„é‡‘1000ä¸‡å…ƒï¼Œåè½åœ¨åŒ—äº¬å¸‚æµ·æ·€åŒºä¸Šåœ°ä¿¡æ¯äº§ä¸šåŸºåœ°ã€‚</li><li><a href="http://www.chinahpc.cn/">ä¸œæ–¹è¶…ç®—äº‘</a><ul><li>ä¸œæ–¹è¶…ç®—äº‘çš„å¤§è§„æ¨¡ç®—åŠ›é›†ç¾¤ä½äºå…¨å›½ä¸€ä½“åŒ–ç®—åŠ›ç½‘ç»œå›½å®¶æ¢çº½èŠ‚ç‚¹<strong>å†…è’™å¤è‡ªæ²»åŒº</strong></li><li>ä¸€æœŸå»ºè®¾360ä¸ª18KWé«˜å¯†åº¦æœºæŸœï¼Œè®¡ç®—èŠ‚ç‚¹2000å°ï¼Œ56000CPUæ ¸å¿ƒï¼Œ20PBåˆ†å¸ƒå¼å¹¶è¡Œå­˜å‚¨å®¹é‡</li><li><a href="https://cloud.chinahpc.cn/#/login">Login website</a></li><li>å…¬å…±è®¡ç®—å¹³å°æœåŠ¡èµ„æº<ul><li><strong>AåŒºèµ„æºï¼ˆ0.1å…ƒæ ¸å¿ƒå°æ—¶ï¼‰</strong>; é¢å‘HPCã€AIå®¢æˆ·; 160èŠ‚ç‚¹; å¤„ç†å™¨:2*IntelÂ® XeonÂ® Platinum 9242 Processorï¼ˆ48æ ¸å¿ƒã€96çº¿ç¨‹ã€åŸºç¡€ä¸»é¢‘2.3GHzï¼‰; å†…å­˜ï¼š24x16GB 2933MHzï¼Œå…±384GB</li><li><strong>BåŒºèµ„æºï¼ˆ0.08å…ƒæ ¸å¿ƒå°æ—¶ï¼‰</strong>ï¼šé¢å‘å¤§è§„æ¨¡åˆ†å¸ƒå¼å¹¶è¡Œï¼Œè¿½æ±‚æ€§ä»·æ¯”ç”¨æˆ·; 1000èŠ‚ç‚¹; å¤„ç†å™¨ï¼š IntelÂ® XeonÂ® Processor E5-2680 v4 ï¼ˆ28æ ¸å¿ƒï¼ŒåŸºç¡€ä¸»é¢‘2.4GHzï¼Œæœ€å¤§ç¿é¢‘3.3GHz); å†…å­˜ï¼š8*16GB ,å…±128GB å†…å­˜; ç½‘ç»œï¼šMellanox FDR 56Gb Infiniband</li></ul></li></ul></li></ul></li><li><a href="https://www.nscc-tj.cn/">å›½å®¶è¶…çº§è®¡ç®—å¤©æ´¥ä¸­å¿ƒ, å¤©æ²³ä¸€å·</a><ul><li>ä¸­åœ‹äººæ°‘è§£æ”¾è»åœ‹é˜²ç§‘å­¸æŠ€è¡“å¤§å­¸å’Œå¤©æ´¥æ¿±æµ·æ–°å€æä¾›çš„ç•°æ§‹è¶…ç´šé›»è…¦</li><li>å•Ÿç”¨æ™‚é–“: å¤©æ²³-1ï¼š2009å¹´10æœˆ29æ—¥ï¼Œå¤©æ²³-1Aï¼š2010å¹´10æœˆ28æ—¥</li><li>å¤©æ²³-1Aä½¿ç”¨çš„é–‹æºè»Ÿé«”åŒ…æ‹¬ï¼šLinuxä½œæ¥­ç³»çµ±ï¼ŒSLURMä½œæ¥­èª¿åº¦ç³»çµ±ï¼ŒLustreå¢é›†æª”æ¡ˆç³»çµ±</li><li>0.07å…ƒ/æ ¸æ—¶ï¼Œé…ç½®ï¼šå•èŠ‚ç‚¹12æ ¸ , Intel Hexa Core Xeon X5670 ï¼›ä¸»é¢‘ 2.93GHz, å†…å­˜48Gï¼Œç§æœ‰é«˜é€Ÿç½‘ç»œï¼Œå…è´¹å­˜å‚¨1TB</li></ul></li><li><a href="http://nscc-gz.cn/Product/HighPerformanceComputingService/ServiceCharacteristics.html">å›½å®¶è¶…çº§è®¡ç®—å¹¿å·ä¸­å¿ƒ, å¤©æ²³äºŒå·</a><ul><li>ä¸­å±±å¤§å­¸å»£å·æ ¡å€æ±æ ¡åœ’</li><li>å•Ÿç”¨æ™‚é–“: 2013å¹´</li><li><code>å¤©æ²³äºŒå·</code>æ‹¥æœ‰çº¦<strong>17920ä¸ªè®¡ç®—èŠ‚ç‚¹</strong>ï¼Œæ¯èŠ‚ç‚¹é…å¤‡ä¸¤é¢—Xeon E5ç³»åˆ—12æ ¸å¿ƒçš„ä¸­å¤®å¤„ç†å™¨ã€ä¸‰ä¸ªXeon Phi 57æ ¸å¿ƒçš„åå¤„ç†å™¨ï¼ˆè¿ç®—åŠ é€Ÿå¡ï¼‰ï¼Œæ€»å†…å­˜å®¹é‡çº¦1.4PBï¼Œå…¨å±€å­˜å‚¨æ€»å®¹é‡çº¦12.4PBã€‚</li><li>0.1å…ƒ/æ ¸æ—¶ï¼Œé…ç½®ï¼šå•èŠ‚ç‚¹24æ ¸ , Intel Xeon E5-2692 v2 ï¼›ä¸»é¢‘ 2.2GHz, å†…å­˜64Gï¼Œå†…å­˜é¢‘ç‡ï¼šDDR3 1333MHzï¼Œå…è´¹å­˜å‚¨500GB</li><li><a href="https://www.gov.cn/xinwen/2015-11/18/content_2967705.htm">54.9PFLOPSï¼ˆç†è«–å³°å€¼ï¼‰, å®é™…è¿ç®—é€Ÿåº¦33.86PFlops</a></li><li><a href="https://itlanyan.com/tianhe-ii-guide/">å¤©æ²³äºŒå·ä½¿ç”¨æ•™ç¨‹</a></li></ul></li><li><a href="https://www.nscc-tj.cn/cjjs_zy_th3">å›½å®¶è¶…çº§è®¡ç®—å¤©æ´¥ä¸­å¿ƒåŒå›½é˜²ç§‘æŠ€å¤§å­¦è”åˆç ”åˆ¶, å¤©æ²³ä¸‰å·, ï¼ˆEçº§ï¼‰è¶…çº§è®¡ç®—æœº</a><ul><li>https://baike.baidu.com/item/%E5%A4%A9%E6%B2%B3%E4%B8%89%E8%99%9F/22052788</li><li><a href="https://www.weidunews.com/article/2024-02-18/1340.html">ç§‘æŠ€åª’ä½“è§£æ„ä¸­å›½è¿„ä»Šä¸ºæ­¢æœ€å¼ºå¤§çš„è¶…çº§è®¡ç®—æœº</a></li></ul></li><li><a href="https://nscc.hnu.edu.cn/info/1058/1063.htm">å›½å®¶è¶…çº§è®¡ç®—é•¿æ²™ä¸­å¿ƒ</a><ul><li>ä¸­å¿ƒæ‹¥æœ‰â€œå¤©æ²³â€ç³»åˆ—è¶…çº§è®¡ç®—æœºã€â€œå¤©æ²³Â·å¤©é©¬â€è®¡ç®—é›†ç¾¤ç­‰è®¡ç®—å¹³å°ã€‚å…¶ä¸­2022å¹´å»ºæˆçš„å¤©æ²³æ–°ä¸€ä»£ä¸»æœºç³»ç»Ÿé‡‡ç”¨å…¨å›½äº§è®¾å¤‡ï¼Œå³°å€¼è®¡ç®—æ€§èƒ½è¾¾200P Flopsï¼ˆ64 ä½ç²¾åº¦ï¼‰ï¼Œå¯æä¾›1000P Opsäººå·¥æ™ºèƒ½ç®—åŠ›ï¼ˆ16ä½ç²¾åº¦ï¼‰</li><li>â€œå¤©æ²³ä¸€å·â€é«˜æ€§èƒ½è®¡ç®—ç³»ç»Ÿ, å•èŠ‚ç‚¹é…ç½®ï¼š2*6æ ¸Intel Xeon Westmere EPï¼Œä¸»é¢‘2.93GHzï¼Œå†…å­˜48GBï¼Œ1å—Nvidia M2050 GPU</li><li>CPUï¼š0.10å…ƒ/æ ¸/å°æ—¶ï¼›GPUï¼š2å…ƒ/å—/å°æ—¶ï¼›çº¯CPUï¼ˆ120æ ¸åŒ…å¹´ï¼‰ï¼š5ä¸‡å…ƒ/å¹´ã€‚å«GPUï¼ˆ120æ ¸åŒ…å¹´ï¼‰ï¼š10ä¸‡å…ƒ/å¹´ã€‚<a href="https://nscc.hnu.edu.cn/info/1004/1414.htm">å›½å®¶è¶…çº§è®¡ç®—é•¿æ²™ä¸­å¿ƒ2019å¹´æ”¶è´¹åŸºæœ¬æ‰§è¡Œæ ‡å‡† 2019</a></li><li>å­˜å‚¨æœåŠ¡ï¼šå¤©æ²³å­˜å‚¨0.5ä¸‡å…ƒ/TB/å¹´ï¼›å…¶å®ƒå­˜å‚¨0.3ä¸‡å…ƒ/TB/å¹´</li></ul></li><li><a href="http://www.nsccsz.cn/nsccsz2024/index.shtml">å›½å®¶è¶…çº§è®¡ç®—æ·±åœ³ä¸­å¿ƒ(æ·±åœ³äº‘è®¡ç®—ä¸­å¿ƒ)</a><ul><li>æ·±åœ³è¶…ç®—ä¸€æœŸ, æ·±åœ³è¶…ç®—äºŒæœŸ</li><li>é«˜æ€§èƒ½è®¡ç®—é›†ç¾¤çº¦æœ‰3000ä½™è®¡ç®—èŠ‚ç‚¹ï¼ŒCPUçº¦70000æ ¸ï¼Œæ€»å†…å­˜å®¹é‡çº¦230TBï¼Œå…¨å±€å­˜å‚¨æ€»å®¹é‡çº¦20PB</li></ul></li><li><a href="https://www.nsccwx.cn/">ç¥å¨Â·å¤ªæ¹–ä¹‹å…‰</a><ul><li>å•Ÿç”¨æ™‚é–“: 2015å¹´12æœˆ31æ—¥</li><li>éƒ¨ç½²åœ¨æ±Ÿè˜‡çœç„¡éŒ«å¸‚çš„åœ‹å®¶è¶…ç´šè¨ˆç®—ç„¡éŒ«ä¸­å¿ƒï¼Œç”±æ¸…è¯å¤§å­¸è² è²¬ç‡Ÿé‹</li><li>æ•´æœºå¤„ç†å™¨ä¸ªæ•° 40960ä¸ª</li><li>å³°å€¼æ€§èƒ½ä¸º 125.436 PFlops</li><li>å®ƒçš„æµ®ç‚¹è¿ç®—é€Ÿåº¦è¾¾åˆ°äº† 90.83 PFlopsï¼ˆ1PFlopsä¸ºæ¯ç§’1åƒä¸‡äº¿æ¬¡æµ®ç‚¹è¿ç®—ï¼‰ï¼Œè¶…è¶Šç¬¬äºŒåâ€œå¤©æ²³äºŒå·â€ï¼ˆ33.06PFlopsï¼‰è¿‘ä¸¤å€ã€‚è€Œä¸”ï¼Œä¸â€œå¤©æ²³äºŒå·â€ä½¿ç”¨IntelèŠ¯ç‰‡æœ‰æ‰€ä¸åŒï¼Œå®ƒä½¿ç”¨çš„èŠ¯ç‰‡å…·æœ‰ä¸­å›½è‡ªä¸»çŸ¥è¯†äº§æƒã€‚<a href="https://www.cma.gov.cn/2011xwzx/2011xqxxw/2011xqxyw/201606/t20160622_314708.html">Link</a></li></ul></li><li><a href="http://www.blsc.cn/aboutus/">åŒ—äº¬è¶…çº§äº‘è®¡ç®—ä¸­å¿ƒ</a><ul><li>æˆç«‹äº2011å¹´ï¼Œä¸­å›½ç§‘å­¦é™¢å’ŒåŒ—äº¬å¸‚æ”¿åºœå…±å»ºï¼Œç”±åŒ—äº¬åŒ—é¾™è¶…çº§äº‘è®¡ç®—æœ‰é™è´£ä»»å…¬å¸è¿è¥</li><li>æ¨èä½¿ç”¨T6åŒºï¼Œé…ç½®ï¼šå•èŠ‚ç‚¹96æ ¸ï¼ŒæŒ‰æ ¸è®¡è´¹ï¼ŒIntel Xeon Platinum 9242@2.3GHzï¼Œ384Gå†…å­˜ï¼Œ100Gps é«˜é€Ÿç½‘ï¼Œå…è´¹å­˜å‚¨500Gï¼Œä»·æ ¼1æ¯›/æ ¸æ—¶=0.1/æ ¸æ—¶ã€‚ï¼ˆç”¨çš„å¤šä¼šæœ‰ä¸€äº›æŠ˜æ‰£ï¼‰</li></ul></li><li><a href="https://hpc.pku.edu.cn/about.html">åŒ—äº¬å¤§å­¦é«˜æ€§èƒ½è®¡ç®—æ ¡çº§å…¬å…±å¹³å°</a><ul><li><a href="https://hpc.pku.edu.cn/ug/">åŒ—äº¬å¤§å­¦é«˜æ€§èƒ½è®¡ç®—æ ¡çº§å…¬å…±å¹³å°ç”¨æˆ·æ–‡æ¡£</a></li><li>æ¯ä¸ªCPUæ—¶0.06å…ƒ, <a href="https://hpc.pku.edu.cn/guide_6.html">æ”¶è´¹æ ‡å‡†</a></li></ul></li><li><a href="http://hpc.ncpgr.cn/">ä½œç‰©é—ä¼ æ”¹è‰¯å…¨å›½é‡ç‚¹å®éªŒå®¤ç”Ÿç‰©ä¿¡æ¯è®¡ç®—å¹³å°</a><ul><li>ç”Ÿç‰©ä¿¡æ¯é«˜æ€§èƒ½è®¡ç®—å¹³å°ä¸ºåä¸­å†œä¸šå¤§å­¦ä½œç‰©é—ä¼ æ”¹è‰¯å…¨å›½é‡ç‚¹å®éªŒå®¤å…¬å…±æŠ€æœ¯å¹³å°ï¼Œä¸“æ³¨ä¸ºå®éªŒå®¤åŠå…¨æ ¡ç”¨æˆ·æä¾›é«˜é€šé‡æµ‹åºæ•°æ®çš„å­˜å‚¨å’Œè®¡ç®—æœåŠ¡ã€‚</li><li>å¹³å°ç”±155ä¸ªåˆ€ç‰‡è®¡ç®—èŠ‚ç‚¹ã€2ä¸ªGPUèŠ‚ç‚¹ã€6ä¸ªå…«è·¯å¤§å†…å­˜èƒ–èŠ‚ç‚¹ã€å¤šå¥—å¹¶è¡Œå­˜å‚¨ç»„æˆï¼Œæ€»ä½“è®¡ç®—èƒ½åŠ›ç†è®ºå³°å€¼ä¸º380ä¸‡äº¿æ¬¡ï¼ŒCPUæ ¸å¿ƒæ•°ä¸º5600æ ¸ï¼Œå­˜å‚¨ç¡¬ä»¶12.7PB(å¯ç”¨å®¹é‡8.8PB)ï¼Œä¸»å­˜å‚¨è¯»å†™å¸¦å®½è¶…è¿‡45GB/sã€‚å¹³å°é¢„è£…äº†1000ä½™æ¬¾å„ç±»ç”Ÿç‰©ä¿¡æ¯åˆ†æè½¯ä»¶åŠç›¸å…³ä½¿ç”¨æ–‡æ¡£ã€å„ç±»å¸¸ç”¨ç”Ÿç‰©ä¿¡æ¯æ•°æ®åº“ï¼Œç”¨æˆ·å¯ä½¿ç”¨æœ¬å¹³å°è¿›è¡Œè½¬å½•è°ƒæ§æµ‹åºã€å•ç»†èƒæµ‹åºã€ä¸‰ç»´åŸºå› ç»„æµ‹åºã€è¡¨è§‚ç»„æµ‹åºã€åŸºå› ç»„ç»„è£…æ³¨é‡Šç­‰å„ç±»å¸¸è§ç»„å­¦æ•°æ®åˆ†æã€‚å¯åŠ é€Ÿå¤§è§„æ¨¡é‡æµ‹åºæ•°æ®åˆ†æã€å¤æ‚å¤§åŸºå› ç»„ç»„è£…æ³¨é‡Šç­‰éœ€æ¶ˆè€—å¤§é‡èµ„æºçš„åˆ†æé¡¹ç›®ã€‚</li><li>æ¯ä¸ªCPUæ—¶0.1å…ƒï¼Œå¹¶è¡Œå­˜å‚¨ç©ºé—´æ¯GBæ¯æœˆ0.05å…ƒã€‚é‡ç‚¹å®¤ç”¨æˆ·3æŠ˜ï¼›é‡ç‚¹å®éªŒå®¤ä¹‹å¤–çš„ç”¨æˆ·ä¸æ‰“æŠ˜ã€‚æ ¹æ®ç”¨æˆ·ä¸ŠæŠ¥çš„ä¸Šä¸€å¹´åº¦çš„æ–‡ç« ï¼Œå†³å®šæœ¬å¹´åº¦çš„é›†ç¾¤æœºæ—¶æŠ˜æ‰£ã€‚</li></ul></li><li><a href="https://hpc.whu.edu.cn/index.htm">æ­¦æ±‰å¤§å­¦è¶…çº§è®¡ç®—ä¸­å¿ƒ</a><ul><li>ç”±475å°CPUæœåŠ¡å™¨ã€168å°KNLæœåŠ¡å™¨å’Œ174å°GPUæœåŠ¡å™¨ç»„æˆ</li><li>æ­¦æ±‰å¤§å­¦è¶…çº§è®¡ç®—ä¸­å¿ƒæ”¶è´¹åŠæ³•ï¼ˆè¯•è¡Œï¼‰2024å¹´03æœˆ29æ—¥ <a href="https://hpc.whu.edu.cn/info/1008/1057.htm">link</a></li><li>æ™®é€šèŠ‚ç‚¹ ç”¨æˆ·ç±»å‹ CPUæœºæ—¶æ”¶è´¹æ ‡å‡†ï¼ˆå…ƒ/CPUæ ¸å°æ—¶ï¼‰æ ¡å†…ç”¨æˆ· 0.06; æ ¡å¤–ç”¨æˆ· 0.10 <a href="https://hpc.whu.edu.cn/info/1008/1057.htm">link</a></li><li>å­˜å‚¨ç©ºé—´ç§Ÿç”¨æœåŠ¡</li><li>ç”¨æˆ·ç±»å‹ æ”¶è´¹æ ‡å‡†ï¼ˆå…ƒ/Tå¹´) æ ¡å†…ç”¨æˆ· 120; æ ¡å¤–ç”¨æˆ· 500</li></ul></li><li><a href="https://scc.ustc.edu.cn/2010/0304/c386a1641/page.htm">ä¸­å›½ç§‘å­¦æŠ€æœ¯å¤§å­¦è¶…çº§è®¡ç®—ä¸­å¿ƒ</a><ul><li>ç€šæµ· 22 è¶…çº§è®¡ç®—ç³»ç»Ÿ, ç€šæµ· 20 è¶…çº§è®¡ç®—ç³»ç»Ÿ, æ›™å…‰ TC4600 ç™¾ä¸‡äº¿æ¬¡è¶…çº§è®¡ç®—ç³»ç»Ÿ</li><li><a href="https://scc.ustc.edu.cn/zlsc/user_doc/html/introduction/hanhai22-introduction.html">ä¸­å›½ç§‘å¤§è¶…ç®—ä¸­å¿ƒç”¨æˆ·ä½¿ç”¨æ‰‹å†Œ</a></li><li><a href="https://scc.ustc.edu.cn/2024/0228/c416a630736/page.htm">ä¸­å›½ç§‘å­¦æŠ€æœ¯å¤§å­¦è¶…çº§è®¡ç®—ä¸­å¿ƒæ”¶è´¹æ ‡å‡†2023å¹´11æœˆ15æ—¥ç‰ˆ</a></li><li>CPUèŠ‚ç‚¹ 0.02å…ƒ/CPUæ ¸å°æ—¶</li><li>å…è´¹ä½¿ç”¨1TBçš„å­˜å‚¨å®¹é‡ï¼Œè¶…è¿‡1TBåä¸º30.00å…ƒ/TBæœˆ</li><li>æ ¡å¤–ç”¨æˆ·æ”¶è´¹ä¸ºæ ¡å†…ç”¨æˆ·çš„3å€</li></ul></li><li><a href="https://sc.hdu.edu.cn/">æ­å·ç”µå­ç§‘æŠ€å¤§å­¦è¶…ç®—ä¸­å¿ƒ</a><ul><li>æ›™å…‰TC6000é«˜æ€§èƒ½è®¡ç®—é›†ç¾¤æœ‰CPUè®¡ç®—èŠ‚ç‚¹68ä¸ª</li><li><a href="https://sc.hdu.edu.cn/wp-content/uploads/2024/05/%E5%85%B3%E4%BA%8E%E5%85%AC%E5%B8%832024%E5%B9%B4%E5%BA%A6%E8%B6%85%E7%AE%97%E4%B8%AD%E5%BF%83%E6%94%B6%E8%B4%B9%E6%A0%87%E5%87%86%E7%9A%84%E9%80%9A%E7%9F%A5.pdf">å…³äºå…¬å¸ƒ 2024 å¹´åº¦è¶…ç®—ä¸­å¿ƒæ”¶è´¹æ ‡å‡†çš„é€šçŸ¥</a></li><li>æ ¡å†…ç”¨æˆ· CPU èŠ‚ç‚¹ 0.06 å…ƒï¼æ ¸Â·å°æ—¶; å­˜å‚¨ç©ºé—´ è¶…å‡º 200GB éƒ¨åˆ†ï¼Œæ¯100GB è´¹ç”¨ä¸º 10 å…ƒ/æœˆ</li><li>æ ¡å¤–ç”¨æˆ· CPU èŠ‚ç‚¹ 0.12 å…ƒï¼æ ¸Â·å°æ—¶; å­˜å‚¨ç©ºé—´ è¶…å‡º 200GB éƒ¨åˆ†ï¼Œæ¯100GB è´¹ç”¨ä¸º 20 å…ƒ/æœˆ</li></ul></li></ul>]]></content>
    
    
    <categories>
      
      <category>HPC</category>
      
    </categories>
    
    
    <tags>
      
      <tag>HPC</tag>
      
      <tag>NWP</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Singularity Container</title>
    <link href="/2024/09/21/Singularity-Container/"/>
    <url>/2024/09/21/Singularity-Container/</url>
    
    <content type="html"><![CDATA[<h1 id="what-is-singularity">What is Singularity</h1><p>Singularity is a container platform to run complex applications on HPC clusters in a simple, portable, and reproducible way. It supports Docker images and is an alternative to Docker, whose security model and execution mode are not well-suited in an HPC environment.</p><p>Major features:</p><ul><li>Verifiable reproducibility and security, using cryptographic signatures, an immutable container image format, and in-memory decryption.</li><li>Integration over isolation by default. Easily make use of GPUs, high speed networks, parallel filesystems on a cluster or server by default.</li><li>Mobility of compute. The single file SIF container format is easy to transport and share.</li><li>A simple, effective security model. You are the same user inside a container as outside, and cannot gain additional privilege on the host system by default.</li></ul><p>å®¹å™¨æ˜¯ä¸€ç¨®åœ¨éš”é›¢ç’°å¢ƒä¸­é‹è¡Œæ‡‰ç”¨ç¨‹å¼çš„æŠ€è¡“ã€‚èˆ‡å‚³çµ±è™›æ“¬æ©Ÿå™¨ ï¼ˆVMï¼‰ ç›¸æ¯”ï¼Œå®ƒå€‘å…·æœ‰å¤šé …å„ªå‹¢ï¼Œä¾‹å¦‚ æ›´å¿«çš„éƒ¨ç½²æ™‚é–“å’Œå¯é‡è¤‡æ€§ã€‚å®¹å™¨é‚„å…è¨±é–‹ç™¼äººå“¡å»ºç½®å’Œéƒ¨ç½²è»Ÿé«”ï¼Œç„¡éœ€æ“”å¿ƒåº•å±¤åŸºç¤è¨­æ–½æˆ–ä½œæ¥­ç³»çµ±è©³ç´°è³‡è¨Šã€‚åœ¨ç”Ÿç‰©è³‡è¨Šåˆ†æä¸­ï¼Œä½¿ç”¨Singularity å®¹å™¨æŠ€è¡“å…·æœ‰ä»¥ä¸‹å„ªé»ï¼š</p><ul><li>ç’°å¢ƒä¸€è‡´æ€§å’Œå¯é‡è¤‡æ€§ï¼šå°ˆæ¡ˆå¸¸å¸¸ä¾è³´ç‰¹å®šç‰ˆæœ¬çš„è»Ÿé«”å’Œå‡½å¼åº«ã€‚ Singularity å®¹å™¨å¯ä»¥å°‡è»Ÿé«”åŠå…¶ç›¸ä¾æ€§æ‰“åŒ…åœ¨ä¸€èµ·ï¼Œç¢ºä¿åˆ†æç’°å¢ƒçš„ä¸€è‡´æ€§ï¼Œç„¡è«–æ˜¯åœ¨æœ¬æ©Ÿã€ä¼ºæœå™¨æˆ–é›²ç«¯å¹³å°ã€‚é€™å°æ–¼å¯¦é©—çš„å¯é‡è¤‡æ€§è‡³é—œé‡è¦ï¼Œå› ç‚ºå®ƒä¿è­‰äº†å…¶ä»–ç ”ç©¶è€…å¯ä»¥æº–ç¢ºåœ°è¤‡è£½å¯¦é©—æ¢ä»¶ï¼Œé©—è­‰å’Œå¾©ç¾ç ”ç©¶çµæœã€‚</li><li>é«˜æ•ˆèƒ½é‹ç®—ï¼ˆHPCï¼‰å‹å–„ï¼šSingularity ç‰¹åˆ¥è¨­è¨ˆä¾†æ”¯æ´é«˜æ•ˆèƒ½é‹ç®—ç’°å¢ƒã€‚<strong>å®ƒå…è¨±ä½¿ç”¨è€…ä»¥éç‰¹æ¬Šæ–¹å¼é‹è¡Œå®¹å™¨ï¼Œèˆ‡ HPC ç³»çµ±çš„å®‰å…¨æ¨¡å‹ç›¸å®¹ã€‚é€™æ„å‘³è‘—ä½¿ç”¨è€…å¯ä»¥åœ¨ä¸éœ€è¦ç®¡ç†å“¡æ¬Šé™çš„æƒ…æ³ä¸‹éƒ¨ç½²å’ŒåŸ·è¡Œå®¹å™¨ï¼Œé€™å°æ–¼å¤šä½¿ç”¨è€…çš„HPCç’°å¢ƒæ˜¯éå¸¸é‡è¦çš„ã€‚</strong></li><li>ç§»æ¤æ€§ï¼šSingularity å®¹å™¨å¯ä»¥åœ¨ä»»ä½•æ”¯æ´ Singularity çš„ç³»çµ±ä¸Šé‹è¡Œï¼Œä¸å—ä½œæ¥­ç³»çµ±ç‰ˆæœ¬é™åˆ¶ã€‚é€™ç¨®é«˜åº¦çš„ç§»æ¤æ€§ç¢ºä¿äº†ç”Ÿç‰©è³‡è¨Šåˆ†æå¯ä»¥è¼•é¬†åœ°å¾ä¸€å€‹é‹ç®—ç’°å¢ƒé·ç§»åˆ°å¦ä¸€å€‹ï¼Œç„¡è«–æ˜¯å¾å€‹äººé›»è…¦åˆ°é›²ç«¯å¹³å°ï¼Œé‚„æ˜¯åœ¨ä¸åŒçš„ç ”ç©¶æ©Ÿæ§‹ä¹‹é–“å…±äº«ã€‚</li><li>è³‡æ–™å’Œè³‡æºå­˜å–ï¼šSingularity å®¹å™¨å¯ä»¥ç›´æ¥å­˜å–å®¿ä¸»æ©Ÿä¸Šçš„æª”æ¡ˆç³»çµ±å’Œç¶²çµ¡ï¼Œé€™ç°¡åŒ–äº†è³‡æ–™çš„ç®¡ç†å’Œå‚³è¼¸éç¨‹ã€‚å°æ–¼éœ€è¦è™•ç†å¤§é‡è³‡æ–™çš„ç”Ÿç‰©è³‡è¨Šåˆ†æä¾†èªªï¼Œèƒ½å¤ ç„¡ç¸«å­˜å–å¤–éƒ¨è³‡æ–™å„²å­˜éå¸¸é‡è¦ã€‚</li><li>å®‰å…¨æ€§ï¼šèˆ‡å…¶ä»–å®¹å™¨æŠ€è¡“ç›¸æ¯”ï¼ŒSingularity æä¾›äº†æ›´å¼·çš„å®‰å…¨ä¿éšœã€‚å®ƒé˜²æ­¢äº†å®¹å™¨å…§çš„ä½¿ç”¨è€…å–å¾—å®¿ä¸»æ©Ÿçš„ root æ¬Šé™ï¼Œæ¸›å°‘äº†å®‰å…¨é¢¨éšªã€‚é€™ä¸€é»å°æ–¼ç¢ºä¿ç”Ÿç‰©è³‡è¨Šå­¸è³‡æ–™çš„å®‰å…¨æ€§å°¤å…¶é‡è¦ï¼Œç‰¹åˆ¥æ˜¯åœ¨è™•ç†æ•æ„Ÿæˆ–å—ä¿è­·çš„è³‡æ–™æ™‚ã€‚</li></ul><p>From <a href="https://hpc.pku.edu.cn/_book/guide/soft/singularity.html">åŒ—äº¬å¤§å­¸é«˜æ•ˆèƒ½é‹ç®—å¹³å°</a>, <a href="https://hpc.pku.edu.cn/ug/guide/soft/singularity/">åŒ—äº¬å¤§å­¸é«˜æ•ˆèƒ½é‹ç®—æ ¡ç´šå…¬å…±å¹³å°ä½¿ç”¨è€…æ–‡æª”</a></p><p>å®¹å™¨æŠ€è¡“æ˜¯ä¸€ç¨®ä»¥æ‡‰ç”¨è»Ÿé«”ç‚ºä¸­å¿ƒçš„è™›æ“¬åŒ–æŠ€è¡“ã€‚ä»¥æ‡‰ç”¨è»Ÿé«”ç‚ºå–®å…ƒï¼Œå°‡è»Ÿé«”åŠæ‰€æœ‰çš„ä¾è³´æ€§æ‰“åŒ…æˆå®¹å™¨é¡åƒï¼Œæ‰“åŒ…å¾Œçš„å®¹å™¨é¡åƒå¯ç›´æ¥æ‹·è²åˆ°ä¸åŒçš„Linuxä¸»æ©Ÿä¸Šé‹ä½œã€‚é€éå®¹å™¨æŠ€è¡“ï¼Œå¯ä»¥å¾ˆå¥½çš„è§£æ±ºå®‰è£è»Ÿé«”æ™‚ï¼Œä¾è³´åº«çš„å®‰è£å•é¡Œã€è»Ÿé«”ç’°å¢ƒçš„éš”é›¢ä»¥åŠè»Ÿé«”ç’°å¢ƒçš„ç§»æ¤å•é¡Œã€‚</p><ul><li>Singularityç‚ºå‹å€«æ–¯ä¼¯å…‹åˆ©åœ‹å®¶å¯¦é©—å®¤é–‹ç™¼å°ˆé–€ç”¨æ–¼é«˜æ•ˆèƒ½é‹ç®—å ´æ™¯çš„å®¹å™¨æŠ€è¡“ï¼ŒSingularityå®Œå…¨åŸºæ–¼å¯ç§»æ¤æ€§é€²è¡Œè™›æ“¬åŒ–ï¼Œæ›´åŠ è¼•é‡ç´šï¼Œéƒ¨ç½²æ›´å¿«ï¼ŒSingularityç›®å‰è¢«å»£æ³›åœ°å„é«˜æ•ˆèƒ½é‹ç®—ä¸­å¿ƒã€‚</li><li>é€éSingularityä¾†æ»¿è¶³ä½œæ¥­é‹è¡Œçš„è»Ÿé«”ç’°å¢ƒï¼Œé¦–å…ˆæ˜¯å‰µå»ºæˆ–å–å¾—è»Ÿé«”é¡åƒï¼Œå†å°‡å‰µå»ºå¥½çš„è»Ÿé«”é¡åƒä¸Šå‚³åˆ°å¢é›†ä¸Šé‹è¡Œï¼›</li><li><strong>é€éSingularityå»ºç«‹è»Ÿé«”æ˜ åƒï¼Œéœ€è¦åœ¨æœ‰rootæ¬Šé™çš„Linuxä¸»æ©Ÿä¸Šï¼Œæˆ–æ˜¯åœ¨é…ç½®å¥½fakerootçš„Linuxä¸»æ©Ÿä¸Šä»¥ã€Œfakerootã€çš„èº«ä»½é€²è¡Œã€‚</strong></li></ul><p>ä½¿ç”¨å®¹å™¨éƒ¨ç½²å’Œä½¿ç”¨è»Ÿé«”ç’°å¢ƒçš„æ­¥é©Ÿå¦‚ä¸‹ï¼š å»ºæ§‹å®¹å™¨é¡åƒï¼Œå»ºæ§‹å®¹å™¨é¡åƒçš„æ–¹å¼æœ‰ä¸‰ç¨®ï¼š</p><ul><li>åœ¨æœ¬æ©Ÿæ“æœ‰ root æ¬Šé™çš„ Linux ä¸»æ©Ÿä¸Šå®‰è£ Singularityï¼Œ ä¸¦ä½¿ç”¨ Singularity éƒ¨ç½²å®¹å™¨é¡åƒï¼›</li><li>åœ¨æ”¯æ´ fakeroot çš„ä¼ºæœå™¨ä¸Šï¼Œä½¿ç”¨ Singularity éƒ¨ç½²å®¹å™¨é¡åƒï¼›</li><li>ç›´æ¥å¾å€‰åº«ä¸­æ‹‰å–å·²ç¶“å»ºç½®å¥½çš„å®¹å™¨é¡åƒï¼›</li><li>å°‡å®¹å™¨é¡åƒä¸Šå‚³åˆ°é›†ç¾¤ï¼Œé€é singularity æŒ‡ä»¤ä½¿ç”¨å»ºæ§‹å¥½çš„å®¹å™¨é¡åƒã€‚</li></ul><p>å®¹å™¨çš„å„ªé»å’Œç¼ºé»(ç›¸è¼ƒæ–¼ç·¨è­¯å®‰è£ä»¥åŠ conda å®‰è£ç®¡ç†è»Ÿé«”ï¼Œå®¹å™¨æœ‰å¹¾å€‹ååˆ†æ˜é¡¯çš„å„ªå‹¢)</p><p>å®¹å™¨çš„å„ªå‹¢</p><ul><li>å¯ç§»æ¤æ€§ï¼Œé€éå®¹å™¨éƒ¨ç½²å¥½é‹ç®—ç’°å¢ƒå¾Œï¼Œå¯ä»¥ç›´æ¥ä¸Šå‚³åˆ°ç¤¾æœƒä¸Šé«˜æ•ˆèƒ½é‹ç®—å¢é›†ä¸Šä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥ç›´æ¥å°‡å®¹å™¨é¡åƒåˆ†äº«çµ¦èª²é¡Œçµ„çš„å…¶ä»–æˆå“¡ç›´æ¥ä½¿ç”¨ï¼Œå¤§å¹…æ¸›å°‘äº†éƒ¨ç½²ç’°å¢ƒçš„æ™‚é–“ã€‚</li><li>å¯è¤‡ç¾æ€§ï¼Œå°¤å…¶æ˜¯ä¸€äº›ç”Ÿä¿¡è»Ÿé«”ï¼Œä¾è³´ä¸åŒçš„è¨ˆç®—å·¥å…·ï¼Œæ›å€‹äººå®‰è£ï¼Œé›–ç„¶å®‰è£çš„è»Ÿé«”ç‰ˆæœ¬ç›¸åŒï¼Œä½†æ˜¯ä¾è³´çš„è¨ˆç®—å·¥å…·ç‰ˆæœ¬ä¸åŒï¼Œéƒ½å¯èƒ½å°è‡´è¨ˆç®—çµæœå­˜åœ¨å·®ç•°ï¼Œè€Œå®¹å™¨çš„ä½¿ç”¨å¯ä»¥å¾ˆå¥½çš„é¿å…é€™å€‹å•é¡Œã€‚</li><li><strong>æ˜“ç®¡ç†ï¼Œä¸åŒå®¹å™¨ç›¸äº’éš”çµ•ï¼Œä¸å­˜åœ¨ä¾è³´è¡çªç­‰å•é¡Œï¼Œä¾‹å¦‚å¹³å°ä¸Šä½¿ç”¨conda æ‰“åŒ…äº†nclã€nco å’Œncviewï¼Œå› ç‚ºé€™äº›å·¥å…·åœ¨å®‰è£çš„æ™‚å€™åŒæ™‚ä¹Ÿæ‰“åŒ…äº†netcdf åº«ï¼Œå¦‚æœç”¨æˆ¶åœ¨ç·¨è­¯å¦‚cesm å’Œwrfç­‰ä¾è³´netcdf ç’°å¢ƒçš„è»Ÿé«”ï¼Œå¯èƒ½æœƒå°è‡´ç·¨è­¯å’Œä½¿ç”¨éç¨‹å‡ºç¾è¡çªã€‚</strong></li></ul><p>å®¹å™¨æœ‰è‘—é€™éº¼å¤šçš„å„ªé»ï¼Œæ•ˆèƒ½æè€—é‚„ä½ï¼Œæœ‰æ™‚å€™ç”šè‡³é‚„å„ªæ–¼è£¸æ©Ÿæ•ˆèƒ½ï¼Œæ˜¯å¦å°±ä»£è¡¨æ‰€ç”¨é‹ç®—è»Ÿé«”ç’°å¢ƒéƒ½é©åˆç”¨å®¹å™¨éƒ¨ç½²ï¼Ÿç­”æ¡ˆæ˜¯å¦å®šçš„ï¼Œå®¹å™¨å…¶å¯¦ä¹Ÿæœ‰ä¸€äº›ç¼ºé»éœ€è¦ä½¿ç”¨è€…ç•™æ„ï¼š</p><p>å®¹å™¨çš„ç¼ºé»</p><ul><li>ä½¿ç”¨é›£åº¦é«˜ï¼Œç›¸è¼ƒæ–¼è£¸æ©Ÿä¸Šå®‰è£å’Œä½¿ç”¨è»Ÿé«”ï¼Œå®¹å™¨æ¦‚å¿µçš„ç†è§£ã€æ¥å—é‚„æœ‰ä½¿ç”¨é‚„æ˜¯éœ€è¦ä¸€å®šé–€æª»çš„</li><li><strong>è·¨ç¯€é»æ‡‰ç”¨ç”±æ–¼è¦å‘¼å«å®¿ä¸»æ©Ÿçš„ mpi ï¼Œç›¸å®¹æ€§æœ‰ä¸€å®šçš„è¦æ±‚ï¼Œå¯ç§»æ¤æ€§éœ€è¦é©—è­‰ã€‚</strong> ç•¶ç„¶ï¼Œå¹³å°ä¹Ÿåœ¨è‡´åŠ›æ–¼è·¨ç¯€é»æ‡‰ç”¨å®¹å™¨åŒ–çš„æ¸¬è©¦èˆ‡æ‰“åŒ…</li><li><strong>æœ€ä½³åŒ–å•é¡Œï¼Œä¾‹å¦‚ç‚ºäº†è®“è»Ÿé«”é‹è¡Œæ›´å¿«ï¼ŒIntel ç·¨è­¯è»Ÿé«”éç¨‹ä¸­å¯èƒ½æœƒä½¿ç”¨-Host åƒæ•¸ï¼Œè®“ç·¨è­¯å™¨æ ¹æ“šä¸»æ©ŸCPU å‹è™Ÿé€²è¡ŒæŒ‡ä»¤å„ªåŒ–ï¼Œæˆ–è€…ç·¨è­¯éç¨‹ä¸­åŠ å…¥AVX512 çš„æ”¯æŒï¼Œé€™æ™‚å€™å¦‚æœå°‡é¡åƒç§»æ¤åˆ°èˆŠæ¬¾æ¶æ§‹çš„CPU ä¸»æ©Ÿä¸Šï¼Œå¯èƒ½æœƒå°è‡´é¡åƒç„¡æ³•æ­£å¸¸é‹ä½œè»Ÿé«”ç’°å¢ƒ</strong></li></ul><h1 id="sifsingularity-image-file-sandbox">SIFï¼ˆSingularity Image Fileï¼‰&amp; Sandbox</h1><p>å…©ç¨®å»ºç«‹å®¢è£½åŒ– image çš„æ–¹æ³•ã€‚Singularity çš„ image æ”¯æŒå…©ç¨®æ¨¡å¼ sif åŠ sandboxï¼Œå…©è€…æœ€å¤§çš„å·®ç•°å°±æ˜¯ sandbox æœƒä¿ç•™ç”¨æˆ¶åœ¨ç’°å¢ƒä¸­ï¼Œå®‰è£çš„è»Ÿé«”åŠè¨­å®šçš„åƒæ•¸ã€‚è€Œ sif å‰‡æ¯”è¼ƒæ¥è¿‘å”¯ç¨æ¨¡å¼ï¼Œåƒ…æä¾›ç’°å¢ƒé‹è¡Œæ‰€éœ€è¦çš„å¥—ä»¶ï¼Œä½†ç•¶é‹è¡ŒçµæŸå¾Œä¸æœƒä¿ç•™åœ¨éç¨‹ä¸­å®‰è£çš„å¥—ä»¶ã€‚</p><ul><li>SIFï¼ˆSingularity Image Fileï¼‰ï¼šå£“ç¸®çš„è®€ï¼ˆread-onlyï¼‰çš„Singularityé¡ä»¶ï¼Œæ˜¯â½£ç”¢ä½¿â½¤çš„ä¸»å½¢å¼ã€‚</li><li>Sandbox å¯ (writable)çš„å™¨åœ¨å½¢å¼ï¼Œæ˜¯ä»¶çµ±ä¸­çš„â¼€â½¬éŒ„ï¼Œå¸¸â½¤æ–¼é–‹ç™¼æˆ–å‰µå»ºâ¾ƒâ¼°çš„å®¹å™¨ï¼Œæ˜¯é–‹ç™¼ä½¿â½¤çš„ä¸»å½¢å¼ã€‚</li></ul><div class="note note-primary">            <p>SIF and sandbox images can be converted to each other.</p>          </div><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># 1. Convert the SIF format container to sandbox;</span><br>singularity build --sandbox centos76 centos76.sif<br><br><span class="hljs-comment"># 2. Convert the sandbox container image to SIF format;</span><br>singularity build centos76.sif centos76<br></code></pre></td></tr></table></figure><h2 id="singularity-container-image">Singularity Container Image</h2><p><a href="https://www.cuhk.edu.hk/itsc/hpc/singularity.html" class="uri">https://www.cuhk.edu.hk/itsc/hpc/singularity.html</a></p><div class="note note-primary">            <p>Note that Singularity versions prior to 3.0 used a slightly different image format, characterised by the extension .simg. You can still find these around in the web; newer Singularity versions are still able to run them.</p>          </div><p>By default, Singularity containers are <strong>read-only image file</strong> that usually end in <strong>.simg</strong>. You can copy the singuarity image file directly from others pre-build container with any copy file command like cp or scp. You can also pull the container from Docker Hub or Sinularity Hub repositories. Base on the container on the repositories, you may custom your own container desire for your job nature.</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#From Docker Hub</span><br>singularity pull docker://ubuntu:latest<br>singularity build centos7_python35.simg docker://centos/python-35-centos7<br>            <br><span class="hljs-comment">#From Singularity Hub</span><br>singularity pull shub://singularityhub/centos<br>singularity build tensorflow.simg shub://opensciencegrid/osgvo-tensorflow<br></code></pre></td></tr></table></figure><h1 id="installing-singularity-platform">Installing Singularity platform</h1><p><a href="https://docs.sylabs.io/guides/3.8/user-guide/quick_start.html" class="uri">https://docs.sylabs.io/guides/3.8/user-guide/quick_start.html</a></p><div class="note note-primary">            <p><strong>Docker and Singularity server installation requires root privileges</strong>, so you can choose to install Docker on your local personal computer to create an image, and then upload it to the server to run it with Singularity.</p>          </div><h2 id="install-development-libraries">install development libraries</h2><p>SingularityCE is a container platform. It allows you to create and run containers that package up pieces of software in a way that is portable and reproducible. You can build a container using SingularityCE on your laptop, and then run it on many of the largest HPC clusters in the world, local university or company clusters, a single server, in the cloud, or on a workstation down the hall. Your container is a single file, and you donâ€™t have to worry about how to install all the software you need on each different operating system.</p><p>SingularityCEçš„ä½¿ç”¨ä¸éœ€è¦ç®¡ç†å“¡æ¬Šé™,ä½†å®‰è£éœ€è¦ç®¡ç†å“¡æ¬Šé™</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ <span class="hljs-built_in">sudo</span> apt-get update &amp;&amp; <span class="hljs-built_in">sudo</span> apt-get install -y \<br>    build-essential \<br>    libssl-dev \<br>    uuid-dev \<br>    libgpgme11-dev \<br>    squashfs-tools \<br>    libseccomp-dev \<br>    wget \<br>    pkg-config \<br>    git \<br>    cryptsetup<br></code></pre></td></tr></table></figure><h2 id="install-go">Install Go</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ <span class="hljs-built_in">export</span> VERSION=1.16.4 OS=linux ARCH=amd64 &amp;&amp; \  <span class="hljs-comment"># Replace the values as needed</span><br>  wget https://dl.google.com/go/go<span class="hljs-variable">$VERSION</span>.<span class="hljs-variable">$OS</span>-<span class="hljs-variable">$ARCH</span>.tar.gz &amp;&amp; \ <span class="hljs-comment"># Downloads the required Go package</span><br>  <span class="hljs-built_in">sudo</span> tar -C /usr/local -xzvf go<span class="hljs-variable">$VERSION</span>.<span class="hljs-variable">$OS</span>-<span class="hljs-variable">$ARCH</span>.tar.gz &amp;&amp; \ <span class="hljs-comment"># Extracts the archive</span><br>  <span class="hljs-built_in">rm</span> go<span class="hljs-variable">$VERSION</span>.<span class="hljs-variable">$OS</span>-<span class="hljs-variable">$ARCH</span>.tar.gz    <span class="hljs-comment"># Deletes the ``tar`` file</span><br><br>$ <span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;export PATH=/usr/local/go/bin:$PATH&#x27;</span> &gt;&gt; ~/.bashrc &amp;&amp; \<br>  <span class="hljs-built_in">source</span> ~/.bashrc<br></code></pre></td></tr></table></figure><h2 id="download-singularityce-from-a-release">Download SingularityCE from a release</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ <span class="hljs-built_in">export</span> VERSION=3.8.1 &amp;&amp; <span class="hljs-comment"># adjust this as necessary \</span><br>    wget https://github.com/sylabs/singularity/releases/download/v<span class="hljs-variable">$&#123;VERSION&#125;</span>/singularity-ce-<span class="hljs-variable">$&#123;VERSION&#125;</span>.tar.gz &amp;&amp; \<br>    tar -xzf singularity-ce-<span class="hljs-variable">$&#123;VERSION&#125;</span>.tar.gz &amp;&amp; \<br>    <span class="hljs-built_in">cd</span> singularity-ce-<span class="hljs-variable">$&#123;VERSION&#125;</span><br></code></pre></td></tr></table></figure><p>then, Compile</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ ./mconfig &amp;&amp; \<br>    make -C builddir &amp;&amp; \<br>    <span class="hljs-built_in">sudo</span> make -C builddir install<br></code></pre></td></tr></table></figure><p>Finally, check</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ singularity --version<br>$ singularity <span class="hljs-built_in">help</span><br></code></pre></td></tr></table></figure><p>it has shown,</p><figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs vbnet">Linux container platform optimized <span class="hljs-keyword">for</span> High Performance Computing (HPC) <span class="hljs-built_in">and</span><br>Enterprise Performance Computing (EPC)<br><br><span class="hljs-symbol">Usage:</span><br>  singularity [<span class="hljs-keyword">global</span> options...]<br><br><span class="hljs-symbol">Description:</span><br>......<br></code></pre></td></tr></table></figure><h1 id="building-singularity-images">Building Singularity images</h1><div class="note note-primary">            <p>ç•¶é¡åƒåº«å¹³å°æ²’æœ‰æ‰¾åˆ°é©ç”¨çš„ç¾æˆé¡åƒï¼Œä½¿ç”¨è€…å¯ä»¥åœ¨æœ¬åœ°å°‡è»Ÿé«”æ‰“åŒ…æˆé¡åƒï¼Œä¸Šå‚³åˆ°è¶…ç®—ä¸Šé‹è¡Œã€‚<strong>è«‹æ³¨æ„ï¼Œä½¿ç”¨è€…åªèƒ½åœ¨è‡ªå·±çš„é›»è…¦ä¸Šè£½ä½œé¡åƒï¼Œä¸èƒ½åœ¨è¶…ç®—ä¸Šè£½ä½œé¡åƒã€‚</strong></p>          </div><h2 id="example-build-jedi-environment-with-singularity">Example: Build JEDI environment with Singularity</h2><p>From <a href="https://wiki.ucar.edu/display/JEDI/Build+JEDI+environment+with+Singularity" class="uri">https://wiki.ucar.edu/display/JEDI/Build+JEDI+environment+with+Singularity</a></p><h3 id="jcsda-singularity-latest">JCSDA-singularity-latest</h3><p>From <a href="https://singularityhub.github.io/singularityhub-archive/containers/JCSDA-singularity-latest/" class="uri">https://singularityhub.github.io/singularityhub-archive/containers/JCSDA-singularity-latest/</a></p><p>From <a href="https://singularityhub.github.io/singularityhub-archive/containers/MBlaschek-singularity-jupyter-jedi/" class="uri">https://singularityhub.github.io/singularityhub-archive/containers/MBlaschek-singularity-jupyter-jedi/</a></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ singularity --version<br><br>$ singularity pull shub://MBlaschek/singularity-jupyter:jedi<br>$ ll<br>963M Sep 22 14:10 singularity-jupyter_jedi.sif<br><br>$ singularity <span class="hljs-built_in">exec</span> singularity-jupyter_jedi.sif <span class="hljs-built_in">cat</span> /etc/os-release<br>NAME=<span class="hljs-string">&quot;Ubuntu&quot;</span><br>VERSION=<span class="hljs-string">&quot;16.04.6 LTS (Xenial Xerus)&quot;</span><br>ID=ubuntu<br>ID_LIKE=debian<br>PRETTY_NAME=<span class="hljs-string">&quot;Ubuntu 16.04.6 LTS&quot;</span><br>VERSION_ID=<span class="hljs-string">&quot;16.04&quot;</span><br>HOME_URL=<span class="hljs-string">&quot;http://www.ubuntu.com/&quot;</span><br>SUPPORT_URL=<span class="hljs-string">&quot;http://help.ubuntu.com/&quot;</span><br>BUG_REPORT_URL=<span class="hljs-string">&quot;http://bugs.launchpad.net/ubuntu/&quot;</span><br>VERSION_CODENAME=xenial<br>UBUNTU_CODENAME=xenial<br><br>$ singularity inspect singularity-jupyter_jedi.sif<br>MAINTAINER: Mark Miesch<br>SPECIES: JEDI<br>org.label-schema.build-date: Thursday_5_December_2019_10:5:35_UTC<br>org.label-schema.schema-version: 1.0<br>org.label-schema.usage.singularity.deffile.bootstrap: docker<br>org.label-schema.usage.singularity.deffile.from: jcsda/docker_base-gnu-openmpi-dev:latest<br>org.label-schema.usage.singularity.version: 3.4.2<br><br>$ singularity shell -e singularity-jupyter_jedi.sif<br></code></pre></td></tr></table></figure><p>What's inside the JEDI docker image? (note: seems not full set)</p><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs smali">When you start a Singularity container<span class="hljs-built_in"> instance </span>from the xinzhang8noaa-singularity-master.simg, we already prepapre the gnu version 7.2 compilers<span class="hljs-built_in"> and </span>most of the necessary libraiestools for GSI, OOPS, WRF etc., all libraries are installed under /usr/local, which include<br><br>git<br>git flow<br>emacs<br>open-mpi v2.1.0<br>zlib v1.2.11<br>szip v2.1.1<br>jpeg v9b<br>png v1.4.19<br>jasper v1.900.2<br>hdf5 v1.8.17<br>freetype v2.5.5<br>netcdf-c v4.4.11<br>netcdf-fortran v4.4.4<br>lapack v3.7.0<br>parallel-netcdf v1.8.1<br>xerces-c v3.1.4<br>esmf v7.0.0<br>udunites-2 v2.2.24<br>nco v4.6.6<br>grib_api v1.21.0<br>cdo v1.8.2<br>boost v1.65.1<br>eigen3 v3.3.4<br>pio 1.7.1<br>ecbuild<br>eckit<br>fckit<br><br>The major NCEP libraries are also installed at<span class="hljs-keyword"> :</span><br><br>/nwprod/lib/bacio/v2.0.1/libbacio_v2.0.1_4.a<br>/nwprod/lib/bacio/v2.0.1/libbacio_v2.0.1_8.a<br>/nwprod/lib/ip/v2.0.0/libip_v2.0.0_4.a<br>/nwprod/lib/ip/v2.0.0/libip_v2.0.0_8.a<br>/nwprod/lib/ip/v2.0.0/libip_v2.0.0_d.a<br>/nwprod/lib/sigio/v2.0.1/lib/libsigio_v2.0.1_4.a<br>/nwprod/lib/sigio/v2.0.1/libsigio_v2.0.1_4.a<br>/nwprod/lib/sp/v2.0.2/libsp_v2.0.2_4.a<br>/nwprod/lib/sp/v2.0.2/libsp_v2.0.2_8.a<br>/nwprod/lib/sp/v2.0.2/libsp_v2.0.2_d.a<br>/nwprod/lib/w3emc/v2.2.0/libw3emc_v2.2.0_4.a<br>/nwprod/lib/w3emc/v2.2.0/libw3emc_v2.2.0_8.a<br>/nwprod/lib/w3emc/v2.2.0/libw3emc_v2.2.0_d.a<br>/nwprod/lib/w3nco/v2.0.6/libw3nco_v2.0.6_4.a<br>/nwprod/lib/w3nco/v2.0.6/libw3nco_v2.0.6_8.a<br>/nwprod/lib/w3nco/v2.0.6/libw3nco_v2.0.6_d.a<br></code></pre></td></tr></table></figure><ul><li>Download WRF and WPS</li><li>Build WRF and WPS code</li><li>Download MPAS code</li><li>Build MPAS code</li><li>Test MPAS</li></ul><h2 id="example-lammps">Example: LAMMPS</h2><p>LAMMPS æ˜¯ç”±æ¡‘è¿ªäºåœ‹å®¶å¯¦é©—å®¤é–‹ç™¼çš„ä¸€å¥—åˆ†å­å‹•åŠ›å­¸é¡æ¯”çš„é–‹æºç¨‹å¼åŒ…ã€‚ LAMMPSä½¿ç”¨MPIå¯¦ç¾å¤šæ©Ÿå™¨å¹³è¡Œè¨ˆç®—ï¼Œåœ¨æ–°çš„ç‰ˆæœ¬ä¸­ï¼Œæ”¯æ´åŸºæ–¼CUDAå’ŒOpenCLçš„GPUè¨ˆç®—ã€‚å…¶ä»¥GNUé€šç”¨å…¬çœ¾æˆæ¬Šæ¢æ¬¾é‡‹å‡ºï¼Œå› è€Œé–‹æºè‡ªç”±ã€‚ LAMMPSæœ€åˆç‚ºä¸€ç¾åœ‹æ”¿åºœèˆ‡ç§äººæ©Ÿæ§‹åˆä½œå°ˆæ¡ˆï¼Œç”±ç¾åœ‹èƒ½æºéƒ¨èˆ‡å¦å¤–ä¸‰æ‰€ç§æœ‰ä¼æ¥­å¯¦é©—å®¤åˆä½œé–‹ç™¼ã€‚</p><p>LAMMPS is a classical molecular dynamics code with a focus on materials modeling. It's an acronym for Large-scale Atomic/Molecular Massively Parallel Simulator.</p><p>From <a href="http://docs.hpc.whu.edu.cn/files/whuhpcdocs.wiki/sbatch/singularity.html" class="uri">http://docs.hpc.whu.edu.cn/files/whuhpcdocs.wiki/sbatch/singularity.html</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># åˆ›å»ºsandboxï¼›</span><br><span class="hljs-comment"># è¿™é‡Œå°†åˆ›å»ºçš„sandboxå‘½åä¸ºubuntu20_lammps,å¹¶ä½¿ç”¨docker hubä¸Šç°æœ‰çš„å®¹å™¨ ubuntu:20.04 ä½œä¸ºåŸºç¡€é•œåƒã€‚</span><br>singularity build --sandbox ./ubuntu20_lammps docker://ubuntu:20.04 <span class="hljs-comment"># sudo ??</span><br><br><span class="hljs-comment"># è¿›å…¥åˆ›å»ºå¥½çš„sandboxï¼Œå¹¶è¿›è¡Œä¿®æ”¹ï¼›</span><br><span class="hljs-comment"># å…¶ä¸­-wè¡¨ç¤ºå¯å†™ã€‚è¿›å…¥åsingularityä¼šè‡ªåŠ¨æŒ‚è½½çš„HOMEç›®å½•ï¼Œå¦‚æœæ˜¯ç”¨rootç”¨æˆ·è¿›å…¥ï¼Œåˆ™ä¼šæŒ‚è½½/rootç›®å½•</span><br>singularity shell -w ./ubuntu20_lammps<br><br><span class="hljs-comment"># Ubuntuä¸‹å®‰è£…LAMMPSå¹¶è¡Œç‰ˆéœ€è¦å®‰è£…å¿…è¦çš„ä¾èµ–åŒ…</span><br>apt update &amp;&amp; apt upgrade -y<br>apt install openmpi-bin openmpi-doc libopenmpi-dev -y<br>apt install gcc g++ gfortran make wget vim -y<br><br><span class="hljs-comment"># å®‰è£…fftw</span><br>wget http://www.fftw.org/fftw-3.3.9.tar.gz<br>tar zxvf fftw-3.3.9.tar.gz<br><span class="hljs-built_in">cd</span> fftw-3.3.9<br>./configure --prefix=/opt/software/fftw_3.3.9 --enable-shared --enable-static --enable-fma<br>make -j &amp;&amp; make install<br><br><span class="hljs-comment"># è®¾ç½®ä¸´æ—¶fftwç¯å¢ƒå˜é‡</span><br><span class="hljs-built_in">export</span> PATH=/opt/software/fftw_3.3.9/bin:<span class="hljs-variable">$PATH</span><br><span class="hljs-built_in">export</span> LD_LIBRARY_PATH=/opt/software/fftw_3.3.9/lib:<span class="hljs-variable">$LD_LIBRARY_PATH</span><br><br><span class="hljs-comment"># å®‰è£…lammps</span><br>wget https://lammps.sandia.gov/tars/lammps-10Feb21.tar.gz<br>tar zxvf lammps-10Feb21.tar.gz<br><span class="hljs-built_in">cd</span> lammps-10Feb21<br><span class="hljs-built_in">cd</span> src<br>vim MAKE/OPTIONS/Makefile.g++_openmpi <span class="hljs-comment"># ä¿®æ”¹å¦‚ä¸‹è¡Œ</span><br>  FFT_INC = -DFFT_FFTW -I/opt/software/fftw_3.3.9/include<br>  FFT_PATH = -L/opt/software/fftw_3.3.9/lib<br>  FFT_LIB = -lfftw3<br><br>make yes-std<br>make no-lib<br>make -j g++_openmpi<br><br><span class="hljs-built_in">mkdir</span> /opt/software/lammps<br><span class="hljs-built_in">cp</span> ./lmp_g++_openmpi /opt/software/lammps/<br><br><span class="hljs-comment"># è®¾ç½®ä¸´æ—¶lammpsç¯å¢ƒå˜é‡</span><br><span class="hljs-built_in">export</span> PATH=/opt/software/lammps:<span class="hljs-variable">$PATH</span><br><br><span class="hljs-comment"># éªŒè¯(å®¹å™¨å†…)</span><br><span class="hljs-built_in">cd</span> /root<br><span class="hljs-built_in">cp</span> /opt/lammps-10Feb21/bench/in.lj .<br>mpirun --allow-run-as-root -np 2 --mca btl ^openib lmp_g++_openmpi -<span class="hljs-keyword">in</span> in.lj<br><br><br><span class="hljs-comment"># é€€å‡ºå®¹å™¨ï¼Œè®¾ç½®æ°¸ä¹…ç¯å¢ƒå˜é‡(å®¿ä¸»æœº)</span><br>vim ./ubuntu20_lammps/environment<br><span class="hljs-comment"># åŠ å…¥ä¸‹é¢ä¸¤è¡Œ</span><br><span class="hljs-built_in">export</span> PATH=/opt/software/fftw_3.3.9/bin:/opt/software/lammps:<span class="hljs-variable">$PATH</span><br><span class="hljs-built_in">export</span> LD_LIBRARY_PATH=/opt/software/fftw_3.3.9/lib:<span class="hljs-variable">$LD_LIBRARY_PATH</span><br><br><span class="hljs-comment"># éªŒè¯(å®¿ä¸»æœº)</span><br>singularity <span class="hljs-built_in">exec</span> ./ubuntu20_lammps mpirun --allow-run-as-root -np 2 --mca btl ^openib lmp_g++_openmpi -<span class="hljs-keyword">in</span> in.lj<br><br><span class="hljs-comment"># æŠŠä¿®æ”¹å¥½çš„sandboxæ‰“åŒ…æˆsifæ ¼å¼ï¼›</span><br><span class="hljs-comment"># åˆ é™¤ä¸å¿…è¦çš„å®‰è£…åŒ…, å¦‚ fftw-3.3.9.tar.gz lammps-10Feb21.tar.gz</span><br><span class="hljs-comment"># ä½¿ç”¨å‰é¢åˆ›å»ºçš„sandboxç›®å½•ç”Ÿæˆsingularity image fileæ ¼å¼é•œåƒã€‚</span><br>singularity build ubuntu20_lammps.sif ./ubuntu20_lammps<br></code></pre></td></tr></table></figure><p>then, run it on HPC,</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/bash</span><br><br><span class="hljs-comment">#SBATCH --partition=hpxg</span><br><span class="hljs-comment">#SBATCH --nodes=1</span><br><span class="hljs-comment">#SBATCH --ntasks-per-node=2</span><br><span class="hljs-comment">#SBATCH --time=1:00:00</span><br><br><span class="hljs-comment"># åŠ è½½è¶…ç®—å¹³å°é¢„å®‰è£…çš„ singularity</span><br>module load singularity<br><span class="hljs-comment"># or load by micromamba</span><br><br><span class="hljs-comment"># æµ‹è¯•in.ljç®—ä¾‹</span><br>singularity <span class="hljs-built_in">exec</span> ubuntu20_lammps.sif mpirun -np 2 --mca btl ^openib lmp_g++_openmpi -<span class="hljs-keyword">in</span> in.lj<br></code></pre></td></tr></table></figure><h2 id="customize-definition-file-.def">Customize Definition File .def</h2><p>File å…§å®¹ä¸»è¦åˆ†ç‚º Header å’Œ Sections å…©éƒ¨åˆ†ï¼š</p><ul><li>Headerï¼šå®šç¾© base æ˜ åƒæª”çš„ä¾†æº (ä¾‹ï¼šdocker, library, yumâ€¦ç­‰)ã€‚</li><li>Sectionsï¼šæœ‰å¤šç¨®é¸é …å¯è¨­å®šï¼Œä¸»è¦æœƒä½¿ç”¨ä»¥ä¸‹ 2 å€‹é …ç›®ï¼š<ul><li>%postï¼šå»ºç«‹å®¹å™¨å¾Œå°‡åŸ·è¡Œçš„å…§å®¹ã€‚</li><li>%environmentï¼šå®¹å™¨å»ºç«‹å¥½å¾Œï¼Œæœƒå°‡ç¨‹å¼çš„ç’°å¢ƒè®Šæ•¸æœƒæ”¾åˆ° /environment å…§ã€‚</li></ul></li></ul><p>Execute definition file to create a container,</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ <span class="hljs-built_in">sudo</span> singularity build &lt;CONTAINER_NAME&gt;.sif &lt;DEF_FILE_NAME&gt;.def<br></code></pre></td></tr></table></figure><p>Header,</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">Bootstrap: library<br>From: debian:7<br></code></pre></td></tr></table></figure><p>Preferred bootstrap agents</p><ul><li>library (images hosted on the Container Library)</li><li>docker (images hosted on Docker Hub)</li><li>shub (images hosted on Singularity Hub)</li><li>oras (images from supporting OCI registries)</li><li>scratch (a flexible option for building a container from scratch)</li></ul><p>Here is an example definition file that uses every available section. We will discuss each section in turn. It is not necessary to include every section (or any sections at all) within a def file. Furthermore, multiple sections of the same name can be included and will be appended to one another during the build process.</p><p><a href="https://docs.sylabs.io/guides/3.7/user-guide/definition_files.html" class="uri">https://docs.sylabs.io/guides/3.7/user-guide/definition_files.html</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs bash">Bootstrap: library<br>From: ubuntu:18.04<br>Stage: build<br><br>%setup<br>    <span class="hljs-built_in">touch</span> /file1<br>    <span class="hljs-built_in">touch</span> <span class="hljs-variable">$&#123;SINGULARITY_ROOTFS&#125;</span>/file2<br><br>%files<br>    /file1<br>    /file1 /opt<br><br>%environment<br>    <span class="hljs-built_in">export</span> LISTEN_PORT=12345<br>    <span class="hljs-built_in">export</span> LC_ALL=C<br><br>%post<br>    apt-get update &amp;&amp; apt-get install -y netcat<br>    NOW=`<span class="hljs-built_in">date</span>`<br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;export NOW=\&quot;<span class="hljs-variable">$&#123;NOW&#125;</span>\&quot;&quot;</span> &gt;&gt; <span class="hljs-variable">$SINGULARITY_ENVIRONMENT</span><br><br>%runscript<br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Container was created <span class="hljs-variable">$NOW</span>&quot;</span><br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Arguments received: $*&quot;</span><br>    <span class="hljs-built_in">exec</span> <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$@</span>&quot;</span><br><br>%startscript<br>    nc -lp <span class="hljs-variable">$LISTEN_PORT</span><br><br>%<span class="hljs-built_in">test</span><br>    grep -q NAME=\&quot;Ubuntu\&quot; /etc/os-release<br>    <span class="hljs-keyword">if</span> [ $? -eq 0 ]; <span class="hljs-keyword">then</span><br>        <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Container base is Ubuntu as expected.&quot;</span><br>    <span class="hljs-keyword">else</span><br>        <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Container base is not Ubuntu.&quot;</span><br>        <span class="hljs-built_in">exit</span> 1<br>    <span class="hljs-keyword">fi</span><br><br>%labels<br>    Author d@sylabs.io<br>    Version v0.0.1<br><br>%<span class="hljs-built_in">help</span><br>    This is a demo container used to illustrate a def file that uses all supported sections.<br></code></pre></td></tr></table></figure><h3 id="case">case:</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><code class="hljs sh">BootStrap: library<br>From: ubuntu:18.04<br><br>%post<br>    apt-get -y update<br>    apt-get -y upgrade<br><br>    apt-get install -y \<br>    build-essential \<br>    vim \<br>    wget \<br>    curl \<br>    libssl-dev \<br>    git \<br>    tar \<br>    openssh-client \<br>    gzip \<br>    ca-certificates<br><br>    apt-get install -y bzip2<br><br>    apt-get clean<br><br>    <span class="hljs-built_in">export</span> SHELL=/bin/bash<br>    <span class="hljs-built_in">export</span> PATH=/root/.local/bin:<span class="hljs-variable">$PATH</span><br>    <br>    wget micro.mamba.pm/install.sh<br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;All paths are default.&quot;</span><br>    sed -i -e <span class="hljs-string">&#x27;s/-t 0/1 == 0/g&#x27;</span> install.sh<br>    <span class="hljs-built_in">chmod</span> +x install.sh<br>    bash install.sh<br><br>    <span class="hljs-comment"># &gt;&gt;&gt; mamba initialize &gt;&gt;&gt;</span><br>    <span class="hljs-comment"># !! Contents within this block are managed by &#x27;mamba init&#x27; !!</span><br>    <span class="hljs-built_in">export</span> MAMBA_EXE=<span class="hljs-string">&#x27;/root/.local/bin/micromamba&#x27;</span>;<br>    <span class="hljs-built_in">export</span> MAMBA_ROOT_PREFIX=<span class="hljs-string">&#x27;/root/micromamba&#x27;</span>;<br>    __mamba_setup=<span class="hljs-string">&quot;<span class="hljs-subst">$(<span class="hljs-string">&quot;<span class="hljs-variable">$MAMBA_EXE</span>&quot;</span> shell hook --shell bash --root-prefix <span class="hljs-string">&quot;<span class="hljs-variable">$MAMBA_ROOT_PREFIX</span>&quot;</span> 2&gt; /dev/null)</span>&quot;</span><br>    <span class="hljs-keyword">if</span> [ $? -eq 0 ]; <span class="hljs-keyword">then</span><br>        <span class="hljs-built_in">eval</span> <span class="hljs-string">&quot;<span class="hljs-variable">$__mamba_setup</span>&quot;</span><br>    <span class="hljs-keyword">else</span><br>        <span class="hljs-built_in">alias</span> micromamba=<span class="hljs-string">&quot;<span class="hljs-variable">$MAMBA_EXE</span>&quot;</span>  <span class="hljs-comment"># Fallback on help from mamba activate</span><br>    <span class="hljs-keyword">fi</span><br>    <span class="hljs-built_in">unset</span> __mamba_setup<br><br>    micromamba <span class="hljs-built_in">env</span> list<br><br>%environment<br>    <span class="hljs-built_in">export</span> SHELL=/bin/bash<br>    <span class="hljs-built_in">export</span> LC_ALL=C<br>    <span class="hljs-built_in">export</span> PATH=/usr/local/bin:<span class="hljs-variable">$PATH</span><br>    <span class="hljs-built_in">export</span> PATH=/root/.local/bin:<span class="hljs-variable">$PATH</span><br><br>    <span class="hljs-comment"># &gt;&gt;&gt; mamba initialize &gt;&gt;&gt;</span><br>    <span class="hljs-comment"># !! Contents within this block are managed by &#x27;mamba init&#x27; !!</span><br>    <span class="hljs-built_in">export</span> MAMBA_EXE=<span class="hljs-string">&#x27;/root/.local/bin/micromamba&#x27;</span>;<br>    <span class="hljs-built_in">export</span> MAMBA_ROOT_PREFIX=<span class="hljs-string">&#x27;/root/micromamba&#x27;</span>;<br>    __mamba_setup=<span class="hljs-string">&quot;<span class="hljs-subst">$(<span class="hljs-string">&quot;<span class="hljs-variable">$MAMBA_EXE</span>&quot;</span> shell hook --shell bash --root-prefix <span class="hljs-string">&quot;<span class="hljs-variable">$MAMBA_ROOT_PREFIX</span>&quot;</span> 2&gt; /dev/null)</span>&quot;</span><br>    <span class="hljs-keyword">if</span> [ $? -eq 0 ]; <span class="hljs-keyword">then</span><br>        <span class="hljs-built_in">eval</span> <span class="hljs-string">&quot;<span class="hljs-variable">$__mamba_setup</span>&quot;</span><br>    <span class="hljs-keyword">else</span><br>        <span class="hljs-built_in">alias</span> micromamba=<span class="hljs-string">&quot;<span class="hljs-variable">$MAMBA_EXE</span>&quot;</span>  <span class="hljs-comment"># Fallback on help from mamba activate</span><br>    <span class="hljs-keyword">fi</span><br>    <span class="hljs-built_in">unset</span> __mamba_setup<br><br>%runscript<br>    hostname<br><br>%labels<br>    Author wpsze<br>    Version v0.0.1<br><br>%<span class="hljs-built_in">help</span><br>  Singularity image used get dependencies from micromamba.<br></code></pre></td></tr></table></figure><p>(Fail, why??) then,</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ <span class="hljs-built_in">sudo</span> singularity build test.sif test.def<br></code></pre></td></tr></table></figure><h2 id="by-sanbox">By Sanbox</h2><p>å»ºç«‹æ²™ç›’å®¹å™¨</p><p>è‹¥éœ€æ¸¬è©¦å¥—ä»¶æ˜¯å¦èˆ‡å®¹å™¨ç’°å¢ƒç›¸å®¹æ™‚ï¼Œæ‚¨å¯ä»¥å»ºç«‹ã€Œæ²™ç›’å®¹å™¨ã€ï¼Œæ—¢ä¸å½±éŸ¿åŸå®¹å™¨æ˜ åƒæª”å…§å®¹ï¼Œä¹Ÿç„¡éœ€é‡å»ºç«‹å®¹å™¨ï¼Œåˆå¯åœ¨å®¹å™¨å…§å®‰è£æˆ–é€²è¡Œæ“ä½œï¼š</p><p>è«‹å…ˆå»ºç«‹æ²™ç›’è³‡æ–™å¤¾ï¼Œæ”¾å…¥å®¹å™¨æ˜ åƒæª”çš„æ‰€æœ‰å…§å®¹</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ <span class="hljs-built_in">sudo</span> singularity build --sandbox &lt;FOLDER_NAME&gt; docker://nvidia/cuda:10.1-devel-ubuntu18.04<br></code></pre></td></tr></table></figure><p><strong>ä½¿ç”¨ shell æ–¹å¼é€²å…¥æ²™ç›’å®¹å™¨å…§ï¼Œä¸¦å…·æœ‰å¯«å…¥çš„æ¬Šé™ã€‚</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ <span class="hljs-built_in">sudo</span> singularity shell --writable &lt;FOLDER_NAME&gt;/<br></code></pre></td></tr></table></figure><p>å³å¯åˆ©ç”¨ apt ä½¿ç”¨ä»¥ä¸‹æŒ‡ä»¤æ›´æ–°ä¸¦å®‰è£å¥—ä»¶</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ apt-get update<br>$ apt-get install wget<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨æ²™ç›’å»ºç«‹ Singularity å®¹å™¨æ˜ åƒæª”</p><div class="note note-primary">            <p>é™„è¨»ï¼šç”±æ–¼æ²™ç›’æœªå°‡å¥—ä»¶å¯«å…¥ definition fileï¼Œæ‚¨ç„¡æ³•ç´€éŒ„å®¹å™¨å…§æœ‰å“ªäº›å¥—ä»¶ï¼Œç¶­è­·ä¸æ˜“ï¼Œè¼ƒä¸æ¨è–¦ä½¿ç”¨æ­¤æ–¹å¼å»ºç«‹å®¹å™¨æ˜ åƒæª”ã€‚å»ºè­°ä½¿ç”¨å®¢è£½åŒ– Singularity å®¹å™¨ä¹‹æ–¹å¼ã€‚</p>          </div><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ <span class="hljs-built_in">sudo</span> singularity build &lt;CONTAINER_NAME&gt;.sif &lt;FOLDER_NAME&gt;/<br></code></pre></td></tr></table></figure><ul><li>Assume that the sandbox image to be deleted is named molspin</li><li>First, enter the image to be deleted in readable mode<ul><li>singularity shell --fakeroot -w molspin</li></ul></li><li>Delete all files created based on fakeroot in the container<ul><li>rm -rf /* 1&gt;/dev/null 2&gt;&amp;1</li></ul></li><li>Exit the image<ul><li>exit</li></ul></li><li>Upload the created software image to the high-performance computing cluster and load the singularity software environment</li><li>Delete the rest<ul><li>rm -rf molspin</li></ul></li></ul><h2 id="example-nmap">Example: nmap</h2><h1 id="conda-install-singularity">Conda install singularity</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ micromamba <span class="hljs-built_in">env</span> create -n singularity<br>$ micromamba activate singularity<br>$ micromamba install conda-forge::singularity<br></code></pre></td></tr></table></figure><p>version = linux-ppc64le/singularity-3.8.7-hff88825_0.tar.bz2?</p><h1 id="running-singularity-images">Running Singularity images</h1><h2 id="build-or-pull">build or pull</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ singularity build ./jason-tensorflow.sif docker://tensorflow/tensorflow:latest-gpu<br>$ singularity pull ./jason-tensorflow.sif docker://tensorflow/tensorflow:latestgpu<br>$ singularity pull library://lolcow<br>$ <span class="hljs-built_in">ls</span><br>lolcow_latest.sif<br></code></pre></td></tr></table></figure><div class="note note-primary">            <ul><li>Inspect will show you labels, environment variables, and scripts associated with the image determined by the flags you pass.</li></ul>          </div><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ singularity inspect my-container.sif<br></code></pre></td></tr></table></figure><h2 id="run-exec-shell">run, exec, shell</h2><div class="note note-primary">            <p>singularity run Run the user-defined default command within a container</p>          </div><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ singularity run my-container.sif<br><br>$ singularity run lolcow_latest.sif <br> ______________________________<br>&lt; Sun Sep 22 00:17:43 HKT 2024 &gt;<br> ------------------------------<br>        \   ^__^<br>         \  (oo)\_______<br>            (__)\       )\/\<br>                ||----w |<br>                ||     ||<br></code></pre></td></tr></table></figure><div class="note note-primary">            <p>singularity exec Run a command within a container</p>          </div><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ singularity <span class="hljs-built_in">exec</span> my-container.sif my-command<br><br>$ singularity <span class="hljs-built_in">exec</span> lolcow_latest.sif cowsay WRF-MPAS<br> __________<br>&lt; WRF-MPAS &gt;<br> ----------<br>        \   ^__^<br>         \  (oo)\_______<br>            (__)\       )\/\<br>                ||----w |<br>                ||     ||<br></code></pre></td></tr></table></figure><div class="note note-primary">            <p>singularity shell Run a shell within a container</p>          </div><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ singularity shell my-container.sif<br><br>$ singularity shell lolcow_latest.sif <br>Singularity&gt; cowsay here is shell<br> _______________<br>&lt; here is shell &gt;<br> ---------------<br>        \   ^__^<br>         \  (oo)\_______<br>            (__)\       )\/\<br>                ||----w |<br>                ||     ||<br>Singularity&gt; cowsay going <br> _______<br>&lt; going &gt;<br> -------<br>        \   ^__^<br>         \  (oo)\_______<br>            (__)\       )\/\<br>                ||----w |<br>                ||     ||<br>Singularity&gt; <span class="hljs-built_in">exit</span><br><span class="hljs-built_in">exit</span><br></code></pre></td></tr></table></figure><h1 id="specifying-bind-paths">Specifying bind paths</h1><p>é–‹ç™¼å®¹å™¨çš„ç›®çš„ä¹‹ä¸€ä¸»è¦æ˜¯ç‚ºäº†è§£æ±ºä¾è³´å‡½å¼åº«çš„å®‰è£ã€è»Ÿé«”ç’°å¢ƒçš„éš”é›¢ã€ä»¥åŠè»Ÿé«”ç’°å¢ƒçš„ç§»æ¤å•é¡Œã€‚å› æ­¤ï¼Œ<strong>å®¹å™¨çš„æ ¸å¿ƒç‰¹æ€§ä¹‹ä¸€å°±æ˜¯å®ƒå€‘çš„æª”æ¡ˆç³»çµ±èˆ‡å®¿ä¸»æ©Ÿç›¸éš”é›¢ã€‚</strong> å¦‚æœæˆ‘å€‘æŸ¥çœ‹ä¸€å€‹ singularity å®¹å™¨çš„æ ¹ç›®éŒ„ï¼Œä¹Ÿæœƒçœ‹åˆ°èˆ‡ Linux ä¸»æ©Ÿæ ¹ç›®éŒ„ç›¸ä¼¼çš„çµæ§‹ã€‚é€™æ„å‘³è‘—å®¹å™¨å…§çš„æ‡‰ç”¨ç¨‹å¼åªèƒ½çœ‹åˆ°ï¼ˆä¸¦èˆ‡ä¹‹äº’å‹•ï¼‰é€™å€‹å°é–‰ç’°å¢ƒä¸­çš„æª”æ¡ˆå’Œç›®éŒ„ã€‚èˆ‡ Linux ä¸‹æ›è¼‰ï¼ˆmountï¼‰å¤–æ¥ç¡¬ç¢Ÿè¨­å‚™é¡ä¼¼ï¼Œå®¹å™¨åŒæ¨£éœ€è¦é€éæ›è¼‰ (bind) çš„æ“ä½œèˆ‡æˆ‘å€‘å®¿ä¸»æ©Ÿä¸Šçš„æª”æ¡ˆç³»çµ±äº’å‹•ã€‚<a href="https://juejin.cn/post/7345293582365868041">link</a></p><p>ç•¶å‘¼å«å®¹å™¨æ™‚ï¼ŒSingularity æœƒå°‡ä¸»æ©Ÿä½œæ¥­ç³»çµ± â€œswapâ€ ç‚ºå®¹å™¨ä¸­çš„ä½œæ¥­ç³»çµ±ï¼Œå°è‡´æˆ‘å€‘ç„¡æ³•å­˜å–ä¸»æ©Ÿæª”æ¡ˆç³»çµ±ã€‚<strong>ç„¶è€Œï¼Œåœ¨æ—¥å¸¸ä½¿ç”¨å ´æ™¯ä¸­ï¼Œå·²å®‰è£è‡³å®¹å™¨ä¸­çš„æ‡‰ç”¨ç¨‹å¼çš„è¼¸å…¥å’Œè¼¸å‡ºæª”æ¡ˆå¾€å¾€å„²å­˜åœ¨ä¸»æ©Ÿæª”æ¡ˆç³»çµ±ä¸­ï¼Œå› æ­¤ï¼Œæˆ‘å€‘éœ€è¦å¾å®¹å™¨å…§è®€å–å’Œå¯«å…¥ä¸»æ©Ÿç³»çµ±ä¸Šçš„æª”æ¡ˆã€‚</strong></p><ul><li>singularity ä½¿ç”¨ --bind/-B å®¿ä¸»æ©Ÿç›®éŒ„:å®¹å™¨å…§ç›®éŒ„ é¸é …å°‡ä¸»æ©Ÿç³»çµ±ä¸Šçš„ç›®éŒ„å°æ‡‰åˆ°å®¹å™¨å…§çš„ç›®éŒ„ã€‚é€™å…è¨±æˆ‘å€‘å¾å®¹å™¨å…§éƒ¨å­˜å–ä¸»æ©Ÿä¸Šçš„æ–‡ä»¶ï¼Œå¾è€Œåœ¨ä¸»æ©Ÿç³»çµ±ä¸Šè®€å¯«è³‡æ–™ã€‚</li></ul><p>å¦‚éœ€è¦å°‡å¤šå€‹ç›®éŒ„ç¶å®šåˆ° Singularity å®¹å™¨ä¸­ï¼Œä¸¦ä¸”é•·æœŸä¿æŒä¸è®Šï¼Œæˆ‘å€‘å¯ä»¥é€²ä¸€æ­¥å°‡é€™å€‹è®Šæ•¸å¯«å…¥ .bashrc æª”æ¡ˆä¸­ã€‚</p><p>Hereâ€™s an example of using the --bind option and binding /data on the host to /mnt in the container (/mnt does not need to already exist in the container):</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ <span class="hljs-built_in">ls</span> /data<br>bar  foo<br><br>$ singularity <span class="hljs-built_in">exec</span> --<span class="hljs-built_in">bind</span> /data:/mnt my_container.sif <span class="hljs-built_in">ls</span> /mnt<br>bar  foo<br></code></pre></td></tr></table></figure><p>You can bind multiple directories in a single command with this syntax:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ singularity shell --<span class="hljs-built_in">bind</span> /opt,/data:/mnt my_container.sif<br></code></pre></td></tr></table></figure><p>or</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ <span class="hljs-built_in">export</span> SINGULARITY_BIND=<span class="hljs-string">&quot;/opt,/data:/mnt&quot;</span><br><br>$ singularity shell my_container.sif<br></code></pre></td></tr></table></figure><h1 id="references">References</h1><ol type="1"><li><a href="https://docs.sylabs.io/guides/2.6/user-guide/singularity_and_docker.html">Singularity and Docker</a></li><li><a href="https://hpc.hku.hk/hpc/software/singularity-container/">HKU Singularity Container</a></li><li><a href="https://cloud.sylabs.io/library">Sylabs Cloud</a><ol type="1"><li>singularity pull ubuntu.sif library://library/default/ubuntu:21.04</li></ol></li><li><a href="https://ngc.nvidia.com/">NVIDIA NGC</a><ol type="1"><li>NVIDIAå®˜æ–¹è‡ªå·±æ„å»ºçš„pytorchå’ŒTensorFlowçš„å®¹å™¨é•œåƒï¼Œæ¯ä¸ªé‡Œé¢åŒ…å«äº†cudaã€æ˜¾å¡é©±åŠ¨ä»¥åŠcudnnï¼Œæ®è¯´æ¯”è‡ªå·±è£…çš„é€Ÿåº¦è¦å¿«ï¼Œä½¿ç”¨æ—¶singularityéœ€è¦ --nv é€‰é¡¹ã€‚</li></ol></li><li><a href="https://hub.docker.com/">Docker Hub</a><ol type="1"><li>singularity pull ubuntu.sif docker://ubuntu:latest</li></ol></li><li><a href="https://singularityhub.github.io/singularityhub-archive/">Singularity Hub Archive</a></li><li><a href="https://www.cnblogs.com/dechinphy/p/pytorch.html">ä»é›¶å¼€å§‹åˆ¶ä½œPyTorchçš„Singularityå®¹å™¨é•œåƒ</a></li><li><a href="https://man.twcc.ai/@twccdocs/howto-twnia2-create-sglrt-container-zh">å»ºç«‹å°ç£æ‰äºŒè™Ÿçš„å®¹å™¨</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>HPC</tag>
      
      <tag>NWP</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>WRF | Predicting lightning activity using WRF-ELEC model</title>
    <link href="/2024/09/20/wrf4-elec-lightning/"/>
    <url>/2024/09/20/wrf4-elec-lightning/</url>
    
    <content type="html"><![CDATA[<h1 id="wrf-elec-model">WRF-ELEC model</h1><p>WRF-ELEC provides basic electrification and <strong>lightning using the NSSL microphysics scheme</strong>. The electrification parameterizations are based on past work in modeling. The basics of the charge separation schemes comes from Mansell et al. (2005). Their use in the <strong>NSSL 2-moment microphysics</strong> is shown in Mansell et al. 2010 and Mansell and Ziegler (2013). First implementation into WRF is described by Fierro et al. (2013), which includes details of the basic discharge scheme (cylindrical discharge regions centered on lightning initiation points).</p><ul><li>Mansell et al. 2005: Charge structure and lightning sensitivity in a simulated multicell thunderstorm. J. Geophys. Res., 110, D12101, doi:10.1029/2004JD005287</li><li>Mansell, E. R., C. L. Ziegler, and E. C. Bruning, 2010: Simulated electrification of a small thunderstorm with two-moment bulk microphysics. J. Atmos. Sci., 67, 171-194, doi:10. 1175/2009JAS2965.1.</li><li><strong>Fierro, A. O., E.R. Mansell, C. Ziegler and D. R. MacGorman 2013: The implementation of an explicit charging and discharge lightning scheme within the WRF-ARW model: Benchmark simulations of a continental squall line, a tropical cyclone and a winter storm. Monthly Weather Review, Volume 141, 2390-2415</strong> (see below)</li></ul><p>If you have trouble with this option please contact the developers directly (i.e., not wrf_help):</p><blockquote><p>Ted Mansell (Ted.Mansell <em>at</em> noaa.gov)<br />Alexandre Fierro (Alex.Fierro <em>at</em> noaa.gov)</p></blockquote><h2 id="boxmg">BoxMG</h2><ul><li>Black Box Multigrid (BoxMG) algorithm</li></ul><p>From <a href="https://github.com/MicroTed/wrf4-elec/blob/7c90e71bdc4db527d0ec034804e4fd200cdacf28/doc/README.electricity#L41" class="uri">https://github.com/MicroTed/wrf4-elec/blob/7c90e71bdc4db527d0ec034804e4fd200cdacf28/doc/README.electricity#L41</a>,</p><p>The <strong>BoxMG elliptic equation solver</strong> is required for WRF-ELEC to calculate the 3D electric potential. This library is distributed at the moment as a source code archive at</p><ul><li><a href="http://sourceforge.net/projects/boxmg4wrf/" class="uri">http://sourceforge.net/projects/boxmg4wrf/</a></li></ul><p>The git repository is recommended as the most up-to-date. Note that the code has only been compiled for Intel/AMD (non-Itanium) architecture under Linux and OS X using either Intel Fortran or GNU compilers. (For problems, contact <a href="mailto:ted.mansell@noaa.gov" class="email">ted.mansell@noaa.gov</a>)</p><div class="note note-primary">            <p><strong>BoxMG needs to be installed before configuring WRF.</strong></p>          </div><p>Install the code where you want the libraries to be and then follow the instructions in the INSTALL document:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ git <span class="hljs-built_in">clone</span> https://git.code.sf.net/p/boxmg4wrf/git boxmg4wrf<br>$ ll<br>34M boxmg4wrf<br></code></pre></td></tr></table></figure><ul><li><a href="https://sourceforge.net/p/boxmg4wrf/git/ci/main/tree/" class="uri">https://sourceforge.net/p/boxmg4wrf/git/ci/main/tree/</a><ul><li>Branches: main, boxmg4wrf-0.1, master, release0.0</li></ul></li></ul><p>git logg (2024-09-24)</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">* d8e89bc (HEAD -&gt; master, origin/master, origin/HEAD)  Fix mpi calls <span class="hljs-keyword">to</span> use single <span class="hljs-keyword">or</span> <span class="hljs-type">double</span> <span class="hljs-type">precision</span> <span class="hljs-keyword">as</span> <span class="hljs-keyword">set</span> <span class="hljs-keyword">by</span> RKIND (<span class="hljs-number">11</span> months ago) &lt;Ted Mansell&gt;<br>* <span class="hljs-number">817</span>df7a  <span class="hljs-keyword">Update</span> <span class="hljs-keyword">to</span> compile <span class="hljs-keyword">on</span> M1 mac (assumes <span class="hljs-keyword">using</span> gfortran <span class="hljs-keyword">as</span> compiler) (<span class="hljs-number">2</span> years ago) &lt;Ted Mansell&gt;<br>* <span class="hljs-number">3</span>cee0c8 (origin/boxmg4wrf<span class="hljs-number">-0.1</span>) Added <span class="hljs-keyword">comment</span> (<span class="hljs-number">2</span> years, <span class="hljs-number">9</span> months ago) &lt;Ted Mansell&gt;<br>* <span class="hljs-number">71</span>c38c1 - Added a <span class="hljs-keyword">check</span> <span class="hljs-keyword">for</span> gcc <span class="hljs-keyword">version</span> <span class="hljs-number">10</span> <span class="hljs-keyword">or</span> greater <span class="hljs-keyword">to</span> <span class="hljs-keyword">add</span> the -fallow-argument-mismatch compile flag - Updates <span class="hljs-keyword">to</span> test example ex_direct_1_f90 (e.g., <span class="hljs-type">double</span> quotes <span class="hljs-keyword">on</span> preprocessed <span class="hljs-keyword">include</span> files) (<span class="hljs-number">2</span> years, <span class="hljs-number">9</span> months ago) &lt;Ted Mansell&gt;<br>* <span class="hljs-number">0e19676</span> erm: <span class="hljs-keyword">add</span> sgl/dbl suffix <span class="hljs-keyword">for</span> libs (<span class="hljs-number">3</span> years, <span class="hljs-number">7</span> months ago) &lt;Ted Mansell&gt;<br>* <span class="hljs-number">6682023</span> erm: turn <span class="hljs-keyword">off</span> <span class="hljs-keyword">all</span> but the one that works (currently) (<span class="hljs-number">3</span> years, <span class="hljs-number">7</span> months ago) &lt;Ted Mansell&gt;<br>* <span class="hljs-number">3644096</span> erm: added dependcies <span class="hljs-keyword">for</span> &quot;check&quot; (<span class="hljs-number">3</span> years, <span class="hljs-number">7</span> months ago) &lt;Ted Mansell&gt;<br>* d98ff35 erm: Minor changes <span class="hljs-keyword">for</span> clarity (hopefully) (<span class="hljs-number">3</span> years, <span class="hljs-number">7</span> months ago) &lt;Ted Mansell&gt;<br>* aaaa34c erm: minor updates (<span class="hljs-number">3</span> years, <span class="hljs-number">7</span> months ago) &lt;Ted Mansell&gt;<br>* b54bb70 erm: added .gitignore file (<span class="hljs-number">3</span> years, <span class="hljs-number">7</span> months ago) &lt;Ted Mansell&gt;<br>* d96cb63 (origin/release0<span class="hljs-number">.0</span>) Initial <span class="hljs-keyword">commit</span> (<span class="hljs-number">3</span> years, <span class="hljs-number">7</span> months ago) &lt;Ted Mansell&gt;<br></code></pre></td></tr></table></figure><p>Compile:</p><ul><li>wrf_env.sh: go to <a href="https://waipangsze.github.io/2023/04/25/WRF_installation_on_a_Linux_based_machine/" class="uri">https://waipangsze.github.io/2023/04/25/WRF_installation_on_a_Linux_based_machine/</a></li></ul><p>To check environment variables,</p><ul><li>/ARCH/machine</li></ul><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs perl">ife<span class="hljs-string">q (<span class="hljs-variable">$(</span>findstring x86_64,<span class="hljs-variable">$(</span>UNAME_M)</span>),x86_64)<br><br>  BOXMG_CPU = AMD64<br></code></pre></td></tr></table></figure><ul><li>add these to Makefile to print variables,</li></ul><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs gams"><span class="hljs-symbol">$</span>(info <span class="hljs-symbol">$</span><span class="hljs-symbol">$</span>BOXMG_OS is [<span class="hljs-symbol">$</span>&#123;BOXMG_OS&#125;])<br><span class="hljs-symbol">$</span>(info <span class="hljs-symbol">$</span><span class="hljs-symbol">$</span>BOXMG_CPU is [<span class="hljs-symbol">$</span>&#123;BOXMG_CPU&#125;])<br><span class="hljs-symbol">$</span>(info <span class="hljs-symbol">$</span><span class="hljs-symbol">$</span>BOXMG_COMPILER is [<span class="hljs-symbol">$</span>&#123;BOXMG_COMPILER&#125;])<br><span class="hljs-symbol">$</span>(info <span class="hljs-symbol">$</span><span class="hljs-symbol">$</span>BOXMG_ARCHmake is [<span class="hljs-symbol">$</span>&#123;BOXMG_ARCHmake&#125;])<br><span class="hljs-symbol">$</span>(info <span class="hljs-symbol">$</span><span class="hljs-symbol">$</span>BOXMG_ARCH is [<span class="hljs-symbol">$</span>&#123;BOXMG_ARCH&#125;])<br><span class="hljs-symbol">$</span>(info <span class="hljs-symbol">$</span><span class="hljs-symbol">$</span>BOXMG_PRECISION is [<span class="hljs-symbol">$</span>&#123;BOXMG_PRECISION&#125;])<br><span class="hljs-symbol">$</span>(info <span class="hljs-symbol">$</span><span class="hljs-symbol">$</span>BOXMG_MPI is [<span class="hljs-symbol">$</span>&#123;BOXMG_MPI&#125;])<br></code></pre></td></tr></table></figure><ul><li>$ make</li></ul><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs stylus"> $ uname -<span class="hljs-selector-tag">a</span><br>Linux xxx <span class="hljs-number">4.18</span>.<span class="hljs-number">0</span>-<span class="hljs-number">477.10</span>.<span class="hljs-number">1</span><span class="hljs-selector-class">.el8_8</span><span class="hljs-selector-class">.x86_64</span> #<span class="hljs-number">1</span> SMP Tue May <span class="hljs-number">16</span> <span class="hljs-number">11</span>:<span class="hljs-number">38</span>:<span class="hljs-number">37</span> UTC <span class="hljs-number">2023</span> x86_64 x86_64 x86_64 GNU/Linux<br><br><span class="hljs-variable">$BOXMG_OS</span> is <span class="hljs-selector-attr">[Linux]</span><br><span class="hljs-variable">$BOXMG_CPU</span> is <span class="hljs-selector-attr">[AMD64]</span><br><span class="hljs-variable">$BOXMG_COMPILER</span> is <span class="hljs-selector-attr">[gnu]</span><br><span class="hljs-variable">$BOXMG_ARCHmake</span> is <span class="hljs-selector-attr">[./ARCH]</span><br><span class="hljs-variable">$BOXMG_ARCH</span> is <span class="hljs-selector-attr">[Linux-AMD64]</span><br><span class="hljs-variable">$BOXMG_PRECISION</span> is <span class="hljs-selector-attr">[SINGLE]</span><br><span class="hljs-variable">$BOXMG_MPI</span> is <span class="hljs-selector-attr">[yes]</span><br></code></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/bash</span><br><span class="hljs-built_in">export</span> WRF_ENV=<span class="hljs-string">&quot;/home/wpsze/WRF/WRFv440/wrf_env.sh&quot;</span><br><span class="hljs-built_in">source</span> <span class="hljs-variable">$&#123;WRF_ENV&#125;</span><br><br>gcc --version<br>gfortran --version<br>mpirun --version<br><span class="hljs-built_in">which</span> mpif90 &amp; mpif90 --version<br><span class="hljs-built_in">which</span> mpif77 <span class="hljs-comment"># Must</span><br><br><span class="hljs-built_in">export</span> BOXMG_MPI=<span class="hljs-built_in">yes</span><br>make<br></code></pre></td></tr></table></figure><div class="note note-success">            <p>The libraries ( libboxmg_opt_sgl.a, libboxmg-extras_opt_sgl.a ) will be in ./lib.</p>          </div><p>install process:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sh">.......<br>.......<br>gfortran   -funderscoring -DRKIND=4  -Waliasing -Wsurprising -O3  -c -o BMG_rand.o BMG_rand.f<br>ar csrv  ../../lib/libboxmg-extras_opt_sgl.a BMG_rand.o<br>a - BMG_rand.o<br><span class="hljs-built_in">rm</span> BMG_rand.o<br><br> $ ll lib<br>total 1.6M<br>drwxrwxr-x  2 wpsze wpsze  33K Sep 23 16:32 ./<br>drwxrwxr-x 11 wpsze wpsze  33K Sep 23 16:28 ../<br>-rw-rw-r--  1 wpsze wpsze    0 Sep 23 16:13 .keepme<br>-rw-rw-r--  1 wpsze wpsze 1.4M Sep 23 16:32 libboxmg-extras_opt_sgl.a<br>-rw-rw-r--  1 wpsze wpsze 1.4M Sep 23 16:30 libboxmg_opt_sgl.a<br></code></pre></td></tr></table></figure><ul><li><a href="https://forum.mmm.ucar.edu/threads/error-while-making-boxmg.12977/">Error while Making BoxMG?</a></li></ul><h3 id="test-boxmg">Test BoxMG</h3><ol type="1"><li>Go to /tests and make</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/bash</span><br><span class="hljs-built_in">export</span> WRF_ENV=<span class="hljs-string">&quot;/home/wpsze/WRF/WRFv440/wrf_env.sh&quot;</span><br><span class="hljs-built_in">source</span> <span class="hljs-variable">$&#123;WRF_ENV&#125;</span><br><br>gcc --version<br>gfortran --version<br>mpirun --version<br><span class="hljs-built_in">which</span> mpif90 &amp; mpif90 --version<br><span class="hljs-built_in">which</span> mpif77<br><br><span class="hljs-built_in">export</span> LDFLAGS=-L/home/wpsze/WRF/WRF4-elec/wrf_install/boxmg4wrf/lib<br><span class="hljs-built_in">export</span> LD_LIBRARY_PATH=/home/wpsze/WRF/WRF4-elec/wrf_install/boxmg4wrf/lib:<span class="hljs-variable">$LD_LIBRARY_PATH</span><br><span class="hljs-built_in">export</span> CPPFLAGS=-I/home/wpsze/WRF/WRF4-elec/wrf_install/boxmg4wrf/include<br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$&#123;LD_LIBRARY_PATH&#125;</span><br><br><span class="hljs-built_in">export</span> BOXMG_MPI=<span class="hljs-built_in">yes</span><br><br>make<br></code></pre></td></tr></table></figure><p>it shows,</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">- <span class="hljs-keyword">building </span><span class="hljs-keyword">boxmg-sym-std-2D </span>objects in libboxmg_opt_sgl.a ... <br>- <span class="hljs-keyword">building </span><span class="hljs-keyword">boxmg-sym-std-3D </span>objects in libboxmg_opt_sgl.a ... <br>- linking objects .... <br>- the executable ex_direct_1_f90 has <span class="hljs-keyword">been </span>created.<br></code></pre></td></tr></table></figure><ul><li>boxmg-sym-std-3D/ex_direct_1_f90 is successful.</li><li>All the rest fails. (why? related RKIND issue.)</li></ul><h3 id="configurecompile-wrf">Configure/compile WRF</h3><div class="note note-danger">            <p>Important note:<br />Compile WRF using <strong>only one core</strong> with BoxMG !!!<br />./compile -j 1 em_real 2&gt;&amp;1 | tee compile.log</p>          </div><p>To configure WRF, two environment variables must be set: WRF_ELEC and BOXMG</p><p>For bash:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">export</span> WRF_ELEC=1<br><span class="hljs-built_in">export</span> BOXMGLIBDIR=[path to boxmg directory]<br></code></pre></td></tr></table></figure><p>For example, if the boxmg library directory is /home/wpsze/WRF/WRF4-elec/wrf_install/boxmg4wrf/lib, then (for bash)</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">export</span> BOXMGLIBDIR=/home/wpsze/WRF/WRF4-elec/wrf_install/boxmg4wrf/<br></code></pre></td></tr></table></figure><p>Then run 'configure' in the WRF main directory and select an option for <strong>'dmpar' (distributed memory parallel)</strong>. The code is set up only to use the MPI parallel solver from BoxMG, so do not compile for serial mode. (It can still be run on a single processor, however.)</p><h2 id="microtedwrf4-elec">MicroTed/wrf4-elec</h2><p><a href="https://github.com/MicroTed/wrf4-elec" class="uri">https://github.com/MicroTed/wrf4-elec</a></p><p>The impact of initial conditions in predicting lightning activity using the Weather Research and Forecasting (WRF) with the electrification (ELEC) extra package, known as WRF-ELEC model, has been investigated.</p><h3 id="an-example-of-namelist.input">An example of namelist.input</h3><p><a href="https://github.com/MicroTed/wrf4-elec/blob/7c90e71bdc4db527d0ec034804e4fd200cdacf28/test/em_quarter_ss/electest/namelist.input#L55" class="uri">https://github.com/MicroTed/wrf4-elec/blob/7c90e71bdc4db527d0ec034804e4fd200cdacf28/test/em_quarter_ss/electest/namelist.input#L55</a></p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs makefile">&amp;physics<br>mp_physics                          = 18,     1,     1,<br>elec_physics                        = 1,<br>nssl_ipelec                         = 2,<br>nssl_cccn                           = 0.8e9,<br>nssl_isaund                         = 11,<br>nssl_iscreen                        = 1,<br>nssl_idischarge                     = 1,<br>nssl_ibrkd                          = 4,<br>ra_lw_physics                       = 0,     0,     0,<br>ra_sw_physics                       = 0,     0,     0,<br>radt                                = 30,    30,    30,<br>sf_sfclay_physics                   = 0,     0,     0,<br>sf_surface_physics                  = 0,     0,     0,<br>bl_pbl_physics                      = 0,     0,     0,<br>bldt                                = 0,     0,     0,<br>cu_physics                          = 0,     0,     0,<br>cudt                                = 5,     5,     5,<br>num_soil_layers                     = 5,<br>/<br></code></pre></td></tr></table></figure><h2 id="readme.electricity">README.electricity</h2><div class="note note-primary">            <p><a href="https://github.com/MicroTed/wrf4-elec/blob/7c90e71bdc4db527d0ec034804e4fd200cdacf28/doc/README.electricity#L41" class="uri">https://github.com/MicroTed/wrf4-elec/blob/7c90e71bdc4db527d0ec034804e4fd200cdacf28/doc/README.electricity#L41</a></p>          </div><h2 id="wrf4-elecs-registry.elec">wrf4-elec's registry.elec</h2><p><a href="https://github.com/MicroTed/wrf4-elec/blob/main/Registry/registry.elec" class="uri">https://github.com/MicroTed/wrf4-elec/blob/main/Registry/registry.elec</a></p><div class="note note-primary">            <p>Look at namelist !!</p>          </div><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-comment"># SPACE CHARGE EXPLICIT LIGHTNING</span><br><span class="hljs-attribute">state</span>   real    scr            ikjftb  scalar      <span class="hljs-number">1</span>         -     \<br>   <span class="hljs-attribute">i0rhusdf</span>=(bdy_interp:dt)    <span class="hljs-string">&quot;SCR&quot;</span>       <span class="hljs-string">&quot;Rain space charge mixing ratio&quot;</span> <span class="hljs-string">&quot;# C kg(-1)&quot;</span><br><span class="hljs-attribute">state</span>   real    scw            ikjftb  scalar      <span class="hljs-number">1</span>         -     \<br>   <span class="hljs-attribute">i0rhusdf</span>=(bdy_interp:dt)    <span class="hljs-string">&quot;SCW&quot;</span>       <span class="hljs-string">&quot;cloud water space charge mixing ratio&quot;</span> <span class="hljs-string">&quot;# C kg(-1)&quot;</span><br><span class="hljs-attribute">state</span>   real    sci            ikjftb  scalar      <span class="hljs-number">1</span>         -     \<br>   <span class="hljs-attribute">i0rhusdf</span>=(bdy_interp:dt)    <span class="hljs-string">&quot;SCI&quot;</span>       <span class="hljs-string">&quot;cloud ice space charge mixing ratio&quot;</span> <span class="hljs-string">&quot;# C kg(-1)&quot;</span><br><span class="hljs-attribute">state</span>   real    scs            ikjftb  scalar      <span class="hljs-number">1</span>         -     \<br>   <span class="hljs-attribute">i0rhusdf</span>=(bdy_interp:dt)    <span class="hljs-string">&quot;SCS&quot;</span>       <span class="hljs-string">&quot;snow space charge mixing ratio&quot;</span> <span class="hljs-string">&quot;# C kg(-1)&quot;</span><br><span class="hljs-attribute">state</span>   real    sch            ikjftb  scalar      <span class="hljs-number">1</span>         -     \<br>   <span class="hljs-attribute">i0rhusdf</span>=(bdy_interp:dt)    <span class="hljs-string">&quot;SCH&quot;</span>       <span class="hljs-string">&quot;graupel water space charge mixing ratio&quot;</span> <span class="hljs-string">&quot;# C kg(-1)&quot;</span><br><span class="hljs-attribute">state</span>   real    schl           ikjftb  scalar      <span class="hljs-number">1</span>         -     \<br>   <span class="hljs-attribute">i0rhusdf</span>=(bdy_interp:dt)    <span class="hljs-string">&quot;SCHL&quot;</span>       <span class="hljs-string">&quot;hail water space charge mixing ratio&quot;</span> <span class="hljs-string">&quot;# C kg(-1)&quot;</span><br><span class="hljs-attribute">state</span>   real    sciona          ikjftb  scalar      <span class="hljs-number">1</span>         -     \<br>   <span class="hljs-attribute">i0rhusdf</span>=(bdy_interp:dt)    <span class="hljs-string">&quot;SCIONA&quot;</span>       <span class="hljs-string">&quot;Passive net ion space charge&quot;</span> <span class="hljs-string">&quot;# C kg(-1)&quot;</span><br><span class="hljs-attribute">state</span>   real    clnox          ikjftb  scalar      <span class="hljs-number">1</span>         -     \<br>   <span class="hljs-attribute">i0rhusdf</span>=(bdy_interp:dt)    <span class="hljs-string">&quot;CLNOX&quot;</span>      <span class="hljs-string">&quot;Lightning NOx concentration&quot;</span> <span class="hljs-string">&quot;# moles kg(-1)&quot;</span><br><span class="hljs-comment"># END SPACE CHARGE EXPLICIT LIGHTNING</span><br><br><span class="hljs-comment"># EXPLICIT LIGHTNING</span><br><span class="hljs-comment">#</span><br><span class="hljs-attribute">state</span>    real    rscghis_2d      ij   misc    <span class="hljs-number">1</span>         -     irh         <span class="hljs-string">&quot;rscghis_2d&quot;</span>             <span class="hljs-string">&quot;MAX NONINDUCTIVE CHARGING 2D&quot;</span>     <span class="hljs-string">&quot;C m-2&quot;</span><br><span class="hljs-attribute">state</span>    real    induc           ikj  misc    <span class="hljs-number">1</span>         -     irh         <span class="hljs-string">&quot;induc&quot;</span>                  <span class="hljs-string">&quot;TOTAL INDUCTIVE CHARGING &quot;</span>     <span class="hljs-string">&quot;C m-3&quot;</span><br><span class="hljs-attribute">state</span>    real    noninduc        ikj  misc    <span class="hljs-number">1</span>         -     irh         <span class="hljs-string">&quot;noninduc&quot;</span>               <span class="hljs-string">&quot;TOTAL NONINDUCTIVE CHARGING&quot;</span>     <span class="hljs-string">&quot;C m-3&quot;</span><br><span class="hljs-attribute">state</span>    real    sctot           ikj  misc    <span class="hljs-number">1</span>         -     irh         <span class="hljs-string">&quot;sctot&quot;</span>                  <span class="hljs-string">&quot;Total Space Charge Density&quot;</span>     <span class="hljs-string">&quot;C m-3&quot;</span><br><span class="hljs-attribute">state</span>    real    elecmag         ikj  misc    <span class="hljs-number">1</span>         -     irh         <span class="hljs-string">&quot;elecmag&quot;</span>                <span class="hljs-string">&quot;EFIELD MAGNITUDE&quot;</span>     <span class="hljs-string">&quot;V m-1&quot;</span><br><span class="hljs-attribute">state</span>    real    elecx           ikj  misc    <span class="hljs-number">1</span>         -     irh         <span class="hljs-string">&quot;elecx&quot;</span>                  <span class="hljs-string">&quot;EFIELD X-Component&quot;</span>     <span class="hljs-string">&quot;V m-1&quot;</span><br><span class="hljs-attribute">state</span>    real    elecy           ikj  misc    <span class="hljs-number">1</span>         -     irh         <span class="hljs-string">&quot;elecy&quot;</span>                  <span class="hljs-string">&quot;EFIELD Y-Component&quot;</span>     <span class="hljs-string">&quot;V m-1&quot;</span><br><span class="hljs-attribute">state</span>    real    elecz           ikj  misc    <span class="hljs-number">1</span>         -     irh         <span class="hljs-string">&quot;elecz&quot;</span>                  <span class="hljs-string">&quot;EFIELD Z-Component&quot;</span>     <span class="hljs-string">&quot;V m-1&quot;</span><br><span class="hljs-attribute">state</span>    real    pot             ikj  misc    <span class="hljs-number">1</span>         -     irh         <span class="hljs-string">&quot;pot&quot;</span>                    <span class="hljs-string">&quot;POTENTIAL&quot;</span>     <span class="hljs-string">&quot;V&quot;</span><br><span class="hljs-attribute">state</span>    real    light            ij  misc    <span class="hljs-number">1</span>         -     irh         <span class="hljs-string">&quot;light&quot;</span>                  <span class="hljs-string">&quot;lightning flash initiations&quot;</span>         <span class="hljs-string">&quot;flash origin density&quot;</span><br><span class="hljs-attribute">state</span>    real    lightdens        ij  misc    <span class="hljs-number">1</span>         -     irh         <span class="hljs-string">&quot;lightdens&quot;</span>              <span class="hljs-string">&quot;lightning flash density&quot;</span>    <span class="hljs-string">&quot;flash column-1&quot;</span><br><span class="hljs-attribute">state</span>    real    lightfod         ij  misc    <span class="hljs-number">1</span>         -     irh         <span class="hljs-string">&quot;lightfod&quot;</span>               <span class="hljs-string">&quot;normalized lightning flash origin density&quot;</span>   <span class="hljs-string">&quot;flash column-1&quot;</span><br><span class="hljs-attribute">state</span>    real    flshfedic        ij  misc    <span class="hljs-number">1</span>         -     irh         <span class="hljs-string">&quot;flshfedic&quot;</span>              <span class="hljs-string">&quot;IC lightning flash extent density&quot;</span>         <span class="hljs-string">&quot;flash column-1&quot;</span><br><span class="hljs-attribute">state</span>    real    flshfedicp       ij  misc    <span class="hljs-number">1</span>         -     irh         <span class="hljs-string">&quot;flshfedicp&quot;</span>             <span class="hljs-string">&quot;IC pos lightning flash extent density&quot;</span>         <span class="hljs-string">&quot;flash column-1&quot;</span><br><span class="hljs-attribute">state</span>    real    flshfedicn       ij  misc    <span class="hljs-number">1</span>         -     irh         <span class="hljs-string">&quot;flshfedicn&quot;</span>             <span class="hljs-string">&quot;IC neg lightning flash extent density&quot;</span>         <span class="hljs-string">&quot;flash column-1&quot;</span><br><span class="hljs-attribute">state</span>    real    flshfedcg        ij  misc    <span class="hljs-number">1</span>         -     irh         <span class="hljs-string">&quot;flshfedcg&quot;</span>              <span class="hljs-string">&quot;CG lightning flash extent density&quot;</span>         <span class="hljs-string">&quot;flash column-1&quot;</span><br><span class="hljs-attribute">state</span>    real    flshfedcgn       ij  misc    <span class="hljs-number">1</span>         -     irh         <span class="hljs-string">&quot;flshfedcgn&quot;</span>             <span class="hljs-string">&quot;CG neg lightning flash extent density&quot;</span>         <span class="hljs-string">&quot;flash column-1&quot;</span><br><span class="hljs-attribute">state</span>    real    flshfedcgp       ij  misc    <span class="hljs-number">1</span>         -     irh         <span class="hljs-string">&quot;flshfedcgp&quot;</span>             <span class="hljs-string">&quot;CG pos lightning flash extent density&quot;</span>         <span class="hljs-string">&quot;flash column-1&quot;</span><br><span class="hljs-attribute">state</span>    real    lightdis         ij  misc    <span class="hljs-number">1</span>         -     irh         <span class="hljs-string">&quot;lightdis&quot;</span>               <span class="hljs-string">&quot;lightning source density&quot;</span>     <span class="hljs-string">&quot;Source column-1&quot;</span><br><span class="hljs-attribute">state</span>    real    flshi           ikj  misc    <span class="hljs-number">1</span>         -     irh         <span class="hljs-string">&quot;flshi&quot;</span>                  <span class="hljs-string">&quot;Lightning init points&quot;</span>     <span class="hljs-string">&quot;count&quot;</span><br><span class="hljs-attribute">state</span>    real    flshn           ikj  misc    <span class="hljs-number">1</span>         -     irh         <span class="hljs-string">&quot;flshn&quot;</span>                  <span class="hljs-string">&quot;Negative channels&quot;</span>     <span class="hljs-string">&quot;count&quot;</span><br><span class="hljs-attribute">state</span>    real    flshp           ikj  misc    <span class="hljs-number">1</span>         -     irh         <span class="hljs-string">&quot;flshp&quot;</span>                  <span class="hljs-string">&quot;Positive channels&quot;</span>     <span class="hljs-string">&quot;count&quot;</span><br><span class="hljs-comment"># END EXPLICIT LIGHTNING</span><br><br><br><span class="hljs-comment"># Explicit lightning</span><br><span class="hljs-attribute">rconfig</span>   integer  nssl_ipelec            namelist,physics      max_domains   <span class="hljs-number">0</span>       rh       <span class="hljs-string">&quot;Electrification selection&quot;</span>  <span class="hljs-string">&quot;&quot;</span>      <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-attribute">rconfig</span>   integer  nssl_isaund            namelist,physics      <span class="hljs-number">1</span>             <span class="hljs-number">12</span>      rh       <span class="hljs-string">&quot;Charge separation selection&quot;</span>  <span class="hljs-string">&quot;&quot;</span>      <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-attribute">rconfig</span>   integer  nssl_iscreen           namelist,physics      <span class="hljs-number">1</span>             <span class="hljs-number">0</span>       rh       <span class="hljs-string">&quot;Screening layer parameterization flag&quot;</span>  <span class="hljs-string">&quot;&quot;</span>      <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-attribute">rconfig</span>   real     nssl_lightrad          namelist,physics      <span class="hljs-number">1</span>             <span class="hljs-number">12000</span>   rh       <span class="hljs-string">&quot;discharge cylinder radius (m)&quot;</span>  <span class="hljs-string">&quot;&quot;</span>      <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-attribute">rconfig</span>   integer  nssl_idischarge        namelist,physics      <span class="hljs-number">1</span>             <span class="hljs-number">1</span>       rh       <span class="hljs-string">&quot;lightning discharge flag&quot;</span>  <span class="hljs-string">&quot;&quot;</span>      <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-attribute">rconfig</span>   integer  nssl_ibrkd             namelist,physics      <span class="hljs-number">1</span>             <span class="hljs-number">4</span>       rh       <span class="hljs-string">&quot;Critical Breakeven Efield profile selection&quot;</span>  <span class="hljs-string">&quot;&quot;</span>      <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-attribute">rconfig</span>   real     nssl_elgtfestop        namelist,physics      <span class="hljs-number">1</span>             <span class="hljs-number">0</span>.<span class="hljs-number">8</span>     rh       <span class="hljs-string">&quot;3D lightning initial channel stopping fraction&quot;</span>  <span class="hljs-string">&quot;&quot;</span>      <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-attribute">rconfig</span>   real     nssl_ecrit             namelist,physics      <span class="hljs-number">1</span>             <span class="hljs-number">120000</span>  rh       <span class="hljs-string">&quot;Critical Breakeven Efield magnitude for discharge (V/m) assuming height-constant Ecrit profile&quot;</span>  <span class="hljs-string">&quot;&quot;</span>      <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-attribute">rconfig</span>   real     nssl_disfrac           namelist,physics      <span class="hljs-number">1</span>             <span class="hljs-number">0</span>.<span class="hljs-number">3</span>     rh       <span class="hljs-string">&quot;percentile of charge removed upon discharge (BLM)&quot;</span>  <span class="hljs-string">&quot;&quot;</span>      <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-attribute">rconfig</span>   real     nssl_einternal         namelist,physics      <span class="hljs-number">1</span>           <span class="hljs-number">200</span>.<span class="hljs-number">0</span>     rh       <span class="hljs-string">&quot;Lightning channel internal field (MSZ)&quot;</span>  <span class="hljs-string">&quot;&quot;</span>      <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-attribute">rconfig</span>   real     nssl_tgrnd             namelist,physics      <span class="hljs-number">1</span>           <span class="hljs-number">266</span>.<span class="hljs-number">16</span>    rh       <span class="hljs-string">&quot;Temperature threshold for CG (MSZ)&quot;</span>  <span class="hljs-string">&quot;&quot;</span>      <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-attribute">rconfig</span>   real     nssl_zgrnd             namelist,physics      <span class="hljs-number">1</span>             -<span class="hljs-number">1</span>.     rh       <span class="hljs-string">&quot;Height threshold for CG (MSZ)&quot;</span>  <span class="hljs-string">&quot;&quot;</span>      <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-attribute">rconfig</span>   integer  nssl_clnox             namelist,physics      <span class="hljs-number">1</span>             <span class="hljs-number">0</span>       rh       <span class="hljs-string">&quot;Lightning NOX prediction flag&quot;</span>  <span class="hljs-string">&quot;&quot;</span>      <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-comment"># end Explicit lightning</span><br><br><span class="hljs-attribute">rconfig</span>   integer  elec_physics           namelist,physics      <span class="hljs-number">1</span>            <span class="hljs-number">0</span>       irh       <span class="hljs-string">&quot;elec_physics&quot;</span>            <span class="hljs-string">&quot;&quot;</span>      <span class="hljs-string">&quot;&quot;</span><br><br><span class="hljs-comment"># external WRF-ELEC package</span><br><span class="hljs-attribute">package</span>   noelec             elec_physics==<span class="hljs-number">0</span>             -             -<br><span class="hljs-attribute">package</span>   eleclgt            elec_physics==<span class="hljs-number">1</span>             -             scalar:scr,scw,sci,scs,sch,schl,sciona;state:rscghis_2d,sctot,noninduc,induc,pot,elecmag,elecx,elecy,elecz,light,lightdens,lightdis<br><span class="hljs-comment"># for case of no hail (nssl_2momg)</span><br><span class="hljs-attribute">package</span>   eleclgtg           elec_physics==<span class="hljs-number">11</span>            -             scalar:scr,scw,sci,scs,sch,sciona;state:rscghis_2d,sctot,noninduc,induc,pot,elecmag,elecx,elecy,elecz,light,lightdens,lightdis,lightfod<br><br><span class="hljs-attribute">package</span> lightning1d          nssl_idischarge==<span class="hljs-number">1</span>   -    state:lightfod<br><span class="hljs-attribute">package</span> lightning3d          nssl_idischarge==<span class="hljs-number">2</span>   -    state:flshi,flshn,flshp,flshfedic,flshfedicp,flshfedicn,flshfedcg,flshfedcgp,flshfedcgn<br><span class="hljs-comment"># package lightning3da         nssl_idischarge==3   -    state:flshi,flshn,flshp</span><br><br><span class="hljs-attribute">package</span> nssl_cnox_off nssl_clnox==<span class="hljs-number">0</span>   -   -<br><span class="hljs-attribute">package</span> nssl_cnox_on  nssl_clnox==<span class="hljs-number">1</span>   -   scalar:clnox<br></code></pre></td></tr></table></figure><p>here noted,</p><!-- <style>tr:nth-child(even) {  background-color: #b2b2b2!important;  !color: #f4f4f4!important;}</style> --><table><thead><tr class="header"><th style="text-align: left;">elec_physics</th><th style="text-align: center;">nssl_ipelec</th><th style="text-align: center;">nssl_idischarge</th><th style="text-align: left;">outputs</th></tr></thead><tbody><tr class="odd"><td style="text-align: left;">1</td><td style="text-align: center;">2</td><td style="text-align: center;">1</td><td style="text-align: left;">?</td></tr><tr class="even"><td style="text-align: left;">1</td><td style="text-align: center;">3</td><td style="text-align: center;">1</td><td style="text-align: left;">scalar:scr,scw,sci,scs,sch,schl,sciona; <br> state:rscghis_2d,sctot,noninduc,induc,pot, <br> elecmag,elecx,elecy,elecz,light,lightdens,lightdis</td></tr><tr class="odd"><td style="text-align: left;">1</td><td style="text-align: center;">3</td><td style="text-align: center;">2</td><td style="text-align: left;">state:flshi,flshn,flshp,flshfedic, <br> flshfedicp,flshfedicn,flshfedcg,flshfedcgp,flshfedcgn</td></tr></tbody></table><h2 id="specific-namelist.input-options">Specific namelist.input options</h2><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><code class="hljs csharp">Specific namelist.input options are given below, along <span class="hljs-keyword">with</span> a list of output fields.<br><br><br>Electrification only works <span class="hljs-keyword">with</span> the NSSL <span class="hljs-number">2</span>-<span class="hljs-function">moment <span class="hljs-title">options</span> (<span class="hljs-params"><span class="hljs-keyword">with</span> hail</span>):</span><br><span class="hljs-function"></span><br><span class="hljs-function"> <span class="hljs-title">mp_physics</span>(<span class="hljs-params">max_dom</span>)</span><br>                                     = <span class="hljs-number">17</span>, NSSL <span class="hljs-number">2</span>-moment <span class="hljs-number">4</span>-<span class="hljs-function">ice <span class="hljs-title">scheme</span> (<span class="hljs-params">steady background CCN</span>)</span><br>                                     = <span class="hljs-number">18</span>, NSSL <span class="hljs-number">2</span>-moment <span class="hljs-number">4</span>-<span class="hljs-function">ice scheme <span class="hljs-keyword">with</span> predicted <span class="hljs-title">CCN</span> (<span class="hljs-params">better <span class="hljs-keyword">for</span> idealized than real cases</span>)</span><br>                                       ; to <span class="hljs-keyword">set</span> a <span class="hljs-keyword">global</span> CCN <span class="hljs-keyword">value</span>, use<br>                                     = <span class="hljs-number">22</span>, NSSL <span class="hljs-number">2</span>-moment <span class="hljs-number">3</span>-ice (hail species turned off)<br>                                       <br>Other variables <span class="hljs-keyword">in</span> the &amp;physics namelist:<br><br> elec_physics                        = <span class="hljs-number">0</span>, electrification (<span class="hljs-keyword">and</span> charge arrays) <span class="hljs-function">turned <span class="hljs-title">off</span> (<span class="hljs-params">DEFAULT</span>)</span><br>                                     = <span class="hljs-number">1</span>, <span class="hljs-function">electrification turned <span class="hljs-title">on</span> (<span class="hljs-params">only works <span class="hljs-keyword">with</span> mp_physics = <span class="hljs-number">17</span>, <span class="hljs-number">18</span>, <span class="hljs-keyword">or</span> <span class="hljs-number">22</span> i.e., <span class="hljs-number">2</span>-moment NSSL schemes</span>)</span><br><span class="hljs-function"></span><br><span class="hljs-function"> <span class="hljs-title">nssl_ipelec</span> (<span class="hljs-params">max_dom</span>)     ! NOTE: only <span class="hljs-keyword">set</span> <span class="hljs-keyword">this</span> to a nonzero <span class="hljs-keyword">value</span> <span class="hljs-keyword">on</span> the innermost domain</span><br>                                     = <span class="hljs-number">0</span>, <span class="hljs-function">charging turned <span class="hljs-title">off</span> (<span class="hljs-params">DEFAULT</span>)</span><br>                                     = <span class="hljs-number">2</span>, non-inductive charging only<br>                                     = <span class="hljs-number">3</span>, non-inductive + inductive charging<br>                                     = <span class="hljs-number">1</span>, <span class="hljs-function"><span class="hljs-keyword">not</span> <span class="hljs-title">used</span> (<span class="hljs-params">reserved <span class="hljs-keyword">for</span> future use</span>)</span><br><span class="hljs-function"></span><br><span class="hljs-function"> nssl_idischarge</span>                     = <span class="hljs-number">0</span>, no discharge<br>                                     = <span class="hljs-number">1</span>, Cylindrical <span class="hljs-string">&quot;1D&quot;</span> <span class="hljs-function">lightning scheme based <span class="hljs-keyword">on</span> Ziegler <span class="hljs-keyword">and</span> <span class="hljs-title">MacGorman</span> (<span class="hljs-params"><span class="hljs-number">1994</span>, JAS</span>)</span> <br>                                     = <span class="hljs-number">2</span>, <span class="hljs-number">3</span>D discrete discharge adapted <span class="hljs-keyword">from</span> MacGorman et al. (<span class="hljs-number">2001</span>)<br><br> nssl_iscreen                        = <span class="hljs-number">0</span>, <span class="hljs-function">no screening <span class="hljs-title">layer</span> (<span class="hljs-params">DEFAULT</span>)</span><br>                                     = <span class="hljs-number">1</span>, screening layer scheme of Ziegler et al. (<span class="hljs-number">1991</span>, JGR)<br>                                     = <span class="hljs-number">2</span>, <span class="hljs-function">screening layer only applied at cloud <span class="hljs-title">top</span> (<span class="hljs-params">seems to be better <span class="hljs-keyword">for</span> storm complexes <span class="hljs-keyword">and</span> large storms</span>)</span><br><span class="hljs-function"></span><br><span class="hljs-function"> nssl_ibrkd</span>                          = breakdown electric field profile to initiate lightning<br>                                     = <span class="hljs-number">1</span>, constant profile <span class="hljs-keyword">with</span> height <span class="hljs-keyword">with</span> <span class="hljs-keyword">value</span> <span class="hljs-keyword">set</span> <span class="hljs-keyword">by</span> nssl_ecrit<br>                                     = <span class="hljs-number">2</span> to <span class="hljs-number">5</span>, <span class="hljs-function">variants of vertical Ecrit profile of <span class="hljs-title">Dwyer</span> (<span class="hljs-params"><span class="hljs-number">2003</span>, GRL</span>) - &#x27;4&#x27; <span class="hljs-keyword">is</span> <span class="hljs-title">recommended</span> (<span class="hljs-params">DEFAULT <span class="hljs-keyword">is</span> <span class="hljs-number">4</span></span>).</span><br><span class="hljs-function"></span><br><span class="hljs-function"> nssl_isaund</span>                         = <span class="hljs-function">Calls the appropriate version of the <span class="hljs-title">UMIST</span> (<span class="hljs-params">e.g., Saunders et al. <span class="hljs-number">1991</span> scheme</span>)</span><br>                                     = <span class="hljs-number">-5</span> : Saunders etal <span class="hljs-number">1991</span> (following Helsdon et al. <span class="hljs-number">2001</span>, but use normal charging instead of <span class="hljs-string">&#x27;anomalous&#x27;</span> zones)<br>                                     = <span class="hljs-number">0</span> : Saunders <span class="hljs-number">1991</span> (modified <span class="hljs-keyword">as</span> <span class="hljs-keyword">in</span> Wojcik <span class="hljs-number">1994</span>)<br>                                     = <span class="hljs-number">2</span> : <span class="hljs-function">RR <span class="hljs-title">scheme</span> (<span class="hljs-params"> no extra factor </span>) (<span class="hljs-params">Mansell et al. <span class="hljs-number">2005</span>, JGR</span>)</span><br>                                     = <span class="hljs-number">4</span> : <span class="hljs-function">Saunders <span class="hljs-keyword">and</span> Peck <span class="hljs-title">Scheme</span> (<span class="hljs-params"> no extra factor </span>) (<span class="hljs-params">Mansell et al. <span class="hljs-number">2005</span>, JGR</span>)</span><br>                                     = <span class="hljs-number">9</span> : <span class="hljs-function">Saunders <span class="hljs-keyword">and</span> Peck <span class="hljs-title">Scheme</span> (<span class="hljs-params"> no extra factor, cutoff at <span class="hljs-number">-32.47</span> <span class="hljs-keyword">as</span> orig eq. <span class="hljs-keyword">from</span> sp98 </span>) (<span class="hljs-params">Mansell et al. <span class="hljs-number">2010</span>, JAS</span>)</span><br>                                     = <span class="hljs-number">10</span> : Brooks et al. RARcrit <span class="hljs-keyword">for</span> T &gt; <span class="hljs-number">-15</span> <span class="hljs-function"><span class="hljs-keyword">using</span> <span class="hljs-title">saund2</span> (<span class="hljs-params">otherwise same <span class="hljs-keyword">as</span> isaund=<span class="hljs-number">2</span></span>) (<span class="hljs-params"><span class="hljs-keyword">set</span> rarfac to negative <span class="hljs-keyword">in</span> saund2</span>)</span><br>                                     = <span class="hljs-number">11</span> : Brooks et al. RARcrit <span class="hljs-keyword">for</span> T &gt; <span class="hljs-number">-15</span> <span class="hljs-function"><span class="hljs-keyword">using</span> <span class="hljs-title">saund6</span> (<span class="hljs-params">otherwise same <span class="hljs-keyword">as</span> isaund=<span class="hljs-number">4</span></span>)</span><br>                                     = <span class="hljs-number">12</span> : Brooks et al. RARcrit <span class="hljs-keyword">for</span> T &gt; <span class="hljs-number">-15</span> <span class="hljs-function"><span class="hljs-keyword">using</span> <span class="hljs-title">saund6</span> (<span class="hljs-params">otherwise same <span class="hljs-keyword">as</span> isaund=<span class="hljs-number">9</span></span>) (<span class="hljs-params">DEFAULT</span>)</span><br>                                     = <span class="hljs-number">13</span> : Brooks et al. RARcrit <span class="hljs-keyword">for</span> T &gt; <span class="hljs-number">-15</span> <span class="hljs-function"><span class="hljs-keyword">using</span> <span class="hljs-title">saund8</span> (<span class="hljs-params">cosine roll-off function <span class="hljs-keyword">for</span> smoother approach to zero at low temperature</span>)</span><br><span class="hljs-function">                                   For <span class="hljs-title">Takahashi</span> (<span class="hljs-params"><span class="hljs-number">1978</span>, <span class="hljs-number">1984</span></span>) charge <span class="hljs-title">separation</span> (<span class="hljs-params">see below</span>)</span><br>                                     = <span class="hljs-number">1</span> : Takahashi <span class="hljs-number">1984</span> <span class="hljs-keyword">with</span> factors <span class="hljs-keyword">for</span> crystal size <span class="hljs-keyword">and</span> impact speed<br>                                     = <span class="hljs-number">3</span> : Takahashi <span class="hljs-number">1984</span> WITHOUT factors <span class="hljs-keyword">for</span> crystal size <span class="hljs-keyword">and</span> impact speed<br><br><br> nssl_lightrad                       = <span class="hljs-number">12000</span>, radius (m) of discharge cylinder <span class="hljs-keyword">for</span> <span class="hljs-number">1</span>-D discharge scheme<br><br> nssl_disfrac                        = <span class="hljs-number">0.3</span>, <span class="hljs-function">nominal fraction of charge removed per <span class="hljs-title">discharge</span> (<span class="hljs-params"><span class="hljs-keyword">for</span> <span class="hljs-number">1</span>D lightning</span>)</span><br><span class="hljs-function"></span><br><span class="hljs-function"> nssl_ecrit</span>                          = <span class="hljs-number">120000</span>, <span class="hljs-function">breakdown electric <span class="hljs-title">field</span> (<span class="hljs-params">Volts/m</span>) to initiate <span class="hljs-title">lightning</span> (<span class="hljs-params">i.e., constant <span class="hljs-keyword">value</span> <span class="hljs-keyword">with</span> height</span>). (<span class="hljs-params"><span class="hljs-keyword">for</span> nssl_ibrkd=<span class="hljs-number">1</span></span>)</span><br><span class="hljs-function"></span><br><span class="hljs-function"> 3D discharge namelist options</span><br><span class="hljs-function"> NSSL_EINTERNAL</span>  =   <span class="hljs-number">200.0000</span>  : <span class="hljs-function"><span class="hljs-keyword">internal</span> field <span class="hljs-keyword">for</span> channel <span class="hljs-title">resistance</span> (<span class="hljs-params">V/m</span>)</span><br><span class="hljs-function"> NSSL_TGRND</span>      =   <span class="hljs-number">266.1600</span>  : Temperature threshold <span class="hljs-keyword">for</span> considering CG flash<br> NSSL_ZGRND      =  <span class="hljs-number">-1.000000</span>  : <span class="hljs-function">Altitude threshold <span class="hljs-keyword">for</span> considering CG <span class="hljs-title">flash</span> (<span class="hljs-params">only <span class="hljs-keyword">if</span> &gt; <span class="hljs-number">0</span>, otherwise uses temperature</span>)</span><br><span class="hljs-function"></span><br><span class="hljs-function">The <span class="hljs-title">Takahashi</span> (<span class="hljs-params"><span class="hljs-number">1978</span>, <span class="hljs-number">1984</span></span>) charge separation requires a lookup table to be read <span class="hljs-keyword">in</span>. </span><br><span class="hljs-function">The table file <span class="hljs-keyword">is</span> &#x27;takahashi.txt&#x27; <span class="hljs-keyword">and</span> needs to be copied <span class="hljs-keyword">from</span> WRF/elec to the working </span><br><span class="hljs-function">directory. To use <span class="hljs-keyword">this</span> option, the NSSL microphysics can read an <span class="hljs-keyword">internal</span> namelist, </span><br><span class="hljs-function">which needs &#x27;nonigrd</span> = <span class="hljs-number">-1&#x27;</span>:<br><br>&amp;nssl_mp_params<br>  nonigrd = <span class="hljs-number">-1</span><br>/<br><br>Also <span class="hljs-keyword">set</span> the <span class="hljs-keyword">value</span> nssl_isaund=<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><h2 id="output-fields">Output fields</h2><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver"><span class="hljs-number">2</span>D, <span class="hljs-built_in">time</span>-dependent:<br><br>  LIGHT      : Sum <span class="hljs-keyword">of</span> lightning initations <span class="hljs-keyword">in</span> <span class="hljs-keyword">the</span> column (For <span class="hljs-number">1</span>D discharge, this counts all points that <br>                 have electric field magnitude that exceeds <span class="hljs-keyword">the</span> initiation threshold<br>  LIGHTDENS  : Flash extent density (FED; <span class="hljs-built_in">sum</span> <span class="hljs-keyword">of</span> <span class="hljs-keyword">the</span> <span class="hljs-built_in">number</span> <span class="hljs-keyword">of</span> flashes that extend <span class="hljs-keyword">into</span> <span class="hljs-keyword">the</span> grid column)<br>  LIGHTDIS   : A kind <span class="hljs-keyword">of</span> <span class="hljs-string">&quot;source point&quot;</span> density that adds up <span class="hljs-keyword">the</span> <span class="hljs-built_in">number</span> <span class="hljs-keyword">of</span> points <span class="hljs-keyword">in</span> <span class="hljs-keyword">a</span> column where<br>                 lightning charge is deposited<br>  rscghis_2d : column <span class="hljs-built_in">sum</span> <span class="hljs-keyword">of</span> charge separation (magnitude) over <span class="hljs-keyword">the</span> history interval<br><br>  For <span class="hljs-number">3</span>D lightning:<br><br>   flshfedic - FED <span class="hljs-built_in">from</span> IC flashes<br>   flshfedicp - FED <span class="hljs-built_in">from</span> IC flashes (pos. channels)<br>   flshfedicn - FED <span class="hljs-built_in">from</span> IC flashes (neg. channels)<br>   flshfedcg - FED <span class="hljs-built_in">from</span> CG flashes<br>   flshfedcgp - FED <span class="hljs-built_in">from</span> CG flashes (pos. channels)<br>   flshfedcgn - FED <span class="hljs-built_in">from</span> CG flashes (neg. channels)<br>   <br><span class="hljs-number">3</span>D, <span class="hljs-built_in">time</span>-dependent:<br><br>  POT         : Electric potential (Volts)<br>  ELECMAG     : Electric field magnitude (V/m)<br>  ELECX       : x-component <span class="hljs-keyword">of</span> E (V/m)<br>  ELECY       : y-component <span class="hljs-keyword">of</span> E (V/m)<br>  ELECZ       : z-component <span class="hljs-keyword">of</span> E (V/m)<br>  INDUC       : Inductive charge separation rate (C m^<span class="hljs-number">-3</span> s^<span class="hljs-number">-1</span>)<br>  NONINDUC    : Net noninductive charge separation rate (C m^<span class="hljs-number">-3</span> s^<span class="hljs-number">-1</span>)<br>  SCW         : Charge density carried <span class="hljs-keyword">by</span> cloud droplets (C/kg, i.e., <span class="hljs-string">&#x27;charge mixing ratio&#x27;</span>)<br>  SCR         : Charge density carried <span class="hljs-keyword">by</span> rain (C/kg)<br>  SCI         : Charge density carried <span class="hljs-keyword">by</span> cloud ice (C/kg)<br>  SCS         : Charge density carried <span class="hljs-keyword">by</span> snow (C/kg)<br>  SCH         : Charge density carried <span class="hljs-keyword">by</span> graupel (C/kg)<br>  SCHL        : Charge density carried <span class="hljs-keyword">by</span> hail (C/kg)<br>  SCTOT       : Net charge density (C m^<span class="hljs-number">-3</span>) Is NOT mixing ratio<br>  SCIONA      : Residual charge <span class="hljs-built_in">from</span> lightning <span class="hljs-keyword">and</span> evaporating hydrometeors that has <span class="hljs-keyword">not</span> been reattached <span class="hljs-built_in">to</span> another species (C/kg)<br><br>  For <span class="hljs-number">3</span>D lightning:<br>    FLSHN, FLSHP : Negative/positive <span class="hljs-string">&quot;channel&quot;</span> points<br>    FLSHI : Flash initiation points<br></code></pre></td></tr></table></figure><h2 id="sourceforege">sourceforege</h2><p><a href="https://sourceforge.net/projects/wrfelec/files/" class="uri">https://sourceforge.net/projects/wrfelec/files/</a></p><p>Source: README.wrfelec, updated 2015-05-04</p><h1 id="compilation-process-details">Compilation process details</h1><ul><li>BoxMG directory: /home/wpsze/WRF/WRF4-elec/wrf_install/boxmg4wrf/</li></ul><div class="note note-danger">            <p>Important note:<br />Compile WRF using <strong>only one core</strong> with BoxMG !!!<br />./compile -j 1 em_real 2&gt;&amp;1 | tee compile.log</p>          </div><p>part of script is shown below,</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">export</span> WRF_ELEC=1<br><span class="hljs-built_in">export</span> BOXMGLIBDIR=/home/wpsze/WRF/WRF4-elec/wrf_install/boxmg4wrf<br><br><span class="hljs-built_in">cd</span> wrf4-elec/<br><br>./clean -a<br>./configure <br><span class="hljs-comment">##  9 (dmpar) GNU [gfortran/gcc]</span><br><br>sed -i <span class="hljs-string">&quot;s/\s\stime\s//g&quot;</span> configure.wrf<br>./compile -j 1 em_real 2&gt;&amp;1 | <span class="hljs-built_in">tee</span> compile.log<br></code></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><code class="hljs sh">checking <span class="hljs-keyword">for</span> perl5... no<br>checking <span class="hljs-keyword">for</span> perl... found /usr/bin/perl (perl)<br>Will use NETCDF <span class="hljs-keyword">in</span> <span class="hljs-built_in">dir</span>: /home/wpsze/WRF/WRFv440/Library/<br>ADIOS2 not <span class="hljs-built_in">set</span> <span class="hljs-keyword">in</span> environment. Will configure WRF <span class="hljs-keyword">for</span> use without.<br>Will use HDF5 <span class="hljs-keyword">in</span> <span class="hljs-built_in">dir</span>: /home/wpsze/WRF/WRFv440/Library/<br>PHDF5 not <span class="hljs-built_in">set</span> <span class="hljs-keyword">in</span> environment. Will configure WRF <span class="hljs-keyword">for</span> use without.<br>Building WRF with electrification option<br>!-DWRF_ELEC=1<br>Will use BoxMG <span class="hljs-keyword">in</span> <span class="hljs-built_in">dir</span>: /home/wpsze/WRF/WRF4-elec/wrf_install/boxmg4wrf/<br>Will use <span class="hljs-string">&#x27;time&#x27;</span> to report timing information<br><span class="hljs-built_in">set</span> sw_boxmg_path<br>WRF_ELEC was found <span class="hljs-keyword">in</span>  -DWRF_ELEC=1<br><span class="hljs-variable">$JASPERLIB</span> or <span class="hljs-variable">$JASPERINC</span> not found <span class="hljs-keyword">in</span> environment, configuring to build without grib2 I/O...<br>------------------------------------------------------------------------<br>Please <span class="hljs-keyword">select</span> from among the following Linux x86_64 options:<br><br>  1. (dmpar)   PGI (pgf90/gcc)<br>  2. (dmpar)   PGI (pgf90/pgcc): SGI MPT<br>  3. (dmpar)   PGI (pgf90/gcc): PGI accelerator<br>  4. (dmpar)   INTEL (ifort/icc)<br>               INTEL (ifort/icc): Xeon Phi (MIC architecture)<br>  5. (dmpar)   INTEL (ifort/icc): Xeon (SNB with AVX mods)<br>  6. (dmpar)   INTEL (ifort/icc): SGI MPT<br>  7. (dmpar)   INTEL (ifort/icc): IBM POE<br>  8. (dmpar)   PATHSCALE (pathf90/pathcc)<br>  9. (dmpar)   GNU (gfortran/gcc)<br> 1.  (dmpar)   IBM (xlf90_r/cc_r)<br> 2.  (dmpar)   PGI (ftn/gcc): Cray XC CLE<br> 3.  (dmpar)   CRAY CCE (ftn $(NOOMP)/cc): Cray XE and XC<br> 4.  (dmpar)   INTEL (ftn/icc): Cray XC<br> 5.  (dmpar)   PGI (pgf90/pgcc)<br> 6.  (dmpar)   PGI (pgf90/gcc): -f90=pgf90<br> 7.  (dmpar)   PGI (pgf90/pgcc): -f90=pgf90<br> 8.  (dmpar)   INTEL (ifort/icc): HSW/BDW<br> 9.  (dmpar)   INTEL (ifort/icc): KNL MIC<br> 10. (dmpar)   AMD (flang/clang) :  AMD ZEN1/ ZEN2/ ZEN3 Architectures<br> 11. (dmpar)   FUJITSU (frtpx/fccpx): FX10/FX100 SPARC64 IXfx/Xlfx<br><br>Enter selection [1-20] : 9<br><br>......<br><br><span class="hljs-comment">######################</span><br>------------------------------------------------------------------------<br>Settings listed above are written to configure.wrf.<br>If you wish to change settings, please edit that file.<br>If you wish to change the default options, edit the file:<br>     <span class="hljs-built_in">arch</span>/configure.defaults<br>NetCDF <span class="hljs-built_in">users</span> note:<br> This installation of NetCDF supports large file support.  To DISABLE large file<br> support <span class="hljs-keyword">in</span> NetCDF, <span class="hljs-built_in">set</span> the environment variable WRFIO_NCD_NO_LARGE_FILE_SUPPORT<br> to 1 and run configure again. Set to any other value to avoid this message.<br>  <br><br>Testing <span class="hljs-keyword">for</span> NetCDF, C and Fortran compiler<br><br>This installation of NetCDF is 64-bit<br>                 C compiler is 64-bit<br>           Fortran compiler is 64-bit<br>              It will build <span class="hljs-keyword">in</span> 64-bit<br> <br>NetCDF version: 4.7.4<br>Enabled NetCDF-4/HDF-5: <span class="hljs-built_in">yes</span><br>NetCDF built with PnetCDF: no<br></code></pre></td></tr></table></figure><p>there is an extra folder called "elec",</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh"> $ <span class="hljs-built_in">ls</span> wrf4-elec/elec/<br>binwrf.pl                           module_discharge.F<br>depend.elec                         module_discharge_msz.F<br>include_microphysics_driver_elec.F  module_mp_nssl_2mom_elec.F<br>include_solve_lightningnudge.F      module_nudge_light.F<br>Makefile                            module_screen.F<br>module_boxmgsetup.F                 takahashi.txt<br>module_commasmpi.F<br></code></pre></td></tr></table></figure><h1 id="compile-errors">Compile Errors</h1><ol type="1"><li>Error NoahMP submodule files not populating WRF directories.<ol type="1"><li><a href="https://waipangsze.github.io/2024/06/04/WRF_install_Error_NoahMP_submodule_files/" class="uri">https://waipangsze.github.io/2024/06/04/WRF_install_Error_NoahMP_submodule_files/</a></li><li>Download noahmp @ xxxx folder to your local /WRF/phys/</li><li>wrf4-elec is noahmp @ 3be0b28</li></ol></li><li>time No such file or directory.<ol type="1"><li><a href="https://waipangsze.github.io/2024/05/29/WRF_install_time_error/" class="uri">https://waipangsze.github.io/2024/05/29/WRF_install_time_error/</a></li></ol></li></ol><h1 id="done">Done</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sh">---&gt;                  Executables successfully built                  &lt;---<br> <br>-rwxrwxr-x 1 wpsze wpsze 44236440 Sep 24 14:26 main/ndown.exe<br>-rwxrwxr-x 1 wpsze wpsze 44121776 Sep 24 14:26 main/real.exe<br>-rwxrwxr-x 1 wpsze wpsze 43532016 Sep 24 14:26 main/tc.exe<br>-rwxrwxr-x 1 wpsze wpsze 50585304 Sep 24 14:25 main/wrf.exe<br><br> $ <span class="hljs-built_in">ls</span> run/*exe<br>run/ndown.exe  run/real.exe  run/tc.exe  run/wrf.ex<br></code></pre></td></tr></table></figure><h1 id="wrf-elec-outputs">WRF-ELEC outputs</h1><p>It is important to note that the FOD and reflectivity are derived from ELEC, whereas the LPI originates from WRF-ARW simulations.</p><h2 id="simulated-radar-reflectivity">simulated radar reflectivity</h2><p>radar reflectivity is diagnosed.</p><ul><li><a href="https://wrf-python.readthedocs.io/en/latest/user_api/generated/wrf.dbz.html" class="uri">https://wrf-python.readthedocs.io/en/latest/user_api/generated/wrf.dbz.html</a></li><li>This function computes equivalent reflectivity factor [dBZ] at each model grid point assuming spherical particles of constant density, with exponential size distributions. This function is based on â€œdbzcalc.fâ€ in RIP.</li></ul><p>or on namelist,</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">&amp;physics<br>...<br>do_radar_ref = 0, ; 1 = allows radar reflectivity to be computed using mp-scheme-specific parameters.  Currently works <span class="hljs-keyword">for</span> mp_physics = 2,4,6,7,8,10,14,16<br></code></pre></td></tr></table></figure><p>with do_radar_reflectivity=1 and after running got the REFL_10cm variable. But this variable REFL_10cm is giving the estimated 10 cm wavelength (S-band) radar reflectivity in dB relative to reflectivity (dBZ) as produced by the WRF microphysics scheme.</p><blockquote><p>but, above mp_physics = 17 or 18?</p></blockquote><h2 id="lightning_option-from-wrf-arw">lightning_option (from WRF-ARW)</h2><p>Lightning parameterization option to allow flash rate prediction without chemistry.</p><p><a href="https://ruc.noaa.gov/wrf/wrf-chem/Users_guide.pdf">WRF-Chem Version 4.4 User's Guide: Appendix C: Using the Lightning-NOx Parameterization in WRF-Chem</a></p><div class="note note-primary">            <p>(for convection resolved runs; must also use do_radar_ref = 1, and mp_physics = 2,4,6,7,8,10,14, or 16)</p>          </div><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">lightning_option (max_dom)                       Lightning parameterization <span class="hljs-keyword">option</span> <span class="hljs-keyword">to</span> allow flash rate prediction <span class="hljs-keyword">without</span> chemistry<br>                                    = <span class="hljs-number">0</span>        ! <span class="hljs-keyword">off</span><br>                                    = <span class="hljs-number">1</span>        ! PR92 based <span class="hljs-keyword">on</span> maximum w, redistributes flashes <span class="hljs-keyword">within</span> dBZ &gt; <span class="hljs-number">20</span> (<span class="hljs-keyword">for</span> convection resolved runs; must <span class="hljs-keyword">also</span> use <br>                     do_radar_ref = <span class="hljs-number">1</span>, <span class="hljs-keyword">and</span> mp_physics = <span class="hljs-number">2</span>,<span class="hljs-number">4</span>,<span class="hljs-number">6</span>,<span class="hljs-number">7</span>,<span class="hljs-number">8</span>,<span class="hljs-number">10</span>,<span class="hljs-number">14</span>, <span class="hljs-keyword">or</span> <span class="hljs-number">16</span>)<br>                                    = <span class="hljs-number">2</span>        ! PR92 based <span class="hljs-keyword">on</span> <span class="hljs-number">20</span> dBZ top, redistributes flashes <span class="hljs-keyword">within</span> dBZ &gt; <span class="hljs-number">20</span> (<span class="hljs-keyword">for</span> convection resolved runs; must <span class="hljs-keyword">also</span> use <br>                     do_radar_ref = <span class="hljs-number">1</span>, <span class="hljs-keyword">and</span> mp_physics = <span class="hljs-number">2</span>,<span class="hljs-number">4</span>,<span class="hljs-number">6</span>,<span class="hljs-number">7</span>,<span class="hljs-number">8</span>,<span class="hljs-number">10</span>,<span class="hljs-number">14</span>, <span class="hljs-keyword">or</span> <span class="hljs-number">16</span>)<br>                                    = <span class="hljs-number">3</span>        ! Predicting the potential <span class="hljs-keyword">for</span> lightning activity (based <span class="hljs-keyword">on</span> Yair et al, <span class="hljs-number">2010</span>, J. Geophys. Res., <span class="hljs-number">115</span>, D04205, doi:<span class="hljs-number">10.1029</span>/<span class="hljs-number">2008</span>JD010868) <br>                                    = <span class="hljs-number">11</span>       ! PR92 based <span class="hljs-keyword">on</span> <span class="hljs-keyword">level</span> <span class="hljs-keyword">of</span> neutral buoyancy <span class="hljs-keyword">from</span> convective parameterization (<span class="hljs-keyword">for</span> scales<br>                                                <span class="hljs-keyword">where</span> a CPS <span class="hljs-keyword">is</span> used, intended <span class="hljs-keyword">for</span> use at <span class="hljs-number">10</span> &lt; dx &lt; <span class="hljs-number">50</span> km; must <span class="hljs-keyword">also</span> use cu_physics = <span class="hljs-number">5</span> <span class="hljs-keyword">or</span> <span class="hljs-number">93</span>)<br>lightning_dt  (max_dom)             = <span class="hljs-number">0.</span>       ! <span class="hljs-type">time</span> <span class="hljs-type">interval</span> (seconds) <span class="hljs-keyword">for</span> calling lightning parameterization. <span class="hljs-keyword">Default</span> uses model <span class="hljs-type">time</span> step<br>lightning_start_seconds (max_dom)   = <span class="hljs-number">0.</span>       ! <span class="hljs-keyword">Start</span> <span class="hljs-type">time</span> <span class="hljs-keyword">for</span> calling lightning parameterization. Recommends at least <span class="hljs-number">10</span> minutes <span class="hljs-keyword">for</span> spin-up.<br>flashrate_factor  (max_dom)         = <span class="hljs-number">1.0</span>      ! Factor <span class="hljs-keyword">to</span> adjust the predicted number <span class="hljs-keyword">of</span> flashes. Recommends <span class="hljs-number">1.0</span> <span class="hljs-keyword">for</span> lightning_option = <span class="hljs-number">11</span><br>                                                <span class="hljs-keyword">between</span> dx=<span class="hljs-number">10</span> <span class="hljs-keyword">and</span> <span class="hljs-number">50</span> km. Manual tuning recommended <span class="hljs-keyword">for</span> <span class="hljs-keyword">all</span> other <span class="hljs-keyword">options</span> independently<br>                                                <span class="hljs-keyword">for</span> <span class="hljs-keyword">each</span> nest.<br>cellcount_method (max_dom)                       <span class="hljs-keyword">Method</span> <span class="hljs-keyword">for</span> counting storm cells. Used <span class="hljs-keyword">by</span> CRM <span class="hljs-keyword">options</span> (lightning_options=<span class="hljs-number">1</span>,<span class="hljs-number">2</span>).<br>                                    = <span class="hljs-number">0</span>,       ! model determines <span class="hljs-keyword">method</span> used<br>                                    = <span class="hljs-number">1</span>,       ! tile-wide, appropriate <span class="hljs-keyword">for</span> <span class="hljs-keyword">large</span> domains<br>                                    = <span class="hljs-number">2</span>,       ! <span class="hljs-keyword">domain</span>-wide, appropriate <span class="hljs-keyword">for</span> sing-storm domains<br>cldtop_adjustment (max_dom)         = <span class="hljs-number">0.</span>       ! Adjustment <span class="hljs-keyword">from</span> LNB <span class="hljs-keyword">in</span> km. Used <span class="hljs-keyword">by</span> lightning_option=<span class="hljs-number">11.</span> <span class="hljs-keyword">Default</span> <span class="hljs-keyword">is</span> <span class="hljs-number">0</span>, but recommends <span class="hljs-number">2</span> km<br>iccg_method (max_dom)                            IC:CG partitioning <span class="hljs-keyword">method</span> (IC: intra-cloud; CG: cloud-<span class="hljs-keyword">to</span>-ground)<br>                                    = <span class="hljs-number">0</span>        ! <span class="hljs-keyword">Default</span> <span class="hljs-keyword">method</span> depending <span class="hljs-keyword">on</span> lightning <span class="hljs-keyword">option</span>, currently <span class="hljs-keyword">all</span> <span class="hljs-keyword">options</span> use iccg_method=<span class="hljs-number">2</span> <span class="hljs-keyword">by</span> default<br>                                    = <span class="hljs-number">1</span>        ! <span class="hljs-keyword">Constant</span> everywhere, <span class="hljs-keyword">set</span> <span class="hljs-keyword">with</span> namelist <span class="hljs-keyword">options</span> iccg_prescribed (num|den)#, <span class="hljs-keyword">default</span> <span class="hljs-keyword">is</span> <span class="hljs-number">0.</span>/<span class="hljs-number">1.</span> (<span class="hljs-keyword">all</span> CG).<br>                                    = <span class="hljs-number">2</span>        ! Coarsely prescribed <span class="hljs-number">1995</span><span class="hljs-number">-1999</span> NLDN/OTD climatology based <span class="hljs-keyword">on</span> Boccippio et al. (<span class="hljs-number">2001</span>)<br>                                    = <span class="hljs-number">3</span>        ! Parameterization <span class="hljs-keyword">by</span> Price <span class="hljs-keyword">and</span> Rind (<span class="hljs-number">1993</span>) based <span class="hljs-keyword">on</span> cold-cloud depth<br>                                    = <span class="hljs-number">4</span>        ! Gridded <span class="hljs-keyword">input</span> via arrays iccg_in_(num|den) <span class="hljs-keyword">from</span> wrfinput <span class="hljs-keyword">for</span> monthly mapped ratios. <br>                                                Points <span class="hljs-keyword">with</span> <span class="hljs-number">0</span>/<span class="hljs-number">0</span> <span class="hljs-keyword">values</span> use ratio defined <span class="hljs-keyword">by</span> iccg_prescribed_(num|den)<br>iccg_prescribed_num (max_dom)       = <span class="hljs-number">0.</span>       ! Numerator <span class="hljs-keyword">of</span> <span class="hljs-keyword">user</span>-specified prescribed IC:CG<br>iccg_prescribed_den (max_dom)       = <span class="hljs-number">1.</span>       ! Denominator <span class="hljs-keyword">of</span> <span class="hljs-keyword">user</span>-specified prescribed IC:CG<br>ltng_temp_upper                     = <span class="hljs-number">-45.</span>     ! Temperature (C) <span class="hljs-keyword">of</span> upper peak <span class="hljs-keyword">of</span> LNOx vertical distribution <span class="hljs-keyword">for</span> IC lightning (used <span class="hljs-keyword">by</span> &amp;chem lnox_opt=<span class="hljs-number">2</span>).<br>ltng_temp_lower                     = <span class="hljs-number">-15.</span>     ! Temperatures (C) <span class="hljs-keyword">of</span> lower peak <span class="hljs-keyword">of</span> LNOx vertical distribution <span class="hljs-keyword">for</span> <span class="hljs-keyword">both</span> IC <span class="hljs-keyword">and</span> CG lightning (used <span class="hljs-keyword">by</span> &amp;chem lnox_opt=<span class="hljs-number">2</span>).<br></code></pre></td></tr></table></figure><p>From WRF-MPAS-A forum,</p><ul><li><a href="https://forum.mmm.ucar.edu/threads/wrf-lightning-scheme-only-being-run-at-model-output-times.16207/#post-40290">WRF lightning scheme only being run at model output times?</a></li><li><a href="https://forum.mmm.ucar.edu/threads/lightning-option.13017/#post-31892">Lightning option</a></li><li><a href="https://forum.mmm.ucar.edu/threads/large-differences-of-simulated-fields-u-v-w-t-with-lightning_option-3-lpi-on-and-off.9338/#post-22147">Large differences of simulated fields (U, V, W, T) with lightning_option = 3 (LPI) on and off</a><ul><li>An alternative is to calculate the LPI from the model output. This can be done quite simply using an NCL program.</li></ul></li></ul><p>From <a href="https://groups.google.com/a/ucar.edu/g/wrf-chem-lightning/c/v6nIeyL7G2g" class="uri">https://groups.google.com/a/ucar.edu/g/wrf-chem-lightning/c/v6nIeyL7G2g</a>,</p><div class="note note-primary">            <p>The lightning option = 1 you chose is appropriate for dx&lt;5km because it relies on the maximum updraft speed in the storm updraft. You chose dx=10km which will not produce updraft speeds representative of thunderstorms, and in fact the storms are likely represented by the convective parameterization.</p><p>For dx=10 km, you should use lightning_option = 11.</p>          </div><h2 id="lightlightdenselectric-potential-difference-pot-from-wrf-elec">light/lightdens/Electric POTential difference (POT) (From WRF-ELEC)</h2><p>Starting with the electrification processes (inductive and non-inductive processes), calculation method of the electric field, along with the BoxMG mathematical software for computation of POT is described.</p><figure><img src="https://i.imgur.com/kgs4meR.png" alt="WRF-ELEC" /><figcaption>WRF-ELEC</figcaption></figure><h1 id="what-is-the-time-interval-in-lightflash-column-1">What is the time interval in light(flash column-1)?</h1><p><a href="https://github.com/MicroTed/wrf4-elec/blob/7c90e71bdc4db527d0ec034804e4fd200cdacf28/phys/module_microphysics_driver.F#L117" class="uri">https://github.com/MicroTed/wrf4-elec/blob/7c90e71bdc4db527d0ec034804e4fd200cdacf28/phys/module_microphysics_driver.F#L117</a></p><p>!--light 2D flash origin densities per output time !--lightdens 2D flash extent densities per output time !--lightdis 2D total number of discharge points per output time</p><ul><li>per output time?<ul><li>To find the number of flashes between output times, simply subtract the flashcount array from the previous output time from the current output time to get number of flashes per dt (where64dt = time between output files).</li></ul></li></ul><p>From <a href="https://github.com/MicroTed/wrf4-elec/blob/7c90e71bdc4db527d0ec034804e4fd200cdacf28/dyn_em/solve_em.F#L157">solve_em.F</a>, <strong>diag_flag and diag_flag_hist</strong> are</p><ul><li>Set diagnostic flag value <strong>history output time</strong></li></ul><figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs fortran"><span class="hljs-comment">!-----------------------------------------------------------------------------</span><br><span class="hljs-comment">!</span><br><span class="hljs-comment">! Set restart flag value history output time</span><br><span class="hljs-comment">!-----------------------------------------------------------------------------</span><br>   restart_flag = <span class="hljs-literal">.false.</span><br>   <span class="hljs-keyword">if</span> ( Is_alarm_tstep(grid%domain_clock, grid%alarms(restart_alarm)) ) <span class="hljs-keyword">then</span><br>      restart_flag = <span class="hljs-literal">.true.</span><br>   <span class="hljs-keyword">endif</span><br><span class="hljs-comment">!</span><br><span class="hljs-comment">! Set diagnostic flag value history output time</span><br><span class="hljs-comment">!-----------------------------------------------------------------------------</span><br><br>   ke_diag = kms <span class="hljs-comment">! default to ke_diag=1 in case of nwp_diagnostics == 1</span><br>   diag_flag = <span class="hljs-literal">.false.</span><br>   <span class="hljs-keyword">if</span> ( Is_alarm_tstep(grid%domain_clock, grid%alarms(HISTORY_ALARM)) ) <span class="hljs-keyword">then</span><br>      diag_flag = <span class="hljs-literal">.true.</span><br>      ke_diag = <span class="hljs-built_in">min</span>(k_end,kde-<span class="hljs-number">1</span>) <span class="hljs-comment">! set depth to full domain for reflectivity field</span><br>   <span class="hljs-keyword">endif</span><br>   diag_flag_hist = diag_flag<br></code></pre></td></tr></table></figure><ul><li>In <a href="https://github.com/MicroTed/wrf4-elec/blob/7c90e71bdc4db527d0ec034804e4fd200cdacf28/elec/include_microphysics_driver_elec.F#L24">include_microphysics_driver_elec.F</a>,<ul><li>diag_flag_hist</li><li>clear_history = .true.</li><li>all set = 0.0</li></ul></li></ul><figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs fortran"><span class="hljs-comment">! this sets the clear flag for the next time step if a history dump is occurring now</span><br><span class="hljs-keyword">IF</span> ( diag_flag_hist ) <span class="hljs-keyword">THEN</span><br>   clear_history = <span class="hljs-literal">.true.</span><br><span class="hljs-keyword">ENDIF</span><br><br><span class="hljs-comment">!    add up flashes up to history dump </span><br><br><span class="hljs-comment">!     if (MOD(NINT(curr_secs),history_interval*60).eq.0) then</span><br><span class="hljs-keyword">IF</span> ( clear_history ) <span class="hljs-keyword">THEN</span><br>   clear_history = <span class="hljs-literal">.false.</span><br><span class="hljs-comment">!      write(0,*) &#x27;clear arrays&#x27;</span><br>light(:,:) = <span class="hljs-number">0.</span><br>lightdis(:,:) = <span class="hljs-number">0.</span><br>lightdens(:,:) = <span class="hljs-number">0.</span><br>induc(:,:,:) = <span class="hljs-number">0.0</span><br>noninduc(:,:,:) = <span class="hljs-number">0.0</span><br>   <span class="hljs-keyword">IF</span> ( idischarge == <span class="hljs-number">1</span> ) <span class="hljs-keyword">THEN</span><br>   lightfod(:,:) = <span class="hljs-number">0.</span><br>   ELSEIF ( idischarge &gt;= <span class="hljs-number">2</span> ) <span class="hljs-keyword">THEN</span><br>   flshfedic(:,:) = <span class="hljs-number">0.</span><br>   flshfedicp(:,:) = <span class="hljs-number">0.</span><br>   flshfedicn(:,:) = <span class="hljs-number">0.</span><br>   flshfedcg(:,:) = <span class="hljs-number">0.</span><br>   flshfedcgp(:,:) = <span class="hljs-number">0.</span><br>   flshfedcgn(:,:) = <span class="hljs-number">0.</span><br>   flshi(:,:,:) = <span class="hljs-number">0.</span><br>   flshn(:,:,:) = <span class="hljs-number">0.</span><br>   flshp(:,:,:) = <span class="hljs-number">0.</span><br>   <span class="hljs-keyword">ENDIF</span><br></code></pre></td></tr></table></figure><h1 id="wrf-practice">WRF practice</h1><table><thead><tr class="header"><th style="text-align: left;">option</th><th style="text-align: left;"></th></tr></thead><tbody><tr class="odd"><td style="text-align: left;">elec_physics</td><td style="text-align: left;">= 0, electrification (and charge arrays) turned off (DEFAULT) <br> = 1, electrification turned on (only works with mp_physics = 17, 18, or 22 i.e., 2-moment NSSL schemes)</td></tr><tr class="even"><td style="text-align: left;">nssl_ipelec (max_dom)</td><td style="text-align: left;">! NOTE: only set this to a nonzero value on the innermost domain <br> = 0, charging turned off <br> = 2, non-inductive charging only <br> = 3, non-inductive + inductive charging <br> = 1, not used (reserved for future use)</td></tr><tr class="odd"><td style="text-align: left;">nssl_idischarge</td><td style="text-align: left;"><br> = 0, no discharge <br> = 1, Cylindrical "1D" lightning scheme based on Ziegler and MacGorman (1994, JAS) <br> = 2, 3D discrete discharge adapted from MacGorman et al. (2001)</td></tr></tbody></table><ul><li>The WRF-ELEC model outputs a variety of variables related to electrification processes and lightning activity in thunderstorms. Some of the key output variables include:</li></ul><table><thead><tr class="header"><th>WRF-ELEC variables</th><th>Unit</th><th>Description</th></tr></thead><tbody><tr class="odd"><td>LIGHT(Time, south_north, west_east)</td><td>flash origin density</td><td>lightning flash initiations</td></tr><tr class="even"><td>LIGHTDENS(Time, south_north, west_east)</td><td>flash column-1</td><td>lightning flash density</td></tr><tr class="odd"><td>LIGHTFOD(Time, south_north, west_east)</td><td>flash column-1</td><td>normalized lightning flash origin density</td></tr><tr class="even"><td>LIGHTDIS(Time, south_north, west_east)</td><td>Source column-1</td><td>lightning source density</td></tr><tr class="odd"><td>POT(Time, bottom_top, south_north, west_east)</td><td>V</td><td>POTENTIAL</td></tr><tr class="even"><td>ELECMAG(Time, bottom_top, south_north, west_east)</td><td>V m-1</td><td>EFIELD MAGNITUDE</td></tr><tr class="odd"><td>ELECX(Time, bottom_top, south_north, west_east)</td><td>V m-1</td><td>EFIELD X-Component</td></tr><tr class="even"><td>ELECY(Time, bottom_top, south_north, west_east)</td><td>V m-1</td><td>EFIELD Y-Component</td></tr><tr class="odd"><td>ELECZ(Time, bottom_top, south_north, west_east)</td><td>V m-1</td><td>EFIELD Z-Component</td></tr><tr class="even"><td>SCTOT(Time, bottom_top, south_north, west_east)</td><td>C m-3</td><td>Total Space Charge Density</td></tr><tr class="odd"><td>RSCGHIS_2D(Time, south_north, west_east)</td><td>C m-2</td><td>MAX NONINDUCTIVE CHARGING 2D</td></tr><tr class="even"><td>INDUC(Time, bottom_top, south_north, west_east)</td><td>C m-3</td><td>TOTAL INDUCTIVE CHARGING</td></tr><tr class="odd"><td>NONINDUC(Time, bottom_top, south_north, west_east)</td><td>C m-3</td><td>TOTAL NONINDUCTIVE CHARGING</td></tr><tr class="even"><td>SCTOT(Time, bottom_top, south_north, west_east)</td><td>C m-3</td><td>Total Space Charge Density</td></tr></tbody></table><ul><li>If the lightning discharge flag (nssl_idischarge = 2) that is lightning3d, More output variables include: (LIGHTFOD is not calculated)</li></ul><table><thead><tr class="header"><th>WRF-ELEC variables</th><th>Unit</th><th>Description</th></tr></thead><tbody><tr class="odd"><td>FLSHFEDIC(Time, south_north, west_east)</td><td>flash column-1</td><td>IC lightning flash extent density</td></tr><tr class="even"><td>FLSHFEDICP(Time, south_north, west_east)</td><td>flash column-1</td><td>IC pos lightning flash extent density</td></tr><tr class="odd"><td>FLSHFEDICN(Time, south_north, west_east)</td><td>flash column-1</td><td>IC neg lightning flash extent density</td></tr><tr class="even"><td>FLSHFEDCG(Time, south_north, west_east)</td><td>flash column-1</td><td>CG lightning flash extent density</td></tr><tr class="odd"><td>FLSHFEDCGN(Time, south_north, west_east)</td><td>flash column-1</td><td>CG neg lightning flash extent density</td></tr><tr class="even"><td>FLSHFEDCGP(Time, south_north, west_east)</td><td>flash column-1</td><td>CG pos lightning flash extent density</td></tr><tr class="odd"><td>FLSHI(Time, bottom_top, south_north, west_east)</td><td>count</td><td>Lightning init points</td></tr><tr class="even"><td>FLSHN(Time, bottom_top, south_north, west_east)</td><td>count</td><td>Negative channels</td></tr><tr class="odd"><td>FLSHP(Time, bottom_top, south_north, west_east)</td><td>count</td><td>Positive channels</td></tr></tbody></table><h1 id="cost-elapsed-time">Cost: Elapsed time</h1><table><thead><tr class="header"><th style="text-align: left;">WRF-ELEC</th><th style="text-align: left;">mp</th><th style="text-align: left;">idischarge</th><th style="text-align: left;">Elapsed time</th></tr></thead><tbody><tr class="odd"><td style="text-align: left;">elec=0</td><td style="text-align: left;">17</td><td style="text-align: left;">none</td><td style="text-align: left;">4h49m</td></tr><tr class="even"><td style="text-align: left;">elec=1</td><td style="text-align: left;">17</td><td style="text-align: left;">1</td><td style="text-align: left;">6h13m</td></tr><tr class="odd"><td style="text-align: left;">elec=1</td><td style="text-align: left;">17</td><td style="text-align: left;">2</td><td style="text-align: left;">9h1m</td></tr></tbody></table><p>WRFv4.5-ELEC.</p><h1 id="literature-review">Literature review</h1><p>Lightning activity is related to two important factors: dynamicâ€“thermodynamic and microphysical characteristics (e.g., Williams et al., 2005; Rosenfeld et al., 2008; Guo et al., 2016; Wang et al., 2018; Zhao et al., 2020). Since the dynamicâ€“thermodynamic processes affect the development of thunderstorm significantly, lightning activity is influenced by various dynamicâ€“thermodynamic variables: temperature (Price, 1993), relative humidity in the lower and middle troposphere (Xiong et al., 2006; Fan et al., 2007), convective available potential energy (Qie et al., 2004; Stolz et al., 2015), and many others.</p><h2 id="pr92">(1992) PR92</h2><blockquote><p>Price, C., and D. Rind (1992), A Simple Lightning Parameterization for Calculating Global Lightning Distributions, J. Geophys. Res., 97(D9), 9919-9933, doi:10.1029/92JD00719.<br />Wong, J., M. Barth, and D. Noone, 2013: Evaluating a lightning parameterization based on cloud-top height for mesoscale numerical model simulations, Geosci. Model Dev., 6, 429â€“443, GMD - Evaluating a lightning parameterization based on cloud-top height for mesoscale numerical model simulations.</p></blockquote><p>ref: <a href="https://ruc.noaa.gov/wrf/wrf-chem/Users_guide.pdf">WRF-Chem Version 4.4 User's Guide: Appendix C: Using the Lightning-NOx Parameterization in WRF-Chem</a></p><p>You may also find useful information in the actual code for the schemes:</p><ul><li>module_lightning_driver.F</li><li>module_ltng_crmpr92.F</li></ul><h2 id="prediction-of-lightning-flash-density-with-the-wrf-model">(2010) Prediction of lightning flash density with the WRF model</h2><blockquote><p><a href="https://pdfs.semanticscholar.org/a206/1d033ccf90082c05a1514df4920005035c0b.pdf" class="uri">https://pdfs.semanticscholar.org/a206/1d033ccf90082c05a1514df4920005035c0b.pdf</a><br />Lynn, B., and Yoav Yair. "Prediction of lightning flash density with the WRF model." Advances in Geosciences 23 (2010): 11-16.</p></blockquote><p>The <strong>Lightning Potential Index (LPI)</strong> is a measure of the potential for charge generation and separation that leads to lightning flashes in convective thunderstorms. It is calculated from model simulated updraft and microphysical fields. It was designed to predict the potential of lightning occurrence in operational weather forecasting models, but could possibly be used to improve short-range forecasts of heavy rain. <strong>The index is modified here to be model grid-scale transparent between 1 and 4 km (the approximate upper limit of explicit microphysical weather forecasts)</strong>. Two case studies show that the modification appears to work quite well, and that LPI can be calculated on both an extremely high resolution research-grid (i.e., 1.33 km) and high resolution (i.e., 4 km) operationally compatible forecast grid. Analytical expressions are presented to use the LPI to predict the hourly lightning flash density.</p><h2 id="fierro-et-al.">(2013) Fierro et al.</h2><blockquote><p>Fierro, A. O., Mansell, E. R., MacGorman, D. R., &amp; Ziegler, C. L. (2013). The implementation of an explicit charging and discharge lightning scheme within the WRF-ARW model: Benchmark simulations of a continental squall line, a tropical cyclone, and a winter storm. Monthly Weather Review, 141(7), 2390-2415.</p></blockquote><p>This work describes the recent implementation of explicit lightning physics within the Weather Research and Forecasting (WRF) Model.</p><ul><li>Charging of hydrometeors consists of five distinct noninductive parameterizations, polarization of cloud water, and the exchange of charge during collisional mass transfer.</li><li>The three components of the ambient electric field are explicitly solved for via the computationally efficient multigrid elliptic solver.</li><li>The discharge process employs concepts adapted from two well-documented bulk lightning models, whereby charge reduction is imposed within a prescribed volume centered at grid points characterized by electric field magnitudes exceeding a given breakdown threshold.</li></ul><p>This lightning model was evaluated through benchmark</p><ul><li>convection-allowing (3 km) model simulations of three contrasting convective systems: a continental squall line,</li><li>a major hurricane (Rita 2005), and</li><li>a winter storm.</li></ul><p>The areal coverage and magnitude of the simulated hourly flash origin density (FOD) for the continental squall line are qualitatively comparable to that of the total lightning data observations from Earth Networks Total Lightning Network (ENTLN). In agreement with the ENTLN observations, no FOD are simulated for the winter storm case. The simulated spatial FOD pattern of the hurricane and the eyewall gross charge structure were both in reasonable agreement with observations. The simulated FOD for all three cases were also evaluated against those obtained with the recently developed McCaul diagnostic lightning prediction schemes and exhibited overall good qualitative agreement with each other for Rita and the continental squall line.</p><h2 id="thunderstorm-indices-lpi-layrh-scp">Thunderstorm Indices (LPI, Layrh, SCP)</h2><p><strong>Thunderstorm Indices (LPI, Layrh, SCP)</strong> obtained from IMD-WRF (3km) Hourly outputs.</p><ul><li>Model GEFS - WRF Description</li><li><a href="https://srf.tropmet.res.in/srf/ts_prediction_system/lpi_model.php" class="uri">https://srf.tropmet.res.in/srf/ts_prediction_system/lpi_model.php</a></li><li><strong>Lightning Potential Index (LPI)</strong><ul><li>Here, LPI has been calculated using IMD-WRF (3km) hourly model output. 24 Hour accumulated LPI has been generated by adding hourly LPI values. The threat of LPI has been categorized in Low, Moderate and High. LOW: LPI &lt; 0.001 and &gt;0.0005; Moderate: LPI :&lt; 0.01 and &gt; 0.001; Threat Level: High: LPI &gt; 0.01.</li></ul></li><li><strong>SuperCell Composite Parameter (SCP)</strong><ul><li>SCP &gt; 1 indicated that the environment is conducive for thunderstorm formation. The Threat Level of SCP has been categorized in Low, Moderate and High. LOW: 3 &lt; SCP &lt; 5; Moderate: 5 &lt; SCP &lt; 7; High: SCP &gt; 7.</li></ul></li><li><strong>Layer Relative Humidity (LAYRH)</strong><ul><li>The threat level of Layrh has been categorized in Low, Moderate and High. LOW: 20 &lt; LAYRH &lt; 40; Moderate: 40 &lt; LAYRH &lt; 60; High : LAYRH &gt; 60</li></ul></li></ul><h2 id="numerical-study-of-performance-of-two-lightning-prediction-methods-based-on-lightning-potential-index-lpi-and-electric-potential-difference-pot-over-tehran-area">(2019) Numerical study of performance of two lightning prediction methods based on: Lightning Potential Index (LPI) and electric POTential difference (POT) over Tehran area</h2><blockquote><p><strong>Gharaylou, M., Farahani, M. M., Hosseini, M., &amp; Mahmoudian, A. (2019). Numerical study of performance of two lightning prediction methods based on: Lightning Potential Index (LPI) and electric POTential difference (POT) over Tehran area</strong>. Journal of Atmospheric and Solar-Terrestrial Physics, 193, 105067.</p></blockquote><p>The electric POTential difference (POT) and the Lightning Potential Index (LPI) performance in predicting the lightning activity is investigated and the probable relationship between them is examined. These two indices have a similar dependency on microphysical variables such as ice, graupel mixing ratios, and also updraft characteristics within the cloud. Regardless of this similarity, the LPI directly calculated from WRF model is a more favorable parameter for predicting the lightning events in comparison with the POT, which requires an extra package (ELEC) model. Ten years' available data over the Tehran area were reviewed and four thundercloud cases with distinct characteristics (CAPE, time-frequency, intensity) were selected. In order to acquire the associated physical properties, four simulations have been done using the WRF-ELEC model, which is initialized with ERA-Interim data.</p><h2 id="prediction-of-lightning-activity-using-wrf-elec-model">**(2020) Prediction of lightning activity using WRF-ELEC model</h2><blockquote><p><strong>Gharaylou, M., Farahani, M. M., Mahmoudian, A., &amp; Hosseini, M. (2020). Prediction of lightning activity using WRF-ELEC model: Impact of initial and boundary conditions</strong>. Journal of Atmospheric and Solar-Terrestrial Physics, 210, 105438.</p></blockquote><blockquote><ul><li><a href="https://sci-hub.se/https://doi.org/10.1016/j.jastp.2020.105438" class="uri">https://sci-hub.se/https://doi.org/10.1016/j.jastp.2020.105438</a></li></ul></blockquote><ul><li>The WRF model belongs to the first group in which lightning is predicted based on the <strong>Bulk Lightning Model (BLM)</strong>. Ziegler and MacGorman (1994) have studied lightning flashes in a twoand three-dimensional cloud models using the WRF model.</li><li>In the early 90s, Price and Rind (1992) developed a lightning parameterization scheme based on <strong>cloud-top height</strong>.</li><li>Furthermore, another lightning flash parameterization scheme has been introduced by Allen and Pickering (2002) and Allan et al. (2010) based on the <strong>square of deep convective mass flux</strong>.</li><li>Choi et al. (2005) and Zhao et al. (2009) incorporated the <strong>convective available potential energy (CAPE)</strong> in their comparative parameterizations.</li><li>Yair et al. (2010) introduced <strong>Lightning Potential Index (LPI)</strong>, an advanced index for evaluating the probability of lightning occurrence, incorporated the dynamic and microphysic concepts.</li><li>Following, Lynn et al. (2012) introduced the <strong>potential electrical energy (Ep) parameter</strong> into the WRF model, which was used to predict both <strong>Cloud-to-Ground (CG)</strong> and <strong>Intra-Cloud (IC)</strong> <em>lightning events</em>.</li><li>Afterwards, Wong et al. (2013) developed the lightning parameterization based on cloud-top height (Price and Rind, 1992).</li><li>Gharaylou et al. (2019) examined 2 indices which are used in predicting the lightning activities both in time and location. They compared the <strong>electric potential difference (POT)</strong> and the <strong>LPI</strong> performance in predicting the lightning associated with four events over a domain located in the north of Iran.</li><li><strong>The LPI is computationally less expensive and is directly calculated by the WRF model with less computational cost in comparison with the POT which requires an extra package (ELEC model).</strong><ul><li>LPI calculations have been discussed in our previous paper (Gharaylou et al., 2019)</li></ul></li></ul><h3 id="effect-of-initial-and-boundary-conditions-ibcs">Effect of Initial and boundary conditions (IBCs)</h3><ul><li>The mesoscale models ordinarily obtain their initial and boundary conditions (IBCs) from large scale global models. <strong>Applying different initial conditions highly influences the accuracy of the model prediction in local areas</strong> (Zhang et al., 2002, 2006).</li><li>A few works have been done to investigate the effect of initial conditions on lightning activity (Lynn et al., 2012).</li><li>Zepka et al. (2014) studied the impact of the resolution of the NCEP operational Global Forecast System.</li><li>As mentioned, <strong><em>there are very few works</em></strong> related to the assessment of IBC effects in the WRF-ELEC model for lightning prediction.<ul><li>WRF-ELEC model initialized with different datasets needs to be verified.</li></ul></li></ul><h1 id="case-hong-kong-lightning">Case: Hong Kong Lightning</h1><p>The "Hong Kong Observatory Lightning Statistics" refers to the detailed records of lightning activity in the Hong Kong region, primarily categorized into cloud-to-ground lightning and intra-cloud lightning. This data not only aids in understanding meteorological patterns but also enhances awareness of the safety risks associated with lightning strikes.</p><ul><li><a href="https://www.hko.gov.hk/tc/wservice/tsheet/llis.htm">é¦™æ¸¯å¤©æ–‡å°é–ƒé›»ä½ç½®è³‡è¨Šæœå‹™ HKO Lightning Location Information Service</a></li></ul><figure><img src="https://www.hko.gov.hk/tc/wservice/tsheet/images/fact2c.jpg" alt="é–ƒé›»å®šä½ç¶²çµ¡å„å€‹æ¢æ¸¬ç«™çš„ä½ç½®åˆ†ä½ˆåœ–/Distribution of lightning sensor stations of the lightning location network" /><figcaption>é–ƒé›»å®šä½ç¶²çµ¡å„å€‹æ¢æ¸¬ç«™çš„ä½ç½®åˆ†ä½ˆåœ–/Distribution of lightning sensor stations of the lightning location network</figcaption></figure><ul><li><a href="https://www.hko.gov.hk/en/wxinfo/llis/llis_map.htm">Lightning density map for Hong Kong</a></li></ul><figure><img src="https://www.hko.gov.hk/en/wxinfo/llis/images/ll_density_e.png" alt="Average yearly number of cloud-to-ground lightning strokes per square kilometer" /><figcaption>Average yearly number of cloud-to-ground lightning strokes per square kilometer</figcaption></figure><ul><li><a href="https://maps.weather.gov.hk/ocf/index_uc.html?data=ncln">é–ƒé›»ï¼ˆè©¦é©—ç‰ˆï¼‰ | é¦™æ¸¯åŠç æ±Ÿä¸‰è§’æ´²å€åŸŸè‡ªå‹•åˆ†å€å¤©æ°£é å ±/Automatic regional weather forecast in Hong Kong and the Pearl River Delta region</a></li></ul><h2 id="statistics-of-lightning-days-at-the-hko-weather-station">Statistics of lightning days at the HKO Weather Station</h2><figure><img src="../../../../figures/2024-09-20-wrf4-elec-lightning/Statistics_of_lightning_days_at_the_HKO_Weather_Station.png" alt="Statistics of lightning days at the HKO Weather Station (Last updated: August 31, 2024). From i-lens.hk" /><figcaption>Statistics of lightning days at the HKO Weather Station (Last updated: August 31, 2024). From <a href="https://i-lens.hk/hkweather/special_stat.php?event=LIGHTING_DAY&amp;station=HKO">i-lens.hk</a></figcaption></figure><h2 id="all-weather-stations---ranking-of-highest-daily-total-lightning-counts-in-history">All Weather Stations - Ranking of Highest Daily Total Lightning Counts in History</h2><p>From <a href="https://i-lens.hk/hkweather/rank.php?station=ALL&amp;element=L_BOTH&amp;type=MAX&amp;year=&amp;month=">i-lens.hk</a>, Last updated: August 31, 2024</p><table><thead><tr class="header"><th style="text-align: center;">Ranking</th><th style="text-align: center;">Weather Station</th><th style="text-align: center;">Start observation year</th><th style="text-align: center;">Observation date</th><th style="text-align: center;">Total number of lightning strikes per day (times)</th></tr></thead><tbody><tr class="odd"><td style="text-align: center;">1</td><td style="text-align: center;">Hong Kong Observatory</td><td style="text-align: center;">2005</td><td style="text-align: center;">2020-06-06</td><td style="text-align: center;">47537</td></tr><tr class="even"><td style="text-align: center;">2</td><td style="text-align: center;">Hong Kong Observatory</td><td style="text-align: center;">2005</td><td style="text-align: center;">2020-06-07</td><td style="text-align: center;">41446</td></tr><tr class="odd"><td style="text-align: center;">3</td><td style="text-align: center;">Hong Kong Observatory</td><td style="text-align: center;">2005</td><td style="text-align: center;">2019-04-20</td><td style="text-align: center;">36299</td></tr><tr class="even"><td style="text-align: center;">4</td><td style="text-align: center;">Hong Kong Observatory</td><td style="text-align: center;">2005</td><td style="text-align: center;">2023-06-01</td><td style="text-align: center;">36253</td></tr><tr class="odd"><td style="text-align: center;">5</td><td style="text-align: center;">Hong Kong Observatory</td><td style="text-align: center;">2005</td><td style="text-align: center;">2024-04-30</td><td style="text-align: center;">32603</td></tr><tr class="even"><td style="text-align: center;">6</td><td style="text-align: center;">Hong Kong Observatory</td><td style="text-align: center;">2005</td><td style="text-align: center;">2021-06-28</td><td style="text-align: center;">31859</td></tr><tr class="odd"><td style="text-align: center;">7</td><td style="text-align: center;">Hong Kong Observatory</td><td style="text-align: center;">2005</td><td style="text-align: center;">2019-08-25</td><td style="text-align: center;">24951</td></tr><tr class="even"><td style="text-align: center;">8</td><td style="text-align: center;">Hong Kong Observatory</td><td style="text-align: center;">2005</td><td style="text-align: center;">2019-04-19</td><td style="text-align: center;">22053</td></tr><tr class="odd"><td style="text-align: center;">9</td><td style="text-align: center;">Hong Kong Observatory</td><td style="text-align: center;">2005</td><td style="text-align: center;">2018-08-22</td><td style="text-align: center;">21152</td></tr><tr class="even"><td style="text-align: center;">10</td><td style="text-align: center;">Hong Kong Observatory</td><td style="text-align: center;">2005</td><td style="text-align: center;">2022-07-30</td><td style="text-align: center;">20187</td></tr><tr class="odd"><td style="text-align: center;">11</td><td style="text-align: center;">Hong Kong Observatory</td><td style="text-align: center;">2005</td><td style="text-align: center;">2019-06-13</td><td style="text-align: center;">19526</td></tr><tr class="even"><td style="text-align: center;">12</td><td style="text-align: center;">Hong Kong Observatory</td><td style="text-align: center;">2005</td><td style="text-align: center;">2010-09-09</td><td style="text-align: center;">18813</td></tr><tr class="odd"><td style="text-align: center;">13</td><td style="text-align: center;">Hong Kong Observatory</td><td style="text-align: center;">2005</td><td style="text-align: center;">2013-05-22</td><td style="text-align: center;">18568</td></tr><tr class="even"><td style="text-align: center;">14</td><td style="text-align: center;">Hong Kong Observatory</td><td style="text-align: center;">2005</td><td style="text-align: center;">2020-09-15</td><td style="text-align: center;">17879</td></tr><tr class="odd"><td style="text-align: center;">15</td><td style="text-align: center;">Hong Kong Observatory</td><td style="text-align: center;">2005</td><td style="text-align: center;">2020-05-30</td><td style="text-align: center;">17765</td></tr><tr class="even"><td style="text-align: center;">16</td><td style="text-align: center;">Hong Kong Observatory</td><td style="text-align: center;">2005</td><td style="text-align: center;">2006-06-09</td><td style="text-align: center;">17587</td></tr><tr class="odd"><td style="text-align: center;">17</td><td style="text-align: center;">Hong Kong Observatory</td><td style="text-align: center;">2005</td><td style="text-align: center;">2014-03-30</td><td style="text-align: center;">16823</td></tr><tr class="even"><td style="text-align: center;">18</td><td style="text-align: center;">Hong Kong Observatory</td><td style="text-align: center;">2005</td><td style="text-align: center;">2024-04-26</td><td style="text-align: center;">16328</td></tr><tr class="odd"><td style="text-align: center;">19</td><td style="text-align: center;">Hong Kong Observatory</td><td style="text-align: center;">2005</td><td style="text-align: center;">2010-09-08</td><td style="text-align: center;">14659</td></tr><tr class="even"><td style="text-align: center;">20</td><td style="text-align: center;">Hong Kong Observatory</td><td style="text-align: center;">2005</td><td style="text-align: center;">2023-04-21</td><td style="text-align: center;">14471</td></tr></tbody></table><h2 id="overview-of-climate-change-effects">Overview of Climate Change Effects</h2><p>Climate change, driven by the increase in greenhouse gases, has a profound impact on weather patterns. As global temperatures rise, more energy is available in the atmosphere, which intensifies convective storms. Since lightning is primarily a product of such storms, the increase in the frequency and intensity of these storms can lead to changes in lightning activity.</p><ul><li><strong>Increase Per Degree of Warming:</strong> Across the continental United States (CONUS), the CAPE Ã— P proxy predicts a 12 Â± 5% rise in lightning strike rates for each 1Â°C increase in global mean temperature (Romps et al., 2014). This research suggests that as the planet warms, lightning frequency will likely increase. A 12% rise in lightning activity is anticipated for every degree of warming, which could result in a 50% increase in lightning strikes in regions like the U.S. by the end of the century (Romps et al., 2014; Romps, 2021).</li><li><strong>Specific Regional Studies:</strong> Focused on the South China Sea (SCS) and surrounding regions in Southeast Asia to analyze long-term trends and future projections of lightning activity using the longest available satellite-based lightning dataset and climate models. The projections indicate that lightning activity in the SCS region is expected to increase by 10% under SSP245 and by 12% under SSP370 by the end of the 21st century. (Xu et al., 2023; Xu et al., 2024)</li><li><strong>Impact of Global Warming on Future Lightning Events</strong><ul><li>The IPCC AR6 defines several Shared Socioeconomic Pathways (SSPs) that describe possible future climate scenarios based on different levels of greenhouse gas emissions. (e.g., SSP5-8.5: Very high emissions, with warming over 4.4Â°C)</li></ul></li><li><strong>Regional Studies on Future Lightning Events (e.g., South China Sea)</strong></li></ul><p>From these papers,</p><ul><li>Romps, D. M., Seeley, J. T., Vollaro, D., &amp; Molinari, J. (2014). Projected increase in lightning strikes in the United States due to global warming. Science, 346(6211), 851-854.</li><li>Romps, D. M. (2019). Evaluating the future of lightning in cloudâ€resolving models. Geophysical Research Letters, 46(24), 14863-14871.</li><li>Xu, L., Cao, X., Lan, X., Zhang, W., Sun, C., &amp; Zhang, Y. (2024). Future increase in lightning around the South China Sea under climate change. Earth and Space Science, 11(6), e2023EA003356.</li><li>Xu, Mingyi, et al. "Distribution of lightning spatial modes and climatic causes in China." Atmospheric and Oceanic Science Letters 16.2 (2023): 100338.</li></ul><h1 id="references">References</h1><ol type="1"><li>é¦™æ¸¯å¤©æ–‡å°<ol type="1"><li><a href="https://www.hko.gov.hk/tc/education/weather/thunderstorm-and-lightning/00031-what-are-thunderstorms.html">ä»€éº¼æ˜¯é›·æš´ï¼Ÿ</a></li><li><a href="https://www.hko.gov.hk/tc/publica/reprint/files/r622.pdf">2006-Reprint 622-æ¢è¨é–ƒé›»ä½ç½®æ•¸æ“šæ‡‰ç”¨åœ¨è‡¨è¿‘é å ±çš„å‰æ™¯</a></li><li><a href="https://www.weather.gov.hk/tc/publica/reprint/files/r817a.pdf">2009-Reprint 817-é¦™æ¸¯ä¸€æ¬¡å¤å­£é›¹ï¨†çš„å¤©æ°£éç¨‹åˆ†æåŠï§¶è¿‘é å ±ç³»çµ±çš„æ‡‰ç”¨</a></li><li><a href="https://www.weather.gov.hk/en/publica/reprint/files/r1035.pdf">2012-Reprint 1035-åˆ©ç”¨é–ƒé›»æ•¸æ“šç›£æ¸¬æš´é›¨ç™¼å±•çš„å€‹æ¡ˆåˆ†æ</a></li><li><a href="https://www.hko.gov.hk/tc/whatsnew/r1_wn20170531.htm">2017 å¤©æ–‡å°åŠ å¼·é–ƒé›»å®šä½è³‡è¨Šç³»çµ±æŠ•å…¥æ¥­å‹™é‹ä½œ</a></li><li><a href="https://www.hko.gov.hk/en/publica/reprint/files/r1337.pdf">2018-Reprint 1337-ç²µæ¸¯æ¾³é–ƒé›»å®šä½ç¶²çµ¡çš„æœ€æ–°ç™¼å±•åŠèˆ‡è¶…å¼·é¢±é¢¨å¤©é´¿ç›¸é—œä¹‹æ•¸æ“šåˆ†æ</a></li><li><a href="https://www.hko.gov.hk/tc/publica/reprint/files/r1341.pdf">2018-Reprint 1341-å…¬çœ¾å®šé»é–ƒé›»è‡¨è¿‘é å ±æœå‹™</a></li><li><a href="https://www.hko.gov.hk/en/publica/reprint/files/r1358.pdf">2019-Reprint 1358-å€åŸŸèˆ‡å…¨çƒé–ƒé›»å®šä½è³‡æ–™æ–¼ç ä¸‰è§’åœ°å€çš„ç²¾ç´°åŒ–æ¯”å°</a></li><li><a href="https://www.hko.gov.hk/tc/publica/ghm_21/files/HPaper_WongCP.pdf">2020-åœ¨ç ä¸‰è§’ä¸€å¸¶èˆ‡å¤§é›¨ç›¸é—œçš„é–ƒé›»ç‰¹å¾µåˆ†æ</a></li></ol></li><li><a href="https://mp.weixin.qq.com/s/yuzCZB2Nb5CydG3WCysK_w">ä¸–ç•Œæ°”å€™â€œé›·æâ€ï¼šå°åº¦å°¼è¥¿äºšçˆªå“‡å²›ï¼Œå¹³å‡å¹´é›·é›¨æ—¥æ•°è¶…è¿‡220å¤©</a></li><li>å¾è‰¯éŸ¬, å¼ ä¹‰å†›, ç‹é£, éƒ‘æ ‹. 2012: é›·æš´èµ·ç”µå’Œæ”¾ç”µç‰©ç†è¿‡ç¨‹åœ¨WRFæ¨¡å¼ä¸­çš„è€¦åˆåŠåˆæ­¥æ£€éªŒ. å¤§æ°”ç§‘å­¦, 36(5): 1041-1052. DOI: 10.3878/j.issn.1006-9895.2012.11235<ol type="1"><li>WRFv3.2.1</li><li>æœ¬æ–‡å°†é›·æš´äº‘çš„èµ·ç”µã€æ”¾ç”µç‰©ç†è¿‡ç¨‹å¼•å…¥ä¸­å°ºåº¦çš„WRF (Weather Research and Forecasting) æ¨¡å¼,å¹¶å¯¹è¶…çº§å•ä½“å’Œé£‘çº¿è¿‡ç¨‹è¿›è¡Œäº†æ¨¡æ‹Ÿç ”ç©¶.èµ·ç”µè¿‡ç¨‹åœ¨MilbrandtåŒå‚æ•°å¾®ç‰©ç†æ–¹æ¡ˆä¸­å†™å…¥,åŒ…å«éœ°ã€é›¹ä¸å†°æ™¶ã€é›ªä¹‹é—´çš„éæ„Ÿåº”èµ·ç”µæœºåˆ¶,ä»¥åŠéœ°ã€é›¹ä¸äº‘æ»´ä¹‹é—´çš„æ„Ÿåº”èµ·ç”µæœºåˆ¶.</li></ol></li><li>å¾è‰¯éŸ¬, é™ˆåŒ, å§šé›¯, ç­‰. åˆ©ç”¨èµ·æ”¾ç”µæ¨¡å¼å¼€å±•é—ªç”µæ´»åŠ¨çš„ç›´æ¥é¢„æŠ¥è¯•éªŒ. åº”ç”¨æ°”è±¡å­¦æŠ¥, 2018, 29(5): 534-545. DOI: 10.11898/1001-7313.20180503.<ol type="1"><li>WRFv3.4.1</li><li>åˆ©ç”¨è€¦åˆæœ‰èµ·ç”µå’Œæ”¾ç”µç‰©ç†è¿‡ç¨‹çš„ä¸­å°ºåº¦èµ·ç”µæ”¾ç”µæ¨¡å¼WRF-Electric</li></ol></li><li>Wasson, G., &amp; Panda, S. K. (2024). Sensitivity of PBL parameterization schemes in simulating lightning and thunderstorm using WRF-ELEC model. Climate Dynamics, 1-23.<ol type="1"><li>The WRF-ELEC model, an auxiliary package integrated into WRF, is specifically designed to compute electric potential and overall lightning flash rate (source: <a href="https://sourceforge.net/projects/wrfelec" class="uri">https://sourceforge.net/projects/wrfelec</a>).</li><li>It incorporates explicit cloudresolving scale physics for lightning prediction (<a href="https://scholar.google.com/scholar_url?url=https://journals.ametsoc.org/view/journals/mwre/141/7/mwr-d-12-00278.1.xml%3Ftab_body%3Dpdf&amp;hl=en&amp;sa=T&amp;oi=gsr-r-ggp&amp;ct=res&amp;cd=0&amp;d=6841908713848986342&amp;ei=DTHtZqfdAfSC6rQP2qO70AU&amp;scisig=AFWwaeaoJDdXALkuhsn44g0xEyU5">Fierro et al.2013</a>). Detailed formulations can be found in <a href="https://scholar.google.com/scholar_url?url=https://agupubs.onlinelibrary.wiley.com/doi/abs/10.1029/2004jd005287&amp;hl=en&amp;sa=T&amp;oi=gsr-r&amp;ct=res&amp;cd=0&amp;d=13100036974408530565&amp;ei=JTHtZs_QIeqs6rQPw4y2sAM&amp;scisig=AFWwaeZ27Z0oFR35ZZvLDk-yrgo_">Mansell et al.(2005)</a> and <a href="https://scholar.google.com/scholar_url?url=https://journals.ametsoc.org/view/journals/mwre/141/7/mwr-d-12-00278.1.xml%3Ftab_body%3Dpdf&amp;hl=en&amp;sa=T&amp;oi=gsr-r-ggp&amp;ct=res&amp;cd=0&amp;d=6841908713848986342&amp;ei=OTHtZtytGPay6rQPxrKeiAM&amp;scisig=AFWwaeaoJDdXALkuhsn44g0xEyU5">Fierro et al. (2013)</a>.</li><li>skill scores were calculated for each experiment.<ol type="1"><li>standard statistics and skill score analysis of CAPE (J/kg) and accumulated total precipitation (mm),</li></ol></li></ol></li><li>Saleh, N., Gharaylou, M., Farahani,M. M., &amp; Alizadeh, O. (2023).Performance of lightning potentialindex, lightning threat index, and theproduct of CAPE and precipitationin the WRF model. Earth and SpaceScience, 10, e2023EA003104. <a href="https://doi.org/10.1029/2023EA003104" class="uri">https://doi.org/10.1029/2023EA003104</a></li><li><a href="https://weather.ndc.nasa.gov/sport/training/lfa/LFAtraining_20111025.pdf">2011: Lightning Forecast Algorithm (LFA) Overview</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>WRF</category>
      
    </categories>
    
    
    <tags>
      
      <tag>WRF-ELEC</tag>
      
      <tag>Lightning</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Setting up Hexo Blog on github.io</title>
    <link href="/2024/09/13/Hexo/"/>
    <url>/2024/09/13/Hexo/</url>
    
    <content type="html"><![CDATA[<h1 id="hexo">Hexo</h1><p><a href="https://hexo.io/zh-cn/docs/#%E4%BB%80%E4%B9%88%E6%98%AF-Hexo%EF%BC%9F">Hexo</a> æ˜¯ä¸€ä¸ªå¿«é€Ÿã€ç®€æ´ä¸”é«˜æ•ˆçš„åšå®¢æ¡†æ¶ã€‚ Hexo ä½¿ç”¨ Markdownï¼ˆæˆ–å…¶ä»–æ ‡è®°è¯­è¨€ï¼‰è§£ææ–‡ç« ï¼Œåœ¨å‡ ç§’å†…ï¼Œå³å¯åˆ©ç”¨é“ä¸½çš„ä¸»é¢˜ç”Ÿæˆé™æ€ç½‘é¡µã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">micromamba <span class="hljs-built_in">env</span> create -n hexo<br>micromamba activate hexo<br>micromamba install conda-forge::nodejs<br></code></pre></td></tr></table></figure><ul><li>nodejs 22.8.0</li><li>git is installed</li></ul><p>åº•ä¸‹æ˜¯å®˜æ–¹å¯«çš„ Quick Startï¼Œåªéœ€è¦çŸ­çŸ­äº”è¡ŒæŒ‡ä»¤å°±å¯ä»¥è®“éƒ¨è½æ ¼è·‘èµ·ä¾†ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh">npm install hexo-cli -g<br>hexo init blog<br><span class="hljs-built_in">cd</span> blog<br>npm install<br>hexo server<br></code></pre></td></tr></table></figure><p>display <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">INFO  Hexo is running at http://localhost:4000/ . Press Ctrl+C to stop.<br></code></pre></td></tr></table></figure></p><ul><li>å¦‚æœä½ å·²ç¶“æœ‰éƒ¨è½æ ¼è³‡æ–™å¤¾ï¼Œé‚£éº¼ä½ å¯ä»¥è·³éâ€œhexo init blogâ€</li></ul><h2 id="useful-commands">Useful commands</h2><ul><li>æ¸…ç† hexo ,ç±»ä¼¼äºæ¸…ç†ç¼–è¯‘ç»“æœï¼Œä¾‹å¦‚ æ‰§è¡Œå‘½ä»¤ <strong>hexo clean</strong></li><li>ç”Ÿæˆé™æ€é¡µé¢, æ‰§è¡Œå‘½ä»¤ <strong>hexo g</strong></li><li>å¯åŠ¨æœåŠ¡ï¼Œæ‰§è¡Œå‘½ä»¤ <strong>hexo s</strong> ,é»˜è®¤åœ¨ 4000 ç«¯å£å¯åŠ¨ï¼Œè®¿é—®æœ¬åœ°4000ç«¯å£å³å¯æŸ¥çœ‹æœ¬åœ°ç½‘ç«™</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh">hexo new <span class="hljs-string">&#x27;post name&#x27;</span><br>hexo clean<br>hexo generate    <span class="hljs-comment"># hexo g</span><br>hexo server      <span class="hljs-comment"># hexo s</span><br>hexo deploy      <span class="hljs-comment"># hexo d</span><br></code></pre></td></tr></table></figure><h2 id="theme-fluid">Theme: Fluid</h2><p>ä¸€æ¬¾ Material Design é£æ ¼çš„ä¸»é¢˜</p><p><a href="https://github.com/fluid-dev/hexo-theme-fluid">An elegant Material-Design theme for Hexo</a></p><h3 id="step-1">Step 1</h3><p>ä¸‹è½½ <a href="https://github.com/fluid-dev/hexo-theme-fluid/releases">æœ€æ–° release ç‰ˆæœ¬</a> è§£å‹åˆ° themes ç›®å½•ï¼Œå¹¶å°†è§£å‹å‡ºçš„æ–‡ä»¶å¤¹é‡å‘½åä¸º fluidã€‚</p><h3 id="step-2">Step 2</h3><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs txt">å¦‚ä¸‹ä¿®æ”¹ Hexo åšå®¢ç›®å½•ä¸­çš„ **_config.yml**ï¼š<br><br>theme: fluid  # æŒ‡å®šä¸»é¢˜<br><br>language: zh-CN  # æŒ‡å®šè¯­è¨€ï¼Œä¼šå½±å“ä¸»é¢˜æ˜¾ç¤ºçš„è¯­è¨€ï¼ŒæŒ‰éœ€ä¿®æ”¹<br></code></pre></td></tr></table></figure><h3 id="step-3">Step 3</h3><p>é¦–æ¬¡ä½¿ç”¨ä¸»é¢˜çš„ã€Œå…³äºé¡µã€éœ€è¦æ‰‹åŠ¨åˆ›å»ºï¼š</p><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs actionscript">hexo <span class="hljs-keyword">new</span> page about<br></code></pre></td></tr></table></figure><p>åˆ›å»ºæˆåŠŸåï¼Œç¼–è¾‘åšå®¢ç›®å½•ä¸‹ /source/about/index.mdï¼Œæ·»åŠ  layout å±æ€§ã€‚</p><p>ä¿®æ”¹åçš„æ–‡ä»¶ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><figure class="highlight md"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs md">---<br>title: about<br><span class="hljs-section">layout: about</span><br><span class="hljs-section">---</span><br><br>è¿™é‡Œå†™å…³äºé¡µçš„æ­£æ–‡ï¼Œæ”¯æŒ Markdown, HTML<br></code></pre></td></tr></table></figure><h2 id="filename">Filename</h2><p><a href="https://hexo.io/docs/writing" class="uri">https://hexo.io/docs/writing</a></p><p>By default, Hexo uses the post title as its filename. You can edit the new_post_name setting in _config.yml to change the default filename. For example, <strong>:year-:month-:day-:title.md</strong> will prefix filenames with the post creation date. You can use the following placeholders:</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-comment"># Writing</span><br><span class="hljs-comment">## new_post_name: :title.md # File name of new posts</span><br><span class="hljs-attr">new_post_name:</span> <span class="hljs-string">:year-:month-:day-:title.md</span><br></code></pre></td></tr></table></figure><p>in **_config.yml** under themes/fluid.</p><h2 id="math">math</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ micromamba install conda-forge::pandoc<br>$ npm uninstall hexo-renderer-marked --save<br>$ npm install hexo-renderer-pandoc --save<br></code></pre></td></tr></table></figure><p>and, <figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">math:</span><br>  <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">specific:</span> <span class="hljs-literal">false</span><br>  <span class="hljs-attr">engine:</span> <span class="hljs-string">mathjax</span><br></code></pre></td></tr></table></figure></p><h2 id="mermaid">mermaid</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ npm install hexo-filter-mermaid-diagrams<br></code></pre></td></tr></table></figure><h1 id="deploy-to-github">Deploy to github</h1><p>è®¾ç½®éƒ¨ç½²ç±»å‹å’Œ github ä»“åº“ä½ç½®å’Œä¸»åˆ†æ”¯ï¼Œåˆ°ç½‘ç«™é…ç½®æ–‡ä»¶ _config.yml ä¸­ä¿®æ”¹å¦‚ä¸‹ï¼š</p><p>è¡¨ç¤ºéƒ¨ç½²ç±»å‹ä¸º gitï¼›</p><p>ä»“åº“ä¸º git@github.com:username/github.io.git ï¼Œæ›¿æ¢æˆä½ çš„ä»“åº“å³å¯ï¼›</p><p>åˆ†æ”¯ä¸º master ä¸»åˆ†æ”¯ï¼›</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs text">deploy:<br>  type: git<br>  repo: git@github.com:waipangsze/waipangsze.github.io.git<br>  branch: main<br></code></pre></td></tr></table></figure><p>å®‰è£… git æ‰©å±•æ¨¡å— hexo-deployer-gitï¼Œåˆ° blog ç›®å½•ä¸­æ‰§è¡Œå‘½ä»¤ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ npm install hexo-deployer-git --save<br></code></pre></td></tr></table></figure><p>æ‰§è¡Œå‘½ä»¤</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ hexo d <br></code></pre></td></tr></table></figure><p>éƒ¨ç½²åˆ°ä¸Šé¢åˆ›å»ºçš„ github ä»“åº“ä¸­ã€‚</p><p>è¿™ä¸€æ­¥å°±æ˜¯å‘ github ä»“åº“çš„master åˆ†æ”¯æäº¤æ–‡ä»¶ï¼Œæ‰€ä»¥æœ¬åœ°è¦æœ‰æƒé™å‘ä½ çš„ github ä»“åº“æäº¤ã€‚éœ€è¦ <strong>sshkey</strong>,è‡³äºæ€ä¹ˆæ·»åŠ  sshkeyï¼Œå¦‚æœä¸æ¸…æ¥šï¼ŒæŸ¥ä¸€ä¸‹å°±çŸ¥é“äº†ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">To github.com:waipangsze/waipangsze.github.io.git<br> + 4aa63c5...24ec1e5 HEAD -&gt; main (forced update)<br>Branch <span class="hljs-string">&#x27;master&#x27;</span> <span class="hljs-built_in">set</span> up to track remote branch <span class="hljs-string">&#x27;main&#x27;</span> from <span class="hljs-string">&#x27;git@github.com:waipangsze/waipangsze.github.io.git&#x27;</span>.<br>INFO  Deploy <span class="hljs-keyword">done</span>: git<br></code></pre></td></tr></table></figure><h1 id="hexo-blog-å¤šè¨­å‚™åŒæ­¥">hexo blog å¤šè¨­å‚™åŒæ­¥</h1><p>From <a href="https://xuexuan.site/2021/02/04/hexo%E5%8D%9A%E5%AE%A2%E5%A4%9A%E8%AE%BE%E5%A4%87%E5%90%8C%E6%AD%A5/">hexoåšå®¢å¤šè®¾å¤‡åŒæ­¥</a></p><div class="note note-primary">            <p>githubä¸Šçš„repoåˆ›å»ºäº†ä¸¤ä¸ªåˆ†æ”¯ï¼Œmasterä¿å­˜é™æ€é¡µé¢ï¼Œhexoç”¨äºä¿å­˜ç½‘ç«™çš„å…¨éƒ¨æ–‡ä»¶ã€‚</p>          </div><ul><li>å°†æ—§ç¯å¢ƒä¸­çš„æ–‡ä»¶ä¸Šä¼ åˆ°githubçš„hexoåˆ†æ”¯ï¼š</li><li>githubä¸Šåˆ‡æ¢åˆ°hexoåˆ†æ”¯ï¼Œgit cloneä»“åº“åˆ°æœ¬åœ°ã€‚</li><li>æ­¤æ—¶æœ¬åœ°ä¼šå¤šå‡ºä¸€ä¸ªusername.github.ioæ–‡ä»¶å¤¹ï¼Œå‘½ä»¤è¡Œcdè¿›å»ï¼Œåˆ é™¤é™¤.gitæ–‡ä»¶å¤¹ï¼ˆå¦‚æœä½ çœ‹ä¸åˆ°è¿™ä¸ªæ–‡ä»¶å¤¹ï¼Œè¯´æ˜æ˜¯éšè—äº†ã€‚windowsä¸‹éœ€è¦å³å‡»æ–‡ä»¶å¤¹å†…ç©ºç™½å¤„ï¼Œç‚¹é€‰â€™æ˜¾ç¤º/éšè— å¼‚å¸¸æ–‡ä»¶â€™ï¼ŒMacä¸‹æˆ‘å°±ä¸çŸ¥é“äº†ï¼‰å¤–çš„å…¶ä»–æ–‡ä»¶å¤¹ã€‚</li><li>å‘½ä»¤è¡Œgit add -AæŠŠå·¥ä½œåŒºçš„å˜åŒ–ï¼ˆåŒ…æ‹¬å·²åˆ é™¤çš„æ–‡ä»¶ï¼‰æäº¤åˆ°æš‚å­˜åŒºï¼ˆps:git add .æäº¤çš„å˜åŒ–ä¸åŒ…æ‹¬å·²åˆ é™¤çš„æ–‡ä»¶ï¼‰ã€‚</li><li>å‘½ä»¤è¡Œgit commint -m "some description"æäº¤ã€‚</li><li>å‘½ä»¤è¡Œgit push origin hexoæ¨é€åˆ°è¿œç¨‹hexoåˆ†æ”¯ã€‚æ­¤æ—¶åˆ·ä¸‹githubï¼Œå¦‚æœæ­£å¸¸æ“ä½œï¼Œhexoåˆ†æ”¯åº”è¯¥å·²ç»è¢«æ¸…ç©ºäº†ã€‚</li><li>å¤åˆ¶æœ¬åœ°username.github.ioæ–‡ä»¶å¤¹ä¸­çš„.gitæ–‡ä»¶å¤¹åˆ°hexoé¡¹ç›®æ ¹ç›®å½•ä¸‹ã€‚æ­¤æ—¶ï¼Œhexoé¡¹ç›®å·²ç»å˜æˆäº†å’Œè¿œç¨‹hexoåˆ†æ”¯å…³è”çš„æœ¬åœ°ä»“åº“äº†ã€‚è€Œusername.github.ioæ–‡ä»¶å¤¹çš„ä½¿å‘½åˆ°æ­¤ä¸ºæ­¢ï¼Œä½ å¯ä»¥æŠŠå®ƒåˆ æ‰ï¼Œå› ä¸ºæˆ‘ä»¬åªæ˜¯æŠŠå®ƒä½œä¸ºä¸€ä¸ªâ€œä¸­è½¬ç«™â€çš„è§’è‰²ã€‚ä»¥åæ¯æ¬¡å‘å¸ƒæ–°æ–‡ç« æˆ–ä¿®æ”¹ç½‘ç«™æ ·å¼æ–‡ä»¶æ—¶ï¼Œgit add . &amp; git commit -m "some description" &amp; git push origin hexoå³å¯æŠŠç¯å¢ƒæ–‡ä»¶æ¨é€åˆ°hexoåˆ†æ”¯ã€‚ç„¶åå†hexo g -då‘å¸ƒç½‘ç«™å¹¶æ¨é€é™æ€æ–‡ä»¶åˆ°masteråˆ†æ”¯ã€‚</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sh">git <span class="hljs-built_in">clone</span> git@github.com:waipangsze/waipangsze.github.io.git<br>waipangsze.github.io/<br>git switch hexo <br>git <span class="hljs-built_in">log</span> <br><span class="hljs-built_in">cp</span> -r .git ../../blog/ <span class="hljs-comment"># delete all files except .git</span><br><span class="hljs-built_in">cd</span> ../../blog/<br><span class="hljs-built_in">cat</span> .gitignore <br>git status<br>git add .<br>git commit -a <span class="hljs-comment"># git commit -m &quot;xxxx&quot;</span><br>git push origin hexo<br></code></pre></td></tr></table></figure><p>æ–°ç¯å¢ƒ</p><p>è¿™éƒ¨åˆ†åº”è¯¥è¦ç®€å•ä¸€ç‚¹ï¼Œå¦‚æœä½ å·²ç»æ­å»ºè¿‡ä¸€ä¸ªhexoåšå®¢çš„è¯ã€‚</p><ul><li>æ–°ç”µè„‘ä¸Šå®‰è£…node.jså’Œgitã€‚</li><li>å®‰è£…hexoï¼šnpm install -g hexo-cliã€‚</li><li>cloneè¿œç¨‹ä»“åº“åˆ°æœ¬åœ° git clone git@github.com:username/username.github.io.gitã€‚</li><li>æ ¹æ®packge.jsonå®‰è£…ä¾èµ–npm installã€‚</li><li>æœ¬åœ°ç”Ÿæˆç½‘ç«™å¹¶å¼€å¯åšå®¢æœåŠ¡å™¨ï¼šhexo g &amp; hexo sã€‚å¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œæ­¤æ—¶æ‰“å¼€æµè§ˆå™¨è¾“å…¥<a href="http://localhost:4000/" class="uri">http://localhost:4000/</a> å·²ç»å¯ä»¥çœ‹åˆ°åšå®¢æ­£å¸¸è¿è¡Œäº†ã€‚</li></ul><p>åœ¨ä¸¤å°ç”µè„‘ä¸Šçš„åŒæ­¥æ“ä½œ</p><p>è‡³æ­¤ï¼Œè¿ç§»å·¥ä½œå·²å®Œæˆï¼Œåœ¨ä¸¤å°ç”µè„‘ä¹‹é—´çš„åŒæ­¥æ“ä½œå¦‚ä¸‹ï¼š</p><ul><li>git pullä»è¿œç¨‹hexoåˆ†æ”¯æ‹‰å–æœ€æ–°çš„ç¯å¢ƒæ–‡ä»¶åˆ°æœ¬åœ°ï¼Œå¯ä»¥ç†è§£ä¸ºsvnçš„æ›´æ–°æ“ä½œã€‚æ¯”å¦‚åœ¨å…¬å¸å†™äº†åšå®¢ï¼Œå›å®¶åœ¨ç”µè„‘ä¸Šä¹Ÿè¦å†™éœ€è¦å…ˆæ‰§è¡Œè¿™ä¸€æ­¥æ“ä½œã€‚</li><li>æ–‡ç« å†™å®Œï¼Œè¦å‘å¸ƒæ—¶ï¼Œéœ€è¦å…ˆæäº¤ç¯å¢ƒæ–‡ä»¶ï¼Œå†å‘å¸ƒæ–‡ç« ã€‚æŒ‰ä»¥ä¸‹é¡ºåºæ‰§è¡Œå‘½ä»¤ï¼šgit add .ã€git commit -m "some descrption"ã€git push origin hexoã€hexo g -dã€‚</li></ul><h1 id="upload-to-github">Upload to github</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh">git pull --rebase <span class="hljs-comment"># do this at the beginning</span><br>git status<br>git add . <span class="hljs-comment"># add all files</span><br>git commit --amend<br><span class="hljs-comment"># git push (-f)</span><br>git push -u origin hexo<br></code></pre></td></tr></table></figure><h1 id="ç›¸é—œé€£çµ-icon">ç›¸é—œé€£çµ icon</h1><p>å®˜æ–¹çš„ icon åœ–ç¤ºï¼Œå‡å¼•ç”¨è‡ªç›®å‰åšç¶²ç«™æœ€å¤šäººä½¿ç”¨çš„å…è²» icon åœ–åº« <a href="https://fontawesome.com/">Font Awesome</a>ï¼ŒFont Awesome æ˜¯ä¸€å€‹åŸºæ–¼CSSå’ŒLESSçš„å­—é«”å’Œåœ–ç¤ºå·¥å…·å¥—ä»¶ã€‚å®ƒç”±Dave Gandyè£½ä½œï¼Œç”¨æ–¼Twitter Bootstrapï¼Œå¾Œä¾†è¢«æ•´åˆåˆ°BootstrapCDN ä¸­ã€‚Font Awesomeåœ¨ä½¿ç”¨ç¬¬ä¸‰æ–¹Font Scriptsçš„ç¶²ç«™ä¸­ä½”æœ‰20ï¼…çš„å¸‚å ´ä»½é¡ï¼Œæ’åœ¨Googleå­—é«”ä¹‹å¾Œçš„ç¬¬äºŒä½ã€‚</p><h1 id="å¤šå¼ å›¾ç‰‡æŒ‰ä¸€å®šå¸ƒå±€ç»„åˆæ˜¾ç¤º">å¤šå¼ å›¾ç‰‡æŒ‰ä¸€å®šå¸ƒå±€ç»„åˆæ˜¾ç¤º</h1><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs less">&#123;% <span class="hljs-selector-tag">gi</span> <span class="hljs-number">5</span> <span class="hljs-number">3</span><span class="hljs-selector-tag">-2</span> %&#125;<br>!<span class="hljs-selector-attr">[1]</span>(<span class="hljs-attribute">https</span>:<span class="hljs-comment">//i.imgur.com/RwpxULg.png)</span><br>![<span class="hljs-number">2</span>](<span class="hljs-attribute">https</span>:<span class="hljs-comment">//i.imgur.com/RwpxULg.png)</span><br>![<span class="hljs-number">3</span>](<span class="hljs-attribute">https</span>:<span class="hljs-comment">//i.imgur.com/RwpxULg.png)</span><br>![<span class="hljs-number">4</span>](<span class="hljs-attribute">https</span>:<span class="hljs-comment">//i.imgur.com/RwpxULg.png)</span><br>![<span class="hljs-number">5</span>](<span class="hljs-attribute">https</span>:<span class="hljs-comment">//i.imgur.com/RwpxULg.png)</span><br>&#123;% endgi %&#125;<br></code></pre></td></tr></table></figure><div class="group-image-container"><div class="group-image-row"><div class="group-image-wrap"><img src="https://i.imgur.com/RwpxULg.png" alt="1" /></div><div class="group-image-wrap"><img src="https://i.imgur.com/RwpxULg.png" alt="2" /></div><div class="group-image-wrap"><img src="https://i.imgur.com/RwpxULg.png" alt="3" /></div></div><div class="group-image-row"><div class="group-image-wrap"><img src="https://i.imgur.com/RwpxULg.png" alt="4" /></div><div class="group-image-wrap"><img src="https://i.imgur.com/RwpxULg.png" alt="5" /></div></div></div><h1 id="å±•ç¤ºpdf">å±•ç¤ºPDF</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">npm install --save hexo-pdf<br></code></pre></td></tr></table></figure><p>and</p><figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs django"><span class="hljs-template-tag">&#123;% <span class="hljs-name">pdf</span> ../pdf/xxx.pdf %&#125;</span><br></code></pre></td></tr></table></figure><h1 id="çµ±è¨ˆç¶²ç«™çš„é€ è¨ªåœ°å€å’Œip">çµ±è¨ˆç¶²ç«™çš„é€ è¨ªåœ°å€å’ŒIP</h1><ol type="1"><li><a href="http://www.waylon.one/website/statistics-visitor-traffic/">é€šè¿‡ clustermaps ç»Ÿè®¡ Hexo ç½‘ç«™çš„è®¿é—®åœ°åŒºå’Œ IP</a></li></ol><p><a href="https://clustrmaps.com/">clustrmaps.com</a> æ˜¯ç¾åœ‹çš„è³‡æ–™ç¶²ç«™ã€‚</p><p>ç¶²å€æä¾›äº†ç”¢ç”Ÿè¨ªå®¢åœ°å€åˆ†ä½ˆåœ–çš„ç¨‹å¼ç¢¼ï¼Œå¯ä»¥åµŒå…¥åˆ°ç¶²ç«™æˆ–éƒ¨è½æ ¼ä¸­ï¼Œä¾†é¡¯ç¤ºä¾†è‡ªä¸–ç•Œå„åœ°è¨ªå®¢çš„å³æ™‚åœ°åœ–ï¼Œæœ‰åŠ©æ–¼ç™¼å±•æ‚¨éš±è—çš„èˆˆè¶£ç¤¾ç¾¤ã€‚æœ€é‡è¦çš„æ˜¯ï¼Œé€™å€‹åŠŸèƒ½æ˜¯å…è²»çš„ï¼Œèƒ½å¤ æ»¿è¶³å€‹äººç¶²ç«™çš„éœ€æ±‚ã€‚</p><ul><li>é…ç½® clustrmaps<ul><li>ç¶²ç«™è¨»å†Šå¾Œï¼Œè«‹é€ è¨ª Enter your website address æ–°å¢è‡ªå·±çš„ç¶²ç«™åœ°å€ï¼Œé¸æ“‡å…è²»çš„æœå‹™ã€‚</li><li>é¸æ“‡è‡ªå·±å–œæ­¡çš„å¤–æ›æ ¼å¼ï¼Œç¾åœ¨ Hexo çš„ Next å…©å€‹ä¸»é¡Œéƒ½æ˜¯æ”¯æ´çš„ï¼Œæ¯”è¼ƒå–œæ­¡ Map widget çš„ä¸»é¡Œã€‚</li><li>é»é¸é¸æ“‡å¾Œï¼Œæ‹·è²ç¶²ç«™å‡ºç¾çš„è…³æœ¬ javascript ç¨‹å¼ç¢¼ï¼Œè²¼åˆ°ä¸»é¡Œä¸‹æŸå€‹ä½ç½®ã€‚</li><li>æˆ‘æŠŠå®ƒæ”¾åœ¨ about.ejs or index.md çš„æœ€å¾Œã€‚<ul><li><script type="text/javascript" id="clustrmaps" src="//clustrmaps.com/map_v2.js?d=-FD52b9oydXY9a4RbTCAxGTeHgh-1YTFnwSX0jxQlA0&cl=ffffff&w=a"></script></li></ul></li><li>é‡æ–°éƒ¨ç½²ç¶²ç«™ï¼Œæ‚¨å°±å¯ä»¥åœ¨é¦–é çœ‹åˆ°å³æ™‚è¨ªå®¢ä¾†æºåœ–ï¼Œå¦‚æˆ‘çš„ç¶²ç«™é¦–é æ‰€ç¤ºã€‚å¦å¤–ï¼Œé»æ“Šåœ°åœ–ï¼Œå¯ä»¥çœ‹åˆ°æ›´è©³ç´°çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬è¨ªå®¢çš„åœ°åœ–ã€ç€è¦½è¨­å‚™ä»¥åŠ IPã€‚</li></ul></li></ul><h1 id="å°å…¥å½±ç‰‡">å°å…¥å½±ç‰‡</h1><p>The easiest way to get the correct link is to right-click on the YouTube video and select copy embed code.</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">iframe</span> <span class="hljs-attr">width</span>=<span class="hljs-string">&quot;560&quot;</span> <span class="hljs-attr">height</span>=<span class="hljs-string">&quot;315&quot;</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;xxx&quot;</span> <span class="hljs-attr">......</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">iframe</span>&gt;</span><br></code></pre></td></tr></table></figure><iframe width="560" height="315" src="https://www.youtube.com/embed/XGPLHwARPSY?si=yd2MGyNa0GhkBkCs" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe><h1 id="æ”¯æŒäºŒçº§èœå•ä¸‹æ‹‰èœå•">æ”¯æŒäºŒçº§èœå•ï¼ˆä¸‹æ‹‰èœå•ï¼‰</h1><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-comment"># å¯¼èˆªæ èœå•ï¼Œå¯è‡ªè¡Œå¢å‡ï¼Œkey ç”¨æ¥å…³è” languages/*.ymlï¼Œå¦‚ä¸å­˜åœ¨å…³è”åˆ™æ˜¾ç¤º key æœ¬èº«çš„å€¼ï¼›icon æ˜¯ css classï¼Œå¯ä»¥çœç•¥ï¼›å¢åŠ  name å¯ä»¥å¼ºåˆ¶æ˜¾ç¤ºæŒ‡å®šåç§°</span><br><span class="hljs-comment"># Navigation bar menu. `key` is used to associate languages/*.yml. If there is no association, the value of `key` itself will be displayed; if `icon` is a css class, it can be omitted; adding `name` can force the display of the specified name</span><br><span class="hljs-attr">menu:</span><br>  <span class="hljs-bullet">-</span> &#123; <span class="hljs-attr">key:</span> <span class="hljs-string">&quot;home&quot;</span>, <span class="hljs-attr">link:</span> <span class="hljs-string">&quot;/&quot;</span>, <span class="hljs-attr">icon:</span> <span class="hljs-string">&quot;iconfont icon-home-fill&quot;</span> &#125;<br>  <span class="hljs-bullet">-</span> &#123; <span class="hljs-attr">key:</span> <span class="hljs-string">&quot;archive&quot;</span>, <span class="hljs-attr">link:</span> <span class="hljs-string">&quot;/archives/&quot;</span>, <span class="hljs-attr">icon:</span> <span class="hljs-string">&quot;iconfont icon-archive-fill&quot;</span> &#125;<br>  <span class="hljs-bullet">-</span> &#123; <span class="hljs-attr">key:</span> <span class="hljs-string">&quot;category&quot;</span>, <span class="hljs-attr">link:</span> <span class="hljs-string">&quot;/categories/&quot;</span>, <span class="hljs-attr">icon:</span> <span class="hljs-string">&quot;iconfont icon-category-fill&quot;</span> &#125;<br>  <span class="hljs-bullet">-</span> &#123; <span class="hljs-attr">key:</span> <span class="hljs-string">&quot;tag&quot;</span>, <span class="hljs-attr">link:</span> <span class="hljs-string">&quot;/tags/&quot;</span>, <span class="hljs-attr">icon:</span> <span class="hljs-string">&quot;iconfont icon-tags-fill&quot;</span> &#125;<br>  <span class="hljs-bullet">-</span> &#123; <span class="hljs-attr">key:</span> <span class="hljs-string">&quot;links&quot;</span>, <span class="hljs-attr">link:</span> <span class="hljs-string">&quot;/links/&quot;</span>, <span class="hljs-attr">icon:</span> <span class="hljs-string">&quot;iconfont icon-link-fill&quot;</span> &#125;<br>  <span class="hljs-bullet">-</span> &#123; <span class="hljs-attr">key:</span> <span class="hljs-string">&quot;Bookmarks&quot;</span>, <span class="hljs-attr">link:</span> <span class="hljs-string">&quot;/bookmark/&quot;</span>, <span class="hljs-attr">icon:</span> <span class="hljs-string">&quot;iconfont icon-bookmark&quot;</span>&#125;<br>  <span class="hljs-bullet">-</span> &#123; <span class="hljs-attr">key:</span> <span class="hljs-string">&quot;about&quot;</span>, <span class="hljs-attr">link:</span> <span class="hljs-string">&quot;/about/&quot;</span>, <span class="hljs-attr">icon:</span> <span class="hljs-string">&quot;iconfont icon-user-fill&quot;</span>, <span class="hljs-attr">name:</span> <span class="hljs-string">&#x27;About Me&#x27;</span>&#125;<br>  <span class="hljs-bullet">-</span> &#123;<br>  <span class="hljs-attr">key:</span> <span class="hljs-string">&#x27;Docs&#x27;</span>,<br>  <span class="hljs-attr">icon:</span> <span class="hljs-string">&#x27;iconfont icon-books&#x27;</span>,<br>  <span class="hljs-attr">submenu:</span> [<br>    <span class="hljs-comment">#&#123; key: &#x27;Physics&#x27;, link: &#x27;/archives/&#x27; &#125;,</span><br>    <span class="hljs-comment">#&#123; key: &#x27;Mathematics&#x27;, link: &#x27;/tags/&#x27; &#125;,</span><br>    &#123; <span class="hljs-attr">key:</span> <span class="hljs-string">&#x27;Meteorology&#x27;</span>, <span class="hljs-attr">link:</span> <span class="hljs-string">&#x27;/categories/Meteorology/&#x27;</span>, <span class="hljs-attr">icon:</span> <span class="hljs-string">&quot;iconfont icon-plan&quot;</span> &#125;<br>  ]<br>  &#125;<br></code></pre></td></tr></table></figure><p>é€™è£¡æˆ‘å€‘ä½¿ç”¨/categories/Meteorology/ä¸­çš„éˆæ¥ï¼Œä½†å®ƒåªæ˜¯æ¨™é¡Œï¼Œæ²’æœ‰<strong>å°é¢åœ–ç‰‡</strong>ã€‚å¦‚ä½•é¡¯ç¤º<strong>å°é¢åœ–ç‰‡</strong>ï¼Ÿ</p><h2 id="on-category.ejs">On category.ejs</h2><p>é€™è£¡æˆ‘å€‘ä½¿ç”¨/categories/Meteorology/ä¸­çš„éˆæ¥ï¼Œä½†å®ƒåªæ˜¯æ¨™é¡Œï¼Œæ²’æœ‰<strong>å°é¢åœ–ç‰‡</strong>ã€‚å¦‚ä½•é¡¯ç¤º<strong>å°é¢åœ–ç‰‡</strong>ï¼Ÿ</p><p>å®ƒèª¿ç”¨äº†ç¨‹å¼ç¢¼,</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;%- <span class="hljs-title function_">partial</span>(<span class="hljs-string">&#x27;_partials/archive-list.ejs&#x27;</span>, &#123; <span class="hljs-attr">params</span>: &#123; <span class="hljs-attr">key</span>: page.<span class="hljs-property">layout</span>, <span class="hljs-attr">postTotal</span>: cat ? cat.<span class="hljs-property">posts</span>.<span class="hljs-property">length</span> : <span class="hljs-number">0</span> &#125; &#125;) %&gt;<br></code></pre></td></tr></table></figure><p>å»ºç«‹ä¸€å€‹ my-list.ejs ä¸¦ä½¿ç”¨å®ƒçš„ç¨‹å¼ç¢¼ï¼Œ</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;%- <span class="hljs-title function_">partial</span>(<span class="hljs-string">&#x27;_partials/my-list.ejs&#x27;</span>, &#123; <span class="hljs-attr">params</span>: &#123; <span class="hljs-attr">key</span>: page.<span class="hljs-property">layout</span>, <span class="hljs-attr">postTotal</span>: cat ? cat.<span class="hljs-property">posts</span>.<span class="hljs-property">length</span> : <span class="hljs-number">0</span> &#125; &#125;) %&gt;<br></code></pre></td></tr></table></figure><p>my-list.ejs æ˜¯ä»€éº¼ï¼Ÿ ï¼ˆè¤‡è£½è‡ªindex.ejsï¼Œå…¶ä¸­ä¸€éƒ¨åˆ†ï¼‰</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;div <span class="hljs-keyword">class</span>=<span class="hljs-string">&quot;list-group&quot;</span>&gt;<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;h4&quot;</span>&gt;</span>&lt;%= __(params.key + &#x27;.post_total&#x27;, params.postTotal) %&gt;<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br>  &lt;hr&gt;<br>  &lt;% <span class="hljs-keyword">var</span> dateCursor %&gt;<br>  &lt;% page.<span class="hljs-property">posts</span>.<span class="hljs-title function_">each</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">post</span>) &#123; %&gt;<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;row mx-auto index-card&quot;</span>&gt;</span></span><br><span class="language-xml">      &lt;% var post_url = url_for(post.path), index_img = post.index_img || theme.post.default_index_img %&gt;</span><br><span class="language-xml">      &lt;% if (index_img) &#123; %&gt;</span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;col-12 col-md-4 m-auto index-img&quot;</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;&lt;%= post_url %&gt;&quot;</span> <span class="hljs-attr">target</span>=<span class="hljs-string">&quot;&lt;%- theme.index.post_url_target %&gt;&quot;</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;&lt;%= url_for(index_img) %&gt;&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;&lt;%= post.title %&gt;&quot;</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">      &lt;% &#125; %&gt;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">article</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;col-12 col-md-&lt;%= index_img ? &#x27;8&#x27; : &#x27;12&#x27; %&gt; mx-auto index-info&quot;</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;index-header&quot;</span>&gt;</span></span><br><span class="language-xml">          &lt;% if (theme.index.post_sticky &amp;&amp; theme.index.post_sticky.enable &amp;&amp; post.sticky &gt; 0) &#123; %&gt;</span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;index-pin &lt;%= theme.index.post_sticky &amp;&amp; theme.index.post_sticky.icon %&gt;&quot;</span> <span class="hljs-attr">title</span>=<span class="hljs-string">&quot;Pin on top&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span></span><br><span class="language-xml">          &lt;% &#125; %&gt;</span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;&lt;%= post_url %&gt;&quot;</span> <span class="hljs-attr">target</span>=<span class="hljs-string">&quot;&lt;%- theme.index.post_url_target %&gt;&quot;</span>&gt;</span></span><br><span class="language-xml">            &lt;%= post.title %&gt;</span><br><span class="language-xml">          <span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span></span><br><span class="language-xml">  </span><br><span class="language-xml">        &lt;% var excerpt = post.description || post.excerpt || (theme.index.auto_excerpt.enable &amp;&amp; !post.encrypt &amp;&amp; post.content) %&gt;</span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;index-excerpt &lt;%= index_img ? &#x27;&#x27; : &#x27;index-excerpt__noimg&#x27; %&gt;&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;&lt;%= post_url %&gt;&quot;</span> <span class="hljs-attr">target</span>=<span class="hljs-string">&quot;&lt;%- theme.index.post_url_target %&gt;&quot;</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">            &lt;%- strip_html(excerpt).substring(0, 200).trim().replace(/\n/g, &#x27; &#x27;) %&gt;</span><br><span class="language-xml">          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span><br><span class="language-xml">  </span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;index-btm post-metas&quot;</span>&gt;</span></span><br><span class="language-xml">          &lt;% if (theme.index.post_meta.date) &#123; %&gt;</span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;post-meta mr-3&quot;</span>&gt;</span></span><br><span class="language-xml">              <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;iconfont icon-date&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span></span><br><span class="language-xml">              <span class="hljs-tag">&lt;<span class="hljs-name">time</span> <span class="hljs-attr">datetime</span>=<span class="hljs-string">&quot;&lt;%= full_date(post.date, &#x27;YYYY-MM-DD HH:mm&#x27;) %&gt;&quot;</span> <span class="hljs-attr">pubdate</span>&gt;</span></span><br><span class="language-xml">                &lt;%- date(post.date, config.date_format) %&gt;</span><br><span class="language-xml">              <span class="hljs-tag">&lt;/<span class="hljs-name">time</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">          &lt;% &#125; %&gt;</span><br><span class="language-xml">          &lt;% if (theme.index.post_meta.category &amp;&amp; post.categories.length &gt; 0) &#123; %&gt;</span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;post-meta mr-3 d-flex align-items-center&quot;</span>&gt;</span></span><br><span class="language-xml">              <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;iconfont icon-category&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span></span><br><span class="language-xml">              &lt;%- partial(&#x27;_partials/category-chains&#x27;, &#123; categories: post.categories, limit: 1 &#125;) %&gt;</span><br><span class="language-xml">            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">          &lt;% &#125; %&gt;</span><br><span class="language-xml">          &lt;% if (theme.index.post_meta.tag &amp;&amp; post.tags.length &gt; 0) &#123; %&gt;</span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;post-meta&quot;</span>&gt;</span></span><br><span class="language-xml">              <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;iconfont icon-tags&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span></span><br><span class="language-xml">              &lt;% post.tags.each(function(tag)&#123; %&gt;</span><br><span class="language-xml">                <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;&lt;%= url_for(tag.path) %&gt;&quot;</span>&gt;</span>#&lt;%- tag.name %&gt;<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span><br><span class="language-xml">              &lt;% &#125;) %&gt;</span><br><span class="language-xml">            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">          &lt;% &#125; %&gt;</span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">article</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">  &lt;% &#125;) %&gt;</span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><br>&lt;%- <span class="hljs-title function_">partial</span>(<span class="hljs-string">&#x27;_partials/paginator&#x27;</span>) %&gt;<br></code></pre></td></tr></table></figure><h1 id="ç¯„ä¾‹ç¶²ç«™">ç¯„ä¾‹ç¶²ç«™</h1><ol type="1"><li><a href="https://zkqiang.cn/">zkqiang's blog</a></li><li><a href="https://fantasyhh.github.io/archives/page/5/#board">ç§‰çƒ›å¤œè¯»</a><ol type="1"><li><a href="https://github.com/fantasyhh/fantasyhh.github.io" class="uri">https://github.com/fantasyhh/fantasyhh.github.io</a></li></ol></li><li><a href="https://s81679.github.io/2020/02/25/hexo-theme-fluid/">ä¾†é»é³¥ blog</a></li><li><a href="https://www.eatrice.cn/post/%E4%BB%8E0%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AAhexo%E5%8D%9A%E5%AE%A2/">åƒç™½é¥­çš„ä¼‘ä¼¯åˆ©å®‰å·</a></li><li><a href="https://yuzhang.pages.dev/about/">Yu's Space</a></li><li><a href="https://blog.justlovesmile.top/about/">Justlovesmile</a></li><li><a href="https://zsyyblog.com/about/">zsyyblog.com</a></li><li><a href="https://yangyy.top/about/">Yangyy's Life</a></li><li><a href="https://blognas.hwb0307.com/me">Benszâ€™s blog</a></li><li><a href="https://neutrino7.top/about/#comment">ä¸ƒå·ä¸­å¾®å­</a></li><li><a href="https://blog.zsd.name/posts/63716.html#%E8%87%AA%E5%AE%9A%E5%88%B6%E4%BF%AE%E6%94%B9">å¼ èµ›ä¸œ</a></li><li><a href="https://www.yousazoe.top/archives/e5b4d2d6.html">Fl0w3r | Hexo-Fluid åšå®¢å»ºç«™è¨˜éŒ„</a></li><li><a href="https://www.tabirstrees.top/about/">å—ç§‘å¤§åœ°ç©ºç³»ç©ºé—´ç‰©ç†ç ”ç©¶ç”Ÿ</a></li></ol><h1 id="references">References:</h1><ol type="1"><li><a href="https://fluid-dev.github.io/hexo-fluid-docs/en/guide/">Hexo Fluid Docs</a></li><li><a href="https://async-docs.imalun.com/">ä¸€ä¸ªç®€å•è€Œè½»é‡çº§çš„ Hexo ä¸»é¢˜</a></li><li><a href="https://linyencheng.github.io/2022/09/14/relationships-between-frontend-and-backend/tool-hexo-blog/">ç”¨ Hexo å’Œ Github Pages å»ºç«‹éƒ¨è½æ ¼å§</a></li><li><a href="https://mp.weixin.qq.com/s/Iy-ZXHHHRwHBCwozF5wtyg">ç”¨ GitHub + Hexo å…è´¹æ­å»ºåšå®¢ï¼Œä¿å§†çº§æ•™ç¨‹</a></li><li><a href="https://wangxiaoyu-go.github.io/2018/11/23/hexo-filter-mermaid-diagrams/">Hexoä¸­æ’å…¥mermaid diagrams</a></li><li><a href="https://xuexuan.site/2021/02/04/hexo%E5%8D%9A%E5%AE%A2%E5%A4%9A%E8%AE%BE%E5%A4%87%E5%90%8C%E6%AD%A5/">hexoåšå®¢å¤šè®¾å¤‡åŒæ­¥</a></li><li><a href="https://blog.csdn.net/qq_30105599/article/details/118302086">å¤šå°ç”µè„‘åŒæ­¥æ›´æ–°Hexoåšå®¢</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>github</category>
      
    </categories>
    
    
    <tags>
      
      <tag>github.io</tag>
      
      <tag>blog</tag>
      
      <tag>Hexo</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>DA-Meteorological Data Encoding(æ°£è±¡æ•¸æ“šç·¨ç¢¼)</title>
    <link href="/2024/08/20/DA-obs-introduction/"/>
    <url>/2024/08/20/DA-obs-introduction/</url>
    
    <content type="html"><![CDATA[<h1 id="meteorological-data-encoding">Meteorological Data Encoding</h1><p>æ°£è±¡æ•¸æ“šç·¨ç¢¼</p><ul><li><a href="https://www.hko.gov.hk/tc/education/weather/data-and-technology/00479-abc-of-meteorological-data-encoding.html">HKO æ·ºè«‡æ°£è±¡æ•¸æ“šç·¨ç¢¼ (2015)</a></li><li><a href="https://web.archive.org/web/20180215023559/https://www.eumetsat.int/website/wcm/idc/idcplg?IdcService=GET_FILE&amp;dDocName=PDF_CONF_P57_S5_01_KARHILA_V&amp;RevisionSelectionMethod=LatestReleased&amp;Rendition=Web">BUFR: A METEOROLOGICAL CODE FOR THE 21ST CENTURY (2010)</a></li><li><a href="https://photino.cwb.gov.tw/rdcweb/lib/cd/cd01conf/dissertation/2014WAF/A1/A1-23.pdf">ä¸­å¤®æ°£è±¡å±€æ–°æ ¼å¼æ°£è±¡è§€æ¸¬è³‡ï¦¾ä½œæ¥­ç³»çµ±ä»‹ç´¹ (2014)</a></li><li><a href="https://community.wmo.int/en/activity-areas/operational-information-service/migration-tac-tdcf">Migration TAC to TDCF</a></li><li><a href="https://mp.weixin.qq.com/s/qiowYgEHHdQhC4TPbcjMVw">æ°”è±¡ç¼–ç¨‹ | è¯»å–æ°”è±¡BUFRã€PREPBUFRæ•°æ®</a></li></ul><p>Currently, most meteorological observations are being produced and transmitted in special formats known as</p><ul><li>Traditional Alphanumeric Codes (TAC) å‚³çµ±å­—ç¬¦ä»£ç¢¼</li><li>Table-Driven Code Forms (TDCF) è¡¨æ ¼é©…å‹•ä»£ç¢¼</li></ul><p>as promulgated by WMO. Both TAC and TDCF are ways of representing meteorological data intended for international exchange in real-time.</p><figure><img src="https://www.hko.gov.hk/en/education/images/fig_00479_1e.png" alt="Decoded TAC Information" /><figcaption>Decoded TAC Information</figcaption></figure><figure><img src="https://www.hko.gov.hk/en/education/images/fig_00479_2e.png" alt="Decoded BUFR Information" /><figcaption>Decoded BUFR Information</figcaption></figure><h2 id="bufr">BUFR</h2><ul><li>Binary Universal Form for the Representation of meteorological data</li><li>äºŒé€²åˆ¶é€šç”¨æ•¸æ“šè¡¨ç¤ºæ ¼å¼</li></ul><p>BURF is TDCF.</p><p>The latest version is BUFR Edition 4. BUFR Edition 3 is also considered current for operational use. BUFR was created in 1988 with the goal of replacing the WMO's dozens of character-based, position-driven meteorological codes, such as <strong>SYNOP (surface observations)</strong>, <strong>TEMP (upper air soundings)</strong> and <strong>CLIMAT (monthly climatological data)</strong>. BUFR was designed to be portable, compact, and universal. Any kind of data can be represented, along with its specific spatial/temporal context and any other associated metadata. In the WMO terminology, BUFR belongs to the category of table-driven code forms, where the meaning of data elements is determined by referring to a set of tables that are kept and maintained separately from the message itself.</p><h1 id="little_r">LITTLE_R</h1><p><a href="https://www2.mmm.ucar.edu/wrf/users/wrfda/OnlineTutorial/Help/littler.html">What is LITTLE_R?</a></p><p>LITTLE_R is an ASCII-based observation file format, <strong>in use since the MM5 era</strong>. Because raw observation data files have many possible formats (such as ASCII, BUFR, PREPBUFR, MADIS, and HDF) LITTLE_R is designed to be an intermediate format so that <strong>WRFDA might be able to assimilate as many observation types as possible in a universal manner</strong>. It is a report-based file format, so all manner of observation types can easily be "cat-ted" together into an easy-to-read and -edit text file.</p><p><strong>It is the user's responsibility to develop an interface to convert their own observations to LITTLE_R format so they may be read by OBSPROC</strong>. We (UCAR) do not support any existing tools which do this. However, on this help page, we hope to describe the format as thoroughly as possible to aid the user in the conversion process.</p>]]></content>
    
    
    <categories>
      
      <category>DA</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NWP</tag>
      
      <tag>WRF</tag>
      
      <tag>MPAS</tag>
      
      <tag>DA</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ERA5 CDS upgrade (2024 Sep)</title>
    <link href="/2024/08/16/ERA5-2024-upgrade/"/>
    <url>/2024/08/16/ERA5-2024-upgrade/</url>
    
    <content type="html"><![CDATA[<h1 id="climate-data-store-cds">Climate Data Store (CDS)</h1><p>Some time ago, an upgrade notice was officially released on the Copernicus Climate Change Service (C3S) website. <strong>The old interface was closed in September 2024</strong>. Currently, the download of ERA5 data is gradually upgraded from the old CDS interface system to the new CDS-Beta.</p><p><a href="https://cds-beta.climate.copernicus.eu/">Climate Data Store</a></p><p>The Copernicus Climate Change Service (C3S) supports society by providing authoritative information about the past, present and future climate in Europe and the rest of the World.</p><ul><li><strong>15 May 2024</strong> BETA version of the new <a href="https://ewds-beta.climate.copernicus.eu/">CEMS Early Warning Data Store (EWDS)</a>. Your feedback is very useful for us. Please notice that access to the system might suffer some disruptions due to evolving updates.</li><li><strong>16 Jun 2024</strong> Check our <a href="https://confluence.ecmwf.int/x/uINmFw">informative page</a> to best prepare yourself to use CDS-Beta.</li><li><strong>16 Jun 2024</strong> CDS API syntax is changed and some keys or parameter names may have also changed. To avoid requests failing, please use the "Show API request code" tool on the dataset Download Form to check you are using the correct syntax for your API request.</li><li><strong>16 Jun 2024</strong> BETA version of the new CDS. Your feedback is very useful for us. Please notice that access to the system might suffer some disruptions due to evolving updates.</li><li><strong>18 Jul 2024</strong> Remember that you need to have an ECMWF account to use CDS-Beta. Your existing CDS credentials will not work in CDS-Beta!</li></ul><h2 id="registration-ecmwf-account">Registration ECMWF account</h2><p>registration address: https://www.ecmwf.int/ There is a <strong>Log in</strong> button in the upper right corner of the page, click on it directly!</p><h2 id="cds-beta-account-information-supplement-and-terms-upgrade">CDS-beta account information supplement and terms upgrade</h2><p>After successfully registering an ECMWF account, enter the page https://cds-beta.climate.copernicus.eu/</p><p>We need to go to the upgraded CDS page to complete the information, including: - country, - affiliation, - thematic activities, - activities sectors, and</p><p>Then, <strong>three Accet Terms &amp; Conditions</strong>. Itâ€™s all relatively simple! Finally, click Activate your profile to complete. Automatically return to the CDS-beta data customization home page.</p><h2 id="upgrade-cdsapi-library-and-.cdsapirc-key">Upgrade cdsapi library and .cdsapirc key</h2><p><strong>Note:</strong> We need to ensure that we have logged in to the CDS-beta account in advance!</p><p>Goto https://cds-beta.climate.copernicus.eu/how-to-api</p><h2 id="setup-the-cds-api-personal-access-token">Setup the CDS API personal access token</h2><p>Here is how to setup the CDS API personal access token:</p><p>If you do not have an account yet, please register. If you are not logged in, please login. Once logged in, copy the code displayed below to the file - <strong>$HOME/.cdsapirc</strong> (in your Unix/Linux environment):</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">url: https://cds-beta.climate.copernicus.eu/api<br>key: xxxxxx-xxxxx-xxxxx-xxxx-xxxx<br></code></pre></td></tr></table></figure><h2 id="install-the-cds-api-client">Install the CDS API client</h2><p>The CDS API client is a Python based library. It provides support for Python 3.</p><p>You can Install the CDS API client via the package management system pip, by running on Unix/Linux the command below.</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ conda install <span class="hljs-string">&#x27;cdsapi&gt;=0.7.0&#x27;</span><br></code></pre></td></tr></table></figure><p>and, (typing-extensions 4.9.0)</p><p>Version 0.7.0 or higher is required in order to be able to use the new data stores.</p><h2 id="use-the-cds-api-client-for-data-access">Use the CDS API client for data access</h2><p>Once the CDS API client is installed, it can be used to request data from the datasets listed in the CDS, ADS, ECDS and CEMS Early Warning DS catalogues.</p><p>One must agree to the Terms of Use of a dataset before downloading any data out of it. This step must be done manually from the dataset page (at the bottom of the download form).</p><p>At the bottom of each dataset download form, press the "Show API request code" button to display a Python code snippet that can be used to run the manually built request. The API call must have this syntax:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> cdsapi<br><br>client = cdsapi.Client()<br><br>dataset = <span class="hljs-string">&quot;&lt;DATASET-SHORT-NAME&gt;&quot;</span><br>request = &#123;<br>    &lt;SELECTION-REQUEST&gt;<br>&#125;<br>target = <span class="hljs-string">&quot;&lt;TARGET-FILE&gt;&quot;</span><br><br>client.retrieve(dataset, request, target)<br></code></pre></td></tr></table></figure><p>Example:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> cdsapi<br><br>client = cdsapi.Client()<br><br>dataset = <span class="hljs-string">&#x27;reanalysis-era5-pressure-levels&#x27;</span><br>request = &#123;<br>    <span class="hljs-string">&#x27;product_type&#x27;</span>: [<span class="hljs-string">&#x27;reanalysis&#x27;</span>],<br>    <span class="hljs-string">&#x27;variable&#x27;</span>: [<span class="hljs-string">&#x27;geopotential&#x27;</span>],<br>    <span class="hljs-string">&#x27;year&#x27;</span>: [<span class="hljs-string">&#x27;2024&#x27;</span>],<br>    <span class="hljs-string">&#x27;month&#x27;</span>: [<span class="hljs-string">&#x27;03&#x27;</span>],<br>    <span class="hljs-string">&#x27;day&#x27;</span>: [<span class="hljs-string">&#x27;01&#x27;</span>],<br>    <span class="hljs-string">&#x27;time&#x27;</span>: [<span class="hljs-string">&#x27;13:00&#x27;</span>],<br>    <span class="hljs-string">&#x27;pressure_level&#x27;</span>: [<span class="hljs-string">&#x27;1000&#x27;</span>],<br>    <span class="hljs-string">&#x27;data_format&#x27;</span>: <span class="hljs-string">&#x27;grib&#x27;</span>,<br>&#125;<br>target = <span class="hljs-string">&#x27;download.grib&#x27;</span><br><br>client.retrieve(dataset, request, target)<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>NWP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>WRF</tag>
      
      <tag>WPS</tag>
      
      <tag>MPAS</tag>
      
      <tag>IC/BC</tag>
      
      <tag>ERA5</tag>
      
      <tag>ECMWF</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>GFS/FNL/RDA upgrade (2024)</title>
    <link href="/2024/08/16/GFS_FNL_RDA_upgrade/"/>
    <url>/2024/08/16/GFS_FNL_RDA_upgrade/</url>
    
    <content type="html"><![CDATA[<h1 id="rda-team">RDA team</h1><p>RDA - Research Data Archive</p><h2 id="rda-data-services-unavailable-july-30-2024">RDA Data Services Unavailable July 30, 2024</h2><ul><li>July 26, 2024 Posted by: RDA Team</li></ul><p>Update on July 31, 2024: standard data file download, THREDDS access, and Globus transfer services have been restored. We continue to resolve issues with data search and subsetting services. Thank you for your patience during this maintenance period.</p><p>Due to scheduled updates on the NSF NCAR Research Data Archive, all RDA data access services, including downloads, data subsetting, and THREDDS data server access, will be unavailable July 30, 2024 beginning at 9:00 AM MDT. We anticipate services to be restored near the end of the day July 30. Please follow our Twitter profile (<span class="citation" data-cites="NCAR_RDA">@NCAR_RDA</span>) for updates.</p><p>The primary purpose of the downtime is to update the dataset numbering system for data collections archived in the RDA. After the update, <strong>all RDA datasets will be identified by a dataset number in the format 'dnnnnnn', where 'nnnnnn' is the serial number used to identify a dataset. Until now, dataset numbers have been in the format 'dnnn.n'. This format will be converted to the new format 'dnnn00n', in which the first three digits of the old format are placed in the first three positions of the new format, and the last digit of the old format will be placed in the last position of the new format. For example, the dataset ID 'ds094.1' will be converted to 'd094001', and the dataset ID 'ds351.0' will be converted to 'd351000'.</strong> Please contact us at rdahelp@ucar.edu if you have questions regarding this update.</p><h2 id="changes">Changes</h2><p>Goto <a href="https://waipangsze.github.io/2023/04/27/GFS_FNL/" class="uri">https://waipangsze.github.io/2023/04/27/GFS_FNL/</a></p><ul><li>old one: https://rda.ucar.edu/data/ds084.1/</li><li>new one: https://data.rda.ucar.edu/d084001/</li></ul>]]></content>
    
    
    <categories>
      
      <category>NWP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>WRF</tag>
      
      <tag>WPS</tag>
      
      <tag>MPAS</tag>
      
      <tag>IC/BC</tag>
      
      <tag>NCEP</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>WRF | WRF-DA Installation</title>
    <link href="/2024/08/16/wrf-DA_Installation/"/>
    <url>/2024/08/16/wrf-DA_Installation/</url>
    
    <content type="html"><![CDATA[<h1 id="preparation">Preparation</h1><p>Install all requried libraries of WRF.</p><p>Beginning with version 4.0, the basic WRF tar file now includes WRFDA, WRFPLUS, and WRF-Chem. Next to the WRFDA tar file link, there is a link to 'updates.' Take a look at that for additional information regarding this change. You can also find updated compiling instructions in the Users Guide: <a href="http://www2.mmm.ucar.edu/wrf/users/docs/user_guide_v4/v4.0/users_guide_chap6.html" class="uri">http://www2.mmm.ucar.edu/wrf/users/docs/user_guide_v4/v4.0/users_guide_chap6.html</a></p><h1 id="wrf-da">WRF-DA</h1><p><a href="https://www2.mmm.ucar.edu/wrf/users/wrfda/">WRF Data Assimilation System Users Page</a></p><p>The WRFDA system is in the public domain and is freely available for community use. It is designed to be a flexible, state-of-the-art atmospheric data assimilation system that is portable and efficient on available parallel computing platforms. WRFDA is suitable for use in a broad range of applications, across scales ranging from kilometers for regional and mesoscale modeling to thousands of kilometers for global scale modeling.</p><p>The Mesoscale and Microscale Meteorology (MMM) Laboratory of NCAR currently maintains and supports a subset of the overall WRF code (Version 4) that includes:</p><ul><li>WRF Software Framework (WSF)</li><li>Advanced Research WRF (ARW) dynamic solver, including one-way, two-way nesting and moving nests, grid and observation nudging</li><li>WRF Pre-Processing System (WPS)</li><li><strong>WRF Data Assimilation System (WRFDA)</strong></li><li>Numerous physics packages contributed by WRF partners and the research community</li></ul><h2 id="installation">Installation</h2><ul><li>wrf_env.sh</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/bash</span><br><br><span class="hljs-built_in">export</span> PATH=/home/wpsze/GNU_GCC/Library/gcc-v9.3.0/bin:<span class="hljs-variable">$PATH</span><br><span class="hljs-built_in">export</span> LD_LIBRARY_PATH=/home/wpsze/GNU_GCC/Library/gcc-v9.3.0/lib/<span class="hljs-variable">$&#123;LD_LIBRARY_PATH:+:$LD_LIBRARY_PATH&#125;</span><br><span class="hljs-built_in">export</span> LD_LIBRARY_PATH=/home/wpsze/GNU_GCC/Library/gcc-v9.3.0/lib64:<span class="hljs-variable">$LD_LIBRARY_PATH</span><br><br><span class="hljs-built_in">export</span> LD_LIBRARY_PATH=/home/wpsze/WRF/WRFv440/Library/lib:<span class="hljs-variable">$LD_LIBRARY_PATH</span><br><span class="hljs-built_in">export</span> LDFLAGS=-L/home/wpsze/WRF/WRFv440/Library/lib<br><span class="hljs-built_in">export</span> CPPFLAGS=-I/home/wpsze/WRF/WRFv440/Library/include<br><span class="hljs-built_in">export</span> NETCDF=/home/wpsze/WRF/WRFv440/Library/<br><span class="hljs-built_in">export</span> HDF5=/home/wpsze/WRF/WRFv440/Library/<br><span class="hljs-built_in">export</span> PATH=/home/wpsze/WRF/WRFv440/Library/bin:<span class="hljs-variable">$PATH</span><br><br>gcc --version<br>gfortran --version<br>mpirun --version<br><span class="hljs-built_in">which</span> mpif90 &amp; mpif90 --version<br><br>time mpif90 --version<br></code></pre></td></tr></table></figure><ul><li>wrf_da_install.sh</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/bash</span><br><span class="hljs-comment">############################## Directory Listing ############################</span><br><span class="hljs-built_in">export</span> HOME=`<span class="hljs-built_in">pwd</span>`<br><span class="hljs-built_in">export</span> download_DIR=<span class="hljs-variable">$HOME</span>/wrf_install/<br><span class="hljs-built_in">export</span> libs_DIR=<span class="hljs-variable">$HOME</span>/Library/<br><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$HOME</span><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$download_DIR</span><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$libs_DIR</span><br><br><span class="hljs-built_in">mkdir</span> -p wrf_install<br><span class="hljs-built_in">mkdir</span> -p Library<br><br><span class="hljs-comment">############################## WRF ############################</span><br><span class="hljs-built_in">source</span> /home/wpsze/WRF/WRFv440/wrf_env.sh<br><span class="hljs-comment">##################################################################</span><br><span class="hljs-comment"># Prior to version 4.0, WRFPlus code had been developed and maintained </span><br><span class="hljs-comment"># in a separated branch from WRF. From V4.0, it is now fully integrated </span><br><span class="hljs-comment"># into the same WRF branch. TLM/ADJ code is located in the &#x27;wrftladj&#x27; directory.</span><br><br><span class="hljs-comment"># Now WRF, WRFDA, and WRFPLUS are stored in the same package which you can get from GitHub. </span><br><span class="hljs-comment"># After downloading WRF package, decompress it three times, </span><br><span class="hljs-comment"># rename it to WRF, WRFDA, and WRFPLUS.</span><br><br><span class="hljs-built_in">cd</span> <span class="hljs-variable">$download_DIR</span><br><br><span class="hljs-built_in">rm</span> -rf WRFVDA4.5<br><br><span class="hljs-built_in">cp</span> -r WRFV4.4-raw WRFDAV4.4<br><br><span class="hljs-built_in">cd</span> WRFDAV4.4/<br><br>./clean -a<br><br>./configure wrfda<br><br><span class="hljs-comment">## rewrite: The character class \s will match the whitespace characters &lt;tab&gt; and &lt;space&gt;.</span><br><span class="hljs-comment">## and don&#x27;t include $(DM_FC) </span><br><span class="hljs-comment"># ** Not for all version **</span><br>sed -i <span class="hljs-string">&quot;s/\s\stime\s//g&quot;</span> configure.wrf<br><br>./compile all_wrfvar 2&gt;&amp;1 | <span class="hljs-built_in">tee</span> compile_wrfda.out<br><br><span class="hljs-comment"># After successful compilation, you can find the EXE file of WRFDA in the var/build/ directory</span><br><span class="hljs-comment"># ./var/build/da_wrfvar.exe</span><br></code></pre></td></tr></table></figure><p>End of compilation,</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs sh">......<br><span class="hljs-keyword">if</span> [ <span class="hljs-string">&quot;-DBUFR&quot;</span> = <span class="hljs-string">&quot;-DBUFR&quot;</span> ] ; <span class="hljs-keyword">then</span> \<br>gfortran -o obsproc.exe \<br>module_date.o module_namelist.o module_mm5.o module_map.o module_map_utils.o module_intp.o module_type.o module_func.o module_inside.o module_obs_merge.o module_per_type.o module_duplicate.o module_sort.o module_write.o module_complete.o module_recoverp.o module_diagnostics.o module_recoverh.o module_icao.o module_qc.o module_err_afwa.o module_err_ncep.o module_thin_ob.o \<br>module_decoded.o module_stntbl.o \<br>error_handler.o fm_decoder.o sort_platform.o qc_reduction.o check_obs.o setup.o \<br>obsproc.o  -O2 -ftree-vectorize -funroll-loops -w -ffree-form -ffree-line-length-none -fconvert=big-endian -frecord-marker=4      ../../external/bufr/libbufr.a; \<br><span class="hljs-keyword">else</span> \<br>gfortran -o obsproc.exe \<br>module_date.o module_namelist.o module_mm5.o module_map.o module_map_utils.o module_intp.o module_type.o module_func.o module_inside.o module_obs_merge.o module_per_type.o module_duplicate.o module_sort.o module_write.o module_complete.o module_recoverp.o module_diagnostics.o module_recoverh.o module_icao.o module_qc.o module_err_afwa.o module_err_ncep.o module_thin_ob.o \<br>module_decoded.o module_stntbl.o \<br>error_handler.o fm_decoder.o sort_platform.o qc_reduction.o check_obs.o setup.o \<br>obsproc.o  -O2 -ftree-vectorize -funroll-loops -w -ffree-form -ffree-line-length-none -fconvert=big-endian -frecord-marker=4      ; \<br><span class="hljs-keyword">fi</span><br>make[2]: Leaving directory <span class="hljs-string">&#x27;/home/wpsze/WRF/WRFv440/wrf_install/WRFDAV4.4/var/obsproc/src&#x27;</span><br>( /bin/rm -f obsproc.exe ;   <span class="hljs-built_in">ln</span> -s src/obsproc.exe . )<br>make[1]: Leaving directory <span class="hljs-string">&#x27;/home/wpsze/WRF/WRFv440/wrf_install/WRFDAV4.4/var/obsproc&#x27;</span><br>build started:   Fri Aug 16 15:09:14 HKT 2024<br>build completed: Fri Aug 16 15:13:51 HKT 2024<br></code></pre></td></tr></table></figure><h2 id="successful">Successful</h2><p>Checking, completely successful there should be 44 exe files.</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">ls</span> -l var/build/*exe var/obsproc/src/obsproc.exe<br></code></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs sh">da_advance_time.exe               gen_be_diags_read.exe<br>da_bias_airmass.exe               gen_be_ensmean.exe<br>da_bias_scan.exe                  gen_be_ensrf.exe<br>da_bias_sele.exe                  gen_be_ep1.exe<br>da_bias_verif.exe                 gen_be_ep2.exe<br>da_rad_diags.exe                  gen_be_etkf.exe<br>da_tune_obs_desroziers.exe        gen_be_hist.exe<br>da_tune_obs_hollingsworth1.exe    gen_be_stage0_gsi.exe<br>da_tune_obs_hollingsworth2.exe    gen_be_stage0_wrf.exe<br>da_update_bc_ad.exe               gen_be_stage1_1dvar.exe<br>da_update_bc.exe                  gen_be_stage1.exe<br>da_verif_grid.exe                 gen_be_stage1_gsi.exe<br>da_verif_obs.exe                  gen_be_stage2_1dvar.exe<br>da_wrfvar.exe                     gen_be_stage2a.exe<br>gen_be_addmean.exe                gen_be_stage2.exe<br>gen_be_cov2d3d_contrib.exe        gen_be_stage2_gsi.exe<br>gen_be_cov2d.exe                  gen_be_stage3.exe<br>gen_be_cov3d2d_contrib.exe        gen_be_stage4_global.exe<br>gen_be_cov3d3d_bin3d_contrib.exe  gen_be_stage4_regional.exe<br>gen_be_cov3d3d_contrib.exe        gen_be_vertloc.exe<br>gen_be_cov3d.exe                  gen_mbe_stage2.exe<br>gen_be_diags.exe<br></code></pre></td></tr></table></figure><p>and</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">/var/obsproc/src/obsproc.exe<br></code></pre></td></tr></table></figure><h2 id="error">Error</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">make[3]: time: No such file or directory make[3]: [makefile:42: module_io_int_idx.o] Error 127 (ignored)<br></code></pre></td></tr></table></figure><p>Solution: <a href="https://waipangsze.github.io/2024/05/29/WRF_install_time_error/">make -- time No such file or directory</a></p><h1 id="testcase">testcase</h1><ul><li><a href="https://forum.mmm.ucar.edu/threads/wrfda-4-5-with-wrf-3-9-testcase.13678/">wrfda 4.5 with wrf 3.9 testcase</a></li><li><a href="https://forum.mmm.ucar.edu/threads/error-the-input-file-appears-to-be-from-a-pre-v4-version-of-wrf-initialization-routines.5529/">ERROR: The input file appears to be from a pre-v4 version of WRF initialization routines</a></li><li><a href="https://www2.mmm.ucar.edu/wrf/users/wrfda/download/" class="uri">https://www2.mmm.ucar.edu/wrf/users/wrfda/download/</a></li></ul><blockquote><p>but in this link i don't have a 4.0 testdata and the last testdata that I have is for 3.9 So I've downloaded 3.9 testdata... As expected, it complained about old 3.9 data, so I had to include &gt; force_use_old_data=True</p></blockquote><h1 id="online-tutorial">Online Tutorial</h1><ul><li><a href="https://www2.mmm.ucar.edu/wrf/users/wrfda/OnlineTutorial/index.html">the WRFDA Online Tutorial!</a></li><li><a href="https://www2.mmm.ucar.edu/wrf/users/wrfda/OnlineTutorial/3dvar/index.html">3DVAR: The basics</a></li></ul><h1 id="references">References</h1><ul><li><a href="https://2018syocean.readthedocs.io/zh-cn/feature-delivery/hybrid/hybrid.html">2018æ²ˆé˜³æµ·æ´‹å·¥ç¨‹é¡¹ç›®-WRFDA-æ··åˆæ•°æ®åŒåŒ–æŠ€æœ¯/å¿«é€Ÿæ›´æ–°åŒåŒ–é¢„æŠ¥ç³»ç»Ÿ</a></li><li></li></ul>]]></content>
    
    
    <categories>
      
      <category>WRF</category>
      
    </categories>
    
    
    <tags>
      
      <tag>gnu</tag>
      
      <tag>Installation</tag>
      
      <tag>DA</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Spack and Intel OneAPI</title>
    <link href="/2024/08/13/spack_intel/"/>
    <url>/2024/08/13/spack_intel/</url>
    
    <content type="html"><![CDATA[<h1 id="spack">Spack</h1><p>Spack is a package management tool designed to support multiple versions and configurations of software on a wide variety of platforms and environments. It was designed for large supercomputing centers, where many users and application teams share common installations of software on clusters with exotic architectures, using libraries that do not have a standard ABI. Spack is non-destructive: installing a new version does not break existing installations, so many configurations can coexist on the same system. Most importantly, Spack is simple. It offers a simple spec syntax so that users can specify versions and configuration options concisely. Spack is also simple for package authors: package files are written in pure Python, and specs allow package authors to maintain a single file for many different builds of the same package.</p><p><a href="https://spack.readthedocs.io/en/latest/" class="uri">https://spack.readthedocs.io/en/latest/</a></p><h2 id="search-packages-online">Search packages online</h2><blockquote><p><a href="https://packages.spack.io/" class="uri">https://packages.spack.io/</a></p></blockquote><h1 id="installation">Installation</h1><p>Getting Spack is easy. You can clone it from the github repository using this command:</p><p>git clone -c feature.manyFiles=true https://github.com/spack/spack.git {:.info}</p><p>This will create a directory called spack.</p><p>Once you have cloned Spack, we recommend sourcing the appropriate script for your shell:</p><p>. spack/share/spack/setup-env.sh {:.info}</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh">For bash/zsh/sh<br>. spack/share/spack/setup-env.sh<br>(add into .bashrc)<br>For tcsh/csh<br><span class="hljs-built_in">source</span> spack/share/spack/setup-env.csh<br></code></pre></td></tr></table></figure><h1 id="intel">Intel</h1><p>IntelOneapi, https://spack.readthedocs.io/en/latest/build_systems/inteloneapipackage.html</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ spack <span class="hljs-built_in">env</span> create intel_oneapi <br>$ spack <span class="hljs-built_in">env</span> activate intel_oneapi<br>$ spack info --all intel-oneapi-mpi<br>$ spack info --all intel-oneapi-compilers<br></code></pre></td></tr></table></figure><p>try: module load intel-oneapi-mpi/2021.4.0 module load intel-oneapi-compilers/2021.4.0 <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ spack install --add intel-oneapi-compilers@2021.4.0<br><span class="hljs-comment"># Add the compilers to your compilers.yaml so spack can use them:</span><br>$ spack compiler add `spack location -i intel-oneapi-compilers@2021.4.0`/compiler/latest/linux/bin/intel64<br>$ spack compiler add `spack location -i intel-oneapi-compilers@2021.4.0`/compiler/latest/linux/bin<br><span class="hljs-comment"># Verify that the compilers are available:</span><br>$ spack compiler list or spack location -i intel-oneapi-compilers@2021.4.0<br></code></pre></td></tr></table></figure></p><p>Check,</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">which</span> mpiicc &amp;&amp; mpiicc --version<br><span class="hljs-built_in">which</span> mpiifort &amp;&amp; mpiifort --version<br><span class="hljs-built_in">which</span> mpiicpc &amp;&amp; mpiicpc --version<br><span class="hljs-built_in">which</span> icc &amp;&amp; icc --version<br><span class="hljs-built_in">which</span> ifort &amp;&amp; ifort --version<br></code></pre></td></tr></table></figure><p>one more step, install curl</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ spack info --all curl<br>$ spack install --add curl%intel<br></code></pre></td></tr></table></figure><h1 id="remark">Remark</h1><h2 id="spack-info---all-intel-oneapi-mpi">spack info --all intel-oneapi-mpi</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ spack info --all intel-oneapi-mpi<br><br>Package:   intel-oneapi-mpi<br><br>Description:<br>    Intel MPI Library is a multifabric message-passing library that<br>    implements the open-source MPICH specification. Use the library to<br>    create, maintain, and <span class="hljs-built_in">test</span> advanced, complex applications that perform<br>    better on high-performance computing (HPC) clusters based on Intel<br>    processors. LICENSE INFORMATION: By downloading and using this software,<br>    you agree to the terms and conditions of the software license agreements<br>    at https://intel.ly/393CijO.<br><br>Homepage: https://software.intel.com/content/www/us/en/develop/tools/oneapi/components/mpi-library.html<br><br>Maintainers: @rscohn2<br><br>Externally Detectable: <br>    False<br><br>Tags: <br>    None<br><br>Preferred version:  <br>    2021.13.1    https://registrationcenter-download.intel.com/akdlm/IRC_NAS/364c798c-4cad-4c01-82b5-e1edd1b476af/l_mpi_oneapi_p_2021.13.1.769_offline.sh<br><br>Safe versions:  <br>    2021.13.1    https://registrationcenter-download.intel.com/akdlm/IRC_NAS/364c798c-4cad-4c01-82b5-e1edd1b476af/l_mpi_oneapi_p_2021.13.1.769_offline.sh<br>    2021.13.0    https://registrationcenter-download.intel.com/akdlm/IRC_NAS/9f84e1e8-11b2-4bd1-8512-3e3343585956/l_mpi_oneapi_p_2021.13.0.719_offline.sh<br>    2021.12.1    https://registrationcenter-download.intel.com/akdlm/IRC_NAS/56b2dd0e-954d-4330-b0a7-b22992f7e6b7/l_mpi_oneapi_p_2021.12.1.8_offline.sh<br>    2021.12.0    https://registrationcenter-download.intel.com/akdlm/IRC_NAS/749f02a5-acb8-4bbb-91db-501ff80d3f56/l_mpi_oneapi_p_2021.12.0.538_offline.sh<br>    2021.11.0    https://registrationcenter-download.intel.com/akdlm//IRC_NAS/2c45ede0-623c-4c8e-9e09-bed27d70fa33/l_mpi_oneapi_p_2021.11.0.49513_offline.sh<br>    2021.10.0    https://registrationcenter-download.intel.com/akdlm/IRC_NAS/4f5871da-0533-4f62-b563-905edfb2e9b7/l_mpi_oneapi_p_2021.10.0.49374_offline.sh<br>    2021.9.0     https://registrationcenter-download.intel.com/akdlm/IRC_NAS/718d6f8f-2546-4b36-b97b-bc58d5482ebf/l_mpi_oneapi_p_2021.9.0.43482_offline.sh<br>    2021.8.0     https://registrationcenter-download.intel.com/akdlm/IRC_NAS/19131/l_mpi_oneapi_p_2021.8.0.25329_offline.sh<br>    2021.7.1     https://registrationcenter-download.intel.com/akdlm/IRC_NAS/19010/l_mpi_oneapi_p_2021.7.1.16815_offline.sh<br>    2021.7.0     https://registrationcenter-download.intel.com/akdlm/IRC_NAS/18926/l_mpi_oneapi_p_2021.7.0.8711_offline.sh<br>    2021.6.0     https://registrationcenter-download.intel.com/akdlm/IRC_NAS/18714/l_mpi_oneapi_p_2021.6.0.602_offline.sh<br>    2021.5.1     https://registrationcenter-download.intel.com/akdlm/IRC_NAS/18471/l_mpi_oneapi_p_2021.5.1.515_offline.sh<br>    2021.5.0     https://registrationcenter-download.intel.com/akdlm/IRC_NAS/18370/l_mpi_oneapi_p_2021.5.0.495_offline.sh<br>    2021.4.0     https://registrationcenter-download.intel.com/akdlm/IRC_NAS/18186/l_mpi_oneapi_p_2021.4.0.441_offline.sh<br>    2021.3.0     https://registrationcenter-download.intel.com/akdlm/IRC_NAS/17947/l_mpi_oneapi_p_2021.3.0.294_offline.sh<br>    2021.2.0     https://registrationcenter-download.intel.com/akdlm/IRC_NAS/17729/l_mpi_oneapi_p_2021.2.0.215_offline.sh<br>    2021.1.1     https://registrationcenter-download.intel.com/akdlm/IRC_NAS/17397/l_mpi_oneapi_p_2021.1.1.76_offline.sh<br><br>Deprecated versions:  <br>    None<br><br>Variants:<br>    build_system [generic]            generic<br>        Build systems supported by the package<br>    classic-names [<span class="hljs-literal">false</span>]             <span class="hljs-literal">false</span>, <span class="hljs-literal">true</span><br>        Use classic compiler names, e.g mpiicc instead of mpiicx<br>    envmods [<span class="hljs-literal">true</span>]                    <span class="hljs-literal">false</span>, <span class="hljs-literal">true</span><br>        Toggles environment modifications<br>    external-libfabric [<span class="hljs-literal">false</span>]        <span class="hljs-literal">false</span>, <span class="hljs-literal">true</span><br>        Enable external libfabric dependency<br>    generic-names [<span class="hljs-literal">false</span>]             <span class="hljs-literal">false</span>, <span class="hljs-literal">true</span><br>        Use generic names, e.g mpicc instead of mpiicx<br>    ilp64 [<span class="hljs-literal">false</span>]                     <span class="hljs-literal">false</span>, <span class="hljs-literal">true</span><br>        Build with ILP64 support<br><br>Installation Phases:<br>    install<br><br>Build Dependencies:<br>    None<br><br>Link Dependencies:<br>    libfabric<br><br>Run Dependencies:<br>    libfabric<br><br>Virtual Packages: <br>    intel-oneapi-mpi provides mpi@:3.1<br><br>Available Build Phase Test Methods:<br>    None<br><br>Available Install Phase Test Methods:<br>    None<br><br>Stand-Alone/Smoke Test Methods:<br>    Mpi.test_mpi_hello<br><br>Licenses: <br>    https://intel.ly/393CijO<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Spack</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Spack</tag>
      
      <tag>Intel</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Intel Instruction Set Extensions Technology æŒ‡ä»¤é›†æ“´å……æŠ€è¡“</title>
    <link href="/2024/08/07/Intel_Instruction_Set_Extensions_Technology/"/>
    <url>/2024/08/07/Intel_Instruction_Set_Extensions_Technology/</url>
    
    <content type="html"><![CDATA[<h1 id="intel-instruction-set-extensions-technology">Intel Instruction Set Extensions Technology</h1><p><a href="https://www.intel.com.tw/content/www/tw/zh/support/articles/000005779/processors.html">IntelÂ® Instruction Set Extensions (æŒ‡ä»¤é›†æ“´å……æŠ€è¡“)</a> are additional instructions that <strong>can increase performance</strong> when the same operations are performed on multiple data objects.</p><p>Instruction Set Extensions are additional instructions which can increase performance when the same operations are performed on multiple data objects. These can include <strong>SSE (Streaming SIMD Extensions) and AVX (Advanced Vector Extensions).</strong></p><p>Detailed instructions are listed in IntelÂ® Architecture Instruction Set Extensions Programming Reference.</p><p>Instruction Set Extensions can include: - Single Instruction Multiple Data (SIMD) - IntelÂ® Streaming SIMD Extensions (IntelÂ® SSE,IntelÂ® SSE2,IntelÂ® SSE3, and IntelÂ® SSE4) - IntelÂ® Advanced Vector Extensions (IntelÂ® AVX, IntelÂ® AVX2, and IntelÂ® AVX-512)</p><h2 id="identify-my-intel-processor">Identify My Intel Processor</h2><p>Linux Type the following command: <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ lscpu | grep <span class="hljs-string">&quot;Model name&quot;</span><br>Model name:                           Intel(R) Core(TM) i5-3470S CPU @ 2.90GHz<br></code></pre></td></tr></table></figure></p><h2 id="product-specifications">Product Specifications</h2><ul><li>Go to https://ark.intel.com/content/www/us/en/ark.html#<span class="citation" data-cites="Processors">@Processors</span></li><li>enter your CPU name<ul><li>like https://ark.intel.com/content/www/us/en/ark/products/68315/intel-core-i5-3470s-processor-6m-cache-up-to-3-60-ghz.html</li><li>It has shown <strong>Instruction Set Extensions = IntelÂ® SSE4.1, IntelÂ® SSE4.2, IntelÂ® AVX</strong></li></ul></li></ul><h2 id="streaming-simd-extensions-sse">Streaming SIMD Extensions (SSE)</h2><p>SSE is a process or technology that enables single instruction multiple data. Older processors only process a single data element per instruction. SSE enables the instruction to handle multiple data elements. It's used in intensive applications, such as 3D graphics, for faster processing. SSE is designed to replace MMXâ„¢ Technology. It expanded over the generations of IntelÂ® Processors to include SSE2, SSE3/SSE3S, and SSE4. Each iteration has brought new instructions and increased performance.</p><h2 id="intel-advanced-vector-extensions-intel-avx-and-avx2">Intel Advanced Vector Extensions (IntelÂ® AVX and AVX2)</h2><p><strong>IntelÂ® AVX is a 256-bit instruction set extension to IntelÂ® SSE</strong> designed for applications that are Floating Point (FP) intensive. Intel AVX improves performance due to wider vectors, new extensible syntax, and rich functionality. <strong><em>Intel AVX2 was released in 2013</em></strong>, extending vector processing capability across floating-point and integer data domains. This results in higher performance and more efficient data management across a wide range of applications. Examples are image and audio/video processing, scientific simulations, financial analytics, and 3D modeling and analysis.</p><h2 id="intel-advanced-vector-extensions-512-intel-avx-512">IntelÂ® Advanced Vector Extensions 512 (IntelÂ® AVX-512)</h2><p>The IntelÂ® AVX-512 enables processing of twice the number of data elements that Intel AVX/AVX2 can process with a single instruction and four times the capabilities of Intel SSE. Intel AVX-512 instructions are important because they open up higher performance capabilities for the most demanding computational tasks. Intel AVX-512 instructions offer the highest degree of compiler support in the design of the instruction capabilities.</p><h2 id="spec-flag-description-for-the-gnu-ccfortran-compiler">SPEC Flag Description for the GNU C/C++/Fortran Compiler</h2><p>Go to https://www.spec.org/omp2012/flags/gcc-linux64.html</p><p>Optimization Flags - -Ofast - -fopenmp - -fopenmp-simd - -m64 - -mavx512f - -mavx512cd - -mavx512er - -mavx512pf - -march=ivybridge - -march=native</p>]]></content>
    
    
    <categories>
      
      <category>Intel</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Intel</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>JupyterLab</title>
    <link href="/2024/07/31/JupyterLab/"/>
    <url>/2024/07/31/JupyterLab/</url>
    
    <content type="html"><![CDATA[<h1 id="jupyterlab">JupyterLab</h1><p>JupyterLab is the latest web-based interactive development environment for notebooks, code, and data. Its flexible interface allows users to configure and arrange workflows in data science, scientific computing, computational journalism, and machine learning. A modular design invites extensions to expand and enrich functionality.</p><h2 id="install">Install</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh">micromamba activate venv <br>micromamba install python=3.11<br>micromamba install -c conda-forge jupyterlab<br>micromamba install anaconda::ipykernel<br>micromamba install nodejs<br>micromamba install -c conda-forge jupyter-resource-usage<br>micromamba install -c conda-forge jupyterlab_execute_time<br></code></pre></td></tr></table></figure><h2 id="execute">Execute</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ jupyter-lab<br></code></pre></td></tr></table></figure><h2 id="added-other-kernels-to-jupyter">Added other kernels to Jupyter</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs sh"><br>micromamba activate new-env-1<br><br><span class="hljs-comment"># install python kernel for Jupyter</span><br><span class="hljs-comment"># avoid installation of any jupyter related modules</span><br>micromamba install anaconda::ipykernel<br><br><span class="hljs-comment"># added the kernel to Jupyter and name it as &quot;Environment(myproject)&quot;</span><br>python -m ipykernel install --user --name=mnew-env-1 --display-name=<span class="hljs-string">&#x27;Environment(new-env-1)&#x27;</span><br><br>micromamba deactivate<br><br>micromamba acitvate new-env-2<br><br><span class="hljs-comment"># install python kernel for Jupyter</span><br><span class="hljs-comment"># avoid installation of any jupyter related modules</span><br>micromamba install anaconda::ipykernel<br><br><span class="hljs-comment"># added the kernel to Jupyter and name it as &quot;Environment(myproject)&quot;</span><br>python -m ipykernel install --user --name=mnew-env-2 --display-name=<span class="hljs-string">&#x27;Environment(new-env-2)&#x27;</span><br></code></pre></td></tr></table></figure><h2 id="monitor-resource-usage-with-gpu-dashboard-in-jupyter">Monitor resource usage with GPU Dashboard in Jupyter</h2><p>A GPU dashboard is available for JupyterLab for showing the resource usage of GPU in real time, side by side with cells in your notebook. It is particularly useful in identifying any bottleneck or issues during code development.</p><p>You may activate your conda or python virtual environment for your kernel and run the following once to install the GPU dashboard.</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">pip install jupyterlab-nvdashboard<br></code></pre></td></tr></table></figure><h1 id="references">References</h1><ul><li><a href="https://hpc.hku.hk/hpc/software/jupyterlab/">HKU HPC</a></li><li><a href="https://github.com/jupyter-server/jupyter-resource-usage">jupyter-resource-usage</a></li><li><a href="https://jupyterlab-contrib.github.io/extensions.html">List of extensions and tools</a></li><li><a href="https://github.com/altair-viz/jupyterlab_voyager">Voyager is a JupyterLab MIME renderer extension to view CSV and JSON data in Voyager 2</a></li><li><a href="https://github.com/jupyterlab/debugger">jupyterlab/debugger</a></li><li><a href="https://jupyterlab.readthedocs.io/en/stable/user/extensions.html#id9">JupyterLab extension</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>Jupyter</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Jupyter</tag>
      
      <tag>python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ssh tunnel</title>
    <link href="/2024/07/04/ssh_tunnel/"/>
    <url>/2024/07/04/ssh_tunnel/</url>
    
    <content type="html"><![CDATA[<h1 id="introduction-to-ssh-tunnels">Introduction to SSH Tunnels</h1><p>Secure Shell, or SSH, is used to create a secure channel between a local and remote computer. While SSH is commonly used for secure terminal access and file transfers, it can also be used to create a secure tunnel between computers for forwarding other network connections that are not normally encrypted. SSH tunnels are also useful for allowing outside access to internal network resources.</p><p>An <strong>SSH tunneling (SSH Port Forwarding)</strong> establishes a connection between your local machine and the remote machine via a TCP port. When you configure your local application to use an SSH tunnel you tell it to connect to your local machine at a specified port, rather than the remote machine. The tunnel then carries your traffic securely to the remote machine.</p><p>SSH Port Forwardingï¼š - Local Port Forwarding - Remote Port Forwarding - Dynamic Port Forwarding</p><p>For both local and remote port forwarding, there are three roles:</p><ul><li>Client<ul><li>Any machine from which you can type ssh to start Port Forwarding</li></ul></li><li>SSH server<ul><li>Clients can use SSH connections for machine learning</li></ul></li><li>target server<ul><li>Some machines you want to establish a connection to, usually to open services on this machine to the outside world</li></ul></li></ul><p><strong>Note that</strong> both the client and the SSH server can themselves be the target server. It does not mean that only three machines can be used for port forwarding!</p><h2 id="local-port-forwarding">Local Port Forwarding</h2><p>Local forwarding is used to forward a port from the client machine to the server machine.</p><p>Quite a few organizations for all incoming SSH access through a single <strong>jump server</strong>. The server may be a standard Linux/Unix box, usually with some extra hardening, intrusion detection, and/or logging, or it may be a commercial jump server solution.</p><p>To create a local port forward add the <strong>-L</strong> parameter to the ssh command line.</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ ssh -L 9090:localhost:8080 user@server-ip<br></code></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ ssh -L 9090:192.168.1.101:8080 user@server-ip<br></code></pre></td></tr></table></figure><p>The 192.168.1.101 here is relative to user@server-ip, so it is the IP address of the server behind the firewall or VPN. Then, you can visit 192.168.1.101:9090</p><h2 id="remote-port-forwarding">Remote Port Forwarding</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">ssh -R 9090:localhost:8080 user@server-ip<br></code></pre></td></tr></table></figure><h1 id="references">References</h1><p><a href="https://www.ssh.com/academy/iam/jump-server">What is a Jump Server?</a><br /><a href="https://johnliu55.tw/ssh-tunnel.html">SSH Tunneling (Port Forwarding) è©³è§£</a></p>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ssh</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ML | Physics-informed neural networks (PINN)</title>
    <link href="/2024/06/26/PINN/"/>
    <url>/2024/06/26/PINN/</url>
    
    <content type="html"><![CDATA[<h1 id="pinn">PINN</h1><p>Physics-informed neural networks (PINNs) represent a significant advancement in the integration of machine learning with physical laws, particularly in the context of solving differential equations. They combine traditional neural network approaches with the constraints provided by known physics, enabling more accurate modeling and predictions in various scientific fields.</p><figure><img src="https://www.researchgate.net/profile/Zhen-Li-105/publication/335990167/figure/fig1/AS:806502679982080@1569296631121/Schematic-of-a-physics-informed-neural-network-PINN-where-the-loss-function-of-PINN_W640.jpg" alt="PINN (source: http://dx.doi.org/10.48550/arXiv.1909.10145)" width="400" /><figcaption>PINN (source: http://dx.doi.org/10.48550/arXiv.1909.10145)</figcaption></figure><h1 id="universal-approximation-theorem">Universal Approximation Theorem</h1><p><strong>Definition</strong></p><p>The theorem states that for <strong>any continuous function</strong> $ f: ^n  $ defined on a compact subset of $ ^n $, there exists a neural network $ g $ such that the difference between $ f $ and $ g $ can be made arbitrarily small. Formally, for any $ &gt; 0 $, there exists a neural network with a finite number of neurons such that:</p><p><span class="math display">\[| f(x) - g(x) | &lt; \epsilon\]</span></p><p>for all $ x $ in the domain of interest.</p><p><strong>Historical Background</strong></p><p>The theorem was independently proven by George Cybenko in 1989, who focused on networks using sigmoid activation functions, and later by Kurt Hornik in 1991, who generalized it to include other activation functions like ReLU (Rectified Linear Unit).</p><p><strong>Implications</strong></p><p>It has profound implications for the design and understanding of neural networks:</p><ul><li><strong>Expressive Power</strong>: It guarantees that neural networks can model complex relationships in data, making them suitable for tasks like image classification, function approximation, and more.</li><li><strong>Architecture Design</strong>: The theorem informs users about the necessary architecture (e.g., number of layers and neurons) required to achieve desired approximations.</li></ul><p><strong>Limitations</strong></p><p>While the UAT provides a theoretical foundation, it does not address practical aspects such as:</p><ul><li><strong>Generalization</strong>: The ability of a network to perform well on unseen data is not guaranteed by the theorem alone. Techniques like regularization and cross-validation are necessary to improve generalization.</li><li><strong>Computational Feasibility</strong>: The theorem does not specify how to construct the network or find the optimal parameters effectively. In practice, training methods like backpropagation are used, but they may not always reach the global optimum.</li></ul><p><strong>Reading</strong></p><ul><li><a href="https://www.deep-mind.org/2023/03/26/the-universal-approximation-theorem/">The Universal Approximation Theorem</a></li><li><a href="https://mitliagkas.github.io/ift6085-2020/ift-6085-lecture-10-notes.pdf">Expressivity and Universal Approximation Theorems Part 1</a></li></ul><h2 id="for-function-alone">For function alone,</h2><ul><li><a href="https://citeseerx.ist.psu.edu/document?repid=rep1&amp;type=pdf&amp;doi=42b931a30e5b8e7de7fca061d4f445ca252ac23a">Chen, T., &amp; Chen, H. (1993). Approximations of continuous functionals by neural networks with application to dynamic systems. IEEE Transactions on Neural networks, 4(6), 910-918.</a></li></ul><p>Theorem 2: Suppose that <span class="math inline">\(U\)</span> is a compact set in <span class="math inline">\(C[a,b]\)</span>, <span class="math inline">\(f\)</span> is a continuous functional defined on <span class="math inline">\(U\)</span>, and <span class="math inline">\(\sigma (x)\)</span> is a bounded generalized sigmoidal function, then for any <span class="math inline">\(\epsilon &gt; 0\)</span>, there exist <span class="math inline">\(m+1\)</span> points $ a = x_0 &lt;...&lt; x_m = b$, a positive integer <span class="math inline">\(N\)</span> and constants <span class="math inline">\(c_{ij}, \theta_{ij}, \xi_{ij}\)</span>, <span class="math inline">\(i=1,...,N\)</span>, <span class="math inline">\(j=0,1,...,m\)</span>, such that</p><p><span class="math display">\[\begin{align*} | f(u) - \sum_{i=1}^N c_i g ( \sum_{j=0}^m \xi_{ij} u(x_{j}) + \theta_i) | &amp;&lt; \epsilon, \qquad \forall u \in U \\| f(u) - \sum_{i=1}^N c_i g (\mathbf{\omega_j} \cdot \mathbf{x} + \theta_i) | &amp;&lt; \epsilon, \qquad \forall u \in U\end{align*} \]</span></p><h1 id="definition-and-functionality">Definition and Functionality</h1><p>PINNs are a type of <strong>universal function approximator</strong> that incorporates physical laws directly into the training process of neural networks. This is achieved by embedding governing equations, typically expressed as partial differential equations (PDEs), into the loss function of the network. By doing so, PINNs ensure that the solutions generated are consistent with these physical laws, which enhances the robustness and accuracy of the model even when data availability is limited</p><p><strong>Training Mechanism</strong></p><p>The training of a PINN involves two main components:</p><ol type="1"><li><strong>Data Loss</strong>: The standard supervised learning approach minimizes the mean squared error (MSE) between <strong>predicted outputs and actual data</strong>.</li><li><strong>Physics Loss</strong>: An additional term is introduced to the loss function that quantifies <strong>how well the predicted outputs satisfy the governing physical equations</strong>. This is done by computing gradients (<strong>using automatic differentiation</strong>) at sampled points in space and time, allowing for the evaluation of residuals from the PDEs.</li></ol><p>This dual approach allows PINNs to <strong>leverage both empirical data and theoretical knowledge</strong>, making them particularly effective for problems where data is scarce or noisy.</p><h2 id="challenges-and-future-directions">Challenges and Future Directions</h2><p>Despite their advantages, PINNs also face challenges:</p><ul><li><strong>Computational Cost</strong>: Training PINNs can be computationally intensive, especially when dealing with <strong>complex geometries</strong> or <strong>high-dimensional problems</strong>.</li><li><strong>Generalization Limitations</strong>: Regular PINNs typically require <strong>retraining for different geometries or boundary conditions</strong>, which can limit their efficiency in practical applications.</li></ul><h1 id="pinn-1">PINN</h1><h2 id="key-points-on-using-collocation-points-in-pinns">Key Points on Using Collocation Points in PINNs</h2><figure><img src="https://www.researchgate.net/publication/354493654/figure/fig2/AS:1066347421261825@1631248445040/Distributions-of-collocation-points-t-f-x-f-for-the-evaluation-of-governing.png" alt="Distributions of collocation points (t f , x f ) for the evaluation of governing equations (a) logarithmically sampled time points, and (b) uniformly sampled time points. The data sets (t o , x o ) and (t b , x b ) are also plotted." width="550" /><figcaption>Distributions of collocation points (t f , x f ) for the evaluation of governing equations (a) logarithmically sampled time points, and (b) uniformly sampled time points. The data sets (t o , x o ) and (t b , x b ) are also plotted.</figcaption></figure><p>It is possible to use collocation points only in Physics-Informed Neural Networks (PINNs). Collocation points are specific locations in the domain where the residuals of the governing equations are evaluated, and they play a crucial role in training PINNs.</p><div class="note note-primary">            <p>Neural networks can indeed be utilized to approximate functions with undetermined parameters, and <strong>one of their key advantages is the ability to compute various operators, including derivatives and partial derivatives, directly on these networks</strong>. This capability is particularly beneficial in applications like Physics-Informed Neural Networks (PINNs), where the derivatives of the network output with respect to inputs are essential for enforcing physical laws.</p><p>ç¥ç¶“ç¶²è·¯ç¢ºå¯¦å¯ä»¥ç”¨ä¾†è¿‘ä¼¼å…·æœ‰æœªç¢ºå®šåƒæ•¸çš„å‡½æ•¸ï¼Œå…¶ä¸»è¦å„ªé»ä¹‹ä¸€æ˜¯èƒ½å¤ <strong>ç›´æ¥åœ¨é€™äº›ç¥ç¶“ç¶²è·¯ä¸Šè¨ˆç®—å„ç¨®é‹ç®—ç¬¦ï¼ŒåŒ…æ‹¬å°æ•¸å’Œåå°æ•¸</strong>ã€‚æ­¤åŠŸèƒ½åœ¨ç‰©ç†è³‡è¨Šç¥ç¶“ç¶²è·¯ (PINN) ç­‰æ‡‰ç”¨ä¸­ç‰¹åˆ¥æœ‰ç”¨ã€‚</p>          </div><p><strong>1. Definition and Role</strong></p><p>Collocation points serve as the training dataset for PINNs, where the network learns to <strong>minimize the residuals of the partial differential equations (PDEs) at these discrete points</strong>. The objective is to ensure that the neural network's output satisfies the physical laws represented by these equations at the selected collocation points.</p><p><strong>2. Training with Collocation Points</strong></p><p>The training process involves minimizing a loss function that combines:</p><ul><li><strong>Data Loss</strong>: Measures how well the model fits any <strong>available observational data</strong>.</li><li><strong>Physics Loss</strong>: Enforces that the residuals of the PDEs at the <strong>collocation points</strong> are minimized.</li></ul><p>Using only collocation points can be effective, especially when there is limited observational data. However, it is essential to select these points wisely, as their distribution can significantly affect the accuracy and convergence of the solution. <strong>Strategies such as adaptive selection of collocation points</strong> based on residual analysis or problem-specific features can enhance performance.</p><p><strong>3. Limitations and Considerations</strong></p><p>While using collocation points alone is feasible, there are considerations:</p><ul><li><strong>Distribution of Points</strong>: A uniform distribution may not capture complex behaviors in certain regions of the domain effectively. <strong>Adaptive methods that focus on areas with higher residuals or complexity</strong> can improve training efficiency and solution accuracy.</li><li><strong>Generalization</strong>: Relying solely on collocation points may limit the model's ability to generalize across different scenarios or boundary conditions unless carefully managed.</li></ul><p>In summary, using only collocation points in PINNs is a valid approach, but careful consideration of their selection and distribution is crucial for achieving accurate and reliable results.</p><h2 id="strategies-for-selecting-collocation-points">Strategies for Selecting Collocation Points</h2><p><strong>1. Uniform Sampling</strong></p><ul><li><strong>Description</strong>: Initially, many PINNs utilize a uniform sampling strategy, distributing collocation points evenly across the domain.</li><li><strong>Limitations</strong>: This method may lead to inefficiencies, especially in complex problems where certain regions require more focus due to higher gradients or residuals.</li></ul><p><strong>2. Adaptive Sampling Techniques</strong></p><ul><li><strong>Dynamic Adjustment</strong>: Adaptive strategies adjust the locations of collocation points during training based on the residuals of the PDEs. This allows the network to concentrate on areas where the solution is more complex or where errors are larger.</li><li><strong>Examples</strong>:<ul><li><strong>PINNACLE Method</strong>: This method dynamically selects collocation and experimental points by analyzing training dynamics and adjusting point locations based on performance metrics. It improves accuracy and convergence speed by focusing on regions with significant residuals.</li><li><strong>Residual-Based Sampling</strong>: Points are selected based on the distribution of residuals, with higher densities in areas exhibiting larger errors. This method can involve <strong>resampling after a set number of iterations to avoid local minima</strong>.</li></ul></li></ul><p><strong>3. Weighting Collocation Points</strong></p><ul><li><strong>Variable Influence</strong>: Assign different weights to collocation points based on their importance, allowing the model to focus more on points with higher loss values. This approach helps prioritize learning in critical areas of the solution space.</li></ul><p><strong>4. Probability Density Functions (PDFs)</strong></p><ul><li><strong>Guided Distribution</strong>: Use information from residuals to create a probability density function that guides the distribution of collocation points. This can lead to a non-uniform distribution that better captures the essential features of the solution.</li></ul><p><strong>5. Hybrid Approaches</strong></p><ul><li>Combining fixed and adaptive methods can also be beneficial. For instance, starting with uniformly distributed points and then adapting their locations based on observed performance can provide a balanced approach.</li></ul><p>In conclusion, <strong>selecting collocation points in PINNs is an iterative process</strong> that can significantly impact the model's efficiency and accuracy. Adaptive methods that focus on error distribution and dynamic adjustments during training are particularly effective, as demonstrated by recent advancements like the PINNACLE method. These strategies allow for better representation of complex physical phenomena while optimizing computational resources.</p><h1 id="video">Video</h1><ul><li>Steve Brunton</li></ul><iframe width="560" height="315" src="https://www.youtube.com/embed/-zrY7P2dVC4?si=u64XUih1hSEUEv6o" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe><h1 id="physics">Physics</h1><ol type="1"><li>Baty, H. (2024). A hands-on introduction to Physics-Informed Neural Networks for solving partial differential equations with benchmark tests taken from astrophysics and plasma physics. arXiv preprint arXiv:2403.00599.<ol type="1"><li>(Left panel) Distribution of data sets showing the space localization of training data <strong>points at the four boundaries</strong> (i.e. <span class="math inline">\(N_{data} = 120\)</span>) and <strong>collocation points</strong> (i.e. <span class="math inline">\(N_c = 400\)</span>) inside the domain, for solving Laplace problem using vanilla-PINNs. (Right panel) Evolution of the two partial losses <span class="math inline">\(L_{data}\)</span> and $L_{PDE} $ as functions of the number of iterations (i.e. epochs).</li></ol></li></ol><div class="group-image-container"><div class="group-image-row"><div class="group-image-wrap"><img src="https://arxiv.org/html/2403.00599v1/extracted/5443010/figur6.png" /></div><div class="group-image-wrap"><img src="https://arxiv.org/html/2403.00599v1/extracted/5443010/figur6b.png" /></div></div><div class="group-image-row"><div class="group-image-wrap"><img src="https://arxiv.org/html/2403.00599v1/extracted/5443010/figur7.png" /></div></div><div class="group-image-row"><div class="group-image-wrap"><img src="https://arxiv.org/html/2403.00599v1/extracted/5443010/figur9a.png" /></div><div class="group-image-wrap"><img src="https://arxiv.org/html/2403.00599v1/extracted/5443010/figur9b.png" /></div></div><div class="group-image-row"><div class="group-image-wrap"><img src="https://arxiv.org/html/2403.00599v1/extracted/5443010/figur10.png" /></div></div></div><ol start="2" type="1"><li>Schiassi, Enrico, et al. "Physics-Informed Neural Networks for Optimal Planar Orbit Transfers." Journal of Spacecraft and Rockets (2022): 1-16.</li><li>Barreau, Matthieu, et al. "Physics-informed learning for identification and state reconstruction of traffic density." arXiv preprint arXiv:2103.13852 (2021).</li></ol><h1 id="blog">Blog</h1><ul><li><a href="https://zhuanlan.zhihu.com/p/662739405?utm_psn=1832573966142803968">æµ…è°ˆä¸€ä¸‹PINN(ç‰©ç†å¯å‘ç¥ç»ç½‘ç»œï¼‰è¥¿å—æœ›é•¿å®‰</a><ul><li>PINNçš„åŸºæœ¬åŸç†èµ·æºäº2017å¹´Prof.George Karniadarkis ç»„Marziar Raissiçš„å·¥ä½œ (2017å¹´å·²ç»æ”¾åœ¨äº†Arxivä¸Š)<ul><li>Physics Informed Deep Learning:Data-driven Solutions of Nonlinear Partial Differential Equations</li></ul></li><li>åˆ†åˆ«ç”¨äºè§£å†³åé—®é¢˜ï¼ˆinverse problemï¼‰å’Œæ­£é—®é¢˜ï¼ˆforward problemï¼‰<ul><li>æ­£é—®é¢˜å’Œåé—®é¢˜çš„æ­£ç»å®šä¹‰å¯ä»¥è§£é‡Šä¸ºï¼šæ­£é—®é¢˜ï¼Œå·²çŸ¥åŸå› ï¼Œæ ¹æ®å·²æœ‰çš„æ¨¡å‹å’Œè§„å¾‹ï¼Œå¾—åˆ°ç»“æœçŠ¶æ€æˆ–è€…è§‚æµ‹ï¼Œè€Œåé—®é¢˜åˆ™æ˜¯å·²çŸ¥ç»“æœçŠ¶æ€æˆ–è€…è§‚æµ‹ï¼Œæ¥åæ¨åŸå› ã€‚</li><li>åé—®é¢˜æˆ‘ä»¬å®šä¹‰ä¸ºï¼Œå·²çŸ¥ä¸€äº›åœºåŸŸå†…çš„è§‚æµ‹æƒ…å†µï¼Œæ¥åæ¨æœ€ä¼˜çš„PDEæ–¹ç¨‹çš„ç³»æ•°/å‚æ•°çš„å€¼ï¼ˆè¿™ä¸ªå®šä¹‰æ˜¯éå¸¸ç‹­éš˜çš„å’Œæœ€åŸºæœ¬çš„ï¼Œåé¢æˆ‘ä»¬å†å»¶ç”³ï¼‰ï¼Œä»æŸç§è§’åº¦æ¥å¼€ï¼Œæ­£é—®é¢˜å’Œåé—®é¢˜æ˜¯ä¸€å¥—ç³»ç»Ÿçš„å…±ç”Ÿé—®é¢˜</li></ul></li><li>ç¥ç»ç½‘ç»œçš„å¯å¾®æ€§å¸¦æ¥äº†æ¢¯åº¦æ±‚è§£çš„å¯è¡Œæ€§ï¼Œè€Œç°æœ‰çš„pytorchç­‰æ¡†æ¶çš„autogradå¸¦æ¥äº†å·¥ç¨‹ä¸Šå®ç°çš„ä¾¿åˆ©æ€§</li><li>æ­£æ˜¯ç”±äº<strong>PDEæ–¹ç¨‹å·²ç»åŒ…å«äº†æ‰€æœ‰ä¿¡æ¯(ä¸€ä¸ªä¸–ç•Œæ¨¡å‹)</strong>ï¼Œå› æ­¤ï¼Œæ±‚è§£æ­£é—®é¢˜æ—¶ï¼Œ<strong>PINNå®Œå…¨ä¸éœ€è¦æ•°æ®ï¼Œåªéœ€è¦éšæ„åœ¨ç©ºé—´å’Œæ—¶é—´æ­¥ä¸Šé‡‡æ ·ï¼Œç„¶åè®©PDEæ–¹ç¨‹æ¥è¯„ä¼°ç¥ç»ç½‘ç»œçš„å»ºæ¨¡æ˜¯å¦å‡†ç¡®</strong></li></ul></li><li><a href="https://zhuanlan.zhihu.com/p/468748367?utm_psn=1832689886811004928">â€‹å†…åµŒç‰©ç†çŸ¥è¯†ç¥ç»ç½‘ç»œï¼ˆPINNï¼‰æ˜¯ä¸ªå‘å—ï¼Ÿ zwqwo</a><ul><li>PINNçš„åŸç†å°±æ˜¯é€šè¿‡è®­ç»ƒç¥ç»ç½‘ç»œæ¥æœ€å°åŒ–æŸå¤±å‡½æ•°æ¥è¿‘ä¼¼PDEçš„æ±‚è§£ï¼Œæ‰€è°“çš„æŸå¤±å‡½æ•°é¡¹åŒ…æ‹¬åˆå§‹å’Œè¾¹ç•Œæ¡ä»¶çš„æ®‹å·®é¡¹ï¼Œä»¥åŠ<strong>åŒºåŸŸä¸­é€‰å®šç‚¹ï¼ˆæŒ‰ä¼ ç»Ÿåº”è¯¥ç§°ä¸º"é…ç‚¹"ï¼‰å¤„çš„åå¾®åˆ†æ–¹ç¨‹æ®‹å·®</strong>ã€‚è®­ç»ƒå®Œæˆåè¿›è¡Œæ¨æ–­ï¼ˆInferenceï¼‰å°±å¯ä»¥å¾—åˆ°æ—¶ç©ºç‚¹ä¸Šçš„å€¼äº†ã€‚</li><li>ç‰¹åˆ«æ˜¯ç”¨äºè§£å†³ä¸åå¾®åˆ†æ–¹ç¨‹ ï¼ˆPDEï¼‰ ç›¸å…³çš„å„ç§é—®é¢˜ï¼ŒåŒ…æ‹¬æ–¹ç¨‹æ±‚è§£ã€å‚æ•°åæ¼”ã€æ¨¡å‹å‘ç°ã€æ§åˆ¶ä¸ä¼˜åŒ–ç­‰ã€‚</li><li>ç›¸æ¯”ä¼ ç»Ÿå¾®åˆ†æ–¹ç¨‹æ•°å€¼æ±‚è§£çš„æè¿°ï¼Œè¿™é‡Œå¤šå‡ºäº†è¡Œå¼å­ï¼Œä¹Ÿå°±æ˜¯å¯¹äºæ•°æ®çš„ä½¿ç”¨ï¼Œè¿™ä¹Ÿæ˜¯PINNçš„ç‰¹ç‚¹ä¹‹ä¸€ã€‚å½“ç„¶ï¼Œè¿™ä¸‰ä¸ªæ¡ä»¶ä¹Ÿä¸ä¸€å®šå…¨éƒ½å‡ºç°ï¼Œæ¯”å¦‚<strong>è¾¹ç•Œæ¡ä»¶æ¶ˆå¤±ï¼Œä»ä¼ ç»Ÿæ•°å€¼æ–¹æ³•çš„è§’åº¦æ¥çœ‹ç”šè‡³ä¸èƒ½æ»¡è¶³å®šè§£æ¡ä»¶</strong>ã€‚</li><li>è‡ªåŠ¨å¾®åˆ†</li><li>ä½†PINNè¿™ç§ç¥ç»ç½‘ç»œä¸è¡Œï¼Œå³ä½¿å¯¹äºçº¿æ€§æ–¹ç¨‹ï¼Œä¹Ÿä¸å¾—ä¸ä½¿ç”¨<strong>éçº¿æ€§æ±‚è§£å™¨</strong>ï¼ˆè¿­ä»£ä¼˜åŒ–å™¨ï¼‰ï¼Œæ¯”å¦‚L-BFGSï¼Œæˆ–è€…ç¥ç»ç½‘ç»œè®­ç»ƒä¸­ç”¨å¾—æ›´å¤šçš„SGDã€Adamç­‰ã€‚éçº¿æ€§é—®é¢˜çš„æ±‚è§£é€šå¸¸æ¯”çº¿æ€§é—®é¢˜éš¾ï¼Œè¿™æ˜¯PINNè®¡ç®—æ•ˆç‡ä¸Šä¸€ä¸ªé¿ä¸å¼€çš„éšœç¢ã€‚</li><li>ä»è¿™ä¹ˆçœ‹æ¥ï¼ŒPINNç¡®å®ä¸æ˜¯å¤ªè¿‡äºæ–°å¥‡çš„ä¸œè¥¿ã€‚è‡³å°‘åœ¨<em>1994å¹´çš„æ–‡çŒ®ä¸­å·²ç»æœ‰ä½¿ç”¨MLPæ±‚è§£äºŒç»´Poissonæ–¹ç¨‹</em>çš„ä¾‹å­ï¼š<ul><li>Dissanayake, M. W. M. G., and Nhan Phanâ€Thien. "Neuralâ€networkâ€based approximations for solving partial differential equations." communications in Numerical Methods in Engineering 10.3 (1994): 195-201.</li></ul></li><li>å°ç»“ä¸€ä¸‹ä»¥ä¸Šå†…å®¹<ul><li>å¤§å®¶éƒ½çŸ¥é“PINNæ˜¯ä¸€ç§ï¼ˆæ·±åº¦ï¼‰ç½‘ç»œï¼Œåœ¨å®šä¹‰æ—¶ç©ºåŒºåŸŸä¸­ç»™å®šä¸€ä¸ªè¾“å…¥ç‚¹ï¼Œåœ¨è®­ç»ƒååœ¨å¾®åˆ†æ–¹ç¨‹çš„è¯¥ç‚¹ä¸­äº§ç”Ÿä¼°è®¡çš„è§£ã€‚</li><li>ç»“åˆå¯¹æ§åˆ¶æ–¹ç¨‹çš„åµŒå…¥å¾—åˆ°æ®‹å·®ï¼Œåˆ©ç”¨<strong>æ®‹å·®æ„é€ æŸå¤±é¡¹</strong>å°±æ˜¯PINNçš„ä¸€é¡¹ä¸å¤ªæ–°å¥‡çš„æ–°å¥‡ä¹‹å¤„äº†ã€‚æœ¬è´¨åŸç†å°±æ˜¯å°†æ–¹ç¨‹ï¼ˆä¹Ÿå°±æ˜¯æ‰€è°“çš„ç‰©ç†çŸ¥è¯†ï¼‰é›†æˆåˆ°ç½‘ç»œä¸­ï¼Œå¹¶ä½¿ç”¨æ¥è‡ªæ§åˆ¶æ–¹ç¨‹çš„æ®‹å·®é¡¹æ¥æ„é€ æŸå¤±å‡½æ•°ï¼Œç”±è¯¥é¡¹ä½œä¸ºæƒ©ç½šé¡¹æ¥é™åˆ¶å¯è¡Œè§£çš„ç©ºé—´ã€‚</li><li><strong>ç”¨PINNæ¥æ±‚è§£æ–¹ç¨‹å¹¶ä¸éœ€è¦æœ‰æ ‡ç­¾çš„æ•°æ®ï¼Œæ¯”å¦‚å…ˆå‰æ¨¡æ‹Ÿæˆ–å®éªŒçš„ç»“æœ</strong>ã€‚ä»è¿™ä¸ªè§’åº¦ï¼Œå¯¹PINN åœ¨æ·±åº¦å­¦ä¹ ä¸­çš„åœ°ä½è¿›è¡Œå®šä½çš„è¯ï¼Œå¤§æ¦‚æ˜¯å¤„äºæ— ç›‘ç£ã€è‡ªç›‘ç£ã€åŠç›‘ç£æˆ–è€…å¼±ç›‘ç£çš„åœ°ä½ï¼Œè¿™å‡ ä¸ªä¸å°½ç›¸åŒçš„è¯´æ³•åœ¨ä¸åŒè¯­å¢ƒä¸‹éƒ½æœ‰æ–‡çŒ®æè¿‡ã€‚</li><li><strong>PINNç®—æ³•æœ¬è´¨ä¸Šæ˜¯ä¸€ç§æ— ç½‘æ ¼æŠ€æœ¯ï¼Œé€šè¿‡å°†ç›´æ¥æ±‚è§£æ§åˆ¶æ–¹ç¨‹çš„é—®é¢˜è½¬æ¢ä¸ºæŸå¤±å‡½æ•°çš„ä¼˜åŒ–é—®é¢˜æ¥æ‰¾åˆ°åå¾®åˆ†æ–¹ç¨‹è§£</strong>ã€‚</li></ul></li><li>å¦‚æœæŠŠPINNå½“ä½œæ˜¯å•çº¯çš„æ•°å€¼æ±‚è§£å™¨ï¼Œé€šå¸¸æ¥è®²ï¼Œä¸ç®¡ä»é€Ÿåº¦æˆ–è€…ç²¾åº¦ï¼ŒPINNåœ¨æ€§èƒ½ä¸Šå¹¶ä¸èƒ½è·Ÿä¼ ç»Ÿæ–¹æ³•ï¼ˆæœ‰é™å·®åˆ†ã€æœ‰é™å…ƒã€æœ‰é™ä½“ç§¯ç­‰å¤§ç±»æ–¹æ³•ï¼‰æŠ—è¡¡ã€‚(not sure)</li><li>â€œå†…åµŒç‰©ç†â€ï¼ˆPhysics informedï¼‰å¯¹äºç§‘å­¦æœºå™¨å­¦ä¹ çš„å¿…è¦æ€§ã€‚å€¼å¾—ä¸€æçš„æ˜¯ï¼Œå†…åµŒç‰©ç†çŸ¥è¯†ç¥ç»ç½‘ç»œå¹¶ä¸æ˜¯ä¸€ç§ä½œä¸ºæ•°æ®é©±åŠ¨æ–¹æ³•å¯¹ç«‹é¢çš„ã€å•çº¯çš„â€œçŸ¥è¯†é©±åŠ¨â€æ–¹æ³•ï¼Œè€Œæ˜¯ä½œä¸ºæ•°æ®æ–¹æ³•ä¸ä¼ ç»ŸçŸ¥è¯†é©±åŠ¨æ–¹ç¨‹çš„æ¡¥æ¢å­˜åœ¨ï¼Œä¹Ÿå°±æ˜¯â€œçŸ¥è¯†â€å’Œâ€œæ•°æ®â€å…±åŒé©±åŠ¨çš„æ–¹æ³•</li><li>è¿™èŠ‚å¯¹ä¸€ä¸ªä¸æ˜¯å¤ªç®€å•çš„æ–¹ç¨‹è¿›è¡Œäº†æ•°å€¼æ±‚è§£ï¼Œ<strong>ä½†è§£æ–¹ç¨‹å…¶å®ä¹Ÿå¹¶ä¸æ˜¯PINNçš„ä¸»ä¸š</strong>ã€‚å½“ç„¶ï¼Œ<strong>å¯¹äºPINNè€Œè¨€ï¼Œè§£æ–¹ç¨‹è¿™ç§â€œæ­£é—®é¢˜â€è·Ÿå‚æ•°å‘ç°ç­‰è¿™äº›â€œé€†é—®é¢˜â€åœ¨æ±‚è§£å½¢å¼ä¸Šæ²¡æœ‰å¤ªå¤§åŒºåˆ«</strong>ï¼Œèƒ½æ¯”è¾ƒå¥½æ±‚è§£â€œæ­£é—®é¢˜â€çš„PINNæ–¹æ³•å¯¹äºâ€œé€†é—®é¢˜â€ä¹Ÿä¼šæœ‰ä¸é”™çš„è¡¨ç°ã€‚</li><li>CFDä¸å…¶è¯´æ˜¯è®¡ç®—ç§‘å­¦ï¼Œæ›´åƒæ˜¯ä¸€é—¨å®éªŒç§‘å­¦ï¼Œéœ€è¦ç‰©ç†å®éªŒæ•°æ®æ¥å¯¹è§£ç®—çš„æ¨¡å‹è¿›è¡ŒéªŒè¯ï¼Œè¿˜é¢ä¸´è¯¸å¤šå›°éš¾ã€‚<ul><li>åœ¨å·¥ç¨‹æ¨¡å‹ä¸­ï¼Œå¯èƒ½è¿˜æ¶‰åŠé€†é—®é¢˜çš„æ±‚è§£ï¼Œ<strong>ä¹Ÿå°±æ˜¯è¾¹ç•Œæ¡ä»¶å’Œæµä½“çš„å„ç§å‚æ•°æœªçŸ¥çš„æƒ…å½¢ä¸‹ï¼Œå¦‚ä½•é€šè¿‡éƒ¨åˆ†æµ‹é‡æ•°æ®å¾—åˆ°ç²¾ç¡®çš„æ¨¡å‹å‚æ•°å’Œæµåœºçš„é‡æ„</strong>ã€‚</li><li>CFDç½‘æ ¼è´¨é‡å¯¹ç»“æœçš„å½±å“æ¯”è¾ƒå¤§ï¼Œè®¡ç®—ä¸­ç½‘æ ¼åˆ’åˆ†æœ¬èº«ä¹Ÿæ˜¯éå¸¸è€—æ—¶çš„ã€‚æœ€åï¼Œç›®å‰çš„CFDè½¯ä»¶éƒ½éå¸¸åºå¤§ï¼Œæ¯”å¦‚OpenFoamï¼Œå¯¹æ¯ä¸€ç±»é—®é¢˜éƒ½æœ‰ä¸“é—¨çš„æ±‚è§£æ¨¡å—ï¼Œæ‹¥æœ‰è¶…è¿‡10ä¸‡è¡Œçš„ç§‘å­¦è®¡ç®—ä»£ç ï¼Œå…¶æ›´æ–°ä¸ç»´æŠ¤ä¹Ÿæ˜¯ä¸€ä»¶éš¾äº‹ã€‚</li><li>åˆšå¥½ï¼ŒPINNæœ‰éƒ¨åˆ†è§£å†³ä»¥ä¸Šé—®é¢˜çš„èƒ½åŠ›ã€‚<strong>PINNå¯¹å„ç§æ•°æ®çš„èåˆæ˜¯éå¸¸è‡ªç„¶çš„</strong>ï¼Œä¸ç®¡æ˜¯å‹å¼ºæ ‡é‡åœºçš„æ—¶ç©ºæ•£ç‚¹æ•°æ®ã€é€Ÿåº¦çŸ¢é‡åœºçš„æ—¶ç©ºæ•£ç‚¹æ•°æ®ï¼Œè¿˜æ˜¯ç¤ºè¸ªç²’å­çš„è¿åŠ¨è½¨è¿¹ï¼Œéƒ½å¯ä»¥éå¸¸å®¹æ˜“åœ°èåˆåˆ°PINNçš„æ±‚è§£ä¸­ã€‚</li><li><strong>å¯¹äºPINNæ¥è®²ï¼Œæ±‚è§£æ­£é—®é¢˜ä¸æ±‚è§£åŒ…å«æ•°æ®çš„é€†é—®é¢˜åœ¨å½¢å¼ä¸Šå¹¶æ²¡æœ‰å¤ªå¤§åŒºåˆ«</strong>ï¼Œè¿™æ˜¯å®ƒçš„å·¨å¤§ä¼˜åŠ¿ä¹‹ä¸€ã€‚</li><li>å³åœ¨æ—¶ç©ºæ•£ç‚¹æµ‹é‡æ•°æ®æ¯”è¾ƒå……è¶³çš„æƒ…å†µä¸‹ï¼Œè¿›è¡ŒCFDç›¸å…³çš„<strong>å‚æ•°ä¼°è®¡ã€æµåœºé‡å»ºã€ä»£ç†æ¨¡å‹æ„å»º</strong>ç­‰é—®é¢˜çš„æ±‚è§£ã€‚ä¸ä¼ ç»Ÿçš„CFDæ±‚è§£å™¨ç›¸æ¯”ï¼ŒPINNåœ¨é›†æˆæ•°æ®ï¼ˆæµé‡çš„è§‚æµ‹å€¼ï¼‰å’Œç‰©ç†çŸ¥è¯†ï¼ˆå…¶å®å°±æ˜¯æè¿°è¯¥ç‰©ç†ç°è±¡çš„æ§åˆ¶æ–¹ç¨‹ï¼‰æ–¹é¢æ›´èƒœä¸€ç­¹ã€‚</li></ul></li><li>æ¯”è¾ƒç›´æ¥çš„æ˜¯<strong>é€šè¿‡é€Ÿåº¦è§‚æµ‹æ¥é‡å»ºå…¨æµåœº</strong>ã€‚åœ¨æ°”åŠ¨åŠ›å­¦ç­‰å­¦ç§‘çš„å®éªŒç ”ç©¶ä¸­ï¼Œå¯ä»¥åˆ©ç”¨å…‰å­¦è®¾å¤‡ï¼Œé€šè¿‡ç²’å­å›¾åƒæµ‹é€Ÿï¼ˆParticle Image Velocimetryï¼ŒPIVï¼‰å’ŒParticle Tracking Velocimetryï¼ˆPTVï¼‰æ–¹æ³•æµ‹é‡çš„å¾—åˆ°å¤šä¸ªæ•£ç‚¹é€Ÿåº¦ã€‚ç„¶è€Œæ•£ç‚¹é€Ÿåº¦å¹¶ä¸èƒ½æ»¡è¶³éœ€æ±‚ï¼Œé«˜åˆ†è¾¨ç‡çš„é€Ÿåº¦åœºå¯¹äºå¯è§†åŒ–å’Œåç»­åˆ†ææ˜¯å¿…ä¸å¯å°‘çš„ã€‚ä¸€ä¸ªéå¸¸è‡ªç„¶çš„æƒ³æ³•å°±æ˜¯é€šè¿‡ç±»ä¼¼å›¾åƒæ’å€¼æ¥å®ç°ä»æ•£ç‚¹åˆ°é«˜åˆ†è¾¨ç‡æµåœºçš„â€œè¶…åˆ†è¾¨â€ï¼Œä½†æ˜¯è¿™ç§æ–¹å¼å¤„ç†å¾—åˆ°çš„ç»“æœå¯èƒ½â€œå¹¶ä¸ç¬¦åˆç‰©ç†è§„å¾‹â€ã€‚ä½œä¸ºèåˆäº†ç‰©ç†çŸ¥è¯†çš„PINNæ–¹æ³•ï¼Œå¯ä»¥éå¸¸è‡ªç„¶åœ°ä»è¿™äº›ç¨€ç–é€Ÿåº¦ä¿¡æ¯æ¥é‡å»ºåˆ†è¾¨ç‡çš„æ•´ä½“é€Ÿåº¦åœºã€‚</li><li><strong>è¿åˆå€¼å’Œè¾¹ç•Œæ¡ä»¶éƒ½ä¸éœ€è¦ã€‚è¿™ç§é€‚åˆPINNå»ºæ¨¡æ±‚è§£çš„é€†é—®é¢˜å¯¹äºä¼ ç»Ÿçš„CFDæ±‚è§£å™¨æ¥è¯´å¹¶ä¸æ˜¯ä¸€ä»¶å®¹æ˜“çš„äº‹æƒ…</strong>ã€‚</li><li><strong>PINNçš„ä¼˜åŠ¿ä¸å†æ­£é—®é¢˜æ±‚è§£ä¸Šçš„é€Ÿåº¦å’Œç²¾åº¦ï¼Œè€Œæ˜¯åœ¨äºèåˆæ•°æ®å’ŒçŸ¥è¯†</strong>ã€‚</li></ul></li><li><a href="https://www.zhihu.com/question/526459912/answer/2776226543">PINNè¿˜æœ‰ç ”ç©¶çš„å¿…è¦å—ï¼ŸAI4Scienceæ¢ç´¢</a><ul><li>PINNå³å†…åµŒç‰©ç†çŸ¥è¯†ç¥ç»ç½‘ç»œï¼Œè¯¥é¢†åŸŸæ›´å¹¿æ³›ã€é€šç”¨å«æ³•åº”è¯¥æ˜¯ç‰©ç†é©±åŠ¨çš„ç¥ç»ç½‘ç»œ(æ·±åº¦å­¦ä¹ )ï¼Œåˆšæ¥è§¦åˆ°ç‰©ç†é©±åŠ¨çš„ç¥ç»å­¦ä¹ æ–¹æ³•æ—¶ï¼Œæ€»ä¼šæœ‰ä¸€äº›ç–‘æƒ‘ï¼šç‰©ç†é©±åŠ¨çš„æ·±åº¦å­¦ä¹ æ–¹æ³•åœ¨æ±‚è§£ä¸€äº›ç‰©ç†ç³»ç»Ÿï¼ˆç”±ç‰©ç†æ–¹ç¨‹æ‰€æè¿°æ§åˆ¶çš„ç³»ç»Ÿï¼‰æ—¶ï¼Œéœ€è¦å·²çŸ¥ä¸€äº›ç‰©ç†ä¿¡æ¯å¦‚åå¾®åˆ†æ–¹ç¨‹ã€‚<strong>ä½†ä¼ ç»Ÿæ•°å€¼æ–¹æ³•å‘å±•è¿™ä¹ˆå¤šå¹´äº†ï¼Œå¦‚æœ‰é™å·®åˆ†ã€æœ‰é™ä½“ç§¯æ–¹æ³•å·²ç»éå¸¸æˆç†Ÿï¼Œä¹ŸæˆåŠŸç”¨äºç‰©ç†ç³»ç»Ÿçš„æ±‚è§£ï¼Œæ±‚è§£å‡†ç¡®æ€§éå¸¸é«˜</strong>ã€‚ä½†æ˜¯ç‰©ç†é©±åŠ¨çš„æ·±åº¦å­¦ä¹ å¦‚ç¥ç»ç½‘ç»œæ–¹æ³•</li><li>ç›¸æ¯”äºä¼ ç»Ÿæ•°å€¼æ–¹æ³•æœ‰ä»¥ä¸‹æ½œåœ¨ä¼˜åŠ¿ï¼š<ul><li><strong>åé—®é¢˜è®¡ç®—ä¸Šæœ‰æ¯”è¾ƒå¤§çš„ä¼˜åŠ¿</strong>ã€‚ä¼ ç»Ÿæ•°å€¼æ–¹æ³•ä¸»è¦é’ˆå¯¹å¤æ‚é—®é¢˜çš„æ­£è®¡ç®—ï¼Œå¦‚å·²çŸ¥è¾¹ç•Œæ¡ä»¶ã€å·²çŸ¥æ§åˆ¶æ–¹ç¨‹ä¸‹çš„æ­£è®¡ç®—ï¼Œä¼˜åŠ¿éå¸¸å¼ºã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œåœ¨æ­£è®¡ç®—é—®é¢˜ä¸Šï¼Œæ·±åº¦å­¦ä¹ æ–¹æ³•é€Šè‰²ä¸€äº›ã€‚ä½†é’ˆå¯¹ä¸€äº›åé—®é¢˜ï¼Œå¦‚å·²çŸ¥ä¸€äº›æµ‹é‡æ•°æ®å’Œéƒ¨åˆ†ç‰©ç† <strong>(æ–¹ç¨‹ä¸­æŸäº›å‚æ•°æœªçŸ¥ã€è¾¹ç•Œæ¡ä»¶æœªçŸ¥)</strong>ï¼Œæ·±åº¦å­¦ä¹ æ–¹æ³•å¯ä»¥å½¢æˆæ•°æ®å’Œç‰©ç†åŒé©±åŠ¨çš„æ¨¡å‹ï¼Œæ¯”åŸºäºä¼ ç»Ÿæ•°å€¼æ–¹æ³•å»åšæ•°æ®åŒåŒ–ï¼ˆdata assimilationï¼‰æ•ˆç‡æ›´é«˜ã€‚</li><li><strong>éœ€è¦åšå¿«é€Ÿæ¨æ–­æ—¶</strong>ï¼Œä¼˜åŠ¿æ›´æ˜æ˜¾ã€‚ä¸€æ–¹é¢ï¼Œå½“é¢å¯¹ä¸€äº›æ•°å€¼é—®é¢˜ï¼Œå¯ä»¥ä¸éœ€è¦ç†Ÿæ‚‰æ•°å€¼æ–¹æ³•èƒŒæ™¯ï¼ˆä¸å¿…åˆ©ç”¨æ•°å€¼æ ¼å¼å»æ¨å¯¼æ±‚è§£ï¼‰ï¼Œå¯ä»¥ç›´æ¥åˆ©ç”¨åŠ ç‰©ç†æŸå¤±çš„æ–¹æ³•å¾—åˆ°ä¸€ä¸ªå‚è€ƒè§£ï¼›å¦ä¸€æ–¹é¢ï¼Œå½“é—®é¢˜è¾¹ç•Œéœ€è¦ä¸åœåœ°æ¢ï¼Œæˆ–è€…å¾ˆå¤šæºéœ€è¦ä¸åœçš„å˜åŒ–çš„é—®é¢˜è®¾å®šä¸‹ï¼Œå¦‚æœåˆ©ç”¨å¤§é‡æ—¶é—´å»è®­ç»ƒä¸€ä¸ªç½‘ç»œï¼Œå¦‚åˆ©ç”¨luluè€å¸ˆæå‡º<strong>deeponetæ–¹æ³•</strong>ï¼ˆç‰©ç†é©±åŠ¨çš„ç¥ç»ç½‘ç»œæ–¹æ³•ï¼‰ï¼Œåœ¨æ¨æ–­é˜¶æ®µå°±èƒ½å®ç°å¿«é€Ÿé¢„æµ‹ã€‚é«˜ç»´é—®é¢˜ä¸Šçš„æ½œåœ¨ä¼˜åŠ¿ã€‚</li><li>ç¥ç»ç½‘ç»œç¡®å®èƒ½å¤„ç†è®¸å¤šé«˜ç»´é—®é¢˜ï¼Œä½†å¾ˆéš¾è¯´ç¥ç»ç½‘ç»œæ–¹æ³•åœ¨ä¸€äº›benchmarké—®é¢˜ä¸Šå·²ç»å®Œå…¨è¶…è¶Šäº†ä¼ ç»Ÿé—®é¢˜ï¼Œè¿˜éœ€è¦è¿›ä¸€æ­¥è®¨è®ºã€‚</li></ul></li></ul></li></ul><h1 id="governing-equations-from-scarce-data">governing equations from scarce data</h1><ul><li>Chen, Z., Liu, Y., &amp; Sun, H. (2021). Physics-informed learning of governing equations from scarce data. Nature communications, 12(1), 6136.<ul><li>é€šè¿‡æ•°æ®å‘ç°æè¿°å¤æ‚ç‰©ç†ç³»ç»Ÿçš„æ§åˆ¶æ–¹ç¨‹æˆ–è§„å¾‹ï¼Œå¯ä»¥æå¤§åœ°ä¿ƒè¿›å„ä¸ªç§‘å­¦å’Œå·¥ç¨‹é¢†åŸŸå¯¹è¿™äº›ç³»ç»Ÿçš„å»ºæ¨¡ã€ä»¿çœŸå’Œç†è§£ã€‚æœ¬æ–‡æå‡ºäº†ä¸€ç§æ–°é¢–çš„æ–¹æ³•ï¼Œ<strong>ç§°ä¸ºç¨€ç–å›å½’çš„ç‰©ç†å¯å‘ç¥ç»ç½‘ç»œ</strong>ï¼Œç”¨äºä»ç¨€ç–å’Œå™ªå£°æ•°æ®ä¸­<strong>å‘ç°éçº¿æ€§æ—¶ç©ºç³»ç»Ÿçš„æ§åˆ¶åå¾®åˆ†æ–¹ç¨‹</strong>ã€‚ç‰¹åˆ«åœ°ï¼Œè¯¥å‘ç°æ–¹æ³•æ— ç¼é›†æˆäº†æ·±åº¦ç¥ç»ç½‘ç»œåœ¨ä¸°å¯Œè¡¨ç¤ºå­¦ä¹ ã€ç‰©ç†åµŒå…¥ã€è‡ªåŠ¨å¾®åˆ†å’Œç¨€ç–å›å½’æ–¹é¢çš„ä¼˜åŠ¿ï¼Œä»¥é€¼è¿‘ç³»ç»Ÿå˜é‡çš„è§£ï¼Œè®¡ç®—å¿…è¦çš„å¯¼æ•°ï¼Œä»¥åŠè¯†åˆ«å½¢æˆæ–¹ç¨‹ç»“æ„å’Œæ˜¾å¼è¡¨è¾¾å¼çš„å…³é”®å¯¼æ•°é¡¹å’Œå‚æ•°ã€‚è¯¥æ–¹æ³•çš„æœ‰æ•ˆæ€§å’Œé²æ£’æ€§åœ¨å¤šç§åå¾®åˆ†æ–¹ç¨‹ç³»ç»Ÿçš„æ•°å€¼å’Œå®éªŒä¸Šå¾—åˆ°äº†éªŒè¯ï¼Œè¿™äº›ç³»ç»Ÿè€ƒè™‘äº†ä¸åŒçš„æ•°æ®ç¨€ç¼ºæ€§å’Œå™ªå£°æ°´å¹³ï¼Œä»¥åŠä¸åŒçš„åˆå§‹/è¾¹ç•Œæ¡ä»¶ã€‚æ‰€å¾—çš„è®¡ç®—æ¡†æ¶<strong>æ˜¾ç¤ºäº†åœ¨å¤§è§„æ¨¡å‡†ç¡®æ•°æ®éš¾ä»¥è·å–çš„å®é™…åº”ç”¨ä¸­å‘ç°å°é—­å½¢å¼æ¨¡å‹çš„æ½œåŠ›</strong>ã€‚</li></ul></li></ul><figure><img src="https://media.springernature.com/full/springer-static/image/art%3A10.1038%2Fs41467-021-26434-1/MediaObjects/41467_2021_26434_Fig4_HTML.png?as=webp" alt="Fig. 4: Discovered Fitzhughâ€“Nagumo equations based on data sampled under three initial conditions (ICs) with 10% noise." /><figcaption>Fig. 4: Discovered Fitzhughâ€“Nagumo equations based on data sampled under three initial conditions (ICs) with 10% noise.</figcaption></figure><h1 id="generalization-of-pinns">Generalization of PINNs</h1><ul><li><a href="https://elib.dlr.de/185457/1/master_thesis.pdf#page=36.10">SchÃ¤fer, Violetta. Generalization of physics-informed neural networks for various boundary and initial conditions. Diss. Technische UniversitÃ¤t Kaiserslautern, 2022. (Master Thesis)</a></li><li></li></ul><h1 id="references">References</h1><ol type="1"><li>Dissanayake, M. W. M. G., and Nhan Phanâ€Thien. "Neuralâ€networkâ€based approximations for solving partial differential equations." communications in Numerical Methods in Engineering 10.3 (1994): 195-201.</li><li>Raissi, Maziar, Paris Perdikaris, and George Em Karniadakis. "Physics informed deep learning (part i): Data-driven solutions of nonlinear partial differential equations." arXiv preprint arXiv:1711.10561 (2017).</li><li>Raissi, M., Perdikaris, P., &amp; Karniadakis, G.E. (2017). Physics Informed Deep Learning (Part II): Data-driven Discovery of Nonlinear Partial Differential Equations. ArXiv, abs/1711.10566.</li><li>Raissi, M., Perdikaris, P., &amp; Karniadakis, G. E. (2019). Physics-informed neural networks: A deep learning framework for solving forward and inverse problems involving nonlinear partial differential equations. Journal of Computational physics, 378, 686-707.</li><li>Karniadakis, G. E., Kevrekidis, I. G., Lu, L., Perdikaris, P., Wang, S., &amp; Yang, L. (2021). Physics-informed machine learning. Nature Reviews Physics, 3(6), 422-440.</li><li>Lu, L., Jin, P., Pang, G., Zhang, Z., &amp; Karniadakis, G. E. (2021). Learning nonlinear operators via DeepONet based on the universal approximation theorem of operators. Nature machine intelligence, 3(3), 218-229.</li><li>Lu, Lu, et al. "DeepXDE: A deep learning library for solving differential equations." SIAM Review 63.1 (2021): 208-228.</li></ol>]]></content>
    
    
    <categories>
      
      <category>ML</category>
      
    </categories>
    
    
    <tags>
      
      <tag>PINN</tag>
      
      <tag>AI</tag>
      
      <tag>DeepONet</tag>
      
      <tag>ML</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ML | JAX</title>
    <link href="/2024/06/25/PINN-JAX/"/>
    <url>/2024/06/25/PINN-JAX/</url>
    
    <content type="html"><![CDATA[<h1 id="jax">JAX</h1><p><a href="https://github.com/google/jax">JAX</a> is a Python library for accelerator-oriented array computation and program transformation, designed for high-performance numerical computing and large-scale machine learning.</p><p>With its updated version of <strong>Autograd</strong>, JAX can automatically differentiate native Python and NumPy functions. It can differentiate through loops, branches, recursion, and closures, and it can take derivatives of derivatives of derivatives. It supports reverse-mode differentiation (a.k.a. backpropagation) via grad as well as forward-mode differentiation, and the two can be composed arbitrarily to any order.</p><h1 id="installing-jax">Installing JAX</h1><p>https://jax.readthedocs.io/en/latest/installation.html</p><p>TL;DR For most users, a typical JAX installation may look something like this:</p><ul><li>CPU-only (Linux/macOS/Windows)</li><li>GPU (NVIDIA, CUDA 12)</li><li>TPU (Google Cloud TPU VM)</li></ul><h1 id="install-nvidia">Install (NVIDIA)</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ micromamba activate wpsze_venv<br>$ micromamba install jaxlib=*=*cuda* jax cuda-nvcc -c conda-forge -c nvidia<br><br>$ nvidia-smi<br></code></pre></td></tr></table></figure><h2 id="version-issue">Version Issue</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs sh">CUDA backend failed to initialize: Unable to use CUDA because of the following issues with CUDA components:<br>Outdated CUDA installation found.<br>Version JAX was built against: 11080<br>Minimum supported: 12010<br>Installed version: 11080<br>The <span class="hljs-built_in">local</span> installation version must be no lower than 12010.<br>--------------------------------------------------<br>Outdated cuBLAS installation found.<br>Version JAX was built against: 111103<br>Minimum supported: 120100<br>Installed version: 111103<br>The <span class="hljs-built_in">local</span> installation version must be no lower than 120100.<br>--------------------------------------------------<br>Outdated cuSPARSE installation found.<br>Version JAX was built against: 11705<br>Minimum supported: 12100<br>Installed version: 11705<br>The <span class="hljs-built_in">local</span> installation version must be no lower than 12100..(Set TF_CPP_MIN_LOG_LEVEL=0 and rerun <span class="hljs-keyword">for</span> more info.)<br>[0.        1.05      2.1       3.1499999 4.2      ]<br></code></pre></td></tr></table></figure><p><a href="https://docs.nvidia.com/cuda/archive/12.1.0/cuda-toolkit-release-notes/">Driver/CUDA version</a>,</p><table><thead><tr class="header"><th>CUDA Toolkit</th><th>Minimum Required Driver Version for CUDA Minor Version Compatibility*</th><th></th></tr></thead><tbody><tr class="odd"><td></td><td>Linux x86_64 Driver Version</td><td>Windows x86_64 Driver Version</td></tr><tr class="even"><td>CUDA 12.1.x</td><td>525.60.13</td><td>527.41</td></tr><tr class="odd"><td>CUDA 12.0.x</td><td>525.60.13</td><td>527.41</td></tr><tr class="even"><td>CUDA 11.8.x</td><td>450.80.02</td><td>452.39</td></tr><tr class="odd"><td>CUDA 11.7.x</td><td>450.80.02</td><td>452.39</td></tr></tbody></table><h1 id="install-cpu-only">Install (CPU only)</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">conda install jax -c conda-forge<br></code></pre></td></tr></table></figure><p>Test 1:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/python</span><br><br><span class="hljs-comment"># å¯¼å…¥åº“</span><br>from jax import grad<br>import jax.numpy as jnp<br><br><span class="hljs-comment"># å®šä¹‰logisticå‡½æ•°</span><br>def logistic(x):  <br>    <span class="hljs-built_in">return</span> jnp.exp(x) / (jnp.exp(x) + 1)<br><br><span class="hljs-comment"># è·å¾—logisticå‡½æ•°çš„æ¢¯åº¦å‡½æ•°</span><br>grad_logistic = grad(logistic)<br><br><span class="hljs-comment"># æ±‚å€¼logisticå‡½æ•°åœ¨x = 1å¤„çš„æ¢¯åº¦ </span><br>grad_log_out = grad_logistic(1.0)   <br><span class="hljs-built_in">print</span>(grad_log_out)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Final result is 0.19661194 &quot;</span>)<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>ML</category>
      
    </categories>
    
    
    <tags>
      
      <tag>PINN</tag>
      
      <tag>AI</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>WRF | WRF: Why domains should be at least 100x100 grid spaces?</title>
    <link href="/2024/06/11/WRF-Why_domains_should_be_at_least_100_100_grid_spaces/"/>
    <url>/2024/06/11/WRF-Why_domains_should_be_at_least_100_100_grid_spaces/</url>
    
    <content type="html"><![CDATA[<h1 id="why-domains-should-be-at-least-100x100-grid-spaces"><a href="https://forum.mmm.ucar.edu/threads/why-domains-should-be-at-least-100x100-grid-spaces.16793/">Why domains should be at least 100x100 grid spaces?</a></h1><p>Each WRF domain should be at least 100x100 grid points (e_we and e_sn).</p><p>When running a simulation, the input data for the lateral boundaries, every so many intervals (e.g., every 3 hours), are much more coarse than the simulation youâ€™re trying to run.</p><p>Synoptic-scale systems typically move through a large area in a short amount of time. If a domains is too small, there isnâ€™t enough space for the model to develop anything of interest before the large-scale parcels have propagated through the domain and exited the other side. This is sometimes referred to as â€œsweeping,â€ meaning the <strong>input essentially wipes out what WRF is trying to simulate at high resolution, with different physics and higher-res terrain, landuse, the dynamics, and all the other features you want</strong>. Even if youâ€™re only interested in microscale events, the large-scale factors are important for forcing.</p><p>Essentially, if your domain is too small, youâ€™re basically going to get the output as if the domain was still a coarse-resolution. You want your domain to have enough space so that you can actually see the effect.</p><p>This is not a computational limitation. Itâ€™s more an issue of reasonable and beneficial output. {:.info}</p><p><strong>Also note that the model will use the rows and columns around the edges of the domain for communication. This is set, by default, to 5 rows and 5 columns (it can be changed with the &amp;bdy_control namelist parameter â€˜spec_bdy_width,' but shouldn't be smaller than 5). This means that if e_we = 100 and e_sn = 100, at a minimum, the domain is already cut down to 90x90.</strong></p>]]></content>
    
    
    <categories>
      
      <category>WRF</category>
      
    </categories>
    
    
    <tags>
      
      <tag>WRF</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Spack-Stack (MPAS-JEDI)</title>
    <link href="/2024/06/10/spack_stack_jedi_mpas/"/>
    <url>/2024/06/10/spack_stack_jedi_mpas/</url>
    
    <content type="html"><![CDATA[<h1 id="spack-stack">spack-stack</h1><p>Spack-stack is a framework for installing software libraries to support NOAA's Unified Forecast System (UFS) applications and the Joint Effort for Data assimilation Integration (JEDI) coupled to several Earth system prediction models (MPAS, NEPTUNE, UM, FV3, GEOS, UFS).</p><p>Spack-stack provides a practical framework for setting up and managing software libraries that support the Unified Forecast System (UFS) and Joint Effort for Data assimilation Integration (JEDI) projects, along with several other Earth system prediction models, such as the Model for Prediction Across Scales (MPAS), the Navy Environmental Prediction System Utilizing a Nonhydrostatic Engine (NEPTUNE), the Unified Model (UM), and the Goddard Earth Observing System (GEOS). This project results from collaboration among the Joint Center for Satellite Data Assimilation (JCSDA), the National Oceanic and Atmospheric Administrationâ€™s (NOAAâ€™s) Environmental Modeling Center (EMC) and Earth Prediction Innovation Center (EPIC), and the U.S. Naval Research Laboratory (NRL). Spack-stack utilizes the Spack package manager, originally developed at Lawrence Livermore National Laboratory to cater to scientific high-performance computing (HPC) workflows.</p><p><a href="https://www.jcsda.org/news-blog/2023/10/2/jedi-spack-stack-150-the-new-standard">SPACK-STACK 1.5.0</a> &gt; That started changing in 2021, when JCSDA and NOAA EMC began exploring Spack as an option for creating a single software stack that could be used for both the JEDI DA software environment and the Unified Forecast System (UFS) ecosystem.</p><p><a href="https://github.com/JCSDA/spack-stack">github spack-stack</a></p><p><a href="https://spack-stack.readthedocs.io/en/latest/#">spack-stack.readthedocs.io</a></p><p><a href="https://epic.noaa.gov/spack-stack/">Spack-stack</a></p><p><a href="https://www.google.com/search?q=ONE+STACK+TO+BUILD+THEM+ALL%3A+THE+NOAA-EMC%2FJCSDA+SPACK-STACK&amp;rlz=1C5CHFA_enHK1003HK1003&amp;sourceid=chrome&amp;ie=UTF-8">ONE STACK TO BUILD THEM ALL: THE NOAA-EMC/JCSDA SPACK-STACK (PPT)</a></p><p><a href="https://epic.noaa.gov/wp-content/uploads/2023/08/UIFCW-2023-Thu-17.-RICHERT_spack-stack-UIFCW-July-2023.pdf">spack-stack: A reproducible, many-platform software stack for operational weather applications (PPT)</a></p><p>spack-stack is a set of Spack configurations and extensions {:.info}</p><p>spack-stack is mainly a collection of Spack configuration files, but provides a Spack extension to simplify the installation process {:.info}</p><h1 id="new-spack-stack-directory-structure">New spack-stack directory structure</h1><p>To generate a new spack-stack directory structure,</p><p>run <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">git <span class="hljs-built_in">clone</span> --recurse-submodules https://github.com/JCSDA/spack-stack<br></code></pre></td></tr></table></figure></p><p>optionally with, e.g., '-b release/1.4.1' to specify the version</p><p>source &lt;path to spack-stack directory&gt;/setup.sh {:.info}</p><h1 id="new-environment">New environment</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ spack stack create <span class="hljs-built_in">env</span> --site &lt;site name&gt; --template &lt;template name&gt; --name &lt;environment name&gt;<br>$ <span class="hljs-built_in">cd</span> <span class="hljs-variable">$&#123;SPACK_STACK_DIR&#125;</span>/envs/&lt;environment name&gt;/<br>$ spack <span class="hljs-built_in">env</span> activate .<br><br><span class="hljs-comment"># If not using an existing site configuration, you may wish to modify config files and/or populate them using commands</span><br><span class="hljs-comment"># such as &#x27;spack external find&#x27; and &#x27;spack compiler find&#x27;.</span><br><span class="hljs-comment"># See https://spack-tutorial.readthedocs.io/en/latest/tutorial_configuration.html</span><br><br>$ spack concretize 2&gt;&amp;1 | <span class="hljs-built_in">tee</span> log.concretize<br>$ spack install [--verbose] [--fail-fast] 2&gt;&amp;1 | <span class="hljs-built_in">tee</span> log.install<br>$ spack module lmod refresh<br>$ spack stack setup-meta-modules<br></code></pre></td></tr></table></figure><h2 id="mpas-jdei">MPAS-JDEI</h2><p>Ref:<a href="https://www2.mmm.ucar.edu/projects/mpas-jedi/tutorial/202310NCU/">Welcome to the MPAS-JEDI tutorial practice guide</a></p><p>For example, if default is gcc@8.5.0.</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ git <span class="hljs-built_in">clone</span> -b release/1.5.1 --recurse-submodules https://github.com/JCSDA/spack-stack<br><br>$ <span class="hljs-built_in">cd</span> spack-stack<br><br>$ git status<br>On branch release/1.5.1<br>Your branch is up to <span class="hljs-built_in">date</span> with <span class="hljs-string">&#x27;origin/release/1.5.1&#x27;</span>.<br><br>nothing to commit, working tree clean<br><br>$ <span class="hljs-built_in">source</span> setup.sh<br><br>$ spack stack create <span class="hljs-built_in">env</span> --site linux.default --name jedi_gccv850_linux<br>Configuring basic directory information ...<br>  ... script directory: /home/wpsze/spack-stack/spack-stack/spack/lib/jcsda-emc/spack-stack/stack<br>  ... base directory: /home/wpsze/spack-stack/spack-stack/spack/lib/jcsda-emc/spack-stack<br>  ... spack directory: /home/wpsze/spack-stack/spack-stack/spack<br>Creating environment from command-line args<br>Successfully wrote environment at /home/wpsze/spack-stack/spack-stack/envs/jedi_gccv850_linux/spack.yaml<br><br>WARNING! User <span class="hljs-built_in">umask</span> is neither 0022 nor 0027, check before proceeding<br><br>==&gt; Created environment /home/wpsze/spack-stack/spack-stack/envs/jedi_gccv850_linux<br><br>$ spack <span class="hljs-built_in">env</span> activate envs/jedi_gccv850_linux<br><br>$ spack find<br>==&gt; In environment /home/wpsze/spack-stack/spack-stack/envs/jedi_gccv850_linux<br>==&gt; No root specs<br>==&gt; 0 installed packages<br><br><br><span class="hljs-comment">## MPAS-JEDI</span><br>$ spack add ecbuild eigen udunits gsl-lite environment-modules<br>$ spack add mpich<br>$ spack add hdf5^mpich parallelio^mpich<br>$ spack add ecmwf-atlas@0.31.1^mpich<br><br>$ spack install<br><br><span class="hljs-comment"># all are successful.</span><br><br> $ spack find<br>==&gt; In environment /home/wpsze/spack-stack/spack-stack/envs/jedi_gccv850_linux<br>==&gt; Root specs<br>ecbuild   ecmwf-atlas@0.31.1   eigen   environment-modules   gsl-lite   hdf5   mpich   parallelio   udunits <br><br>==&gt; Installed packages<br>-- linux-rocky8-haswell / gcc@8.5.0 -----------------------------<br>autoconf@2.69                       diffutils@3.9              fiat@1.2.0       libfabric@1.18.1   m4@1.4.19               pigz@2.7                util-macros@1.19.3<br>automake@1.16.5                     ecbuild@3.7.2              findutils@4.9.0  libffi@3.4.4       mpich@4.1.1             pkg-config@0.29.2       xz@5.4.1<br>berkeley-db@18.1.40                 eckit@1.23.1               flex@2.6.3       libiconv@1.17      ncurses@6.4             python@3.10.8           yaksa@0.2<br>bison@3.8.2                         ecmwf-atlas@0.31.1         gdbm@1.23        libmd@1.0.4        netcdf-c@4.9.2          readline@8.2            zlib@1.2.13<br>boost@1.78.0                        ectrans@1.2.0              gettext@0.21.1   libpciaccess@0.17  netcdf-fortran@4.6.0    snappy@1.1.10           zstd@1.5.2<br>bzip2@1.0.8                         eigen@3.4.0                gmake@4.4.1      libsigsegv@2.14    openblas@0.3.19         sqlite@3.42.0<br>c-blosc@1.21.4                      environment-modules@5.3.1  gsl-lite@0.37.0  libtool@2.4.7      openssl@1.1.1u          tar@1.34<br>ca-certificates-mozilla@2023-01-10  expat@2.5.0                hdf5@1.14.0      libxcrypt@4.4.35   parallel-netcdf@1.12.2  tcl@8.6.12<br>cmake@3.23.1                        fckit@0.10.1               libaec@1.0.6     libxml2@2.10.3     parallelio@2.5.10       udunits@2.2.28<br>curl@8.1.2                          fftw@3.3.10                libbsd@0.11.7    lz4@1.9.4          perl@5.38.0             util-linux-uuid@2.38.1<br>==&gt; 65 installed packages<br><br>$ spack module tcl refresh<br>==&gt; You are about to regenerate tcl module files <span class="hljs-keyword">for</span>:<br><br>-- linux-rocky8-haswell / gcc@8.5.0 -----------------------------<br>kmosf2b autoconf@2.69                       owkksle expat@2.5.0       o5fm2ib libpciaccess@0.17       zzdldzz pkg-config@0.29.2<br>3zzqcqa automake@1.16.5                     z5frtgj fckit@0.10.1      bcnervk libsigsegv@2.14         vu7mzai python@3.10.8<br>rksajpa berkeley-db@18.1.40                 dyhv6t6 fftw@3.3.10       oi52wco libtool@2.4.7           nbav53o readline@8.2<br>k4yohcw bison@3.8.2                         abwhtim fiat@1.2.0        dh3pgna libxcrypt@4.4.35        awehs3f snappy@1.1.10<br>3zcm66d boost@1.78.0                        th5cmuq findutils@4.9.0   56a6xgk libxml2@2.10.3          xmupg6k sqlite@3.42.0<br>yd6i5au bzip2@1.0.8                         hjgtmaq flex@2.6.3        rwcgkls lz4@1.9.4               vetdjwa tar@1.34<br>at3s3ei c-blosc@1.21.4                      lisu52h gdbm@1.23         uwicvjw m4@1.4.19               m3xviog tcl@8.6.12<br>edma3gu ca-certificates-mozilla@2023-01-10  wzfhnm7 gettext@0.21.1    jefb5lu mpich@4.1.1             uadvmuz udunits@2.2.28<br>h5p5rs7 cmake@3.23.1                        ba4vudd gmake@4.4.1       dzxkixc ncurses@6.4             wdfeec7 util-linux-uuid@2.38.1<br>jf7usug curl@8.1.2                          t4udhou gsl-lite@0.37.0   6d2z7tb netcdf-c@4.9.2          evqjofh util-macros@1.19.3<br>32jm5xp diffutils@3.9                       fja7tdm hdf5@1.14.0       3ltfgi2 netcdf-fortran@4.6.0    72t2yvx xz@5.4.1<br>pzidwlf ecbuild@3.7.2                       vbf3elz libaec@1.0.6      u5n5zri openblas@0.3.19         iyrk2i7 yaksa@0.2<br>wov4yva eckit@1.23.1                        65boafj libbsd@0.11.7     mgcs3tx openssl@1.1.1u          x54v3wn zlib@1.2.13<br>v45ibbv ecmwf-atlas@0.31.1                  63u4otp libfabric@1.18.1  56vql6d parallel-netcdf@1.12.2  bteldyo zstd@1.5.2<br>kb6u64z ectrans@1.2.0                       frf3blg libffi@3.4.4      efx7bmd parallelio@2.5.10<br>t4jxg3j eigen@3.4.0                         pnmrtbc libiconv@1.17     se4zvg5 perl@5.38.0<br>om7l5xf environment-modules@5.3.1           vgtevgl libmd@1.0.4       l3xczgm pigz@2.7<br><br>==&gt; Do you want to proceed? [y/n] y<br>==&gt; Regenerating tcl module files<br><br>$ spack stack setup-meta-modules<br>...<br>Metamodule generation completed successfully <span class="hljs-keyword">in</span> /home/wpsze/spack-stack/spack-stack/envs/jedi_gccv850_linux/install/modulefiles/Core<br></code></pre></td></tr></table></figure><p>Error: &gt; Error: eigen-3.4.0-t4jxg3j727pxxsr75zstl2eblmkzapfz: timeout: The read operation timed out &gt;&gt; rerun: $ spack install</p><blockquote><p>==&gt; Installing krb5-1.20.1-muktx57itqz6x2z74afwncpub2higpei msgfmt: error while opening "en_US.mo" for writing: Permission denied msgfmt: error while opening "de.mo" for writing: Permission denied &gt; No install git-lfs</p></blockquote><blockquote><p>Error: git-lfs-3.3.0-6ilwlfqmm7ud5crbugmcskju5gtkgk4j: Package was not installed &gt; <code>$ micromamba activate git-lfs</code> &gt; <code>$ micromamba install git-lfs</code></p></blockquote><p>Remark: Git Large File Storage (LFS) replaces large files such as audio samples, videos, datasets, and graphics with text pointers inside Git, while storing the file contents on a remote server like GitHub.com or GitHub Enterprise.</p><p>source env,</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#source $&#123;SPACK_DIR&#125;/setup.sh</span><br><span class="hljs-comment">#spack env activate $&#123;SPACK_ENV&#125;</span><br></code></pre></td></tr></table></figure><blockquote><p>** do above on local PC because git-lfs fails on workstation/cluster.</p></blockquote><h2 id="mpas_bundle">mpas_bundle</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ <span class="hljs-built_in">source</span> spack/share/spack/setup-env.sh<br>$ <span class="hljs-built_in">source</span> spack-stack/setup.sh<br>$ spack <span class="hljs-built_in">env</span> activate spack-stack/envs/jedi_gcc_linux<br>$ spack find<br><br>$ <span class="hljs-built_in">mkdir</span> mpas_bundle_v2<br>$ <span class="hljs-built_in">cd</span> mpas_bundle_v2<br>$ git <span class="hljs-built_in">clone</span> -b release/2.0.0 https://github.com/JCSDA/mpas-bundle.git code<br><br>$ <span class="hljs-built_in">mkdir</span> build<br>$ <span class="hljs-built_in">cd</span> build<br><br><span class="hljs-comment"># (no need) $ module list</span><br></code></pre></td></tr></table></figure><p>MPAS-JEDI uses cmake to automatically download the code from various github repositories, listed in CMakeLists.txt under ~code. Now type the command below under the build directory:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ git lfs install<br></code></pre></td></tr></table></figure><p>and then, <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sh">spack load ecbuild@3.7.2<br>spack load eigen@3.4.0 gsl-lite@0.37.0 hdf5@1.14.0 udunits@2.2.28 netcdf-c@4.9.2 netcdf-fortran@4.6.0 parallel-netcdf@1.12.2 parallelio@2.5.10<br>spack load openblas@0.3.19<br>spack load eckit@1.23.1<br>spack load fckit@0.10.1<br>spack load ecmwf-atlas@0.31.1<br>spack load cmake@3.23.1 mpich@4.1.1<br><br>$ cmake ../code<br><br>......<br>-- Configuring <span class="hljs-keyword">done</span><br>-- Generating <span class="hljs-keyword">done</span><br>-- Build files have been written to: /home/wpsze/mpas_bundle_v2/build<br></code></pre></td></tr></table></figure></p><p>After it completes, <strong>you will see the actual source code of various reporitories (e.g., oops, saber, ufo, ioda, crtm, mpas-jedi, and MPAS) is now under the code directory</strong>. Meanwhile, <strong>Makefile files to build executables are generated under the build directory</strong>. Now it is ready to compile MPAS-JEDI under 'build' using the standard make. However, it is NOT recommended to compile the code on the login node at the same time.</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ make -j14<br><br>.......<br>[100%]<br></code></pre></td></tr></table></figure><p>This requests xx min walltime of a login node with 14 cores. {:.info}</p><p>Once we reach 100% of the compilation, we can check mpas-jedi related executables:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ <span class="hljs-built_in">ls</span> bin/mpas*<br><br>bin/mpas_atmosphere                       bin/mpasjedi_forecast.x<br>bin/mpas_atmosphere_build_tables          bin/mpasjedi_gen_ens_pert_B.x<br>bin/mpas_data_checker.py                  bin/mpasjedi_hofx3d.x<br>bin/mpas_data_downloader.py               bin/mpasjedi_hofx.x<br>bin/mpas_init_atmosphere                  bin/mpasjedi_rtpp.x<br>bin/mpasjedi_convertstate.x               bin/mpasjedi_staticbinit.x<br>bin/mpasjedi_dirac.x                      bin/mpasjedi_variational.x<br>bin/mpasjedi_eda.x                        bin/mpas_namelist_gen<br>bin/mpasjedi_enkf.x                       bin/mpas_parse_atmosphere<br>bin/mpasjedi_enshofx.x                    bin/mpas_parse_init_atmosphere<br>bin/mpasjedi_error_covariance_training.x  bin/mpas_streams_gen<br><br>$ <span class="hljs-built_in">ls</span> bin/ioda-up*<br>bin/ioda-upgrade-v1-to-v2.x  bin/ioda-upgrade-v2-to-v3.x<br></code></pre></td></tr></table></figure><p>The last step is to ensure that the code was compiled properly by running the MPAS-JEDI ctests, with two lines of simple command:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ <span class="hljs-built_in">cd</span> mpas-jedi<br>$ ctest<br><br>100% tests passed, 0 tests failed out of 47<br><br>Label Time Summary:<br>executable    =  54.21 sec*proc (13 tests)<br>mpasjedi      = 380.26 sec*proc (47 tests)<br>mpi           = 287.59 sec*proc (43 tests)<br>script        = 326.05 sec*proc (34 tests)<br><br>Total Test time (real) = 380.91 sec<br></code></pre></td></tr></table></figure><p>To determine if a test passes or fails, <em>a comparison of the test log and reference file is done internally taking as reference a tolerance value</em>. This tolerance is specified via YAML file. These files can be found under <strong>mpas-jedi/test/testoutput</strong> in the build folder.</p><h2 id="converting-ncep-bufr-observation-into-ioda-hdf5-format">Converting NCEP BUFR observation into IODA-HDF5 format</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ <span class="hljs-built_in">cd</span> mpas_jedi_tutorial <br>$ git <span class="hljs-built_in">clone</span> https://github.com/NCAR/obs2ioda<br>$ <span class="hljs-built_in">cd</span> obs2ioda/obs2ioda-v2/src/<br></code></pre></td></tr></table></figure><p>NCEP BUFR library (https://github.com/NOAA-EMC/NCEPLIBS-bufr) is required to compile <strong>obs2ioda-v2.x</strong>. Edit <strong>obs2ioda-v2/src/Makefile</strong> to set proper <strong>BUFR_LIB</strong> before make. Here we have pre-build BUFR_LIB on Taiwania-3 and we put the pre-build BUFR_LIB path in Makefile.</p><h3 id="required-ncep-bufr-library">(Required) NCEP BUFR library</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ git <span class="hljs-built_in">clone</span> https://github.com/NOAA-EMC/NCEPLIBS-bufr<br><br>$ <span class="hljs-built_in">mkdir</span> build &amp;&amp; <span class="hljs-built_in">cd</span> build<br><br><span class="hljs-comment"># $ cmake -DCMAKE_INSTALL_PREFIX=path1 -DMASTER_TABLE_DIR=path2 .. # path1=./</span><br>$ cmake -DCMAKE_INSTALL_PREFIX=./ .. <br>-- Build files have been written to: /home/wpsze/mpas_jedi_tutorial/NCEPLIBS-bufr/build<br><br>$ make -j4<br>......<br>[100%] Built target outtest6_8<br><br>$ ctest<br>......<br>100% tests passed, 0 tests failed out of 94<br>Total Test time (real) =  30.62 sec<br><br>$ make install<br>......<br>-- Installing: /home/wpsze/mpas_jedi_tutorial/NCEPLIBS-bufr/build/bin/debufr<br></code></pre></td></tr></table></figure><p>Both <strong>path1</strong> and <strong>path2</strong> may be full or relative pathnames on the system, up to a maximum of 90 characters each.</p><p>Installation of the library and utilities will be under <strong>path1</strong>. Installation of the master BUFR tables will be under <strong>path2</strong>, or <em>under path1 if -DMASTER_TABLE_DIR=path2 is omitted from the above cmake command</em>.</p><p>If Python interoperability is desired, -DENABLE_PYTHON=ON can also be added to the above cmake command. However, version 3 of Python must be installed and available on the system.</p><h3 id="go-back-to-ioda">Go back to IODA</h3><h3 id="obs2ioda-v2.x">obs2ioda-v2.x</h3><p>https://github.com/jamiebresch/obs2ioda/blob/main/obs2ioda-v2/README.md</p><p>NCEP BUFR library (https://github.com/NOAA-EMC/NCEPLIBS-bufr) is required to compile <strong>obs2ioda-v2.x</strong>. Edit <strong>obs2ioda-v2/src/Makefile</strong> to set proper <strong>BUFR_LIB</strong> before make. <del>Here we have pre-build BUFR_LIB on Taiwania-3 and we put the pre-build BUFR_LIB path in Makefile.</del> We have to build one as above and put the build BUFR_LIB path in Makefile.</p><p>Default Makefile includes,</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#--------------</span><br><span class="hljs-comment">#INTEL compiler</span><br><span class="hljs-comment">#--------------</span><br>FC = ifort<br><span class="hljs-comment">#BUFR_LIB = -L/glade/u/home/hclin/extlib/intel -lbufr</span><br><span class="hljs-comment">#FFLAGS = -mcmodel medium # needed for intel error message &quot;failed to convert GOTPCREL relocation&quot;</span><br>BUFR_LIB = -L/glade/campaign/mmm/parc/ivette/pandac/converters/WRFDA_3DVAR_dmpar/var/external/bufr -lbufr<br>FFLAGS = -mcmodel medium <span class="hljs-comment"># needed for intel error message &quot;failed to convert GOTPCREL relocation&quot; # -g -traceback -debug all -check all</span><br><br>LIBS = -L$(NETCDF)/lib -lnetcdff -lnetcdf <span class="hljs-variable">$&#123;BUFR_LIB&#125;</span><br>INCS = -I$(NETCDF)/include<br>```   <br><br><span class="hljs-keyword">then</span>,<br><br>```sh<br>BUFR_LIB = -L/home/wpsze/mpas_jedi_tutorial/NCEPLIBS-bufr/build/lib -lbufr<br><span class="hljs-built_in">export</span> NETCDF=/home/wpsze/spack-stack/envs/jedi_gcc_linux/install/gcc/9.4.0/netcdf-fortran-4.6.0-gwqak4i/<br><span class="hljs-built_in">export</span> NETCDF=/home/wpsze/micromamba/envs/obs2ioda/x86_64-conda-linux-gnu/<br></code></pre></td></tr></table></figure><p>Then compile the converter by using make command:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ <span class="hljs-built_in">cd</span> obs2ioda/obs2ioda-v2/src/<br>$ make<br><span class="hljs-comment"># $ make clean</span><br></code></pre></td></tr></table></figure><p>If the compilation is successful, the executable file <strong>obs2ioda-v2.x</strong> will be generated.</p><h4 id="error-1">Error 1</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh">hsd.f90:306:11:<br><br>  306 |       <span class="hljs-keyword">if</span> ( fexist(ij) == .<span class="hljs-literal">false</span>. ) <span class="hljs-keyword">then</span><br>      |           1<br>Error: Logicals at (1) must be compared with .eqv. instead of ==<br>make: *** [Makefile:67: hsd.o] Error 1<br></code></pre></td></tr></table></figure><p>check, and then replace with "eqv"</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ grep -rin <span class="hljs-string">&quot;==&quot;</span> hsd.f90 <br>306:      <span class="hljs-keyword">if</span> ( fexist(ij) == .<span class="hljs-literal">false</span>. ) <span class="hljs-keyword">then</span><br>...<br></code></pre></td></tr></table></figure><p>to</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"> $ grep -rin <span class="hljs-string">&quot;eqv&quot;</span> hsd.f90 <br>306:      <span class="hljs-keyword">if</span> ( fexist(ij) .eqv. .<span class="hljs-literal">false</span>. ) <span class="hljs-keyword">then</span><br></code></pre></td></tr></table></figure><h4 id="error-2">Error 2</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">/usr/bin/ld: cannot find -lbufr<br>collect2: error: ld returned 1 <span class="hljs-built_in">exit</span> status<br>make: *** [Makefile:46: obs2ioda] Error 1<br></code></pre></td></tr></table></figure><p>check,</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">NCEPLIBS-bufr/build/include/ is bufr_4<br>NCEPLIBS-bufr/build/lib/ is libbufr_4.a<br></code></pre></td></tr></table></figure><h4 id="error-3">Error 3</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">/usr/bin/ld: warning: libnetcdf.so.19, needed by /home/wpsze/spack-stack/envs/jedi_gcc_linux/install/gcc/9.4.0/netcdf-fortran-4.6.0-gwqak4i/lib/libnetcdff.so, may conflict with libnetcdf.so.15<br></code></pre></td></tr></table></figure><p>Export,</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">export</span> NETCDF=/home/wpsze/spack-stack/envs/jedi_gcc_linux/install/gcc/9.4.0/netcdf-c-4.9.2-yhizvd3/<br><span class="hljs-built_in">export</span> NETCDFF=/home/wpsze/spack-stack/envs/jedi_gcc_linux/install/gcc/9.4.0/netcdf-fortran-4.6.0-gwqak4i/<br></code></pre></td></tr></table></figure><p>and, modify in Makefile</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">LIBS = -L$(NETCDF)/lib -L$(NETCDFF)/lib -lnetcdff -lnetcdf <span class="hljs-variable">$&#123;BUFR_LIB&#125;</span><br>INCS = -I$(NETCDF)/include -I$(NETCDFF)/include<br></code></pre></td></tr></table></figure><h4 id="error-4">Error 4</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs sh">hsd.o: <span class="hljs-keyword">in</span> <span class="hljs-keyword">function</span> `__ahi_hsd_mod_MOD_hisd_radiance_to_tbb<span class="hljs-string">&#x27;:</span><br><span class="hljs-string">hsd.f90:(.text+0x19ed): relocation truncated to fit: R_X86_64_PC32 against symbol `__ahi_hsd_mod_MOD_header&#x27;</span> defined <span class="hljs-keyword">in</span> .bss section <span class="hljs-keyword">in</span> hsd.o<br>hsd.f90:(.text+0x1a06): relocation truncated to fit: R_X86_64_PC32 against symbol `__ahi_hsd_mod_MOD_header<span class="hljs-string">&#x27; defined in .bss section in hsd.o</span><br><span class="hljs-string">hsd.f90:(.text+0x1a1a): relocation truncated to fit: R_X86_64_PC32 against symbol `__ahi_hsd_mod_MOD_header&#x27;</span> defined <span class="hljs-keyword">in</span> .bss section <span class="hljs-keyword">in</span> hsd.o<br>hsd.f90:(.text+0x1a50): relocation truncated to fit: R_X86_64_PC32 against symbol `__ahi_hsd_mod_MOD_header<span class="hljs-string">&#x27; defined in .bss section in hsd.o</span><br><span class="hljs-string">hsd.f90:(.text+0x1a58): relocation truncated to fit: R_X86_64_PC32 against symbol `__ahi_hsd_mod_MOD_header&#x27;</span> defined <span class="hljs-keyword">in</span> .bss section <span class="hljs-keyword">in</span> hsd.o<br>hsd.f90:(.text+0x1a64): relocation truncated to fit: R_X86_64_PC32 against symbol `__ahi_hsd_mod_MOD_header<span class="hljs-string">&#x27; defined in .bss section in hsd.o</span><br><span class="hljs-string">hsd.f90:(.text+0x1ad1): relocation truncated to fit: R_X86_64_PC32 against symbol `__ahi_hsd_mod_MOD_header&#x27;</span> defined <span class="hljs-keyword">in</span> .bss section <span class="hljs-keyword">in</span> hsd.o<br>hsd.f90:(.text+0x1ad9): relocation truncated to fit: R_X86_64_PC32 against symbol `__ahi_hsd_mod_MOD_header<span class="hljs-string">&#x27; defined in .bss section in hsd.o</span><br><span class="hljs-string">hsd.f90:(.text+0x1aea): relocation truncated to fit: R_X86_64_PC32 against symbol `__ahi_hsd_mod_MOD_header&#x27;</span> defined <span class="hljs-keyword">in</span> .bss section <span class="hljs-keyword">in</span> hsd.o<br>hsd.o: <span class="hljs-keyword">in</span> <span class="hljs-keyword">function</span> `__ahi_hsd_mod_MOD_pixlin_to_lonlat<span class="hljs-string">&#x27;:</span><br><span class="hljs-string">hsd.f90:(.text+0x1eca): relocation truncated to fit: R_X86_64_PC32 against symbol `__ahi_hsd_mod_MOD_header&#x27;</span> defined <span class="hljs-keyword">in</span> .bss section <span class="hljs-keyword">in</span> hsd.o<br>hsd.f90:(.text+0x1eed): additional relocation overflows omitted from the output<br>/usr/bin/ld: failed to convert GOTPCREL relocation; relink with --no-relax<br>collect2: error: ld returned 1 <span class="hljs-built_in">exit</span> status<br>make: *** [Makefile:46: obs2ioda] Error 1<br></code></pre></td></tr></table></figure><p>We use gfortran, <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#------------</span><br><span class="hljs-comment">#GNU compiler</span><br><span class="hljs-comment">#------------</span><br>FC = gfortran<br>BUFR_LIB = -L/home/wpsze/mpas_jedi_tutorial/NCEPLIBS-bufr/build/lib -lbufr_4<br><br>FFLAGS = -ffree-line-length-none -mcmodel=medium <br></code></pre></td></tr></table></figure></p><h3 id="finally-modified-makefile">Finally, modified Makefile</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#! /bin/sh -v</span><br><br><span class="hljs-comment">#------------</span><br><span class="hljs-comment">#GNU compiler</span><br><span class="hljs-comment">#------------</span><br>FC = gfortran<br>BUFR_LIB = -L/home/wpsze/mpas_jedi_tutorial/NCEPLIBS-bufr/build/lib -lbufr_4<br><br>FFLAGS = -ffree-line-length-none -mcmodel=medium <span class="hljs-comment">#-fbacktrace -ggdb -fcheck=bounds,do,mem,pointer -ffpe-trap=invalid,zero,overflow</span><br><br><span class="hljs-comment">#GNU10 = -fallow-argument-mismatch -fallow-invalid-boz</span><br><span class="hljs-comment">#FFLAGS = -mcmodel=medium -fpic -ffree-line-length-none $&#123;GNU10&#125; -fbacktrace -ggdb -fcheck=bounds,do,mem,pointer -ffpe-trap=invalid,zero,overflow</span><br><br><span class="hljs-comment">#GNU10 = #-fallow-argument-mismatch -fallow-invalid-boz</span><br><span class="hljs-comment">#FFLAGS = -ffree-line-length-none $&#123;GNU10&#125; #-fbacktrace -ggdb -fcheck=bounds,do,mem,pointer -ffpe-trap=invalid,zero,overflow</span><br><br><span class="hljs-comment">#--------------</span><br><span class="hljs-comment">#INTEL compiler</span><br><span class="hljs-comment">#--------------</span><br><span class="hljs-comment">#FC = ifort</span><br><span class="hljs-comment">#BUFR_LIB = -L/glade/u/home/hclin/extlib/intel -lbufr</span><br><span class="hljs-comment">#FFLAGS = -mcmodel medium # needed for intel error message &quot;failed to convert GOTPCREL relocation&quot;</span><br><span class="hljs-comment">#BUFR_LIB = -L/home/wpsze/mpas_jedi_tutorial/NCEPLIBS-bufr/build/lib -lbufr</span><br><span class="hljs-comment">#FFLAGS = -mcmodel medium # needed for intel error message &quot;failed to convert GOTPCREL relocation&quot; # -g -traceback -debug all -check all</span><br><br>LIBS = -L$(NETCDF)/lib -L$(NETCDFF)/lib -lnetcdff -lnetcdf <span class="hljs-variable">$&#123;BUFR_LIB&#125;</span><br>INCS = -I$(NETCDF)/include -I$(NETCDFF)/include<br></code></pre></td></tr></table></figure><h1 id="jedi-mpas-test-and-application-files">JEDI-MPAS Test and Application Files</h1><p>https://gdex.ucar.edu/dataset/147b_jcsda.html</p><p>JEDI-MPAS is the interface between the generic components of the Joint Effort for Data assimilation Integration (JEDI) system and the atmospheric core of the Model for Prediction Across Scales (MPAS). The JEDI software package is a unified, innovative data assimilation system for Earth System Prediction. Developed and distributed by UCPâ€™s Joint Center for Satellite Data Assimilation (JCSDA), JEDI is versatile and sophisticated enough for a variety of applications, from operational weather forecasting and atmospheric research on High Performance Computing (HPC), to learning the fundamentals of data assimilation by running idealized toy models on your laptop. The atmospheric component of MPAS is a non-hydrostatic model using an unstructured centroidal Voronoi mesh with smoothly varying resolution for global or regional domains. The primary development partners for MPAS are Los Alamos National Laboratory and the National Center for Atmospheric Research.</p><p>This data set provides example observation files, model backgrounds, and other input files needed to run a variety of JEDI-MPAS applications, including the comprehensive suite of unit tests and example activities that are described in online tutorials. This data set accompanies JEDI-MPAS, version 1.0.0, released 24 September 20.</p><blockquote><p>Wget shell script - Download all files using Wget, preferred for Linux.</p></blockquote><h1 id="specific-issue-cluster">Specific Issue (cluster)</h1><blockquote><p>git-lfs issue Ran patch() for krb5 &amp; error while opening "en_US.mo" for writing: Permission denied</p></blockquote><p>If copy whole <strong>mpas_bundle_v2</strong> (e.g. local PC) that includes <strong>build</strong> and <strong>code</strong> to workstation or cluster,</p><ol type="1"><li>if your workstation/cluster has spack-stack (for jedi-mpas)</li><li>remove build/CMakeCache.txt</li><li>remove build/_deps/mpas_data-subbuild/CMakeCache.txt</li><li>run $ cmake ../code</li><li>it will re-generate your curren config</li></ol><p>Reference error: <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">CMake Error: The current CMakeCache.txt directory /xxx/mpas_bundle_v2_temp/build/CMakeCache.txt is different than the directory /home/wpsze/mpas_bundle_v2/build <span class="hljs-built_in">where</span> CMakeCache.txt was created. This may result <span class="hljs-keyword">in</span> binaries being created <span class="hljs-keyword">in</span> the wrong place. If you are not sure, reedit the CMakeCache.txt<br>CMake Error: The <span class="hljs-built_in">source</span> <span class="hljs-string">&quot;/home/wpsze/MPAS/MPAS-MPAS-JEDI/DA-obs2ioda-EM/mpas_bundle_v2_temp/code/CMakeLists.txt&quot;</span> does not match the <span class="hljs-built_in">source</span> <span class="hljs-string">&quot;/home/wpsze/mpas_bundle_v2/code/CMakeLists.txt&quot;</span> used to generate cache.  Re-run cmake with a different <span class="hljs-built_in">source</span> directory.<br>CMake Error: The current CMakeCache.txt directory /xxx/mpas_bundle_v2_temp/build/_deps/mpas_data-subbuild/CMakeCache.txt is different than the directory /home/wpsze/mpas_bundle_v2/build/_deps/mpas_data-subbuild <span class="hljs-built_in">where</span> CMakeCache.txt was created. This may result <span class="hljs-keyword">in</span> binaries being created <span class="hljs-keyword">in</span> the wrong place. If you are not sure, reedit the CMakeCache.txt<br></code></pre></td></tr></table></figure></p><ol type="1"><li><p>config done <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">-- Configuring <span class="hljs-keyword">done</span><br>-- Generating <span class="hljs-keyword">done</span><br>-- Build files have been written to: /xxx/mpas_bundle_v2_temp/build<br></code></pre></td></tr></table></figure></p></li><li><p>make -j12 <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">[100%] Built target mpasjedi_variational.x<br></code></pre></td></tr></table></figure></p></li><li><p>cd mpas-jedi &amp; ctest <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs sh">74% tests passed, 12 tests failed out of 47<br><br>Label Time Summary:<br>executable    =  42.47 sec*proc (13 tests)<br>mpasjedi      = 680.81 sec*proc (47 tests)<br>mpi           = 672.80 sec*proc (43 tests)<br>script        = 638.33 sec*proc (34 tests)<br><br>Total Test time (real) = 683.12 sec<br><br>The following tests FAILED:<br> 23 - test_mpasjedi_parameters_bumpcov (Failed)<br> 24 - test_mpasjedi_parameters_bumploc (Failed)<br> 25 - test_mpasjedi_dirac_bumpcov (Failed)<br> 29 - test_mpasjedi_3dvar_bumpcov (Failed)<br> 35 - test_mpasjedi_3dhybrid_bumpcov_bumploc (Failed)<br> 39 - test_mpasjedi_eda_3dhybrid (Failed)<br> 41 - test_mpasjedi_letkf_3dloc_4pe (Failed)<br> 42 - test_mpasjedi_lgetkf_4pe (Failed)<br> 44 - test_mpasjedi_parameters_bumpcov_2pe (Failed)<br> 45 - test_mpasjedi_parameters_bumploc_2pe (Failed)<br> 46 - test_mpasjedi_3dvar_2pe (Failed)<br> 47 - test_mpasjedi_3dhybrid_bumpcov_bumploc_2pe (Failed)<br>Errors <span class="hljs-keyword">while</span> running CTest<br>Output from these tests are <span class="hljs-keyword">in</span>: /xxx/build/mpas-jedi/Testing/Temporary/LastTest.<span class="hljs-built_in">log</span><br>Use <span class="hljs-string">&quot;--rerun-failed --output-on-failure&quot;</span> to re-run the failed cases verbosely.<br></code></pre></td></tr></table></figure></p></li></ol><h1 id="if-git-lfs-exists">if git-lfs exists,</h1><p>Assume your workstation or cluster already has git-lfs, then may skip the error on it. Try below,</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">set</span> -v<br><span class="hljs-built_in">source</span> /home/wpsze/spack/share/spack/setup-env.sh<br><span class="hljs-built_in">source</span> /home/wpsze/spack-stack/spack-stack/setup.sh<br><br>spack stack create <span class="hljs-built_in">env</span> --site linux.default --name gcc_mpich<br><br>spack <span class="hljs-built_in">env</span> activate /home/wpsze/spack-stack/spack-stack/envs/gcc_mpich<br>spack add gcc@10.5.0<br>spack install<br>spack compiler add `spack location -i gcc@10.5.0`<br><br>spack add environment-modules%gcc@10.5.0 ecbuild%gcc@10.5.0 eigen%gcc@10.5.0 udunits%gcc@10.5.0 gsl-lite%gcc@10.5.0<br>spack add mpich%gcc@10.5.0<br>spack add hdf5%gcc@10.5.0^mpich parallelio%gcc@10.5.0^mpich <br><br><span class="hljs-comment"># Tried atlas v0.31.1 can make successful compilation. Newer version like 0.35.0 fails.</span><br>spack add ecmwf-atlas@0.31.1%gcc@10.5.0^mpich<br>spack install<br>spack module tcl refresh<br><span class="hljs-comment">#spack stack setup-meta-modules</span><br></code></pre></td></tr></table></figure><h1 id="module-load">module load</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-function"><span class="hljs-title">module</span></span> () &#123;<br>  <span class="hljs-built_in">eval</span> $(<span class="hljs-variable">$&#123;SPACK_ENV&#125;</span>/install/gcc/x.x.x/environment-modules-xxx/bin/modulecmd bash <span class="hljs-variable">$@</span>)<br>&#125;<br><br>module load xxx<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Spack</category>
      
    </categories>
    
    
    <tags>
      
      <tag>MPAS</tag>
      
      <tag>DA</tag>
      
      <tag>Spack</tag>
      
      <tag>Spack-Stack</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ecFlow -- Installation &amp; Usage</title>
    <link href="/2024/06/07/ecflow/"/>
    <url>/2024/06/07/ecflow/</url>
    
    <content type="html"><![CDATA[<h1 id="by-micromamba-recommend">By micromamba (Recommend)</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ micromamba create -n ecFlow<br>Empty environment created at prefix: /home/wpsze/micromamba/envs/ecFlow<br>$ micromamba activate ecFlow<br>|ecFlow|wpsze:/home/wpsze $ micromamba install ecflow -c conda-forge<br>|ecFlow|wpsze:/home/wpsze $ ecflow_client --version<br>Ecflow version(5.13.0) boost(1.84.0) compiler(gcc 12.3.0) protocol(JSON cereal 1.3.0) openssl(enabled) Compiled on Jun 20 2024 08:28:01<br><br> $ ecf*<br>ecflow_client        ecflow_http          ecflow_logsvr.pl     ecflow_standalone    ecflow_stop.sh       <br>ecflow_udp_client    ecflow_ui.x<br>ecflow_fuse.py       ecflow_logserver.sh  ecflow_server        <br>ecflow_start.sh      ecflow_udp           ecflow_ui<br></code></pre></td></tr></table></figure><p>and it installs,</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">+ libboost-python                  1.84.0  py312h389efb2_3      conda-forge      124kB<br>+ libboost-python-devel            1.84.0  py312h9cebb41_3      conda-forge       20kB<br>+ ecflow                           5.13.0  py312hc3ad225_0      conda-forge       17MB<br></code></pre></td></tr></table></figure><p>where boost is 1.84.0</p><h1 id="ecflow-quickstart">ecFlow Quickstart</h1><p><a href="https://confluence.ecmwf.int/display/ECFLOW/ecFlow+Quickstart">ecFlow Quickstart</a></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs sh"> $ ll ./ecflow_quickstart  <br>total 160K<br>drwxrwxr-x 3 wpsze wpsze  33K Jun  7 22:06 ./<br>drwxrwxr-x 3 wpsze wpsze  33K Jun  7 22:06 ../<br>-rw-rw-r-- 1 wpsze wpsze 2.4K Jun  7 17:51 ecflow_quickstart.tar.gz<br>-rw-r--r-- 1 wpsze wpsze 1.8K Nov  2  2022 head.h<br>-rw-r--r-- 1 wpsze wpsze  760 Nov  2  2022 instructions.txt<br>-rw-r--r-- 1 wpsze wpsze  209 Nov  1  2022 tail.h<br>drwxr-xr-x 2 wpsze wpsze  33K Nov  2  2022 <span class="hljs-built_in">test</span>/<br>-rw-r--r-- 1 wpsze wpsze  222 Nov  2  2022 test.def<br><br> $ ll <span class="hljs-built_in">test</span><br>total 165K<br>drwxr-xr-x 2 wpsze wpsze  33K Nov  2  2022 ./<br>drwxrwxr-x 3 wpsze wpsze  33K Jun  7 22:06 ../<br>-rw-r--r-- 1 wpsze wpsze  627 Nov  2  2022 t1.1<br>-rw-r--r-- 1 wpsze wpsze  877 Nov  2  2022 t1.2<br>-rw-r--r-- 1 wpsze wpsze  119 Nov  2  2022 t1.ecf<br>-rwxr-xr-x 1 wpsze wpsze 2.1K Nov  2  2022 t1.job1*<br>-rwxr-xr-x 1 wpsze wpsze 2.1K Nov  2  2022 t1.job2*<br>-rw-r--r-- 1 wpsze wpsze  627 Nov  2  2022 t2.1<br>-rw-r--r-- 1 wpsze wpsze  118 Nov  2  2022 t2.ecf<br>-rwxr-xr-x 1 wpsze wpsze 2.1K Nov  2  2022 t2.job1*<br><br> $ <span class="hljs-built_in">cat</span> <span class="hljs-built_in">test</span>/t1.ecf <br>%include <span class="hljs-string">&quot;../head.h&quot;</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;I, %ECF_NAME%, am part of a suite that lives in %ECF_HOME%&quot;</span><br><span class="hljs-built_in">sleep</span> 2<br><br>%include <span class="hljs-string">&quot;../tail.h&quot;</span><br><br> $ <span class="hljs-built_in">cat</span> <span class="hljs-built_in">test</span>/t2.ecf <br>%include <span class="hljs-string">&quot;../head.h&quot;</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;I, %ECF_NAME%, am part of a suite that lives in %ECF_HOME%&quot;</span><br><span class="hljs-built_in">sleep</span> 2<br><br>%include <span class="hljs-string">&quot;../tail.h&quot;</span><br></code></pre></td></tr></table></figure><h2 id="inspect-and-update-the-suite-definition">Inspect and update the suite definition</h2><p>The file <strong>test.def</strong> defines a suite called "test". Open this file in a text editor and note the structure.</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh">suite <span class="hljs-built_in">test</span><br>   edit ECF_HOME <span class="hljs-string">&quot;/replace/with/own/home/ecflow/quickstart&quot;</span><br>   task t1<br>   task t2<br>        trigger t1 eq complete<br>endsuite<br></code></pre></td></tr></table></figure><p>We define a suite called "test"; it defines a variable called <strong>ECF_HOME</strong>, then it defines two tasks <strong>("tasks" are things that actually run)</strong> and specifies that <strong>task t2 will be run as soon as task t1 has completed</strong>. The scripts corresponding to the tasks are specified in <strong>".ecf"</strong> files in the test directory. Have a look - they simply print some information about themselves, then sleep for 2 seconds.</p><p>The first thing you must do is to complete the path to your working directory in the <strong>ECF_HOME</strong> definition in test.def and save the file.</p><h2 id="start-an-ecflow-server">Start an ecFlow server</h2><p>We will start a <strong>new running instance of an ecFlow server using the default port (# start ecFlow with default port 3141)</strong>. It is possible to use a different port by <strong>adding --port=3500 (for example)</strong> to every ecFlow command-line action. Note also that we start it as a background task - it will run until the server is stopped. It can be run in the foreground, but in that case you will need to use a new terminal for any subsequent commands!</p><p>To start the ecflow server:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ ecflow_server &amp;<br>or<br>$ <span class="hljs-built_in">export</span> ECF_PORT=3141<br>$ ecflow_start.sh -d /home/wpsze/xxx -p <span class="hljs-variable">$ECF_PORT</span><br></code></pre></td></tr></table></figure><p><strong>make sure this port can be used</strong> {:.info}</p><h3 id="check-what-port-numbers-are-being-used">check what port numbers are being used</h3><h3 id="netstat--lnptu">netstat -lnptu</h3><p>You can check what port numbers are being used, with netstat: To list all open network ports on your machine, run <strong>netstat -lnptu</strong>. Here is a breakdown of the parameters:</p><p>l - List all listening ports n - Display the numeric IP addresses (i.e., don't do reverse DNS lookups p - List the process name that is attached to that port t - List all TCP connections u - List all UDP connections</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ netstat -lnptu<br>tcp        0      0 0.0.0.0:3141            0.0.0.0:*               LISTEN      169655/ecflow_serve<br></code></pre></td></tr></table></figure><p>Check that it is running:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ ecflow_client --ping --port=3141<br>ping server(localhost:3141) succeeded <span class="hljs-keyword">in</span> 00:00:00.034207  ~34 milliseconds<br></code></pre></td></tr></table></figure><p>or check</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"> $ ps -u wpsze -f | grep ecflow | grep -v grep<br>wpsze    3248171 3700943  0 14:26 pts/6    00:00:00 ecflow_server<br></code></pre></td></tr></table></figure><p>Please note <strong>â€œHostâ€</strong> and <strong>â€œPort Numberâ€</strong> here. Also note that each user must use a unique port number (we recommend using a random number between 2500 and 9999)</p><p>To stop the ecflow server:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">ecflow_stop.sh -p <span class="hljs-variable">$ECF_PORT</span><br></code></pre></td></tr></table></figure><p>e.g.</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sh"> $ ecflow_stop.sh -p 3141<br>Fri Jun 28 08:57:33 UTC 2024<br><br>User <span class="hljs-string">&quot;10004&quot;</span> attempting to stop ecf server on ip:3141<br><br>Checking <span class="hljs-keyword">if</span> the server is running on ip:3141<br>ping server(ip:3141) succeeded <span class="hljs-keyword">in</span> 00:00:00.011797  ~11 milliseconds<br><br>Halting, check pointing and terminating the server<br>[1]+  Done                    ecflow_server<br></code></pre></td></tr></table></figure><p>and then,</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ ps -u wpsze -f | grep ecflow | grep -v grep<br></code></pre></td></tr></table></figure><p>has shown nothing now.</p><h2 id="load-your-suite-definition-into-the-server">Load your suite definition into the server **</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ ecflow_client --load=test.def --port=3141<br></code></pre></td></tr></table></figure><p>More, <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh">ecflow_client --<span class="hljs-built_in">help</span><br>ecflow_client --load=/my/home/fred.def<br>ecflow_client --load=/my/home/exotic.def            <span class="hljs-comment"># will error if suites of same name exists</span><br>ecflow_client --load=/my/home/exotic.def force      <span class="hljs-comment"># overwrite suite&#x27;s of same name in the server</span><br>ecflow_client --load=/my/home/exotic.def check_only <span class="hljs-comment"># Just check, don&#x27;t send to server</span><br>ecflow_client --load=/my/home/exotic.def stats      <span class="hljs-comment"># Show defs statistics, don&#x27;t send to server</span><br>ecflow_client --load=host1.3141.check               <span class="hljs-comment"># Load checkpoint file to the server</span><br>ecflow_client --load=host1.3141.check <span class="hljs-built_in">print</span>         <span class="hljs-comment"># print definition to standard out in defs format</span><br></code></pre></td></tr></table></figure></p><p>Check that it is loaded by asking the server to give you back the suite definition:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ ecflow_client --get --port=3141<br><span class="hljs-comment">#5.11.4</span><br>suite <span class="hljs-built_in">test</span><br>  edit ECF_HOME <span class="hljs-string">&#x27;/home/wpsze/ecflow/ecflow_quickstart/&#x27;</span><br>  task t1<br>  task t2<br>    trigger t1 eq complete<br>endsuite<br><span class="hljs-comment"># enddef</span><br></code></pre></td></tr></table></figure><h2 id="monitor-and-interact-via-the-gui">Monitor and interact via the GUI</h2><h3 id="start-ecflowui-local-pc">Start ecFlowUI: (Local PC)</h3><p>When opening the ecflow GUI flow for the first time you will need to add your server to the GUI. In the GUI click on <strong>â€œServersâ€ and then â€œManage serversâ€</strong>. A new window will appear. Click on <strong>â€œAdd serverâ€. Here you need to add the Name, Host, and Port of your server</strong>. For â€œHostâ€ and â€œPortâ€ please refer to the last section of output from the previous step.</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ ecflow_ui &amp;<br></code></pre></td></tr></table></figure><h3 id="ssh-tunnel">ssh tunnel</h3><p>SSH tunneling, or SSH port forwarding, is a method of transporting arbitrary data over an encrypted SSH connection. SSH tunnels allow connections made to a local port (that is, to a port on your own desktop) to be forwarded to a remote machine via a secure channel.</p><p>on local PC terminal, <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ ssh -L 9090:localhost:3141 server.ip<br>$ ssh -NL 9090:localhost:3141 server.ip<br></code></pre></td></tr></table></figure> where local PC's port 9090 to server.ip's port 3141</p><p>and you can set ecflow_ui config, - host=localhost - port=local PC's port 9090</p><h3 id="ecflowui-has-started">ecFlowUI has started</h3><p>Once ecFlowUI has started, you must tell it how to reach your server. Go to the</p><p>Servers â†’ Manage Servers menu, click "Add server", then enter the details of your server. Name can be anything you want - it's for you to identify the server to your self; something like "localtest" would be fine here. Host should in this case be "localhost", and Port should be XXX. The other fields can be left blank, but keep the "Add server to current view" box ticked.</p><p>You should now see your suite loaded into the GUI! To make the server active, right-click on the top-level node representing the server ("localtest in our case) and choose <strong>"Restart"</strong>. Now right-click on the "test" node and <strong>choose "Begin"</strong> to make the suite active. The default behaviour is to only refresh its view of the suite every 60 seconds, so you will need to click the green refresh button at the top every so often to see the progress of the tasks.</p><figure><img src="https://confluence.ecmwf.int/download/attachments/52464709/worddavd23273b6552a14558257676bb73f41be.png?version=1&amp;modificationDate=1448363109499&amp;api=v2" alt="ecflow-ui_Task" /><figcaption>ecflow-ui_Task</figcaption></figure><p>The diagram shows the typical status changes for a Task.</p><h2 id="start">Start</h2><p>At this time, the service is stopped and needs to be started manually.</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-variable">$ecflow_client</span> --begin --host=login05 --port=3141<br></code></pre></td></tr></table></figure><p>Since no triggering mechanism is added, t1 will be executed immediately after the service starts.</p><h2 id="replace-suite">Replace suite</h2><p>Replace the entire suite, <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">ecflow_client --replace=/test test.def --port=3141<br></code></pre></td></tr></table></figure></p><h2 id="check-the-status-of-the-server">check the status of the server</h2><p>To check the status of the server, enter the following unix command <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh">ecflow_client --host=login05 --port=3141 --stats<br>Server statistics<br>   Version                         Ecflow version(5.13.0) boost(1.84.0) compiler(gcc 12.3.0) protocol(JSON cereal 1.3.0) openssl(enabled) Compiled on Jun 20 2024 08:28:01<br>   Status                          RUNNING<br>   Host                            xxx.com<br>   Port                            3141<br>   Up since                        2024-Jul-02 23:44:29<br>......<br></code></pre></td></tr></table></figure> If ecflow_server is in <strong>halted state</strong>, the server needs to be restarted.</p><h2 id="ecflow-variables">ecFlow variables</h2><p><a href="https://confluence.ecmwf.int/display/ECFLOW/ecFlow++variables">ecFlow variables</a></p><blockquote><p>ECF_HOME ECF_INCLUDE ECF_FILES</p></blockquote><h2 id="execute-rerun-requeue">Execute, rerun, requeue</h2><p>In ecflow_ui, it is important to understand the distinction between execute, rerun and re-queue.</p><p>These options are available with the right mouse button over a task.</p><blockquote><p><strong>Execute</strong>: This means run the task immediately. (Hence ignores any dependency that holds the task).</p></blockquote><p>This option preserves the previous output, from the job. You should see output files t1.1, t1.2, t1.3, each time the task is run.</p><blockquote><p><strong>Rerun</strong>: This places the task, back into the queued state.</p></blockquote><p>The task will now honour any dependencies that would hold the job. i.e. time dependencies, limits, triggers, suspend, etc. (You will be introduced to these terms later on in the tutorial) If the task does run, the previous output is preserved.</p><blockquote><p><strong>Re-queue</strong>: This resets the task back to the queued state.</p></blockquote><p>If the task has a default status, this is applied. The task output number is reset, such that the next output will be written to t1.1. This will overwrite any existing output with that extension when the task runs. Any subsequent calls to execute or rerun will now overwrite the output files, t1.2,t1.3 etc.</p><h2 id="add-description">Add description</h2><p>The manual page makes the documentation in the <strong>ecf script</strong> visible in ecflow_ui.</p><p>The description page is the combination of all the text before the directives <strong>%manual</strong> and <strong>%end</strong>. (or create <strong>f1.man</strong>)</p><p>e.g. edit t2.ecf <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sh">%manual<br>   Manual <span class="hljs-keyword">for</span> task t2<br>   Operations: <span class="hljs-keyword">if</span> this task fails, <span class="hljs-built_in">set</span> it to complete and report next working day<br>   Analyst:    Check something ?<br>%end<br> <br>%include &lt;head.h&gt;<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;I am part of a suite that lives in %ECF_HOME%&quot;</span><br>%include &lt;tail.h&gt;<br> <br>%manual<br>   There can be multiple manual pages <span class="hljs-keyword">in</span> the same file.<br>   When viewed they are simply concatenated.<br>%end<br></code></pre></td></tr></table></figure></p><h2 id="familys">familys</h2><p>Tasks can be organized into a tree structure similar to a Unix file system, where <strong>task is like a file</strong> and <strong>family is like a folder</strong>.</p><p>A suite is a family with additional properties (see Dates). <strong>family</strong> can contain other families. Similar to directories, tasks in different families can have the same name.</p><p>Unless a file location is specified, ecFlow assumes that the structure of the suite corresponds to the location of the task file in the file system.</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># Definition of the suite test.</span><br> suite <span class="hljs-built_in">test</span><br>   edit ECF_INCLUDE <span class="hljs-string">&quot;<span class="hljs-variable">$ECF_HOME</span>/course&quot;</span>  <span class="hljs-comment"># replace &#x27;$ECF_HOME&#x27; with the path to your ECF_HOME directory</span><br>   edit ECF_HOME    <span class="hljs-string">&quot;<span class="hljs-variable">$ECF_HOME</span>/course&quot;</span><br>   family f1<br>      task t1<br>      task t2<br>   endfamily<br>endsuite<br></code></pre></td></tr></table></figure><h2 id="time-dependencies">Time Dependencies</h2><p><a href="https://confluence.ecmwf.int/display/ECFLOW/Time+Dependencies">Time Dependencies</a></p><h2 id="time-triggers">Time Triggers</h2><p><a href="https://confluence.ecmwf.int/display/ECFLOW/Time+Triggers">Time Triggers</a></p><h2 id="add-a-cron">Add a Cron</h2><p><a href="https://confluence.ecmwf.int/display/ECFLOW/Add+a+Cron">Add a Cron</a></p><h2 id="repeat-repeat">Repeat *** <a href="https://confluence.ecmwf.int/display/ECFLOW/Repeat">Repeat</a></h2><p>It is sometimes useful to repeat the same task or family several times, looping on a specific value. You can do that by defining a repeat attribute. You can iterate over sequences of:</p><ul><li>strings</li><li>integers</li><li>dates</li></ul><p>A sequence of integers or dates is created by specifying the first and the last element, with an optional increment (the default is one).</p><p>From <strong>ecflow5 we can also loop over an arbitrary list of dates</strong>. <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">repeat datelist YMD 20130101 20130102 20130103 20200101 20190101<br>repeat <span class="hljs-built_in">date</span> YMD 20090331 20121212 1  <span class="hljs-comment"># &lt;start&gt; &lt;end&gt; &lt;increment&gt;</span><br></code></pre></td></tr></table></figure></p><blockquote><p>The following generated variables, are accessible for trigger expressions YMD, YMD_YYYY, YMD_MM, YMD_DD, YMD_DOW,YMD_JULIAN</p></blockquote><p>e.g. <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs sh"><br><span class="hljs-comment"># Definition of the suite test.</span><br>suite <span class="hljs-built_in">test</span><br> edit ECF_INCLUDE <span class="hljs-string">&quot;<span class="hljs-variable">$HOME</span>/course&quot;</span><br> edit ECF_HOME    <span class="hljs-string">&quot;<span class="hljs-variable">$HOME</span>/course&quot;</span><br> family f4<br>     edit SLEEP 2<br>     repeat string NAME a b c d e f<br>     family f5<br>         repeat <span class="hljs-built_in">integer</span> VALUE 1 10<br>         task t1<br>             repeat <span class="hljs-built_in">date</span> DATE 20101230 20110105<br>             label info <span class="hljs-string">&quot;&quot;</span><br>             label <span class="hljs-built_in">date</span> <span class="hljs-string">&quot;&quot;</span><br>     endfamily<br> endfamily<br>endsuite<br></code></pre></td></tr></table></figure></p><p><a href="https://confluence.ecmwf.int/display/ECFLOW/Glossary#term-trigger">repeat &amp; trigger</a></p><p>When we use relative time attributes under a Repeat. They are automatically reset when the repeat loops. Take for example: <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sh">suite <span class="hljs-built_in">test</span><br> edit ECF_HOME    <span class="hljs-string">&quot;<span class="hljs-variable">$HOME</span>/course&quot;</span><br> edit ECF_INCLUDE <span class="hljs-string">&quot;<span class="hljs-variable">$HOME</span>/course&quot;</span><br> edit ECF_FILES <span class="hljs-string">&quot;<span class="hljs-variable">$HOME</span>/course&quot;</span><br>  family hc00<br>    repeat <span class="hljs-built_in">integer</span> HYEAR 1993 2017<br>    task t1<br>    task t2<br>      trigger t1  == complete<br>  endfamily<br>endsuite<br></code></pre></td></tr></table></figure></p><p><strong>Repeat increment</strong></p><p>A repeat under a family node will only increment when all the child nodes are complete.</p><p>In the example above, <strong>once task t1, and t2 are complete</strong>, the repeat integer rep will increment to the next value.</p><h2 id="with-sbatch">with SBATCH</h2><p>sbatch.h <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c++">#SBATCH --qos=%QUEUE%<br>#SBATCH --job-name=%TASK%_%FAMILY1:NOT_DEF%<br>#SBATCH --account=%ACCOUNT%<br>#SBATCH --output=%ECF_JOBOUT%<br>#SBATCH --error=%ECF_JOBOUT%<br>#SBATCH --time=%RQ_TIME%<br></code></pre></td></tr></table></figure></p><h1 id="references">References</h1><ol type="1"><li><a href="https://perillaroc.github.io/ecflow-tutorial-cn/chap01/">ECFLOWæ•™ç¨‹ 2018</a></li><li><strong><a href="https://cemc-ecflow-tutorial-2023.readthedocs.io/zh-cn/latest/">CEMC ecFlow å®æˆ˜æ•™ç¨‹ æœ¬æ•™ç¨‹ç”¨äº CEMC 2023 åŸ¹è®­çš„ ecFlow ä¸Šæœºå®ä¹ ç¯èŠ‚</a></strong></li><li><a href="https://confluence.ecmwf.int/display/ECFLOW/Conda-forge">The latest ecflow is available for Linux and macOS from conda forge</a></li><li><a href="https://git.ecmwf.int/projects/USS">https://git.ecmwf.int/projects/USS</a></li><li><a href="https://confluence.ecmwf.int/display/UDOC/HPC2020%3A+Using+ecFlow">HPC2020: Using ecFlow</a></li><li><a href="http://qxkj.ijournals.cn/qxkj/article/abstract/20190122">åŸºäºECFLOWå®ç°åä¸­åŒºåŸŸå¿«é€Ÿæ›´æ–°-åŒåŒ–é¢„æŠ¥ä¸šåŠ¡æµç¨‹</a></li><li><a href="https://mp.weixin.qq.com/s/d17lDCd7f2_hS0S4E1mgTg">ecFlowå­¦ä¹ ç¬”è®°ï¼šç¼–è¯‘V5.Xç‰ˆæœ¬</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>MPAS</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Installation</tag>
      
      <tag>Micromamba</tag>
      
      <tag>Spack</tag>
      
      <tag>ecFlow</tag>
      
      <tag>Conda</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Spack</title>
    <link href="/2024/06/07/spack/"/>
    <url>/2024/06/07/spack/</url>
    
    <content type="html"><![CDATA[<h1 id="spack">Spack</h1><p>Spack is a package management tool designed to support multiple versions and configurations of software on a wide variety of platforms and environments. It was designed for large supercomputing centers, where many users and application teams share common installations of software on clusters with exotic architectures, using libraries that do not have a standard ABI. Spack is non-destructive: installing a new version does not break existing installations, so many configurations can coexist on the same system. Most importantly, Spack is simple. It offers a simple spec syntax so that users can specify versions and configuration options concisely. Spack is also simple for package authors: package files are written in pure Python, and specs allow package authors to maintain a single file for many different builds of the same package.</p><p><a href="https://spack.readthedocs.io/en/latest/" class="uri">https://spack.readthedocs.io/en/latest/</a></p><h2 id="search-packages-online">Search packages online</h2><blockquote><p><a href="https://packages.spack.io/" class="uri">https://packages.spack.io/</a></p></blockquote><h1 id="installation">Installation</h1><p>Getting Spack is easy. You can clone it from the github repository using this command:</p><p>git clone -c feature.manyFiles=true https://github.com/spack/spack.git {:.info}</p><p>This will create a directory called spack.</p><p>Once you have cloned Spack, we recommend sourcing the appropriate script for your shell:</p><p>. spack/share/spack/setup-env.sh {:.info}</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh">For bash/zsh/sh<br>. spack/share/spack/setup-env.sh<br>(add into .bashrc)<br>For tcsh/csh<br><span class="hljs-built_in">source</span> spack/share/spack/setup-env.csh<br></code></pre></td></tr></table></figure><p>Sourcing these files will put the spack command in your PATH, set up your MODULEPATH to use Spackâ€™s packages, and add other useful shell integration for certain commands, environments, and modules. For bash and zsh, it also sets up tab completion.</p><ul><li>spack env create yourEnvironmentName</li><li>spack env activate yourEnvironmentName</li><li>spack env list # You can see a list of your available environments</li><li>spack env status # you can see which environment you are currently<br /></li><li>spack env deactivate</li><li>spack find # to see what packages are installed in the current environment</li><li>spack add python@3.10</li><li>spack add compilerName@compilerVersion</li><li>spack install --add xxx</li><li>compilerPath=$(spack location -i compilerName@compilerVersion)</li><li>spack add python@3.10%gcc@9.5.0 # As a general rule, you should use the same compiler for installing all of your packages within an environment</li><li>spack env remove yourEnvironmentName</li></ul><h1 id="compiler-configuration">Compiler configuration</h1><p>Spack has the ability to build packages with multiple compilers and compiler versions. Compilers can be made available to Spack by specifying them manually in <strong>compilers.yaml</strong> or <strong>packages.yaml</strong>, or automatically by running spack compiler find, but for convenience Spack will automatically detect compilers the first time it needs them.</p><p>You can see which compilers are available to Spack by running</p><p>spack compilers or spack compiler list {:.info}</p><blockquote><p>Any of these compilers can be used to build Spack packages.</p></blockquote><p>spack compiler add {:.info}</p><p>An alias for <strong>spack compiler find</strong>.</p><p>spack compiler find {:.info}</p><p>Lists the compilers currently available to Spack. If you do not see a compiler in this list, but you want to use it with Spack, you can simply run spack compiler find with the path to where the compiler is installed. For example:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ spack compiler find /usr/local/tools/ic-13.0.079<br>==&gt; Added 1 new compiler to ~/.spack/linux/compilers.yaml<br>    intel@13.0.079<br></code></pre></td></tr></table></figure><p>Or you can run spack compiler find with no arguments to force auto-detection. This is useful if you do not know where compilers are installed, but you know that new compilers have been added to your PATH. For example, you might load a module, like this:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ module load gcc/4.9.0<br>$ spack compiler find<br>==&gt; Added 1 new compiler to ~/.spack/linux/compilers.yaml<br>    gcc@4.9.0<br></code></pre></td></tr></table></figure><p>This loads the environment module for gcc-4.9.0 to add it to PATH, and then it adds the compiler to Spack.</p><p>spack compiler info {:.info}</p><p>If you want to see specifics on a particular compiler, you can run spack compiler info on it:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ spack compiler info intel@15<br>intel@15.0.0:<br>  paths:<br>    cc  = /usr/local/bin/icc-15.0.090<br>    cxx = /usr/local/bin/icpc-15.0.090<br>    f77 = /usr/local/bin/ifort-15.0.090<br>    <span class="hljs-built_in">fc</span>  = /usr/local/bin/ifort-15.0.090<br>  modules = []<br>  operating_system = centos6<br></code></pre></td></tr></table></figure><p>This shows which C, C++, and Fortran compilers were detected by Spack. Notice also that we didnâ€™t have to be too specific about the version. We just said intel@15, and information about the only matching Intel compiler was displayed.</p><h2 id="manual-compiler-configuration">Manual compiler configuration</h2><p>If auto-detection fails, you can manually configure a compiler by editing your <strong>~/.spack/<platform>/compilers.yaml file</strong>. You can do this by running <strong>spack config edit compilers</strong>, which will open the file in your favorite editor.</p><h2 id="build-your-own-compiler">Build Your Own Compiler</h2><p>If you are particular about which compiler/version you use, you might wish to have Spack build it for you. For example:</p><blockquote><p>$ spack install gcc@4.9.3</p></blockquote><p>Once that has finished, you will need to add it to your <strong>compilers.yaml</strong> file.</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">spack add gcc@4.9.3<br>spack install<br>spack compiler add `spack location -i gcc@4.9.3`<br></code></pre></td></tr></table></figure><p>You can then set Spack to use it by default by adding the following to your packages.yaml file:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">packages:<br>  all:<br>    compiler: [gcc@4.9.3]<br></code></pre></td></tr></table></figure><h1 id="specs-dependencies">Specs &amp; dependencies</h1><p>We know that <strong>spack install</strong>, <strong>spack uninstall</strong>, and other commands take a package name with an optional version specifier. In Spack, that descriptor is called a spec. Spack uses specs to refer to a particular build configuration (or configurations) of a package. Specs are more than a package name and a version; you can use them to specify the compiler, compiler version, architecture, compile options, and dependency options for a build. In this section, weâ€™ll go over the full syntax of specs.</p><p>Here is an example of a much longer spec than weâ€™ve seen thus far:</p><blockquote><p>mpileaks <span class="citation" data-cites="1.2:1.4">@1.2:1.4</span> %gcc@4.7.5 +debug -qt target=x86_64 ^callpath <span class="citation" data-cites="1.1">@1.1</span> %gcc@4.7.2</p></blockquote><p>If provided to spack install, this will install the mpileaks library at <strong>some version between 1.2 and 1.4 (inclusive)</strong>, built using <strong>gcc at version 4.7.5</strong> for a generic x86_64 architecture, with <strong>debug options enabled</strong>, and <strong>without Qt support</strong>. Additionally, it says to link it with the <strong>callpath library (which it depends on)</strong>, and to <strong>build callpath with gcc 4.7.2</strong>. Most specs will not be as complicated as this one, but this is a good example of what is possible with specs.</p><p>More formally, a spec consists of the following pieces:</p><ul><li>Package name identifier (mpileaks above)</li><li>@ Optional version specifier (<span class="citation" data-cites="1.2:1.4">@1.2:1.4</span>)</li><li>% Optional compiler specifier, with an optional compiler version (gcc or gcc@4.7.3)</li><li>+ or - or ~ Optional variant specifiers (+debug, -qt, or ~qt) for boolean variants. Use ++ or -- or ~~ to propagate variants through the dependencies (++debug, --qt, or ~~qt).</li><li>name=<value> Optional variant specifiers that are not restricted to boolean variants. Use name==<value> to propagate variant through the dependencies.</li><li>name=<value> Optional compiler flag specifiers. Valid flag names are cflags, cxxflags, fflags, cppflags, ldflags, and ldlibs. Use name==<value> to propagate compiler flags through the dependencies.</li><li>target=&lt;value&gt; os=&lt;value&gt; Optional architecture specifier (target=haswell os=CNL10)</li><li>^ Dependency specs (^callpath@1.1)</li></ul><p>å¥—ä»¶è¡¨ç¤ºæ³• @ é–‹é ­è¡¨ç¤ºç‰ˆæœ¬è™Ÿ % é–‹é ­è¡¨ç¤ºç·¨è­¯å™¨ ^ é–‹é ­è¡¨ç¤ºä¾è³´é …</p><h1 id="spack-load">Spack load</h1><p>There are several different ways to use Spack packages once you have installed them. As youâ€™ve seen, spack packages are installed into long paths with hashes, and you need a way to get them into your path. The easiest way is to use <strong>spack load</strong>, which is described in this section.</p><blockquote><p>spack load mpich %gcc@4.4.7</p></blockquote><h1 id="slurm">Slurm</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/sh</span><br><span class="hljs-comment"># This file is called submit-script.sh</span><br><span class="hljs-comment">#SBATCH --partition=shared       # default &quot;shared&quot;, if not specified</span><br><span class="hljs-comment">#SBATCH --time=0-04:30:00        # run time in days-hh:mm:ss</span><br><span class="hljs-comment">#SBATCH --nodes=1                # require 1 nodes</span><br><span class="hljs-comment">#SBATCH --ntasks-per-node=64     # cpus per node (by default, &quot;ntasks&quot;=&quot;cpus&quot;)</span><br><span class="hljs-comment">#SBATCH --mem-per-cpu=4000       # RAM per node in megabytes</span><br><span class="hljs-comment">#SBATCH --error=job.%J.err</span><br><span class="hljs-comment">#SBATCH --output=job.%J.out</span><br><span class="hljs-comment"># v---Remember to activate your Spack environment!! </span><br>spack <span class="hljs-built_in">env</span> activate yourEnvironmentName<br>srun --mpi=pmix -n 64 /home/username/mpiprogram<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Spack</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Spack</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>WRF | WRF uses Pnetcdf</title>
    <link href="/2024/06/05/WRF-install-pnetcdf/"/>
    <url>/2024/06/05/WRF-install-pnetcdf/</url>
    
    <content type="html"><![CDATA[<h1 id="issue">Issue</h1><p>To Be Tested.</p><h1 id="remark">Remark</h1><ol type="1"><li><p><a href="https://forum.mmm.ucar.edu/threads/parallel-netcdf4-i-o-support-as-opposed-to-pnetcdf.9509/">Parallel Netcdf4 I/O support (as opposed to pnetcdf)</a> &gt; Unfortunately the WRF model is not capable of using parallel I/O. If you are using netCDF-4, you must install it without activating parallel I/O based on HDF5. It is possible to use compression with netcdf-4 and HDF5 (without parallel I/O). See this page for details: https://www2.mmm.ucar.edu/wrf/users/building_netcdf4.html</p></li><li><a href="http://climate-cms.wikis.unsw.edu.au/WRF_Build_with_Parallel_NetCDF_Support">WRF Build with Parallel NetCDF Support</a></li></ol><ul><li>export PNETCDF=/projects/WRF/parallel-netcdf/xxx/ (BASH)</li><li>Configure namelist to use pNetCDF</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sh">In the namelist.input, the following settings support pNetCDF by setting value to 11:<br><br>io_form_boundary<br><br>io_form_history<br><br>io_form_auxinput2<br><br>io_form_auxhist2<br><br>Note that you need <span class="hljs-built_in">set</span> nocolons = .<span class="hljs-literal">true</span>. <span class="hljs-keyword">in</span> the section &amp;time_control of namelist.input<br></code></pre></td></tr></table></figure><ul><li><p>With pNetCDF support:</p><ul><li>Timing for Writing wrfout_d03_2010-02-06_01_00_00 for domain 3: 77.62950 elapsed seconds. Timing for Writing wrfout_d03_2010-02-06_02_00_00 for domain 3: 75.74540 elapsed seconds. Timing for Writing wrfout_d03_2010-02-06_03_00_00 for domain 3: 80.26440 elapsed seconds.</li></ul></li><li>Without pNetCDF support:<ul><li>Timing for Writing wrfout_d03_2010-02-06_01:00:00 for domain 3: 315.81271 elapsed seconds. Timing for Writing wrfout_d03_2010-02-06_02:00:00 for domain 3: 299.80011 elapsed seconds. Timing for Writing wrfout_d03_2010-02-06_03:00:00 for domain 3: 307.18109 elapsed seconds.</li></ul></li></ul>]]></content>
    
    
    <categories>
      
      <category>WRF</category>
      
    </categories>
    
    
    <tags>
      
      <tag>WRF</tag>
      
      <tag>Installation</tag>
      
      <tag>Pnetcdf</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ssh setup</title>
    <link href="/2024/06/05/ssh/"/>
    <url>/2024/06/05/ssh/</url>
    
    <content type="html"><![CDATA[<p><a href="https://en.wikipedia.org/wiki/Secure_Shell">The Secure Shell Protocol (SSH)</a> is a cryptographic network protocol for operating network services securely over an unsecured network. Its most notable applications are remote login and command-line execution.</p><p>SSH was designed for Unix-like operating systems as a replacement for Telnet and unsecured remote Unix shell protocols, such as the Berkeley Remote Shell (rsh) and the related rlogin and rexec protocols, which all use insecure, plaintext methods of authentication, like passwords.</p><p>å®‰å…¨å¤–æ®¼å”å®šï¼ˆSecure Shell Protocolï¼Œç°¡ç¨±SSHï¼‰æ˜¯ä¸€ç¨®åŠ å¯†çš„ç¶²è·¯å‚³è¼¸å”å®šï¼Œå¯åœ¨ä¸å®‰å…¨çš„ç¶²è·¯ä¸­ç‚ºç¶²è·¯æœå‹™æä¾›å®‰å…¨çš„å‚³è¼¸ç’°å¢ƒ[1]ã€‚SSHé€šéåœ¨ç¶²è·¯ä¸­å»ºç«‹å®‰å…¨éš§é“ä¾†å¯¦ç¾SSHå®¢æˆ¶ç«¯èˆ‡ä¼ºæœå™¨ä¹‹é–“çš„é€£ç·š[2]ã€‚SSHæœ€å¸¸è¦‹çš„ç”¨é€”æ˜¯é ç«¯ç™»å…¥ç³»çµ±ï¼Œäººå€‘é€šå¸¸åˆ©ç”¨SSHä¾†å‚³è¼¸å‘½ä»¤åˆ—ä»‹é¢å’Œé ç«¯åŸ·è¡Œå‘½ä»¤ã€‚SSHä½¿ç”¨é »ç‡æœ€é«˜çš„å ´åˆæ˜¯é¡Unixç³»çµ±ï¼Œä½†æ˜¯Windowsä½œæ¥­ç³»çµ±ä¹Ÿèƒ½æœ‰é™åº¦åœ°ä½¿ç”¨SSHã€‚2015å¹´ï¼Œå¾®è»Ÿå®£å¸ƒå°‡åœ¨æœªä¾†çš„ä½œæ¥­ç³»çµ±ä¸­æä¾›åŸç”ŸSSHå”å®šæ”¯æ´[3]ï¼ŒWindows 10 1803ç‰ˆæœ¬å·²æä¾›OpenSSHå·¥å…·</p><h1 id="generate-a-key-pair">Generate a key pair</h1><p>In you local PC,</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ ssh-keygen<br>or<br>$ ssh-keygen -t rsa<br></code></pre></td></tr></table></figure><p>where -t rsa option specifies that the type of the key should be RSA. Other choices include DSA, ECDSA, and ED25519. Select the protocol your SSH connection will use.</p><p>and id_rsa/id_rsa.pub are generated on .ssh.</p><ul><li>id_rsa contains the private key.</li><li>id_rsa.pub contains the public key.</li></ul><h1 id="id_rsa.pub">id_rsa.pub</h1><p>Copy id_rsa.pub to remote machine .ssh/authorized_keys</p><h1 id="ssh-login-without-password">ssh login without password</h1><p>In your SSH session with the remote machine, update the permissions of the .ssh directory and authorized_keys file in case they need it:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ <span class="hljs-built_in">chmod</span> 700 ~/.ssh<br>$ <span class="hljs-built_in">chmod</span> 600 ~/.ssh/authorized_keys<br></code></pre></td></tr></table></figure><p>Now, close your connection and your Terminal or Command Prompt. When you reopen it and try to connect to the remote server again from the client where you have your private key saved, you should receive a request to enter the passphrase instead of your username and password.</p><p>Reference: 1. <a href="https://www.strongdm.com/blog/ssh-passwordless-login">How to Set Up SSH Passwordless Login (Step-by-Step Tutorial)</a></p>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ssh</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MPAS | use_mp_re/config_microp_re -- use effective radii computed in mp schemes in RRTMG</title>
    <link href="/2024/06/04/MPAS_config_microp_re/"/>
    <url>/2024/06/04/MPAS_config_microp_re/</url>
    
    <content type="html"><![CDATA[<h1 id="in-wrf">In WRF,</h1><p>WRF Model Version 3.8: UPDATES</p><p>Add a new namelist, use_mp_re, to control the interaction between effective radii computed in some microphysics with RRTMG radiation. {:.info}</p><p>use_mp_re = 1 ! whether to use effective radii computed in mp schemes in RRTMG - 0: do not use; - 1: use effective radii - (The mp schemes that compute effective radii are 3,4,6,7,8,10,14,16,18,24,26,28,50-53,55)</p><h1 id="in-mpas-version-7.0">In MPAS Version 7.0,</h1><p>A fix for the communication of effective radii between the WSM6 and RRTMG schemes when config_microp_re=true. {:.info}</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">var</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;re_cloud&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;real&quot;</span> <span class="hljs-attr">dimensions</span>=<span class="hljs-string">&quot;nVertLevels nCells Time&quot;</span> <span class="hljs-attr">units</span>=<span class="hljs-string">&quot;m&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">description</span>=<span class="hljs-string">&quot;effective radius of cloud water droplets&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">packages</span>=<span class="hljs-string">&quot;mp_thompson_in;mp_wsm6_in&quot;</span>/&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">var</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;re_ice&quot;</span>  <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;real&quot;</span> <span class="hljs-attr">dimensions</span>=<span class="hljs-string">&quot;nVertLevels nCells Time&quot;</span>  <span class="hljs-attr">units</span>=<span class="hljs-string">&quot;m&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">description</span>=<span class="hljs-string">&quot;effective radius of cloud ice crystals&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">packages</span>=<span class="hljs-string">&quot;mp_thompson_in;mp_wsm6_in&quot;</span>/&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">var</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;re_snow&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;real&quot;</span> <span class="hljs-attr">dimensions</span>=<span class="hljs-string">&quot;nVertLevels nCells Time&quot;</span>  <span class="hljs-attr">units</span>=<span class="hljs-string">&quot;m&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">description</span>=<span class="hljs-string">&quot;effective radius of snow crystals&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">packages</span>=<span class="hljs-string">&quot;mp_thompson_in;mp_wsm6_in&quot;</span>/&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">var</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;rre_cloud&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;real&quot;</span> <span class="hljs-attr">dimensions</span>=<span class="hljs-string">&quot;nVertLevels nCells Time&quot;</span> <span class="hljs-attr">units</span>=<span class="hljs-string">&quot;microns&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">description</span>=<span class="hljs-string">&quot;effective radius of cloud water droplets calculated in RRTMG radiation&quot;</span>/&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">var</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;rre_ice&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;real&quot;</span> <span class="hljs-attr">dimensions</span>=<span class="hljs-string">&quot;nVertLevels nCells Time&quot;</span> <span class="hljs-attr">units</span>=<span class="hljs-string">&quot;microns&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">description</span>=<span class="hljs-string">&quot;effective radius of cloud ice crystals calculated in RRTMG radiation&quot;</span>/&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">var</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;rre_snow&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;real&quot;</span> <span class="hljs-attr">dimensions</span>=<span class="hljs-string">&quot;nVertLevels nCells Time&quot;</span> <span class="hljs-attr">units</span>=<span class="hljs-string">&quot;microns&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">description</span>=<span class="hljs-string">&quot;effective radius of snow crystals calculated in RRTMG radiation&quot;</span>/&gt;</span><br></code></pre></td></tr></table></figure><h1 id="references">References</h1><p>1.<a href="https://www2.mmm.ucar.edu/wrf/users/workshops/WS2022/full_presentations/session4.wong.pdf">Comparison of WRF and Regional MPAS: Ensuring Consistent Physics Configurations, 2022</a></p><h1 id="papers">Papers</h1><ol type="1"><li><ol start="1994" type="1"><li>Kiehl, J. T. <a href="https://agupubs.onlinelibrary.wiley.com/doi/abs/10.1029/94JD01117">Sensitivity of a GCM climate simulation to differences in continental versus maritime cloud drop size. Journal of Geophysical Research: Atmospheres, 99(D11), 23107-23115.</a></li></ol></li></ol><p>Extensive observations indicate a distinct difference between maritime and continental effective drop size, <span class="math inline">\(r_e\)</span>, for warm clouds. The latest version of the NCAR Community Climate Model (CCM2) is used to explore the sensitivity of differentiating between continental and maritime <span class="math inline">\(r_e\)</span> on the simulated climate. <strong>The results of this study indicate that the smaller drop size over continents leads to a reduction of surface-absorbed solar radiation from 20 to 60 <span class="math inline">\(W m^{âˆ’2}\)</span>. This reduction in surface solar flux leads to a cooling of the continents by up to âˆ’3.5 K. The reduction in surface solar flux and temperature also leads to a reduction in latent heat flux and precipitation over land.</strong> In the January simulation, there is a significant shift in tropical precipitation associated with the Australian monsoon. This shift leads to a response in the extra tropical geopotential height field over the western United States. All of these changes reduce biases in the current version of CCM2. {:.info}</p><ol start="2" type="1"><li><ol start="1994" type="1"><li>J.T. Kiehl. <a href="https://ntrs.nasa.gov/api/citations/19960000201/downloads/19960000201.pdf">Cloud Formation and Radiative Modeling in the NCAR CCM2: The Present and Future</a>, National Center for Atmospheric Research, U.S.A.</li></ol></li></ol><p>Although the CCM2 is generally an improvement over CCM1, there are stilt biases in CCM2. These are: (1) northern summer continents that are too warm, (2) excessive precipitation over land, and (3) a weak Northern Hemisphere winter stationary wave pattern in the Pacific Northwest. It is believed that to a large degree these biases are related to cloud properties.</p><p><strong>Observations indicate that over continents the warm cloud'-drop effective radius is approximately 5 <span class="math inline">\(\mu m\)</span>, while over oceans the drop size is more like 10 <span class="math inline">\(\mu m\)</span></strong>. A sensitivity study has been carried out (Kiehl, 1994) where the distinction is made between continental and maritime drop size. This simulation was compared to a control where the effective drop size was set to 10 <span class="math inline">\(\mu m\)</span> everywhere. <strong>The smaller drop size over continents led to higher cloud albedos over land regions. This, in turn, led to less solar radiation absorbed at the surface, which led to a reduction of surface temperature (maximum reduction of around 5 K)</strong>. Furthermore, the latent heat flux over land decreased, which led to a decrease in local precipitation. Thus, adopting a more realistic cloud-drop size for land and ocean led to an improved climate simulation. In January, there was an improvement in the Australian monsoon simulation, with a. displacement of the maximum precipitation in the northeast. This shift in tropical heating led to a shift in the Northern Hemisphere planetary wave structure, which again decreased the known bias in the control model.</p><p>CCM2 employs a prescribFa zonally symmetric in-cloud liquid-water path (Kiehl et al., 1994). Hack and Kiehl (1994) have recently replaced this with a local diagnostic for in-cloud liquid water. This new approach to in-cloud liquid water leads to further improvements in the summer land-surface temperature bias. This approach also vastly improves the shortwave cloud forcing over the North Atlantic storm track region.</p><p>The conclusion of these studies is that improvements in the diagnosis of cloud microphysical properties (drop size and liquid water content) leads to a significant improvement in the simulated climate of CCM2. Future research in the area will focus on implementation of a prognostic formulation for cloud water and ice concentration.</p><ol start="3" type="1"><li>Kiehl, J. T., Hack, J. J., Bonan, G. B., Boville, B. A., Williamson, D. L., &amp; Rasch, P. J. (1998). <a href="https://doi.org/10.1175/1520-0442(1998)011%3C1131:TNCFAR%3E2.0.CO;2">The National Center for Atmospheric Research Community Climate Model: CCM3. Journal of Climate, 11(6), 1131-1149.</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>MPAS</category>
      
    </categories>
    
    
    <tags>
      
      <tag>WRF</tag>
      
      <tag>Parametrization</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>WRF | Error Error Error NoahMP submodule files not populating WRF directories</title>
    <link href="/2024/06/04/WRF_install_Error_NoahMP_submodule_files/"/>
    <url>/2024/06/04/WRF_install_Error_NoahMP_submodule_files/</url>
    
    <content type="html"><![CDATA[<h1 id="issue">Issue</h1><p>While installing latest WRF, encounter</p><blockquote><p>Error Error Error NoahMP submodule files not populating WRF directories</p></blockquote><h2 id="new-in-version-4.4">New in Version 4.4</h2><p>Physics</p><p>The NoahMP code has been moved to an external repository and is linked to WRF repository via a submodule. This submodule is automatically pulled in to build the code during compiling, as long as the compilation is done with internet access. If compiling without internet access, or you are not sure if the computer you are using to compile supports git (git is used during the compiling process to access code in submodule), or in the rare case that one checks out another branch, other than â€˜master,â€™ it may be necessary to issue the following commands while connected to the internet to ensure the submodule is available for compiling.</p><ul><li>git clone https://github.com/wrf-model/WRF.git</li><li>git submodule update --init --recursive</li></ul><p>Or in one command: - git clone --recurse-submodule https://github.com/wrf-model/WRF.git</p><p>After this, it is okay to go offline to compile. In the case you would like to remove code in the submodule, use â€˜clean -aaâ€™ instead of â€˜clean -aâ€™. <a href="https://github.com/wrf-model/WRF/commit/a49fe581285d">Details</a></p><p>If downloading the files from the section below, please choose either the v4.4.tar.gz file, or the v4.4.zip file. DO NOT choose those named "Source Code." They do not include the mandatory NoahMP submodule - needed for compiling WRF.</p><h1 id="solution">Solution</h1><ol type="1"><li>Go to specific WRF version and /phys/</li><li>Download <strong>noahmp @ xxxx</strong> folder to your local /WRF/phys/<ul><li>WRFv4.5.2 is noahmp @ 8a8073e</li><li>WRFv4.6.0 is noahmp @ 848f54a</li></ul></li></ol><p>It is</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs stylus">WRFV4.<span class="hljs-number">5</span>/phys/noahmp  <br> $ ls<br>drivers  parameters  README<span class="hljs-selector-class">.md</span>  <span class="hljs-attribute">src</span><br><br>.<br>â”œâ”€â”€ drivers<br>â”‚Â Â  â””â”€â”€ wrf<br>â”‚Â Â      â””â”€â”€ module_sf_noahmpdrv<span class="hljs-selector-class">.F</span><br>â”œâ”€â”€ parameters<br>â”‚Â Â  â”œâ”€â”€ GENPARM<span class="hljs-selector-class">.TBL</span><br>â”‚Â Â  â”œâ”€â”€ MPTABLE<span class="hljs-selector-class">.TBL</span><br>â”‚Â Â  â””â”€â”€ SOILPARM<span class="hljs-selector-class">.TBL</span><br>â”œâ”€â”€ README<span class="hljs-selector-class">.md</span><br>â””â”€â”€ <span class="hljs-attribute">src</span><br>    â”œâ”€â”€ module_sf_noahmp_glacier<span class="hljs-selector-class">.F</span><br>    â”œâ”€â”€ module_sf_noahmp_groundwater<span class="hljs-selector-class">.F</span><br>    â””â”€â”€ module_sf_noahmplsm<span class="hljs-selector-class">.F</span><br><br><span class="hljs-number">4</span> directories, <span class="hljs-number">8</span> files<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>WRF</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Installation</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MPAS | Official MPAS Installation lib -- Preliminary requirements</title>
    <link href="/2024/06/03/MPAS_install_official_mpas_lib_install/"/>
    <url>/2024/06/03/MPAS_install_official_mpas_lib_install/</url>
    
    <content type="html"><![CDATA[<h1 id="preliminary-requirements-the-easiest-route">Preliminary requirements: the easiest route</h1><p>Installing the full set of I/O libraries required by MPAS can be tedious. To make this easier, we've prepared a shell script that may be helpful:</p><p>Preliminary requirements: the easiest route</p><p><a href="https://www2.mmm.ucar.edu/projects/mpas/scripts/mpas_lib_install.sh" class="uri">https://www2.mmm.ucar.edu/projects/mpas/scripts/mpas_lib_install.sh</a></p><p>Notes:</p><ul><li>Before running or following the above script, you will need to have downloaded the library sources from <a href="https://www2.mmm.ucar.edu/projects/mpas/scripts" class="uri">https://www2.mmm.ucar.edu/projects/mpas/scripts</a></li><li>If you already have an MPI library, skip the MPICH installation</li><li>After editing paths and compiler names at the top, you may be able to run the script, but in general the script may be best used as a guide</li></ul><p>attached below,</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/usr/bin/env bash</span><br><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Sources for all libraries used in this script can be found at</span><br><span class="hljs-comment"># http://www2.mmm.ucar.edu/people/duda/files/mpas/sources/ </span><br><span class="hljs-comment">#</span><br><br><span class="hljs-comment"># Where to find sources for libraries - generally, the directory into which</span><br><span class="hljs-comment"># you have downloaded the sources from the URL, above</span><br><span class="hljs-built_in">export</span> LIBSRC=/sysdisk2/duda/sources<br><br><span class="hljs-comment"># Where to install libraries - this directory must be writable by you</span><br><span class="hljs-built_in">export</span> LIBBASE=/sysdisk2/duda/mpas-libs<br><br><span class="hljs-comment"># Compilers</span><br><span class="hljs-built_in">export</span> SERIAL_FC=gfortran<br><span class="hljs-built_in">export</span> SERIAL_F77=gfortran<br><span class="hljs-built_in">export</span> SERIAL_CC=gcc<br><span class="hljs-built_in">export</span> SERIAL_CXX=g++<br><span class="hljs-built_in">export</span> MPI_FC=mpifort<br><span class="hljs-built_in">export</span> MPI_F77=mpifort<br><span class="hljs-built_in">export</span> MPI_CC=mpicc<br><span class="hljs-built_in">export</span> MPI_CXX=mpic++<br><br><br><span class="hljs-built_in">export</span> CC=<span class="hljs-variable">$SERIAL_CC</span><br><span class="hljs-built_in">export</span> CXX=<span class="hljs-variable">$SERIAL_CXX</span><br><span class="hljs-built_in">export</span> F77=<span class="hljs-variable">$SERIAL_F77</span><br><span class="hljs-built_in">export</span> FC=<span class="hljs-variable">$SERIAL_FC</span><br><span class="hljs-built_in">unset</span> F90  <span class="hljs-comment"># This seems to be set by default on NCAR&#x27;s Cheyenne and is problematic</span><br><span class="hljs-built_in">unset</span> F90FLAGS<br><span class="hljs-built_in">export</span> CFLAGS=<span class="hljs-string">&quot;-g&quot;</span><br><span class="hljs-built_in">export</span> FFLAGS=<span class="hljs-string">&quot;-g -fbacktrace&quot;</span><br><span class="hljs-built_in">export</span> FCFLAGS=<span class="hljs-string">&quot;-g -fbacktrace -fallow-argument-mismatch&quot;</span><br><span class="hljs-built_in">export</span> F77FLAGS=<span class="hljs-string">&quot;-g -fbacktrace -fallow-argument-mismatch&quot;</span><br><br><br><span class="hljs-comment">########################################</span><br><span class="hljs-comment"># MPICH</span><br><span class="hljs-comment">########################################</span><br>tar xzvf <span class="hljs-variable">$&#123;LIBSRC&#125;</span>/mpich-3.3.1.tar.gz <br><span class="hljs-built_in">cd</span> mpich-3.3.1<br>./configure --prefix=<span class="hljs-variable">$&#123;LIBBASE&#125;</span><br>make -j 4<br><span class="hljs-comment">#make check</span><br>make install<br><span class="hljs-comment">#make testing</span><br><span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$&#123;LIBBASE&#125;</span>/bin:<span class="hljs-variable">$PATH</span><br><span class="hljs-built_in">export</span> LD_LIBRARY_PATH=<span class="hljs-variable">$&#123;LIBBASE&#125;</span>/lib:<span class="hljs-variable">$LD_LIBRARY_PATH</span><br><span class="hljs-built_in">cd</span> ..<br><span class="hljs-built_in">rm</span> -rf mpich-3.3.1<br><br><span class="hljs-comment">########################################</span><br><span class="hljs-comment"># zlib</span><br><span class="hljs-comment">########################################</span><br>tar xzvf <span class="hljs-variable">$&#123;LIBSRC&#125;</span>/zlib-1.2.11.tar.gz<br><span class="hljs-built_in">cd</span> zlib-1.2.11<br>./configure --prefix=<span class="hljs-variable">$&#123;LIBBASE&#125;</span> --static<br>make -j 4<br>make install<br><span class="hljs-built_in">cd</span> ..<br><span class="hljs-built_in">rm</span> -rf zlib-1.2.11<br><br><span class="hljs-comment">########################################</span><br><span class="hljs-comment"># HDF5</span><br><span class="hljs-comment">########################################</span><br>tar xjvf <span class="hljs-variable">$&#123;LIBSRC&#125;</span>/hdf5-1.10.5.tar.bz2<br><span class="hljs-built_in">cd</span> hdf5-1.10.5<br><span class="hljs-built_in">export</span> FC=<span class="hljs-variable">$MPI_FC</span><br><span class="hljs-built_in">export</span> CC=<span class="hljs-variable">$MPI_CC</span><br><span class="hljs-built_in">export</span> CXX=<span class="hljs-variable">$MPI_CXX</span><br>./configure --prefix=<span class="hljs-variable">$&#123;LIBBASE&#125;</span> --enable-parallel --with-zlib=<span class="hljs-variable">$&#123;LIBBASE&#125;</span> --disable-shared<br>make -j 4<br><span class="hljs-comment">#make check</span><br>make install<br><span class="hljs-built_in">cd</span> ..<br><span class="hljs-built_in">rm</span> -rf hdf5-1.10.5<br><br><span class="hljs-comment">########################################</span><br><span class="hljs-comment"># Parallel-netCDF</span><br><span class="hljs-comment">########################################</span><br>tar xzvf <span class="hljs-variable">$&#123;LIBSRC&#125;</span>/pnetcdf-1.12.2.tar.gz<br><span class="hljs-built_in">cd</span> pnetcdf-1.12.2<br><span class="hljs-built_in">export</span> CC=<span class="hljs-variable">$SERIAL_CC</span><br><span class="hljs-built_in">export</span> CXX=<span class="hljs-variable">$SERIAL_CXX</span><br><span class="hljs-built_in">export</span> F77=<span class="hljs-variable">$SERIAL_F77</span><br><span class="hljs-built_in">export</span> FC=<span class="hljs-variable">$SERIAL_FC</span><br><span class="hljs-built_in">export</span> MPICC=<span class="hljs-variable">$MPI_CC</span><br><span class="hljs-built_in">export</span> MPICXX=<span class="hljs-variable">$MPI_CXX</span><br><span class="hljs-built_in">export</span> MPIF77=<span class="hljs-variable">$MPI_F77</span><br><span class="hljs-built_in">export</span> MPIF90=<span class="hljs-variable">$MPI_FC</span><br><span class="hljs-comment">### Will also need gcc in path</span><br>./configure --prefix=<span class="hljs-variable">$&#123;LIBBASE&#125;</span><br>make -j 4<br><span class="hljs-comment">#make check</span><br><span class="hljs-comment">#make ptest</span><br><span class="hljs-comment">#make testing</span><br>make install<br><span class="hljs-built_in">export</span> PNETCDF=<span class="hljs-variable">$&#123;LIBBASE&#125;</span><br><span class="hljs-built_in">cd</span> ..<br><span class="hljs-built_in">rm</span> -rf pnetcdf-1.12.2<br><br><span class="hljs-comment">########################################</span><br><span class="hljs-comment"># netCDF (C library)</span><br><span class="hljs-comment">########################################</span><br>tar xzvf <span class="hljs-variable">$&#123;LIBSRC&#125;</span>/netcdf-c-4.6.3.tar.gz<br><span class="hljs-built_in">cd</span> netcdf-c-4.6.3<br><span class="hljs-built_in">export</span> CPPFLAGS=<span class="hljs-string">&quot;-I<span class="hljs-variable">$&#123;LIBBASE&#125;</span>/include&quot;</span><br><span class="hljs-built_in">export</span> LDFLAGS=<span class="hljs-string">&quot;-L<span class="hljs-variable">$&#123;LIBBASE&#125;</span>/lib&quot;</span><br><span class="hljs-built_in">export</span> LIBS=<span class="hljs-string">&quot;-lhdf5_hl -lhdf5 -lz -ldl&quot;</span><br><span class="hljs-built_in">export</span> CC=<span class="hljs-variable">$MPI_CC</span><br>./configure --prefix=<span class="hljs-variable">$&#123;LIBBASE&#125;</span> --disable-dap --enable-netcdf4 --enable-pnetcdf --enable-cdf5 --enable-parallel-tests --disable-shared<br>make -j 4 <br><span class="hljs-comment">#make check</span><br>make install<br><span class="hljs-built_in">export</span> NETCDF=<span class="hljs-variable">$&#123;LIBBASE&#125;</span><br><span class="hljs-built_in">cd</span> ..<br><span class="hljs-built_in">rm</span> -rf netcdf-c-4.6.3<br><br><span class="hljs-comment">########################################</span><br><span class="hljs-comment"># netCDF (Fortran interface library)</span><br><span class="hljs-comment">########################################</span><br>tar xzvf <span class="hljs-variable">$&#123;LIBSRC&#125;</span>/netcdf-fortran-4.5.2.tar.gz<br><span class="hljs-built_in">cd</span> netcdf-fortran-4.5.2<br><span class="hljs-built_in">export</span> FC=<span class="hljs-variable">$MPI_FC</span><br><span class="hljs-built_in">export</span> F77=<span class="hljs-variable">$MPI_F77</span><br><span class="hljs-built_in">export</span> LIBS=<span class="hljs-string">&quot;-lnetcdf -lpnetcdf <span class="hljs-variable">$&#123;LIBS&#125;</span>&quot;</span><br>./configure --prefix=<span class="hljs-variable">$&#123;LIBBASE&#125;</span> --enable-parallel-tests --disable-shared<br>make -j 4<br><span class="hljs-comment">#make check</span><br>make install<br><span class="hljs-built_in">cd</span> ..<br><span class="hljs-built_in">rm</span> -rf netcdf-fortran-4.5.2<br><br><span class="hljs-comment">########################################</span><br><span class="hljs-comment"># PIO</span><br><span class="hljs-comment">########################################</span><br>git <span class="hljs-built_in">clone</span> https://github.com/NCAR/ParallelIO<br><span class="hljs-built_in">cd</span> ParallelIO<br>git checkout -b pio-2.5.8 pio2_5_8<br><span class="hljs-built_in">export</span> PIOSRC=`<span class="hljs-built_in">pwd</span>`<br><span class="hljs-built_in">cd</span> ..<br><span class="hljs-built_in">mkdir</span> pio<br><span class="hljs-built_in">cd</span> pio<br><span class="hljs-built_in">export</span> CC=<span class="hljs-variable">$MPI_CC</span><br><span class="hljs-built_in">export</span> FC=<span class="hljs-variable">$MPI_FC</span><br>cmake -DNetCDF_C_PATH=<span class="hljs-variable">$NETCDF</span> -DNetCDF_Fortran_PATH=<span class="hljs-variable">$NETCDF</span> -DPnetCDF_PATH=<span class="hljs-variable">$PNETCDF</span> -DHDF5_PATH=<span class="hljs-variable">$NETCDF</span> -DCMAKE_INSTALL_PREFIX=<span class="hljs-variable">$LIBBASE</span> -DPIO_USE_MALLOC=ON -DCMAKE_VERBOSE_MAKEFILE=1 -DPIO_ENABLE_TIMING=OFF <span class="hljs-variable">$PIOSRC</span><br>make<br><span class="hljs-comment">#make check</span><br>make install<br><span class="hljs-built_in">cd</span> ..<br><span class="hljs-built_in">rm</span> -rf pio ParallelIO<br><span class="hljs-built_in">export</span> PIO=<span class="hljs-variable">$LIBBASE</span><br><br><span class="hljs-comment">########################################</span><br><span class="hljs-comment"># Other environment vars needed by MPAS</span><br><span class="hljs-comment">########################################</span><br><span class="hljs-built_in">export</span> MPAS_EXTERNAL_LIBS=<span class="hljs-string">&quot;-L<span class="hljs-variable">$&#123;LIBBASE&#125;</span>/lib -lhdf5_hl -lhdf5 -ldl -lz&quot;</span><br><span class="hljs-built_in">export</span> MPAS_EXTERNAL_INCLUDES=<span class="hljs-string">&quot;-I<span class="hljs-variable">$&#123;LIBBASE&#125;</span>/include&quot;</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>MPAS</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Installation</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MPAS | Installation by Spack and Intel</title>
    <link href="/2024/06/01/MPAS_intel_spack_installation/"/>
    <url>/2024/06/01/MPAS_intel_spack_installation/</url>
    
    <content type="html"><![CDATA[<h1 id="using-spack">Using Spack</h1><p>Spack is a package management tool designed to support multiple versions and configurations of software on a wide variety of platforms and environments. It was designed for large supercomputing centers, where many users and application teams share common installations of software on clusters with exotic architectures, using libraries that do not have a standard ABI. Spack is non-destructive: installing a new version does not break existing installations, so many configurations can coexist on the same system. Most importantly, Spack is simple. It offers a simple spec syntax so that users can specify versions and configuration options concisely. Spack is also simple for package authors: package files are written in pure Python, and specs allow package authors to maintain a single file for many different builds of the same package.</p><p><a href="https://spack.readthedocs.io/en/latest/" class="uri">https://spack.readthedocs.io/en/latest/</a></p><h2 id="search-packages-online">Search packages online</h2><blockquote><p><a href="https://packages.spack.io/" class="uri">https://packages.spack.io/</a></p></blockquote><h1 id="install-intel-compiler-and-intel-onempi">Install Intel compiler and intel-onempi</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ spack <span class="hljs-built_in">env</span> create intel_oneapi <br>$ spack <span class="hljs-built_in">env</span> activate intel_oneapi<br>$ spack info --all intel-oneapi-mpi<br>$ spack info --all intel-oneapi-compilers<br></code></pre></td></tr></table></figure><p>Try to install <a href="https://spack.readthedocs.io/en/latest/build_systems/inteloneapipackage.html">intel-oneapi-mpi/2021.4.0</a>,</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ spack install --add intel-oneapi-compilers@2021.4.0<br><span class="hljs-comment"># Add the compilers to your compilers.yaml so spack can use them:</span><br><span class="hljs-comment"># For 2023.x and earlier versions, use:</span><br>$ spack compiler add `spack location -i intel-oneapi-compilers@2021.4.0`/compiler/latest/linux/bin/intel64<br>$ spack compiler add `spack location -i intel-oneapi-compilers@2021.4.0`/compiler/latest/linux/bin<br><span class="hljs-comment"># Verify that the compilers are available:</span><br>$ spack compiler list<br>$ spack location -i intel-oneapi-compilers@2021.4.0<br></code></pre></td></tr></table></figure><p>Then, install intel-onempi,</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ spack install --add intel-oneapi-mpi@2021.4.0%intel<br></code></pre></td></tr></table></figure><p>Done.</p><p>And, check</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh">spack <span class="hljs-built_in">env</span> activate intel_oneapi<br><br><span class="hljs-built_in">which</span> mpiicc &amp;&amp; mpiicc --version<br><span class="hljs-built_in">which</span> mpiifort &amp;&amp; mpiifort --version<br><span class="hljs-built_in">which</span> mpiicpc &amp;&amp; mpiicpc --version<br><span class="hljs-built_in">which</span> icc &amp;&amp; icc --version<br><span class="hljs-built_in">which</span> ifort &amp;&amp; ifort --version<br></code></pre></td></tr></table></figure><p>Additionally, install curl and cmake,</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ spack info --all curl<br>$ spack install --add curl%intel<br>$ spack info --all cmake<br>$ spack install --add cmake%intel<br></code></pre></td></tr></table></figure><h1 id="install-enviroment-for-mpas">Install enviroment for MPAS</h1><p>Prepare</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/bash</span><br><br><span class="hljs-comment">#------------------------------------------------#</span><br><span class="hljs-comment">#Author:         wpsze</span><br><span class="hljs-comment">#Emailï¼š         </span><br><span class="hljs-comment">#date:           </span><br><span class="hljs-comment">#Version:        </span><br><span class="hljs-comment">#Description:    The purpose of the script</span><br><span class="hljs-comment">#Copyright (C)ï¼š 2022 All rights reserved</span><br><span class="hljs-comment">#------------------------------------------------#</span><br><br><span class="hljs-built_in">export</span> libs_DIR=/home/wpsze/MPAS-A/intel/modules_library/Library/<br><br><span class="hljs-comment"># intel compiler &amp; intel onempi</span><br>spack <span class="hljs-built_in">env</span> activate intel_oneapi<br><br><span class="hljs-built_in">which</span> mpiicc &amp;&amp; mpiicc --version<br><span class="hljs-built_in">which</span> mpiifort &amp;&amp; mpiifort --version<br><span class="hljs-built_in">which</span> mpiicpc &amp;&amp; mpiicpc --version<br><span class="hljs-built_in">which</span> icc &amp;&amp; icc --version<br><span class="hljs-built_in">which</span> ifort &amp;&amp; ifort --version<br><br><span class="hljs-comment"># MPAS env</span><br><span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$libs_DIR</span>/bin:<span class="hljs-variable">$PATH</span><br><span class="hljs-built_in">export</span> LD_LIBRARY_PATH=<span class="hljs-variable">$libs_DIR</span>/lib:<span class="hljs-variable">$LD_LIBRARY_PATH</span><br><span class="hljs-built_in">export</span> LDFLAGS=-L<span class="hljs-variable">$libs_DIR</span>/lib<br><span class="hljs-built_in">export</span> CPPFLAGS=-I<span class="hljs-variable">$libs_DIR</span>/include<br><br><span class="hljs-built_in">export</span> PNETCDF_PATH=<span class="hljs-variable">$libs_DIR</span><br><span class="hljs-built_in">export</span> PNETCDF=<span class="hljs-variable">$libs_DIR</span><br><span class="hljs-built_in">export</span> NETCDF_PATH=<span class="hljs-variable">$libs_DIR</span><br><span class="hljs-built_in">export</span> NETCDF=<span class="hljs-variable">$libs_DIR</span><br><span class="hljs-built_in">export</span> PIO=<span class="hljs-variable">$libs_DIR</span><br><br><br><span class="hljs-built_in">export</span> CC=mpiicc<br><span class="hljs-built_in">export</span> CXX=mpiicpc<br><span class="hljs-built_in">export</span> FC=mpiifort<br><span class="hljs-built_in">export</span> F77=mpiifort<br><span class="hljs-built_in">export</span> F90=mpiifort<br><span class="hljs-built_in">export</span> MPIF90=mpiifort<br><span class="hljs-built_in">export</span> MPIF77=mpiifort<br><span class="hljs-built_in">export</span> MPIFC=mpiifort<br><span class="hljs-built_in">export</span> MPICC=mpiicc<br><span class="hljs-built_in">export</span> MPICXX=mpiicpc<br><br><span class="hljs-built_in">export</span> CFLAGS=<span class="hljs-string">&#x27;-O3 -fPIC -static-intel&#x27;</span><br><span class="hljs-built_in">export</span> CXXFLAGS=<span class="hljs-string">&#x27;-O3 -fPIC -static-intel&#x27;</span><br><span class="hljs-built_in">export</span> FFLAGS=<span class="hljs-string">&#x27;-O3 -fPIC -static-intel&#x27;</span><br></code></pre></td></tr></table></figure><p>Then, env sh</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">############################## Directory Listing ############################</span><br><span class="hljs-built_in">export</span> HOME=`<span class="hljs-built_in">pwd</span>`<br><br><span class="hljs-built_in">source</span> /home/wpsze/MPAS-A/intel/modules_library/mpas_env_intel.sh<br><br><span class="hljs-built_in">export</span> download_DIR=<span class="hljs-variable">$HOME</span>/mpas_install/<br><br>TARGET=ifort<br><br><span class="hljs-built_in">which</span> mpiicc &amp;&amp; mpiicc --version<br><span class="hljs-built_in">which</span> mpiifort &amp;&amp; mpiifort --version<br><span class="hljs-built_in">which</span> mpiicpc &amp;&amp; mpiicpc --version<br><span class="hljs-built_in">which</span> icc &amp;&amp; icc --version<br><span class="hljs-built_in">which</span> ifort &amp;&amp; ifort --version<br><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$HOME</span><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$download_DIR</span><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$libs_DIR</span><br><br>mpiicc --version<br>mpiifort --version<br><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$HOME</span><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$download_DIR</span><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$libs_DIR</span><br><br><span class="hljs-built_in">mkdir</span> -p mpas_install<br><span class="hljs-built_in">mkdir</span> -p Library<br><br>do_download=False <span class="hljs-comment"># True or False</span><br>compile_all=True<br><br><span class="hljs-comment"># Currently Loaded Modules:</span><br><span class="hljs-comment">#  1) ncarenv/1.0 (xx)      4) ncarcompilers/1.0 (xx)  7) pnetcdf/1.11.2  10) ncview/2.1.7 (already)</span><br><span class="hljs-comment">#  2) ncarbinlibs/1.1 (xx)  5) netcdf/4.7.0        8) pio/1.9.23 (2.5.2)      11) metis/5.1.0</span><br><span class="hljs-comment">#  3) gnu/8.3.0 (done)         6) mpich/3.3.1         9) ncl/6.6.2 (already)       12) hdf5/1.10.5</span><br><br><span class="hljs-comment">#do_mpich=False ## intel-onempi</span><br>do_zlib=False<br>do_hdf5=True<br>do_pnetcdf=False<br>do_netcdfC=False<br>do_netcdfF=False<br>do_pio=False<br>do_metis=fTrue<br><br><span class="hljs-comment">############################## Downloading Libraries ############################</span><br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$do_download</span>  == True ]]; <span class="hljs-keyword">then</span><br>    <span class="hljs-built_in">cd</span> <span class="hljs-variable">$download_DIR</span><br>    wget -c https://zlib.net/zlib-1.2.13.tar.gz<br>    wget -c https://www.gfd-dennou.org/arch/netcdf/unidata-mirror/netcdf-c-4.7.4.tar.gz<br>    wget -c https://www.gfd-dennou.org/arch/netcdf/unidata-mirror/netcdf-fortran-4.5.3.tar.gz<br>    <span class="hljs-comment"># wget -c https://github.com/pmodels/mpich/releases/download/v4.0.2/mpich-4.0.2.tar.gz</span><br>    wget -c https://www.mpich.org/static/downloads/3.3.1/mpich-3.3.1.tar.gz<br>    wget -c https://parallel-netcdf.github.io/Release/pnetcdf-1.11.2.tar.gz <br>    <span class="hljs-comment"># Pio is from https://github.com/NCAR/ParallelIO/releases</span><br>    <span class="hljs-comment"># metis is from http://glaros.dtc.umn.edu/gkhome/metis/metis/download</span><br>    wget -c https://hdf-wordpress-1.s3.amazonaws.com/wp-content/uploads/manual/HDF5/HDF5_1_12_0/source/hdf5-1.12.0.tar.gz<br><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$compile_all</span> == True ]]; <span class="hljs-keyword">then</span><br><span class="hljs-comment">###################################################################</span><br><span class="hljs-built_in">export</span> LD_LIBRARY_PATH=<span class="hljs-variable">$libs_DIR</span>/lib:<span class="hljs-variable">$LD_LIBRARY_PATH</span><br><span class="hljs-built_in">export</span> LDFLAGS=-L<span class="hljs-variable">$libs_DIR</span>/lib<br><span class="hljs-built_in">export</span> CPPFLAGS=-I<span class="hljs-variable">$libs_DIR</span>/include<br><span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$libs_DIR</span>/bin:<span class="hljs-variable">$PATH</span><br><br><span class="hljs-comment">#export PNETCDF_PATH=$libs_DIR/bin:$PATH</span><br><span class="hljs-comment">#export PNETCDF=$libs_DIR/bin:$PATH</span><br><br><span class="hljs-comment">#export NETCDF_PATH=$libs_DIR/bin:$PATH</span><br><span class="hljs-comment">#export NETCDF=$libs_DIR/bin:$PATH</span><br><br><span class="hljs-comment">############################## zlib ############################ *** zlib test OK ***</span><br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$&#123;do_zlib&#125;</span>  == True ]]; <span class="hljs-keyword">then</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== zlib ====&quot;</span><br><span class="hljs-built_in">cd</span> <span class="hljs-variable">$download_DIR</span><br>tar xvf zlib-1.2.13.tar.gz 1&gt;/dev/null 2&gt;&amp;1 <br><span class="hljs-built_in">cd</span> zlib-1.2.13/<br><br>./configure --prefix=<span class="hljs-variable">$libs_DIR</span> <span class="hljs-comment">#--static</span><br>make -j 4<br>make install<br>make check<br><span class="hljs-built_in">cd</span> ..<br><span class="hljs-built_in">rm</span> -rf zlib-1.2.13<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== zlib (end) ====&quot;</span><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-comment">############################## HDF5 ############################ </span><br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$&#123;do_hdf5&#125;</span> == True ]]; <span class="hljs-keyword">then</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== hdf5 ====&quot;</span><br><span class="hljs-built_in">cd</span> <span class="hljs-variable">$download_DIR</span><br>tar xvf hdf5-1.12.0.tar.gz 1&gt;/dev/null 2&gt;&amp;1 <br><span class="hljs-built_in">cd</span> hdf5-1.12.0/<br><br>./configure --prefix=<span class="hljs-variable">$libs_DIR</span> --enable-parallel --with-zlib=<span class="hljs-variable">$libs_DIR</span> --enable-fortran <span class="hljs-comment">#--disable-shared</span><br>make -j 4<br>make check<br>make install<br><span class="hljs-built_in">cd</span> ..<br><span class="hljs-built_in">rm</span> -rf hdf5-1.12.0<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== hdf5 (end) ====&quot;</span><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-comment">############################## pnetcdf ############################ PnetCDF has been successfully installed </span><br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$&#123;do_pnetcdf&#125;</span> == True ]]; <span class="hljs-keyword">then</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== pnetcdf ====&quot;</span><br><span class="hljs-built_in">cd</span> <span class="hljs-variable">$download_DIR</span><br>tar xvf pnetcdf-1.11.2.tar.gz 1&gt;/dev/null 2&gt;&amp;1 <br><span class="hljs-built_in">cd</span> pnetcdf-1.11.2/<br><br>./configure --prefix=<span class="hljs-variable">$libs_DIR</span><br>make -j 4<br>make check<br>make ptest<br>make testing<br>make install<br><span class="hljs-built_in">cd</span> ..<br><span class="hljs-built_in">rm</span> -rf pnetcdf-1.11.2<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== pnetcdf (end) ====&quot;</span><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-comment">############################## netcdf-C ############################  Congratulations! You have successfully installed netCDF!</span><br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$&#123;do_netcdfC&#125;</span> == True ]]; <span class="hljs-keyword">then</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== netcdf-C ====&quot;</span><br><span class="hljs-comment">## -disable-dapï¼š--disable-dapçš„åŸå› æ˜¯ç¼ºå°‘ä¸€ä¸ªâ€˜curlâ€™çš„lib</span><br><span class="hljs-comment">## 4.1.3ä»¥åçš„ç‰ˆæœ¬Fortranå’ŒCåˆ†å¼€äº†ã€‚æŠŠdisable--netcdf-4 å†™è¿›å»ä¹Ÿæ— æ‰€è°“</span><br><span class="hljs-built_in">cd</span> <span class="hljs-variable">$download_DIR</span><br>tar xvf netcdf-c-4.7.4.tar.gz 1&gt;/dev/null 2&gt;&amp;1 <br><span class="hljs-built_in">cd</span> netcdf-c-4.7.4/<br><br><span class="hljs-comment">#export LIBS=&quot;-lhdf5_hl -lhdf5 -lz -ldl&quot;</span><br><br><span class="hljs-built_in">export</span> LD_LIBRARY_PATH=<span class="hljs-variable">$libs_DIR</span>/lib:<span class="hljs-variable">$LD_LIBRARY_PATH</span><br><span class="hljs-built_in">export</span> LDFLAGS=-L<span class="hljs-variable">$libs_DIR</span>/lib<br><span class="hljs-built_in">export</span> CPPFLAGS=-I<span class="hljs-variable">$libs_DIR</span>/include<br><br><span class="hljs-comment">#./configure --prefix=$libs_DIR --disable-dap --enable-pnetcdf --enable-netcdf4 --enable-cdf5 --enable-parallel-tests --disable-shared</span><br>./configure --prefix=<span class="hljs-variable">$libs_DIR</span> --enable-shared --enable-netcdf4 --disable-filter-testing --disable-dap<br>make -j 4 <br>make check<br>make install<br><span class="hljs-built_in">cd</span> ..<br><span class="hljs-built_in">rm</span> -rf netcdf-c-4.7.4<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== netcdf-C (end) ====&quot;</span><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-comment">############################## netcdf-F ############################ </span><br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$&#123;do_netcdfF&#125;</span> == True ]]; <span class="hljs-keyword">then</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== netcdf-F ====&quot;</span><br><span class="hljs-built_in">cd</span> <span class="hljs-variable">$download_DIR</span><br>tar xvf netcdf-fortran-4.5.3.tar.gz 1&gt;/dev/null 2&gt;&amp;1 <br><span class="hljs-built_in">cd</span> netcdf-fortran-4.5.3/<br><br><br><span class="hljs-built_in">export</span> LD_LIBRARY_PATH=<span class="hljs-variable">$libs_DIR</span>/lib:<span class="hljs-variable">$LD_LIBRARY_PATH</span><br><span class="hljs-built_in">export</span> LDFLAGS=-L<span class="hljs-variable">$libs_DIR</span>/lib<br><span class="hljs-built_in">export</span> CPPFLAGS=-I<span class="hljs-variable">$libs_DIR</span>/include<br><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># configure: error: netcdf-c version 4.7.4 or greater is required</span><br><br>nc-config --cflags<br>nc-config --libs<br>./configure --prefix=<span class="hljs-variable">$libs_DIR</span> --enable-shared <span class="hljs-comment">#--enable-parallel-tests #--disable-shared</span><br><br><span class="hljs-comment">#CFLAGS=$(nc-config --cflags) LDFLAGS=$(nc-config --libs) ./configure --prefix=$libs_DIR --enable-parallel-tests #--disable-shared</span><br><br>make -j 4 <br>make check<br>make install<br><span class="hljs-built_in">cd</span> ..<br><span class="hljs-built_in">rm</span> -rf netcdf-fortran-4.5.3<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== netcdf-F (end) ====&quot;</span><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-comment">############################## Pio ############################</span><br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$&#123;do_pio&#125;</span> == True ]]; <span class="hljs-keyword">then</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== PIO ====&quot;</span><br><span class="hljs-built_in">cd</span> <span class="hljs-variable">$download_DIR</span><br>tar xvf ParallelIO-pio2_5_8.tar.gz 1&gt;/dev/null 2&gt;&amp;1<br><span class="hljs-built_in">cd</span> ParallelIO-pio2_5_8/<br><br><span class="hljs-comment">#./configure --prefix=$libs_DIR --enable-fortran</span><br><span class="hljs-comment">#cmake -DNetCDF_C_PATH=$libs_DIR -DNetCDF_Fortran_PATH=$libs_DIR -DPnetCDF_PATH=$libs_DIR -DPIO_ENABLE_TIMING=OFF -DCMAKE_INSTALL_PREFIX=$libs_DIR</span><br>cmake -DNetCDF_C_PATH=<span class="hljs-variable">$NETCDF</span> -DNetCDF_Fortran_PATH=<span class="hljs-variable">$NETCDF</span> -DPnetCDF_PATH=<span class="hljs-variable">$PNETCDF</span> -DHDF5_PATH=<span class="hljs-variable">$libs_DIR</span> -DCMAKE_INSTALL_PREFIX=<span class="hljs-variable">$libs_DIR</span> -DPIO_USE_MALLOC=ON -DCMAKE_VERBOSE_MAKEFILE=1 -DPIO_ENABLE_TIMING=OFF ./<br>make<br><span class="hljs-comment">#make check</span><br>make install<br><span class="hljs-built_in">cd</span> ..<br><span class="hljs-built_in">rm</span> -rf ParallelIO-pio2_5_8<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== PIO (end) ====&quot;</span><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-comment">############################## metis ############################</span><br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$&#123;do_metis&#125;</span> == True ]]; <span class="hljs-keyword">then</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== metis ====&quot;</span><br><br>        <span class="hljs-comment">## metis is serial </span><br>        <span class="hljs-built_in">export</span> CC=icc<br>        <span class="hljs-built_in">export</span> CXX=icpc<br>        <span class="hljs-built_in">export</span> FC=ifort<br>        <span class="hljs-built_in">export</span> F77=ifort<br>        <span class="hljs-built_in">export</span> F90=ifort<br><br><span class="hljs-built_in">cd</span> <span class="hljs-variable">$download_DIR</span><br>tar xvf metis-5.1.0.tar.gz 1&gt;/dev/null 2&gt;&amp;1<br><span class="hljs-built_in">cd</span> metis-5.1.0/<br><span class="hljs-comment">#./configure --prefix=$libs_DIR</span><br><br>make config prefix=<span class="hljs-variable">$libs_DIR</span><br>make<br><span class="hljs-comment">#make check</span><br>make install<br><span class="hljs-built_in">cd</span> ..<br><span class="hljs-built_in">rm</span> -rf metis-5.1.0<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== metis (end) ====&quot;</span><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-keyword">fi</span><br></code></pre></td></tr></table></figure><h1 id="mpasv7.3">MPASv7.3</h1><h1 id="reference">Reference</h1><ol type="1"><li><p><a href="https://forum.mmm.ucar.edu/threads/full-wrf-and-wps-installation-example-intel.15229/">Full WRF and WPS Installation Example (Intel)</a></p></li><li><p><a href="https://forum.mmm.ucar.edu/threads/make-ifort-error.340/">Make ifort error</a></p></li></ol><p>In Makefile,</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs sh">ifort:<br>( $(MAKE) all \<br><span class="hljs-string">&quot;FC_PARALLEL = mpif90&quot;</span> \<br><span class="hljs-string">&quot;CC_PARALLEL = mpicc&quot;</span> \<br><span class="hljs-string">&quot;CXX_PARALLEL = mpicxx&quot;</span> \<br><span class="hljs-string">&quot;FC_SERIAL = ifort&quot;</span> \<br><span class="hljs-string">&quot;CC_SERIAL = icc&quot;</span> \<br><span class="hljs-string">&quot;CXX_SERIAL = icpc&quot;</span> \<br><span class="hljs-string">&quot;FFLAGS_PROMOTION = -real-size 64&quot;</span> \<br><span class="hljs-string">&quot;FFLAGS_OPT = -O3 -convert big_endian -free -align array64byte&quot;</span> \<br><span class="hljs-string">&quot;CFLAGS_OPT = -O3&quot;</span> \<br><span class="hljs-string">&quot;CXXFLAGS_OPT = -O3&quot;</span> \<br><span class="hljs-string">&quot;LDFLAGS_OPT = -O3&quot;</span> \<br><span class="hljs-string">&quot;FFLAGS_DEBUG = -g -convert big_endian -free -CU -CB -check all -fpe0 -traceback&quot;</span> \<br><span class="hljs-string">&quot;CFLAGS_DEBUG = -g -traceback&quot;</span> \<br><span class="hljs-string">&quot;CXXFLAGS_DEBUG = -g -traceback&quot;</span> \<br><span class="hljs-string">&quot;LDFLAGS_DEBUG = -g -fpe0 -traceback&quot;</span> \<br><span class="hljs-string">&quot;FFLAGS_OMP = -qopenmp&quot;</span> \<br><span class="hljs-string">&quot;CFLAGS_OMP = -qopenmp&quot;</span> \<br><span class="hljs-string">&quot;CORE = <span class="hljs-subst">$(CORE)</span>&quot;</span> \<br><span class="hljs-string">&quot;DEBUG = <span class="hljs-subst">$(DEBUG)</span>&quot;</span> \<br><span class="hljs-string">&quot;USE_PAPI = <span class="hljs-subst">$(USE_PAPI)</span>&quot;</span> \<br><span class="hljs-string">&quot;OPENMP = <span class="hljs-subst">$(OPENMP)</span>&quot;</span> \<br><span class="hljs-string">&quot;CPPFLAGS = <span class="hljs-subst">$(MODEL_FORMULATION)</span> -D_MPI&quot;</span> )<br></code></pre></td></tr></table></figure><p>where use <strong>mpif90/mpicc/mpicxx</strong> but now we want to use <strong>mpiifort/mpiicc/mpiicpc</strong>.</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># After reading your comment I decided to edit the Makefile, and in the lines of ifort I made the following change:</span><br><span class="hljs-comment"># Code:</span><br>ifort:<br>        ( $(MAKE) all \<br>        <span class="hljs-string">&quot;FC_PARALLEL = mpiifort&quot;</span> \<br>        <span class="hljs-string">&quot;CC_PARALLEL = mpiicc&quot;</span> \<br>        <span class="hljs-string">&quot;CXX_PARALLEL = mpiicpc&quot;</span> \<br>        <span class="hljs-string">&quot;FC_SERIAL = ifort&quot;</span> \<br>        <span class="hljs-string">&quot;CC_SERIAL = icc&quot;</span> \<br>        <span class="hljs-string">&quot;CXX_SERIAL = icpc&quot;</span> \<br></code></pre></td></tr></table></figure><h1 id="for-mpasv8.1.0">For MPASv8.1.0,</h1><p><a href="https://github.com/MPAS-Dev/MPAS-Model/releases/tag/v8.1.0" class="uri">https://github.com/MPAS-Dev/MPAS-Model/releases/tag/v8.1.0</a></p><p>The top-level Makefile provides a new intel build target for the Intel oneAPI Fortran, C, and C++ compiler suite. {:.info}</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs sh">intel-mpi:   <span class="hljs-comment"># BUILDTARGET Intel compiler suite with Intel MPI library</span><br>( $(MAKE) all \<br><span class="hljs-string">&quot;FC_PARALLEL = mpiifort&quot;</span> \<br><span class="hljs-string">&quot;CC_PARALLEL = mpiicc&quot;</span> \<br><span class="hljs-string">&quot;CXX_PARALLEL = mpiicpc&quot;</span> \<br><span class="hljs-string">&quot;FC_SERIAL = ifort&quot;</span> \<br><span class="hljs-string">&quot;CC_SERIAL = icc&quot;</span> \<br><span class="hljs-string">&quot;CXX_SERIAL = icpc&quot;</span> \<br><span class="hljs-string">&quot;FFLAGS_PROMOTION = -real-size 64&quot;</span> \<br><span class="hljs-string">&quot;FFLAGS_OPT = -O3 -convert big_endian -free -align array64byte&quot;</span> \<br><span class="hljs-string">&quot;CFLAGS_OPT = -O3&quot;</span> \<br><span class="hljs-string">&quot;CXXFLAGS_OPT = -O3&quot;</span> \<br><span class="hljs-string">&quot;LDFLAGS_OPT = -O3&quot;</span> \<br><span class="hljs-string">&quot;FFLAGS_DEBUG = -g -convert big_endian -free -CU -CB -check all -fpe0 -traceback&quot;</span> \<br><span class="hljs-string">&quot;CFLAGS_DEBUG = -g -traceback&quot;</span> \<br><span class="hljs-string">&quot;CXXFLAGS_DEBUG = -g -traceback&quot;</span> \<br><span class="hljs-string">&quot;LDFLAGS_DEBUG = -g -fpe0 -traceback&quot;</span> \<br><span class="hljs-string">&quot;FFLAGS_OMP = -qopenmp&quot;</span> \<br><span class="hljs-string">&quot;CFLAGS_OMP = -qopenmp&quot;</span> \<br><span class="hljs-string">&quot;PICFLAG = -fpic&quot;</span> \<br><span class="hljs-string">&quot;BUILD_TARGET = <span class="hljs-subst">$(@)</span>&quot;</span> \<br><span class="hljs-string">&quot;CORE = <span class="hljs-subst">$(CORE)</span>&quot;</span> \<br><span class="hljs-string">&quot;DEBUG = <span class="hljs-subst">$(DEBUG)</span>&quot;</span> \<br><span class="hljs-string">&quot;USE_PAPI = <span class="hljs-subst">$(USE_PAPI)</span>&quot;</span> \<br><span class="hljs-string">&quot;OPENMP = <span class="hljs-subst">$(OPENMP)</span>&quot;</span> \<br><span class="hljs-string">&quot;CPPFLAGS = <span class="hljs-subst">$(MODEL_FORMULATION)</span> -D_MPI&quot;</span> )<br></code></pre></td></tr></table></figure><p>$ make intel-mpi CORE=core options {:.info}</p>]]></content>
    
    
    <categories>
      
      <category>MPAS</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Installation</tag>
      
      <tag>MPAS</tag>
      
      <tag>Spack</tag>
      
      <tag>Intel</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MPAS | install ParallelIO-pio2_5_8</title>
    <link href="/2024/05/31/MPAS_install_ParallelIO-pio2_error/"/>
    <url>/2024/05/31/MPAS_install_ParallelIO-pio2_error/</url>
    
    <content type="html"><![CDATA[<h1 id="issue-solution">Issue &amp; solution</h1><ol type="1"><li><p>needs cmake &gt; $ micromamba env create -n mpas_env python=3.9 &gt; micromamba install anaconda::cmake</p></li><li><p>cmake</p></li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">export</span> libs_DIR=<span class="hljs-variable">$HOME</span>/Library/<br><span class="hljs-comment">### Compilers</span><br><span class="hljs-built_in">export</span> MPI_FC=mpifort<br><span class="hljs-built_in">export</span> MPI_F77=mpifort<br><span class="hljs-built_in">export</span> MPI_F90=mpifort<br><span class="hljs-built_in">export</span> MPI_CC=mpicc<br><span class="hljs-built_in">export</span> MPI_CXX=mpic++<br><span class="hljs-comment">### all serial are same as MPI</span><br><span class="hljs-built_in">export</span> FC=<span class="hljs-variable">$&#123;MPI_FC&#125;</span><br><span class="hljs-built_in">export</span> F77=<span class="hljs-variable">$&#123;MPI_F77&#125;</span><br><span class="hljs-built_in">export</span> F90=<span class="hljs-variable">$&#123;MPI_F77&#125;</span><br><span class="hljs-built_in">export</span> CC=<span class="hljs-variable">$&#123;MPI_F77&#125;</span><br><span class="hljs-built_in">export</span> CXX=<span class="hljs-variable">$&#123;MPI_F77&#125;</span><br></code></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">############################## Pio ############################</span><br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$&#123;do_pio&#125;</span> == True ]]; <span class="hljs-keyword">then</span><br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== PIO ====&quot;</span><br>    <span class="hljs-built_in">cd</span> <span class="hljs-variable">$download_DIR</span><br>    tar xvf ParallelIO-pio2_5_8.tar.gz 1&gt;/dev/null 2&gt;&amp;1<br>    <span class="hljs-built_in">cd</span> ParallelIO-pio2_5_8/<br><br>    <span class="hljs-built_in">export</span> CC=mpicc <br>    <span class="hljs-built_in">export</span> FC=mpif90 <br>    <span class="hljs-comment">#./configure --prefix=$libs_DIR --enable-fortran</span><br>    <span class="hljs-comment">#cmake -DNetCDF_C_PATH=$libs_DIR -DNetCDF_Fortran_PATH=$libs_DIR -DPnetCDF_PATH=$libs_DIR -DPIO_ENABLE_TIMING=OFF -DCMAKE_INSTALL_PREFIX=$libs_DIR</span><br>    cmake -DNetCDF_C_PATH=<span class="hljs-variable">$NETCDF</span> -DNetCDF_Fortran_PATH=<span class="hljs-variable">$NETCDF</span> -DPnetCDF_PATH=<span class="hljs-variable">$PNETCDF</span> -DHDF5_PATH=<span class="hljs-variable">$libs_DIR</span> -DCMAKE_INSTALL_PREFIX=<span class="hljs-variable">$libs_DIR</span> -DPIO_USE_MALLOC=ON -DCMAKE_VERBOSE_MAKEFILE=1 -DPIO_ENABLE_TIMING=OFF ./<br>    make<br>    <span class="hljs-comment">#make check</span><br>    make install<br>    <span class="hljs-built_in">cd</span> ..<br>    <span class="hljs-built_in">rm</span> -rf ParallelIO-pio2_5_8<br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== PIO (end) ====&quot;</span><br><span class="hljs-keyword">fi</span><br></code></pre></td></tr></table></figure><p>where ./ is PIO directory.</p><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs basic"><span class="hljs-symbol">568 </span>Install the project...<br><span class="hljs-symbol">569 </span>/home/wpsze/micromamba/envs/mpas_env/bin/cmake -P cmake_install.cmake<br><span class="hljs-symbol">570 </span>-- Install configuration: <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-symbol">571 </span>-- Installing: /home/wpsze/MPAS-A/modules_library/Library/lib/libpio.settings<br><span class="hljs-symbol">572 </span>-- Installing: /home/wpsze/MPAS-A/modules_library/Library/lib/libpioc.a<br><span class="hljs-symbol">573 </span>-- Installing: /home/wpsze/MPAS-A/modules_library/Library/include/pio.h<br><span class="hljs-symbol">574 </span>-- Installing: /home/wpsze/MPAS-A/modules_library/Library/include/uthash.h<br><span class="hljs-symbol">575 </span>-- Installing: /home/wpsze/MPAS-A/modules_library/Library/lib/libpiof.a<br><span class="hljs-symbol">576 </span>-- Installing: /home/wpsze/MPAS-A/modules_library/Library/include/pio.<span class="hljs-keyword">mod</span><br><span class="hljs-symbol">577 </span>-- Installing: /home/wpsze/MPAS-A/modules_library/Library/include/pio_nf.<span class="hljs-keyword">mod</span><br><span class="hljs-symbol">578 </span>-- Installing: /home/wpsze/MPAS-A/modules_library/Library/include/pio_types.<span class="hljs-keyword">mod</span><br><span class="hljs-symbol">579 </span>-- Installing: /home/wpsze/MPAS-A/modules_library/Library/include/piolib_mod.<span class="hljs-keyword">mod</span><br><span class="hljs-symbol">580 </span>-- Installing: /home/wpsze/MPAS-A/modules_library/Library/include/pionfget_mod.<span class="hljs-keyword">mod</span><br><span class="hljs-symbol">581 </span>-- Installing: /home/wpsze/MPAS-A/modules_library/Library/include/pio_kinds.<span class="hljs-keyword">mod</span><br><span class="hljs-symbol">582 </span>-- Installing: /home/wpsze/MPAS-A/modules_library/Library/include/pio_support.<span class="hljs-keyword">mod</span><br><span class="hljs-symbol">583 </span>-- Installing: /home/wpsze/MPAS-A/modules_library/Library/include/piodarray.<span class="hljs-keyword">mod</span><br><span class="hljs-symbol">584 </span>-- Installing: /home/wpsze/MPAS-A/modules_library/Library/include/pionfatt_mod.<span class="hljs-keyword">mod</span><br><span class="hljs-symbol">585 </span>-- Installing: /home/wpsze/MPAS-A/modules_library/Library/include/pionfput_mod.<span class="hljs-keyword">mod</span><br></code></pre></td></tr></table></figure><p>Output files are,</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash"> $ <span class="hljs-built_in">ls</span> Library/lib/*pio*<br>Library/lib/libpioc.a  Library/lib/libpiof.a<br> $ <span class="hljs-built_in">ls</span> Library/include/*pio*<br>Library/include/H5FDmpio.h  Library/include/piodarray.mod  Library/include/piolib_mod.mod    Library/include/pionfget_mod.mod  Library/include/pio_support.mod<br>Library/include/mpiof.h     Library/include/pio.h          Library/include/pio.mod           Library/include/pio_nf.mod        Library/include/pio_types.mod<br>Library/include/mpio.h      Library/include/pio_kinds.mod  Library/include/pionfatt_mod.mod  Library/include/pionfput_mod.mod<br></code></pre></td></tr></table></figure><p>Ref: 1. <a href="https://forum.mmm.ucar.edu/threads/mpas-a-installation-failed-due-to-pio1-f90-and-pio2-f90.9902/">MPAS-A installation failed due to pio1.f90 and pio2.f90</a> 2.</p>]]></content>
    
    
    <categories>
      
      <category>MPAS</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Installation</tag>
      
      <tag>PIO</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MPAS | install Metis</title>
    <link href="/2024/05/31/MPAS_install_metis_error/"/>
    <url>/2024/05/31/MPAS_install_metis_error/</url>
    
    <content type="html"><![CDATA[<h1 id="metis---serial-graph-partitioning-and-fill-reducing-matrix-ordering">METIS - Serial Graph Partitioning and Fill-reducing Matrix Ordering</h1><p><a href="http://glaros.dtc.umn.edu/gkhome/metis/metis/overview">METIS</a> is a set of serial programs for partitioning graphs, partitioning finite element meshes, and producing fill reducing orderings for sparse matrices. The algorithms implemented in METIS are based on the multilevel recursive-bisection, multilevel k-way, and multi-constraint partitioning schemes developed in our lab.</p><h1 id="issue-solution">Issue &amp; Solution</h1><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs clean">############################## metis ############################<br><span class="hljs-keyword">if</span> [[ $&#123;do_metis&#125; == <span class="hljs-literal">True</span> ]]; then<br>echo <span class="hljs-string">&quot;=== metis ====&quot;</span><br>cd $download_DIR<br>tar xvf metis<span class="hljs-number">-5.1</span><span class="hljs-number">.0</span>.tar.gz <span class="hljs-number">1</span>&gt;/dev/null <span class="hljs-number">2</span>&gt;&amp;<span class="hljs-number">1</span><br>cd metis<span class="hljs-number">-5.1</span><span class="hljs-number">.0</span>/<br>#./configure --prefix=$libs_DIR<br><br>make config prefix=$libs_DIR<br>make<br>#make check<br>make install<br>cd ..<br>rm -rf metis<span class="hljs-number">-5.1</span><span class="hljs-number">.0</span><br>echo <span class="hljs-string">&quot;=== metis (end) ====&quot;</span><br>fi<br></code></pre></td></tr></table></figure><p>Output files are,</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash"> $ <span class="hljs-built_in">ls</span> Library/bin/*meti*<br>Library/bin/gpmetis  Library/bin/m2gmetis  Library/bin/mpmetis  Library/bin/ndmetis<br> $ <span class="hljs-built_in">ls</span> Library/lib/*meti*<br>Library/lib/libmetis.a<br> $ <span class="hljs-built_in">ls</span> Library/include/*meti*<br>Library/include/metis.h<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>MPAS</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Installation</tag>
      
      <tag>Metis</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MPAS | MPAS Installation</title>
    <link href="/2024/05/31/MPAS_installation/"/>
    <url>/2024/05/31/MPAS_installation/</url>
    
    <content type="html"><![CDATA[<h1 id="for-mpasv7.0-and-above">For MPASv7.0 and above,</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/bash</span><br><br><span class="hljs-comment">#------------------------------------------------#</span><br><span class="hljs-comment">#Author:         wpsze</span><br><span class="hljs-comment">#Emailï¼š         </span><br><span class="hljs-comment">#date:           </span><br><span class="hljs-comment">#Version:        0.0 </span><br><span class="hljs-comment">#Description:    Install libraries that MPAS needs </span><br><span class="hljs-comment">#Copyright (C)ï¼š 2022 All rights reserved</span><br><span class="hljs-comment">#------------------------------------------------#</span><br><br><span class="hljs-comment">## ./mpas_env_install_gcc10_3_0.sh 2&gt;&amp;1 |tee log.log</span><br><br><span class="hljs-comment">############################## Directory Listing ############################</span><br><span class="hljs-built_in">export</span> HOME=`<span class="hljs-built_in">pwd</span>`<br><br><span class="hljs-built_in">source</span> /home/wpsze/MPAS-A/mpas_env.sh<br><br>gcc --version<br>g++ --version<br>gfortran --version<br>mpif90 --version<br>mpicc --version<br>make --version<br>cmake --version<br><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$NETCDF</span><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$PNETCDF</span><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$PIO</span><br><br><span class="hljs-comment">##--Intel MPIä¸Open MPIã€MPICHç­‰MPIå®ç°ä¸åŒï¼š</span><br><span class="hljs-comment">##--mpiiccã€mpiicpcå’Œmpiifortå‘½ä»¤ï¼šä½¿ç”¨Intelç¼–è¯‘å™¨</span><br><span class="hljs-comment">##--mpiccã€mpif90å’Œmpifcå‘½ä»¤ï¼šé»˜è®¤ä½¿ç”¨GNUç¼–è¯‘å™¨</span><br><br>do_init_atmosphere=True <span class="hljs-comment"># True, False</span><br>do_atmosphere=True<br>do_build_tables=True<br><br>mpas_version=<span class="hljs-string">&quot;MPASv8&quot;</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Copy MPAS-Model to build-mpas ... &quot;</span><br><span class="hljs-built_in">rm</span> -rf build-mpas<br><span class="hljs-built_in">cp</span> -r MPAS-Model-8.0.0 build-mpas<br><span class="hljs-built_in">cd</span> build-mpas<br><br><span class="hljs-comment">############################## init_atmosphere ############################ -g -O0 -fbacktrace</span><br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$&#123;do_init_atmosphere&#125;</span> == True ]]; <span class="hljs-keyword">then</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== init_atmosphere ====&quot;</span><br><br>make clean CORE=init_atmosphere<br>make clean CORE=atmosphere<br><br><span class="hljs-comment"># mpas_dmpar.F:</span><br> <span class="hljs-comment"># call MPI_Allreduce(inArray, outArray, nElements, MPI_INTEGERKIND, MPI_MAX, dminfo % comm, mpi_ierr) </span><br><span class="hljs-comment"># Warning: Rank mismatch between actual argument at (1) and actual argument at (2) (scalar and rank-1)</span><br><br><span class="hljs-comment">#export FFLAGS=&quot;-w -fallow-argument-mismatch -O2&quot;</span><br><span class="hljs-comment">#export FCFLAGS=&quot;-w -fallow-argument-mismatch -O2&quot;</span><br><br><span class="hljs-comment"># make gfortran CORE=init_atmosphere PRECISION=single DEBUG=true USE_PIO2=true &gt;&amp; log_build2.txt</span><br><br>make -j8 gfortran CORE=init_atmosphere PRECISION=single USE_PIO2=<span class="hljs-literal">true</span> 2&gt;&amp;1 |<span class="hljs-built_in">tee</span> log_build_init.txt<br><br><span class="hljs-comment">### Check MPAS model.</span><br><span class="hljs-comment">#ls -la init_atmosphere_model</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== init_atmosphere (end) ====&quot;</span><br>: <span class="hljs-string">&#x27;</span><br><span class="hljs-string">*******************************************************************************</span><br><span class="hljs-string">MPAS was built with default single-precision reals.</span><br><span class="hljs-string">Debugging is off.</span><br><span class="hljs-string">Parallel version is on.</span><br><span class="hljs-string">Papi libraries are off.</span><br><span class="hljs-string">TAU Hooks are off.</span><br><span class="hljs-string">MPAS was built without OpenMP support.</span><br><span class="hljs-string">MPAS was built with .F files.</span><br><span class="hljs-string">The native timer interface is being used</span><br><span class="hljs-string">Using the PIO 2 library.</span><br><span class="hljs-string">*******************************************************************************</span><br><span class="hljs-string">make[1]: Leaving directory /home/wpsze/MPAS-A/mpasv73/MPAS-Model-7.3</span><br><span class="hljs-string">If compilation of the init_atmosphere core was successful, we should also have an executable file named init_atmosphere_model</span><br><span class="hljs-string">&#x27;</span><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-comment">############################## atmosphere_model ############################</span><br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$&#123;do_atmosphere&#125;</span> == True ]]; <span class="hljs-keyword">then</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== atmosphere_model ====&quot;</span><br><span class="hljs-comment"># To preserve all executables except atmosphere_model and clean the MPAS infrastructure, run: </span><br>make clean CORE=atmosphere<br><br><span class="hljs-comment">#export FFLAGS=&quot;-w -fallow-argument-mismatch -O2&quot;</span><br><span class="hljs-comment">#export FCFLAGS=&quot;-w -fallow-argument-mismatch -O2&quot;</span><br><br><span class="hljs-comment"># DEBUG=true</span><br><br>make gfortran CORE=atmosphere PRECISION=single USE_PIO2=<span class="hljs-literal">true</span> 2&gt;&amp;1 |<span class="hljs-built_in">tee</span> log_build_atm.txt<br><br><span class="hljs-comment">### Check MPAS model.</span><br><span class="hljs-comment">#ls -la atmosphere_model</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== atmosphere_model (end) ====&quot;</span><br>: <span class="hljs-string">&#x27;</span><br><span class="hljs-string">*******************************************************************************</span><br><span class="hljs-string">MPAS was built with default single-precision reals.</span><br><span class="hljs-string">Debugging is off.</span><br><span class="hljs-string">Parallel version is on.</span><br><span class="hljs-string">Papi libraries are off.</span><br><span class="hljs-string">TAU Hooks are off.</span><br><span class="hljs-string">MPAS was built without OpenMP support.</span><br><span class="hljs-string">MPAS was built with .F files.</span><br><span class="hljs-string">The native timer interface is being used</span><br><span class="hljs-string">Using the PIO 2 library.</span><br><span class="hljs-string">*******************************************************************************</span><br><span class="hljs-string">&#x27;</span><br><br><span class="hljs-built_in">wait</span><br><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-keyword">if</span> [[ -f atmosphere_model ]]; <span class="hljs-keyword">then</span><br><span class="hljs-built_in">mkdir</span> -p <span class="hljs-variable">$HOME</span>/<span class="hljs-variable">$&#123;mpas_version&#125;</span><br><span class="hljs-built_in">mv</span> streams.init_atmosphere <span class="hljs-variable">$HOME</span>/<span class="hljs-variable">$&#123;mpas_version&#125;</span><br><span class="hljs-built_in">mv</span> namelist.init_atmosphere <span class="hljs-variable">$HOME</span>/<span class="hljs-variable">$&#123;mpas_version&#125;</span><br><span class="hljs-built_in">mv</span> init_atmosphere_model <span class="hljs-variable">$HOME</span>/<span class="hljs-variable">$&#123;mpas_version&#125;</span><br><br><span class="hljs-built_in">mv</span> atmosphere_model <span class="hljs-variable">$HOME</span>/<span class="hljs-variable">$&#123;mpas_version&#125;</span><br><span class="hljs-built_in">mv</span> build_tables <span class="hljs-variable">$HOME</span>/<span class="hljs-variable">$&#123;mpas_version&#125;</span><br><span class="hljs-built_in">mv</span> namelist.atmosphere <span class="hljs-variable">$HOME</span>/<span class="hljs-variable">$&#123;mpas_version&#125;</span><br><span class="hljs-built_in">mv</span> streams.atmosphere <span class="hljs-variable">$HOME</span>/<span class="hljs-variable">$&#123;mpas_version&#125;</span><br><span class="hljs-built_in">mv</span> stream_list.atmosphere.diagnostics <span class="hljs-variable">$HOME</span>/<span class="hljs-variable">$&#123;mpas_version&#125;</span><br><span class="hljs-built_in">mv</span> stream_list.atmosphere.output <span class="hljs-variable">$HOME</span>/<span class="hljs-variable">$&#123;mpas_version&#125;</span><br><span class="hljs-built_in">mv</span> stream_list.atmosphere.surface <span class="hljs-variable">$HOME</span>/<span class="hljs-variable">$&#123;mpas_version&#125;</span><br><br><span class="hljs-built_in">mv</span> ./src/core_atmosphere/physics/physics_wrf/files/* <span class="hljs-variable">$HOME</span>/<span class="hljs-variable">$&#123;mpas_version&#125;</span>/<br><br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$&#123;do_build_tables&#125;</span> == True ]]; <span class="hljs-keyword">then</span><br><span class="hljs-built_in">cd</span> <span class="hljs-variable">$HOME</span>/<span class="hljs-variable">$&#123;mpas_version&#125;</span><br>./build_tables<br><span class="hljs-keyword">fi</span><br><br><span class="hljs-keyword">fi</span><br></code></pre></td></tr></table></figure><p>and,</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/bash</span><br><br><span class="hljs-comment">#------------------------------------------------#</span><br><span class="hljs-comment">#Author:         wpsze</span><br><span class="hljs-comment">#homeailï¼š        </span><br><span class="hljs-comment">#date:           </span><br><span class="hljs-comment">#Version:        0.0 </span><br><span class="hljs-comment">#Description:    Install libraries that MPAS needs </span><br><span class="hljs-comment">#Copyright (C)ï¼š 2022 All rights reserved</span><br><span class="hljs-comment">#------------------------------------------------#</span><br><br><span class="hljs-comment">############################## Directory Listing ############################</span><br><span class="hljs-built_in">export</span> HOME=`<span class="hljs-built_in">pwd</span>`<br><span class="hljs-built_in">export</span> download_DIR=<span class="hljs-variable">$HOME</span>/mpas_install/<br><span class="hljs-built_in">export</span> libs_DIR=<span class="hljs-variable">$HOME</span>/Library/<br><br><span class="hljs-built_in">export</span> PATH=/home/wpsze/GNU_GCC/Library/gcc-v9.3.0/bin:<span class="hljs-variable">$PATH</span><br><span class="hljs-built_in">export</span> LD_LIBRARY_PATH=/home/wpsze/GNU_GCC/Library/gcc-v9.3.0/lib/<span class="hljs-variable">$&#123;LD_LIBRARY_PATH:+:$LD_LIBRARY_PATH&#125;</span><br><span class="hljs-comment">#export LD_LIBRARY_PATH=/home/wpsze/GNU_GCC/Library/gcc-v9.3.0/lib:$LD_LIBRARY_PATH</span><br><span class="hljs-built_in">export</span> LD_LIBRARY_PATH=/home/wpsze/GNU_GCC/Library/gcc-v9.3.0/lib64:<span class="hljs-variable">$LD_LIBRARY_PATH</span><br><br><span class="hljs-built_in">export</span> LD_LIBRARY_PATH=<span class="hljs-variable">$libs_DIR</span>/lib:<span class="hljs-variable">$LD_LIBRARY_PATH</span><br><span class="hljs-built_in">export</span> LDFLAGS=-L<span class="hljs-variable">$libs_DIR</span>/lib<br><span class="hljs-built_in">export</span> CPPFLAGS=-I<span class="hljs-variable">$libs_DIR</span>/include<br><br><span class="hljs-built_in">source</span> /home/wpsze/micromamba/etc/profile.d/micromamba.sh <span class="hljs-comment"># install cmake</span><br>micromamba activate mpas_env<br><br>gcc --version<br>gfortran --version<br><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$HOME</span><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$download_DIR</span><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$libs_DIR</span><br><br><span class="hljs-built_in">mkdir</span> -p mpas_install<br><span class="hljs-built_in">mkdir</span> -p Library<br><br>do_download=False <span class="hljs-comment"># True or False</span><br>compile_all=True<br><br><span class="hljs-comment"># Currently Loaded Modules:</span><br><span class="hljs-comment">#  1) ncarenv/1.0 (xx)      4) ncarcompilers/1.0 (xx)  7) pnetcdf/1.11.2  10) ncview/2.1.7 (already)</span><br><span class="hljs-comment">#  2) ncarbinlibs/1.1 (xx)  5) netcdf/4.7.0        8) pio/1.9.23 (2.5.2)      11) metis/5.1.0</span><br><span class="hljs-comment">#  3) gnu/8.3.0 (done)         6) mpich/3.3.1         9) ncl/6.6.2 (already)       12) hdf5/1.10.5</span><br><br>do_mpich=False<br>do_zlib=False<br>do_hdf5=False<br>do_pnetcdf=False<br>do_netcdfC=False<br>do_netcdfF=False<br>do_pio=False<br>do_metis=True<br><br><span class="hljs-comment">############################## Downloading Libraries ############################</span><br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$do_download</span>  == True ]]; <span class="hljs-keyword">then</span><br>    <span class="hljs-built_in">cd</span> <span class="hljs-variable">$download_DIR</span><br>    wget -c https://zlib.net/zlib-1.2.13.tar.gz<br>    wget -c https://www.gfd-dennou.org/arch/netcdf/unidata-mirror/netcdf-c-4.7.4.tar.gz<br>    wget -c https://www.gfd-dennou.org/arch/netcdf/unidata-mirror/netcdf-fortran-4.5.3.tar.gz<br>    <span class="hljs-comment"># wget -c https://github.com/pmodels/mpich/releases/download/v4.0.2/mpich-4.0.2.tar.gz</span><br>    wget -c https://www.mpich.org/static/downloads/3.3.1/mpich-3.3.1.tar.gz<br>    wget -c https://parallel-netcdf.github.io/Release/pnetcdf-1.11.2.tar.gz <br>    <span class="hljs-comment"># Pio is from https://github.com/NCAR/ParallelIO/releases</span><br>    <span class="hljs-comment"># metis is from http://glaros.dtc.umn.edu/gkhome/metis/metis/download</span><br>    wget -c https://hdf-wordpress-1.s3.amazonaws.com/wp-content/uploads/manual/HDF5/HDF5_1_12_0/source/hdf5-1.12.0.tar.gz<br><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$compile_all</span> == True ]]; <span class="hljs-keyword">then</span><br><span class="hljs-comment">###################################################################</span><br><span class="hljs-built_in">export</span> LD_LIBRARY_PATH=<span class="hljs-variable">$libs_DIR</span>/lib:<span class="hljs-variable">$LD_LIBRARY_PATH</span><br><span class="hljs-built_in">export</span> LDFLAGS=-L<span class="hljs-variable">$libs_DIR</span>/lib<br><span class="hljs-built_in">export</span> CPPFLAGS=-I<span class="hljs-variable">$libs_DIR</span>/include<br><span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$libs_DIR</span>/bin:<span class="hljs-variable">$PATH</span><br><br><span class="hljs-comment">#export PNETCDF_PATH=$libs_DIR/bin:$PATH</span><br><span class="hljs-comment">#export PNETCDF=$libs_DIR/bin:$PATH</span><br><br><span class="hljs-comment">#export NETCDF_PATH=$libs_DIR/bin:$PATH</span><br><span class="hljs-comment">#export NETCDF=$libs_DIR/bin:$PATH</span><br><br><span class="hljs-comment">#export PIO=$libs_DIR/bin:$PATH</span><br><br><span class="hljs-comment">############################## MPICH ############################</span><br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$&#123;do_mpich&#125;</span>  == True ]]; <span class="hljs-keyword">then</span><br><span class="hljs-comment">#export PATH=$libs_DIR/gcc-v8.3.0/bin:$PATH</span><br><span class="hljs-comment">#export LD_LIBRARY_PATH=$libs_DIR/gcc-v8.3.0/lib:$LD_LIBRARY_PATH</span><br><span class="hljs-comment">#export LD_LIBRARY_PATH=$libs_DIR/gcc-v8.3.0/lib64:$LD_LIBRARY_PATH</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== MPICH ====&quot;</span><br><span class="hljs-built_in">cd</span> <span class="hljs-variable">$download_DIR</span><br>tar xvf mpich-4.0.2.tar.gz 1&gt;/dev/null 2&gt;&amp;1  <span class="hljs-comment"># 3.3.1 4.0.2</span><br><span class="hljs-built_in">cd</span> mpich-4.0.2/<br><br>./configure --prefix=<span class="hljs-variable">$libs_DIR</span> --with-device=ch3 <span class="hljs-comment">#--enable-pic</span><br>make -j 4<br>make check<br>make install<br><span class="hljs-comment">#make testing</span><br><span class="hljs-built_in">cd</span> ..<br><span class="hljs-built_in">rm</span> -rf mpich-4.0.2<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== MPICH (end) ====&quot;</span><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-comment">### Compilers</span><br><span class="hljs-comment">## commment out for mpich</span><br><span class="hljs-built_in">export</span> SERIAL_FC=gfortran<br><span class="hljs-built_in">export</span> SERIAL_F77=gfortran<br><span class="hljs-built_in">export</span> SERIAL_CC=gcc<br><span class="hljs-built_in">export</span> SERIAL_CXX=g++<br><span class="hljs-built_in">export</span> MPI_FC=mpifort<br><span class="hljs-built_in">export</span> MPI_F77=mpifort<br><span class="hljs-built_in">export</span> MPI_F90=mpifort<br><span class="hljs-built_in">export</span> MPI_CC=mpicc<br><span class="hljs-built_in">export</span> MPI_CXX=mpic++<br><span class="hljs-comment">### all serial are same as MPI</span><br><span class="hljs-built_in">export</span> FC=<span class="hljs-variable">$&#123;MPI_FC&#125;</span><br><span class="hljs-built_in">export</span> F77=<span class="hljs-variable">$&#123;MPI_F77&#125;</span><br><span class="hljs-built_in">export</span> F90=<span class="hljs-variable">$&#123;MPI_F77&#125;</span><br><span class="hljs-built_in">export</span> CC=<span class="hljs-variable">$&#123;MPI_F77&#125;</span><br><span class="hljs-built_in">export</span> CXX=<span class="hljs-variable">$&#123;MPI_F77&#125;</span><br><br><span class="hljs-comment">############################## zlib ############################ *** zlib test OK ***</span><br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$&#123;do_zlib&#125;</span>  == True ]]; <span class="hljs-keyword">then</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== zlib ====&quot;</span><br><span class="hljs-built_in">cd</span> <span class="hljs-variable">$download_DIR</span><br>tar xvf zlib-1.2.13.tar.gz 1&gt;/dev/null 2&gt;&amp;1 <br><span class="hljs-built_in">cd</span> zlib-1.2.13/<br><br>./configure --prefix=<span class="hljs-variable">$libs_DIR</span> <span class="hljs-comment">#--static</span><br>make -j 4<br>make install<br>make check<br><span class="hljs-built_in">cd</span> ..<br><span class="hljs-built_in">rm</span> -rf zlib-1.2.13<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== zlib (end) ====&quot;</span><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-comment">############################## HDF5 ############################ </span><br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$&#123;do_hdf5&#125;</span> == True ]]; <span class="hljs-keyword">then</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== hdf5 ====&quot;</span><br><span class="hljs-built_in">cd</span> <span class="hljs-variable">$download_DIR</span><br>tar xvf hdf5-1.12.0.tar.gz 1&gt;/dev/null 2&gt;&amp;1 <br><span class="hljs-built_in">cd</span> hdf5-1.12.0/<br><br>./configure --prefix=<span class="hljs-variable">$libs_DIR</span> --enable-parallel --with-zlib=<span class="hljs-variable">$libs_DIR</span> --enable-fortran <span class="hljs-comment">#--disable-shared</span><br>make -j 4<br>make check<br>make install<br><span class="hljs-built_in">cd</span> ..<br><span class="hljs-built_in">rm</span> -rf hdf5-1.12.0<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== hdf5 (end) ====&quot;</span><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-comment">############################## pnetcdf ############################ PnetCDF has been successfully installed </span><br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$&#123;do_pnetcdf&#125;</span> == True ]]; <span class="hljs-keyword">then</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== pnetcdf ====&quot;</span><br><span class="hljs-built_in">cd</span> <span class="hljs-variable">$download_DIR</span><br>tar xvf pnetcdf-1.11.2.tar.gz 1&gt;/dev/null 2&gt;&amp;1 <br><span class="hljs-built_in">cd</span> pnetcdf-1.11.2/<br><br>./configure --prefix=<span class="hljs-variable">$libs_DIR</span><br>make -j 4<br>make check<br>make ptest<br>make testing<br>make install<br><span class="hljs-built_in">cd</span> ..<br><span class="hljs-built_in">rm</span> -rf pnetcdf-1.11.2<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== pnetcdf (end) ====&quot;</span><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-comment">############################## netcdf-C ############################  Congratulations! You have successfully installed netCDF!</span><br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$&#123;do_netcdfC&#125;</span> == True ]]; <span class="hljs-keyword">then</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== netcdf-C ====&quot;</span><br><span class="hljs-comment">## -disable-dapï¼š--disable-dapçš„åŸå› æ˜¯ç¼ºå°‘ä¸€ä¸ªâ€˜curlâ€™çš„lib</span><br><span class="hljs-comment">## 4.1.3ä»¥åçš„ç‰ˆæœ¬Fortranå’ŒCåˆ†å¼€äº†ã€‚æŠŠdisable--netcdf-4 å†™è¿›å»ä¹Ÿæ— æ‰€è°“</span><br><span class="hljs-built_in">cd</span> <span class="hljs-variable">$download_DIR</span><br>tar xvf netcdf-c-4.7.4.tar.gz 1&gt;/dev/null 2&gt;&amp;1 <br><span class="hljs-built_in">cd</span> netcdf-c-4.7.4/<br><br><span class="hljs-comment"># have to define below parameters</span><br><span class="hljs-built_in">export</span> FC=mpifort<br><span class="hljs-built_in">export</span> F77=mpifort<br><span class="hljs-built_in">export</span> F90=mpifort<br><span class="hljs-built_in">export</span> CC=mpicc<br><span class="hljs-built_in">export</span> CXX=mpic++<br><br><span class="hljs-comment">#export LIBS=&quot;-lhdf5_hl -lhdf5 -lz -ldl&quot;</span><br><br><span class="hljs-built_in">export</span> LD_LIBRARY_PATH=<span class="hljs-variable">$libs_DIR</span>/lib:<span class="hljs-variable">$LD_LIBRARY_PATH</span><br><span class="hljs-built_in">export</span> LDFLAGS=-L<span class="hljs-variable">$libs_DIR</span>/lib<br><span class="hljs-built_in">export</span> CPPFLAGS=-I<span class="hljs-variable">$libs_DIR</span>/include<br><br><span class="hljs-comment">#./configure --prefix=$libs_DIR --disable-dap --enable-pnetcdf --enable-netcdf4 --enable-cdf5 --enable-parallel-tests --disable-shared</span><br>./configure --prefix=<span class="hljs-variable">$libs_DIR</span> --enable-shared --enable-netcdf4 --disable-filter-testing --disable-dap<br>make -j 4 <br>make check<br>make install<br><span class="hljs-built_in">cd</span> ..<br><span class="hljs-built_in">rm</span> -rf netcdf-c-4.7.4<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== netcdf-C (end) ====&quot;</span><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-comment">############################## netcdf-F ############################ </span><br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$&#123;do_netcdfF&#125;</span> == True ]]; <span class="hljs-keyword">then</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== netcdf-F ====&quot;</span><br><span class="hljs-built_in">cd</span> <span class="hljs-variable">$download_DIR</span><br>tar xvf netcdf-fortran-4.5.3.tar.gz 1&gt;/dev/null 2&gt;&amp;1 <br><span class="hljs-built_in">cd</span> netcdf-fortran-4.5.3/<br><br><br><span class="hljs-built_in">export</span> LD_LIBRARY_PATH=<span class="hljs-variable">$libs_DIR</span>/lib:<span class="hljs-variable">$LD_LIBRARY_PATH</span><br><span class="hljs-built_in">export</span> LDFLAGS=-L<span class="hljs-variable">$libs_DIR</span>/lib<br><span class="hljs-built_in">export</span> CPPFLAGS=-I<span class="hljs-variable">$libs_DIR</span>/include<br><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># configure: error: netcdf-c version 4.7.4 or greater is required</span><br><br>nc-config --cflags<br>nc-config --libs<br>./configure --prefix=<span class="hljs-variable">$libs_DIR</span> --enable-shared <span class="hljs-comment">#--enable-parallel-tests #--disable-shared</span><br><br><span class="hljs-comment">#CFLAGS=$(nc-config --cflags) LDFLAGS=$(nc-config --libs) ./configure --prefix=$libs_DIR --enable-parallel-tests #--disable-shared</span><br><br>make -j 4 <br>make check<br>make install<br><span class="hljs-built_in">cd</span> ..<br><span class="hljs-built_in">rm</span> -rf netcdf-fortran-4.5.3<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== netcdf-F (end) ====&quot;</span><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-comment">############################## Pio ############################</span><br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$&#123;do_pio&#125;</span> == True ]]; <span class="hljs-keyword">then</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== PIO ====&quot;</span><br><span class="hljs-built_in">cd</span> <span class="hljs-variable">$download_DIR</span><br>tar xvf ParallelIO-pio2_5_8.tar.gz 1&gt;/dev/null 2&gt;&amp;1<br><span class="hljs-built_in">cd</span> ParallelIO-pio2_5_8/<br><br><span class="hljs-built_in">export</span> CC=mpicc <br><span class="hljs-built_in">export</span> FC=mpif90 <br><span class="hljs-comment">#./configure --prefix=$libs_DIR --enable-fortran</span><br><span class="hljs-comment">#cmake -DNetCDF_C_PATH=$libs_DIR -DNetCDF_Fortran_PATH=$libs_DIR -DPnetCDF_PATH=$libs_DIR -DPIO_ENABLE_TIMING=OFF -DCMAKE_INSTALL_PREFIX=$libs_DIR</span><br>cmake -DNetCDF_C_PATH=<span class="hljs-variable">$NETCDF</span> -DNetCDF_Fortran_PATH=<span class="hljs-variable">$NETCDF</span> -DPnetCDF_PATH=<span class="hljs-variable">$PNETCDF</span> -DHDF5_PATH=<span class="hljs-variable">$libs_DIR</span> -DCMAKE_INSTALL_PREFIX=<span class="hljs-variable">$libs_DIR</span> -DPIO_USE_MALLOC=ON -DCMAKE_VERBOSE_MAKEFILE=1 -DPIO_ENABLE_TIMING=OFF ./<br>make<br><span class="hljs-comment">#make check</span><br>make install<br><span class="hljs-built_in">cd</span> ..<br><span class="hljs-built_in">rm</span> -rf ParallelIO-pio2_5_8<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== PIO (end) ====&quot;</span><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-comment">############################## metis ############################</span><br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$&#123;do_metis&#125;</span> == True ]]; <span class="hljs-keyword">then</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== metis ====&quot;</span><br><span class="hljs-built_in">cd</span> <span class="hljs-variable">$download_DIR</span><br>tar xvf metis-5.1.0.tar.gz 1&gt;/dev/null 2&gt;&amp;1<br><span class="hljs-built_in">cd</span> metis-5.1.0/<br><span class="hljs-comment">#./configure --prefix=$libs_DIR</span><br><br>make config prefix=<span class="hljs-variable">$libs_DIR</span><br>make<br><span class="hljs-comment">#make check</span><br>make install<br><span class="hljs-built_in">cd</span> ..<br><span class="hljs-built_in">rm</span> -rf metis-5.1.0<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== metis (end) ====&quot;</span><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-keyword">fi</span><br></code></pre></td></tr></table></figure><h1 id="for-mpasv6.3-and-before">For MPASv6.3 and before</h1><p>Install cmake, curl and unzip !!! {:.warning}</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">source</span> /home/wpsze/micromamba/etc/profile.d/micromamba.sh <span class="hljs-comment"># install cmake</span><br>micromamba activate mpas_env<br></code></pre></td></tr></table></figure><h1 id="mpas_env.sh">mpas_env.sh</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/bash</span><br><br><span class="hljs-comment">#------------------------------------------------#</span><br><span class="hljs-comment">#Author:         wpsze</span><br><span class="hljs-comment">#Emailï¼š         </span><br><span class="hljs-comment">#date:           2022-10-21 23:13:49</span><br><span class="hljs-comment">#Version:        0.0 </span><br><span class="hljs-comment">#Description:    The purpose of the script</span><br><span class="hljs-comment">#Copyright (C)ï¼š 2022 All rights reserved</span><br><span class="hljs-comment">#------------------------------------------------#</span><br><br><span class="hljs-comment"># Install: make/cmake</span><br><span class="hljs-comment"># Actually: can install gnu </span><br><span class="hljs-built_in">source</span> /home/wpsze/micromamba/etc/profile.d/micromamba.sh<br>micromamba activate mpas_env<br><br><span class="hljs-built_in">export</span> libs_DIR=/home/wpsze/MPAS-A/modules_library/Library/<br><br><span class="hljs-comment"># GCC env</span><br><span class="hljs-built_in">export</span> PATH=/home/wpsze/GNU_GCC/Library/gcc-v9.3.0/bin:<span class="hljs-variable">$PATH</span><br><span class="hljs-built_in">export</span> LD_LIBRARY_PATH=/home/wpsze/GNU_GCC/Library/gcc-v9.3.0/lib/<span class="hljs-variable">$&#123;LD_LIBRARY_PATH:+:$LD_LIBRARY_PATH&#125;</span><br><span class="hljs-built_in">export</span> LD_LIBRARY_PATH=/home/wpsze/GNU_GCC/Library/gcc-v9.3.0/lib64:<span class="hljs-variable">$LD_LIBRARY_PATH</span><br><br><span class="hljs-comment"># MPAS env </span><br><span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$libs_DIR</span>/bin:<span class="hljs-variable">$PATH</span><br><span class="hljs-built_in">export</span> LD_LIBRARY_PATH=<span class="hljs-variable">$libs_DIR</span>/lib:<span class="hljs-variable">$LD_LIBRARY_PATH</span><br><span class="hljs-built_in">export</span> LDFLAGS=-L<span class="hljs-variable">$libs_DIR</span>/lib<br><span class="hljs-built_in">export</span> CPPFLAGS=-I<span class="hljs-variable">$libs_DIR</span>/include<br><br><span class="hljs-built_in">export</span> PNETCDF_PATH=<span class="hljs-variable">$libs_DIR</span><br><span class="hljs-built_in">export</span> PNETCDF=<span class="hljs-variable">$libs_DIR</span><br><span class="hljs-built_in">export</span> NETCDF_PATH=<span class="hljs-variable">$libs_DIR</span><br><span class="hljs-built_in">export</span> NETCDF=<span class="hljs-variable">$libs_DIR</span><br><span class="hljs-built_in">export</span> PIO=<span class="hljs-variable">$libs_DIR</span><br><br><span class="hljs-comment">##--Intel MPIä¸Open MPIã€MPICHç­‰MPIå®ç°ä¸åŒï¼š</span><br><span class="hljs-comment">##--mpiiccã€mpiicpcå’Œmpiifortå‘½ä»¤ï¼šä½¿ç”¨Intelç¼–è¯‘å™¨</span><br><span class="hljs-comment">##--mpiccã€mpif90å’Œmpifcå‘½ä»¤ï¼šé»˜è®¤ä½¿ç”¨GNUç¼–è¯‘å™¨</span><br><span class="hljs-comment">## </span><br><span class="hljs-built_in">export</span> FC=mpifort<br><span class="hljs-built_in">export</span> F77=mpifort<br><span class="hljs-built_in">export</span> F90=mpifort<br><span class="hljs-built_in">export</span> CC=mpicc<br><span class="hljs-built_in">export</span> MPIF90=mpifort<br><span class="hljs-built_in">export</span> MPIF77=mpifort<br><span class="hljs-built_in">export</span> MPIFC=mpifort<br><span class="hljs-built_in">export</span> MPICC=mpicc<br><br>gcc --version<br>gfortran --version<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>MPAS</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Installation</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MPAS | MPAS Installation (More)</title>
    <link href="/2024/05/31/MPAS_installation_more/"/>
    <url>/2024/05/31/MPAS_installation_more/</url>
    
    <content type="html"><![CDATA[<p>The repository URL can be found from the MPAS GitHub page at <a href="https://github.com/MPAS-Dev/MPAS-Model" class="uri">https://github.com/MPAS-Dev/MPAS-Model</a></p><h1 id="compiling-mpas">Compiling MPAS</h1><p>There is no â€œconfigurationâ€ step for MPAS, unlike, e.g., for the WRF model - All build flags are either set in the top-level Makefile or on the command-line General MPAS build command:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ make target CORE=core options<br></code></pre></td></tr></table></figure><p>target can be either - <strong>clean</strong> or - <strong>gfortran</strong> - <strong>ifort</strong> - nvhpc - llvm - <strong>intel-mpi (MPASv8.1.0)</strong> ... plus a few others...</p><p>For MPAS-Atmosphere, core may be - atmosphere - init_atmosphere</p><p>options can be zero or more of - <strong>DEBUG=true</strong> - AUTOCLEAN=true - <strong>PRECISION=single</strong> - OPENMP=true</p><p>Typical build of both the init_atmosphere and atmosphere cores involves:</p><ul><li>make gfortran CORE=init_atmosphere (build init_atmosphere_model)</li><li>make clean CORE=atmosphere (clean any infrastructure files used by both init_atmosphere and atmosphere)</li><li>make gfortran CORE=atmosphere (build atmosphere_model)</li></ul><p>By default, MPAS cores are built with double-precision reals</p><p>MPAS-Atmosphere can be built in single precision - Add PRECISION=single to build commands for single-precision executables - <strong>execution time ~35% less compared with double-precision</strong> - output files approximately half as large</p><p>For mpich, - see https://www.mpich.org/static/downloads/4.2.0/mpich-4.2.0-installguide.pdf</p><h1 id="for-mpasv7.0">For MPASv7.0,</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/bash</span><br><br><span class="hljs-comment">#------------------------------------------------#</span><br><span class="hljs-comment">#Author:         wpsze</span><br><span class="hljs-comment">#Emailï¼š         </span><br><span class="hljs-comment">#date:           </span><br><span class="hljs-comment">#Version:        0.0 </span><br><span class="hljs-comment">#Description:    Install libraries that MPAS needs </span><br><span class="hljs-comment">#Copyright (C)ï¼š 2022 All rights reserved</span><br><span class="hljs-comment">#------------------------------------------------#</span><br><br><span class="hljs-comment">## ./mpas_env_install_gcc10_3_0.sh 2&gt;&amp;1 |tee log.log</span><br><br><span class="hljs-comment">############################## Directory Listing ############################</span><br><span class="hljs-built_in">export</span> HOME=`<span class="hljs-built_in">pwd</span>`<br><br><span class="hljs-built_in">source</span> /home/wpsze/MPAS-A/mpas_env.sh<br><br>gcc --version<br>g++ --version<br>gfortran --version<br>mpif90 --version<br>mpicc --version<br>make --version<br>cmake --version<br><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$NETCDF</span><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$PNETCDF</span><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$PIO</span><br><br><span class="hljs-comment">##--Intel MPIä¸Open MPIã€MPICHç­‰MPIå®ç°ä¸åŒï¼š</span><br><span class="hljs-comment">##--mpiiccã€mpiicpcå’Œmpiifortå‘½ä»¤ï¼šä½¿ç”¨Intelç¼–è¯‘å™¨</span><br><span class="hljs-comment">##--mpiccã€mpif90å’Œmpifcå‘½ä»¤ï¼šé»˜è®¤ä½¿ç”¨GNUç¼–è¯‘å™¨</span><br><br>do_init_atmosphere=True <span class="hljs-comment"># True, False</span><br>do_atmosphere=True<br>do_build_tables=True<br><br>mpas_version=<span class="hljs-string">&quot;MPASv8&quot;</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Copy MPAS-Model to build-mpas ... &quot;</span><br><span class="hljs-built_in">rm</span> -rf build-mpas<br><span class="hljs-built_in">cp</span> -r MPAS-Model-8.0.0 build-mpas<br><span class="hljs-built_in">cd</span> build-mpas<br><br><span class="hljs-comment">############################## init_atmosphere ############################ -g -O0 -fbacktrace</span><br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$&#123;do_init_atmosphere&#125;</span> == True ]]; <span class="hljs-keyword">then</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== init_atmosphere ====&quot;</span><br><br>make clean CORE=init_atmosphere<br>make clean CORE=atmosphere<br><br><span class="hljs-comment"># mpas_dmpar.F:</span><br> <span class="hljs-comment"># call MPI_Allreduce(inArray, outArray, nElements, MPI_INTEGERKIND, MPI_MAX, dminfo % comm, mpi_ierr) </span><br><span class="hljs-comment"># Warning: Rank mismatch between actual argument at (1) and actual argument at (2) (scalar and rank-1)</span><br><br><span class="hljs-comment">#export FFLAGS=&quot;-w -fallow-argument-mismatch -O2&quot;</span><br><span class="hljs-comment">#export FCFLAGS=&quot;-w -fallow-argument-mismatch -O2&quot;</span><br><br><span class="hljs-comment"># make gfortran CORE=init_atmosphere PRECISION=single DEBUG=true USE_PIO2=true &gt;&amp; log_build2.txt</span><br><br>make -j8 gfortran CORE=init_atmosphere PRECISION=single USE_PIO2=<span class="hljs-literal">true</span> 2&gt;&amp;1 |<span class="hljs-built_in">tee</span> log_build_init.txt<br><br><span class="hljs-comment">### Check MPAS model.</span><br><span class="hljs-comment">#ls -la init_atmosphere_model</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== init_atmosphere (end) ====&quot;</span><br>: <span class="hljs-string">&#x27;</span><br><span class="hljs-string">*******************************************************************************</span><br><span class="hljs-string">MPAS was built with default single-precision reals.</span><br><span class="hljs-string">Debugging is off.</span><br><span class="hljs-string">Parallel version is on.</span><br><span class="hljs-string">Papi libraries are off.</span><br><span class="hljs-string">TAU Hooks are off.</span><br><span class="hljs-string">MPAS was built without OpenMP support.</span><br><span class="hljs-string">MPAS was built with .F files.</span><br><span class="hljs-string">The native timer interface is being used</span><br><span class="hljs-string">Using the PIO 2 library.</span><br><span class="hljs-string">*******************************************************************************</span><br><span class="hljs-string">make[1]: Leaving directory /home/wpsze/MPAS-A/mpasv73/MPAS-Model-7.3</span><br><span class="hljs-string">If compilation of the init_atmosphere core was successful, we should also have an executable file named init_atmosphere_model</span><br><span class="hljs-string">&#x27;</span><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-comment">############################## atmosphere_model ############################</span><br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$&#123;do_atmosphere&#125;</span> == True ]]; <span class="hljs-keyword">then</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== atmosphere_model ====&quot;</span><br><span class="hljs-comment"># To preserve all executables except atmosphere_model and clean the MPAS infrastructure, run: </span><br>make clean CORE=atmosphere<br><br><span class="hljs-comment">#export FFLAGS=&quot;-w -fallow-argument-mismatch -O2&quot;</span><br><span class="hljs-comment">#export FCFLAGS=&quot;-w -fallow-argument-mismatch -O2&quot;</span><br><br><span class="hljs-comment"># DEBUG=true</span><br><br>make gfortran CORE=atmosphere PRECISION=single USE_PIO2=<span class="hljs-literal">true</span> 2&gt;&amp;1 |<span class="hljs-built_in">tee</span> log_build_atm.txt<br><br><span class="hljs-comment">### Check MPAS model.</span><br><span class="hljs-comment">#ls -la atmosphere_model</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== atmosphere_model (end) ====&quot;</span><br>: <span class="hljs-string">&#x27;</span><br><span class="hljs-string">*******************************************************************************</span><br><span class="hljs-string">MPAS was built with default single-precision reals.</span><br><span class="hljs-string">Debugging is off.</span><br><span class="hljs-string">Parallel version is on.</span><br><span class="hljs-string">Papi libraries are off.</span><br><span class="hljs-string">TAU Hooks are off.</span><br><span class="hljs-string">MPAS was built without OpenMP support.</span><br><span class="hljs-string">MPAS was built with .F files.</span><br><span class="hljs-string">The native timer interface is being used</span><br><span class="hljs-string">Using the PIO 2 library.</span><br><span class="hljs-string">*******************************************************************************</span><br><span class="hljs-string">&#x27;</span><br><br><span class="hljs-built_in">wait</span><br><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-keyword">if</span> [[ -f atmosphere_model ]]; <span class="hljs-keyword">then</span><br><span class="hljs-built_in">mkdir</span> -p <span class="hljs-variable">$HOME</span>/<span class="hljs-variable">$&#123;mpas_version&#125;</span><br><span class="hljs-built_in">mv</span> streams.init_atmosphere <span class="hljs-variable">$HOME</span>/<span class="hljs-variable">$&#123;mpas_version&#125;</span><br><span class="hljs-built_in">mv</span> namelist.init_atmosphere <span class="hljs-variable">$HOME</span>/<span class="hljs-variable">$&#123;mpas_version&#125;</span><br><span class="hljs-built_in">mv</span> init_atmosphere_model <span class="hljs-variable">$HOME</span>/<span class="hljs-variable">$&#123;mpas_version&#125;</span><br><br><span class="hljs-built_in">mv</span> atmosphere_model <span class="hljs-variable">$HOME</span>/<span class="hljs-variable">$&#123;mpas_version&#125;</span><br><span class="hljs-built_in">mv</span> build_tables <span class="hljs-variable">$HOME</span>/<span class="hljs-variable">$&#123;mpas_version&#125;</span><br><span class="hljs-built_in">mv</span> namelist.atmosphere <span class="hljs-variable">$HOME</span>/<span class="hljs-variable">$&#123;mpas_version&#125;</span><br><span class="hljs-built_in">mv</span> streams.atmosphere <span class="hljs-variable">$HOME</span>/<span class="hljs-variable">$&#123;mpas_version&#125;</span><br><span class="hljs-built_in">mv</span> stream_list.atmosphere.diagnostics <span class="hljs-variable">$HOME</span>/<span class="hljs-variable">$&#123;mpas_version&#125;</span><br><span class="hljs-built_in">mv</span> stream_list.atmosphere.output <span class="hljs-variable">$HOME</span>/<span class="hljs-variable">$&#123;mpas_version&#125;</span><br><span class="hljs-built_in">mv</span> stream_list.atmosphere.surface <span class="hljs-variable">$HOME</span>/<span class="hljs-variable">$&#123;mpas_version&#125;</span><br><br><span class="hljs-built_in">mv</span> ./src/core_atmosphere/physics/physics_wrf/files/* <span class="hljs-variable">$HOME</span>/<span class="hljs-variable">$&#123;mpas_version&#125;</span>/<br><br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$&#123;do_build_tables&#125;</span> == True ]]; <span class="hljs-keyword">then</span><br><span class="hljs-built_in">cd</span> <span class="hljs-variable">$HOME</span>/<span class="hljs-variable">$&#123;mpas_version&#125;</span><br>./build_tables<br><span class="hljs-keyword">fi</span><br><br><span class="hljs-keyword">fi</span><br></code></pre></td></tr></table></figure><p>and,</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/bash</span><br><br><span class="hljs-comment">#------------------------------------------------#</span><br><span class="hljs-comment">#Author:         wpsze</span><br><span class="hljs-comment">#homeailï¼š        </span><br><span class="hljs-comment">#date:           </span><br><span class="hljs-comment">#Version:        0.0 </span><br><span class="hljs-comment">#Description:    Install libraries that MPAS needs </span><br><span class="hljs-comment">#Copyright (C)ï¼š 2022 All rights reserved</span><br><span class="hljs-comment">#------------------------------------------------#</span><br><br><span class="hljs-comment">############################## Directory Listing ############################</span><br><span class="hljs-built_in">export</span> HOME=`<span class="hljs-built_in">pwd</span>`<br><span class="hljs-built_in">export</span> download_DIR=<span class="hljs-variable">$HOME</span>/mpas_install/<br><span class="hljs-built_in">export</span> libs_DIR=<span class="hljs-variable">$HOME</span>/Library/<br><br><span class="hljs-built_in">export</span> PATH=/home/wpsze/GNU_GCC/Library/gcc-v9.3.0/bin:<span class="hljs-variable">$PATH</span><br><span class="hljs-built_in">export</span> LD_LIBRARY_PATH=/home/wpsze/GNU_GCC/Library/gcc-v9.3.0/lib/<span class="hljs-variable">$&#123;LD_LIBRARY_PATH:+:$LD_LIBRARY_PATH&#125;</span><br><span class="hljs-comment">#export LD_LIBRARY_PATH=/home/wpsze/GNU_GCC/Library/gcc-v9.3.0/lib:$LD_LIBRARY_PATH</span><br><span class="hljs-built_in">export</span> LD_LIBRARY_PATH=/home/wpsze/GNU_GCC/Library/gcc-v9.3.0/lib64:<span class="hljs-variable">$LD_LIBRARY_PATH</span><br><br><span class="hljs-built_in">export</span> LD_LIBRARY_PATH=<span class="hljs-variable">$libs_DIR</span>/lib:<span class="hljs-variable">$LD_LIBRARY_PATH</span><br><span class="hljs-built_in">export</span> LDFLAGS=-L<span class="hljs-variable">$libs_DIR</span>/lib<br><span class="hljs-built_in">export</span> CPPFLAGS=-I<span class="hljs-variable">$libs_DIR</span>/include<br><br><span class="hljs-built_in">source</span> /home/wpsze/micromamba/etc/profile.d/micromamba.sh <span class="hljs-comment"># install cmake</span><br>micromamba activate mpas_env<br><br>gcc --version<br>gfortran --version<br><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$HOME</span><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$download_DIR</span><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$libs_DIR</span><br><br><span class="hljs-built_in">mkdir</span> -p mpas_install<br><span class="hljs-built_in">mkdir</span> -p Library<br><br>do_download=False <span class="hljs-comment"># True or False</span><br>compile_all=True<br><br><span class="hljs-comment"># Currently Loaded Modules:</span><br><span class="hljs-comment">#  1) ncarenv/1.0 (xx)      4) ncarcompilers/1.0 (xx)  7) pnetcdf/1.11.2  10) ncview/2.1.7 (already)</span><br><span class="hljs-comment">#  2) ncarbinlibs/1.1 (xx)  5) netcdf/4.7.0        8) pio/1.9.23 (2.5.2)      11) metis/5.1.0</span><br><span class="hljs-comment">#  3) gnu/8.3.0 (done)         6) mpich/3.3.1         9) ncl/6.6.2 (already)       12) hdf5/1.10.5</span><br><br>do_mpich=False<br>do_zlib=False<br>do_hdf5=False<br>do_pnetcdf=False<br>do_netcdfC=False<br>do_netcdfF=False<br>do_pio=False<br>do_metis=True<br><br><span class="hljs-comment">############################## Downloading Libraries ############################</span><br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$do_download</span>  == True ]]; <span class="hljs-keyword">then</span><br>    <span class="hljs-built_in">cd</span> <span class="hljs-variable">$download_DIR</span><br>    wget -c https://zlib.net/zlib-1.2.13.tar.gz<br>    wget -c https://www.gfd-dennou.org/arch/netcdf/unidata-mirror/netcdf-c-4.7.4.tar.gz<br>    wget -c https://www.gfd-dennou.org/arch/netcdf/unidata-mirror/netcdf-fortran-4.5.3.tar.gz<br>    <span class="hljs-comment"># wget -c https://github.com/pmodels/mpich/releases/download/v4.0.2/mpich-4.0.2.tar.gz</span><br>    wget -c https://www.mpich.org/static/downloads/3.3.1/mpich-3.3.1.tar.gz<br>    wget -c https://parallel-netcdf.github.io/Release/pnetcdf-1.11.2.tar.gz <br>    <span class="hljs-comment"># Pio is from https://github.com/NCAR/ParallelIO/releases</span><br>    <span class="hljs-comment"># metis is from http://glaros.dtc.umn.edu/gkhome/metis/metis/download</span><br>    wget -c https://hdf-wordpress-1.s3.amazonaws.com/wp-content/uploads/manual/HDF5/HDF5_1_12_0/source/hdf5-1.12.0.tar.gz<br><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$compile_all</span> == True ]]; <span class="hljs-keyword">then</span><br><span class="hljs-comment">###################################################################</span><br><span class="hljs-built_in">export</span> LD_LIBRARY_PATH=<span class="hljs-variable">$libs_DIR</span>/lib:<span class="hljs-variable">$LD_LIBRARY_PATH</span><br><span class="hljs-built_in">export</span> LDFLAGS=-L<span class="hljs-variable">$libs_DIR</span>/lib<br><span class="hljs-built_in">export</span> CPPFLAGS=-I<span class="hljs-variable">$libs_DIR</span>/include<br><span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$libs_DIR</span>/bin:<span class="hljs-variable">$PATH</span><br><br><span class="hljs-comment">#export PNETCDF_PATH=$libs_DIR/bin:$PATH</span><br><span class="hljs-comment">#export PNETCDF=$libs_DIR/bin:$PATH</span><br><br><span class="hljs-comment">#export NETCDF_PATH=$libs_DIR/bin:$PATH</span><br><span class="hljs-comment">#export NETCDF=$libs_DIR/bin:$PATH</span><br><br><span class="hljs-comment">#export PIO=$libs_DIR/bin:$PATH</span><br><br><span class="hljs-comment">############################## MPICH ############################</span><br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$&#123;do_mpich&#125;</span>  == True ]]; <span class="hljs-keyword">then</span><br><span class="hljs-comment">#export PATH=$libs_DIR/gcc-v8.3.0/bin:$PATH</span><br><span class="hljs-comment">#export LD_LIBRARY_PATH=$libs_DIR/gcc-v8.3.0/lib:$LD_LIBRARY_PATH</span><br><span class="hljs-comment">#export LD_LIBRARY_PATH=$libs_DIR/gcc-v8.3.0/lib64:$LD_LIBRARY_PATH</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== MPICH ====&quot;</span><br><span class="hljs-built_in">cd</span> <span class="hljs-variable">$download_DIR</span><br>tar xvf mpich-4.0.2.tar.gz 1&gt;/dev/null 2&gt;&amp;1  <span class="hljs-comment"># 3.3.1 4.0.2</span><br><span class="hljs-built_in">cd</span> mpich-4.0.2/<br><br>./configure --prefix=<span class="hljs-variable">$libs_DIR</span> --with-device=ch3 <span class="hljs-comment">#--enable-pic</span><br>make -j 4<br>make check<br>make install<br><span class="hljs-comment">#make testing</span><br><span class="hljs-built_in">cd</span> ..<br><span class="hljs-built_in">rm</span> -rf mpich-4.0.2<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== MPICH (end) ====&quot;</span><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-comment">### Compilers</span><br><span class="hljs-comment">## commment out for mpich !!</span><br><span class="hljs-built_in">export</span> SERIAL_FC=gfortran<br><span class="hljs-built_in">export</span> SERIAL_F77=gfortran<br><span class="hljs-built_in">export</span> SERIAL_CC=gcc<br><span class="hljs-built_in">export</span> SERIAL_CXX=g++<br><span class="hljs-built_in">export</span> MPI_FC=mpifort<br><span class="hljs-built_in">export</span> MPI_F77=mpifort<br><span class="hljs-built_in">export</span> MPI_F90=mpifort<br><span class="hljs-built_in">export</span> MPI_CC=mpicc<br><span class="hljs-built_in">export</span> MPI_CXX=mpic++<br><span class="hljs-comment">### all serial are same as MPI</span><br><span class="hljs-built_in">export</span> FC=<span class="hljs-variable">$&#123;MPI_FC&#125;</span><br><span class="hljs-built_in">export</span> F77=<span class="hljs-variable">$&#123;MPI_F77&#125;</span><br><span class="hljs-built_in">export</span> F90=<span class="hljs-variable">$&#123;MPI_F77&#125;</span><br><span class="hljs-built_in">export</span> CC=<span class="hljs-variable">$&#123;MPI_F77&#125;</span><br><span class="hljs-built_in">export</span> CXX=<span class="hljs-variable">$&#123;MPI_F77&#125;</span><br><br><span class="hljs-comment">############################## zlib ############################ *** zlib test OK ***</span><br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$&#123;do_zlib&#125;</span>  == True ]]; <span class="hljs-keyword">then</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== zlib ====&quot;</span><br><span class="hljs-built_in">cd</span> <span class="hljs-variable">$download_DIR</span><br>tar xvf zlib-1.2.13.tar.gz 1&gt;/dev/null 2&gt;&amp;1 <br><span class="hljs-built_in">cd</span> zlib-1.2.13/<br><br>./configure --prefix=<span class="hljs-variable">$libs_DIR</span> <span class="hljs-comment">#--static</span><br>make -j 4<br>make install<br>make check<br><span class="hljs-built_in">cd</span> ..<br><span class="hljs-built_in">rm</span> -rf zlib-1.2.13<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== zlib (end) ====&quot;</span><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-comment">############################## HDF5 ############################ </span><br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$&#123;do_hdf5&#125;</span> == True ]]; <span class="hljs-keyword">then</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== hdf5 ====&quot;</span><br><span class="hljs-built_in">cd</span> <span class="hljs-variable">$download_DIR</span><br>tar xvf hdf5-1.12.0.tar.gz 1&gt;/dev/null 2&gt;&amp;1 <br><span class="hljs-built_in">cd</span> hdf5-1.12.0/<br><br>./configure --prefix=<span class="hljs-variable">$libs_DIR</span> --enable-parallel --with-zlib=<span class="hljs-variable">$libs_DIR</span> --enable-fortran <span class="hljs-comment">#--disable-shared</span><br>make -j 4<br>make check<br>make install<br><span class="hljs-built_in">cd</span> ..<br><span class="hljs-built_in">rm</span> -rf hdf5-1.12.0<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== hdf5 (end) ====&quot;</span><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-comment">############################## pnetcdf ############################ PnetCDF has been successfully installed </span><br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$&#123;do_pnetcdf&#125;</span> == True ]]; <span class="hljs-keyword">then</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== pnetcdf ====&quot;</span><br><span class="hljs-built_in">cd</span> <span class="hljs-variable">$download_DIR</span><br>tar xvf pnetcdf-1.11.2.tar.gz 1&gt;/dev/null 2&gt;&amp;1 <br><span class="hljs-built_in">cd</span> pnetcdf-1.11.2/<br><br>./configure --prefix=<span class="hljs-variable">$libs_DIR</span><br>make -j 4<br>make check<br>make ptest<br>make testing<br>make install<br><span class="hljs-built_in">cd</span> ..<br><span class="hljs-built_in">rm</span> -rf pnetcdf-1.11.2<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== pnetcdf (end) ====&quot;</span><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-comment">############################## netcdf-C ############################  Congratulations! You have successfully installed netCDF!</span><br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$&#123;do_netcdfC&#125;</span> == True ]]; <span class="hljs-keyword">then</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== netcdf-C ====&quot;</span><br><span class="hljs-comment">## -disable-dapï¼š--disable-dapçš„åŸå› æ˜¯ç¼ºå°‘ä¸€ä¸ªâ€˜curlâ€™çš„lib</span><br><span class="hljs-comment">## 4.1.3ä»¥åçš„ç‰ˆæœ¬Fortranå’ŒCåˆ†å¼€äº†ã€‚æŠŠdisable--netcdf-4 å†™è¿›å»ä¹Ÿæ— æ‰€è°“</span><br><span class="hljs-built_in">cd</span> <span class="hljs-variable">$download_DIR</span><br>tar xvf netcdf-c-4.7.4.tar.gz 1&gt;/dev/null 2&gt;&amp;1 <br><span class="hljs-built_in">cd</span> netcdf-c-4.7.4/<br><br><span class="hljs-comment"># have to define below parameters</span><br><span class="hljs-built_in">export</span> FC=mpifort<br><span class="hljs-built_in">export</span> F77=mpifort<br><span class="hljs-built_in">export</span> F90=mpifort<br><span class="hljs-built_in">export</span> CC=mpicc<br><span class="hljs-built_in">export</span> CXX=mpic++<br><br><span class="hljs-comment">#export LIBS=&quot;-lhdf5_hl -lhdf5 -lz -ldl&quot;</span><br><br><span class="hljs-built_in">export</span> LD_LIBRARY_PATH=<span class="hljs-variable">$libs_DIR</span>/lib:<span class="hljs-variable">$LD_LIBRARY_PATH</span><br><span class="hljs-built_in">export</span> LDFLAGS=-L<span class="hljs-variable">$libs_DIR</span>/lib<br><span class="hljs-built_in">export</span> CPPFLAGS=-I<span class="hljs-variable">$libs_DIR</span>/include<br><br><span class="hljs-comment">#./configure --prefix=$libs_DIR --disable-dap --enable-pnetcdf --enable-netcdf4 --enable-cdf5 --enable-parallel-tests --disable-shared</span><br>./configure --prefix=<span class="hljs-variable">$libs_DIR</span> --enable-shared --enable-netcdf4 --disable-filter-testing --disable-dap<br>make -j 4 <br>make check<br>make install<br><span class="hljs-built_in">cd</span> ..<br><span class="hljs-built_in">rm</span> -rf netcdf-c-4.7.4<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== netcdf-C (end) ====&quot;</span><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-comment">############################## netcdf-F ############################ </span><br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$&#123;do_netcdfF&#125;</span> == True ]]; <span class="hljs-keyword">then</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== netcdf-F ====&quot;</span><br><span class="hljs-built_in">cd</span> <span class="hljs-variable">$download_DIR</span><br>tar xvf netcdf-fortran-4.5.3.tar.gz 1&gt;/dev/null 2&gt;&amp;1 <br><span class="hljs-built_in">cd</span> netcdf-fortran-4.5.3/<br><br><br><span class="hljs-built_in">export</span> LD_LIBRARY_PATH=<span class="hljs-variable">$libs_DIR</span>/lib:<span class="hljs-variable">$LD_LIBRARY_PATH</span><br><span class="hljs-built_in">export</span> LDFLAGS=-L<span class="hljs-variable">$libs_DIR</span>/lib<br><span class="hljs-built_in">export</span> CPPFLAGS=-I<span class="hljs-variable">$libs_DIR</span>/include<br><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># configure: error: netcdf-c version 4.7.4 or greater is required</span><br><br>nc-config --cflags<br>nc-config --libs<br>./configure --prefix=<span class="hljs-variable">$libs_DIR</span> --enable-shared <span class="hljs-comment">#--enable-parallel-tests #--disable-shared</span><br><br><span class="hljs-comment">#CFLAGS=$(nc-config --cflags) LDFLAGS=$(nc-config --libs) ./configure --prefix=$libs_DIR --enable-parallel-tests #--disable-shared</span><br><br>make -j 4 <br>make check<br>make install<br><span class="hljs-built_in">cd</span> ..<br><span class="hljs-built_in">rm</span> -rf netcdf-fortran-4.5.3<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== netcdf-F (end) ====&quot;</span><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-comment">############################## Pio ############################</span><br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$&#123;do_pio&#125;</span> == True ]]; <span class="hljs-keyword">then</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== PIO ====&quot;</span><br><span class="hljs-built_in">cd</span> <span class="hljs-variable">$download_DIR</span><br>tar xvf ParallelIO-pio2_5_8.tar.gz 1&gt;/dev/null 2&gt;&amp;1<br><span class="hljs-built_in">cd</span> ParallelIO-pio2_5_8/<br><br><span class="hljs-built_in">export</span> CC=mpicc <br><span class="hljs-built_in">export</span> FC=mpif90 <br><span class="hljs-comment">#./configure --prefix=$libs_DIR --enable-fortran</span><br><span class="hljs-comment">#cmake -DNetCDF_C_PATH=$libs_DIR -DNetCDF_Fortran_PATH=$libs_DIR -DPnetCDF_PATH=$libs_DIR -DPIO_ENABLE_TIMING=OFF -DCMAKE_INSTALL_PREFIX=$libs_DIR</span><br>cmake -DNetCDF_C_PATH=<span class="hljs-variable">$NETCDF</span> -DNetCDF_Fortran_PATH=<span class="hljs-variable">$NETCDF</span> -DPnetCDF_PATH=<span class="hljs-variable">$PNETCDF</span> -DHDF5_PATH=<span class="hljs-variable">$libs_DIR</span> -DCMAKE_INSTALL_PREFIX=<span class="hljs-variable">$libs_DIR</span> -DPIO_USE_MALLOC=ON -DCMAKE_VERBOSE_MAKEFILE=1 -DPIO_ENABLE_TIMING=OFF ./<br>make<br><span class="hljs-comment">#make check</span><br>make install<br><span class="hljs-built_in">cd</span> ..<br><span class="hljs-built_in">rm</span> -rf ParallelIO-pio2_5_8<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== PIO (end) ====&quot;</span><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-comment">############################## metis ############################</span><br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$&#123;do_metis&#125;</span> == True ]]; <span class="hljs-keyword">then</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== metis ====&quot;</span><br><span class="hljs-built_in">cd</span> <span class="hljs-variable">$download_DIR</span><br>tar xvf metis-5.1.0.tar.gz 1&gt;/dev/null 2&gt;&amp;1<br><span class="hljs-built_in">cd</span> metis-5.1.0/<br><span class="hljs-comment">#./configure --prefix=$libs_DIR</span><br><br>make config prefix=<span class="hljs-variable">$libs_DIR</span><br>make<br><span class="hljs-comment">#make check</span><br>make install<br><span class="hljs-built_in">cd</span> ..<br><span class="hljs-built_in">rm</span> -rf metis-5.1.0<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== metis (end) ====&quot;</span><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-keyword">fi</span><br></code></pre></td></tr></table></figure><h1 id="for-mpasv8.2.0">For MPASv8.2.0,</h1><ul><li><a href="https://github.com/MPAS-Dev/MPAS-Model/releases" class="uri">https://github.com/MPAS-Dev/MPAS-Model/releases</a></li></ul><p>MPAS Version 8.2.0 This release of MPAS introduces several significant changes to MPAS-Atmosphere.</p><ul><li>New physics<ul><li>The <strong>Noah-MP v5.0.1</strong> land-surface model is now available by setting</li><li><code>config_lsm_scheme = 'sf_noahmp'</code> in the <code>&amp;physics namelist group</code>.</li></ul></li><li>New static files that include the <strong>soilcomp, soilcl1, soilcl2, soilcl3, and soilcl4</strong> fields are required when activating <strong>Noah-MP</strong> in the model.</li><li>The <strong>aerosol-aware Thompson microphysics (as in WRF v4.1.4)</strong> is available by setting <code>config_microp_scheme = 'mp_thompson_aerosols'</code> in the <code>&amp;physics namelist group</code>.</li></ul><p>An aerosol climatology file (QNWFA_QNIFA_SIGMA_MONTHLY.dat) is used when running the init_atmosphere_model program to produce initial and lateral boundary conditions for <code>nifa</code> and <code>nwfa</code>.</p><div class="note note-danger">            <p>It includes Noah-MP, so have to download Noah-MP Geographical Input Data (soilgrids).</p>          </div><ul><li><a href="https://www2.mmm.ucar.edu/projects/mpas/mpas_static.tar.bz2">Static geographical datasets</a></li><li><a href="https://www2.mmm.ucar.edu/projects/mpas/QNWFA_QNIFA_SIGMA_MONTHLY.dat">Monthly climatological aerosol dataset (QNWFA_QNIFA_SIGMA_MONTHLY.dat)</a></li><li><a href="https://www2.mmm.ucar.edu/wrf/users/download/get_sources_wps_geog.html" class="uri">https://www2.mmm.ucar.edu/wrf/users/download/get_sources_wps_geog.html</a></li><li>NoahMP Tar File<ul><li>soilgrids</li></ul></li></ul><h1 id="for-mpasv6.3-and-before">For MPASv6.3 and before</h1><div class="note note-danger">            <p>Install cmake, curl and unzip !!!</p>          </div><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">source</span> /home/wpsze/micromamba/etc/profile.d/micromamba.sh <span class="hljs-comment"># install cmake</span><br>micromamba activate mpas_env<br></code></pre></td></tr></table></figure><h1 id="references">References</h1><ol type="1"><li><a href="https://www2.mmm.ucar.edu/people/duda/files/mpas/sources/">Notably the iolib_installation.sh script</a><ol type="1"><li>[ ] hdf5-1.10.5.tar.bz2 2019-07-11 19:36 8.3M<br /></li><li>[ ] iolib_installation.sh 2019-11-08 21:05 3.9K<br /></li><li>[ ] mpich-3.3.1.tar.gz 2019-07-11 19:36 26M<br /></li><li>[ ] netcdf-c-4.6.3.tar.gz 2019-11-09 01:48 17M<br /></li><li>[ ] netcdf-c-4.7.0.tar.gz 2019-07-11 19:36 18M<br /></li><li>[ ] netcdf-fortran-4.4.5..&gt; 2019-07-11 19:36 1.3M<br /></li><li>[ ] netcdf-fortran-4.5.2..&gt; 2019-11-09 01:48 1.0M<br /></li><li>[ ] openmpi-4.0.1.tar.bz2 2019-11-09 01:50 9.4M<br /></li><li>[ ] pnetcdf-1.11.2.tar.gz 2019-07-11 19:36 2.1M<br /></li><li>[ ] zlib-1.2.11.tar.gz 2019-07-11 19:36 593K<br /></li></ol></li><li><a href="https://forum.mmm.ucar.edu/threads/setting-the-environment-for-for-mpas-installation.10192/">Setting the environment for for MPAS installation</a></li><li><a href="https://forum.mmm.ucar.edu/threads/compiling-mpas-atmosphere-with-compass-conda-environment.14553/#post-37460">Compiling MPAS-Atmosphere with Compass Conda Environment</a></li><li><a href="https://forum.mmm.ucar.edu/threads/issue-running-mpas-a-from-restart-file.17596/#post-42923">Issue Running MPAS-A from Restart File</a></li><li><a href="https://forum.mmm.ucar.edu/threads/an-error-occurred-during-the-installation-of-libraries-for-mpas7-0.20102/#post-48844">An error occurred during the installation of libraries for MPAS7.0</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>MPAS</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Installation</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>NWP | The orographic gravity wave drag (GWDO)</title>
    <link href="/2024/05/31/NWP_gwdo/"/>
    <url>/2024/05/31/NWP_gwdo/</url>
    
    <content type="html"><![CDATA[<p>The wave stress of orography gravity wave drag scheme</p><p><span class="math display">\[\frac{\partial U}{\partial t} = - \frac{1}{\rho} \frac{\partial \tau_x}{\partial z}\]</span></p><h1 id="gwdo">GWDO</h1><h2 id="the-gravity-wave-drag-parameterization">The gravity-wave drag parameterization</h2><p><span class="math display">\[\tau_{GWD} = \rho_0 E \frac{m}{\lambda_{eff}} G \frac{|U_0|^3}{N_0} \]</span></p><h2 id="the-blocked-layer-drag-parameterization">The blocked-layer drag parameterization</h2><p><span class="math display">\[\tau_{BLD} = \frac{1}{2} \rho_0 \frac{m}{\Delta_x^2} C_d \Delta_x^{\perp} L_x^{\perp} h_B |U_0|^2\]</span></p><h1 id="references">References</h1><ol type="1"><li>Choi, H.-J., and S.-Y. Hong (2015), An updated subgrid orographic parameterization for global atmospheric forecast models, J. Geophys. Res. Atmos., 120,12,445â€“12,457, doi:10.1002/ 2015JD024230.</li><li></li></ol><h1 id="applications">Applications</h1><ol type="1"><li>å¼ æ¶µæ–Œ, å²æ°¸å¼º, å¢å†°, ç­‰. 2024. å°ºåº¦é€‚åº”é‡åŠ›æ³¢æ‹–æ›³æ–¹æ¡ˆåœ¨é«˜åˆ†è¾¨ç‡æ•°å€¼é¢„æŠ¥ä¸­çš„åº”ç”¨ç ”ç©¶[J]. å¤§æ°”ç§‘å­¦, 48(2): 789âˆ’802. DOI: 10.3878/j.issn.1006-9895.2304.22235</li></ol>]]></content>
    
    
    <categories>
      
      <category>NWP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>GWDO</tag>
      
      <tag>Parametrization</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MPAS | netcdf-c-4.7.4 final link failed - nonrepresentable section on output</title>
    <link href="/2024/05/30/MPAS_install_netcdf_c_nonrepresentable_error/"/>
    <url>/2024/05/30/MPAS_install_netcdf_c_nonrepresentable_error/</url>
    
    <content type="html"><![CDATA[<h1 id="issue">Issue</h1><p>In order to write netCDF-4 files, you must have the <strong><a href="https://www.unidata.ucar.edu/software/netcdf/">NetCDF-4 C library</a> (libnetcdf)</strong> - version 4.3.1 or above - available on your system, along with all supporting libraries (<em>libhdf5, libz, etc</em>). The details of this differ for each operating system.</p><p><strong>nc-config and libnetcdf.so</strong> are expected to be generated. And, check with</p><blockquote><p>nc-config --cflags nc-config --libs</p></blockquote><p>netcdf-c-4.7.4</p><blockquote><p>final link failed: nonrepresentable section on output</p></blockquote><h1 id="solution">Solution</h1><ul><li>[ ] have to add <strong>--disable-shared</strong> to avoid Error-ld: final link failed: nonrepresentable section on output.</li><li>[x] add -enable-static</li></ul><p>Ref:</p><ol type="1"><li><a href="https://stackoverflow.com/questions/49733534/enable-static-vs-disable-shared">--enable-static vs --disable-shared</a></li></ol><blockquote><p>In the common case that these are switches to a "configure" script generated by Autoconf and Libtool, then they officially mean closely-related, but different, things. --enable-static means <strong>do build static libraries</strong>; --disable-shared means <strong>don't build shared libraries</strong>. If you want to be sure to get only static libraries, no matter what, you need to give both options. However, often just --disable-shared will have that effect, because think about the possibilities: if the package builds only static libraries by default, then --disable-shared is a no-op; if it builds both static and shared libraries by default, then you just have to turn off the shared libraries to get what you want; and if it builds only shared libraries by default, then you might think you need both options, but if you just say --disable-shared, Libtool will usually notice that it's now being asked to build nothing, assume that that couldn't possibly be what you wanted, and flip the --enable-static switch for you.</p></blockquote><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs routeros">echo <span class="hljs-string">&quot;=== netcdf-C ====&quot;</span><br><span class="hljs-comment">## -disable-dapï¼š--disable-dapçš„åŸå› æ˜¯ç¼ºå°‘ä¸€ä¸ªâ€˜curlâ€™çš„lib</span><br><span class="hljs-comment">## 4.1.3ä»¥åçš„ç‰ˆæœ¬Fortranå’ŒCåˆ†å¼€äº†ã€‚æŠŠdisable--netcdf-4 å†™è¿›å»ä¹Ÿæ— æ‰€è°“</span><br><br>cd <span class="hljs-variable">$download_DIR</span><br>tar xvf netcdf-c-4.7.4.tar.gz 1&gt;/dev/<span class="hljs-literal">null</span> 2&gt;&amp;1 <br>cd netcdf-c-4.7.4/<br><br><span class="hljs-comment"># have to define below parameters</span><br><span class="hljs-built_in">export</span> <span class="hljs-attribute">FC</span>=mpifort<br><span class="hljs-built_in">export</span> <span class="hljs-attribute">F77</span>=mpifort<br><span class="hljs-built_in">export</span> <span class="hljs-attribute">F90</span>=mpifort<br><span class="hljs-built_in">export</span> <span class="hljs-attribute">CC</span>=mpicc<br><span class="hljs-built_in">export</span> <span class="hljs-attribute">CXX</span>=mpic++<br><br><span class="hljs-comment">###export LIBS=&quot;-lhdf5_hl -lhdf5 -lz -ldl&quot;</span><br><br><span class="hljs-built_in">export</span> <span class="hljs-attribute">LD_LIBRARY_PATH</span>=<span class="hljs-variable">$libs_DIR</span>/lib:$LD_LIBRARY_PATH<br><span class="hljs-built_in">export</span> <span class="hljs-attribute">LDFLAGS</span>=-L$libs_DIR/lib<br><span class="hljs-built_in">export</span> <span class="hljs-attribute">CPPFLAGS</span>=-I$libs_DIR/include<br><br>./configure <span class="hljs-attribute">--prefix</span>=<span class="hljs-variable">$libs_DIR</span> --enable-shared --enable-netcdf4 --disable-filter-testing --disable-dap<br>make -j 4 <br>make check<br>make install<br>cd <span class="hljs-built_in">..</span><br>rm -rf netcdf-c-4.7.4<br>echo <span class="hljs-string">&quot;=== netcdf-C (end) ====&quot;</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>MPAS</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Installation</tag>
      
      <tag>netcdf-c</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>WRF | error - jas_image_t aka struct anonymous has no member named inmem_ and image.inmem_=1</title>
    <link href="/2024/05/30/WPS_install_enc_jpeg2000_error/"/>
    <url>/2024/05/30/WPS_install_enc_jpeg2000_error/</url>
    
    <content type="html"><![CDATA[<h1 id="issue">Issue</h1><p>While compiling WPSv3.8.1,</p><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs basic"><span class="hljs-symbol">17 </span>gcc -c  -D_UNDERSCORE -DBYTESWAP -DLINUX -DIO_NETCDF -DBIT32 -DNO_SIGNAL -D_MPI -I/home/wpsze/WRF/WRFv440/Library/include/ -DUSE_JPEG2000 -DUSE_PNG -D__64BIT__ enc_jp    eg2000.c<br><span class="hljs-symbol">18 </span>enc_jpeg2000.c: In function â€˜enc_jpeg2000_â€™:<br><span class="hljs-symbol">19 </span>enc_jpeg2000.c:<span class="hljs-number">141</span>:<span class="hljs-number">10</span>: <span class="hljs-keyword">error</span>: â€˜jas_image_tâ€™ &#123;aka â€˜struct &lt;anonymous&gt;â€™&#125; has no member named â€˜inmem_â€™<br><span class="hljs-symbol">20 </span>  <span class="hljs-number">141</span> |     image.inmem_=<span class="hljs-number">1</span>;<br><span class="hljs-symbol">21 </span>      |          ^<br><span class="hljs-symbol">22 </span>make[<span class="hljs-number">2</span>]: [Makefile:<span class="hljs-number">75</span>: enc_jpeg2000.o] <span class="hljs-keyword">Error</span> <span class="hljs-number">1</span> (ignored)<br></code></pre></td></tr></table></figure><h1 id="search">Search</h1><p>From Grib2 output is broken -- <a href="https://github.com/wrf-model/WRF/issues/993" class="uri">https://github.com/wrf-model/WRF/issues/993</a></p><p>I'm unsure if the issue has been resolved, or if anyone still cares, but I think I see what might be going on here. The offending part of enc_jpeg2000.c relates to a C struct of type jas_image_t (in line 87 in the version of this file I'm looking at):</p><blockquote><p>jas_image_t image;</p></blockquote><p>It throws an error when the code tries to access the inmem_ element:</p><blockquote><pre><code class="hljs">image.inmem_=1;</code></pre></blockquote><p>This C struct is defined by jasper/jas_image.h (version 2.0.14, which is what I have on the system I'm working on). <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">/* Image class. */</span><br><br><span class="hljs-keyword">typedef</span> <span class="hljs-keyword">struct</span> &#123;<br><br>        <span class="hljs-type">jas_image_coord_t</span> tlx_;<br>        <span class="hljs-comment">/* The x-coordinate of the top-left corner of the image bounding box. */</span><br><br>        <span class="hljs-type">jas_image_coord_t</span> tly_;<br>        <span class="hljs-comment">/* The y-coordinate of the top-left corner of the image bounding box. */</span><br><br>        <span class="hljs-type">jas_image_coord_t</span> brx_;<br>        <span class="hljs-comment">/* The x-coordinate of the bottom-right corner of the image bounding</span><br><span class="hljs-comment">          box (plus one). */</span><br><br>        <span class="hljs-type">jas_image_coord_t</span> bry_;<br>        <span class="hljs-comment">/* The y-coordinate of the bottom-right corner of the image bounding</span><br><span class="hljs-comment">          box (plus one). */</span><br><br>        <span class="hljs-type">int</span> numcmpts_;<br>        <span class="hljs-comment">/* The number of components. */</span><br><br>        <span class="hljs-type">int</span> maxcmpts_;<br>        <span class="hljs-comment">/* The maximum number of components that this image can have (i.e., the</span><br><span class="hljs-comment">          allocated size of the components array). */</span><br><br>        <span class="hljs-type">jas_image_cmpt_t</span> **cmpts_;<br>        <span class="hljs-comment">/* Per-component information. */</span><br><br>        <span class="hljs-type">jas_clrspc_t</span> clrspc_;<br><br>        <span class="hljs-type">jas_cmprof_t</span> *cmprof_;<br><br><span class="hljs-comment">//      bool inmem_;</span><br><br>&#125; <span class="hljs-type">jas_image_t</span>;<br></code></pre></td></tr></table></figure></p><p>You can see that the bool component inmem_ has been commented out. If you go back to older versions of jasper you can get back to one that doesn't have inmem_ commented out. For example, in the <a href="https://github.com/jasper-software/jasper">github repo for this library</a>, that would be something like SHAH 2b2efba4eda0a654ab02 or version 1.900.24, which dates to Nov 2016.</p><h1 id="workaround">Workaround</h1><h2 id="in-wpsv3.8.1-code">In WPSv3.8.1 code</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">./ungrib/src/ngl/g2/dec_jpeg2000.c:104:    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot; inmem %d \n&quot;</span>,image-&gt;inmem_);<br>./ungrib/src/ngl/g2/enc_jpeg2000.c:141:    image.inmem_=1;<br></code></pre></td></tr></table></figure><p>and, modify enc_jpeg2000.c</p><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs actionscript"><span class="hljs-comment">/* </span><br><span class="hljs-comment"> * Does not seem to be needed, and throws a compiler error</span><br><span class="hljs-comment"> * image.inmem_=1;</span><br><span class="hljs-comment"> */</span><br></code></pre></td></tr></table></figure><p>Finally, ungrib.exe is generated.</p><p>but, is it right? will that break something...?</p><p>Ref: <a href="https://www.cnblogs.com/jiangleads/articles/11422607.html">WRF 3.9.1.1 å®‰è£… è®°å½•</a> &gt;æ­¤å¤–ï¼Œå¦‚æœå®‰è£…çš„æ˜¯è¾ƒæ–°çš„jasperç‰ˆæœ¬ï¼Œè¿˜éœ€è¦æ›´æ”¹æ–‡ä»¶enc_jpeg2000.c ï¼ˆåœ¨ç›®å½•WPS/ungrib/src/ngl/g2/enc_jpeg2000.cï¼‰ &gt; å‚è§ <a href="http://forum.wrfforum.com/viewtopic.php?f=20&amp;t=10035" class="uri">http://forum.wrfforum.com/viewtopic.php?f=20&amp;t=10035</a> &gt;å°†ç¬¬141è¡Œ &gt;&gt; image.inmem_=1; &gt;æ³¨é‡Šæ‰ &gt;è¿™æ ·ï¼Œå°±èƒ½ç”Ÿæˆungrib.exeäº†</p>]]></content>
    
    
    <categories>
      
      <category>WRF</category>
      
    </categories>
    
    
    <tags>
      
      <tag>WPS</tag>
      
      <tag>Installation</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>WRF | Error - Size of put argument of random_seed intrinsic at (1) too small</title>
    <link href="/2024/05/30/WRF_install_random_seed_error/"/>
    <url>/2024/05/30/WRF_install_random_seed_error/</url>
    
    <content type="html"><![CDATA[<h1 id="issue">Issue</h1><p>While compiling WRFv3.8.1,</p><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs basic"><span class="hljs-symbol">2065 </span><br><span class="hljs-symbol">2066 </span> <span class="hljs-number">3128</span> |                    <span class="hljs-keyword">call</span> random_seed (<span class="hljs-keyword">PUT</span>=seed)<br><span class="hljs-symbol">2067 </span>      |                                         <span class="hljs-number">1</span><br><span class="hljs-symbol">2068 </span><span class="hljs-keyword">Error</span>: Size of â€˜<span class="hljs-keyword">put</span>â€™ argument of â€˜random_seedâ€™ intrinsic at (<span class="hljs-number">1</span>) too small (<span class="hljs-number">12</span>/<span class="hljs-number">33</span>)<br><span class="hljs-symbol">2069 </span>module_cu_g3.f90:<span class="hljs-number">3217</span>:<span class="hljs-number">41</span>:<br><span class="hljs-symbol">2070 </span><br><span class="hljs-symbol">2071 </span> <span class="hljs-number">3217</span> |                    <span class="hljs-keyword">call</span> random_seed (<span class="hljs-keyword">PUT</span>=seed)<br><span class="hljs-symbol">2072 </span>      |                                         <span class="hljs-number">1</span><br><span class="hljs-symbol">2073 </span><span class="hljs-keyword">Error</span>: Size of â€˜<span class="hljs-keyword">put</span>â€™ argument of â€˜random_seedâ€™ intrinsic at (<span class="hljs-number">1</span>) too small (<span class="hljs-number">12</span>/<span class="hljs-number">33</span>)<br><span class="hljs-symbol">2074 </span>module_cu_g3.f90:<span class="hljs-number">3232</span>:<span class="hljs-number">41</span>:<br><span class="hljs-symbol">2075 </span><br><span class="hljs-symbol">2076 </span> <span class="hljs-number">3232</span> |                    <span class="hljs-keyword">call</span> random_seed (<span class="hljs-keyword">PUT</span>=seed)<br><span class="hljs-symbol">2077 </span>      |                                         <span class="hljs-number">1</span><br><span class="hljs-symbol">2078 </span><span class="hljs-keyword">Error</span>: Size of â€˜<span class="hljs-keyword">put</span>â€™ argument of â€˜random_seedâ€™ intrinsic at (<span class="hljs-number">1</span>) too small (<span class="hljs-number">12</span>/<span class="hljs-number">33</span>)<br><span class="hljs-symbol">2079 </span>make[<span class="hljs-number">3</span>]: [../configure.wrf:<span class="hljs-number">339</span>: module_cu_g3.o] <span class="hljs-keyword">Error</span> <span class="hljs-number">1</span> (ignored)<br><span class="hljs-symbol">2080 </span>rm -f module_cu_kfeta.o<br></code></pre></td></tr></table></figure><h1 id="solution">Solution</h1><p>Ref: - <a href="https://forum.mmm.ucar.edu/threads/wrfv3-9-compilation-error-on-ubuntu-18-04-lts-with-gfortran-7-4.8786/">WRFV3.9 compilation error on Ubuntu 18.04 LTS with gfortran-7.4</a> - <a href="https://forum.mmm.ucar.edu/threads/wrfv3-8-problem-building-executables.8418/">WRFV3.8 problem building executables</a> - <a href="https://forum.mmm.ucar.edu/threads/wrfv381-with-gnu8-x.217/">WRFv381 with GNU8.x</a></p><blockquote><p>This code has been corrected beginning with V4.0. I'm attaching the modified file so that you can see how we changed it. Unfortunately we didn't have a git repo when we released V3.8.1, but we can add the problems to our known problems page.</p></blockquote><p>The file is &gt; WRF/phys/module_cu_g3.F</p><p>on <a href="https://github.com/wrf-model/WRF/blob/v4.0/phys/module_cu_g3.F" class="uri">https://github.com/wrf-model/WRF/blob/v4.0/phys/module_cu_g3.F</a></p><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs gcode">$ md<span class="hljs-number">5</span>sum module_cu_<span class="hljs-name">g3.</span>F<br>e<span class="hljs-number">385527</span>b<span class="hljs-number">41</span>d<span class="hljs-number">374</span>d<span class="hljs-number">6530596</span>e<span class="hljs-number">069</span>fb<span class="hljs-number">547</span>b  module_cu_<span class="hljs-name">g3.</span>F<br></code></pre></td></tr></table></figure><h1 id="but">But</h1><blockquote><p>Fatal Error: Can't open module file 'module_initialize_real.mod' for reading at (1): No such file or directory</p></blockquote><h2 id="solution-1">Solution</h2><p>Then it should end successfully when running the command a second time (do not understand why but it works...)</p><ol type="1"><li>$ ./compile -j 8 em_real 2&gt;&amp;1 | tee compile.log</li><li>Fatal Error: Can't open module file 'module_initialize_real.mod' ...</li><li>$ ./compile -j 8 em_real 2&gt;&amp;1 | tee compile.log</li><li>Then, it works !!</li></ol><p>ref: <a href="https://valcap74.blogspot.com/2017/10/how-to-compile-wrf-model-on-ecmwf-cray.html" class="uri">https://valcap74.blogspot.com/2017/10/how-to-compile-wrf-model-on-ecmwf-cray.html</a></p>]]></content>
    
    
    <categories>
      
      <category>WRF</category>
      
    </categories>
    
    
    <tags>
      
      <tag>WRF</tag>
      
      <tag>Installation</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MPAS | MPAS-JEDI</title>
    <link href="/2024/05/29/MPAS-JEDI_note/"/>
    <url>/2024/05/29/MPAS-JEDI_note/</url>
    
    <content type="html"><![CDATA[<h1 id="workshop">Workshop</h1><ol type="1"><li><a href="http://www.gpsarc.ncu.edu.tw/MPAS2023/download.html">202310 MPAS-A and MPAS-JEDI Tutorials and Workshop, National Central University (NCU)</a></li><li><a href="https://www2.mmm.ucar.edu/projects/mpas-jedi/tutorial/202310NCU/">Welcome to the MPAS-JEDI tutorial practice guide, 202310NCU</a><ul><li>This web page is intended to serve as a guide through the practice exercises of this tutorial. Exercises are split into seven main sections, each of which focuses on a particular aspect of using the MPAS-JEDI data assimilation system.</li><li><a href="https://www2.mmm.ucar.edu/projects/mpas-jedi/tutorial/202309NCAR/testdata/">202309NCAR/testdata</a></li></ul></li><li>[202309 MPAS-JEDI Tutorial Agenda] (https://www2.mmm.ucar.edu/projects/mpas-jedi/tutorial/202309NCAR/agenda.html)</li><li><a href="https://www2.mmm.ucar.edu/projects/mpas-jedi/tutorial/202309NCAR/">Welcome to the MPAS-JEDI tutorial practice guide, 202309NCAR</a><ul><li>This web page is intended to serve as a guide through the practice exercises of this tutorial. Exercises are split into seven main sections, each of which focuses on a particular aspect of using the MPAS-JEDI data assimilation system.</li></ul></li></ol><h1 id="github">Github</h1><p><a href="https://github.com/JCSDA/mpas-jedi">MPAS-JEDI</a></p><h1 id="presentation">Presentation</h1><ol type="1"><li>2nd EarthCare Moldeling Workshop, Shuzenji, Japan, 27-29 March, 2023 Jake Liu<ul><li><a href="https://www.eorc.jaxa.jp/EARTHCARE/event/Modeling_ws2023/material1/March28/11_EarthCare2023_JakeLiu%20zhiquan%20liu.pdf">Towards global convection-permitting NWP using MPAS and MPAS-JEDI</a></li></ul></li></ol>]]></content>
    
    
    <categories>
      
      <category>MPAS</category>
      
    </categories>
    
    
    <tags>
      
      <tag>MPAS</tag>
      
      <tag>DA</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MPAS | MPAS installation - configure - RUNNING CONFIGURE FOR ch4:ucx</title>
    <link href="/2024/05/29/MPAS_install_error_CH4_UCX/"/>
    <url>/2024/05/29/MPAS_install_error_CH4_UCX/</url>
    
    <content type="html"><![CDATA[<h1 id="issue">Issue</h1><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs stata">configure: RUNNING CONFIGURE <span class="hljs-keyword">FOR</span> ch4:ucx<br>configure: CH4 UCX Netmod:  Using <span class="hljs-keyword">an</span> external ucx<br>checking <span class="hljs-keyword">if</span> UCX meets minimum <span class="hljs-keyword">version</span> requirement... <span class="hljs-keyword">no</span><br>configure: <span class="hljs-keyword">error</span>: UCX installation does not meet minimum <span class="hljs-keyword">version</span> requirement (v1.9.0). Please upgrade your installation, or <span class="hljs-keyword">use</span> --with-ucx=embedded.<br></code></pre></td></tr></table></figure><h1 id="solution">Solution</h1><p>Configure will use an embedded copy of libfabric or ucx if one is not found in the user environment. An installation can be specified by adding</p><blockquote><p>--with-libfabric=<path/to/install> or --with-ucx=<path/to/install></p></blockquote><p>to the configuration.</p><p>The previous MPICH default device (ch3) is also available and supported with option:</p><blockquote><p>--with-device=ch3</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>MPAS</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Installation</tag>
      
      <tag>MPAS</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>VSCode with Markdown editor</title>
    <link href="/2024/05/29/VSCode_markdown_editor/"/>
    <url>/2024/05/29/VSCode_markdown_editor/</url>
    
    <content type="html"><![CDATA[<p>Working with <a href="https://code.visualstudio.com/docs/languages/markdown">Markdown files in Visual Studio Code</a> is simple, straightforward, and fun. Besides VS Code's basic editing, there are a several Markdown-specific features that help you be more productive.</p><h1 id="markdown-preview">Markdown preview</h1><p>You can also right-click on the editor Tab and select Open Preview (Ctrl+Shift+V) or use the Command Palette (Ctrl+Shift+P) to run the Markdown: <strong>Open Preview to the Side</strong> command (Ctrl+K V).</p><h1 id="outline-view">Outline view</h1><p>The Outline view is a separate section in the bottom of the File Explorer. When expanded, it shows the symbol tree of the currently active editor. For Markdown files, the symbol tree is the Markdown file's header hierarchy.</p><h1 id="extension">Extension</h1><ul><li>markdownlint</li><li>Markdown All in One</li><li>Markdown Preview Github Styling</li><li>Markdown Preview Enhanced</li><li>Markdown Table Prettifier</li></ul><h1 id="markdown-syntax">Markdown syntax</h1><h2 id="bolditalics">Bold/Italics</h2><ul><li>I just love <strong>bold text</strong>./I just love <em>bold text</em>.</li><li>I just love <strong>bold text</strong>./I just love <em>bold text</em>.</li><li>Love<strong>is</strong>bold./Love<em>is</em>bold</li></ul><h2 id="blockquotes">Blockquotes</h2><blockquote><p>It is Markdown.</p></blockquote><blockquote><p>It is also Markdown.</p><p>same here. &gt; indent &gt; &gt; indent</p></blockquote><blockquote><h4 id="the-quarterly-results-look-great">The quarterly results look great!</h4><ul><li>Revenue was off the chart.</li><li>Profits were higher than ever.</li></ul><p><em>Everything</em> is going according to <strong>plan</strong>.</p></blockquote><h2 id="lists">Lists</h2><ol type="1"><li>First item</li><li>Second item</li><li>Third item<ol type="1"><li>Indented item</li><li>Indented item</li></ol></li><li>Fourth item</li></ol><p>Or,</p><ul><li>First item</li><li>Second item</li><li>Third item<ul><li>Indented item</li><li>Indented item</li></ul></li><li>Fourth item</li></ul><p>Or,</p><ol type="1"><li>First item</li><li>Second item</li><li>Third item<ul><li>Indented item</li><li>Indented item</li></ul></li><li>Fourth item</li></ol><h2 id="code-and-highlighting">Code and Highlighting</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/sh</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Hello world&quot;</span><br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br></code></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>  cout &lt;&lt; <span class="hljs-string">&quot;Hello World!&quot;</span>;<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> &#123;<br>   <span class="hljs-comment">// printf() displays the string inside quotation</span><br>   <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Hello, World!&quot;</span>);<br>   <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="table">Table</h2><ul><li><a href="https://discourse.devontechnologies.com/t/css-for-markdown-styling-tables/71369" class="uri">https://discourse.devontechnologies.com/t/css-for-markdown-styling-tables/71369</a></li><li><a href="https://stackoverflow.com/questions/72751703/unable-to-style-a-table-correctly-using-css" class="uri">https://stackoverflow.com/questions/72751703/unable-to-style-a-table-correctly-using-css</a></li></ul><p>You first have to understand table structure: a <code>table</code> element consists of a head and a body (<code>thead</code> and <code>tbody</code>). Both of them in turn are made up of row (<code>tr</code>) elements. And every row consists of <code>th</code> (for a table head) or <code>td</code> elements which are finally defining the table cells themselves.</p><p>One detail many people want are lines dividing the columns and rows. That, however, is not something you can set for the whole table. Instead, you have to specify a <code>border</code> for the <code>td</code> and <code>th</code> cells:</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">table</span> <span class="hljs-selector-pseudo">:is</span>(<span class="hljs-selector-tag">td</span>, <span class="hljs-selector-tag">th</span>) &#123;<br>  <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid black;<br>  <span class="hljs-attribute">padding</span>: <span class="hljs-number">0.3em</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>Here, <code>table :is(td.th)</code> is an abbreviation for <code>table td, table th</code>.</p><table><thead><tr class="header"><th>Syntax</th><th>Description</th></tr></thead><tbody><tr class="odd"><td>Header</td><td>Title</td></tr><tr class="even"><td>Paragraph 1</td><td>Text 1</td></tr><tr class="odd"><td>Paragraph 2</td><td>Text 2</td></tr></tbody></table><table><thead><tr class="header"><th style="text-align: left;">Left-Aligned</th><th style="text-align: center;">Center Aligned</th><th style="text-align: right;">Right Aligned</th></tr></thead><tbody><tr class="odd"><td style="text-align: left;">Row 1</td><td style="text-align: center;">Cell 2</td><td style="text-align: right;">Cell 3</td></tr><tr class="even"><td style="text-align: left;">Row 2</td><td style="text-align: center;">Cell 5</td><td style="text-align: right;">Cell 6</td></tr><tr class="odd"><td style="text-align: left;">Row 3</td><td style="text-align: center;">Cell 8</td><td style="text-align: right;">Cell 9</td></tr></tbody></table><table><thead><tr class="header"><th style="text-align: left;">Left-Aligned</th><th style="text-align: center;">Center Aligned</th><th style="text-align: right;">Right Aligned</th></tr></thead><tbody><tr class="odd"><td style="text-align: left;">Row 1</td><td style="text-align: center;"><strong>Bold</strong></td><td style="text-align: right;">Cell 3</td></tr><tr class="even"><td style="text-align: left;">Row 2</td><td style="text-align: center;"><em>Italic</em></td><td style="text-align: right;">Cell 6</td></tr><tr class="odd"><td style="text-align: left;">Row 3</td><td style="text-align: center;"><del>Strike</del></td><td style="text-align: right;">Cell 9</td></tr><tr class="even"><td style="text-align: left;">Row 3</td><td style="text-align: center;"><a href="dot.com">Link</a></td><td style="text-align: right;">Cell 9</td></tr></tbody></table><p><a href="https://nabeelvalley.co.za/blog/2021/23-03/custom-styles-in-markdown/" class="uri">https://nabeelvalley.co.za/blog/2021/23-03/custom-styles-in-markdown/</a></p><style>table {  /*width: 80%;*/  border-collapse: collapse;  text-align: center;  margin: auto;}th{        background-color: #7e7e7e;        /* sets table header cell background colour */        border: 3px solid black;        color: #ffffff!important;}th, td {  border: .4rem solid #999;  padding: .2em;}tr:nth-child(even) {  background-color: #b2b2b2!important;  color: #000000!important;}</style><table><thead><tr class="header"><th style="text-align: center;"><!-- --></th><th style="text-align: center;"><!-- --></th><th style="text-align: center;"><!-- --></th></tr></thead><tbody><tr class="odd"><td style="text-align: center;">Row 1</td><td style="text-align: center;"><strong>Bold</strong></td><td style="text-align: center;">Cell 3</td></tr><tr class="even"><td style="text-align: center;">Row 2</td><td style="text-align: center;"><em>Italic</em></td><td style="text-align: center;">Cell 6</td></tr><tr class="odd"><td style="text-align: center;">Row 3</td><td style="text-align: center;"><del>Strike</del></td><td style="text-align: center;">Cell 9</td></tr></tbody></table><table><thead><tr class="header"><th style="text-align: left;">elec_physics</th><th style="text-align: center;">nssl_ipelec</th><th style="text-align: center;">nssl_idischarge</th><th style="text-align: left;">outputs</th></tr></thead><tbody><tr class="odd"><td style="text-align: left;">1</td><td style="text-align: center;">2</td><td style="text-align: center;">1</td><td style="text-align: left;">?</td></tr><tr class="even"><td style="text-align: left;">1</td><td style="text-align: center;">3</td><td style="text-align: center;">1</td><td style="text-align: left;">scalar:scr,scw,sci,scs,sch,schl,sciona; <br> state:rscghis_2d,sctot,noninduc,induc,pot, <br> elecmag,elecx,elecy,elecz,light,lightdens,lightdis</td></tr><tr class="odd"><td style="text-align: left;">1</td><td style="text-align: center;">3</td><td style="text-align: center;">2</td><td style="text-align: left;">state:flshi,flshn,flshp,flshfedic, <br> flshfedicp,flshfedicn,flshfedcg,flshfedcgp,flshfedcgn</td></tr></tbody></table><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs markdown">| Syntax | Description |<br>| ----------- | ----------- |<br>| Header | Title |<br>| Paragraph 1| Text 1|<br>| Paragraph 2 | Text 2|<br><br>| Left-Aligned  | Center Aligned  | Right Aligned |<br>|:------------- |:---------------:| -------------:|<br>| Row 1         | Cell 2          | Cell 3        |<br>| Row 2         | Cell 5          | Cell 6        |<br>| Row 3         | Cell 8          | Cell 9        |<br><br>| Left-Aligned  | Center Aligned  | Right Aligned |<br>|:------------- |:---------------:| -------------:|<br>| Row 1         | <span class="hljs-strong">**Bold**</span>        | Cell 3        |<br>| Row 2         | <span class="hljs-emphasis">*Italic*</span>        | Cell 6        |<br>| Row 3         | ~~Strike~~      | Cell 9        |<br>| Row 3         | [<span class="hljs-string">Link</span>](<span class="hljs-link">dot.com</span>) | Cell 9        |<br><br>| &lt;!-- --&gt;      | &lt;!-- --&gt;        | &lt;!-- --&gt;      |<br>|:-------------:|:---------------:|:-------------:|<br>| Row 1         | <span class="hljs-strong">**Bold**</span>        | Cell 3        |<br>| Row 2         | <span class="hljs-emphasis">*Italic*</span>        | Cell 6        |<br>| Row 3         | ~~Strike~~      | Cell 9        |<br><br>| elec<span class="hljs-emphasis">_physics  | nssl_</span>ipelec  | nssl<span class="hljs-emphasis">_idischarge | outputs |</span><br><span class="hljs-emphasis">|:------------- |:---------------:|:---------------:| :-------------|</span><br><span class="hljs-emphasis">| 1         | 2          | 1        | ? |</span><br><span class="hljs-emphasis">| 1         | 3          | 1        | scalar:scr,scw,sci,scs,sch,schl,sciona; <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span></span> state:rscghis_</span>2d,sctot,noninduc,induc,pot, <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span></span> elecmag,elecx,elecy,elecz,light,lightdens,lightdis |<br>| 1         | 3          | 2       | state:flshi,flshn,flshp,flshfedic, <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span></span> flshfedicp,flshfedicn,flshfedcg,flshfedcgp,flshfedcgn |<br><br></code></pre></td></tr></table></figure><h3 id="useful-link">Useful link</h3><ul><li><a href="https://www.tablesgenerator.com/markdown_tables">Markdown Table Generator</a></li></ul><h2 id="links">Links</h2><p>To create a link, enclose the link text in brackets (e.g., [Duck Duck Go]) and then follow it immediately with the URL in parentheses (e.g., (https://duckduckgo.com)).</p><p>It is <a href="https://en.wikipedia.org/wiki/GNU_Compiler_Collection">GNU Compiler Collection (GCC)</a>.</p><h2 id="urls-and-email-addresses">URLs and Email Addresses</h2><p><a href="https://www.markdownguide.org" class="uri">https://www.markdownguide.org</a><br /><a href="mailto:waipangsze@gmail.com" class="email">waipangsze@gmail.com</a></p><h2 id="task-list">Task List</h2><ul><li>[x] Write the press release</li><li>[ ] Update the website</li><li>[ ] Contact the media</li></ul><h2 id="image">Image</h2><ol type="1"><li><p>Open the file containing the Linux.</p><figure><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/3/35/Tux.svg/150px-Tux.svg.png" alt="Tux, the Linux mascot" /><figcaption>Tux, the Linux mascot</figcaption></figure></li><li><p>Close the file.</p></li></ol><figure><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/3/35/Tux.svg/150px-Tux.svg.png" alt="Tux, the Linux mascot" width="50" /><figcaption>Tux, the Linux mascot</figcaption></figure><h2 id="in-fluid-theme">In Fluid theme,</h2><h3 id="ä¾¿ç­¾">ä¾¿ç­¾</h3><p>å¯é€‰ä¾¿ç­¾ï¼š</p><ul><li>primary</li><li>secondary</li><li>success</li><li>danger</li><li>warning</li><li>info</li><li>light</li></ul><div class="note note-primary">            <p>primary: æ–‡å­— æˆ–è€… <code>markdown</code> å‡å¯</p>          </div><div class="note note-secondary">            <p>secondary: æ–‡å­— æˆ–è€… <code>markdown</code> å‡å¯</p>          </div><div class="note note-success">            <p>success: æ–‡å­— æˆ–è€… <code>markdown</code> å‡å¯</p>          </div><div class="note note-danger">            <p>danger: æ–‡å­— æˆ–è€… <code>markdown</code> å‡å¯</p>          </div><div class="note note-warning">            <p>warning: æ–‡å­— æˆ–è€… <code>markdown</code> å‡å¯</p>          </div><div class="note note-info">            <p>info: æ–‡å­— æˆ–è€… <code>markdown</code> å‡å¯</p>          </div><div class="note note-light">            <p>light: æ–‡å­— æˆ–è€… <code>markdown</code> å‡å¯</p>          </div><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs markdown">&#123;% note primary %&#125;<br>primary: æ–‡å­— æˆ–è€… <span class="hljs-code">`markdown`</span> å‡å¯<br>&#123;% endnote %&#125;<br></code></pre></td></tr></table></figure><h2 id="text---mermaid">TeXt - Mermaid,</h2><p>set <code>mermaid: true</code></p><figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs oxygene"># æµç¨‹å›¾ï¼ŒåŸºäº mermaid-jsï¼Œå…·ä½“è¯·è§ï¼šhttps:<span class="hljs-comment">//hexo.fluid-dev.com/docs/guide/#mermaid-æµç¨‹å›¾</span><br># Flow chart, based <span class="hljs-keyword">on</span> mermaid-js, see: https:<span class="hljs-comment">//hexo.fluid-dev.com/docs/en/guide/#mermaid</span><br>mermaid:<br># å¼€å¯åæ–‡ç« é»˜è®¤å¯ç”¨ï¼Œè‡ªå®šä¹‰é¡µé¢å¦‚éœ€ä½¿ç”¨ï¼Œéœ€åœ¨ Front-matter ä¸­æŒ‡å®š `mermaid: <span class="hljs-keyword">true</span>`<br># <span class="hljs-keyword">If</span> you want <span class="hljs-keyword">to</span> use mermaid <span class="hljs-keyword">on</span> the custom page, you need <span class="hljs-keyword">to</span> <span class="hljs-keyword">set</span> `mermaid: <span class="hljs-keyword">true</span>` <span class="hljs-keyword">in</span> Front-matter<br>enable: <span class="hljs-keyword">false</span><br></code></pre></td></tr></table></figure><p>and,</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">npm install hexo-filter-mermaid-diagrams<br></code></pre></td></tr></table></figure><pre class="mermaid">pie title NETFLIX         "Time spent looking for movie" : 90         "Time spent watching it" : 10</pre><pre class="mermaid">flowchart TD    Start --> Stop</pre><h3 id="flowchart">Flowchart</h3><pre class="mermaid">graph TD;    A-->B;    A-->C;    B-->D;    C-->D;</pre><pre><code class="hljs">&lt;pre class=&quot;mermaid&quot;&gt;    graph TD;    A--&gt;B;    A--&gt;C;    B--&gt;D;    C--&gt;D;&lt;/pre&gt;</code></pre><h3 id="sequence-diagram">Sequence Diagram</h3><pre class="mermaid">sequenceDiagram    participant Alice    participant Bob    Alice->John: Hello John, how are you?    loop Healthcheck        John->John: Fight against hypochondria    end    Note right of John: Rational thoughts <br/>prevail...    John-->Alice: Great!    John->Bob: How about you?    Bob-->John: Jolly good!</pre><pre><code class="hljs">&lt;pre class=&quot;mermaid&quot;&gt;    sequenceDiagram    participant Alice    participant Bob    Alice-&gt;John: Hello John, how are you?    loop Healthcheck        John-&gt;John: Fight against hypochondria    end    Note right of John: Rational thoughts &lt;br/&gt;prevail...    John--&gt;Alice: Great!    John-&gt;Bob: How about you?    Bob--&gt;John: Jolly good!&lt;/pre&gt;</code></pre><h3 id="gant-diagrams">Gant Diagrams</h3><pre class="mermaid">gantt    dateFormat  YYYY-MM-DD    title Adding GANTT diagram functionality to mermaid    section A section        Completed task            :done,    des1, 2014-01-06,2014-01-08        Active task               :active,  des2, 2014-01-09, 3d        Future task               :         des3, after des2, 5d        Future task2              :         des4, after des3, 5d    section Critical tasks        Completed task in the critical line :crit, done, 2014-01-06,24h        Implement parser and jison          :crit, done, after des1, 2d        Create tests for parser             :crit, active, 3d        Future task in critical line        :crit, 5d        Create tests for renderer           :2d</pre><pre><code class="hljs">&lt;pre class=&quot;mermaid&quot;&gt;    gantt    dateFormat  YYYY-MM-DD    title Adding GANTT diagram functionality to mermaid    section A section        Completed task            :done,    des1, 2014-01-06,2014-01-08        Active task               :active,  des2, 2014-01-09, 3d        Future task               :         des3, after des2, 5d        Future task2              :         des4, after des3, 5d    section Critical tasks        Completed task in the critical line :crit, done, 2014-01-06,24h        Implement parser and jison          :crit, done, after des1, 2d        Create tests for parser             :crit, active, 3d        Future task in critical line        :crit, 5d        Create tests for renderer           :2d&lt;/pre&gt;</code></pre><pre class="mermaid">gantt    title A Gantt Diagram    dateFormat YYYY-MM-DD    section Section        A task          :a1, 2014-01-01, 30d        Another task    :after a1, 20d    section Another        Task in Another :2014-01-12, 12d        another task    :24d    section Another 2        Task in Another :2014-01-12, 12d        another task    :24d</pre><pre><code class="hljs">&lt;pre class=&quot;mermaid&quot;&gt;    gantt    title A Gantt Diagram    dateFormat YYYY-MM-DD    section Section        A task          :a1, 2014-01-01, 30d        Another task    :after a1, 20d    section Another        Task in Another :2014-01-12, 12d        another task    :24d    section Another 2        Task in Another :2014-01-12, 12d        another task    :24d&lt;/pre&gt;</code></pre><h2 id="math-block">Math block</h2><p>set<br /><code>mathjax: true</code><br /><code>mathjax_autoNumber: true</code> {:.info}</p><h3 id="in-text-theme-mathjax-is-used.">In TeXt theme, MathJax is used.</h3><ol type="1"><li><a href="https://nightcatv.github.io/2020/06/05/MathJax%20%E8%AA%9E%E6%B3%95%E8%A3%9C%E5%B8%96/#MathJax-%E8%AA%9E%E6%B3%95%E8%A3%9C%E5%B8%96">MathJax èªæ³•è£œå¸–</a></li><li><a href="https://bachzart.github.io/2020/09/17/MathJax-%E8%AF%AD%E6%B3%95%E5%BF%AB%E9%80%9F%E6%8C%87%E5%8D%97/">MathJax è¯­æ³•å¿«é€ŸæŒ‡å—</a></li></ol><p>edit waipangsze.github.io/_includes/markdown-enhancements/mathjax.html and add</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs prolog">displayMath: [ [<span class="hljs-string">&#x27;$$&#x27;</span>,<span class="hljs-string">&#x27;$$&#x27;</span>], [<span class="hljs-string">&#x27;\\[&#x27;</span>,<span class="hljs-string">&#x27;\\]&#x27;</span>] ]<br></code></pre></td></tr></table></figure><p>and,</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/x-mathjax-config&quot;</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-keyword">var</span> _config = &#123; <span class="hljs-attr">tex2jax</span>: &#123;</span><br><span class="language-javascript">        <span class="hljs-attr">inlineMath</span>: [ [<span class="hljs-string">&#x27;$&#x27;</span>,<span class="hljs-string">&#x27;$&#x27;</span>], [<span class="hljs-string">&#x27;\\(&#x27;</span>,<span class="hljs-string">&#x27;\\)&#x27;</span>] ],</span><br><span class="language-javascript">        <span class="hljs-attr">displayMath</span>: [ [<span class="hljs-string">&#x27;$$&#x27;</span>,<span class="hljs-string">&#x27;$$&#x27;</span>], [<span class="hljs-string">&#x27;\\[&#x27;</span>,<span class="hljs-string">&#x27;\\]&#x27;</span>] ]</span><br><span class="language-javascript">&#125;&#125;;</span><br><span class="language-javascript">_config.<span class="hljs-property">TeX</span> = &#123; <span class="hljs-attr">equationNumbers</span>: &#123; <span class="hljs-attr">autoNumber</span>: <span class="hljs-string">&quot;all&quot;</span> &#125; &#125;;</span><br><span class="language-javascript"><span class="hljs-title class_">MathJax</span>.<span class="hljs-property">Hub</span>.<span class="hljs-title class_">Config</span>(_config);</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://cdn.bootcss.com/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML&quot;</span> <span class="hljs-attr">async</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><p>Inline math: <span class="math inline">\(x^2\)</span></p><p><span class="math display">\[\left( \sum_{k=1}^n a_k b_k \right)^2\leq\left( \sum_{k=1}^n a_k^2 \right)\left( \sum_{k=1}^n b_k^2 \right)\]</span></p><p><span class="math display">\[a+1 = b\\c+2 = d \]</span></p><p><span class="math display">\[\begin{align}a &amp;= 1 \\b &amp;= 2 \end{align}\tag{1}\]</span></p><p><span class="math display">\[\begin{equation}\begin{split}A &amp; = \frac{\pi r^2}{2} \\    &amp; = \frac{1}{2} \pi r^2\end{split}\end{equation}\tag{2}\]</span></p><p><span class="math display">\[\begin{align*}  &amp; \phi(x,y) = \phi \left(\sum_{i=1}^n x_ie_i, \sum_{j=1}^n y_je_j \right)  = \sum_{i=1}^n \sum_{j=1}^n x_i y_j \phi(e_i, e_j) = \\  &amp; (x_1, \ldots, x_n) \left( \begin{array}{ccc}      \phi(e_1, e_1) &amp; \cdots &amp; \phi(e_1, e_n) \\      \vdots &amp; \ddots &amp; \vdots \\      \phi(e_n, e_1) &amp; \cdots &amp; \phi(e_n, e_n)    \end{array} \right)  \left( \begin{array}{c}      y_1 \\      \vdots \\      y_n    \end{array} \right)\end{align*}\]</span></p><p><span class="math display">\[a = 1 \\b + 1 = 2 \\c + 1 + 2 = 3\]</span></p><p><span class="math display">\[\begin{cases}a_1x + b_1y + c_1z = d_1\\a_2x + b_2y + c_2z = d_2\\a_3x + b_3y + c_3z = d_3\\\end{cases}\]</span></p>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>editor</tag>
      
      <tag>Markdown</tag>
      
      <tag>VSCode</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>WRF | unrecognized command line option â€˜-f90=gfortranâ€™ &amp; ungrib.exe compile error</title>
    <link href="/2024/05/29/WPS_install_gfortran_error/"/>
    <url>/2024/05/29/WPS_install_gfortran_error/</url>
    
    <content type="html"><![CDATA[<h1 id="issue">Issue</h1><p>When compiling WPSv4.0/v4.2/v3.8.1</p><blockquote><p>gfortran: error: unrecognized command line option â€˜-f90=gfortranâ€™</p></blockquote><h1 id="solution">Solution</h1><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs makefile"><span class="hljs-comment"># Settings for    Linux x86_64 ppc64le, gfortran compiler with gcc   (dmpar)</span><br><span class="hljs-comment">#</span><br>DESCRIPTION     =       GNU ($SFC/$SCC)<br>DMPARALLEL      =        1<br>OMPCPP          =       <span class="hljs-comment"># -D_OPENMP</span><br>OMP             =       <span class="hljs-comment"># -fopenmp</span><br>OMPCC           =       <span class="hljs-comment"># -fopenmp</span><br>SFC             =       gfortran<br>SCC             =       gcc<br>CCOMP           =       gcc<br>DM_FC           =       mpif90 -f90=gfortran<br>DM_CC           =       mpicc -cc=<span class="hljs-variable">$(SCC)</span><br>FC              =       <span class="hljs-variable">$(DM_FC)</span><br>CC              =       <span class="hljs-variable">$(DM_CC)</span> -DFSEEKO64_OK <br>LD              =       <span class="hljs-variable">$(FC)</span><br></code></pre></td></tr></table></figure><p>modify DM_FC to</p><blockquote><p>DM_FC = mpif90</p></blockquote><p>without -f90-gfortran</p><p>Finally,</p><ol type="1"><li>geogrid.exe and metgrid.exe</li><li>link_grib.csh</li></ol><p>are generated.</p><p>But, <strong>no ungrib.exe !!!</strong></p><h2 id="error">Error</h2><blockquote><p>Error: Arguments of â€˜iandâ€™ have different kind type parameters at (1)</p></blockquote><p>References</p><ol type="1"><li><a href="https://forum.mmm.ucar.edu/threads/resolved-ungrib-exe-compile-error-arguments-of-%E2%80%98iand%E2%80%99-have-different-kind-type-parameters-at-1-ted.9409/">(RESOLVED) ungrib.exe compile error: Arguments of â€˜iandâ€™ have different kind type parameters at (1)ted</a><ul><li>To dd those two extra lines to ungrib/src/ngl/g2/intmath.f (based on <a href="https://github.com/wrf-model/WPS/pull/119" class="uri">https://github.com/wrf-model/WPS/pull/119</a>)</li></ul></li><li><a href="https://forum.mmm.ucar.edu/threads/resolved-not-generating-ungrib-exe.9367/">(RESOLVED) Not generating ungrib.exe</a></li></ol><h3 id="solution-1">Solution</h3><p><a href="https://github.com/wrf-model/WPS/pull/119/files/74eb62b1bef320b453151e1eb749dae96616da97#diff-93d876794073a0c3c81a225075d33578e88a2d946b833ba92f0bbcd3d6be9c03">Fix mismatch integer kind in IAND intrinsic calls in g2 librar</a></p><p>ungrib/src/ngl/g2/intmath.f</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs stylus">ilog2_2=<span class="hljs-number">0</span><br>i=i_in<br><span class="hljs-function"><span class="hljs-title">if</span><span class="hljs-params">(i&lt;=<span class="hljs-number">0</span>)</span></span> return<br><span class="hljs-function"><span class="hljs-title">if</span><span class="hljs-params">(iand(i,i-<span class="hljs-number">1</span>)</span></span>/=<span class="hljs-number">0</span>) then<br>   !<span class="hljs-built_in">write</span>(<span class="hljs-number">0</span>,*) <span class="hljs-string">&#x27;iand i-1&#x27;</span><br>   ilog2_2=<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><p>to <figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs stylus">      ilog2_2=<span class="hljs-number">0</span><br>      i=i_in<br>      <span class="hljs-built_in">if</span>(i&lt;=<span class="hljs-number">0</span>) return<br>! WPS modification <span class="hljs-keyword">for</span> the XL compiler<br>!      <span class="hljs-built_in">if</span>(<span class="hljs-built_in">iand</span>(<span class="hljs-selector-tag">i</span>,i-<span class="hljs-number">1</span>)/=<span class="hljs-number">0</span>) then<br>      <span class="hljs-built_in">if</span>(<span class="hljs-built_in">iand</span>(<span class="hljs-selector-tag">i</span>,i-<span class="hljs-number">1</span>_2)/=<span class="hljs-number">0</span>) then<br>         !<span class="hljs-built_in">write</span>(<span class="hljs-number">0</span>,*) <span class="hljs-string">&#x27;iand i-1&#x27;</span><br>         ilog2_2=<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure> And, <figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs stylus">ilog2_1=<span class="hljs-number">0</span><br>i=i_in<br><span class="hljs-function"><span class="hljs-title">if</span><span class="hljs-params">(i&lt;=<span class="hljs-number">0</span>)</span></span> return<br><span class="hljs-function"><span class="hljs-title">if</span><span class="hljs-params">(iand(i,i-<span class="hljs-number">1</span>)</span></span>/=<span class="hljs-number">0</span>) then<br>   !<span class="hljs-built_in">write</span>(<span class="hljs-number">0</span>,*) <span class="hljs-string">&#x27;iand i-1&#x27;</span><br>   ilog2_1=<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure> to <figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs stylus">      ilog2_1=<span class="hljs-number">0</span><br>      i=i_in<br>      <span class="hljs-built_in">if</span>(i&lt;=<span class="hljs-number">0</span>) return<br>! WPS modification <span class="hljs-keyword">for</span> the XL compiler<br>!      <span class="hljs-built_in">if</span>(<span class="hljs-built_in">iand</span>(<span class="hljs-selector-tag">i</span>,i-<span class="hljs-number">1</span>)/=<span class="hljs-number">0</span>) then<br>      <span class="hljs-built_in">if</span>(<span class="hljs-built_in">iand</span>(<span class="hljs-selector-tag">i</span>,i-<span class="hljs-number">1</span>_1)/=<span class="hljs-number">0</span>) then<br>         !<span class="hljs-built_in">write</span>(<span class="hljs-number">0</span>,*) <span class="hljs-string">&#x27;iand i-1&#x27;</span><br>         ilog2_1=<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure></p><p><strong>Works!!!</strong></p>]]></content>
    
    
    <categories>
      
      <category>WRF</category>
      
    </categories>
    
    
    <tags>
      
      <tag>WPS</tag>
      
      <tag>Installation</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>WRF | fatal error - rpc/types.h - No such file or directory</title>
    <link href="/2024/05/29/WRF_install_landread_error/"/>
    <url>/2024/05/29/WRF_install_landread_error/</url>
    
    <content type="html"><![CDATA[<h1 id="issue">Issue</h1><p>When compiling WRFv4.0.0,</p><blockquote><p>mpicc -cc=gcc -DFSEEKO64_OK -o landread.o -c -w -O3 -c -DDM_PARALLEL -DMAX_HISTORY=25 -DNMM_CORE=0 landread.c landread.c:68:10: fatal error: rpc/types.h: No such file or directory #include &lt;rpc/types.h&gt; ^~~~~~~~~~~~~ compilation terminated. make[2]: [../configure.wrf:372: landread.o] Error 1 (ignored)</p></blockquote><h1 id="reference">Reference</h1><p><a href="https://forum.mmm.ucar.edu/threads/resolved-problem-compiling-wrfv4-0-on-fedora-28-landread-error.61/">(RESOLVED) Problem Compiling WRFV4.0 on Fedora 28: landread error</a></p><h1 id="workaround-1">Workaround 1</h1><p>We've seen a few reports of this, and it seems to be specific to particular Linux systems. We have not been able to repeat this at NCAR on our Macs, our department Linux server, or on our Linux HPC, and therefore we haven't come up with a long-term solution yet. However, a work-around would be to do the following:</p><p>Issue a â€˜clean -aâ€™ and then reconfigure. Then go into your configure.wrf file and look for the line: <figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">CFLAGS</span> = $(CFLAGS_LOCAL) -DDM_PARALLEL -DSTUBMPI \<br><span class="hljs-attr">-DMAX_HISTORY</span>=$(MAX_HISTORY) -DNMM_CORE=$(WRF_NMM_CORE)<br></code></pre></td></tr></table></figure></p><p>Onto the end of that, add -DLANDREAD_STUFF, so that it now looks like: <figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">CFLAGS</span> = $(CFLAGS_LOCAL) -DDM_PARALLEL -DSTUBMPI \<br><span class="hljs-attr">-DMAX_HISTORY</span>=$(MAX_HISTORY) -DNMM_CORE=$(WRF_NMM_CORE) -DLANDREAD_STUB<br></code></pre></td></tr></table></figure> Then save that configure file and recompile. This should get your past the problem. Please let us know if that works for you. Thanks!</p><h3 id="wrfv4.0.0-works">WRFv4.0.0 Works !</h3><h2 id="what-is-landread_stub">What is LANDREAD_STUB?</h2><ol type="1"><li><p>The LANDREAD_STUB option removes the ability for a moving nest to horizontally interpolate high-resolution topography and landuse fields. Very few use this option, so this is typically a safe recourse.</p></li><li><p>For those who do need the capability of a moving nest with the high-resolution static fields, if the location of types.h is not found in /usr/include, the alternative would be to look in /usr/include/tirpc.</p></li></ol><p>We can put together a github pull request, but we will need a couple of users to verify that the proposed fix still provide code that works for us and additionally works for the those that have reported the build troubles with WRF.</p><ol start="3" type="1"><li>Would you please test this pull request: <a href="https://github.com/wrf-model/WRF/pull/1072" class="uri">https://github.com/wrf-model/WRF/pull/1072</a></li></ol><h1 id="workaround-2">Workaround 2</h1><ol type="1"><li><p>I am encountering a similar issue when compiling V3.9.1.1 and the above solution does not seem to work for me.</p></li><li><p>I had to Copy landread.c.dist to landread.c in share directory for WRFV3 and that solved the issue.</p></li><li><p>Just cd share/ and do cp landread.c.dist landread.c</p></li></ol>]]></content>
    
    
    <categories>
      
      <category>WRF</category>
      
    </categories>
    
    
    <tags>
      
      <tag>WRF</tag>
      
      <tag>Installation</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>WRF | make -- time No such file or directory</title>
    <link href="/2024/05/29/WRF_install_time_error/"/>
    <url>/2024/05/29/WRF_install_time_error/</url>
    
    <content type="html"><![CDATA[<h1 id="issue">Issue</h1><p>After moving to new cluster, a error appear when I reinstalled WRF. It is</p><blockquote><p>make[3]: time: No such file or directory</p></blockquote><p>Or,</p><blockquote><p>make[3]: time: No such file or directory make[3]: [makefile:42: module_io_int_idx.o] Error 127 (ignored)</p></blockquote><p>On WRFv450, v440, v433, v430</p><h1 id="workaround">Workaround</h1><p>Reference: <a href="https://forum.mmm.ucar.edu/threads/compiling-wrf-4-2-on-centos7-failed-problems-building-executables-look-for-errors-in-the-build-log.12864/">compiling wrf 4.2 on centos7 failed---&gt;Problems building executables, look for errors in the build log</a></p><p>'time' is a simple linux command that is typically included with your operating system. I believe, ultimately, the issue is that you're using a very old version of GNU to compile a newer version of WRF. GNU is free software, so can you try to install the latest version of GNU to see if that makes any difference in your compile? If you aren't sure how to do this, seek the help of a systems administrator (IT) at your institution. Once you install the new GNU version, you'll need to rebuild NetCDF and your MPI installation with the updated GNU, as well.</p><p>If you do that, and still run into the above error regarding the 'time' command, you can try a couple things: 1) Ask a systems admin for assistance in getting this command installed on your system. 'time' is a very simple linux command and typically comes readily available with the OS. 2) You can try modifying the configure.wrf file. After issuing <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">./clean -a<br>./configure<br></code></pre></td></tr></table></figure> 3) , and reconfiguring, open your configure.wrf file and look for this line: <figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arcade">FC        = <span class="hljs-built_in">time</span> $(DM_FC)<br></code></pre></td></tr></table></figure> 4) Remove 'time' from the line so that it now reads as <figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">FC</span>        =  $(DM_FC)<br></code></pre></td></tr></table></figure> Save the configure.wrf with the change and try recompiling. <figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs maxima">./<span class="hljs-built_in">compile</span> -j <span class="hljs-number">8</span> em_real <span class="hljs-number">2</span>&gt;&amp;<span class="hljs-number">1</span> | tee <span class="hljs-built_in">compile</span>.<span class="hljs-built_in">log</span><br></code></pre></td></tr></table></figure></p><p>or</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#cp -r WRF-4.5.1-raw WRFV4.5.1</span><br><br><span class="hljs-built_in">cd</span> WRFV4.5.1/<br><br>./clean -a<br>./configure <br><span class="hljs-comment">##  34 (dmpar) GNU [gfortran/gcc]</span><br><br><span class="hljs-comment">## rewrite: The character class \s will match the whitespace characters &lt;tab&gt; and &lt;space&gt;.</span><br><span class="hljs-comment">## and don&#x27;t include $(DM_FC) </span><br>sed -i <span class="hljs-string">&quot;s/\s\stime\s//g&quot;</span> configure.wrf<br><span class="hljs-comment">#sed -i &quot;s/-DNMM_CORE=$(WRF_NMM_CORE)/-DNMM_CORE=$(WRF_NMM_CORE)\s-DLANDREAD_STUB/g&quot; configure.wrf</span><br><br>./compile -j 4 em_real 2&gt;&amp;1 | <span class="hljs-built_in">tee</span> compile.log<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>WRF</category>
      
    </categories>
    
    
    <tags>
      
      <tag>WRF</tag>
      
      <tag>Installation</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Conda/Micromamba</title>
    <link href="/2024/03/02/Conda_Micromamba/"/>
    <url>/2024/03/02/Conda_Micromamba/</url>
    
    <content type="html"><![CDATA[<p>The easiest way to export a .yml file from a conda environment is to first activate your environment by running: <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">conda activate myvenv<br></code></pre></td></tr></table></figure> And then run the following command that generated your .yml file: <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">conda <span class="hljs-built_in">env</span> <span class="hljs-built_in">export</span> &gt; list.yml<br></code></pre></td></tr></table></figure> Finally, you can create a new environment using the .yml file, like: <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">conda <span class="hljs-built_in">env</span> create --name myvenv --file=list.yml<br></code></pre></td></tr></table></figure></p><p>or <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">conda <span class="hljs-built_in">env</span> <span class="hljs-built_in">export</span> | grep -v <span class="hljs-string">&quot;^prefix: &quot;</span> &gt; environment.yml<br>conda <span class="hljs-built_in">env</span> create -f environment.yml<br></code></pre></td></tr></table></figure></p><p>Remove environment, <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">conda remove -n ENV_NAME --all<br></code></pre></td></tr></table></figure></p><h1 id="micromamba">Micromamba</h1><p>Micromamba is a standalone version of Mamba which is an alternative to Conda. This stack delivers a custom anaconda/miniconda type deployment based on the communities conda-forge channel with micromamba as the package manager. For more information visit <a href="https://mamba.readthedocs.io/en/latest/user_guide/micromamba.html">micromamba documentation</a>.</p><h2 id="installation">Installation</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">wget micro.mamba.pm/install.sh<br><span class="hljs-built_in">chmod</span> +x install.sh<br>./install.sh<br></code></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">## Parsing arguments</span><br><span class="hljs-keyword">if</span> [ -t 0 ] ; <span class="hljs-keyword">then</span><br>  <span class="hljs-built_in">printf</span> <span class="hljs-string">&quot;Micromamba binary folder? [~/.local/bin] &quot;</span><br>  <span class="hljs-built_in">read</span> BIN_FOLDER<br>  <span class="hljs-built_in">printf</span> <span class="hljs-string">&quot;Init shell (<span class="hljs-variable">$shell</span>)? [Y/n] &quot;</span><br>  <span class="hljs-built_in">read</span> INIT_YES<br>  <span class="hljs-built_in">printf</span> <span class="hljs-string">&quot;Configure conda-forge? [Y/n] &quot;</span><br>  <span class="hljs-built_in">read</span> CONDA_FORGE_YES<br><span class="hljs-keyword">fi</span><br></code></pre></td></tr></table></figure><ul><li>/home/wpsze/.local/bin</li><li>init shell? Y</li><li>configure-forge? Y</li></ul><p>Finally, it will initalize micromambs config on .bashrc</p><h3 id="export-the-contents-of-the-existing-environment-to-a-yaml-file.">Export the contents of the existing environment to a YAML file.</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">micromamba <span class="hljs-built_in">env</span> <span class="hljs-built_in">export</span> -n oldenv &gt; oldenv.yaml<br></code></pre></td></tr></table></figure><h3 id="create-env-by-given-yaml">Create env by given yaml</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">micromamba <span class="hljs-built_in">env</span> create --name newenv --file oldenv.yaml<br></code></pre></td></tr></table></figure><h3 id="pip-requirements-file-contain-file">pip requirements file contain "<span class="citation" data-cites="file">@file</span>"</h3><ul><li><span class="citation" data-cites="file">[Why does the pip requirements file contain @file instead of version number?]</span>(https://stackoverflow.com/questions/62586878/why-does-the-pip-requirements-file-contain-file-instead-of-version-number)</li><li><a href="https://peps.python.org/pep-0440/#direct-references" class="uri">https://peps.python.org/pep-0440/#direct-references</a></li><li></li></ul><h3 id="source-and-activate-env">Source and activate env</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ <span class="hljs-built_in">source</span> /home/wpsze/micromamba/etc/profile.d/micromamba.sh<br>$ micromamba activate venv<br></code></pre></td></tr></table></figure><h3 id="activate-or-execute">activate or execute</h3><p>Transaction finished</p><p>To activate this environment, use:</p><pre><code class="hljs">micromamba activate venv</code></pre><p>Or to execute a single command in this environment, use:</p><pre><code class="hljs">micromamba run -n venv mycommand</code></pre><h2 id="clone-an-environment">clone an environment,</h2><p>As stated in the answer to <a href="https://stackoverflow.com/questions/76884520/cloning-environment-with-micromamba">Cloning environment with micromamba</a>, <strong>--clone</strong> is not an option in micromamba.</p><p>Instead, export the environment yaml and create a new environment using the --file flag. Then remove the old environment.</p><ol type="1"><li>export the env dependencies: micromamba env export -n oldenv &gt; oldenv.yaml</li><li>create a new env with a new name: micromamba create -n newenv --file oldenv.yaml</li><li>remove the old env: micromamba env remove -n oldenv</li><li>delete the yaml file: rm oldenv.yaml</li></ol><h2 id="checkadd-channel">check/add channel</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ micromamba info<br><br><span class="hljs-comment"># or</span><br><br>$ micromamba config list --sources<br><br>channels:<br>  - conda-forge  <span class="hljs-comment"># &#x27;~/.condarc&#x27;</span><br><br>$ micromamba config append channels conda-forge<br></code></pre></td></tr></table></figure><h1 id="references">References</h1><ol type="1"><li><a href="https://hpc.pku.edu.cn/ug/guide/soft/conda/#_3">åŒ—äº¬å¤§å­¦é«˜æ€§èƒ½è®¡ç®—æ ¡çº§å…¬å…±å¹³å°ç”¨æˆ·æ–‡æ¡£</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>conda</tag>
      
      <tag>Micromamba</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>bashrc</title>
    <link href="/2024/03/02/bashrc/"/>
    <url>/2024/03/02/bashrc/</url>
    
    <content type="html"><![CDATA[<p>If you spend a lot of time on the command line, chances are that youâ€™ll want to customize your shell environment. This can mean creating aliases, adding a new directory to the <strong>$PATH</strong> , or changing the look of the shell prompt.</p><p>You may have come across some tutorials where they say to put your configuration either in the <strong>.bashrc</strong>, <strong>.bash_profile</strong> or another configuration file that is read and executed by the bash shell.</p><h1 id="bash-startup-files">Bash Startup Files</h1><p>When invoked as an interactive login shell, Bash looks for the <strong>/etc/profile</strong> file, and if the file exists , it runs the commands listed in the file. Then Bash searches for <strong><sub>/.bash_profile<strong>, </strong></sub>/.bash_login</strong>, and <strong>~/.profile</strong> files, in the listed order, and executes commands from the first readable file found.</p><p>When Bash is invoked as an <em>interactive non-login shell</em>, it reads and executes commands from <strong>~/.bashrc</strong>, if that file exists, and it is readable.</p><h2 id="difference-between-.bashrc-and-.bash_profile">Difference Between .bashrc and .bash_profile</h2><p><strong>.bash_profile</strong> is read and executed when Bash is invoked as an interactive login shell, while <strong>.bashrc</strong> is executed for an interactive non-login shell.</p><p>Use <strong>.bash_profile</strong> to run commands that should run only once, such as customizing the <strong>$PATH</strong> environment variable .</p><p>Put the commands that should run every time you launch a new shell in the <strong>.bashrc</strong> file. This include your aliases and functions , custom prompts, history customizations , and so on.</p><blockquote><p>Typically, ~/.bash_profile contains lines like below that source the .bashrc file. This means each time you log in to the terminal, both files are read and executed.</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-keyword">if</span> [ -f ~/.bashrc ]; <span class="hljs-keyword">then</span><br>. ~/.bashrc<br><span class="hljs-keyword">fi</span><br></code></pre></td></tr></table></figure><h2 id="profile-and-.bash_profile">~/.profile and ~/.bash_profile</h2><p>Most Linux distributions are using <strong>~/.profile</strong> instead of <strong><sub>/.bash_profile<strong>. The </strong></sub>/.profile</strong> file is read by <em>all shells</em>, while <strong>~/.bash_profile</strong> <em>only by Bash</em>.</p><p>If any startup file is not present on your system, you can create it.</p><h1 id="more">More</h1><h2 id="profile">profile</h2><p>profileï¼Œè·¯å¾‘ï¼š/etc/profileï¼Œç”¨æ–¼è¨­å®šä¿‚çµ±ç´šçš„ç’°å¢ƒè®Šæ•¸å’Œå•Ÿå‹•ç¨‹åºï¼Œåœ¨æ­¤æ–‡ä»¶ä¸‹é…ç½®å°æ‰€æœ‰ä½¿ç”¨è€…ç”Ÿæ•ˆã€‚ ç•¶ç™»å…¥ä½¿ç”¨è€…ï¼ˆloginï¼‰æ™‚ï¼Œæª”æ¡ˆæœƒè¢«åŸ·è¡Œï¼Œä¸¦å¾/etc/profile.dç›®éŒ„çš„è¨­å®šæª”ä¸­æ‰¾åˆ°shellè¨­å®šã€‚</p><h2 id="bash_profile">bash_profile</h2><p>bash_profileåªå°å–®ä¸€ä½¿ç”¨è€…æœ‰æ•ˆï¼Œæª”æ¡ˆå„²å­˜ä½æ–¼~/.bash_profileï¼Œè©²æª”æ¡ˆæ˜¯ä¸€å€‹ä½¿ç”¨è€…å±¤ç´šçš„è¨­ç½®ï¼Œå¯ä»¥ç†è§£ç‚ºæŸå€‹ä½¿ç”¨è€…çš„è¨­å®šæª”ç›®éŒ„ä¸‹ã€‚</p><p>è©²æ–‡ä»¶ä¹Ÿå¯ä»¥ç”¨æ–¼é…ç½®ç’°å¢ƒè®Šæ•¸å’Œå•Ÿå‹•ç¨‹åºï¼Œä½†åƒ…é‡å°å–®ä¸€ä½¿ç”¨è€…æœ‰æ•ˆã€‚</p><p>å’Œ profile æª”æ¡ˆé¡ä¼¼ï¼Œbash_profile ä¹Ÿå¯ä»¥åœ¨ä½¿ç”¨è€…ç™»å…¥ï¼ˆloginï¼‰æ™‚ç”Ÿæ•ˆï¼Œä¹Ÿå¯ä»¥ç”¨ä¾†è¨­å®šç’°å¢ƒè®Šæ•¸ã€‚</p><p>ä½†èˆ‡ profile ä¸åŒï¼Œbash_profile åªèƒ½å°ç›®å‰ä½¿ç”¨è€…ç”Ÿæ•ˆã€‚</p><p>#BASH Alias BASH Alias is a shortcut to run commands using some mapping. It is a way to create some shortcut commands for repetitive and multiple tasks. We create an alias in a BASH environment in specified files. We can also incorporate BASH functions, variables, etc to make the Alias more programmatic and flexible.</p>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>bashrc</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>vim</title>
    <link href="/2023/10/20/vim/"/>
    <url>/2023/10/20/vim/</url>
    
    <content type="html"><![CDATA[<h1 id="vimrc-setup">.vimrc setup</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">set</span> showmode<br><span class="hljs-built_in">set</span> encoding=utf-8 <br><span class="hljs-built_in">set</span> t_Co=256<br><span class="hljs-built_in">set</span> tabstop=4<br><span class="hljs-built_in">set</span> shiftwidth=4<br><span class="hljs-built_in">set</span> expandtab<br><br><span class="hljs-built_in">set</span> nolist<br><br><span class="hljs-built_in">set</span> number<br><br><span class="hljs-built_in">set</span> <span class="hljs-built_in">paste</span><br><br><span class="hljs-built_in">set</span> showmatch<br><br>autocmd BufNewFile *.py,*.sh <span class="hljs-built_in">exec</span> <span class="hljs-string">&quot;:call SetTitle()&quot;</span><br><br>func SetTitle()<br><span class="hljs-keyword">if</span> <span class="hljs-built_in">expand</span>(<span class="hljs-string">&quot;%:e&quot;</span>) == <span class="hljs-string">&#x27;sh&#x27;</span><br>    call setline(1,<span class="hljs-string">&quot;#!/bin/bash&quot;</span>)<br>elseif <span class="hljs-built_in">expand</span>(<span class="hljs-string">&quot;%:e&quot;</span>) == <span class="hljs-string">&#x27;py&#x27;</span><br>    call setline(1,<span class="hljs-string">&quot;#!/bin/python&quot;</span>)<br>endif<br><br>call setline(2,<span class="hljs-string">&quot;&quot;</span>)<br>call setline(3,<span class="hljs-string">&quot;#------------------------------------------------#&quot;</span>)<br>call setline(4,<span class="hljs-string">&quot;#Author:         wpsze&quot;</span>)<br>call setline(5,<span class="hljs-string">&quot;#Emailï¼š         wpsze@gmail.com&quot;</span>)<br>call setline(6,<span class="hljs-string">&quot;#date:           &quot;</span>.strftime(<span class="hljs-string">&quot;%Y-%m-%d %H:%M:%S&quot;</span>))<br>call setline(7,<span class="hljs-string">&quot;#Version:        0.0 &quot;</span>)<br>call setline(8,<span class="hljs-string">&quot;#Description:    The purpose of the script&quot;</span>)<br>call setline(9,<span class="hljs-string">&quot;#Copyright (C)ï¼š &quot;</span>.strftime(<span class="hljs-string">&quot;%Y&quot;</span>).<span class="hljs-string">&quot; All rights reserved&quot;</span>)<br>call setline(10,<span class="hljs-string">&quot;#------------------------------------------------#&quot;</span>)<br>call setline(11,<span class="hljs-string">&quot;&quot;</span>)<br>call setline(12,<span class="hljs-string">&quot;&quot;</span>)<br><br><span class="hljs-keyword">if</span> <span class="hljs-built_in">expand</span>(<span class="hljs-string">&quot;%:e&quot;</span>) == <span class="hljs-string">&#x27;sh&#x27;</span><br>    call setline(14, <span class="hljs-string">&quot;#source /home/wpsze/anaconda3/bin/activate venv&quot;</span>)<br>    call setline(16, <span class="hljs-string">&quot;export SCRIPT_DIR=\x22<span class="hljs-subst">$( cd \x22$( dirname \x22$&#123;BASH_SOURCE[0]&#125;\x22 )</span>\x22 &gt;/dev/null 2&gt;&amp;1 &amp;&amp; pwd )\x22&quot;</span>)<br>endif<br><br>endfunc<br><br>autocmd BufNewFile * normal G<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>HPC</tag>
      
      <tag>vim</tag>
      
      <tag>editor</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HKO station and analysis</title>
    <link href="/2023/06/24/HKO-station-and-analysis/"/>
    <url>/2023/06/24/HKO-station-and-analysis/</url>
    
    <content type="html"><![CDATA[<h1 id="download-hko-weather-dataset">Download HKO weather dataset</h1><p>From <a href="https://i-lens.hk/hkweather/">i-lens.hk é¦™æ¸¯è‡ªå‹•æ°£è±¡ç«™æ°£å€™è§€æ¸¬è³‡æ–™åº«</a> <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">export</span> yyyy=2023<br><span class="hljs-built_in">export</span> mm=04<br><br><span class="hljs-keyword">for</span> <span class="hljs-built_in">dd</span> <span class="hljs-keyword">in</span> &#123;14..16&#125;; <span class="hljs-keyword">do</span><br>    wget http://i-lens.hk/hkweather/history_minute_record/<span class="hljs-variable">$&#123;yyyy&#125;</span>/<span class="hljs-variable">$&#123;yyyy&#125;</span><span class="hljs-variable">$&#123;mm&#125;</span><span class="hljs-variable">$&#123;dd&#125;</span>.zip ;<br>    <span class="hljs-built_in">echo</span> $mm<span class="hljs-variable">$dd</span> sleeping now ;<br>    <span class="hljs-comment">#mkdir -p $yyyy</span><br>    <span class="hljs-comment">#mv $&#123;yyyy&#125;$&#123;mm&#125;$&#123;dd&#125;* ./$&#123;yyyy&#125; ;</span><br>    <span class="hljs-comment">#sleep $((80 + RANDOM % 21)) ;</span><br><span class="hljs-keyword">done</span><br></code></pre></td></tr></table></figure> Subsequently, extract those elements.</p><h1 id="list-of-hko-station">List of HKO station</h1><p>As part of the HKO stations, the majority of the names I use align with the definitions provided by HKO. However, there are a few instances where I have personally assigned names to certain elements.</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs sh">ID,lat,lon,station,station_en,station_ch<br>1,22.301944,114.174167,hko,HKO (Tsim Sha Tsui),é¦™æ¸¯å¤©æ–‡å°<br>2,22.201111,114.026667,cch,Cheung Chau,é•·æ´²<br>3,22.263389,114.299769,cwb,Clear water bay,æ¸…æ°´ç£<br>4,22.309444,113.921944,hka,HK Airport,é¦™æ¸¯åœ‹éš›æ©Ÿå ´<br>5,22.278333,114.162222,hkp,Hong Kong Park,é¦™æ¸¯å…¬åœ’<br>6,22.247778,114.173611,hks,Wong Chuk Hang,é»ƒç«¹å‘<br>7,22.270556,114.183611,hpv,Happy Valley,è·‘é¦¬åœ°<br>8,22.315833,114.255556,jkb,Tseung Kwan O,å°‡è»æ¾³<br>9,22.335000,114.184722,klt,Kowloon City,ä¹é¾åŸ<br>10,22.311944,114.172778,kp,Kingâ€™s Park,äº¬å£«æŸ<br>11,22.370278,114.312500,ksc,Kau Sai Chau,æ»˜è¥¿æ´²<br>12,22.318611,114.224722,ktg,Kwun Tong,è§€å¡˜<br>13,22.468889,113.983611,lfs,Lau Fau Shan,æµæµ®å±±<br>14,22.258611,113.912778,ngp,Ngong Ping,æ˜‚åª<br>15,22.291111,114.043333,pen,Peng Chau,åªæ´²<br>16,22.475278,114.237500,plc,Tai Mei Tuk,å¤§ç¾ç£<br>17,22.304722,114.217222,se1,Kai Tak Runway Park,å•Ÿå¾·è·‘é“å…¬åœ’<br>18,22.436111,114.084722,sek,Shek Kong,çŸ³å´—<br>19,22.402500,114.210000,sha,Sha Tin,æ²™ç”°<br>20,22.375556,114.274444,skg,Sai Kung,è¥¿è²¢<br>21,22.281667,114.236111,skw,Shau Kei Wan,ç­²ç®•ç£<br>22,22.501944,114.111111,ssh,Sheung Shui,ä¸Šæ°´<br>23,22.335833,114.136944,ssp,Sham Shui Po,æ·±æ°´åŸ—<br>24,22.214167,114.218611,sty,Stanley,èµ¤æŸ±<br>25,22.357778,114.217778,tc,Tate<span class="hljs-string">&#x27;s Cairn,å¤§è€å±±</span><br><span class="hljs-string">26,22.528611,114.156667,tkl,Ta Kwu Ling,æ‰“é¼“å¶º</span><br><span class="hljs-string">27,22.483480,114.117400,tl,Tai Lung,å¤§éš´</span><br><span class="hljs-string">28,22.410556,114.124444,tms,Tai Mo Shan,å¤§å¸½å±±</span><br><span class="hljs-string">29,22.446111,114.178889,tpo,Tai Po,å¤§åŸ”</span><br><span class="hljs-string">30,22.385833,113.964167,tu1,Tuen Mun Children and Juvenile Home,å±¯é–€å…’ç«¥åŠé’å°‘å¹´é™¢</span><br><span class="hljs-string">31,22.375556,114.126667,tw,Shing Mun Valley,èƒç£åŸé–€è°·</span><br><span class="hljs-string">32,22.383611,114.107778,twn,Tsuen Wan,èƒç£</span><br><span class="hljs-string">33,22.344167,114.110000,ty1,Tsing Yi Station,æ–°é’è¡£ç«™</span><br><span class="hljs-string">34,22.402778,114.323056,tyw,Pak Tam Chung,åŒ—æ½­æ¶Œ(é¯½é­šæ¹–)</span><br><span class="hljs-string">35,22.264167,114.155000,vp1,The Peak,å±±é ‚</span><br><span class="hljs-string">36,22.182222,114.303333,wgl,Waglan Island,æ©«ç€¾å³¶</span><br><span class="hljs-string">37,22.466667,114.008889,wlp,Wetland Park,æ¿•åœ°å…¬åœ’</span><br><span class="hljs-string">38,22.339444,114.205278,wts,Wong Tai Sin,é»ƒå¤§ä»™</span><br><span class="hljs-string">39,22.440833,114.018333,ylp,ylp,ylp</span><br></code></pre></td></tr></table></figure><h1 id="jupter-notebook-or-python">Jupter Notebook or python</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python</span><br><span class="hljs-comment"># coding: utf-8</span><br><br><span class="hljs-comment"># In[1]:</span><br><br><br><span class="hljs-keyword">import</span> glob, os<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">import</span> xarray <span class="hljs-keyword">as</span> xr<br><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<br><span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> timedelta<br><br><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt<br><span class="hljs-keyword">from</span> matplotlib <span class="hljs-keyword">import</span> cm<br>SMALL_SIZE = <span class="hljs-number">8</span><br>MEDIUM_SIZE = <span class="hljs-number">10</span><br>BIGGER_SIZE = <span class="hljs-number">24</span><br><br>plt.rcParams[<span class="hljs-string">&quot;figure.figsize&quot;</span>] = (<span class="hljs-number">10</span>,<span class="hljs-number">8</span>)<br>plt.rc(<span class="hljs-string">&#x27;font&#x27;</span>, size=BIGGER_SIZE)          <span class="hljs-comment"># controls default text sizes</span><br>plt.rc(<span class="hljs-string">&#x27;axes&#x27;</span>, titlesize=BIGGER_SIZE)     <span class="hljs-comment"># fontsize of the axes title</span><br>plt.rc(<span class="hljs-string">&#x27;axes&#x27;</span>, labelsize=BIGGER_SIZE)    <span class="hljs-comment"># fontsize of the x and y labels</span><br>plt.rc(<span class="hljs-string">&#x27;xtick&#x27;</span>, labelsize=BIGGER_SIZE)    <span class="hljs-comment"># fontsize of the tick labels</span><br>plt.rc(<span class="hljs-string">&#x27;ytick&#x27;</span>, labelsize=BIGGER_SIZE)    <span class="hljs-comment"># fontsize of the tick labels</span><br>plt.rc(<span class="hljs-string">&#x27;legend&#x27;</span>, fontsize=BIGGER_SIZE)    <span class="hljs-comment"># legend fontsize</span><br>plt.rc(<span class="hljs-string">&#x27;figure&#x27;</span>, titlesize=BIGGER_SIZE)  <span class="hljs-comment"># fontsize of the figure title</span><br><br><span class="hljs-comment"># plt.rcParams[&#x27;font.sans-serif&#x27;] = [&#x27;SimHei&#x27;] </span><br><span class="hljs-comment"># plt.rcParams[&#x27;axes.unicode_minus&#x27;] = False</span><br><br>plt.rcParams.update(&#123;<span class="hljs-string">&#x27;font.family&#x27;</span>:<span class="hljs-string">&#x27;sans-serif&#x27;</span>&#125;)<br>plt.rcParams[<span class="hljs-string">&#x27;font.sans-serif&#x27;</span>] = [<span class="hljs-string">&#x27;DejaVu Sans&#x27;</span>]<br><br><span class="hljs-comment"># from IPython.core.interactiveshell import InteractiveShell</span><br><span class="hljs-comment"># InteractiveShell.ast_node_interactivity = &quot;all&quot;</span><br><br><br><span class="hljs-comment"># # Reading all dataset</span><br><br><span class="hljs-comment"># In[2]:</span><br><br><br>select_year = <span class="hljs-string">&quot;202304&quot;</span><br><br>station = pd.read_csv(<span class="hljs-string">r&#x27;./HKO-station.csv&#x27;</span>, header=<span class="hljs-number">0</span>) <span class="hljs-comment"># nearwater or inland</span><br>select_num = <span class="hljs-number">7</span><br><span class="hljs-comment">#======================================== station =============================================</span><br>select_station = station[<span class="hljs-string">&quot;station&quot;</span>][select_num]<br>select_station_en = station[<span class="hljs-string">&quot;station_en&quot;</span>][select_num]<br>select_station_ch = station[<span class="hljs-string">&quot;station_ch&quot;</span>][select_num]<br>file_name_t2m = select_station+<span class="hljs-string">&quot;_&quot;</span>+select_year<br>file_name_wind = select_station+<span class="hljs-string">&quot;_wd_&quot;</span>+select_year<br>file_name_pressure = select_station+<span class="hljs-string">&quot;_pre_&quot;</span>+select_year<br><span class="hljs-built_in">print</span>(select_num, select_station, select_station_en, select_station_ch)<br>station<br><br><br><span class="hljs-comment"># In[3]:</span><br><br><br><span class="hljs-comment">#========================================= mpas ================================================</span><br>mpas_station_extraction_dir=<span class="hljs-string">&quot;/xxx/xxx/station_xxxx.csv&quot;</span><br>df_mpas = pd.read_csv(mpas_station_extraction_dir)<br><span class="hljs-comment"># .dt.tz_localize(None): to remove timezone from a Timestamp column in a pandas dataframe</span><br>df_mpas[<span class="hljs-string">&quot;Date(UTC)&quot;</span>] = pd.to_datetime(df_mpas[<span class="hljs-string">&quot;xtime[UTC]&quot;</span>], utc=<span class="hljs-string">&quot;false&quot;</span>).dt.tz_localize(<span class="hljs-literal">None</span>)<br>df_mpas[<span class="hljs-string">&quot;Date(HKT)&quot;</span>] = df_mpas[<span class="hljs-string">&quot;Date(UTC)&quot;</span>] + timedelta(hours=<span class="hljs-number">8</span>)<br><br>df_select_mpas = df_mpas[df_mpas[<span class="hljs-string">&quot;station&quot;</span>] == select_station]<br>df_select_mpas = df_select_mpas.reset_index(drop = <span class="hljs-literal">True</span>)<br><br><span class="hljs-comment">#=========================================== HKO t2m ==============================================</span><br>obs_file = []<br><span class="hljs-keyword">for</span> file <span class="hljs-keyword">in</span> glob.glob(<span class="hljs-string">f&quot;/home/wpsze/hk_data/<span class="hljs-subst">&#123;select_year&#125;</span>*/<span class="hljs-subst">&#123;file_name_t2m&#125;</span>*&quot;</span>):<br>    obs_file.append(file)<br><span class="hljs-built_in">print</span>(obs_file)<br>df = pd.concat((pd.read_csv(f, header = <span class="hljs-number">0</span>, na_values=[<span class="hljs-string">&#x27;nan&#x27;</span>], keep_default_na=<span class="hljs-literal">True</span>) <span class="hljs-keyword">for</span> f <span class="hljs-keyword">in</span> obs_file))<br>df_hko_obs = df.drop_duplicates()<br>df_hko_obs = df_hko_obs.reset_index(drop = <span class="hljs-literal">True</span>)<br><br>df_hko_obs[<span class="hljs-string">&quot;Date(HKT)&quot;</span>] = pd.to_datetime(df_hko_obs[<span class="hljs-string">&quot;Date&quot;</span>]) <br>df_hko_obs[<span class="hljs-string">&quot;Date(UTC)&quot;</span>] = df_hko_obs[<span class="hljs-string">&quot;Date(HKT)&quot;</span>] + timedelta(hours=-<span class="hljs-number">8</span>)<br>df_hko_obs = df_hko_obs.reset_index(drop = <span class="hljs-literal">True</span>)<br>df_hko_obs<br><span class="hljs-comment">#=========================================================================================</span><br>df_combine = pd.merge(df_select_mpas, df_hko_obs)<br><span class="hljs-comment">#=========================================== HKO wind ==============================================</span><br>obs_file = []<br><span class="hljs-keyword">for</span> file <span class="hljs-keyword">in</span> glob.glob(<span class="hljs-string">f&quot;/home/home/wpsze/hk_data/<span class="hljs-subst">&#123;select_year&#125;</span>*/<span class="hljs-subst">&#123;file_name_wind&#125;</span>*&quot;</span>):<br>    obs_file.append(file)<br><span class="hljs-built_in">print</span>(obs_file)<br>df = pd.concat((pd.read_csv(f, header = <span class="hljs-number">0</span>, na_values=[<span class="hljs-string">&#x27;nan&#x27;</span>], keep_default_na=<span class="hljs-literal">True</span>) <span class="hljs-keyword">for</span> f <span class="hljs-keyword">in</span> obs_file))<br>df_hko_obs = df.drop_duplicates()<br>df_hko_obs = df_hko_obs.reset_index(drop = <span class="hljs-literal">True</span>)<br>df_hko_obs<br><br>df_hko_obs[<span class="hljs-string">&quot;Date(HKT)&quot;</span>] = pd.to_datetime(df_hko_obs[<span class="hljs-string">&quot;Date&quot;</span>]) <br>df_hko_obs[<span class="hljs-string">&quot;Date(UTC)&quot;</span>] = df_hko_obs[<span class="hljs-string">&quot;Date(HKT)&quot;</span>] + timedelta(hours=-<span class="hljs-number">8</span>)<br>df_hko_obs[<span class="hljs-string">&quot;obs-wspd[m/s]&quot;</span>] = df_hko_obs[<span class="hljs-string">&quot;Wind Spd&quot;</span>]*<span class="hljs-number">0.514444444</span> <span class="hljs-comment"># knt to m/s</span><br>df_hko_obs[<span class="hljs-string">&quot;obs-wdir[deg]&quot;</span>] = df_hko_obs[<span class="hljs-string">&quot; Wind Dir&quot;</span>]<br>df_hko_obs = df_hko_obs.reset_index(drop = <span class="hljs-literal">True</span>)<br>df_hko_obs<br><span class="hljs-comment">#=========================================================================================</span><br>df_combine = pd.merge(df_combine, df_hko_obs)<br><span class="hljs-comment">#=========================================================================================</span><br>spin_up_period = <span class="hljs-number">72</span><br>df_combine_skip_spinup = df_combine[spin_up_period:]<br>df_combine_skip_spinup = df_combine_skip_spinup.reset_index(drop = <span class="hljs-literal">True</span>)<br>df_combine_skip_spinup<br><br><br><span class="hljs-comment"># In[4]:</span><br><br><br>df_combine_final = df_combine_skip_spinup[df_combine_skip_spinup[<span class="hljs-string">&quot;obs-wspd[m/s]&quot;</span>]&lt;<span class="hljs-number">100</span>] <br>df_combine_final = df_combine_final.reset_index(drop = <span class="hljs-literal">True</span>)<br>df_combine_final<br><br><br><span class="hljs-comment"># # For t2m</span><br><br><span class="hljs-comment"># In[33]:</span><br><br><br>plt.plot(df_combine_final[<span class="hljs-string">&quot;Date(HKT)&quot;</span>], df_combine_final[<span class="hljs-string">&quot;Temp&quot;</span>], <span class="hljs-string">&#x27;ko-&#x27;</span>, label=<span class="hljs-string">&quot;Obs&quot;</span>)<br>plt.plot(df_combine_final[<span class="hljs-string">&quot;Date(HKT)&quot;</span>], df_combine_final[<span class="hljs-string">&quot;t2m[degC]&quot;</span>],<span class="hljs-string">&#x27;bo-&#x27;</span>, label=<span class="hljs-string">&quot;mpas&quot;</span>)<br>plt.grid(zorder=<span class="hljs-number">0</span>)<br>plt.xlabel(<span class="hljs-string">&quot;Date Time (HKT)&quot;</span>)<br>plt.ylabel(<span class="hljs-string">&quot;T2m [deg C]&quot;</span>)<br>plt.title(select_station_en)<br>plt.xticks(rotation=<span class="hljs-number">45</span>)<br>plt.legend()<br>plt.tight_layout()<br>plt.show()<br>plt.close()<br><br><span class="hljs-comment"># df_combine_final[&quot;Temp&quot;]</span><br><br><br><span class="hljs-comment"># # For wind speed</span><br><br><span class="hljs-comment"># In[6]:</span><br><br><br>plt.plot(df_combine_final[<span class="hljs-string">&quot;Date(HKT)&quot;</span>], df_combine_final[<span class="hljs-string">&quot;Temp&quot;</span>], <span class="hljs-string">&#x27;ko-&#x27;</span>, label=<span class="hljs-string">&quot;Obs&quot;</span>)<br>plt.plot(df_combine_final[<span class="hljs-string">&quot;Date(HKT)&quot;</span>], df_combine_final[<span class="hljs-string">&quot;t2m[degC]&quot;</span>],<span class="hljs-string">&#x27;bo-&#x27;</span>, label=<span class="hljs-string">&quot;mpas&quot;</span>)<br>plt.grid(zorder=<span class="hljs-number">0</span>)<br>plt.xlabel(<span class="hljs-string">&quot;Date Time (HKT)&quot;</span>)<br>plt.ylabel(<span class="hljs-string">&quot;T2m [deg C]&quot;</span>)<br>plt.title(select_station_en)<br>plt.xticks(rotation=<span class="hljs-number">45</span>)<br>plt.legend()<br>plt.show()<br>plt.close()<br><br><br><span class="hljs-comment"># In[7]:</span><br><br><br><span class="hljs-comment">#=========================================================</span><br><br>hko_wind = df_combine_final[<span class="hljs-string">&quot;obs-wspd[m/s]&quot;</span>]<br>hko_wdir = df_combine_final[<span class="hljs-string">&quot;obs-wdir[deg]&quot;</span>]<br><br>size = hko_wdir.shape[<span class="hljs-number">0</span>]<br><br>wspd = hko_wind*<span class="hljs-number">1.9438452</span>    <span class="hljs-comment"># m/s to kt</span><br>wdir = hko_wdir*<span class="hljs-number">0.0174532925</span> <span class="hljs-comment"># deg to rad</span><br>U_obs = -wspd*np.sin(wdir)<br>V_obs = -wspd*np.cos(wdir)<br><br>df = pd.DataFrame(np.vstack([U_obs,V_obs]).T, columns=[<span class="hljs-string">&#x27;U&#x27;</span>, <span class="hljs-string">&#x27;V&#x27;</span>])<br><br><span class="hljs-comment">#=========================================================</span><br>mpas_wind = df_combine_final[<span class="hljs-string">&quot;wspd[m/s]&quot;</span>]<br>mpas_wdir = df_combine_final[<span class="hljs-string">&quot;wdir[deg]&quot;</span>]<br><br>wspd = mpas_wind*<span class="hljs-number">1.9438452</span>    <span class="hljs-comment"># m/s to kt</span><br>wdir = mpas_wdir*<span class="hljs-number">0.0174532925</span> <span class="hljs-comment"># deg to rad</span><br>U_mpas = -wspd*np.sin(wdir)<br>V_mpas = -wspd*np.cos(wdir)<br><br>df_mpas = pd.DataFrame(np.vstack([U_mpas,V_mpas]).T, columns=[<span class="hljs-string">&#x27;U&#x27;</span>, <span class="hljs-string">&#x27;V&#x27;</span>])<br><br><span class="hljs-comment">#=========================================================</span><br><br>fig, ax = plt.subplots(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>, figsize=(<span class="hljs-number">15</span>,<span class="hljs-number">4</span>))<br><br><span class="hljs-comment"># ax.plot(df.index.values.astype(&#x27;d&#x27;), df.V * 0.1 + 4, color=&#x27;k&#x27;)</span><br><span class="hljs-comment"># ax.quiver(df.index.values.astype(&#x27;d&#x27;), np.ones(size) * 2, df.U.values, df.V.values) #, pivot=&#x27;mid&#x27;)</span><br><br>plt.barbs(df_combine_final[<span class="hljs-string">&quot;Date(HKT)&quot;</span>], np.ones(size) * <span class="hljs-number">4</span>, df.U.values, df.V.values, length=<span class="hljs-number">8</span>, barbcolor=<span class="hljs-string">&#x27;k&#x27;</span>)<br><br>plt.barbs(df_combine_final[<span class="hljs-string">&quot;Date(HKT)&quot;</span>], np.ones(size) * <span class="hljs-number">2</span>, df_mpas.U.values, df_mpas.V.values, length=<span class="hljs-number">8</span>, barbcolor=<span class="hljs-string">&#x27;b&#x27;</span>)<br><br>ax.set_ylim([-<span class="hljs-number">1</span>,<span class="hljs-number">6</span>])<br>plt.xticks(rotation=<span class="hljs-number">45</span>)<br>plt.xlabel(<span class="hljs-string">&quot;Date Time (HKT)&quot;</span>)<br>plt.title(select_station_en)<br>plt.xticks(rotation=<span class="hljs-number">45</span>)<br><span class="hljs-comment"># plt.legend()</span><br>plt.show()<br>plt.close()<br><br><br><span class="hljs-comment"># In[8]:</span><br><br><br>fig, ax = plt.subplots(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>, figsize=(<span class="hljs-number">15</span>,<span class="hljs-number">8</span>))<br><br>plt.plot(df_combine_final[<span class="hljs-string">&quot;Date(HKT)&quot;</span>], df_combine_final[<span class="hljs-string">&quot;obs-wspd[m/s]&quot;</span>], <span class="hljs-string">&#x27;ko-&#x27;</span>, label=<span class="hljs-string">&quot;Obs&quot;</span>)<br>plt.plot(df_combine_final[<span class="hljs-string">&quot;Date(HKT)&quot;</span>], df_combine_final[<span class="hljs-string">&quot;wspd[m/s]&quot;</span>],<span class="hljs-string">&#x27;ro-&#x27;</span>, label=<span class="hljs-string">&quot;mpas&quot;</span>)<br><br>plt.barbs(df_combine_final[<span class="hljs-string">&quot;Date(HKT)&quot;</span>], np.ones(size) * -<span class="hljs-number">2</span>, df.U.values, df.V.values, length=<span class="hljs-number">8</span>, barbcolor=<span class="hljs-string">&#x27;k&#x27;</span>)<br><br>plt.barbs(df_combine_final[<span class="hljs-string">&quot;Date(HKT)&quot;</span>], np.ones(size) * -<span class="hljs-number">5</span>, df_mpas.U.values, df_mpas.V.values, length=<span class="hljs-number">8</span>, barbcolor=<span class="hljs-string">&#x27;r&#x27;</span>)<br><br>plt.grid(zorder=<span class="hljs-number">0</span>)<br>plt.xlabel(<span class="hljs-string">&quot;Date Time (HKT)&quot;</span>)<br>plt.ylabel(<span class="hljs-string">&quot;Wind Speed [m/s]&quot;</span>)<br>plt.title(select_station_en)<br>plt.xticks(rotation=<span class="hljs-number">45</span>)<br>plt.ylim([-<span class="hljs-number">7</span>,<span class="hljs-number">12</span>])<br>plt.axhline(y=<span class="hljs-number">0.0</span>, color=<span class="hljs-string">&#x27;k&#x27;</span>, linestyle=<span class="hljs-string">&#x27;-&#x27;</span>)<br>plt.legend()<br>plt.show()<br>plt.close() <br><br><br><span class="hljs-comment"># ## Seperate u and v directions</span><br><span class="hljs-comment"># </span><br><span class="hljs-comment"># U_obs = -wspd x np.sin(wdir)\</span><br><span class="hljs-comment"># V_obs = -wspd x np.cos(wdir)</span><br><br><span class="hljs-comment"># In[9]:</span><br><br><br>fig, ax = plt.subplots(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>, figsize=(<span class="hljs-number">15</span>,<span class="hljs-number">8</span>))<br><br>kt2ms = <span class="hljs-number">0.514444444</span><br><br>plt.plot(df_combine_final[<span class="hljs-string">&quot;Date(HKT)&quot;</span>], U_obs*kt2ms, <span class="hljs-string">&#x27;ko-&#x27;</span>, label=<span class="hljs-string">&quot;Obs&quot;</span>)<br>plt.plot(df_combine_final[<span class="hljs-string">&quot;Date(HKT)&quot;</span>], U_mpas*kt2ms,<span class="hljs-string">&#x27;ro-&#x27;</span>, label=<span class="hljs-string">&quot;mpas&quot;</span>)<br><br>plt.grid(zorder=<span class="hljs-number">0</span>)<br>plt.xlabel(<span class="hljs-string">&quot;Date Time (HKT)&quot;</span>)<br>plt.ylabel(<span class="hljs-string">&quot;U Wind Speed [m/s]&quot;</span>)<br>plt.title(select_station_en)<br>plt.xticks(rotation=<span class="hljs-number">45</span>)<br><span class="hljs-comment"># plt.ylim([-7,10])</span><br>plt.axhline(y=<span class="hljs-number">0.0</span>, color=<span class="hljs-string">&#x27;k&#x27;</span>, linestyle=<span class="hljs-string">&#x27;-&#x27;</span>)<br>plt.legend()<br>plt.show()<br>plt.close() <br><br>fig, ax = plt.subplots(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>, figsize=(<span class="hljs-number">15</span>,<span class="hljs-number">8</span>))<br><br>plt.plot(df_combine_final[<span class="hljs-string">&quot;Date(HKT)&quot;</span>], V_obs*kt2ms, <span class="hljs-string">&#x27;ko-&#x27;</span>, label=<span class="hljs-string">&quot;Obs&quot;</span>)<br>plt.plot(df_combine_final[<span class="hljs-string">&quot;Date(HKT)&quot;</span>], V_mpas*kt2ms,<span class="hljs-string">&#x27;ro-&#x27;</span>, label=<span class="hljs-string">&quot;mpas&quot;</span>)<br><br>plt.grid(zorder=<span class="hljs-number">0</span>)<br>plt.xlabel(<span class="hljs-string">&quot;Date Time (HKT)&quot;</span>)<br>plt.ylabel(<span class="hljs-string">&quot;V Wind Speed [m/s]&quot;</span>)<br>plt.title(select_station_en)<br>plt.xticks(rotation=<span class="hljs-number">45</span>)<br><span class="hljs-comment"># plt.ylim([-7,10])</span><br>plt.axhline(y=<span class="hljs-number">0.0</span>, color=<span class="hljs-string">&#x27;k&#x27;</span>, linestyle=<span class="hljs-string">&#x27;-&#x27;</span>)<br>plt.legend()<br>plt.show()<br>plt.close() <br><br><br><span class="hljs-comment"># # Final Plot</span><br><br><span class="hljs-comment"># In[26]:</span><br><br><br>fig = plt.subplots(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>, figsize=(<span class="hljs-number">20</span>,<span class="hljs-number">12</span>))<br><br>ax = plt.subplot(<span class="hljs-number">221</span>)<br>plt.plot(df_combine_final[<span class="hljs-string">&quot;Date(HKT)&quot;</span>], df_combine_final[<span class="hljs-string">&quot;Temp&quot;</span>], <span class="hljs-string">&#x27;ko-&#x27;</span>, label=<span class="hljs-string">&quot;Obs&quot;</span>)<br>plt.plot(df_combine_final[<span class="hljs-string">&quot;Date(HKT)&quot;</span>], df_combine_final[<span class="hljs-string">&quot;t2m[degC]&quot;</span>],<span class="hljs-string">&#x27;ro-&#x27;</span>, label=<span class="hljs-string">&quot;mpas&quot;</span>)<br>plt.grid(zorder=<span class="hljs-number">0</span>)<br>plt.xlabel(<span class="hljs-string">&quot;Date Time (HKT)&quot;</span>)<br>plt.ylabel(<span class="hljs-string">&quot;T2m [deg C]&quot;</span>)<br>plt.title(select_station_en)<br>plt.xticks(rotation=<span class="hljs-number">45</span>)<br>plt.legend()<br>plt.tight_layout()<br><br>ax = plt.subplot(<span class="hljs-number">222</span>)<br>plt.plot(df_combine_final[<span class="hljs-string">&quot;Date(HKT)&quot;</span>], df_combine_final[<span class="hljs-string">&quot;obs-wspd[m/s]&quot;</span>], <span class="hljs-string">&#x27;ko-&#x27;</span>, label=<span class="hljs-string">&quot;Obs&quot;</span>)<br>plt.plot(df_combine_final[<span class="hljs-string">&quot;Date(HKT)&quot;</span>], df_combine_final[<span class="hljs-string">&quot;wspd[m/s]&quot;</span>],<span class="hljs-string">&#x27;ro-&#x27;</span>, label=<span class="hljs-string">&quot;mpas&quot;</span>)<br>plt.barbs(df_combine_final[<span class="hljs-string">&quot;Date(HKT)&quot;</span>], np.ones(size) * -<span class="hljs-number">2</span>, df.U.values, df.V.values, length=<span class="hljs-number">8</span>, barbcolor=<span class="hljs-string">&#x27;k&#x27;</span>)<br>plt.barbs(df_combine_final[<span class="hljs-string">&quot;Date(HKT)&quot;</span>], np.ones(size) * -<span class="hljs-number">5</span>, df_mpas.U.values, df_mpas.V.values, length=<span class="hljs-number">8</span>, barbcolor=<span class="hljs-string">&#x27;r&#x27;</span>)<br>plt.grid(zorder=<span class="hljs-number">0</span>)<br>plt.xlabel(<span class="hljs-string">&quot;Date Time (HKT)&quot;</span>)<br>plt.ylabel(<span class="hljs-string">&quot;Wind Speed [m/s]&quot;</span>)<br>plt.title(select_station_en)<br>plt.xticks(rotation=<span class="hljs-number">45</span>)<br>plt.ylim([-<span class="hljs-number">7</span>,<span class="hljs-number">12</span>])<br>plt.axhline(y=<span class="hljs-number">0.0</span>, color=<span class="hljs-string">&#x27;k&#x27;</span>, linestyle=<span class="hljs-string">&#x27;-&#x27;</span>)<br>plt.legend()<br><br><br>kt2ms = <span class="hljs-number">0.514444444</span><br>ax = plt.subplot(<span class="hljs-number">223</span>)<br>plt.plot(df_combine_final[<span class="hljs-string">&quot;Date(HKT)&quot;</span>], U_obs*kt2ms, <span class="hljs-string">&#x27;ko-&#x27;</span>, label=<span class="hljs-string">&quot;Obs&quot;</span>)<br>plt.plot(df_combine_final[<span class="hljs-string">&quot;Date(HKT)&quot;</span>], U_mpas*kt2ms,<span class="hljs-string">&#x27;ro-&#x27;</span>, label=<span class="hljs-string">&quot;mpas&quot;</span>)<br>plt.grid(zorder=<span class="hljs-number">0</span>)<br>plt.xlabel(<span class="hljs-string">&quot;Date Time (HKT)&quot;</span>)<br>plt.ylabel(<span class="hljs-string">&quot;U Wind Speed [m/s]&quot;</span>)<br>plt.title(select_station_en)<br>plt.xticks(rotation=<span class="hljs-number">45</span>)<br><span class="hljs-comment"># plt.ylim([-7,10])</span><br>plt.axhline(y=<span class="hljs-number">0.0</span>, color=<span class="hljs-string">&#x27;k&#x27;</span>, linestyle=<span class="hljs-string">&#x27;-&#x27;</span>)<br>plt.legend()<br><br><br>ax = plt.subplot(<span class="hljs-number">224</span>)<br>plt.plot(df_combine_final[<span class="hljs-string">&quot;Date(HKT)&quot;</span>], V_obs*kt2ms, <span class="hljs-string">&#x27;ko-&#x27;</span>, label=<span class="hljs-string">&quot;Obs&quot;</span>)<br>plt.plot(df_combine_final[<span class="hljs-string">&quot;Date(HKT)&quot;</span>], V_mpas*kt2ms,<span class="hljs-string">&#x27;ro-&#x27;</span>, label=<span class="hljs-string">&quot;mpas&quot;</span>)<br>plt.grid(zorder=<span class="hljs-number">0</span>)<br>plt.xlabel(<span class="hljs-string">&quot;Date Time (HKT)&quot;</span>)<br>plt.ylabel(<span class="hljs-string">&quot;V Wind Speed [m/s]&quot;</span>)<br>plt.title(select_station_en)<br>plt.xticks(rotation=<span class="hljs-number">45</span>)<br><span class="hljs-comment"># plt.ylim([-7,10])</span><br>plt.axhline(y=<span class="hljs-number">0.0</span>, color=<span class="hljs-string">&#x27;k&#x27;</span>, linestyle=<span class="hljs-string">&#x27;-&#x27;</span>)<br>plt.legend()<br><br>plt.show()<br>plt.close() <br><br><br><span class="hljs-comment"># In[ ]:</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>NWP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>WRF</tag>
      
      <tag>MPAS</tag>
      
      <tag>HKO</tag>
      
      <tag>obs</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Jupyter-Notebook</title>
    <link href="/2023/06/24/Jupyter-Notebook/"/>
    <url>/2023/06/24/Jupyter-Notebook/</url>
    
    <content type="html"><![CDATA[<h1 id="how-to-display-full-output-in-jupyter-not-only-last-result">How to display full output in Jupyter, not only last result?</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> IPython.core.interactiveshell <span class="hljs-keyword">import</span> InteractiveShell<br>InteractiveShell.ast_node_interactivity = <span class="hljs-string">&quot;all&quot;</span><br></code></pre></td></tr></table></figure><h1 id="sample-plot">Sample plot</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs sh">import os.path<br>import xarray as xr<br>import numpy as np<br>import matplotlib.pyplot as plt<br>import pandas as pd<br><br>SMALL_SIZE = 8<br>MEDIUM_SIZE = 10<br>BIGGER_SIZE = 24<br><br>plt.rcParams[<span class="hljs-string">&quot;figure.figsize&quot;</span>] = (10,8)<br>plt.rc(<span class="hljs-string">&#x27;font&#x27;</span>, size=BIGGER_SIZE)          <span class="hljs-comment"># controls default text sizes</span><br>plt.rc(<span class="hljs-string">&#x27;axes&#x27;</span>, titlesize=BIGGER_SIZE)     <span class="hljs-comment"># fontsize of the axes title</span><br>plt.rc(<span class="hljs-string">&#x27;axes&#x27;</span>, labelsize=BIGGER_SIZE)    <span class="hljs-comment"># fontsize of the x and y labels</span><br>plt.rc(<span class="hljs-string">&#x27;xtick&#x27;</span>, labelsize=BIGGER_SIZE)    <span class="hljs-comment"># fontsize of the tick labels</span><br>plt.rc(<span class="hljs-string">&#x27;ytick&#x27;</span>, labelsize=BIGGER_SIZE)    <span class="hljs-comment"># fontsize of the tick labels</span><br>plt.rc(<span class="hljs-string">&#x27;legend&#x27;</span>, fontsize=BIGGER_SIZE)    <span class="hljs-comment"># legend fontsize</span><br>plt.rc(<span class="hljs-string">&#x27;figure&#x27;</span>, titlesize=BIGGER_SIZE)  <span class="hljs-comment"># fontsize of the figure title</span><br><br><span class="hljs-comment"># plt.rcParams[&#x27;font.sans-serif&#x27;] = [&#x27;SimHei&#x27;] </span><br><span class="hljs-comment"># plt.rcParams[&#x27;axes.unicode_minus&#x27;] = False</span><br><br>plt.rcParams.update(&#123;<span class="hljs-string">&#x27;font.family&#x27;</span>:<span class="hljs-string">&#x27;sans-serif&#x27;</span>&#125;)<br>plt.rcParams[<span class="hljs-string">&#x27;font.sans-serif&#x27;</span>] = [<span class="hljs-string">&#x27;DejaVu Sans&#x27;</span>]<br><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#</span><br><br>plt.title(<span class="hljs-string">&quot;diff T2m (UCM-on - UCM-off) of selected urban area&quot;</span>)<br>plt.ylabel(<span class="hljs-string">&quot;T2m (deg C)&quot;</span>)<br>plt.xlabel(<span class="hljs-string">&quot;Time (HKT)&quot;</span>)<br><br><span class="hljs-comment"># Add a horizontal line across the Axes.</span><br>plt.axhline(y = 0.0, color = <span class="hljs-string">&#x27;k&#x27;</span>, linestyle=<span class="hljs-string">&#x27;--&#x27;</span>, linewidth=2, label = <span class="hljs-string">&#x27;axhline&#x27;</span>)<br>plt.axvline(x = 1.0, color = <span class="hljs-string">&#x27;b&#x27;</span>, linestyle=<span class="hljs-string">&#x27;--&#x27;</span>, linewidth=2, label = <span class="hljs-string">&#x27;axvline&#x27;</span>)<br><br>plt.xticks(rotation=45)<br>plt.grid(linestyle=<span class="hljs-string">&#x27;--&#x27;</span>)<br><br><span class="hljs-comment"># Put a legend to the right of the current axis</span><br>plt.legend(loc=<span class="hljs-string">&#x27;center left&#x27;</span>, bbox_to_anchor=(1, 0.5))<br>plt.tight_layout()<br>plt.show()<br>plt.close()<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Jupyter</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Jupyter</tag>
      
      <tag>python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Removing PDF protected mode</title>
    <link href="/2023/06/24/Removing-PDF-protected-mode/"/>
    <url>/2023/06/24/Removing-PDF-protected-mode/</url>
    
    <content type="html"><![CDATA[<h1 id="section"></h1><p>Removing PDF usage restrictions,</p><blockquote><p>view <a href="https://qpdf.sourceforge.io/">qpdf</a>,</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ <span class="hljs-built_in">sudo</span> apt install qpdf<br>$ qpdf --decrypt restricted-input.pdf unrestricted-output.pdf<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>PDF</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>WRF | WPS geo data and binary tile files</title>
    <link href="/2023/06/24/WPS-geo-data-and-binary-tile-files/"/>
    <url>/2023/06/24/WPS-geo-data-and-binary-tile-files/</url>
    
    <content type="html"><![CDATA[<h1 id="binary-files-in-the-geog-folder">Binary files in the geog folder</h1><p>The file naming convention is described on slides 14 and 15 of the <a href="https://www2.mmm.ucar.edu/wrf/users/tutorial/presentation_pdfs/202101/duda_wps_advanced.pdf">Advanced Usage of the WPS</a> tutorial presentation. If you have any additional questions about the file names, please don't hesitate to follow up in this forum and I can offer further details.</p><h1 id="reading-tile-fines-and-ploting">Reading tile fines and ploting</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">import</span> matplotlib <span class="hljs-keyword">as</span> mpl<br><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt<br><span class="hljs-keyword">import</span> glob<br><span class="hljs-keyword">import</span> re<br><span class="hljs-keyword">import</span> math<br><span class="hljs-keyword">from</span> matplotlib.colors <span class="hljs-keyword">import</span> ListedColormap<br><br>SMALL_SIZE = <span class="hljs-number">8</span><br>MEDIUM_SIZE = <span class="hljs-number">10</span><br>BIGGER_SIZE = <span class="hljs-number">24</span><br><br>plt.rcParams[<span class="hljs-string">&quot;figure.figsize&quot;</span>] = (<span class="hljs-number">10</span>,<span class="hljs-number">8</span>)<br>plt.rc(<span class="hljs-string">&#x27;font&#x27;</span>, size=BIGGER_SIZE)          <span class="hljs-comment"># controls default text sizes</span><br>plt.rc(<span class="hljs-string">&#x27;axes&#x27;</span>, titlesize=BIGGER_SIZE)     <span class="hljs-comment"># fontsize of the axes title</span><br>plt.rc(<span class="hljs-string">&#x27;axes&#x27;</span>, labelsize=BIGGER_SIZE)    <span class="hljs-comment"># fontsize of the x and y labels</span><br>plt.rc(<span class="hljs-string">&#x27;xtick&#x27;</span>, labelsize=BIGGER_SIZE)    <span class="hljs-comment"># fontsize of the tick labels</span><br>plt.rc(<span class="hljs-string">&#x27;ytick&#x27;</span>, labelsize=BIGGER_SIZE)    <span class="hljs-comment"># fontsize of the tick labels</span><br>plt.rc(<span class="hljs-string">&#x27;legend&#x27;</span>, fontsize=BIGGER_SIZE)    <span class="hljs-comment"># legend fontsize</span><br>plt.rc(<span class="hljs-string">&#x27;figure&#x27;</span>, titlesize=BIGGER_SIZE)  <span class="hljs-comment"># fontsize of the figure title</span><br><br><span class="hljs-comment"># plt.rcParams[&#x27;font.sans-serif&#x27;] = [&#x27;SimHei&#x27;] </span><br><span class="hljs-comment"># plt.rcParams[&#x27;axes.unicode_minus&#x27;] = False</span><br><br>plt.rcParams.update(&#123;<span class="hljs-string">&#x27;font.family&#x27;</span>:<span class="hljs-string">&#x27;sans-serif&#x27;</span>&#125;)<br>plt.rcParams[<span class="hljs-string">&#x27;font.sans-serif&#x27;</span>] = [<span class="hljs-string">&#x27;DejaVu Sans&#x27;</span>]<br><br><span class="hljs-comment"># Reading binary tile files</span><br><span class="hljs-comment"># file_dir = &quot;/dir/*&quot;</span><br>root_dir = <span class="hljs-string">&quot;/dir/geog/&quot;</span><br>dataset_dir = <span class="hljs-string">&quot;modis_landuse_20class_30s&quot;</span><br><span class="hljs-comment">#dataset_dir = &quot;modis_landuse_20class_15s&quot;</span><br><span class="hljs-comment"># dataset_dir = &quot;greenfrac_fpar_modis&quot;</span><br><span class="hljs-comment"># dataset_dir = &quot;topo_gmted2010_2.5m&quot;</span><br><span class="hljs-comment"># dataset_dir = &quot;topo_gmted2010_30s&quot;</span><br><span class="hljs-comment"># dataset_dir = &quot;soiltype_top_30s&quot;</span><br><span class="hljs-comment"># dataset_dir = &quot;albedo_modis&quot;</span><br><span class="hljs-comment"># dataset_dir = &quot;albedo_ncep&quot;</span><br><span class="hljs-comment"># dataset_dir = &quot;greenfrac&quot;</span><br><br>file_dir = root_dir + dataset_dir + <span class="hljs-string">&quot;/*&quot;</span><br><span class="hljs-built_in">print</span>(file_dir)<br>all_files = <span class="hljs-built_in">sorted</span>(glob.glob(file_dir))<br><br>all_files<br><br>index_file = all_files[-<span class="hljs-number">1</span>]<br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(index_file, <span class="hljs-string">&quot;r&quot;</span>) <span class="hljs-keyword">as</span> f:<br>    index_info = f.read()<br><span class="hljs-built_in">print</span>(index_info)<br><br><span class="hljs-comment">### WITHOUT SPACE ###</span><br>tile_x = <span class="hljs-built_in">int</span>(re.search(<span class="hljs-string">&#x27;tile_x=(.+?)\ntile_y&#x27;</span>, index_info).group(<span class="hljs-number">1</span>))<br>tile_y = <span class="hljs-built_in">int</span>(re.search(<span class="hljs-string">&#x27;tile_y=(.+?)\ntile_z&#x27;</span>, index_info).group(<span class="hljs-number">1</span>))<br>tile_z = <span class="hljs-built_in">int</span>(re.search(<span class="hljs-string">&#x27;tile_z=(.+?)\nunits&#x27;</span>, index_info).group(<span class="hljs-number">1</span>))  <span class="hljs-comment"># for land use, soiltype</span><br><span class="hljs-comment"># tile_z = int(re.search(&#x27;tile_z=(.+?)\nscale&#x27;, index_info).group(1))  # for greenfrac</span><br><br><span class="hljs-comment">### WITH SPACE ###</span><br><span class="hljs-comment"># tile_x = int(re.search(&#x27;tile_x = (.+?)\ntile_y&#x27;, index_info).group(1))</span><br><span class="hljs-comment"># tile_y = int(re.search(&#x27;tile_y = (.+?)\ntile_z&#x27;, index_info).group(1))</span><br><span class="hljs-comment"># tile_z = int(re.search(&#x27;tile_z = (.+?)\ntile_bdr&#x27;, index_info).group(1))  # for topo_gmted2010</span><br><br>tile_bdr = <span class="hljs-number">0</span>  <span class="hljs-comment"># default = 0?</span><br><span class="hljs-comment"># tile_bdr = int(re.search(&#x27;tile_bdr=(.+?)\nunits&#x27;, index_info).group(1))  # for topo_gmted2010</span><br><br><span class="hljs-comment"># (tile_z, tile_y + 2 * tile_bdr and tile_x + 2 * tile_bdr, tile_y + 2 * tile_bdr and tile_x + 2 * tile_bdr)</span><br>dim1 = tile_z<br>dim2 = tile_y + <span class="hljs-number">2</span> * tile_bdr<br>dim3 = tile_x + <span class="hljs-number">2</span> * tile_bdr<br><br><span class="hljs-comment"># degrees per pixel</span><br><span class="hljs-comment">### WITHOUT SPACE ###</span><br>dx = <span class="hljs-built_in">float</span>(re.search(<span class="hljs-string">&#x27;dx=(.+?)\ndy&#x27;</span>, index_info).group(<span class="hljs-number">1</span>))  <span class="hljs-comment"># for land use, greenfrac, soiltype</span><br><span class="hljs-comment">### WITH SPACE ###</span><br><span class="hljs-comment"># dx = float(re.search(&#x27;dx = (.+?)\ndy&#x27;, index_info).group(1))  # for topo_gmted2010</span><br><br><span class="hljs-built_in">print</span>(dim1, dim2, dim3)<br><span class="hljs-built_in">print</span>(tile_x, tile_y, tile_z, dx)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_tile_name</span>(<span class="hljs-params">pixels_per_tile, dx, target_lat, lat_hemi, target_lon, lon_hemi, pad=<span class="hljs-number">5</span></span>):<br>    <br>    <span class="hljs-comment"># lat starts from south pole</span><br>    <span class="hljs-keyword">if</span> lat_hemi == <span class="hljs-string">&#x27;S&#x27;</span>:<br>        lat = <span class="hljs-number">90</span> - target_lat<br>    <span class="hljs-keyword">elif</span> lat_hemi == <span class="hljs-string">&#x27;N&#x27;</span>:<br>        lat = <span class="hljs-number">90</span> + target_lat<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&#x27;Invalid lat_hemi&#x27;</span>)<br>        <br>    <span class="hljs-comment"># lon starts from international date line</span><br>    <span class="hljs-keyword">if</span> lon_hemi == <span class="hljs-string">&#x27;W&#x27;</span>:<br>        lon = <span class="hljs-number">180</span> - target_lon<br>    <span class="hljs-keyword">elif</span> lon_hemi == <span class="hljs-string">&#x27;E&#x27;</span>:<br>        lon = <span class="hljs-number">180</span> + target_lon<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&#x27;Invalid lon_hemi&#x27;</span>)<br>    <br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;lat&#x27;</span>, lat, <span class="hljs-string">&#x27;lon&#x27;</span>, lon)<br>    <br>    <span class="hljs-comment"># 10 deg per tile for 15s/30s</span><br>    degs_per_tile = <span class="hljs-built_in">round</span>(tile_x * dx)<br>    <span class="hljs-built_in">print</span>(degs_per_tile)<br>    <br><span class="hljs-comment">#     tile_left = int(math.floor(lon / 10) * 10)</span><br><span class="hljs-comment">#     tile_right = int(math.ceil(lon / 10) * 10)</span><br><span class="hljs-comment">#     tile_bot = int(math.floor(lat / 10) * 10)</span><br><span class="hljs-comment">#     tile_top = int(math.ceil(lat / 10) * 10)</span><br>    <br>    tile_left = <span class="hljs-built_in">int</span>(math.floor(lon / degs_per_tile) * degs_per_tile)<br>    tile_right = <span class="hljs-built_in">int</span>(math.ceil(lon / degs_per_tile) * degs_per_tile)<br>    tile_bot = <span class="hljs-built_in">int</span>(math.floor(lat / degs_per_tile) * degs_per_tile)<br>    tile_top = <span class="hljs-built_in">int</span>(math.ceil(lat / degs_per_tile) * degs_per_tile)  <br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;tile dims&#x27;</span>, tile_left, tile_right, tile_bot, tile_top)<br>    <br><span class="hljs-comment">#     tile_left_str = str(int(math.floor(lon / 10) * pixels_per_tile + 1))</span><br><span class="hljs-comment">#     tile_right_str = str(int(math.ceil(lon / 10) * pixels_per_tile))</span><br><span class="hljs-comment">#     tile_bot_str = str(int(math.floor(lat / 10) * pixels_per_tile + 1))</span><br><span class="hljs-comment">#     tile_top_str = str(int(math.ceil(lat / 10) * pixels_per_tile))</span><br><br>    tile_left_str = <span class="hljs-built_in">str</span>(<span class="hljs-built_in">int</span>(math.floor(lon / degs_per_tile) * pixels_per_tile + <span class="hljs-number">1</span>)).zfill(pad)<br>    tile_right_str = <span class="hljs-built_in">str</span>(<span class="hljs-built_in">int</span>(math.ceil(lon / degs_per_tile) * pixels_per_tile)).zfill(pad)<br>    tile_bot_str = <span class="hljs-built_in">str</span>(<span class="hljs-built_in">int</span>(math.floor(lat / degs_per_tile) * pixels_per_tile + <span class="hljs-number">1</span>)).zfill(pad)<br>    tile_top_str = <span class="hljs-built_in">str</span>(<span class="hljs-built_in">int</span>(math.ceil(lat / degs_per_tile) * pixels_per_tile)).zfill(pad)<br><br>    target_file = tile_left_str + <span class="hljs-string">&#x27;-&#x27;</span> + tile_right_str + <span class="hljs-string">&#x27;.&#x27;</span> + tile_bot_str + <span class="hljs-string">&#x27;-&#x27;</span> + tile_top_str<br>    <br>    <span class="hljs-keyword">return</span> target_file<br><br><span class="hljs-comment"># Set lat/lon</span><br><span class="hljs-comment">### WITHOUT SPACE ###</span><br>pixels_per_tile = <span class="hljs-built_in">int</span>(re.search(<span class="hljs-string">&#x27;tile_x=(.+?)\ntile_y&#x27;</span>, index_info).group(<span class="hljs-number">1</span>))<br><span class="hljs-comment">### WITH SPACE ###</span><br><span class="hljs-comment"># pixels_per_tile = int(re.search(&#x27;tile_x = (.+?)\ntile_y&#x27;, index_info).group(1))</span><br><br>search_lat = <span class="hljs-number">22.3</span><br>search_lon = <span class="hljs-number">114.2</span><br><span class="hljs-built_in">print</span>(pixels_per_tile)<br><br><span class="hljs-comment"># west region: 27.8 N, 92.0 E</span><br><br>search_tile = get_tile_name(pixels_per_tile, dx, search_lat, <span class="hljs-string">&#x27;N&#x27;</span>, search_lon, <span class="hljs-string">&#x27;E&#x27;</span>)<br>search_file = root_dir + dataset_dir + <span class="hljs-string">&#x27;/&#x27;</span> + search_tile<br><span class="hljs-built_in">print</span>(search_file)<br><br><span class="hljs-comment"># Plot</span><br>tiley = pixels_per_tile<br>tilex = pixels_per_tile<br><br>arr = np.fromfile(search_file, dtype=<span class="hljs-string">&#x27;i1&#x27;</span>)<br>tile_output = np.reshape(arr, (tiley, tilex))<br><br>num_color = <span class="hljs-number">17</span><br><br><span class="hljs-comment"># For landuse</span><br>lst_color =     [<br><span class="hljs-string">&quot;darkgreen&quot;</span>,<br><span class="hljs-string">&quot;lime&quot;</span>,<br><span class="hljs-string">&quot;limegreen&quot;</span>,<br><span class="hljs-string">&quot;lightgreen&quot;</span>,<br><span class="hljs-string">&quot;darkseagreen&quot;</span>,<br><span class="hljs-string">&quot;mediumpurple&quot;</span>,<br><span class="hljs-string">&quot;linen&quot;</span>,<br><span class="hljs-string">&quot;tan&quot;</span>,<br><span class="hljs-string">&quot;wheat&quot;</span>,<br><span class="hljs-string">&quot;darkorange&quot;</span>,<br><span class="hljs-string">&quot;blue&quot;</span>,<br><span class="hljs-string">&quot;yellow&quot;</span>,<br><span class="hljs-string">&quot;red&quot;</span>,<br><span class="hljs-string">&quot;olive&quot;</span>,<br><span class="hljs-string">&quot;white&quot;</span>,<br><span class="hljs-string">&quot;lightsteelblue&quot;</span>,<br><span class="hljs-string">&quot;cyan&quot;</span>,<br><span class="hljs-string">&quot;whitesmoke&quot;</span>,<br><span class="hljs-string">&quot;grey&quot;</span>,<br><span class="hljs-string">&quot;dimgrey&quot;</span><br>    ]<br><br>custom_cmap = ListedColormap(lst_color[:num_color])<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Min, Max = &quot;</span>, np.<span class="hljs-built_in">min</span>(tile_output), np.<span class="hljs-built_in">max</span>(tile_output))<br><br>plt.imshow(tile_output, cmap=custom_cmap, interpolation=<span class="hljs-string">&#x27;nearest&#x27;</span>, origin=<span class="hljs-string">&#x27;lower&#x27;</span>)<br>plt.colorbar()<br>plt.title( dataset_dir )<br>plt.show()<br>plt.close()<br><br><span class="hljs-comment"># Plot multiple tile fies</span><br>search_file<br><br><span class="hljs-comment"># From small y to large y ==&gt; + </span><br><span class="hljs-comment"># From large x to small x ==&gt; -</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">tile_combine</span>(<span class="hljs-params">header, xs, xe, ys, ye, nxy, pixels_per_tile</span>):<br>    <span class="hljs-comment">#</span><br>    <span class="hljs-comment"># Make first one</span><br>    <span class="hljs-comment">#</span><br>    px = <span class="hljs-number">0</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;For x, &quot;</span>, px, pixels_per_tile, pixels_per_tile*px)<br>    tmp = header+<span class="hljs-built_in">str</span>(xs-pixels_per_tile*px)+<span class="hljs-string">&#x27;-&#x27;</span>+<span class="hljs-built_in">str</span>(xe-pixels_per_tile*px)+<span class="hljs-string">&#x27;.&#x27;</span>+<span class="hljs-built_in">str</span>(ys)+<span class="hljs-string">&#x27;-&#x27;</span>+<span class="hljs-built_in">str</span>(ye)<br>    <span class="hljs-built_in">print</span>(tmp)<br>    arr_tmp = np.fromfile(tmp, dtype=<span class="hljs-string">&#x27;i1&#x27;</span>)<br>    combine = np.reshape(arr_tmp, (tiley, tilex))<br><br>    <span class="hljs-keyword">for</span> py <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, nxy):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;   --- For y, &quot;</span>, py, pixels_per_tile, pixels_per_tile*py)<br>        tmp = header+<span class="hljs-built_in">str</span>(xs)+<span class="hljs-string">&#x27;-&#x27;</span>+<span class="hljs-built_in">str</span>(xe)+<span class="hljs-string">&#x27;.&#x27;</span>+<span class="hljs-built_in">str</span>(ys+pixels_per_tile*py)+<span class="hljs-string">&#x27;-&#x27;</span>+<span class="hljs-built_in">str</span>(ye+pixels_per_tile*py)<br>        <span class="hljs-built_in">print</span>(tmp)<br>        arr_tmp = np.fromfile(tmp, dtype=<span class="hljs-string">&#x27;i1&#x27;</span>)<br>        arr_tmp = np.reshape(arr_tmp, (tiley, tilex))<br>        combine = np.concatenate((combine, arr_tmp))   <br>    <br>    <span class="hljs-comment">#</span><br>    <span class="hljs-comment"># Build the rest</span><br>    <span class="hljs-comment">#</span><br>    <span class="hljs-keyword">for</span> px <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, nxy):<br>        <br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;For x, &quot;</span>, px, pixels_per_tile, pixels_per_tile*px)<br>        tmp = header+<span class="hljs-built_in">str</span>(xs-pixels_per_tile*px)+<span class="hljs-string">&#x27;-&#x27;</span>+ \<br>                    <span class="hljs-built_in">str</span>(xe-pixels_per_tile*px)+<span class="hljs-string">&#x27;.&#x27;</span>+ \<br>                    <span class="hljs-built_in">str</span>(ys)+<span class="hljs-string">&#x27;-&#x27;</span>+ \<br>                    <span class="hljs-built_in">str</span>(ye)<br>        <span class="hljs-built_in">print</span>(tmp)<br>        arr_tmp = np.fromfile(tmp, dtype=<span class="hljs-string">&#x27;i1&#x27;</span>)<br>        tmp_combine = np.reshape(arr_tmp, (tiley, tilex))<br><br>        <span class="hljs-keyword">for</span> py <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, nxy):<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;   ---For y, &quot;</span>, py, pixels_per_tile, pixels_per_tile*py)<br>            tmp = header+<span class="hljs-built_in">str</span>(xs-pixels_per_tile*px)+<span class="hljs-string">&#x27;-&#x27;</span>+ \<br>                        <span class="hljs-built_in">str</span>(xe-pixels_per_tile*px)+<span class="hljs-string">&#x27;.&#x27;</span>+ \<br>                        <span class="hljs-built_in">str</span>(ys+pixels_per_tile*py)+<span class="hljs-string">&#x27;-&#x27;</span>+ \<br>                        <span class="hljs-built_in">str</span>(ye+pixels_per_tile*py)<br>            <span class="hljs-built_in">print</span>(tmp)<br>            arr_tmp = np.fromfile(tmp, dtype=<span class="hljs-string">&#x27;i1&#x27;</span>)<br>            arr_tmp = np.reshape(arr_tmp, (tiley, tilex))<br>            tmp_combine = np.concatenate((tmp_combine, arr_tmp))<br>        <br>        <span class="hljs-comment">#</span><br>        combine = np.concatenate((tmp_combine, combine), axis=<span class="hljs-number">1</span>)<br>    <br>    <br>    <span class="hljs-keyword">return</span> combine<br><br>con = tile_combine(<span class="hljs-string">&quot;/dir/data/geog/modis_landuse_20class_30s/&quot;</span>, <span class="hljs-number">352801</span>, <span class="hljs-number">354000</span>, <span class="hljs-number">133201</span>, <span class="hljs-number">134400</span>, <span class="hljs-number">8</span>, pixels_per_tile)<br><br>plt.imshow(con, cmap=custom_cmap, interpolation=<span class="hljs-string">&#x27;nearest&#x27;</span>, origin=<span class="hljs-string">&#x27;lower&#x27;</span>)<br>plt.colorbar()<br>plt.title( dataset_dir )<br>plt.show()<br>plt.close()<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>WRF</category>
      
    </categories>
    
    
    <tags>
      
      <tag>WRF</tag>
      
      <tag>WPS</tag>
      
      <tag>MPAS</tag>
      
      <tag>tile files</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>WRF | WRF-extraction-station</title>
    <link href="/2023/06/24/WRF-extraction-station/"/>
    <url>/2023/06/24/WRF-extraction-station/</url>
    
    <content type="html"><![CDATA[<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">import</span> xarray <span class="hljs-keyword">as</span> xr<br><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<br><span class="hljs-keyword">from</span> netCDF4 <span class="hljs-keyword">import</span> Dataset<br><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt<br><span class="hljs-keyword">from</span> matplotlib.cm <span class="hljs-keyword">import</span> get_cmap<br><br><span class="hljs-keyword">from</span> wrf <span class="hljs-keyword">import</span> (to_np, getvar, smooth2d, get_cartopy, cartopy_xlim,<br>                 cartopy_ylim, latlon_coords, extract_vars, xy_to_ll, ll_to_xy)<br><br><span class="hljs-comment"># How to display full output in Jupyter, not only last result?</span><br><span class="hljs-keyword">from</span> IPython.core.interactiveshell <span class="hljs-keyword">import</span> InteractiveShell<br>InteractiveShell.ast_node_interactivity = <span class="hljs-string">&quot;all&quot;</span><br><br>SMALL_SIZE = <span class="hljs-number">8</span><br>MEDIUM_SIZE = <span class="hljs-number">10</span><br>BIGGER_SIZE = <span class="hljs-number">24</span><br><br>plt.rcParams[<span class="hljs-string">&quot;figure.figsize&quot;</span>] = (<span class="hljs-number">10</span>,<span class="hljs-number">8</span>)<br>plt.rc(<span class="hljs-string">&#x27;font&#x27;</span>, size=BIGGER_SIZE)          <span class="hljs-comment"># controls default text sizes</span><br>plt.rc(<span class="hljs-string">&#x27;axes&#x27;</span>, titlesize=BIGGER_SIZE)     <span class="hljs-comment"># fontsize of the axes title</span><br>plt.rc(<span class="hljs-string">&#x27;axes&#x27;</span>, labelsize=BIGGER_SIZE)    <span class="hljs-comment"># fontsize of the x and y labels</span><br>plt.rc(<span class="hljs-string">&#x27;xtick&#x27;</span>, labelsize=BIGGER_SIZE)    <span class="hljs-comment"># fontsize of the tick labels</span><br>plt.rc(<span class="hljs-string">&#x27;ytick&#x27;</span>, labelsize=BIGGER_SIZE)    <span class="hljs-comment"># fontsize of the tick labels</span><br>plt.rc(<span class="hljs-string">&#x27;legend&#x27;</span>, fontsize=BIGGER_SIZE)    <span class="hljs-comment"># legend fontsize</span><br>plt.rc(<span class="hljs-string">&#x27;figure&#x27;</span>, titlesize=BIGGER_SIZE)  <span class="hljs-comment"># fontsize of the figure title</span><br><br><span class="hljs-comment"># plt.rcParams[&#x27;font.sans-serif&#x27;] = [&#x27;SimHei&#x27;] </span><br><span class="hljs-comment"># plt.rcParams[&#x27;axes.unicode_minus&#x27;] = False</span><br><br>plt.rcParams.update(&#123;<span class="hljs-string">&#x27;font.family&#x27;</span>:<span class="hljs-string">&#x27;sans-serif&#x27;</span>&#125;)<br>plt.rcParams[<span class="hljs-string">&#x27;font.sans-serif&#x27;</span>] = [<span class="hljs-string">&#x27;DejaVu Sans&#x27;</span>]<br><br>rad2deg = <span class="hljs-number">57.2957795</span><br><br><span class="hljs-comment"># # single xy to latlon</span><br><span class="hljs-comment"># lat_lon = xy_to_ll(ncfile_domain_1, 100, 100)</span><br><span class="hljs-comment"># print(lat_lon.values)</span><br><br><span class="hljs-comment"># # single latlon to xy</span><br><span class="hljs-comment"># x_y = ll_to_xy(ncfile_domain_1, 34.62, 105.46)</span><br><span class="hljs-comment"># print(x_y.values)</span><br><br><span class="hljs-comment"># # more points</span><br><span class="hljs-comment"># lat_lon = xy_to_ll(ncfile_domain_1, [100,105], [100,205])</span><br><span class="hljs-comment"># print(lat_lon.values)</span><br><br><span class="hljs-comment"># # more points</span><br><span class="hljs-comment"># x_y = ll_to_xy(ncfile_domain_1, [34.62, 35], [105.46, 100])</span><br><span class="hljs-comment"># print(x_y.values)</span><br><br><span class="hljs-comment"># get met stations</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_station_info</span>(<span class="hljs-params">statfile</span>):<br>    stats = pd.read_csv(statfile, sep=<span class="hljs-string">&#x27;,&#x27;</span>)<br>    stats = stats[[<span class="hljs-string">&#x27;WMO_id&#x27;</span>,<span class="hljs-string">&#x27;lat&#x27;</span>,<span class="hljs-string">&#x27;lon&#x27;</span>]]<br>    stats = stats.dropna(axis=<span class="hljs-number">0</span>)<br>    stats = stats.astype(&#123;<span class="hljs-string">&#x27;WMO_id&#x27;</span>:<span class="hljs-built_in">int</span>&#125;)<br>    <span class="hljs-keyword">return</span> (stats)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">read_model_data</span>(<span class="hljs-params">domloc, wrfdir, dom, statf, sdate, edate, utc</span>):<br>    <span class="hljs-keyword">import</span> glob<br>    <span class="hljs-keyword">from</span> netCDF4 <span class="hljs-keyword">import</span> Dataset<br>    wrfoutfiles = <span class="hljs-built_in">sorted</span>(glob.glob(<span class="hljs-string">&#x27;&#123;0&#125;/wrfout_&#123;1&#125;_*&#x27;</span>.<span class="hljs-built_in">format</span>(wrfdir,dom)))<br>    wrflist = [ Dataset(f) <span class="hljs-keyword">for</span> f <span class="hljs-keyword">in</span> wrfoutfiles ]<br>    <span class="hljs-keyword">from</span> wrf <span class="hljs-keyword">import</span> getvar, ALL_TIMES, interplevel, extract_times, to_np, ll_to_xy, extract_times<br>    wrftimes = extract_times(wrflist, timeidx=ALL_TIMES, method=<span class="hljs-string">&#x27;cat&#x27;</span>)<br><br>    <span class="hljs-comment"># get start and end index</span><br>    times = [ <span class="hljs-built_in">str</span>(s).split(<span class="hljs-string">&#x27;:&#x27;</span>)[<span class="hljs-number">0</span>] <span class="hljs-keyword">for</span> s <span class="hljs-keyword">in</span> wrftimes ]<br>    <span class="hljs-built_in">print</span>(times)<br>    sdate = (datetime.strptime(sdate,<span class="hljs-string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>)+timedelta(hours=-utc)).strftime(<span class="hljs-string">&#x27;%Y-%m-%dT%H&#x27;</span>) <br>    edate = (datetime.strptime(edate,<span class="hljs-string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>)+timedelta(hours=-utc)).strftime(<span class="hljs-string">&#x27;%Y-%m-%dT%H&#x27;</span>)<br>    st = times.index(sdate)<br>    et = times.index(edate) + <span class="hljs-number">1</span><br>    <span class="hljs-built_in">print</span> (<span class="hljs-string">&#x27;&#123;0&#125;: &#123;1&#125; - &#123;2&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(domloc, st, et))<br><br>    stats = get_station_info(statf)<br>    stats[<span class="hljs-string">&#x27;ij&#x27;</span>] = stats.apply(<span class="hljs-keyword">lambda</span> row: np.array(ll_to_xy(wrflist[<span class="hljs-number">0</span>], row.lat, row.lon).values), axis=<span class="hljs-number">1</span>)<br>    stats[<span class="hljs-string">&#x27;i&#x27;</span>] = stats.apply(<span class="hljs-keyword">lambda</span> row: row.ij[<span class="hljs-number">0</span>], axis=<span class="hljs-number">1</span>)<br>    stats[<span class="hljs-string">&#x27;j&#x27;</span>] = stats.apply(<span class="hljs-keyword">lambda</span> row: row.ij[<span class="hljs-number">1</span>], axis=<span class="hljs-number">1</span>)<br><br>    varlist = [<span class="hljs-string">&quot;T2&quot;</span>,<span class="hljs-string">&quot;Q2&quot;</span>, <span class="hljs-string">&quot;U10&quot;</span>,<span class="hljs-string">&quot;V10&quot;</span>]<br>    df = pd.DataFrame()<br>    <span class="hljs-keyword">for</span> varname <span class="hljs-keyword">in</span> varlist:<br>        <span class="hljs-keyword">for</span> tt <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(st,et):<br>            stats[<span class="hljs-string">&#x27;varname&#x27;</span>] = varname<br>            var = getvar(wrflist, varname, timeidx=tt, method=<span class="hljs-string">&quot;cat&quot;</span>)<br>            <span class="hljs-keyword">if</span> varname == <span class="hljs-string">&#x27;T2&#x27;</span>:<br>                var = var - <span class="hljs-number">273.15</span><br>            stats[<span class="hljs-string">&#x27;datetime&#x27;</span>] = var.coords[<span class="hljs-string">&#x27;Time&#x27;</span>].values<br>            stats[<span class="hljs-string">&#x27;value&#x27;</span>] = stats.apply(<span class="hljs-keyword">lambda</span> row: to_np(var[row.i, row.j]), axis=<span class="hljs-number">1</span>)<br>            df =df.append(stats[[<span class="hljs-string">&#x27;datetime&#x27;</span>,<span class="hljs-string">&#x27;WMO_id&#x27;</span>,<span class="hljs-string">&#x27;varname&#x27;</span>,<span class="hljs-string">&#x27;value&#x27;</span>]])<br>    df[<span class="hljs-string">&#x27;datetime&#x27;</span>] = df.apply(<span class="hljs-keyword">lambda</span> row: (datetime.strptime(<span class="hljs-built_in">str</span>(row.datetime),<span class="hljs-string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>)+timedelta(hours=utc)).strftime(<span class="hljs-string">&quot;%Y-%m-%d %H:%M:%S&quot;</span>), axis=<span class="hljs-number">1</span>)<br>    df[<span class="hljs-string">&#x27;model&#x27;</span>] = domloc<br>    <span class="hljs-comment">#df[&#x27;WSPD10&#x27;] = df.apply(lambda row: math.sqrt(row.U10 ** 2 + row.V10 ** 2))</span><br>    <span class="hljs-comment">#df[&#x27;WDIR10&#x27;] = df.apply(lambda row: 180+(360/(2/3.1415926)*math.atan2(row.U10,row.V10)))</span><br>    <span class="hljs-comment">#df = df[]</span><br>    <span class="hljs-keyword">return</span> (df)<br><br>station = get_station_info(<span class="hljs-string">&quot;./station.txt&quot;</span>)<br>station<br><br><span class="hljs-comment"># WMO_idlatlon</span><br><span class="hljs-comment"># 0122.312114.173</span><br><span class="hljs-comment"># 1233.000105.000</span><br><br>domloc = <span class="hljs-string">&quot;ucm&quot;</span><br>wrfdir = <span class="hljs-string">&quot;/xxx/wrf/&quot;</span><br>dom = <span class="hljs-string">&quot;d02&quot;</span><br>statf = <span class="hljs-string">&quot;./station.txt&quot;</span><br>sdate = <span class="hljs-string">&quot;2023-03-31 21:00:00&quot;</span><br>edate = <span class="hljs-string">&quot;2023-04-01 03:00:00&quot;</span><br>utc = <span class="hljs-number">0</span> <span class="hljs-comment"># 8</span><br><br>df = read_model_data(domloc, wrfdir, dom, statf, sdate, edate, utc)<br>df<br><br>select_var = df[(df[<span class="hljs-string">&quot;varname&quot;</span>] == <span class="hljs-string">&quot;T2&quot;</span>) &amp; (df[<span class="hljs-string">&quot;WMO_id&quot;</span>] == <span class="hljs-number">1</span>)]<br>select_var<br><br>plt.plot(pd.to_datetime(select_var.datetime), select_var.value, <span class="hljs-string">&#x27;ro--&#x27;</span>)<br>plt.title(<span class="hljs-string">&quot;T2m&quot;</span>)<br>plt.ylabel(<span class="hljs-string">&quot;T2m (deg C)&quot;</span>)<br>plt.xlabel(<span class="hljs-string">&quot;Time (UTC)&quot;</span>)<br>plt.legend()<br><span class="hljs-comment"># plt.axhline(y=0.0, color=&#x27;k&#x27;, linestyle=&#x27;-&#x27;)</span><br>plt.xticks(rotation=<span class="hljs-number">45</span>)<br>plt.grid()<br>plt.show()<br>plt.close()<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>WRF</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NWP</tag>
      
      <tag>Jupyter</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>netCDF operator (nco, cdo)</title>
    <link href="/2023/06/24/cdo/"/>
    <url>/2023/06/24/cdo/</url>
    
    <content type="html"><![CDATA[<h2 id="ncrename---netcdf-renamer">ncrename - netCDF Renamer</h2><p>Options &gt; -a old_name, new_name Attribute renaming. The old and new names of the attribute are specified by the associated old_name and new_name values. Global attributes are treated no differently than variable attributes. This option may be specified more than once. You cannot change the attribute name for one particular variable (unless it is uniquely named); all occurrences of the attribute of a given name will be renamed. This is considered an oversight and will be addressed in a future version of NCO. -d old_name, new_name Dimension renaming. The old and new names of the dimension are specified by the associated old_name and new_name values. This option may be specified more than once. -v old_name, new_name Variable renaming. The old and new names of the variable are specified by the associated old_name and new_name values. This option may be specified more than once. -i &gt;Interactive. ncrename will prompt for confirmation before overwriting an existing file.</p><p>Examples Rename the variable p to pressure and t to temperature in netCDF in.nc. In this case p must exist in the input file (or ncrename will abort), but the presence of t is optional: <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ ncrename -v p,pressure -v .t,temperature in.nc<br></code></pre></td></tr></table></figure> ncrename does not automatically attach dimensions to variables of the same name. If you want to rename a coordinate variable so that it remains a coordinate variable, you must separately rename both the dimension and the variable: <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ ncrename -d lon,longitude -v lon,longitude in.nc<br></code></pre></td></tr></table></figure></p><h2 id="ncrcat---netcdf-record-concatenator">ncrcat - netCDF Record Concatenator</h2><p>ncrcat concatenates record variables across an arbitrary number of input files. The final record dimension is by default the sum of the lengths of the record dimensions in the input files. <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ ncrcat -O <span class="hljs-string">&quot;diag*.nc&quot;</span> <span class="hljs-variable">$&#123;path_out&#125;</span><br>$ ncrcat 85.nc 86.nc 87.nc 88.nc 89.nc 8589.nc<br>$ ncrcat 8[56789].nc 8589.nc<br></code></pre></td></tr></table></figure> <a href="https://disc.gsfc.nasa.gov/information/howto?title=How%20to%20Concatenate%20the%20Time%20Dimension%20of%20netCDF%20Files%20with%20NCO">How to Concatenate the Time Dimension of netCDF Files with NCO</a></p><h2 id="appending-variables">Appending variables</h2><p>This puts the contents yyy of bbb.nc into aaa.nc. <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ ncks -A -v yyy bbb.nc aaa.nc<br></code></pre></td></tr></table></figure></p><h2 id="ncdiff---netcdf-differencer">ncdiff - netCDF Differencer</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ ncdiff 86_0112.nc 85_0112.nc diff.nc<br></code></pre></td></tr></table></figure><h2 id="cdo-sub">cdo sub</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ cdo sub v1.nc v2.nc diff.nc<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>NWP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>WRF</tag>
      
      <tag>MPAS</tag>
      
      <tag>netcdf</tag>
      
      <tag>nco</tag>
      
      <tag>cdo</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Approximate Metric Equivalents for Degrees, Minutes, and Seconds</title>
    <link href="/2023/06/24/degree-to-meter/"/>
    <url>/2023/06/24/degree-to-meter/</url>
    
    <content type="html"><![CDATA[<h1 id="approximate-metric-equivalents-for-degrees-minutes-and-seconds">Approximate Metric Equivalents for Degrees, Minutes, and Seconds</h1><p>At the equator for longitude and for latitude anywhere, the following approximations are valid:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs sh">1Â° = 111 km  (or 60 nautical miles)<br>0.1Â° = 11.1 km<br>0.01Â° = 1.11 km (2 decimals, km accuracy)<br>0.001Â° =111 m<br>0.0001Â° = 11.1 m<br>0.00001Â° = 1.11 m<br>0.000001Â° = 0.11 m (7 decimals, cm accuracy)<br><br>1<span class="hljs-string">&#x27; = 1.85 km  (or 1 nautical mile)</span><br><span class="hljs-string">0.1&#x27;</span> = 185 m<br>0.01<span class="hljs-string">&#x27; = 18.5 m</span><br><span class="hljs-string">0.001&#x27;</span> = 1.85 m<br><br>30<span class="hljs-string">&quot; = 900 m</span><br><span class="hljs-string">15&quot;</span> = 450 m<br>3<span class="hljs-string">&quot; = 90 m</span><br><span class="hljs-string">1&quot;</span> = 30 m<br>1/3<span class="hljs-string">&quot; = 10 m</span><br><span class="hljs-string">0.1&quot;</span> = 3 m<br>1/9<span class="hljs-string">&quot; = 3 m</span><br><span class="hljs-string">1/27&quot;</span> = 1 m<br></code></pre></td></tr></table></figure><p>If you report a position to the nearest 0.01Â° (two decimal places for latitude and longitude), you will only be accurate to around 1 km. While this is adequate for rough locations on a global scale, for detailed work it will be inadequate.</p><h1 id="latitude-and-longitude">Latitude and longitude</h1><p>Lines of latitude and longitude form the grid system used on globes, maps and charts. Latitude is a measure of how far north or south somewhere is from the Equator; longitude is a measure of how far east or west it is from the Prime Meridian. Whilst lines (or parallels) of latitude all run parallel to the Equator, lines (or meridians) of longitude all converge at the Earthâ€™s North and South Poles. The northâ€“south line passing through any particular point on the Earthâ€™s surface is known as the â€œlocal meridianâ€.</p><p>Although the Equator is the obvious zero point from which to measure latitude, there is no equivalent point from which to measure longitude. In 1884, an international conference decided that the Greenwich Meridian, as defined by the Airy Transit Circle at the Royal Observatory, Greenwich, should be adopted as the Prime or Zero Meridian for the World.</p><p>Latitude and longitude are both measured in degrees. <strong>Each degree (Â°) is subdivided into 60 minutes (') and each minute into 60 seconds (")</strong>. Each degree of latitude corresponds to a distance on the Earthâ€˜s surface of about 111 km. Each degree of longitude however, corresponds to a distance that varies with latitude. The distance is about 111 km at the Equator, reducing to 0 km at the Poles.</p><h1 id="the-prime-meridian">The prime meridian</h1><p>The prime meridian forms the reference point by which longitudes are defined and expressed. This line makes it possible to measure the position of a location on Earth based on the longitude.</p><p>On Earth, the prime meridian -- which, like all other latitude and longitude lines, is also imaginary -- passes through Greenwich, England. For this reason, it also called the Greenwich meridian. Thus, the prime meridian is the imaginary north-south line that passes through the north and south poles, as well as Greenwich. It has a longitude of 0 degrees. The antemeridian, which is the opposite of the prime meridian, is located on the other side of the Earth and has a longitude of 180 degrees.</p><p>Longitudes and the prime meridian are both used to define time zones. <strong>Greenwich Mean Time (GMT)</strong>, also known as Coordinated Universal Time, is the standard time by which all other time zones are expressed -- for example:</p><p>GMT + 0 = Time in Greenwich, U.K. GMT + 8 = China Standard Time GMT - 8 = Pacific Standard Time</p><h1 id="coordinated-universal-time-or-utc">Coordinated Universal Time or UTC</h1><p>Coordinated Universal Time or UTC is the primary time standard by which the world regulates clocks and time. It is within about one second of mean solar time (such as UT1) at 0Â° longitude (at the IERS Reference Meridian as the currently used prime meridian) and is not adjusted for daylight saving time. It is effectively a successor to Greenwich Mean Time (GMT).</p><p>ä¸–ç•Œå”èª¿æ™‚é–“æ˜¯ä¸–ç•Œä¸Šèª¿ç¯€æ™‚é˜å’Œæ™‚é–“çš„ä¸»è¦æ™‚é–“æ¨™æº–ï¼Œå®ƒèˆ‡0åº¦ç¶“ç·šçš„å¹³å¤ªé™½æ™‚ç›¸å·®ä¸è¶…é1ç§’ï¼Œä¸¦ä¸éµå®ˆå¤ä»¤æ™‚ã€‚ä¸–ç•Œå”èª¿æ™‚é–“æ˜¯æœ€æ¥è¿‘æ ¼æ—å¨æ²»æ¨™æº–æ™‚é–“ï¼ˆGMTï¼‰çš„å¹¾å€‹æ›¿ä»£æ™‚é–“ç³»çµ±ä¹‹ä¸€ã€‚å°æ–¼å¤§å¤šæ•¸ç”¨é€”ä¾†èªªï¼ŒUTCæ™‚é–“è¢«èªç‚ºèƒ½èˆ‡GMTæ™‚é–“äº’æ›ï¼Œä½†GMTæ™‚é–“å·²ä¸å†è¢«ç§‘å­¸ç•Œæ‰€ç¢ºå®šã€‚</p>]]></content>
    
    
    <categories>
      
      <category>NWP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>WRF</tag>
      
      <tag>MPAS</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>NetCDF and its Conversion</title>
    <link href="/2023/06/24/netcdf/"/>
    <url>/2023/06/24/netcdf/</url>
    
    <content type="html"><![CDATA[<p><a href="https://www.unidata.ucar.edu/software/netcdf/">NetCDF</a> (Network Common Data Form) is a set of software libraries and machine-independent data formats that support the creation, access, and sharing of array-oriented scientific data. It is also a community standard for sharing scientific data. The Unidata Program Center supports and maintains netCDF programming interfaces for C, C++, Java, and Fortran. Programming interfaces are also available for Python, IDL, MATLAB, R, Ruby, and Perl.</p><p>ç¶²çµ¡é€šç”¨æ•¸æ“šæ ¼å¼ï¼ˆè‹±èªï¼šNetwork Common Data Formï¼ŒNetCDFï¼‰æ˜¯ä¸€ç¨®è‡ªæè¿°ã€èˆ‡æ©Ÿå™¨ç„¡é—œã€åŸºæ–¼é™£åˆ—çš„ç§‘å­¸æ•¸æ“šæ ¼å¼ï¼ŒåŒæ™‚ä¹Ÿæ˜¯æ”¯æ´å»ºç«‹ã€å­˜å–å’Œå…±ç”¨é€™ä¸€æ•¸æ“šæ ¼å¼çš„å‡½æ•¸åº«ã€‚è©²å°ˆæ¡ˆé¦–é ä½æ–¼ç¾åœ‹å¤§æ°£ç§‘å­¸ç ”ç©¶å¤§å­¸è¯ç›Ÿï¼ˆUCARï¼‰çš„Unidataè¦åŠƒç¶²ç«™ã€‚å®ƒä¹Ÿæ˜¯netCDFè»Ÿä»¶ã€æ¨™æº–é–‹ç™¼ã€æ›´æ–°ç­‰çš„ä¸»è¦ä¾†æºã€‚NetCDFæ ¼å¼æ˜¯ä¸€ç¨®é–‹æ”¾æ¨™æº–ã€‚NetCDFçš„ç¶“å…¸æ ¼å¼å’Œ64ä½å…ƒåç§»é‡æ ¼å¼æ˜¯é–‹æ”¾åœ°ç†ç©ºé–“å”æœƒæ¡ç”¨çš„åœ‹éš›æ¨™æº–ã€‚è©²å°ˆæ¡ˆé–‹å§‹æ–¼1989å¹´ï¼ŒUCARç›®å‰å°å…¶ç©æ¥µæ”¯æ´ï¼Œåœ¨æ–°ç™¼è¡Œç‰ˆä¸­æ”¹é€²æ•ˆèƒ½ã€å¢åŠ åŠŸèƒ½ä¸¦ä¿®æ­£ç¼ºé™·ï¼Œç›®å‰ç‰ˆæœ¬ç³»åˆ—æ˜¯netCDF-4ï¼Œåœ¨ç·¨è­¯æ™‚ä¹Ÿå¯ä»¥é¸æ“‡åªå»ºé€ netCDF-3åº«ã€‚</p><h2 id="file-formats-and-conversion">File Formats and Conversion</h2><p><a href="https://nco.sourceforge.net/nco.html#fl_fmt">link</a> &gt; Availability: ncap2, nces, ncecat, ncflint, ncks, ncpdq, ncra, ncrcat, ncwa &gt; Short options: â€˜-3â€™, â€˜-4â€™, â€˜-5â€™, â€˜-6â€™, â€˜-7â€™ &gt; Long options: â€˜--3â€™, â€˜--4â€™, â€˜--5â€™, â€˜--6â€™, â€˜--64bit_offsetâ€™, â€˜--7â€™, â€˜--fl_fmtâ€™, â€˜--netcdf4â€™</p><p>All NCO operators support (read and write) all three (or four, depending on how one counts) file formats supported by netCDF4. The default output file format for all operators is the input file format. The operators listed under â€œAvailabilityâ€ above allow the user to specify the output file format independent of the input file format. These operators allow the user to convert between the various file formats. (The operators ncatted and ncrename do not support these switches so they always write the output netCDF file in the same format as the input netCDF file.)</p><h3 id="file-formats">File Formats</h3><p>netCDF supports five types of files: <strong>CLASSIC, 64BIT_OFFSET, 64BIT_DATA, NETCDF4, and NETCDF4_CLASSIC</strong>. The CLASSIC (aka CDF1) format is the traditional 32-bit offset written by netCDF2 and netCDF3. As of 2005, nearly all netCDF datasets were in CLASSIC format. The 64BIT_OFFSET (originally called plain old 64BIT) (aka CDF2) format was added in Fall, 2004. As of 2010, many netCDF datasets were in 64BIT_OFFSET format. As of 2013, an increasing number of netCDF datasets were in NETCDF4_CLASSIC format. The 64BIT_DATA (aka CDF5 or PNETCDF) format was added to netCDF in January, 2016 and immediately supported by NCO. Support for Zarr and NCZarr backend storage formats was added to netCDF in 2021 and supported by NCO in 2022.</p><p>The NETCDF4 format uses HDF5 as the file storage layer. The files are (usually) created, accessed, and manipulated using the traditional netCDF3 API (with numerous extensions). The NETCDF4_CLASSIC format refers to netCDF4 files created with the NC_CLASSIC_MODEL mask. Such files use HDF5 as the back-end storage format (unlike netCDF3), though they incorporate only netCDF3 features. Hence NETCDF4_CLASSIC files are entirely readable by applications that use only the netCDF3 API (though the applications must be linked with the netCDF4 library). NCO must be built with netCDF4 to write files in the new NETCDF4 and NETCDF4_CLASSIC formats, and to read files in these formats. Datasets in the default CLASSIC or the newer 64BIT_OFFSET formats have maximum backwards-compatibility with older applications. NCO has deep support for NETCDF4 formats. If backwards compatibility is important, and your datasets are too large for netCDF3, use NETCDF4_CLASSIC instead of CLASSIC format files. NCO support for the NETCDF4 format is complete and many high-performance disk/RAM efficient workflows utilize this format.</p><p>As mentioned above, all operators write use the input file format for output files unless told otherwise. Toggling the short option â€˜-6â€™ or the long option â€˜--6â€™ or â€˜--64bit_offsetâ€™ (or their key-value equivalent â€˜--fl_fmt=64bit_offsetâ€™) produces the netCDF3 64-bit offset format named 64BIT_OFFSET. NCO must be built with netCDF 3.6 or higher to produce a 64BIT_OFFSET file. As of NCO version 4.6.9 (September, 2017), toggling the short option â€˜-5â€™ or the long options â€˜--5â€™, â€˜--64bit_dataâ€™, â€˜--cdf5â€™, or â€˜--pnetcdfâ€™ (or their key-value equivalent â€˜--fl_fmt=64bit_dataâ€™) produces the netCDF3 64-bit data format named 64BIT_DATA. This format is widely used by MPI-enabled modeling codes because of its long association with PnetCDF. NCO must be built with netCDF 4.4 or higher to produce a 64BIT_DATA file.</p><p>Using the â€˜-4â€™ switch (or its long option equivalents â€˜--4â€™ or â€˜--netcdf4â€™), or setting its key-value equivalent â€˜--fl_fmt=netcdf4â€™ produces a NETCDF4 file (i.e., with all supported HDF5 features). Using the â€˜-7â€™ switch (or its long option equivalent â€˜--7â€™ 30, or setting its key-value equivalent â€˜--fl_fmt=netcdf4_classicâ€™ produces a NETCDF4_CLASSIC file (i.e., with all supported HDF5 features like compression and chunking but without groups or new atomic types). Operators given the â€˜-3â€™ (or â€˜--3â€™) switch without arguments will (attempt to) produce netCDF3 CLASSIC output, even from netCDF4 input files.</p><p>Note that NETCDF4 and NETCDF4_CLASSIC are the same binary format. The latter simply causes a writing application to fail if it attempts to write a NETCDF4 file that cannot be completely read by the netCDF3 library. Conversely, NETCDF4_CLASSIC indicates to a reading application that all of the file contents are readable with the netCDF3 library. NCO has supported reading/writing basic NETCDF4 and NETCDF4_CLASSIC files since October, 2005.</p><h3 id="determining-file-format">Determining File Format</h3><p>First, examine the first line of global metadata output by <strong>ncks -M</strong>: <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ ncks -M foo_3.nc<br>Summary of foo_3.nc: filetype = NC_FORMAT_CLASSIC, 0 <span class="hljs-built_in">groups</span> ...<br></code></pre></td></tr></table></figure> ncks will also print the extended or underlying format of the input file <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ ncks -D 2 -M foo_4.nc<br></code></pre></td></tr></table></figure> Second, query the file with â€˜ncdump -kâ€™: <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ ncdump -k foo_3.nc<br>classic/netCDF-4/cdf5/...<br></code></pre></td></tr></table></figure></p><h3 id="file-conversion">File Conversion</h3><p>Let us demonstrate converting a file from any netCDF-supported input format into any netCDF output format (subject to limits of the output format). Here the <strong>input file in.nc</strong> may be in any of these formats: netCDF3 (classic, 64bit_offset, 64bit_data), netCDF4 (classic and extended), HDF4, HDF5, HDF-EOS (version 2 or 5), and DAP. The switch determines the output format written in the comment:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs sh">ncks --fl_fmt=classic in.nc foo_3.nc <span class="hljs-comment"># netCDF3 classic</span><br>ncks --fl_fmt=64bit_offset in.nc foo_6.nc <span class="hljs-comment"># netCDF3 64bit-offset</span><br>ncks --fl_fmt=64bit_data in.nc foo_5.nc <span class="hljs-comment"># netCDF3 64bit-data</span><br>ncks --fl_fmt=cdf5 in.nc foo_5.nc <span class="hljs-comment"># netCDF3 64bit-data</span><br>ncks --fl_fmt=netcdf4_classic in.nc foo_7.nc <span class="hljs-comment"># netCDF4 classic</span><br>ncks --fl_fmt=netcdf4 in.nc foo_4.nc <span class="hljs-comment"># netCDF4 </span><br>ncks -3 in.nc foo_3.nc <span class="hljs-comment"># netCDF3 classic</span><br>ncks --3 in.nc foo_3.nc <span class="hljs-comment"># netCDF3 classic</span><br>ncks -6 in.nc foo_6.nc <span class="hljs-comment"># netCDF3 64bit-offset</span><br>ncks --64 in.nc foo_6.nc <span class="hljs-comment"># netCDF3 64bit-offset</span><br>ncks -5 in.nc foo_5.nc <span class="hljs-comment"># netCDF3 64bit-data</span><br>ncks --5 in.nc foo_5.nc <span class="hljs-comment"># netCDF3 64bit-data</span><br>ncks -4 in.nc foo_4.nc <span class="hljs-comment"># netCDF4 </span><br>ncks --4 in.nc foo_4.nc <span class="hljs-comment"># netCDF4 </span><br>ncks -7 in.nc foo_7.nc <span class="hljs-comment"># netCDF4 classic</span><br>ncks --7 in.nc foo_7.nc <span class="hljs-comment"># netCDF4 classic</span><br></code></pre></td></tr></table></figure><p>Of course since most operators support these switches, the â€œconversionsâ€ can be done at the output stage of arithmetic or metadata processing rather than requiring a separate step. Producing (netCDF3) CLASSIC or 64BIT_OFFSET or 64BIT_DATA files from NETCDF4_CLASSIC files always works.</p>]]></content>
    
    
    <categories>
      
      <category>NWP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>WRF</tag>
      
      <tag>MPAS</tag>
      
      <tag>netcdf</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>rsync - Transferring and synchronizing files</title>
    <link href="/2023/06/24/rsync-Transferring-and-synchronizing-files/"/>
    <url>/2023/06/24/rsync-Transferring-and-synchronizing-files/</url>
    
    <content type="html"><![CDATA[<p>rsyncæ˜¯Unixä¸‹çš„ä¸€æ¬¾å¥—ç”¨è»Ÿä»¶ï¼Œå®ƒèƒ½åŒæ­¥æ›´æ–°å…©è™•é›»è…¦çš„æª”æ¡ˆèˆ‡ç›®éŒ„ï¼Œä¸¦é©ç•¶åˆ©ç”¨å·®åˆ†ç·¨ç¢¼ä»¥æ¸›å°‘æ•¸æ“šå‚³è¼¸é‡ã€‚rsyncä¸­çš„ä¸€é …åŒé¡è»Ÿä»¶ä¸å¸¸è¦‹çš„é‡è¦ç‰¹æ€§æ˜¯æ¯å€‹ç›®æ¨™çš„é¡åƒåªéœ€å‚³é€ä¸€æ¬¡ã€‚rsyncå¯ä»¥æ‹·è²ï¼é¡¯ç¤ºç›®éŒ„å…§å®¹ï¼Œä»¥åŠæ‹·è²æª”æ¡ˆï¼Œä¸¦å¯é¸å£“ç¸®ä»¥åŠéæ­¸æ‹·è²ã€‚</p><p>åœ¨å¸¸é§æ¨¡å¼ï¼ˆdaemon modeï¼‰ä¸‹ï¼Œrsyncé è¨­ç›£è½TCPåŸ 873ï¼Œä»¥åŸç”Ÿrsyncå‚³è¼¸å”å®šæˆ–è€…é€éé ç«¯shellå¦‚RSHæˆ–è€…SSHæä¾›æª”æ¡ˆã€‚SSHæ¨¡å¼ä¸‹ï¼Œrsyncç”¨æˆ¶ç«¯åŸ·è¡Œç¨‹å¼å¿…é ˆåŒæ™‚åœ¨æœ¬æ©Ÿå’Œé ç«¯æ©Ÿå™¨ä¸Šå®‰è£ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sh">rsync çš„åŸºæœ¬èªæ³•çµæ§‹å¦‚ä¸‹ï¼š<br><br>rsync åƒæ•¸ ä¾†æºæª”æ¡ˆ ç›®çš„æª”æ¡ˆ<br>ä»¥ä¸‹æ˜¯æœ€å¸¸è¦‹çš„å¹¾å€‹åƒæ•¸ï¼š<br><br>-vï¼šverbose æ¨¡å¼ï¼Œè¼¸å‡ºæ¯”è¼ƒè©³ç´°çš„è¨Šæ¯ã€‚<br>-rï¼šéè¿´ï¼ˆrecursiveï¼‰å‚™ä»½æ‰€æœ‰å­ç›®éŒ„ä¸‹çš„ç›®éŒ„èˆ‡æª”æ¡ˆã€‚<br>-aï¼šå°è£å‚™ä»½æ¨¡å¼ï¼Œç›¸ç•¶æ–¼ -rlptgoDï¼Œéè¿´å‚™ä»½æ‰€æœ‰å­ç›®éŒ„ä¸‹çš„ç›®éŒ„èˆ‡æª”æ¡ˆï¼Œä¿ç•™é€£çµæª”ã€æª”æ¡ˆçš„æ“æœ‰è€…ã€ç¾¤çµ„ã€æ¬Šé™ä»¥åŠæ™‚é–“æˆ³è¨˜ã€‚<br>-zï¼šå•Ÿç”¨å£“ç¸®ã€‚<br>-hï¼šå°‡æ•¸å­—ä»¥æ¯”è¼ƒå®¹æ˜“é–±è®€çš„æ ¼å¼è¼¸å‡ºã€‚<br></code></pre></td></tr></table></figure><ol type="1"><li>å¦‚æœè¦è®“ rsync åœ¨å‚³è¼¸æª”æ¡ˆæ™‚å¯ä»¥å³æ™‚é¡¯ç¤ºé€²åº¦ï¼Œå¯ä»¥åŠ ä¸Š --progress åƒæ•¸</li><li>-På‚æ•°æ˜¯--progresså’Œ--partialè¿™ä¸¤ä¸ªå‚æ•°çš„ç»“åˆ</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/bash</span><br><span class="hljs-comment">#Here&#x27;s how this script works:</span><br><br><span class="hljs-comment"># Replace the REMOTE_HOST, REMOTE_PATH, and LOCAL_PATH variables with your actual remote host details, remote file path, and local directory path, respectively.</span><br><span class="hljs-comment"># The LOCK_FILE variable specifies the path to the lock file, which will be used to prevent multiple instances of the script from running simultaneously.</span><br><span class="hljs-comment"># The is_locked function checks if the lock file exists.</span><br><span class="hljs-comment"># The create_lock function creates the lock file.</span><br><span class="hljs-comment"># The remove_lock function removes the lock file.</span><br><span class="hljs-comment"># The perform_rsync function performs the actual rsync -z command to copy the files from the remote machine to the local machine.</span><br><span class="hljs-comment"># The script checks if the lock file exists. If it does, it means the previous rsync is still running, so it exits without starting a new rsync.</span><br><span class="hljs-comment"># If the lock file doesn&#x27;t exist, the script creates the lock file, performs the rsync, and then removes the lock file.</span><br><br>INIT_DIR=<span class="hljs-variable">$1</span><br><br>REMOTE_HOST=<span class="hljs-string">&quot;user@ip&quot;</span><br>PORT=<span class="hljs-string">&quot;1234567&quot;</span><br>REMOTE_PATH=<span class="hljs-string">&quot;/home/user/<span class="hljs-variable">$&#123;INIT_DIR&#125;</span>/file.*&quot;</span> <br>LOCAL_PATH=<span class="hljs-string">&quot;/home/user/<span class="hljs-variable">$&#123;INIT_DIR&#125;</span>/&quot;</span> <br>LOCK_FILE=<span class="hljs-string">&quot;<span class="hljs-variable">$&#123;LOCAL_PATH&#125;</span>/rsync.lock&quot;</span> <br>LOG_FILE=<span class="hljs-string">&quot;<span class="hljs-variable">$&#123;LOCAL_PATH&#125;</span>/rsync.log&quot;</span><br><span class="hljs-comment"># Function to check if the lock file exists</span><br><span class="hljs-function"><span class="hljs-title">is_locked</span></span>() &#123;<br>    [ -f <span class="hljs-string">&quot;<span class="hljs-variable">$LOCK_FILE</span>&quot;</span> ]<br>&#125;<br><br><span class="hljs-comment"># Create the lock file</span><br><span class="hljs-function"><span class="hljs-title">create_lock</span></span>() &#123;<br>    <span class="hljs-built_in">touch</span> <span class="hljs-string">&quot;<span class="hljs-variable">$LOCK_FILE</span>&quot;</span><br>&#125;<br><br><span class="hljs-comment"># Remove the lock file</span><br><span class="hljs-function"><span class="hljs-title">remove_lock</span></span>() &#123;<br>    <span class="hljs-built_in">rm</span> <span class="hljs-string">&quot;<span class="hljs-variable">$LOCK_FILE</span>&quot;</span><br>&#125;<br><br><span class="hljs-comment"># Function to perform rsync</span><br><span class="hljs-function"><span class="hljs-title">perform_rsync</span></span>() &#123;<br>    rsync -azvhP -e <span class="hljs-string">&#x27;ssh -p &#x27;</span> <span class="hljs-string">&quot;<span class="hljs-variable">$PORT</span>&quot;</span> <span class="hljs-string">&quot;<span class="hljs-variable">$REMOTE_HOST</span>:<span class="hljs-variable">$REMOTE_PATH</span>&quot;</span> <span class="hljs-string">&quot;<span class="hljs-variable">$LOCAL_PATH</span>&quot;</span> --log-file=<span class="hljs-variable">$&#123;LOG_FILE&#125;</span><br>&#125;<br><br><span class="hljs-comment"># Check if the lock file exists</span><br><span class="hljs-keyword">if</span> is_locked; <span class="hljs-keyword">then</span><br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Previous rsync is still running. Exiting.&quot;</span><br>    <span class="hljs-built_in">exit</span> 1<br><span class="hljs-keyword">fi</span><br><br><span class="hljs-comment"># Create the lock file</span><br>create_lock<br><br><span class="hljs-comment"># Perform rsync</span><br>perform_rsync<br><br><span class="hljs-comment"># Remove the lock file</span><br>remove_lock<br></code></pre></td></tr></table></figure><p>This can be submitted as cron job and automatically downloads new files generated (e.g. every hour). It checks whether the previous rsync job is done before rsync-ing again, otherwise waits for another time interval defined in the crontab (it generates a 'lock' file when starting a rsync and deleting it afterwards. If the 'lock' file is present it will not run rsync)</p>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>download</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Bash | datetime (manipulate)</title>
    <link href="/2023/05/23/bash-datetime/"/>
    <url>/2023/05/23/bash-datetime/</url>
    
    <content type="html"><![CDATA[<h1 id="bash-datetime-manipulate">Bash datetime (manipulate)</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh">NAME<br>       <span class="hljs-built_in">date</span> - <span class="hljs-built_in">print</span> or <span class="hljs-built_in">set</span> the system <span class="hljs-built_in">date</span> and time<br><br>SYNOPSIS<br>       <span class="hljs-built_in">date</span> [OPTION]... [+FORMAT]<br>       <span class="hljs-built_in">date</span> [-u|--utc|--universal] [MMDDhhmm[[CC]YY][.ss]]<br><br></code></pre></td></tr></table></figure><p>We want to manipulate the datetime change.</p><h2 id="formatyyymmdd">Format=YYYMMDD</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs sh">YYYYMMDD=<span class="hljs-string">&quot;20210315&quot;</span><br>Next_day=$(<span class="hljs-built_in">date</span> +%Y%m%d -d <span class="hljs-string">&quot;<span class="hljs-variable">$YYYYMMDD</span> + 1 day&quot;</span>)<br><span class="hljs-comment"># 20210316</span><br>Next_day=$(<span class="hljs-built_in">date</span> +%Y-%m-%d -d <span class="hljs-string">&quot;<span class="hljs-variable">$YYYYMMDD</span> + 1 day&quot;</span>)<br><span class="hljs-comment"># 2021-03-16</span><br>Next_day=$(<span class="hljs-built_in">date</span> +%Y-%m-%d_%H:%M:%S -d <span class="hljs-string">&quot;<span class="hljs-variable">$YYYYMMDD</span> + 1 day&quot;</span>)<br><span class="hljs-comment"># 2021-03-16_00:00:00</span><br>Next_day=$(<span class="hljs-built_in">date</span> +%Y-%m-%d_%H:%M:%S -d <span class="hljs-string">&quot;<span class="hljs-variable">$YYYYMMDD</span> + 1 hour&quot;</span>)<br><span class="hljs-comment"># 2021-03-15_01:00:00</span><br>Next_day=$(<span class="hljs-built_in">date</span> +%Y-%m-%d_%H:%M:%S -d <span class="hljs-string">&quot;<span class="hljs-variable">$YYYYMMDD</span> + 1 min&quot;</span>)<br><span class="hljs-comment"># 2021-03-15_00:01:00</span><br>Next_day=$(<span class="hljs-built_in">date</span> +%Y-%m-%d_%H:%M:%S -d <span class="hljs-string">&quot;<span class="hljs-variable">$YYYYMMDD</span> + 1 second&quot;</span>)<br><span class="hljs-comment"># 2021-03-15_00:00:01</span><br>Next_day=$(<span class="hljs-built_in">date</span> +%Y-%m-%d_%H:%M:%S -d <span class="hljs-string">&quot;<span class="hljs-variable">$YYYYMMDD</span> + 1 day + 1 hour + 1 min + 1 second&quot;</span>)<br><span class="hljs-comment"># 2021-03-16_01:01:01</span><br></code></pre></td></tr></table></figure><h2 id="formatyyyy-mm-dd">Format=YYYY-MM-DD</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">YYYYMMDD=<span class="hljs-string">&quot;2021-04-15&quot;</span><br>Next_day=$(<span class="hljs-built_in">date</span> +%Y-%m-%d_%H:%M:%S -d <span class="hljs-string">&quot;<span class="hljs-variable">$YYYYMMDD</span> + 1 day + 1 hour + 1 min + 1 second&quot;</span>)<br><span class="hljs-comment"># 2021-04-16_01:01:01</span><br></code></pre></td></tr></table></figure><h2 id="formatyyyy-mm-dd-hhmmss">Format=YYYY-MM-DD HH:MM:SS"</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">YYYYMMDD=<span class="hljs-string">&quot;2017-01-19 00:05:01&quot;</span><br>Next_day=$(<span class="hljs-built_in">date</span> +%Y-%m-%d_%H:%M:%S -d <span class="hljs-string">&quot;<span class="hljs-variable">$YYYYMMDD</span> + 1 day + 1 hour + 1 min + 1 second&quot;</span>)<br><span class="hljs-comment"># 2017-01-20_08:06:02</span><br></code></pre></td></tr></table></figure><h2 id="for-loop">for loop</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh">YYYYMMDD=<span class="hljs-string">&quot;2024-06-02&quot;</span><br><span class="hljs-keyword">for</span> gfsfile <span class="hljs-keyword">in</span> $(<span class="hljs-built_in">seq</span> 0 1 28); <span class="hljs-keyword">do</span><br>    next_day=$(<span class="hljs-built_in">date</span> +%Y%m%d%H -d <span class="hljs-string">&quot;<span class="hljs-variable">$YYYYMMDD</span> + <span class="hljs-variable">$&#123;gfsfile&#125;</span> day&quot;</span>)<br>    <span class="hljs-built_in">echo</span> <span class="hljs-variable">$next_day</span><br><span class="hljs-keyword">done</span><br></code></pre></td></tr></table></figure><h2 id="to-seperate">To seperate</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh">FCST_DURATION=<span class="hljs-string">&quot;000_17:00:00&quot;</span><br><br>fcst_DD=<span class="hljs-variable">$&#123;FCST_DURATION:0:3&#125;</span><br>fcst_hh=<span class="hljs-variable">$&#123;FCST_DURATION:4:2&#125;</span><br>fcst_mm=<span class="hljs-variable">$&#123;FCST_DURATION:7:2&#125;</span><br>fcst_ss=<span class="hljs-variable">$&#123;FCST_DURATION:10:2&#125;</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Bash</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
      <tag>Bash</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>What&#39;s the rigorous definition of phase and phase transition?</title>
    <link href="/2023/05/15/Whats-the-rigorous-definition-of-phase-and-phase-transition/"/>
    <url>/2023/05/15/Whats-the-rigorous-definition-of-phase-and-phase-transition/</url>
    
    <content type="html"><![CDATA[<h1 id="whats-the-rigorous-definition-of-phase-and-phase-transition">What's the rigorous definition of phase and phase transition?</h1><p>Ref: <a href="https://physics.stackexchange.com/questions/313758/whats-the-rigorous-definition-of-phase-and-phase-transition">What's the rigorous definition of phase and phase transition?</a></p><p>From Yi-Zhuang You (å°¤äº¦åº„, Everett You),</p><blockquote><p>Does this mean that gas and liquid are the same phases? Because in the phase diagram they are connected and they have the same symmetry(translation and rotation). If they are not the same phase, how to call the state in large pressure and large temperature? Liquid or gas?</p></blockquote><p>Yes. <strong>From the modern point of view, liquid and gas are in the same phase</strong>. Because, as the asker has mentioned, they are continuously connected in the phase diagram through the "supercritical" regime. By definition, two states of matter are in the same phase if they can be smoothly deformed to each other without going through phase transitions. Historically, liquid and gas are named as different phases (by mistake) because people thought that "there must be one different phase at each side of the phase transition" (as argued in Diracology's answer). But this idea is wrong.</p><p>We can not declare different phases just by observing phase transitions. Otherwise, for example, in the following phase diagram on the left, we could have declared states A and B to be in different phases, simply because they are separated by phase transitions, as we can first go out of the blue phase and then reenter it. This way of separating phases is clearly stupid. Any reasonable person would agree that A and B should belong to the same phase in this case. Now we just deform the left phase diagram to the right by squeezing the intermediate red phase to a first-order transition line, then why we suddenly get confused about whether A and B are in the same phase or not? Definitely, they should still remain in the same phase! The liquid-gas transition is indeed a situation like this. So a logically consistent definition will have to define liquid and gas as a single phase.</p><blockquote><p>Does this mean that above the critical point the transition from gas to liquid is not a phase transition, but below the critical point, the transition from gas to liquid is a phase transition?</p></blockquote><p>Yes.</p><blockquote><p>If answers to my first and second question are "yes", does this mean even in the same phase there still can have phase transition? This conclusion is so weird!</p></blockquote><p>Given the example of the above phase diagrams, <strong>one will not feel weird about the fact that there can be (first-order) phase transitions inside a single phase</strong>. In fact, <strong>first-order transitions often appear by merging two second-order transitions together (this can be explained by Landau's theory)</strong>. <strong>So going across a first-order transition is like going out of the phase and back again immediately, which definitely can happen inside a single phase</strong>. However, I am not aware of any example that continuous phase transitions can also happen within a single phase. So I conjecture that if a phase transition happens inside a phase, it must be first-order. (The conjecture is falsified by the recent discovery of "unnecessary" quantum criticalities in Bi, Senthil 2018, Jian, Xu 2019, Verresen, Bibo, Pollmann 2021. -- Edited 2021) The liquid-gas transition is one example of my conjecture.</p><blockquote><p>From the Landau's paradigm, what's the symmetry breaking and order parameter in the gas-liquid phase transition? It seems that the symmetry is same in gas and liquid. Gas-liquid phase transition must be able to be explained by Landau's paradigm but Landau's paradigm says that there must be symmetry breaking in phase transition. There is an answer. I admit that from a modern point of view phase transition is not necessary due to symmetry breaking, but I don't think that gas-liquid transition has been beyond Landau's paradigm.</p></blockquote><p><strong>No symmetry breaking is associated with the liquid-gas transition. Landau's paradigm only says that there must be spontaneous symmetry breaking in second-order transitions, but not in first-order transitions.</strong> In fact, nothing can be said about first-order transitions, because first-order transitions can happen anywhere in the phase diagram without any reason. The liquid-gas transition is indeed a case like this.</p><p>Even though the liquid-gas transition is not a symmetry breaking transition, it can still be described within Landau's paradigm phenomenologically (who says that Landau's theory only applies to symmetry breaking transitions?). We can introduce the density <span class="math inline">\(\rho\)</span> of the fluid as the order parameter. Because no symmetry is acting on this order parameter, so there is no symmetry reason to forbid odd-order terms like <span class="math inline">\(\rho, \rho^3, ...\)</span> to appear in Landau's free energy. However the first order term can always be absorbed by redefining the order parameter with a shift <span class="math inline">\(\rho --&gt; \rho 0\)</span> , then the Landau free energy takes the general form of,</p><p><span class="math inline">\(F = F0 + a\rho^2 + b\rho^3 + c\rho^4 + ...\)</span></p><p>First-order transition happens by driving the parameter <span class="math inline">\(a\)</span> to <span class="math inline">\(a &lt; 9b^2/32c\)</span></p><p>From this example, we can see that (within Landau's paradigm) if a phase transition happens without breaking any symmetry, it must be first-order. Again the liquid-gas transition is one such example.</p><blockquote><p>So if given one phase, we firstly find the symmetry is same in this phase and then check several order parameters also same in this phase. However, how do you prove you must not be able to construct some weird order parameters such that in one part of this phase is zero and in another part of this phase is nonzero? For example, in a solid phase of water which has the same crystal structure, how to prove any order parameter that you can construct will not be zero in one part of the phase and nonzero in another part?</p></blockquote><p>Indeed, <strong>you can never rule out the possibility that some weird order parameter is hiding there to further divide the phase into more phases.</strong> That is actually why the solid phase of water is divided into so many different crystal phases. Each crystal structure is associated with a different symmetry-breaking pattern. Sometimes the symmetries are just so complicated that you may miss one or two of them if you are not careful enough. In that case, you will also miss the order parameters associated with the missing symmetry, until you see a specific heat anomaly in the experiment where you did not expect, then you start to realize that oh there is a missing order parameter that actually changes across this transition, and one needs to add some additional symmetry to explain it. This is actually the typical way that physicists work every day, they never figure out the full classification of phases until they see the evidence for new phases and phase transitions. I think this is also the fun part of condensed matter physics: there are always new phases of matter waiting for us to discover.</p><h2 id="more">More</h2><ol type="1"><li>In <a href="https://en.wikipedia.org/wiki/Ginzburg%E2%80%93Landau_theory">wiki</a>, Based on Landau's previously established theory of <strong>second-order phase transitions,</strong> ...</li></ol>]]></content>
    
    
    <categories>
      
      <category>Physics</category>
      
    </categories>
    
    
    <tags>
      
      <tag>phase transition</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ERA5 dataset (2) contains invariant variables</title>
    <link href="/2023/05/11/ERA5-2-invariant-variables/"/>
    <url>/2023/05/11/ERA5-2-invariant-variables/</url>
    
    <content type="html"><![CDATA[<h1 id="era5-dataset-2-contains-invariant-variables">ERA5 dataset (2) contains invariant variables</h1><p><a href="https://forum.mmm.ucar.edu/threads/error-while-running-real-exe-with-era5-data-in-wrf-4-3-3.11500/">Post</a> <a href="https://rda.ucar.edu/datasets/ds633.0/dataaccess/">Downlaod</a> Ref: <a href="https://dreambooker.site/2017/12/20/initializing-the-wrf-model-with-ecmwf-era-interim-reanalysis/#/plpy">Initializing the WRF model with ECMWF ERA-Interim reanalysis</a></p><blockquote><p>I am suspicious that you don't have the file that contains invariant variables, especially landmask and terrain height, which are two important variables for WRF/WPS.</p></blockquote><blockquote><p>Please let me know if I am wrong. Otherwise, please download the following two files (from NCAR CISL)</p></blockquote><blockquote><p>e5.oper.invariant.128_172_lsm.regn320sc.2016010100_2016010100.grb e5.oper.invariant.128_129_z.regn320sc.2016010100_2016010100.grb</p></blockquote><blockquote><p>These files are not 'built-in' files. You have to download them, then go through the ungrib and metgrid processes.</p></blockquote><blockquote><p>Note that the two files need to be ungribbed separately (with start_date and end_date = '2016-01-01_00:00:00', and prefix = 'FILE2' in &amp;unribThese files</p></blockquote><blockquote><p>Then rename FILE2:2016-01-01_00 to be FILE2, and set <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">&amp;metgrid<br>fg_name = <span class="hljs-string">&#x27;FILE1&#x27;</span>,<br>io_form_metgrid = 2,<br>constants_name = <span class="hljs-string">&#x27;./FILE2&#x27;</span><br></code></pre></td></tr></table></figure> From here you can continue to run metgrid.exe.</p></blockquote><h2 id="download">Download</h2><p><a href="https://rda.ucar.edu/datasets/ds633.0/dataaccess/">Downlaod</a></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/usr/bin/env csh</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># c-shell script to download selected files from rda.ucar.edu using Wget</span><br><span class="hljs-comment"># NOTE: if you want to run under a different shell, make sure you change</span><br><span class="hljs-comment">#       the &#x27;set&#x27; commands according to your shell&#x27;s syntax</span><br><span class="hljs-comment"># after you save the file, don&#x27;t forget to make it executable</span><br><span class="hljs-comment">#   i.e. - &quot;chmod 755 &lt;name_of_script&gt;&quot;</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Experienced Wget Users: add additional command-line flags to &#x27;opts&#x27; here</span><br><span class="hljs-comment">#   Use the -r (--recursive) option with care</span><br><span class="hljs-comment">#   Do NOT use the -b (--background) option - simultaneous file downloads</span><br><span class="hljs-comment">#       can cause your data access to be blocked</span><br><span class="hljs-built_in">set</span> opts = <span class="hljs-string">&quot;-N&quot;</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Check wget version.  Set the --no-check-certificate option</span><br><span class="hljs-comment"># if wget version is 1.10 or higher</span><br><span class="hljs-built_in">set</span> v = `wget -V |grep <span class="hljs-string">&#x27;GNU Wget &#x27;</span> | <span class="hljs-built_in">cut</span> -d <span class="hljs-string">&#x27; &#x27;</span> -f 3`<br><span class="hljs-built_in">set</span> a = `<span class="hljs-built_in">echo</span> <span class="hljs-variable">$v</span> | <span class="hljs-built_in">cut</span> -d <span class="hljs-string">&#x27;.&#x27;</span> -f 1`<br><span class="hljs-built_in">set</span> b = `<span class="hljs-built_in">echo</span> <span class="hljs-variable">$v</span> | <span class="hljs-built_in">cut</span> -d <span class="hljs-string">&#x27;.&#x27;</span> -f 2`<br><span class="hljs-keyword">if</span>(100 * <span class="hljs-variable">$a</span> + <span class="hljs-variable">$b</span> &gt; 109) <span class="hljs-keyword">then</span><br>  <span class="hljs-built_in">set</span> cert_opt = <span class="hljs-string">&quot;--no-check-certificate&quot;</span><br><span class="hljs-keyword">else</span><br>  <span class="hljs-built_in">set</span> cert_opt = <span class="hljs-string">&quot;&quot;</span><br>endif<br><br><span class="hljs-built_in">set</span> filelist= ( \<br>  https://data.rda.ucar.edu/ds633.0/e5.oper.invariant/197901/e5.oper.invariant.128_026_cl.ll025sc.1979010100_1979010100.grb  \<br>  https://data.rda.ucar.edu/ds633.0/e5.oper.invariant/197901/e5.oper.invariant.128_027_cvl.ll025sc.1979010100_1979010100.grb  \<br>  https://data.rda.ucar.edu/ds633.0/e5.oper.invariant/197901/e5.oper.invariant.128_028_cvh.ll025sc.1979010100_1979010100.grb  \<br>  https://data.rda.ucar.edu/ds633.0/e5.oper.invariant/197901/e5.oper.invariant.128_029_tvl.ll025sc.1979010100_1979010100.grb  \<br>  https://data.rda.ucar.edu/ds633.0/e5.oper.invariant/197901/e5.oper.invariant.128_030_tvh.ll025sc.1979010100_1979010100.grb  \<br>  https://data.rda.ucar.edu/ds633.0/e5.oper.invariant/197901/e5.oper.invariant.128_043_slt.ll025sc.1979010100_1979010100.grb  \<br>  https://data.rda.ucar.edu/ds633.0/e5.oper.invariant/197901/e5.oper.invariant.128_074_sdfor.ll025sc.1979010100_1979010100.grb  \<br>  https://data.rda.ucar.edu/ds633.0/e5.oper.invariant/197901/e5.oper.invariant.128_129_z.ll025sc.1979010100_1979010100.grb  \<br>  https://data.rda.ucar.edu/ds633.0/e5.oper.invariant/197901/e5.oper.invariant.128_160_sdor.ll025sc.1979010100_1979010100.grb  \<br>  https://data.rda.ucar.edu/ds633.0/e5.oper.invariant/197901/e5.oper.invariant.128_161_isor.ll025sc.1979010100_1979010100.grb  \<br>  https://data.rda.ucar.edu/ds633.0/e5.oper.invariant/197901/e5.oper.invariant.128_162_anor.ll025sc.1979010100_1979010100.grb  \<br>  https://data.rda.ucar.edu/ds633.0/e5.oper.invariant/197901/e5.oper.invariant.128_163_slor.ll025sc.1979010100_1979010100.grb  \<br>  https://data.rda.ucar.edu/ds633.0/e5.oper.invariant/197901/e5.oper.invariant.128_172_lsm.ll025sc.1979010100_1979010100.grb  \<br>  https://data.rda.ucar.edu/ds633.0/e5.oper.invariant/197901/e5.oper.invariant.228_007_dl.ll025sc.1979010100_1979010100.grb  \<br>)<br><span class="hljs-keyword">while</span>(<span class="hljs-variable">$#filelist</span> &gt; 0)<br>  <span class="hljs-built_in">set</span> syscmd = <span class="hljs-string">&quot;wget <span class="hljs-variable">$cert_opt</span> <span class="hljs-variable">$opts</span> <span class="hljs-variable">$filelist</span>[1]&quot;</span><br>  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$syscmd</span> ...&quot;</span><br>  <span class="hljs-variable">$syscmd</span><br>  <span class="hljs-built_in">shift</span> filelist<br>end<br></code></pre></td></tr></table></figure><p>Two are important,</p><p>terrain height, &gt; e5.oper.invariant.128_129_z.ll025sc.1979010100_1979010100.grb</p><p>landmask, &gt; e5.oper.invariant.128_172_lsm.ll025sc.1979010100_1979010100.grb</p><h2 id="ungrib">Ungrib</h2><h3 id="source-wrf-env">source WRF env</h3><h3 id="soft-link">soft-link</h3><ol type="1"><li>link_grib.csh</li><li>namelist.wps</li><li>ungrib.exe</li><li>Vtable.ERA-interim.pl as Vtable</li><li>int2nc.exe</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs sh">&amp;share<br> wrf_core = <span class="hljs-string">&#x27;ARW&#x27;</span>,<br> max_dom = 1,<br> start_date = <span class="hljs-string">&#x27;1979-01-01_00:00:00&#x27;</span>,<br> end_date   = <span class="hljs-string">&#x27;1979-01-01_00:00:00&#x27;</span>,<br> interval_seconds = 10800,<br> io_form_geogrid = 2<br>/<br><br>&amp;ungrib<br> out_format = <span class="hljs-string">&#x27;WPS&#x27;</span>,<br> prefix = <span class="hljs-string">&#x27;FIX&#x27;</span>,<br>/<br></code></pre></td></tr></table></figure><p>and link_grib.csh</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ ./link_grib.csh e5.oper.invariant.*<br>GRIBFILE.AAA -&gt; e5.oper.invariant.128_129_z.ll025sc.1979010100_1979010100.grb<br>GRIBFILE.AAB -&gt; e5.oper.invariant.128_172_lsm.ll025sc.1979010100_1979010100.grb<br></code></pre></td></tr></table></figure><p>then ungrib.exe</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ ./ungrib.exe<br>FIX:1979-01-01_00<br></code></pre></td></tr></table></figure><h3 id="check-results">check results</h3><p>Plot Intermediate Files in netCDF Format Using <strong>int2nc.exe (Found in WPS/util/)</strong> <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ ./int2nc.exe FIX:1979-01-01_00<br>FIX:1979-01-01_00.nc<br>$ ncview FIX:1979-01-01_00.nc<br></code></pre></td></tr></table></figure></p><h2 id="for-metgrid.exe">For metgrid.exe</h2><p>namelist.wps is written as</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh">&amp;share<br> start_date = <span class="hljs-string">&#x27;2015-08-07_00:00:00&#x27;</span>,<span class="hljs-string">&#x27;2015-08-07_00:00:00&#x27;</span>,<br> end_date   = <span class="hljs-string">&#x27;2015-08-08_12:00:00&#x27;</span>,<span class="hljs-string">&#x27;2015-08-08_12:00:00&#x27;</span>,<br>&amp;metgrid<br> fg_name = <span class="hljs-string">&#x27;ERA5&#x27;</span>,<br> constants_name = <span class="hljs-string">&#x27;/xxx/xxx/FIX:1979-01-01_00&#x27;</span>,<br> io_form_metgrid = 2,<br></code></pre></td></tr></table></figure><p>Finally, <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ ./metgrid.exe<br></code></pre></td></tr></table></figure></p>]]></content>
    
    
    <categories>
      
      <category>NWP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>WRF</tag>
      
      <tag>WPS</tag>
      
      <tag>MPAS</tag>
      
      <tag>IC/BC</tag>
      
      <tag>ERA5</tag>
      
      <tag>ECMWF</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>gdb debugger</title>
    <link href="/2023/05/11/gdb/"/>
    <url>/2023/05/11/gdb/</url>
    
    <content type="html"><![CDATA[<h1 id="gdb-debugger">gdb debugger</h1><p>GDB stands for GNU Project Debugger. GDBï¼ˆGNU Debuggerï¼‰æ˜¯UNIXåŠUNIX-likeä¸‹çš„å¼·å¤§èª¿è©¦å·¥å…·ï¼Œå¯ä»¥èª¿è©¦ada, c, c++, asm, minimal, d, fortran, objective-c, go, java,pascalç­‰èªè¨€ã€‚æœ¬æ–‡ä»¥Cç¨‹åºç‚ºä¾‹å¦‚ï¼Œä»‹ç´¹GDBå•Ÿå‹•èª¿è©¦çš„å¤šç¨®æ–¹å¼ã€‚</p><ol type="1"><li>Compile your code with debugging option</li></ol><h2 id="launch-gdb">Launch gdb</h2><p>In general, it is <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">gdb ./wrf.exe<br></code></pre></td></tr></table></figure> but most of time, it is by mpirun, <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">mpirun -n 1 gdb ./wrf.exe<br></code></pre></td></tr></table></figure></p><p>Sample output, <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sh">GNU gdb (GDB) Red Hat Enterprise Linux 7.6.1-110.el7<br>Copyright (C) 2013 Free Software Foundation, Inc.<br>License GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;<br>This is free software: you are free to change and redistribute it.<br>There is NO WARRANTY, to the extent permitted by law.  Type <span class="hljs-string">&quot;show copying&quot;</span><br>and <span class="hljs-string">&quot;show warranty&quot;</span> <span class="hljs-keyword">for</span> details.<br>This GDB was configured as <span class="hljs-string">&quot;x86_64-redhat-linux-gnu&quot;</span>.<br>For bug reporting instructions, please see:<br>&lt;http://www.gnu.org/software/gdb/bugs/&gt;...<br>Reading symbols from /xxx/WRFV4.4_debug/main/wrf.exe...done.<br>(gdb)<br></code></pre></td></tr></table></figure></p><h2 id="commands">commands</h2><p>Here are few useful commands to get started with gdb for the above example: <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs sh">run or r â€“&gt; executes the program from start to end.<br><span class="hljs-built_in">break</span> or b â€“&gt; sets breakpoint on a particular line.<br><span class="hljs-built_in">disable</span> -&gt; <span class="hljs-built_in">disable</span> a breakpoint.<br><span class="hljs-built_in">enable</span> â€“&gt; <span class="hljs-built_in">enable</span> a disabled breakpoint.<br>delete -&gt; delete a breakpoint by index 1,2,3,...<br>next or n -&gt; executes next line of code, but donâ€™t dive into <span class="hljs-built_in">functions</span>.<br>step â€“&gt; go to next instruction, diving into the <span class="hljs-keyword">function</span>.<br>list or l â€“&gt; displays the code.<br><span class="hljs-built_in">print</span> or p â€“&gt; used to display the stored value.<br>quit or q â€“&gt; exits out of gdb.<br>clear â€“&gt; to clear all breakpoints.<br><span class="hljs-built_in">continue</span> â€“&gt; <span class="hljs-built_in">continue</span> normal execution.<br>reverse-next -&gt; Run the program backward<br>reverse-step -&gt; Run the program backward<br>reverse-continue -&gt; Run the program backward<br></code></pre></td></tr></table></figure></p><h2 id="movement">movement</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">up (n)<br>down (n)<br><span class="hljs-built_in">print</span> or p<br></code></pre></td></tr></table></figure><h2 id="single-step-execution--next">Single step execution -next</h2><p>The next command (can be abbreviated as n) is used to continue to execute the next statement after the program is stopped, assuming that debugging has been started, and stop at line 10, if you want to continue execution, use n to execute the next statement, if later Keeping up with the number num, it means that the instruction is executed num times, and the effect of continuing to execute n lines is achieved.</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs sh">(gdb) b 10<br>Breakpoint 1 at 0x405b26: file wrf.f90, line 10.<br>(gdb) run<br>Starting program: /xxx/./wrf.exe <br>[Thread debugging using libthread_db enabled]<br>Using host libthread_db library <span class="hljs-string">&quot;/lib64/libthread_db.so.1&quot;</span>.<br><br>Breakpoint 1, wrf () at wrf.f90:22<br>22        CALL wrf_init<br>Missing separate debuginfos, use: debuginfo-install ...<br>(gdb) n<br> starting wrf task            0  of            1<br>25        CALL wrf_dfi<br></code></pre></td></tr></table></figure><h2 id="step-into--step">Step into -step</h2><p>For the above situation, if we want to track the internal situation of the function, we can use the step command (which can be abbreviated as s), which can single-step trace to the inside of the function, but only if the function has debugging information and source code information.</p><h2 id="core-document">core document</h2><p>When a program core dumps, a core file may be generated, which can help us identify location problems for a large enough program. But it was proposed before that the system does not limit the generation of core files. You can use the command limit - c to view: <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ <span class="hljs-built_in">ulimit</span> -c<br>0<br>$ <span class="hljs-built_in">ulimit</span> -c unlimited  <span class="hljs-comment"># Indicates that there is no limit to the core file size</span><br></code></pre></td></tr></table></figure> Or add at the end of ~/.bashrc: ulimit -c unlimited</p><h2 id="check-breakpoints">check breakpoints</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ info breakpoints<br></code></pre></td></tr></table></figure><h2 id="set-breakpoints">set breakpoints</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ b 10<br>$ b main.c:10 <span class="hljs-comment"># Important</span><br>$ b Function<br></code></pre></td></tr></table></figure><h3 id="generate-breakpoints-based-on-expression-value-changes">Generate breakpoints based on expression value changes</h3><p>Sometimes we need to observe a certain value or expression to know when it has changed. At this time, we can use the watch command. For example: <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ watch a<br></code></pre></td></tr></table></figure> At this time, let the program continue to run. If the value of a changes, the relevant content will be printed, such asï¼š <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">Hardware watchpoint 2: a<br>Old value = 12<br>New value = 11<br></code></pre></td></tr></table></figure> But here to pay attention is that the program must be running, otherwise it will appear: &gt; No symbol "a" in current context. Because the program is not running, the current context has no relevant variable information.</p><h2 id="tuitext-user-interface">TUI(Text User Interface)</h2><p>The GDB Text User Interface, TUI in short, is a terminal interface which uses the curses library to show the source file, the assembly output, the program registers and GDB commands in separate text windows. <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ gdb main -tui<br></code></pre></td></tr></table></figure> Sounds like what you're looking for is the callstack/backtrace. For that, just use the &gt; $ (gdb) backtrace/bt or where</p><p>command.</p><h2 id="frame">frame</h2><ol type="1"><li>According to the stack frame number or stack frame address, select the stack frame to be viewed. The syntax format is as follows: &gt; (gdb) frame spec</li><li>With the help of the following command, we can view the information stored in the current stack frame: &gt; (gdb) info frame</li></ol><h2 id="backtracebt">backtrace/bt</h2><blockquote><p>backtrace</p></blockquote><p>The command is used to print the information of all stack frames in the current debugging environment</p><h2 id="step-out-of-current-function-with-gdb">Step out of current function with GDB</h2><p>You can use the <strong>finish</strong> command. &gt; finish: Continue running until just after function in the selected stack frame returns. Print the returned value (if any). This command can be abbreviated as fin.</p><h2 id="reserse">Reserse</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">reverse-next -&gt; Run the program backward<br>reverse-step -&gt; Run the program backward<br>reverse-continue -&gt; Run the program backward<br></code></pre></td></tr></table></figure><h2 id="example-wrf">Example: WRF</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ <span class="hljs-built_in">source</span> wrf_env.sh<br><br>(gdb) b solve_em.F:xxx                       <span class="hljs-comment"># try to stop before CALL first_rk_step_part1(...)</span><br>(gdb) b module_first_rk_step_part1.f90:387   <span class="hljs-comment"># try to stop before CALL surface_driver(...)</span><br>(gdb) b module_surface_driver.f90:2683       <span class="hljs-comment"># try to stop before CALL lsm(...) </span><br>(gdb) b module_sf_noahdrv.f90:1234           <span class="hljs-comment"># try to stop before Call urban(...) for WRF</span><br>(gdb) b module_sf_noahdrv.F:xxxx             <span class="hljs-comment"># try to stop before Call urban(...) for MPAS</span><br>(gdb) run<br>...<br>(gdb) n/s/p/f/bt<br></code></pre></td></tr></table></figure><h2 id="inferior-1-process-exited-normally">Inferior 1 (process ) exited normally</h2><p>That is not an error, from gdb's point of view. Your program just finished gracefully, with a return value of 0, and gdb informs you of that.</p><h2 id="what-does-no-stack-mean-in-gdb">What does <strong>no stack</strong> mean in gdb?</h2><h2 id="missing-separate-debuginfos-use-debuginfo-install-cyrus-sasl-lib-">Missing separate debuginfos, use: debuginfo-install cyrus-sasl-lib-?</h2><ol type="1"><li>Install debuginfos</li><li>$ debuginfo-install glibc</li></ol>]]></content>
    
    
    <categories>
      
      <category>gdb</category>
      
    </categories>
    
    
    <tags>
      
      <tag>debug</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ERA5 ERA5T expver dimension issue</title>
    <link href="/2023/05/07/ERA5-expver-issue/"/>
    <url>/2023/05/07/ERA5-expver-issue/</url>
    
    <content type="html"><![CDATA[<h1 id="era5-era5t-expver-dimension-issue">ERA5 ERA5T expver dimension issue</h1><p>Ref: <a href="https://confluence.ecmwf.int/display/CUSF/ERA5+CDS+requests+which+return+a+mixture+of+ERA5+and+ERA5T+data">ERA5 CDS requests which return a mixture of ERA5 and ERA5T data</a></p><p><strong>The ERA5 hourly and monthly data are made available with a 3 month delay.</strong> This means that after a month has passed, another month's worth of ERA5 data is written to the dataset.</p><p><strong>ERA5T (near real time)</strong> preliminary data are used to fill the gap between the end of the ERA5 data and 5 days before the present date. The oldest month of these is overwritten each month as new ERA5 data become available.</p><blockquote><p>It depends on time, it is <strong>expver either 1 or 5</strong>, will not exist at the same time<br />If already past 3 months' time, it will use ERA5, otherwise use ERA5T if too recent</p></blockquote><h2 id="for-example">For example,</h2><p>So as an example, say we have a current date of 15th February 2020:</p><blockquote><p>ERA5 data are currently from 1/1/1979 - 30/11/2019 (instantaneous variables) and 1/1/1979 - 1/12/2019 (00-06 UTC, accumulated variables)<br />ERA5T data (with a 5 day delay) are from 1/12/2019- 10/2/2020 (instantaneous variables) and 1/12/2019 (07-23 UTC, accumulated variables)- 10/2/2020</p></blockquote><p>For requests which return a mixture of ERA5 and ERA5T data (such as for data from the 1st of the month), instantaneous variables (e.g temperature) come from ERA5T (which has 'experiment version' of 5) while accumulated variables (fluxes, precipitation) come from both datasets with the following structure:</p><blockquote><p>00-06 UTC on 1 day of the month from <strong>ERA5 (expver 1)</strong><br />07-23 UTC on 1 day of the month (and the following dates up to 5 day from present) from <strong>ERA5T (expver 5)</strong> When these data are converted to netCDF a new dimension is created called expver containing 1 and 5. Moreover, a single time coordinate is used which covers the entire requested period.</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs sh">dimensions:<br>        longitude = 1440 ;<br>        latitude = 721 ;<br>        expver = 2 ;<br>        time = 24 ;<br>variables:<br>        <span class="hljs-built_in">float</span> longitude(longitude) ;<br>                longitude:units = <span class="hljs-string">&quot;degrees_east&quot;</span> ;<br>                longitude:long_name = <span class="hljs-string">&quot;longitude&quot;</span> ;<br>        <span class="hljs-built_in">float</span> latitude(latitude) ;<br>                latitude:units = <span class="hljs-string">&quot;degrees_north&quot;</span> ;<br>                latitude:long_name = <span class="hljs-string">&quot;latitude&quot;</span> ;<br>        int expver(expver) ;<br>                expver:long_name = <span class="hljs-string">&quot;expver&quot;</span> ;<br>        int time(time) ;<br>                time:units = <span class="hljs-string">&quot;hours since 1900-01-01 00:00:00.0&quot;</span> ;<br>                time:long_name = <span class="hljs-string">&quot;time&quot;</span> ;<br>                time:calendar = <span class="hljs-string">&quot;gregorian&quot;</span> ;<br>        short tp(time, expver, latitude, longitude) ;<br>                tp:scale_factor = 9.06276558810304e-07 ;<br>                tp:add_offset = 0.0296950577259784 ;<br>                tp:_FillValue = -32767s ;<br>                tp:missing_value = -32767s ;<br>                tp:units = <span class="hljs-string">&quot;m&quot;</span> ;<br>                tp:long_name = <span class="hljs-string">&quot;Total precipitation&quot;</span> ;<br>data:<br><br> expver = 5, 1 ;<br> ...<br>&#125;<br></code></pre></td></tr></table></figure><p>Both expver dimensions use the full time extent of time coordinate but the expver 1 data only covers the first 7 timesteps, the remaining timesteps are 'padded' with empty fields. For the expver 5 data, the first 7 timesteps are padded with empty fields, with the remaining timesteps coming from the ERA5T data.</p><p>When the last ERA5 data are released, <strong>they will overwrite the ERA5T data for the entire month and for accumulated variables for 00-06 in next month.</strong> This process will be repeated each month.</p>]]></content>
    
    
    <categories>
      
      <category>NWP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>WRF</tag>
      
      <tag>WPS</tag>
      
      <tag>MPAS</tag>
      
      <tag>IC/BC</tag>
      
      <tag>ERA5</tag>
      
      <tag>ECMWF</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Git cherry-pick</title>
    <link href="/2023/05/07/Git-cherry-pick/"/>
    <url>/2023/05/07/Git-cherry-pick/</url>
    
    <content type="html"><![CDATA[<h1 id="git-cherry-pick">Git cherry-pick</h1><p>After switching to the master, use the cherry-pick command to take out the submission of "adding commit instructions", and then add it to the master.</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ git checkout master<br>Switched to branch <span class="hljs-string">&#x27;master&#x27;</span><br>$ git cherry-pick 99daed2<br>error: could not apply 99daed2... commit<br>hint: after resolving the conflicts, mark the corrected paths<br>hint: with <span class="hljs-string">&#x27;git add &lt;paths&gt;&#x27;</span> or <span class="hljs-string">&#x27;git rm &lt;paths&gt;&#x27;</span><br>hint: and commit the result with <span class="hljs-string">&#x27;git commit&#x27;</span><br></code></pre></td></tr></table></figure><p>If a conflict occurs, please open sample.txt, modify the conflicting part and then submit.</p><h2 id="whats-the-simplest-way-to-list-conflicted-files-in-git">What's the simplest way to list conflicted files in Git?</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># # Search for all conflicting files.</span><br>git diff --name-only --diff-filter=U --relative<br><br><span class="hljs-comment"># Search for all conflicting files.</span><br>grep -lr <span class="hljs-string">&quot;&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD&quot;</span> ./*<br><br></code></pre></td></tr></table></figure><h2 id="resolve-easyobvious-conflicts">Resolve easy/obvious conflicts</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#At this point you may review each files. If solution is to accept local/our version, run:</span><br>git checkout --ours PATH/FILE<br><br><span class="hljs-comment">#If solution is to accept remote/other-branch version, run:</span><br>git checkout --theirs PATH/FILE<br><br><span class="hljs-comment">#If you have multiple files and you want to accept local/our version, run:</span><br>grep -lr <span class="hljs-string">&#x27;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&#x27;</span> . | xargs git checkout --ours<br><br><span class="hljs-comment">#If you have multiple files and you want to accept remote/other-branch version, run:</span><br>grep -lr <span class="hljs-string">&#x27;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&#x27;</span> . | xargs git checkout --theirs<br></code></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ git add sample.txt<br>$ git commit<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Git</category>
      
    </categories>
    
    
    <tags>
      
      <tag>git cherry-pick</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Git: solve conflicted files</title>
    <link href="/2023/05/07/Git-conflicts/"/>
    <url>/2023/05/07/Git-conflicts/</url>
    
    <content type="html"><![CDATA[<h1 id="git-solve-conflicted-files">Git: solve conflicted files</h1><h2 id="whats-the-simplest-way-to-list-conflicted-files-in-git">What's the simplest way to list conflicted files in Git?</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># # Search for all conflicting files.</span><br>git diff --name-only --diff-filter=U --relative<br><br><span class="hljs-comment"># Search for all conflicting files.</span><br>grep -lr <span class="hljs-string">&quot;&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD&quot;</span> ./*<br><br></code></pre></td></tr></table></figure><h2 id="resolve-easyobvious-conflicts">Resolve easy/obvious conflicts</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#At this point you may review each files. If solution is to accept local/our version, run:</span><br>git checkout --ours PATH/FILE<br><br><span class="hljs-comment">#If solution is to accept remote/other-branch version, run:</span><br>git checkout --theirs PATH/FILE<br><br><span class="hljs-comment">#If you have multiple files and you want to accept local/our version, run:</span><br>grep -lr <span class="hljs-string">&#x27;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&#x27;</span> . | xargs git checkout --ours<br><br><span class="hljs-comment">#If you have multiple files and you want to accept remote/other-branch version, run:</span><br>grep -lr <span class="hljs-string">&#x27;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&#x27;</span> . | xargs git checkout --theirs<br></code></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ git add sample.txt<br>$ git commit<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Git</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Github</tag>
      
      <tag>git commit</tag>
      
      <tag>git conflicts</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Intel OneAPI</title>
    <link href="/2023/05/06/Intel_OneAPI/"/>
    <url>/2023/05/06/Intel_OneAPI/</url>
    
    <content type="html"><![CDATA[<h1 id="intel-oneapi">Intel OneAPI</h1><p>The Intel oneAPI HPC Toolkit is a comprehensive suite of development tools that make it fast and easy to build modern code that gets maximum performance out of the newest IntelÂ® processors. This toolkit enables high performance computing on clusters or individual nodes with flexible options including optimal performance on a CPU or GPU.</p><p>Intel oneAPI æ˜¯ä¸€ç¨®çµ±ä¸€çš„è·¨æ¶æ§‹çš„ç¨‹å¼è¨­è¨ˆæ¨¡å‹ï¼Œæä¾›äº†CPUã€GPUã€FPGAã€å°ˆç”¨åŠ é€Ÿå™¨çš„ç”¢å“ã€‚</p><p>2020å¹´12æœˆï¼Œè‹±ç‰¹çˆ¾ç™¼å¸ƒäº†oneAPIè»Ÿé«”é–‹ç™¼å¥—è£ï¼Œå…è²»ã€ä¸¦ä¸”å–ä»£äº†ä¹‹å‰éœ€è¦è¨±å¯(è³¼è²·)çš„Intel Parallel Studioã€‚</p><p>Intel oneAPI toolkitsåŒ…å«äº†å…­å¤§å·¥å…·åŒ…ï¼š</p><ul><li>IntelÂ® oneAPI Base Toolkit(åŒ…å«äº†Intel Parallel Studioä¸­å¸¸ç”¨çš„è»Ÿé«”ä»¥åŠ iccã€MPIã€DPCPPã€MKLç­‰)</li><li>IntelÂ® oneAPI HPC Toolkit(æä¾›å¯æ“´å……çš„å¿«é€ŸC ++ã€Fortranã€OpenMPå’ŒMPIæ‡‰ç”¨ç¨‹å¼)</li><li>IntelÂ® oneAPI IoT Toolkit</li><li>IntelÂ® oneAPI Rendering Toolkit</li><li>IntelÂ® AI Analytics Toolkit</li><li>IntelÂ® Distribution of OpenVINOâ„¢ Toolkit</li></ul><div class="note note-primary">            <p><strong>å°æˆ‘å€‘ä¾†èªª IntelÂ® oneAPI Base Toolkit + IntelÂ® oneAPI HPC Toolkit åŸºæœ¬ä¸Šå°±åŒ…å«Intel Parallel Studio XEçš„åŠŸèƒ½äº†ï¼Œé—œéµé‚„å…è²»ã€‚</strong></p>          </div><p>Intel OneAPI Toolkit ä½¿ç”¨ä¸€æµçš„ç·¨è­¯å™¨, æ•ˆèƒ½åº«, æ¡†æ¶ä»¥åŠåˆ†æå’ŒåµéŒ¯å·¥å…·åœ¨CPU å’ŒXPU ä¸Šåˆ†æå’Œå„ªåŒ–é«˜æ•ˆèƒ½, è·¨æ¶æ§‹æ‡‰ç”¨ç¨‹å¼. æˆ‘å€‘çš„ä¼ºæœå™¨ä¸Šå®‰è£äº†Base Toolkit å’ŒHPC Toolkit, åŒ…å«icâ€‹â€‹c compiler, debugger, mkl æ•¸å­¸åº«, intel MPI, vtune ç­‰è»Ÿé«”, è«‹åƒé–±å®˜ç¶²æŸ¥çœ‹å®Œæ•´è»Ÿé«”æ¸…å–®åŠä½¿ç”¨æ–¹æ³•ã€‚</p><p>IntelÂ® oneAPI Base Toolkit: ã€ŒIntelÂ® oneAPIåŸºæœ¬å·¥å…·åŒ…ã€ï¼ˆBase Kitï¼‰æ˜¯ä¸€å¥—æ ¸å¿ƒå·¥å…·å’Œå‡½å¼åº«ï¼Œç”¨æ–¼è·¨å„ç¨®é«”ç³»çµæ§‹(CPUã€GPUå’ŒFPGA)é–‹ç™¼é«˜æ•ˆèƒ½ã€ä»¥è³‡æ–™ç‚ºä¸­å¿ƒçš„æ‡‰ç”¨ç¨‹å¼. å®ƒæ¡ç”¨äº†æ¥­ç•Œé ˜å…ˆçš„C++ç·¨è­¯å™¨ï¼Œå¯¦ä½œäº†SYCL*ï¼Œé€™æ˜¯C++åœ¨ç•°è³ªé‹ç®—ä¸Šçš„ç™¼å±•ã€‚å¯ä»¥ä½¿ç”¨å…¶ä»–å·¥å…·åŒ…ä¾†è£œå……åŸºæœ¬å·¥å…·åŒ…,æ¯”å¦‚IntelÂ® HPC Toolkit(åŒ…æ‹¬IntelÂ® Fortranç·¨è­¯å™¨ï¼Œ OpenMP* GPU offloadå’ŒIntelÂ® MPIåº«)ï¼ŒIntelÂ® Rendering Toolkit(æ¸²æŸ“å’Œå…‰ç·šè·Ÿè¸ªï¼Œç”¨æ–¼é«˜ä¿çœŸå¯è¦–åŒ–æ‡‰ç”¨ç¨‹å¼)</p><p>IntelÂ® HPC Toolkitï¼šBuild, analyze, and scale applications across shared- and distributed-memory computing systems. é«˜æ•ˆèƒ½é‹ç®—ï¼ˆHPCï¼‰æ˜¯äººå·¥æ™ºæ…§ã€æ©Ÿå™¨å­¸ç¿’å’Œæ·±åº¦å­¸ç¿’æ‡‰ç”¨ç¨‹å¼çš„æ ¸å¿ƒã€‚ ã€ŒIntelÂ® HPC Toolkitã€ï¼ˆHPCå·¥å…·åŒ…ï¼‰åˆ©ç”¨å‘é‡åŒ–ã€å¤šåŸ·è¡Œç·’ã€å¤šç¯€é»ä¸¦è¡ŒåŒ–å’Œè¨˜æ†¶é«”æœ€ä½³åŒ–çš„æœ€æ–°æŠ€è¡“ï¼Œ ç‚ºé–‹ç™¼äººå“¡æä¾›å»ºç½®ã€åˆ†æã€æœ€ä½³åŒ–å’Œæ“´å±•HPCæ‡‰ç”¨ç¨‹å¼æ‰€éœ€çš„åŠŸèƒ½ã€‚ æ­¤å·¥å…·åŒ…æ˜¯ã€ŒIntelÂ® oneAPI Base Toolkitã€çš„é™„åŠ å…ƒä»¶ï¼Œæ˜¯å¯¦ç¾å®Œæ•´åŠŸèƒ½æ‰€å¿…éœ€çš„ã€‚å®ƒåŒ…æ‹¬åŠŸèƒ½å¼·å¤§çš„ä»¥æ•¸æ“šç‚ºä¸­å¿ƒçš„åº«ã€é«˜ç´šåˆ†æå·¥å…·å’ŒIntelÂ® Python*ç™¼è¡Œç‰ˆï¼Œä»¥å¯¦ç¾æ ¸å¿ƒPythonæ•¸å€¼ã€ç§‘å­¸å’Œæ©Ÿå™¨å­¸ç¿’å¥—ä»¶çš„è¿‘ä¹æœ¬åœ°ç¨‹å¼ç¢¼æ•ˆèƒ½ã€‚</p><p>åŸä¾†ç”¨ä¾†ç·¨è­¯intelç¨‹å¼çš„ã€ŒIntelå…¨å®¶æ¡¶ã€æŒ‡çš„æ˜¯Intel Parallel Studio XEï¼Œè£¡é¢æ•´åˆäº†C/C++/Fortranèªè¨€çš„ç·¨è­¯å™¨ï¼ˆåˆ†åˆ¥æ˜¯iccã€icpcã€ifortï¼‰ã€MKLæ•¸å­¸å‡½å¼åº«åŠå„ç¨®é«˜æ•ˆèª¿è©¦å·¥å…·ï¼Œç”šè‡³é‚„æœ‰Intel MPIï¼Œ å¯ä»¥èªªæ˜¯ç·¨è­¯é‡åŒ–è»Ÿé«”æœ€å¸¸ç”¨çš„ä¸€å¥—ã€Œè£å‚™ã€ã€‚ç„¶è€Œå¾2021å¹´é–‹å§‹Intelä¸å†æä¾›èˆŠç‰ˆParallel Studio XEä¸‹è¼‰é é¢ï¼Œè€Œæ˜¯æ”¹æˆäº†ï¼ˆæˆ–ç¨±å‡ç´šæˆäº†ï¼‰oneAPIï¼Œ oneapiåŒ…æ‹¬ä¸Šè¿°6å€‹å¥—ä»¶ã€‚</p><p>ä½†Base Toolkitå¥—ä»¶è£¡å«iccã€icpcç·¨è­¯å™¨å’ŒMKLå‡½å¼åº«ï¼Œå»ä¸å«ifortã€‚è€ŒHPC ToolkitåŒ…è£¡å«iccã€icpcã€ifortï¼Œå»ä¸å«MKLåº«ã€‚é¡¯ç„¶ä¸‹è¼‰ä»»ä¸€å€‹åŒ…éƒ½ç„¡æ³•å®Œå…¨å–ä»£ä»¥å‰çš„ã€Œå…¨å®¶æ¡¶ã€ã€‚ å› æ­¤å¹³å°æ¡ç”¨å®‰è£Intel Base Toolkitå’ŒHPC Toolkitæ–¹æ³•ï¼Œä¾†å–ä»£å…ˆå‰çš„Parallel Studio XEã€‚</p><p>IntelÂ® VTuneâ„¢ Profiler:ç™¼ç¾ä¸¦æœ€ä½³åŒ–CPUã€GPUå’ŒFPGAç³»çµ±çš„æ•ˆèƒ½ç“¶é ¸ã€‚</p><h2 id="command-line-download">Command Line Download</h2><p>Command Line Installation Parameters</p><p>Get latest version <a href="https://www.intel.com/content/www/us/en/developer/tools/oneapi/hpc-toolkit-download.html?operatingsystem=linux&amp;distributions=offline" class="uri">https://www.intel.com/content/www/us/en/developer/tools/oneapi/hpc-toolkit-download.html?operatingsystem=linux&amp;distributions=offline</a></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh">wget https://registrationcenter-download.intel.com/akdlm/IRC_NAS/7deeaac4-f605-4bcf-a81b-ea7531577c61/l_BaseKit_p_2023.1.0.46401_offline.sh<br>wget https://registrationcenter-download.intel.com/akdlm/IRC_NAS/1ff1b38a-8218-4c53-9956-f0b264de35a4/l_HPCKit_p_2023.1.0.46346_offline.sh<br><br>sh ./l_BaseKit_p_2023.1.0.46401_offline.sh (**Install dependence**)<br>sh ./l_HPCKit_p_2023.1.0.46346_offline.sh<br></code></pre></td></tr></table></figure><p>For BaseKit, there is no dependence needs <strong>if doesn't install Intel Advisor and Intel VTune</strong>,</p><ul><li><a href="https://archlinux.org/packages/extra/x86_64/intel-oneapi-basekit/">Dependencies (10)</a></li><li>Intel Advisorï¼Œå®ƒå¯ä»¥å¹«åŠ©é–‹ç™¼è€…å°ç¨‹å¼é€²è¡Œä¸¦è¡Œè™•ç†çš„å„ªåŒ–ï¼Œæé«˜ç¨‹å¼çš„æ€§èƒ½ <a href="https://www.toolify.ai/tw/hardwaretw/intel-advisor%E7%A8%8B%E5%BC%8F%E5%84%AA%E5%8C%96%E7%9A%84%E5%BC%B7%E5%A4%A7%E5%B7%A5%E5%85%B7-3170948">link</a></li><li>Intel VTune æ˜¯intelå…¬å¸é–‹ç™¼çš„ä¸€æ¬¾å¼·å¤§çš„æ•ˆèƒ½ç“¶é ¸åˆ†æè»Ÿé«”ï¼Œèƒ½å¹«åŠ©é–‹ç™¼è€…æ‰¾å‡ºæ•ˆèƒ½å½±éŸ¿å› ç´ </li></ul><p><img src="https://i.imgur.com/5bQ4Nch.png" width="400" /></p><p>or,</p><p>download list: <a href="https://get.hpc.dev/vault/intel/" class="uri">https://get.hpc.dev/vault/intel/</a></p><p>or,</p><p>Direct download,</p><ul><li>intel-oneapi-base-toolkit-2025.0.0.885_offline.sh (2.4GB)</li><li>intel-oneapi-hpc-toolkit-2025.0.0.825_offline.sh (2.4GB)</li></ul><h3 id="installation-instructions">Installation Instructions</h3><p>The initial download is for the installer application files only. The installer will acquire all the tools during the installation process.</p><ol type="1"><li>Step 1: From the console, locate the downloaded install file.</li><li>Step 2:<ol type="1"><li>Use $ sudo sh ./<installer>.sh to launch the GUI Installer as root.</li><li>Optionally, use $ sh ./<installer>.sh to launch the GUI Installer as current user.</li></ol></li><li>Step 3: Follow the instructions in the installer.</li><li>Step 4: Explore the Get <a href="https://www.intel.com/content/www/us/en/develop/documentation/get-started-with-intel-oneapi-hpc-linux/top.html">Started Guide</a>.</li></ol><h3 id="option-get-started-with-the-intel-oneapi-hpc-toolkit-for-linux">(Option) Get Started with the Intel oneAPI HPC Toolkit for Linux</h3><p>Although the <code>CMake</code> and <code>pkg-config</code> build tools are not required by the oneAPI tools and toolkits, many oneAPI samples are provided as <code>CMake</code> projects and require <code>CMake</code> to build them. In some cases <code>pkg-config</code> is necessary to locate libraries needed to complete a build of the application.</p><p>The Intel compilers utilize the existing GNU build toolchains to provide a complete C/C++ development environment. If your distribution of Linux does not include the complete suite of GNU development tools, you need to install these tools.</p><p>To install <code>CMake</code>, <code>pkg-config</code>, and the GNU development tools on your Linux system, open a terminal session and enter the following commands:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">sudo</span> apt update<br><span class="hljs-built_in">sudo</span> apt -y install cmake pkg-config build-essential<br></code></pre></td></tr></table></figure><p>Verify the installation by displaying the installation location with this command: <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">which</span> cmake pkg-config make gcc g++<br></code></pre></td></tr></table></figure></p><h3 id="install-on-cluster-no-sudo">Install on cluster (no sudo)</h3><p>Online/Offline Installer:</p><ul><li><a href="https://www.intel.com/content/www/us/en/docs/oneapi/installation-guide-linux/2025-0/online-offline-installer-003.html#HPC-ONLINE-OFFLINE">Online/Offline Installer</a></li><li>If you do not have root (administrative or sudo) permissions, you can install the toolkit only in <strong>your home directory</strong> or <strong>a user-specific location</strong>. Refer to user installation commands in this document.<ul><li><code>--silent</code> (Run the installer in non-interactive (silent) mode.)</li><li><code>--install-dir</code> (Silent, default installation directory, Supported in silent mode. Customize the installation directory.)</li></ul></li><li><a href="https://www.intel.com/content/www/us/en/docs/oneapi/installation-guide-linux/2025-0/command-line-options.html#BASE-COMMAND-LINE-OPTIONS">Command Line Options</a></li></ul><div class="note note-primary">            <p>/home/wpsze/intel/oneapi/</p>          </div><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh"> $ sh ./l_BaseKit_p_2023.1.0.46401_offline.sh <br>Extract l_BaseKit_p_2023.1.0.46401_offline to /home/wpsze/intel/l_BaseKit_p_2023.1.0.46401_offline...<br>[######################################################################################################################################################################]<br>Extract l_BaseKit_p_2023.1.0.46401_offline completed!<br>Remove extracted files: /home/wpsze/intel/l_BaseKit_p_2023.1.0.46401_offline...<br></code></pre></td></tr></table></figure><div class="group-image-container"><div class="group-image-row"><div class="group-image-wrap"><img src="https://i.imgur.com/ppnqwDo.png" alt="1" /></div><div class="group-image-wrap"><img src="https://i.imgur.com/3C7FkYU.png" alt="2" /></div></div></div><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh"> $ bash l_HPCKit_p_2023.1.0.46346_offline.sh <br>Extract l_HPCKit_p_2023.1.0.46346_offline to /home/wpsze/intel/l_HPCKit_p_2023.1.0.46346_offline...<br>[#####################################################################################################################################################################]<br>Extract l_HPCKit_p_2023.1.0.46346_offline completed!<br>Remove extracted files: /home/wpsze/intel/l_HPCKit_p_2023.1.0.46346_offline...<br></code></pre></td></tr></table></figure><div class="group-image-container"><div class="group-image-row"><div class="group-image-wrap"><img src="https://i.imgur.com/DDb4wOZ.png" alt="1" /></div><div class="group-image-wrap"><img src="https://i.imgur.com/6JzxBe4.png" alt="2" /></div><div class="group-image-wrap"><img src="https://i.imgur.com/i1WGV00.png" alt="3" /></div></div><div class="group-image-row"><div class="group-image-wrap"><img src="https://i.imgur.com/UvVfnH8.png" alt="4" /></div><div class="group-image-wrap"><img src="https://i.imgur.com/EFY2UFk.png" alt="5" /></div><div class="group-image-wrap"><img src="https://i.imgur.com/DfGTm66.png" alt="6" /></div></div><div class="group-image-row"><div class="group-image-wrap"><img src="https://i.imgur.com/j0YSOSe.png" alt="7" /></div></div></div><h3 id="compiler-å°ç…§è¡¨">Compiler å°ç…§è¡¨</h3><ul><li><a href="https://man.twcc.ai/@TWCC-III-manual/SkgZUHhi_">Compiler å°ç…§è¡¨</a></li></ul><table><thead><tr class="header"><th></th><th><strong>GNU</strong></th><th><strong>Intel</strong></th><th><strong>MVAPICH2</strong></th><th><strong>OpenMPI</strong></th><th><strong>IntelMPI</strong></th></tr></thead><tbody><tr class="odd"><td><strong>C</strong></td><td>gcc</td><td>icc/icx</td><td>mpicc</td><td>mpicc</td><td>mpiicc</td></tr><tr class="even"><td><strong>C++</strong></td><td>g++</td><td>icpc/icpx</td><td>mpic++/ mpicxx</td><td>mpiCC/mpic++/mpicxx</td><td>mpiicpc</td></tr><tr class="odd"><td><strong>Fortran</strong></td><td>g77/gfortran</td><td>ifort/ifx</td><td>mpif77/mpif90/mpifort</td><td>mpifort/mpif77/mpif90</td><td>mpiifort</td></tr></tbody></table><h3 id="check">Check</h3><p>In my caes, it is installed in /home/wpsze/intel/oneapi/</p><blockquote><p>remark #10441: The Intel(R) C++ Compiler Classic (ICC) is deprecated and will be removed from product release in the second half of 2023. The Intel(R) oneAPI DPC++/C++ Compiler (ICX) is the recommended compiler moving forward. Please transition to use this compiler. Use '-diag-disable=10441' to disable this message.</p></blockquote><div class="note note-primary">            <p>Intel oneAPI's <code>icc</code> and <code>icpc</code> have been replaced by <code>icx</code>. We do not have <code>icc</code> and <code>icpc</code> installed on our servers, so please use <code>icx</code> for C and C++ compilation. The usage is similar to the original compiler, for example: <code>icx</code> your_code.cpp -o output.</p>          </div><p>ICC (Linux), ICL (Windows) are classic Intel C/C++ Compilers. Whereas, ICX is Intel nextgen compiler based on Clang /LLVM technology plus Intel proprietary optimizations and code generation.</p><ol type="1"><li>You may use ICC for performance on CPU targets.</li><li>ICX enables OpenMP TARGET offload to Intel GPU targets.</li></ol><p>The following are the guiding principles for ICX:</p><blockquote><ol type="1"><li>ICX and ICC Classic use different compiler drivers. The IntelÂ® C++ Compiler Classic compiler drivers are icc, icpc, and icl. â€¯The IntelÂ® oneAPI DPC++/C++ Compiler drivers are icx and icpx. Use icx to compile and link C programs, and icpx for C++ programs.</li></ol></blockquote><blockquote><ol start="2" type="1"><li>Unlike the icc driver, icx does not use the file extension to determine whether to compile as C or C+. Users must invoke icpx to compile C+ files. . In addition to providing a core C++ Compiler, ICX/ICPX is also used to compile SYCL/DPC++ codes for the IntelÂ® oneAPI Data Parallel C++ Compiler when we pass an additional flag â€œ-fsyclâ€.â€¯</li></ol></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">source</span> /home/wpsze/intel/oneapi/setvars.sh intel64<br><br><span class="hljs-built_in">which</span> icc<br><span class="hljs-built_in">which</span> ifort <br><span class="hljs-built_in">which</span> icpc<br>icc --version<br>ifort --version<br>icpc --version<br><span class="hljs-built_in">which</span> icx<br>icx --version<br><span class="hljs-built_in">which</span> icpx<br>icpx --version<br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;======================&quot;</span><br><br><span class="hljs-built_in">which</span> mpiicc<br><span class="hljs-built_in">which</span> mpiicpc<br><span class="hljs-built_in">which</span> mpiifort<br>mpicc -v<br>mpiicpc -v<br>mpiifort -v<br><br><span class="hljs-comment"># print as</span><br><br>:: initializing oneAPI environment ...<br>   test.sh: BASH_VERSION = 4.4.20(1)-release<br>   args: Using <span class="hljs-string">&quot;<span class="hljs-variable">$@</span>&quot;</span> <span class="hljs-keyword">for</span> setvars.sh arguments: <br>:: ccl -- latest<br>:: clck -- latest<br>:: compiler -- latest<br>:: dal -- latest<br>:: debugger -- latest<br>:: dev-utilities -- latest<br>:: dnnl -- latest<br>:: dpcpp-ct -- latest<br>:: dpl -- latest<br>:: inspector -- latest<br>:: ipp -- latest<br>:: ippcp -- latest<br>:: ipp -- latest<br>:: itac -- latest<br>:: mkl -- latest<br>:: mpi -- latest<br>:: tbb -- latest<br>:: oneAPI environment initialized ::<br><br><span class="hljs-comment">#/home/wpsze/intel/oneapi/compiler/2023.1.0/linux/bin/intel64/icc</span><br><span class="hljs-comment">#/home/wpsze/intel/oneapi/compiler/2023.1.0/linux/bin/intel64/ifort</span><br><span class="hljs-comment">#/home/wpsze/intel/oneapi/compiler/2023.1.0/linux/bin/intel64/icpc</span><br><br>$ icc --version<br>icc: remark <span class="hljs-comment">#10441: The Intel(R) C++ Compiler Classic (ICC) is deprecated and will be removed from product release in the second half of 2023. The Intel(R) oneAPI DPC++/C++ Compiler (ICX) is the recommended compiler moving forward. Please transition to use this compiler. Use &#x27;-diag-disable=10441&#x27; to disable this message.</span><br>icc (ICC) 2021.9.0 20230302<br>Copyright (C) 1985-2023 Intel Corporation.  All rights reserved.<br><br>$ ifort --version<br>ifort (IFORT) 2021.9.0 20230302<br>Copyright (C) 1985-2023 Intel Corporation.  All rights reserved.<br><br>$ icpc --version<br>icpc: remark <span class="hljs-comment">#10441: The Intel(R) C++ Compiler Classic (ICC) is deprecated and will be removed from product release in the second half of 2023. The Intel(R) oneAPI DPC++/C++ Compiler (ICX) is the recommended compiler moving forward. Please transition to use this compiler. Use &#x27;-diag-disable=10441&#x27; to disable this message.</span><br>icpc (ICC) 2021.9.0 20230302<br>Copyright (C) 1985-2023 Intel Corporation.  All rights reserved.<br><br>$ <span class="hljs-built_in">which</span> icx<br><span class="hljs-comment"># /home/wpsze/intel/oneapi/compiler/2023.1.0/linux/bin/icx</span><br><br>$ icx --version<br>Intel(R) oneAPI DPC++/C++ Compiler 2023.1.0 (2023.1.0.20230320)<br>Target: x86_64-unknown-linux-gnu<br>Thread model: posix<br>InstalledDir: /home/wpsze/intel/oneapi/compiler/2023.1.0/linux/bin-llvm<br>Configuration file: /home/wpsze/intel/oneapi/compiler/2023.1.0/linux/bin-llvm/../bin/icx.cfg<br><br>$ <span class="hljs-built_in">which</span> icpx<br><span class="hljs-comment"># /home/wpsze/intel/oneapi/compiler/2023.1.0/linux/bin/icpx</span><br><br>$ icpx --version<br>Intel(R) oneAPI DPC++/C++ Compiler 2023.1.0 (2023.1.0.20230320)<br>Target: x86_64-unknown-linux-gnu<br>Thread model: posix<br>InstalledDir: /home/wpsze/intel/oneapi/compiler/2023.1.0/linux/bin-llvm<br>Configuration file: /home/wpsze/intel/oneapi/compiler/2023.1.0/linux/bin-llvm/../bin/icpx.cfg<br><br>======================<br>/home/wpsze/intel/oneapi/mpi/2021.9.0/bin/mpiicc<br>/home/wpsze/intel/oneapi/mpi/2021.9.0/bin/mpiicpc<br>/home/wpsze/intel/oneapi/mpi/2021.9.0/bin/mpiifort<br></code></pre></td></tr></table></figure><p>Remark</p><ol type="1"><li>The icc and icpc commands resemble the GNU equivalents gcc and g++. This is a highly optimizing C (icc) and C++ (icpc) compiler.</li></ol><h2 id="set-environment-variables-for-cli-development">Set Environment Variables for CLI Development</h2><p>Option 1: Source setvars.sh once per session</p><p>Source setvars.sh every time you open a new terminal window:</p><p>You can find the setvars.sh script in the root folder of your oneAPI installation, which is typically /opt/intel/oneapi/ for system wide installation and ~/intel/oneapi/ when installed as a private installation. Note that system wide installation requires root or sudo privileges.</p><p>For system wide installations: <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">source</span> /opt/intel/oneapi/setvars.sh intel64<br></code></pre></td></tr></table></figure></p><p>For private installations: <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">source</span> ~/intel/oneapi/setvars.sh intel64<br></code></pre></td></tr></table></figure></p><h2 id="build-and-run-a-sample-project-using-the-command-line">Build and Run a Sample Project Using the Command Line</h2><p>To compile and run a sample:</p><ol type="1"><li>Download the sample using the oneAPI CLI Samples Browser. (Command line interface (CLI))</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ oneapi-cli <br></code></pre></td></tr></table></figure><ol start="2" type="1"><li>Compile and run the sample with Make*</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ <span class="hljs-built_in">cd</span> /home/wpsze/intel/oneapi/matrix_mul <br>$ make<br>$ sh run.sh<br></code></pre></td></tr></table></figure><p>Output: &gt; start: 23/05/04 10:59:07.161 &gt; &gt; ./matrix_mul_dpc &gt; Device: Intel(R) xxxx(xx) ix-xxxxS CPU @ x.xxGHz &gt; Problem size: c(150,600) = a(150,300) * b(300,600) &gt; Result of matrix multiplication using SYCL: Success - The results are correct! &gt; &gt; end: 23/05/04 10:59:14.409</p><h2 id="compile-wrfv440-with-intel-oneapi">Compile WRFv440 with Intel OneAPI</h2><p>Ref: [WRF installation on a Linux-based machine]</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">source</span> /home/wpsze/intel/oneapi/setvars.sh<br><span class="hljs-built_in">export</span> PATH=/home/wpsze/intel/oneapi/compiler/2023.1.0/linux/bin/intel64/:<span class="hljs-variable">$PATH</span><br><span class="hljs-built_in">export</span> LD_LIBRARY_PATH=/home/wpsze/intel/oneapi/compiler/2023.1.0/linux/lib/intel64/:<span class="hljs-variable">$LD_LIBRARY_PATH</span><br><br>gcc --version<br>gfortran --version<br><br>icx --version<br>ifort --version<br><br><span class="hljs-comment"># Intel (serial or dmpar)</span><br></code></pre></td></tr></table></figure><p>If it is sucessful, the following exe will be gnerated, <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sh">==========================================================================<br>---&gt;                  Executables successfully built                  &lt;---<br> main/ndown.exe<br> main/real.exe<br> main/tc.exe<br> main/wrf.exe<br>==========================================================================<br>wrf_install/WPS-4.4/geogrid.exe -&gt; geogrid/src/geogrid.exe*<br>wrf_install/WPS-4.4/ungrib.exe -&gt; ungrib/src/ungrib.exe*<br>==========================================================================<br></code></pre></td></tr></table></figure></p><h1 id="references">References</h1><ol type="1"><li><a href="https://kb.brightcomputing.com/knowledge-base/how-to-install-intel-oneapi-base-and-hpc-toolkits/#installing-the-intel-oneapi-hpc-toolkit">How to install Intel OneAPI Base and HPC Toolkits</a></li><li><a href="https://blog.qiql.net/archives/intelgcc">Ubuntu20.04 å®‰è£… INTEL ç¼–è¯‘å™¨å’Œ Gcc ç¼–è¯‘å™¨</a><ol type="1"><li>å…ˆå®‰è£…Base Toolkitï¼Œå†å®‰è£… HPC Toolkit</li><li>å®‰è£…gcc5.4ç¼–è¯‘å™¨</li><li>å®‰è£…module</li><li>ç¼–å†™ modulefile</li></ol></li><li><a href="https://cloud.tencent.com/developer/article/2148549">Intel oneAPI toolkits ä»‹ç»å’Œå®‰è£…</a><ol type="1"><li>å¯¹äºæ°”è±¡ä¸­çš„åº”ç”¨ï¼Œä¸»æµæ•°å€¼æ¨¡å¼åŸºæœ¬éƒ½æ˜¯ä»¥Fortranç¼–å†™çš„ï¼Œä¸ºäº†è¿½æ±‚æ›´é«˜çš„è®¡ç®—é€Ÿåº¦ï¼Œæˆ‘ä»¬å°½é‡ä½¿ç”¨çš„intelç¼–è¯‘å™¨</li><li>ifortç¼–è¯‘çš„ç¨‹åºè¿è¡Œé€Ÿåº¦æ¯”gfortranè¦é«˜ä¸€äº›ã€‚å°½ç®¡é«˜çš„ä¸æ˜¯éå¸¸å¤šï¼Œä½†å¯¹äºæ¨¡å¼é•¿æ—¶é—´çš„ç§¯åˆ†ï¼ŒèŠ‚çœçš„æ—¶é—´è¿˜æ˜¯éå¸¸å¯è§‚çš„</li><li>å¯¹äºæˆ‘ä»¬çš„ä½¿ç”¨éœ€æ±‚ï¼Œåªéœ€å®‰è£…IntelÂ® oneAPI Base Toolkit å’Œ IntelÂ® oneAPI HPC Toolkit å°±æ»¡è¶³äº†</li></ol></li><li><a href="https://hpc.lenovo.com/lico/downloads/7.1/Install_Intel_oneAPI.html">Install Intel oneAPI | lenovo</a></li><li><a href="https://www.xiaoledeng.com/2021/07/19/oneapi-resource-install/">oneAPIèµ„æºå’Œå®‰è£…</a></li><li><a href="https://zhuanlan.zhihu.com/p/358928837">Intelå­¦ç”Ÿè®¸å¯è¿‡æœŸåï¼Œå®‰è£… IntelÂ® oneAPI Base Toolkit å’Œ IntelÂ® oneAPI HPCæ¥æ›¿ä»£</a><ol type="1"><li>ä¹‹å‰çš„Intel Parallel Studio XEç”¨é‚®ç®±ç”³è¯·äº†å­¦ç”Ÿè®¸å¯ï¼Œå·²ç»è¿‡æœŸï¼Œå‘ç°ä¸èƒ½å†ç»­æœŸï¼Œå®˜ç½‘ç«Ÿç„¶å‡ºäº†å…è´¹ç‰ˆæœ¬ï¼</li></ol></li><li><a href="https://community.intel.com/t5/Blogs/Tech-Innovation/Tools/A-Historic-Moment-for-The-Intel-Fortran-Compiler-Classic-ifort/post/1614625">A Historic Moment for The IntelÂ® Fortran Compiler Classic (ifort)</a></li></ol><table><thead><tr class="header"><th>oneAPI Package Version</th><th>ifx version</th><th>ifort version</th></tr></thead><tbody><tr class="odd"><td>2024.0.x</td><td>2024.0.x</td><td>2021.11.x</td></tr><tr class="even"><td>2024.1.0</td><td>2024.1.0</td><td>2021.12.0</td></tr><tr class="odd"><td>2024.2.0</td><td>2024.2.0</td><td>2021.13.0</td></tr><tr class="even"><td>2025.0.0 (future)</td><td>2025.0.0</td><td>not included</td></tr></tbody></table>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>HPC</tag>
      
      <tag>WRF</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>WRF | GRIB1, GRIB2, NetCDF</title>
    <link href="/2023/05/06/GRIB1_GRIB2_NetCDF/"/>
    <url>/2023/05/06/GRIB1_GRIB2_NetCDF/</url>
    
    <content type="html"><![CDATA[<h1 id="grib1-grib2-netcdf">GRIB1, GRIB2, NetCDF</h1><p>Ref: <a href="https://rda.ucar.edu/OS/web/datasets/ds083.2/docs/README_Formats.pdf">GRIB1, GRIB2, NetCDF: Which do I choose?</a></p><p>Your choice of data format depends on the date range that you need and what you want to do with the data. GRIB is a World Meteorological Organization (WMO) international standard for exchanging GRidded BInary data.</p><p><strong>GRIB1</strong> is the original format and requires a separate parameter table to unpack the data. <strong>GRIB2</strong> improves upon the standard with file compression and the inclusion of the metadata/parameter table that you need to unpack the data in each file. <strong>GRIB2 exploits the same compression software commonly used for images to gain a roughly 50% reduction in Hile size over GRIB1. </strong></p><p>If you are interested in <strong>2007.12.06</strong> or later, then choose GRIB2 because of its smaller size. For earlier dates, use GRIB1. If you are using software that reads NetCDF but not GRIB, then convert the files to NetCDF *.nc format. Unless you need to use NetCDF tools, use GRIB2 for its efficiency. The WRF mesoscale model can use either GRIB1 or GRIB2. Newer versions of WRF Preprocessing System (WPS) can recognize FNL GRIB1 and GRIB2; WPS will even provide the appropriate parameter table for FNL in GRIB1 format so you do not need to do so manually.</p><p>If you are using the older MM5 mesoscale model, use GRIB1. You can perform many data processing tasks on GRIB files with wgrib (for GRIB1) and wgrib2 (for GRIB2).</p><p>You can process and visualize GRIB Hiles with GRADS, IDL, Panoply, and R (using the rNOMADS package).</p><p>You can use the extensive NetCDF software libraries if you convert the Hiles to NetCDF. However, be mindful that NetCDF Hiles are not as compact as GRIB2, even when compressed.</p>]]></content>
    
    
    <categories>
      
      <category>WRF</category>
      
    </categories>
    
    
    <tags>
      
      <tag>HPC</tag>
      
      <tag>WRF</tag>
      
      <tag>WPS</tag>
      
      <tag>MPAS</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Tmux terminal multiplexer</title>
    <link href="/2023/05/01/Tmux_terminal_multiplexer/"/>
    <url>/2023/05/01/Tmux_terminal_multiplexer/</url>
    
    <content type="html"><![CDATA[<h1 id="tmux-terminal-multiplexer">Tmux terminal multiplexer</h1><p><strong>tmux</strong> is a terminal multiplexer: it enables a number of terminals to be created, accessed, and controlled from a single screen. tmux may be detached from a screen and continue running in the background, then later reattached.</p><p>This release runs on OpenBSD, FreeBSD, NetBSD, Linux, macOS and Solaris.</p><p><a href="https://github.com/tmux/tmux">Git tmux</a></p><h2 id="dependencies">Dependencies</h2><ul><li>tmux depends on <strong>libevent 2.x</strong>, available from <a href="https://github.com/libevent/libevent/releases/latest">this page</a>.</li><li>It also depends on <strong>ncurses</strong>, available from <a href="https://invisible-mirror.net/archives/ncurses/">this page</a>. To build tmux, a C compiler (for example gcc or clang), make, pkg-config and a suitable yacc (yacc or bison) are needed.</li></ul><h2 id="installation">Installation</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">git <span class="hljs-built_in">clone</span> https://github.com/tmux/tmux.git<br><span class="hljs-built_in">cd</span> tmux<br>sh autogen.sh<br>./configure &amp;&amp; make<br></code></pre></td></tr></table></figure><h2 id="edit-.tmux.conf">Edit .tmux.conf</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># prefix setting (screen-like)</span><br><span class="hljs-built_in">set</span> -g prefix C-a<br>unbind C-b<br><span class="hljs-built_in">bind</span> C-a send-prefix<br><br><span class="hljs-comment"># Use the mouse</span><br><span class="hljs-built_in">set</span> -g mouse on<br><br><span class="hljs-built_in">bind</span> | split-window -h<br><span class="hljs-built_in">bind</span> - split-window -v<br><br><span class="hljs-comment"># History-limit</span><br><span class="hljs-built_in">set</span> -g history-limit 30000<br><br><span class="hljs-built_in">bind</span> -r ^Up select-pane -U<br><span class="hljs-built_in">bind</span> -r ^Down select-pane -D<br><span class="hljs-built_in">bind</span> -r ^Left select-pane -L<br><span class="hljs-built_in">bind</span> -r ^Right select-pane -R<br><br><span class="hljs-built_in">set</span> -g default-terminal <span class="hljs-string">&quot;xterm-256color&quot;</span><br></code></pre></td></tr></table></figure><h2 id="usage">Usage</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># Add new seession</span><br>tmux new -s &lt;session-name&gt;<br><br><span class="hljs-comment"># Detach</span><br>tmux detach<br><br><span class="hljs-comment"># List all sessions</span><br>tmux <span class="hljs-built_in">ls</span><br><br><span class="hljs-comment"># Attach a session</span><br>tmux a -t &lt;session-name&gt;<br><br><span class="hljs-comment"># rename session, </span><br>tmux rename-session -t &lt;old-session-name&gt; &lt;new-session-name&gt;<br><br><span class="hljs-comment"># Reload the current Tmux configuration</span><br>tmux source-file ~/.tmux.conf<br></code></pre></td></tr></table></figure><p>Actions <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># Move bewteen panes</span><br>C trl + A (up,down,lef,right)<br><br><span class="hljs-comment"># the window into two panes horizontally.</span><br>Ctrl + A â€”<br><br><span class="hljs-comment"># Split the window into two panes vertically.</span><br>Ctrl + A |<br><br><span class="hljs-comment"># Ctrl+B X â€” Close pane.</span><br>Ctrl + A X<br></code></pre></td></tr></table></figure></p>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>HPC</tag>
      
      <tag>terminal</tag>
      
      <tag>tmux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>WRF | WPS build up domain</title>
    <link href="/2023/05/01/WPS_build_up_domain/"/>
    <url>/2023/05/01/WPS_build_up_domain/</url>
    
    <content type="html"><![CDATA[<h1 id="wps-build-up-domain">WPS build up domain</h1><p><a href="https://www2.mmm.ucar.edu/wrf/users/special_code.html">WRF-Related Special Code</a></p><table><thead><tr class="header"><th style="text-align: left;">Function</th><th style="text-align: left;">source</th></tr></thead><tbody><tr class="odd"><td style="text-align: left;">Convert netCDF to Intermediate</td><td style="text-align: left;"><a href="https://www2.mmm.ucar.edu/wrf/src/netcdf-to-intermediate.f">netcdf-to-intermediate.f</a></td></tr><tr class="even"><td style="text-align: left;">NCL Design Grids</td><td style="text-align: left;"><a href="https://www2.mmm.ucar.edu/wrf/src/design_grids.ncl">design_grids.ncl</a></td></tr><tr class="odd"><td style="text-align: left;">Convert netCDF to Intermediate (CCSM Data)</td><td style="text-align: left;"><a href="https://www2.mmm.ucar.edu/wrf/src/ccsm2IM.tar.gz">tar file</a></td></tr><tr class="even"><td style="text-align: left;">wrf2grads</td><td style="text-align: left;"><a href="https://www2.mmm.ucar.edu/wrf/src/wrf2grads.tar.gz">csh script</a></td></tr><tr class="odd"><td style="text-align: left;">Hurricane Dorian Test Case</td><td style="text-align: left;"><a href="https://www2.mmm.ucar.edu/wrf/src/dorian_test_case.tar.gz">dorian_test_case.tar.gz</a></td></tr></tbody></table><p>The most useful here is <strong>design_grids.ncl</strong></p><blockquote><p>You provide lat/lon/dx/dy and then it will generate WPS domain config.</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/bash</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># https://www2.mmm.ucar.edu/wrf/users/tutorial/presentation_pdfs/202101/werner_data_util_pp.pdf P.19</span><br><span class="hljs-comment"># https://www2.mmm.ucar.edu/wrf/users/special_code.html</span><br><span class="hljs-comment">#</span><br><br><span class="hljs-built_in">source</span> /home/wpsze/anaconda3/bin/activate ncl<br>ncl design_grids.ncl<br><br></code></pre></td></tr></table></figure><p>and design_grids.ncl is like as below,</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br></pre></td><td class="code"><pre><code class="hljs sh">;   Script display location of model domains<br>;   Only works <span class="hljs-keyword">for</span> ARW domains<br>;   Reads namelist file directly<br><br>load <span class="hljs-string">&quot;<span class="hljs-variable">$NCARG_ROOT</span>/lib/ncarg/nclscripts/csm/gsn_code.ncl&quot;</span><br>load <span class="hljs-string">&quot;<span class="hljs-variable">$NCARG_ROOT</span>/lib/ncarg/nclscripts/wrf/WRFUserARW.ncl&quot;</span><br>;load <span class="hljs-string">&quot;./WRFUserARW.ncl&quot;</span><br><br>begin<br>;<br><br>; We generate plots, but what kind <span class="hljs-keyword">do</span> we prefer?<br>; <span class="hljs-built_in">type</span> = <span class="hljs-string">&quot;x11&quot;</span><br>; <span class="hljs-built_in">type</span> = <span class="hljs-string">&quot;pdf&quot;</span><br>; <span class="hljs-built_in">type</span> = <span class="hljs-string">&quot;ps&quot;</span><br>; <span class="hljs-built_in">type</span> = <span class="hljs-string">&quot;ncgm&quot;</span><br>  <span class="hljs-built_in">type</span> = <span class="hljs-string">&quot;png&quot;</span><br>  wks = gsn_open_wks(<span class="hljs-built_in">type</span>,<span class="hljs-string">&quot;wps_show_dom&quot;</span>)<br><br>; Set the colors to be used<br>  colors = (/<span class="hljs-string">&quot;white&quot;</span>,<span class="hljs-string">&quot;black&quot;</span>,<span class="hljs-string">&quot;White&quot;</span>,<span class="hljs-string">&quot;ForestGreen&quot;</span>,<span class="hljs-string">&quot;DeepSkyBlue&quot;</span>,<span class="hljs-string">&quot;Red&quot;</span>,<span class="hljs-string">&quot;Blue&quot;</span>/)<br>  gsn_define_colormap(wks, colors)  <br><br><br>; Set some map information ; line and text information<br>  mpres = True<br>  mpres@mpFillOn = True<br>  mpres@mpFillColors  = (/<span class="hljs-string">&quot;background&quot;</span>,<span class="hljs-string">&quot;DeepSkyBlue&quot;</span>,<span class="hljs-string">&quot;ForestGreen&quot;</span>,<span class="hljs-string">&quot;DeepSkyBlue&quot;</span>, <span class="hljs-string">&quot;transparent&quot;</span>/)<br>  mpres@mpGeophysicalLineColor      = <span class="hljs-string">&quot;Black&quot;</span><br>  mpres@mpGridLineColor             = <span class="hljs-string">&quot;Black&quot;</span><br>  mpres@mpLimbLineColor             = <span class="hljs-string">&quot;Black&quot;</span><br>  mpres@mpNationalLineColor         = <span class="hljs-string">&quot;Black&quot;</span><br>  mpres@mpPerimLineColor            = <span class="hljs-string">&quot;Black&quot;</span><br>  mpres@mpUSStateLineColor          = <span class="hljs-string">&quot;Black&quot;</span><br>  mpres@mpGridSpacingF              = 1<br>  mpres@tiMainString                = <span class="hljs-string">&quot; WPS Domain Configuration  &quot;</span><br><br>  lnres = True <br>  lnres@gsLineThicknessF = 2.5<br>  lnres@domLineColors    = (/ <span class="hljs-string">&quot;white&quot;</span>, <span class="hljs-string">&quot;Red&quot;</span> , <span class="hljs-string">&quot;Red&quot;</span> , <span class="hljs-string">&quot;Blue&quot;</span> /)<br><br>  txres = True<br>  txres@txFont = <span class="hljs-string">&quot;helvetica-bold&quot;</span><br>  ;txres@txJust = <span class="hljs-string">&quot;BottomLeft&quot;</span><br>  txres@txJust = <span class="hljs-string">&quot;TopLeft&quot;</span><br>  txres@txPerimOn = False<br>  txres@txFontHeightF = 0.015<br><br>;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;<br>DOMS = 3<br>DX = 50.<br><br>MAP = <span class="hljs-string">&quot;lambert&quot;</span><br><br>;MAP = <span class="hljs-string">&quot;mercator&quot;</span><br><br>;LAT1 = (/ -47., -39., -27. /); original lambert grids<br>;LAT2 = (/ -10., -18., -23. /)<br>;LON1 = (/ 113., 119., 126. /)<br>;LON2 = (/ 164., 157., 132. /)<br><br>LAT1 = (/ 2.23, 19.94, 21.5 /); modified mercator grids<br>LAT2 = (/ 43.82, 27.09, 23.83 /)<br>LON1 = (/ 85.81, 110.68, 112.51/)<br>LON2 = (/ 140.05, 117.60, 115.04/)<br><br>;LAT1 = (/ -35.0, -45., -27. /); Yasi Domains<br>;LAT2 = (/   0., -20., -23. /)<br>;LON1 = (/ 131., 121., 125./)<br>;LON2 = (/ 171., 159., 131./)<br>;LAT1 = (/ -43.0, -45., -27. /); Yasi Domains<br>;LAT2 = (/   5., -20., -23. /)<br>;LON1 = (/  95., 121., 125./)<br>;LON2 = (/ 179., 159., 131./)<br>parent_id = (/ 1, 1, 2 /)<br>parent_grid_ratio = (/ 1, 3, 3 /)<br><br>std_truelats = False<br><br>;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;<br>; Do not change anything between the <span class="hljs-string">&quot;;;;;;&quot;</span> lines<br><br>  mpres@max_dom   = DOMS<br>  mpres@map_proj  = MAP<br>  mpres@dx        = DX*1000.<br>  mpres@dy        = DX*1000.<br>  mpres@ref_lat   = LAT1(0) + (LAT2(0)-LAT1(0))/2.<br>  mpres@ref_lon   = LON1(0) + (LON2(0)-LON1(0))/2.<br>  mpres@stand_lon = mpres@ref_lon<br>  <br>  <span class="hljs-keyword">if</span> (MAP .eq. <span class="hljs-string">&quot;lambert&quot;</span>) <span class="hljs-keyword">then</span><br>    <span class="hljs-keyword">if</span> ( std_truelats ) <span class="hljs-keyword">then</span><br>      <span class="hljs-keyword">if</span> (LAT1(0) .gt. 0.) <span class="hljs-keyword">then</span><br>        mpres@truelat1 = 30.<br>        mpres@truelat2 = 60.<br>      <span class="hljs-keyword">else</span><br>        mpres@truelat1 = -30.<br>        mpres@truelat2 = -60.<br>      end <span class="hljs-keyword">if</span><br>    <span class="hljs-keyword">else</span><br>      truelat1 = floattoint(LAT1(0) + (LAT2(0)-LAT1(0))/3)<br>      truelat2 = floattoint(truelat1 + (LAT2(0)-LAT1(0))/3)<br>      mpres@truelat1 = int2flt(truelat1)<br>      mpres@truelat2 = int2flt(truelat2)<br>    end <span class="hljs-keyword">if</span><br>  end <span class="hljs-keyword">if</span><br>  <span class="hljs-keyword">if</span> (MAP .eq. <span class="hljs-string">&quot;mercator&quot;</span>) <span class="hljs-keyword">then</span><br>    mpres@truelat2 = 0.<br>    <span class="hljs-keyword">if</span> ( std_truelats ) <span class="hljs-keyword">then</span><br>      mpres@truelat1 = 0.<br>    <span class="hljs-keyword">else</span><br>      truelat1 = floattoint(mpres@ref_lat)<br>      mpres@truelat1 = int2flt(truelat1)<br>    end <span class="hljs-keyword">if</span><br>  end <span class="hljs-keyword">if</span><br><br>  e_we = new ( DOMS, <span class="hljs-built_in">integer</span> ) <br>  e_sn = new ( DOMS, <span class="hljs-built_in">integer</span> ) <br>  e_we(0) = floattoint((LON2(<span class="hljs-number">0</span>)-LON1(<span class="hljs-number">0</span>))*111./DX)<br>  e_sn(0) = floattoint((LAT2(<span class="hljs-number">0</span>)-LAT1(<span class="hljs-number">0</span>))*111./DX)<br>  centeri = e_we(0)/2 + 1<br>  centerj = e_sn(0)/2 + 1<br><br>  i_parent_start = new ( DOMS, <span class="hljs-built_in">integer</span> ) <br>  j_parent_start = new ( DOMS, <span class="hljs-built_in">integer</span> ) <br>  i_parent_start(0) = 1<br>  j_parent_start(0) = 1<br><br>  ;<span class="hljs-built_in">print</span>(mpres)<br>  ;<span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Number of grid points &quot;</span> + e_we(0) + <span class="hljs-string">&quot; &quot;</span> + e_sn(0) )<br><br><br>  <span class="hljs-keyword">if</span> ( DOMS .gt. 1 ) <span class="hljs-keyword">then</span><br><br>    mpres@parent_id         = parent_id<br>    mpres@parent_grid_ratio = parent_grid_ratio<br><br>    res = True<br>    <span class="hljs-keyword">if</span> (MAP .eq. <span class="hljs-string">&quot;lambert&quot;</span>) <span class="hljs-keyword">then</span><br>      res@MAP_PROJ  = 1<br>    end <span class="hljs-keyword">if</span><br>    <span class="hljs-keyword">if</span> (MAP .eq. <span class="hljs-string">&quot;mercator&quot;</span>) <span class="hljs-keyword">then</span><br>      res@MAP_PROJ  = 3<br>    end <span class="hljs-keyword">if</span><br>    res@TRUELAT1  = mpres@truelat1<br>    res@TRUELAT2  = mpres@truelat2<br>    res@STAND_LON = mpres@stand_lon<br>    res@DX        = mpres@dx<br>    res@DY        = mpres@dy<br>    res@REF_LAT   = mpres@ref_lat<br>    res@REF_LON   = mpres@ref_lon<br>    res@KNOWNI    = centeri<br>    res@KNOWNJ    = centerj<br><br>    ratio = 1<br>    ratio_start = 1<br>    istart = 1<br>    jstart = 1<br>    <span class="hljs-keyword">do</span> ii=1,DOMS-1<br>      ratio = ratio * parent_grid_ratio(ii)<br>      loc = wrf_ll_to_ij (LON1(ii),LAT1(ii),res)<br>      loci1 = new(dimsizes(loc),<span class="hljs-built_in">integer</span>)<br>      loci1 = tointeger(loc + .5)<br>      loci1!0 = loc!0<br>      ;<span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;DOM=&quot;</span>+ii + <span class="hljs-string">&quot;  start &quot;</span> + loci1)<br>      loc = wrf_ll_to_ij (LON2(ii),LAT2(ii),res)<br>      loci2 = new(dimsizes(loc),<span class="hljs-built_in">integer</span>)<br>      loci2 = tointeger(loc + .5)<br>      loci2!0 = loc!0<br>      ;<span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;DOM=&quot;</span>+ii + <span class="hljs-string">&quot;    end &quot;</span> + loci2)<br>      e_we(ii) = (loci2(0)-loci1(0))*ratio + 1<br>      e_sn(ii) = (loci2(1)-loci1(1))*ratio + 1<br>      istart = (loci1(0) - istart + 1)*ratio_start<br>      jstart = (loci1(1) - jstart + 1)*ratio_start<br>      i_parent_start(ii) = istart<br>      j_parent_start(ii) = jstart<br>      ;<span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Number of grid points &quot;</span> + e_we(ii) + <span class="hljs-string">&quot; &quot;</span> + e_sn(ii) )<br>      ;<span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Start locations &quot;</span> + istart + <span class="hljs-string">&quot; &quot;</span> + jstart)<br>      ratio_start = ratio<br>    end <span class="hljs-keyword">do</span><br>   <br>  end <span class="hljs-keyword">if</span><br><br>  <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Suggested namelist options&quot;</span>)<br>  xxx = <span class="hljs-string">&quot;parent_id =&quot;</span><br>  <span class="hljs-keyword">do</span> ii=0,DOMS-1<br>    xxx = xxx + <span class="hljs-string">&quot; &quot;</span> + parent_id(ii) + <span class="hljs-string">&quot;,&quot;</span><br>  end <span class="hljs-keyword">do</span><br>  <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot; &quot;</span> + xxx)<br>  xxx = <span class="hljs-string">&quot;parent_grid_ratio =&quot;</span><br>  <span class="hljs-keyword">do</span> ii=0,DOMS-1<br>    xxx = xxx + <span class="hljs-string">&quot; &quot;</span> + parent_grid_ratio(ii) + <span class="hljs-string">&quot;,&quot;</span><br>  end <span class="hljs-keyword">do</span><br>  <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot; &quot;</span> + xxx)<br>  xxx = <span class="hljs-string">&quot;i_parent_start =&quot;</span><br>  <span class="hljs-keyword">do</span> ii=0,DOMS-1<br>    xxx = xxx + <span class="hljs-string">&quot; &quot;</span> + i_parent_start(ii) + <span class="hljs-string">&quot;,&quot;</span><br>  end <span class="hljs-keyword">do</span><br>  <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot; &quot;</span> + xxx)<br>  xxx = <span class="hljs-string">&quot;j_parent_start =&quot;</span><br>  <span class="hljs-keyword">do</span> ii=0,DOMS-1<br>    xxx = xxx + <span class="hljs-string">&quot; &quot;</span> + j_parent_start(ii) + <span class="hljs-string">&quot;,&quot;</span><br>  end <span class="hljs-keyword">do</span><br>  <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot; &quot;</span> + xxx)<br>  xxx = <span class="hljs-string">&quot;e_we =&quot;</span><br>  <span class="hljs-keyword">do</span> ii=0,DOMS-1<br>    xxx = xxx + <span class="hljs-string">&quot; &quot;</span> + e_we(ii) + <span class="hljs-string">&quot;,&quot;</span><br>  end <span class="hljs-keyword">do</span><br>  <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot; &quot;</span> + xxx)<br>  xxx = <span class="hljs-string">&quot;e_sn =&quot;</span><br>  <span class="hljs-keyword">do</span> ii=0,DOMS-1<br>    xxx = xxx + <span class="hljs-string">&quot; &quot;</span> + e_sn(ii) + <span class="hljs-string">&quot;,&quot;</span><br>  end <span class="hljs-keyword">do</span><br>  <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot; &quot;</span> + xxx)<br>  <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot; dx = &quot;</span> + mpres@dx + <span class="hljs-string">&quot;,&quot;</span>)<br>  <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot; dy = &quot;</span> + mpres@dy + <span class="hljs-string">&quot;,&quot;</span>)<br>  <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot; map_proj = &#x27;&quot;</span> + mpres@map_proj + <span class="hljs-string">&quot;&#x27;,&quot;</span>)<br>  <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot; ref_lat = &quot;</span> + sprintf(<span class="hljs-string">&quot;%7.2f&quot;</span>,mpres@ref_lat) + <span class="hljs-string">&quot;,&quot;</span>)<br>  <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot; ref_lon = &quot;</span> + sprintf(<span class="hljs-string">&quot;%7.2f&quot;</span>,mpres@ref_lon) + <span class="hljs-string">&quot;,&quot;</span>)<br>  <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot; truelat1 = &quot;</span> + sprintf(<span class="hljs-string">&quot;%7.2f&quot;</span>,mpres@truelat1) + <span class="hljs-string">&quot;,&quot;</span>)<br>  <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot; truelat2 = &quot;</span> + sprintf(<span class="hljs-string">&quot;%7.2f&quot;</span>,mpres@truelat2) + <span class="hljs-string">&quot;,&quot;</span>)<br>  <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot; stand_lon = &quot;</span> + sprintf(<span class="hljs-string">&quot;%7.2f&quot;</span>,mpres@stand_lon) + <span class="hljs-string">&quot;,&quot;</span>)<br>  <br>  mpres@e_we = e_we<br>  mpres@e_sn = e_sn<br>  mpres@i_parent_start = i_parent_start<br>  mpres@j_parent_start = j_parent_start<br><br>  mp = wrf_wps_dom (wks,mpres,lnres,txres)<br>  pmres = True<br>  pmres@gsMarkerColor = <span class="hljs-string">&quot;White&quot;</span><br>  pmres@gsMarkerIndex = 16<br>  pmres@gsMarkerSizeF = 0.01<br>  gsn_polymarker(wks,mp,128.00,-25.00,pmres)<br>  frame(wks)   <br><br>;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;<br><br><br><br>end<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>WRF</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NWP</tag>
      
      <tag>WRF</tag>
      
      <tag>WPS</tag>
      
      <tag>domain</tag>
      
      <tag>ncl</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Bash &amp; Oh-My-Bash</title>
    <link href="/2023/05/01/bash_oh_my_bash/"/>
    <url>/2023/05/01/bash_oh_my_bash/</url>
    
    <content type="html"><![CDATA[<h1 id="bash-oh-my-bash">Bash &amp; Oh-My-Bash</h1><p>Ref:</p><ol type="1"><li><a href="https://www.cnblogs.com/nbtech/p/oh-my-bash.html">é…ç½®å®‰è£…oh-my-bash</a></li><li><a href="https://github.com/ohmybash/oh-my-bash" class="uri">https://github.com/ohmybash/oh-my-bash</a></li><li><a href="https://github.com/ohmybash/oh-my-bash/tree/master/plugins">plugins</a></li><li><a href="https://github.com/ohmybash/oh-my-bash/wiki/Themes">Themes</a></li></ol><p><em>Oh My Bash</em> works best on macOS and Linux.</p><blockquote><p>Unix-like operating system (macOS or Linux)<br />curl or wget should be installed<br />git should be installed</p></blockquote><h2 id="check-shell-used">Check $SHELL used</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cat</span> /etc/shells<br><span class="hljs-comment">## /etc/shells: valid login shells</span><br><span class="hljs-comment"># /bin/sh</span><br><span class="hljs-comment"># /bin/bash</span><br><span class="hljs-comment"># /bin/rbash</span><br><span class="hljs-comment"># /bin/dash</span><br><span class="hljs-comment"># /bin/csh</span><br><span class="hljs-comment"># /bin/zsh</span><br><span class="hljs-comment"># /usr/bin/zsh</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$SHELL</span><br><span class="hljs-comment"># /bin/bash</span><br></code></pre></td></tr></table></figure><p>To change your shell.</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">chsh -s /bin/bash <span class="hljs-comment">## change to bash ##</span><br><span class="hljs-comment"># or</span><br><span class="hljs-built_in">exec</span> bash <span class="hljs-comment"># zsh</span><br></code></pre></td></tr></table></figure><h2 id="installation">Installation</h2><p>On the HOME dir, like /home/wpsze/</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">git <span class="hljs-built_in">clone</span> https://github.com/ohmybash/oh-my-bash.git<br><span class="hljs-built_in">mv</span> oh-my-bash-master .oh-my-bash<br><span class="hljs-built_in">cd</span> .oh-my-bash/<br><span class="hljs-built_in">chmod</span> +x oh-my-bash.sh<br></code></pre></td></tr></table></figure><p>Backup our .bashrc first, <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cp</span> ~/.bashrc ~/.bashrc.bak<br></code></pre></td></tr></table></figure></p><p>copy the oh-my-bash to .bashrc <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cp</span> ~/.oh-my-bash/templates/bashrc.osh-template ~/.bashrc<br></code></pre></td></tr></table></figure></p><p>source it, <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">source</span> ~/.bashrc<br></code></pre></td></tr></table></figure></p><p>The installation and use of oh-my-bash is very simple, and the use of oh-my-bash is similar to that of oh-my-zsh. There are functions such as auto-completion (ignoring case), history, and quick cd.</p><h2 id="theme">Theme</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">ls</span> .oh-my-bash/themes/<br>vim ~/.bashrc<br><span class="hljs-comment">#</span><br><span class="hljs-comment"># OSH_THEME=&quot;font&quot;</span><br><span class="hljs-comment"># or</span><br>OSH_THEME=<span class="hljs-string">&quot;simple&quot;</span><br></code></pre></td></tr></table></figure><p>and change theme like /home/wpsze/.oh-my-bash/themes/font/font.theme.sh <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">CLOCK_THEME_PROMPT_PREFIX=<span class="hljs-string">&#x27;[&#x27;</span><br>CLOCK_THEME_PROMPT_SUFFIX=<span class="hljs-string">&#x27;]&#x27;</span><br><br><span class="hljs-built_in">local</span> hostname=<span class="hljs-string">&quot;<span class="hljs-variable">$&#123;_omb_prompt_bold_green&#125;</span>\u@\h&quot;</span><br></code></pre></td></tr></table></figure></p><h2 id="absolute-path">absolute path</h2><p>How can I display the absolute path in bash prompt? <a href="https://superuser.com/questions/202212/how-can-i-display-the-absolute-path-in-bash-prompt" class="uri">https://superuser.com/questions/202212/how-can-i-display-the-absolute-path-in-bash-prompt</a></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># PS1=&#x27;\u@\h:\w\$ &#x27;</span><br><span class="hljs-comment"># Replace the &quot;\w&quot; with &quot;\$PWD&quot;</span><br><span class="hljs-comment"># PS1=[\u@\h ]\$PWD$</span><br>PS1=<span class="hljs-string">&quot;<span class="hljs-subst">$(clock_prompt)</span>$python_venv<span class="hljs-variable">$&#123;hostname&#125;</span>:<span class="hljs-variable">$&#123;_omb_prompt_bold_teal&#125;</span>\$&#123;PWD&#125; <span class="hljs-subst">$(scm_prompt_char_info)</span><span class="hljs-variable">$&#123;ret_status&#125;</span>$ <span class="hljs-variable">$&#123;_omb_prompt_normal&#125;</span>&quot;</span><br></code></pre></td></tr></table></figure><p>The key here is <strong>* gives the full path while </strong>* gives only the directory.</p><h2 id="conda-initialize">conda initialize</h2><p>Add the following into .bashrc</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># &gt;&gt;&gt; conda initialize &gt;&gt;&gt;</span><br><span class="hljs-comment"># !! Contents within this block are managed by &#x27;conda init&#x27; !!</span><br>__conda_setup=<span class="hljs-string">&quot;<span class="hljs-subst">$(&#x27;/home/wpsze/anaconda3/bin/conda&#x27; &#x27;shell.bash&#x27; &#x27;hook&#x27; 2&gt; /dev/null)</span>&quot;</span><br><span class="hljs-keyword">if</span> [ $? -eq 0 ]; <span class="hljs-keyword">then</span><br>    <span class="hljs-built_in">eval</span> <span class="hljs-string">&quot;<span class="hljs-variable">$__conda_setup</span>&quot;</span><br><span class="hljs-keyword">else</span><br>    <span class="hljs-keyword">if</span> [ -f <span class="hljs-string">&quot;/home/wpsze/anaconda3/etc/profile.d/conda.sh&quot;</span> ]; <span class="hljs-keyword">then</span><br>        . <span class="hljs-string">&quot;/home/wpsze/anaconda3/etc/profile.d/conda.sh&quot;</span><br>    <span class="hljs-keyword">else</span><br>        <span class="hljs-built_in">export</span> PATH=<span class="hljs-string">&quot;/home/wpsze/anaconda3/bin:<span class="hljs-variable">$PATH</span>&quot;</span><br>    <span class="hljs-keyword">fi</span><br><span class="hljs-keyword">fi</span><br><span class="hljs-built_in">unset</span> __conda_setup<br><span class="hljs-comment"># &lt;&lt;&lt; conda initialize &lt;&lt;&lt;</span><br></code></pre></td></tr></table></figure><h2 id="history-of-most-recent-directories">History of most recent directories</h2><p>Looks like a history of most recent directories you've been in. <strong>which d</strong> identifies it as an alias to <strong>dirs</strong> shell builtin, which prints the contents of the directory stack. Just tried it and number keys allow to move to respective directory.</p><p><strong>dirs</strong> command shell builtin is used to display the list of currently remembered directories. By default, it includes the directory you are currently in. A directory can get into the list via pushd command followed by the dir name and can be removed via popd command.</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ <span class="hljs-built_in">dirs</span> -v | <span class="hljs-built_in">head</span> -n 10<br><span class="hljs-comment"># 0 ~</span><br><span class="hljs-comment"># 1 ~/.oh-my-bash/themes/font</span><br><span class="hljs-comment"># 2 ~/.oh-my-bash/themes</span><br><span class="hljs-comment"># ...</span><br><br><span class="hljs-comment">## Select number above will jump to that direcotry</span><br>$ 1<br>.oh-my-bash/themes/font $ <br></code></pre></td></tr></table></figure><h3 id="add-it-to-.bashrc">add it to .bashrc</h3><p>refer to <a href="https://github.com/ohmyzsh/ohmyzsh/blob/master/lib/directories.zsh">zsh directories.zsh</a> here dl() function name can be defined by yourself. <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">dl</span></span>() &#123;<br>    <span class="hljs-built_in">dirs</span> -v | <span class="hljs-built_in">head</span> -n 10<br>&#125;<br></code></pre></td></tr></table></figure> Remark: In .oh-my-bash/lib/directories.sh New package may be false on this function as <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">OMB_DIRECTORIES_CD_USE_PUSHD=<span class="hljs-literal">true</span> <span class="hljs-comment">#false</span><br></code></pre></td></tr></table></figure> Set as <strong>ture</strong></p><h4 id="if-it-is-clients-node-and-dont-want-to-modify-the-terminal-config-then-just-add-a-function-on-.bashrc">If it is client's node and don't want to modify the terminal config, then just add a function on .bashrc,</h4><ul><li><a href="https://waipangsze.github.io/2024/10/15/Linux-terminal/" class="uri">https://waipangsze.github.io/2024/10/15/Linux-terminal/</a></li></ul><h2 id="autojump---a-faster-way-to-navigate-your-filesystem">autojump - a faster way to navigate your filesystem</h2><p><a href="https://github.com/wting/autojump">Git autojump</a></p><h2 id="ble.sh-bash-line-editor">ble.sh â€• Bash Line Editor</h2><h3 id="autosuggestions">autosuggestions</h3><p><a href="https://github.com/akinomyoga/ble.sh">Git ble.sh</a></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># TRIAL without installation</span><br><br>wget -O - https://github.com/akinomyoga/ble.sh/releases/download/nightly/ble-nightly.tar.xz | tar xJf -<br><span class="hljs-built_in">source</span> ble-nightly/ble.sh<br><br><span class="hljs-comment"># Quick INSTALL to BASHRC (If this doesn&#x27;t work, please follow Sec 1.3)</span><br><br>wget -O - https://github.com/akinomyoga/ble.sh/releases/download/nightly/ble-nightly.tar.xz | tar xJf -<br><span class="hljs-built_in">mkdir</span> -p ~/.local/share/blesh<br><span class="hljs-built_in">cp</span> -Rf ble-nightly/* ~/.local/share/blesh/<br><span class="hljs-built_in">rm</span> -rf ble-nightly<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;source ~/.local/share/blesh/ble.sh&#x27;</span> &gt;&gt; ~/.bashrc<br></code></pre></td></tr></table></figure><h2 id="whole-.bashrc">Whole .bashrc</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># Enable the subsequent settings only in interactive sessions</span><br><span class="hljs-keyword">case</span> $- <span class="hljs-keyword">in</span><br>  *i*) ;;<br>    *) <span class="hljs-built_in">return</span>;;<br><span class="hljs-keyword">esac</span><br><br><span class="hljs-comment"># Path to your oh-my-bash installation.</span><br><span class="hljs-built_in">export</span> OSH=~/.oh-my-bash<br><br><span class="hljs-comment"># Set name of the theme to load. Optionally, if you set this to &quot;random&quot;</span><br><span class="hljs-comment"># it&#x27;ll load a random theme each time that oh-my-bash is loaded.</span><br>OSH_THEME=<span class="hljs-string">&quot;font&quot;</span><br><br><span class="hljs-comment"># Uncomment the following line to use case-sensitive completion.</span><br><span class="hljs-comment"># OMB_CASE_SENSITIVE=&quot;true&quot;</span><br><br><span class="hljs-comment"># Uncomment the following line to use hyphen-insensitive completion. Case</span><br><span class="hljs-comment"># sensitive completion must be off. _ and - will be interchangeable.</span><br><span class="hljs-comment"># OMB_HYPHEN_SENSITIVE=&quot;false&quot;</span><br><br><span class="hljs-comment"># Uncomment the following line to disable bi-weekly auto-update checks.</span><br><span class="hljs-comment"># DISABLE_AUTO_UPDATE=&quot;true&quot;</span><br><br><span class="hljs-comment"># Uncomment the following line to change how often to auto-update (in days).</span><br><span class="hljs-comment"># export UPDATE_OSH_DAYS=13</span><br><br><span class="hljs-comment"># Uncomment the following line to disable colors in ls.</span><br><span class="hljs-comment"># DISABLE_LS_COLORS=&quot;true&quot;</span><br><br><span class="hljs-comment"># Uncomment the following line to disable auto-setting terminal title.</span><br><span class="hljs-comment"># DISABLE_AUTO_TITLE=&quot;true&quot;</span><br><br><span class="hljs-comment"># Uncomment the following line to enable command auto-correction.</span><br><span class="hljs-comment"># ENABLE_CORRECTION=&quot;true&quot;</span><br><br><span class="hljs-comment"># Uncomment the following line to display red dots whilst waiting for completion.</span><br><span class="hljs-comment"># COMPLETION_WAITING_DOTS=&quot;true&quot;</span><br><br><span class="hljs-comment"># Uncomment the following line if you want to disable marking untracked files</span><br><span class="hljs-comment"># under VCS as dirty. This makes repository status check for large repositories</span><br><span class="hljs-comment"># much, much faster.</span><br><span class="hljs-comment"># DISABLE_UNTRACKED_FILES_DIRTY=&quot;true&quot;</span><br><br><span class="hljs-comment"># Uncomment the following line if you want to change the command execution time</span><br><span class="hljs-comment"># stamp shown in the history command output.  One of the following values can</span><br><span class="hljs-comment"># be used to specify the timestamp format.</span><br><span class="hljs-comment"># * &#x27;mm/dd/yyyy&#x27;     # mm/dd/yyyy + time</span><br><span class="hljs-comment"># * &#x27;dd.mm.yyyy&#x27;     # dd.mm.yyyy + time</span><br><span class="hljs-comment"># * &#x27;yyyy-mm-dd&#x27;     # yyyy-mm-dd + time</span><br><span class="hljs-comment"># * &#x27;[mm/dd/yyyy]&#x27;   # [mm/dd/yyyy] + [time] with colors</span><br><span class="hljs-comment"># * &#x27;[dd.mm.yyyy]&#x27;   # [dd.mm.yyyy] + [time] with colors</span><br><span class="hljs-comment"># * &#x27;[yyyy-mm-dd]&#x27;   # [yyyy-mm-dd] + [time] with colors</span><br><span class="hljs-comment"># If not set, the default value is &#x27;yyyy-mm-dd&#x27;.</span><br><span class="hljs-comment"># HIST_STAMPS=&#x27;yyyy-mm-dd&#x27;</span><br><br><span class="hljs-comment"># Uncomment the following line if you do not want OMB to overwrite the existing</span><br><span class="hljs-comment"># aliases by the default OMB aliases defined in lib/*.sh</span><br><span class="hljs-comment"># OMB_DEFAULT_ALIASES=&quot;check&quot;</span><br><br><span class="hljs-comment"># Would you like to use another custom folder than $OSH/custom?</span><br><span class="hljs-comment"># OSH_CUSTOM=/path/to/new-custom-folder</span><br><br><span class="hljs-comment"># To disable the uses of &quot;sudo&quot; by oh-my-bash, please set &quot;false&quot; to</span><br><span class="hljs-comment"># this variable.  The default behavior for the empty value is &quot;true&quot;.</span><br>OMB_USE_SUDO=<span class="hljs-literal">true</span><br><br><span class="hljs-comment"># To enable/disable display of Python virtualenv and condaenv</span><br><span class="hljs-comment"># OMB_PROMPT_SHOW_PYTHON_VENV=true  # enable</span><br><span class="hljs-comment"># OMB_PROMPT_SHOW_PYTHON_VENV=false # disable</span><br><br><span class="hljs-comment"># Which completions would you like to load? (completions can be found in ~/.oh-my-bash/completions/*)</span><br><span class="hljs-comment"># Custom completions may be added to ~/.oh-my-bash/custom/completions/</span><br><span class="hljs-comment"># Example format: completions=(ssh git bundler gem pip pip3)</span><br><span class="hljs-comment"># Add wisely, as too many completions slow down shell startup.</span><br>completions=(<br>  git<br>  ssh<br>)<br><br><span class="hljs-comment"># Which aliases would you like to load? (aliases can be found in ~/.oh-my-bash/aliases/*)</span><br><span class="hljs-comment"># Custom aliases may be added to ~/.oh-my-bash/custom/aliases/</span><br><span class="hljs-comment"># Example format: aliases=(vagrant composer git-avh)</span><br><span class="hljs-comment"># Add wisely, as too many aliases slow down shell startup.</span><br><span class="hljs-comment">#aliases=(</span><br><span class="hljs-comment">#  general</span><br><span class="hljs-comment">#)</span><br><br><span class="hljs-comment"># Which plugins would you like to load? (plugins can be found in ~/.oh-my-bash/plugins/*)</span><br><span class="hljs-comment"># Custom plugins may be added to ~/.oh-my-bash/custom/plugins/</span><br><span class="hljs-comment"># Example format: plugins=(rails git textmate ruby lighthouse)</span><br><span class="hljs-comment"># Add wisely, as too many plugins slow down shell startup.</span><br>plugins=(<br>  git<br>  bashmarks<br>)<br><br><span class="hljs-comment"># Which plugins would you like to conditionally load? (plugins can be found in ~/.oh-my-bash/plugins/*)</span><br><span class="hljs-comment"># Custom plugins may be added to ~/.oh-my-bash/custom/plugins/</span><br><span class="hljs-comment"># Example format:</span><br><span class="hljs-comment">#  if [ &quot;$DISPLAY&quot; ] || [ &quot;$SSH&quot; ]; then</span><br><span class="hljs-comment">#      plugins+=(tmux-autoattach)</span><br><span class="hljs-comment">#  fi</span><br><br><span class="hljs-built_in">source</span> <span class="hljs-string">&quot;<span class="hljs-variable">$OSH</span>&quot;</span>/oh-my-bash.sh<br><br><span class="hljs-comment"># User configuration</span><br><span class="hljs-comment"># export MANPATH=&quot;/usr/local/man:$MANPATH&quot;</span><br><br><span class="hljs-comment"># You may need to manually set your language environment</span><br><span class="hljs-comment"># export LANG=en_US.UTF-8</span><br><br><span class="hljs-comment"># Preferred editor for local and remote sessions</span><br><span class="hljs-comment"># if [[ -n $SSH_CONNECTION ]]; then</span><br><span class="hljs-comment">#   export EDITOR=&#x27;vim&#x27;</span><br><span class="hljs-comment"># else</span><br><span class="hljs-comment">#   export EDITOR=&#x27;mvim&#x27;</span><br><span class="hljs-comment"># fi</span><br><br><span class="hljs-comment"># Compilation flags</span><br><span class="hljs-comment"># export ARCHFLAGS=&quot;-arch x86_64&quot;</span><br><br><span class="hljs-comment"># ssh</span><br><span class="hljs-comment"># export SSH_KEY_PATH=&quot;~/.ssh/rsa_id&quot;</span><br><br><span class="hljs-comment"># Set personal aliases, overriding those provided by oh-my-bash libs,</span><br><span class="hljs-comment"># plugins, and themes. Aliases can be placed here, though oh-my-bash</span><br><span class="hljs-comment"># users are encouraged to define aliases within the OSH_CUSTOM folder.</span><br><span class="hljs-comment"># For a full list of active aliases, run `alias`.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Example aliases</span><br><span class="hljs-comment"># alias bashconfig=&quot;mate ~/.bashrc&quot;</span><br><span class="hljs-comment"># alias ohmybash=&quot;mate ~/.oh-my-bash&quot;</span><br><br><span class="hljs-comment">## &gt;&gt;&gt; conda initialize &gt;&gt;&gt;</span><br><span class="hljs-comment"># !! Contents within this block are managed by &#x27;conda init&#x27; !!</span><br>__conda_setup=<span class="hljs-string">&quot;<span class="hljs-subst">$(&#x27;/home/wpsze/anaconda3/bin/conda&#x27; &#x27;shell.bash&#x27; &#x27;hook&#x27; 2&gt; /dev/null)</span>&quot;</span><br><span class="hljs-keyword">if</span> [ $? -eq 0 ]; <span class="hljs-keyword">then</span><br>    <span class="hljs-built_in">eval</span> <span class="hljs-string">&quot;<span class="hljs-variable">$__conda_setup</span>&quot;</span><br><span class="hljs-keyword">else</span><br>    <span class="hljs-keyword">if</span> [ -f <span class="hljs-string">&quot;/home/wpsze/anaconda3/etc/profile.d/conda.sh&quot;</span> ]; <span class="hljs-keyword">then</span><br>        . <span class="hljs-string">&quot;/home/wpsze/anaconda3/etc/profile.d/conda.sh&quot;</span><br>    <span class="hljs-keyword">else</span><br>        <span class="hljs-built_in">export</span> PATH=<span class="hljs-string">&quot;/home/wpsze/anaconda3/bin:<span class="hljs-variable">$PATH</span>&quot;</span><br>    <span class="hljs-keyword">fi</span><br><span class="hljs-keyword">fi</span><br><span class="hljs-built_in">unset</span> __conda_setup<br><span class="hljs-comment"># &lt;&lt;&lt; conda initialize &lt;&lt;&lt;</span><br><br><span class="hljs-comment">## History of most recent directories and jump </span><br><span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">dl</span></span>()&#123;<br>    <span class="hljs-built_in">dirs</span> -v | <span class="hljs-built_in">head</span> -n 10<br>&#125;<br><br><span class="hljs-comment">##</span><br><span class="hljs-comment"># some more ls aliases</span><br><span class="hljs-built_in">alias</span> ll=<span class="hljs-string">&#x27;ls -alF&#x27;</span><br><span class="hljs-built_in">alias</span> la=<span class="hljs-string">&#x27;ls -A&#x27;</span><br><span class="hljs-built_in">alias</span> l=<span class="hljs-string">&#x27;ls -CF&#x27;</span><br><br><span class="hljs-comment"># statistic bash</span><br><span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">bash_stats</span></span>()&#123;<br>  <span class="hljs-built_in">fc</span> -l 1 \<br>    | awk <span class="hljs-string">&#x27;&#123; CMD[$2]++; count++; &#125; END &#123; for (a in CMD) print CMD[a] &quot; &quot; CMD[a]*100/count &quot;% &quot; a &#125;&#x27;</span> \<br>    | grep -v <span class="hljs-string">&quot;./&quot;</span> | <span class="hljs-built_in">sort</span> -nr | <span class="hljs-built_in">head</span> -n 20 | column -c3 -s <span class="hljs-string">&quot; &quot;</span> -t | <span class="hljs-built_in">nl</span><br>&#125;<br><br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>HPC</tag>
      
      <tag>shell script</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>neovim</title>
    <link href="/2023/05/01/neovim/"/>
    <url>/2023/05/01/neovim/</url>
    
    <content type="html"><![CDATA[<h1 id="neovim">neovim</h1><p><a href="https://github.com/neovim/neovim">Git neovim</a></p><h2 id="installation">Installation</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sh">git <span class="hljs-built_in">clone</span> https://github.com/neovim/neovim<br><span class="hljs-built_in">cd</span> neovim <br>make CMAKE_BUILD_TYPE=Release<br>git checkout stable<br><br><span class="hljs-built_in">rm</span> -r build/  <span class="hljs-comment"># clear the CMake cache</span><br><span class="hljs-comment"># To install the executable to a certain location, use:</span><br>make CMAKE_EXTRA_FLAGS=<span class="hljs-string">&quot;-DCMAKE_INSTALL_PREFIX=<span class="hljs-variable">$HOME</span>/shells_setup/neovim&quot;</span><br>make install<br><span class="hljs-built_in">export</span> PATH=<span class="hljs-string">&quot;<span class="hljs-variable">$HOME</span>/shells_setup/neovim/bin:<span class="hljs-variable">$PATH</span>&quot;</span><br></code></pre></td></tr></table></figure><p>make CMAKE_BUILD_TYPE=Release/Debug/RelWithDebInfo</p><p>The build type determines the level of used compiler optimizations and debug information: - <strong>Release</strong>: Full compiler optimizations and no debug information. Expect the best performance from this build type. Often used by package maintainers. - <strong>Debug</strong>: Full debug information; few optimizations. Use this for development to get meaningful output from debuggers like GDB or LLDB. This is the default if CMAKE_BUILD_TYPE is not specified. - <strong>RelWithDebInfo</strong> ("Release With Debug Info"): Enables many optimizations and adds enough debug info so that when Neovim ever crashes, you can still get a backtrace.</p><h2 id="edit-nvim-config">Edit nvim config</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">mkdir</span> ~/.config/nvim/<br>~/.config/nvim/init.vim<br></code></pre></td></tr></table></figure><h2 id="apple-others-config">Apple other's config</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">git <span class="hljs-built_in">clone</span> --depth=1 https://github.com/Avimitin/nvim.git ~/.config/nvim<br><span class="hljs-comment"># or</span><br><br></code></pre></td></tr></table></figure><h2 id="error">Error</h2><h3 id="binsh-2-cmake-not-found">/bin/sh: 2: cmake: not found</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">sudo</span> apt install gcc-multilib<br><span class="hljs-built_in">sudo</span> apt install cmake<br></code></pre></td></tr></table></figure><h3 id="could-not-find-gettext">Could NOT find Gettext</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">sudo</span> apt-get install -y gettext<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>HPC</tag>
      
      <tag>vim</tag>
      
      <tag>editor</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ERA5 dataset</title>
    <link href="/2023/04/30/ERA5_dataset/"/>
    <url>/2023/04/30/ERA5_dataset/</url>
    
    <content type="html"><![CDATA[<h1 id="era5-dataset">ERA5 dataset</h1><p>It is imperative to complete the registration process on the Copernicus Climate Data Store by creating an account.</p><p>Some related links,</p><p><a href="https://forum.mmm.ucar.edu/threads/wrf-using-era5-data.12116/">WRF using ERA5 data</a></p><ul><li><a href="https://cds.climate.copernicus.eu/">Climate Data Store - Copernicus</a></li><li><a href="https://rda.ucar.edu/datasets/ds633.0/dataaccess/">ERA5 (UCAR) ERA5 Reanalysis (0.25 Degree Latitude-Longitude Grid) ds633.0 DOI: 10.5065/BH6N-5N20</a></li><li><a href="https://cds.climate.copernicus.eu/cdsapp#!/dataset/reanalysis-era5-single-levels?tab=overview">ERA5 hourly data on single levels from 1940 to present</a></li><li><a href="https://cds.climate.copernicus.eu/cdsapp#!/dataset/reanalysis-era5-pressure-levels?tab=overview">ERA5 hourly data on pressure levels from 1940 to present</a></li></ul><h2 id="required-meteorological-fields-for-running-wrf">Required Meteorological Fields for Running WRF</h2><blockquote><p><a href="https://www2.mmm.ucar.edu/wrf/users/docs/user_guide_v4/v4.1/users_guide_chap3.html#_Required_Meteorological_Fields">user_guide_v4/v4.1/users_guide_chap3.html#_Required_Meteorological_Fields</a></p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs sh">3D Data (e.g. data on pressure levels)<br>Temperature<br>U and V components of Wind<br>Geopotential Height<br>Relative Humidity (the code can calculate RH <span class="hljs-keyword">if</span> Specific Humidity is available;this is controlled <span class="hljs-keyword">in</span> the Vtable)<br><br>2D Data<br>Surface Pressure<br>Mean Sea Level Pressure<br>Skin Temperature/SST<br>2-meter Temperature<br>2-meter Relative or Specific Humidity<br>10-meter U and V components of wind<br>Soil data (temperature and moisture) and soil height<br>If any masked field is ingested, <span class="hljs-keyword">then</span> a LANDSEA field is recommended<br>Water equivalent snow depth (SNOW) is a <span class="hljs-built_in">nice</span> field to have, but not required.<br>SEAICE is good to have <span class="hljs-keyword">for</span> a high latitude winter <span class="hljs-keyword">case</span>, but it is not required.<br></code></pre></td></tr></table></figure><h2 id="shell-script">Shell script</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/sh</span><br><span class="hljs-comment"># source requried packages</span><br><span class="hljs-built_in">source</span> /home/wpsze/anaconda3/bin/activate venv<br><br>yyyy=<span class="hljs-string">&#x27;2022&#x27;</span><br>mm=<span class="hljs-string">&#x27;06&#x27;</span><br><span class="hljs-built_in">dd</span>=<span class="hljs-string">&#x27;26&#x27;</span><br>hh=<span class="hljs-string">&#x27;18&#x27;</span><br><br><span class="hljs-keyword">for</span> next_hh <span class="hljs-keyword">in</span> $(<span class="hljs-built_in">seq</span> 0 3 36); <span class="hljs-keyword">do</span> <span class="hljs-comment"># Forecast time = 12, 24, 36, 48, 60, 72, 84, 96, 108, 130</span><br>NEXT_DATE=$(TZ=UTC <span class="hljs-built_in">date</span> -d <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;yyyy&#125;</span>-<span class="hljs-variable">$&#123;mm&#125;</span>-<span class="hljs-variable">$&#123;dd&#125;</span>T<span class="hljs-variable">$&#123;hh&#125;</span>:00:00Z +<span class="hljs-variable">$next_hh</span> hour&quot;</span> +%Y%m%d%H)<br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$&#123;NEXT_DATE&#125;</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;downloading &quot;</span> <span class="hljs-variable">$&#123;NEXT_DATE&#125;</span><br>SLoutfile=<span class="hljs-string">&quot;ERA5-0p25-SL-<span class="hljs-variable">$&#123;NEXT_DATE&#125;</span>.grib&quot;</span><br>PLoutfile=<span class="hljs-string">&quot;ERA5-0p25-PL-<span class="hljs-variable">$&#123;NEXT_DATE&#125;</span>.grib&quot;</span><br>resolution=<span class="hljs-string">&quot;0.25&quot;</span><br><br>python ERA5-sl.py <span class="hljs-variable">$&#123;NEXT_DATE&#125;</span> <span class="hljs-variable">$&#123;SLoutfile&#125;</span> <span class="hljs-variable">$&#123;resolution&#125;</span><br>python ERA5-pl.py <span class="hljs-variable">$&#123;NEXT_DATE&#125;</span> <span class="hljs-variable">$&#123;PLoutfile&#125;</span> <span class="hljs-variable">$&#123;resolution&#125;</span><br><span class="hljs-keyword">done</span><br></code></pre></td></tr></table></figure><h2 id="era5-sl.py">ERA5-sl.py</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python</span><br><span class="hljs-comment"># Retrieve ERA5 data on single levels(sl)</span><br><span class="hljs-keyword">import</span> argparse<br>parser = argparse.ArgumentParser()<br>parser.add_argument(<span class="hljs-string">&quot;datetime_string&quot;</span>, <span class="hljs-built_in">help</span>=<span class="hljs-string">&quot;Datetime string of the downloaded data in format YYYYMMDDHH&quot;</span>, <span class="hljs-built_in">type</span>=<span class="hljs-built_in">str</span>)<br>parser.add_argument(<span class="hljs-string">&quot;ofile&quot;</span>, <span class="hljs-built_in">help</span>=<span class="hljs-string">&quot;Output file of the downloaded data, e.g. ERA5-SL-YYYYMMDDHH.grib&quot;</span>, <span class="hljs-built_in">type</span>=<span class="hljs-built_in">str</span>)<br>parser.add_argument(<span class="hljs-string">&quot;resoln&quot;</span>, <span class="hljs-built_in">help</span>=<span class="hljs-string">&quot;Horizontal resolution of the downloaded data (in degree), e.g. 0.25&quot;</span>, <span class="hljs-built_in">type</span>=<span class="hljs-built_in">str</span>)<br>args = parser.parse_args()<br><br><span class="hljs-keyword">import</span> datetime<br>datetime_object = datetime.datetime.strptime(args.datetime_string, <span class="hljs-string">&quot;%Y%m%d%H&quot;</span>)<br>yyyy = datetime_object.strftime(<span class="hljs-string">&quot;%Y&quot;</span>)<br>mm = datetime_object.strftime(<span class="hljs-string">&quot;%m&quot;</span>)<br>dd = datetime_object.strftime(<span class="hljs-string">&quot;%d&quot;</span>)<br>hh = datetime_object.strftime(<span class="hljs-string">&quot;%H:00&quot;</span>)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;================&quot;</span>, args)<br><br><span class="hljs-keyword">import</span> sys<br><span class="hljs-keyword">import</span> logging<br><span class="hljs-keyword">import</span> cdsapi<br>c = cdsapi.Client()<br><span class="hljs-keyword">try</span>:<br>    c.retrieve(<br>        <span class="hljs-string">&quot;reanalysis-era5-single-levels&quot;</span>,<br>        &#123;<br>            <span class="hljs-string">&quot;product_type&quot;</span>: <span class="hljs-string">&quot;reanalysis&quot;</span>,<br>            <span class="hljs-string">&quot;format&quot;</span>: <span class="hljs-string">&quot;grib&quot;</span>,<br>            <span class="hljs-string">&quot;variable&quot;</span>: [<br>                <span class="hljs-string">&quot;10m_u_component_of_wind&quot;</span>,<br>                <span class="hljs-string">&quot;10m_v_component_of_wind&quot;</span>,<br>                <span class="hljs-string">&quot;2m_dewpoint_temperature&quot;</span>,<br>                <span class="hljs-string">&quot;2m_temperature&quot;</span>,<br>                <span class="hljs-string">&quot;land_sea_mask&quot;</span>,<br>                <span class="hljs-string">&quot;mean_sea_level_pressure&quot;</span>,<br>                <span class="hljs-string">&quot;sea_ice_cover&quot;</span>,<br>                <span class="hljs-string">&quot;sea_surface_temperature&quot;</span>,<br>                <span class="hljs-string">&quot;skin_temperature&quot;</span>,<br>                <span class="hljs-string">&quot;snow_density&quot;</span>,<br>                <span class="hljs-string">&quot;snow_depth&quot;</span>,<br>                <span class="hljs-string">&quot;soil_temperature_level_1&quot;</span>,<br>                <span class="hljs-string">&quot;soil_temperature_level_2&quot;</span>,<br>                <span class="hljs-string">&quot;soil_temperature_level_3&quot;</span>,<br>                <span class="hljs-string">&quot;soil_temperature_level_4&quot;</span>,<br>                <span class="hljs-string">&quot;surface_pressure&quot;</span>,<br>                <span class="hljs-string">&quot;volumetric_soil_water_layer_1&quot;</span>,<br>                <span class="hljs-string">&quot;volumetric_soil_water_layer_2&quot;</span>,<br>                <span class="hljs-string">&quot;volumetric_soil_water_layer_3&quot;</span>,<br>                <span class="hljs-string">&quot;volumetric_soil_water_layer_4&quot;</span>,<br><span class="hljs-string">&quot;geopotential&quot;</span><br>            ],<br>            <span class="hljs-string">&quot;grid&quot;</span>: [args.resoln, args.resoln],<br>            <span class="hljs-string">&quot;year&quot;</span>: yyyy,<br>            <span class="hljs-string">&quot;month&quot;</span>: [<br>                mm<br>            ],<br>            <span class="hljs-string">&quot;day&quot;</span>: [<br>                dd<br>            ],<br>            <span class="hljs-string">&quot;time&quot;</span>: [<br>                hh<br>            ],<br>        <span class="hljs-comment">#    &quot;area&quot;:[15, 90, 10, 120], # North, West, South, East. Default: global</span><br>        &#125;,<br>        args.ofile)<br><span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> err:<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">str</span>(err) == <span class="hljs-string">&quot;no data is available within your requested subset. Request returned no data.&quot;</span>:<br>        logging.exception(err)<br>        sys.exit(<span class="hljs-number">96</span>)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">raise</span> err<br></code></pre></td></tr></table></figure><blockquote><p>Remark: + geopotential? Yes for SOILHGT field not found in intermediate file ERA5</p></blockquote><h2 id="era5-pl.py">ERA5-pl.py</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/usr/bin/env python</span><br><span class="hljs-comment"># Retrieve ERA5 data on pressure level(pl)</span><br>import argparse<br>parser = argparse.ArgumentParser()<br>parser.add_argument(<span class="hljs-string">&quot;datetime_string&quot;</span>, <span class="hljs-built_in">help</span>=<span class="hljs-string">&quot;Datetime string of the downloaded data in format YYYYMMDDHH&quot;</span>, <span class="hljs-built_in">type</span>=str)<br>parser.add_argument(<span class="hljs-string">&quot;ofile&quot;</span>, <span class="hljs-built_in">help</span>=<span class="hljs-string">&quot;Output file of the downloaded data, e.g. ERA5-PL-YYYYMMDDHH.grib&quot;</span>, <span class="hljs-built_in">type</span>=str)<br>parser.add_argument(<span class="hljs-string">&quot;resoln&quot;</span>, <span class="hljs-built_in">help</span>=<span class="hljs-string">&quot;Horizontal resolution of the downloaded data (in degree), e.g. 0.25&quot;</span>, <span class="hljs-built_in">type</span>=str)<br>args = parser.parse_args()<br><br>import datetime<br>datetime_object = datetime.datetime.strptime(args.datetime_string, <span class="hljs-string">&quot;%Y%m%d%H&quot;</span>)<br>yyyy = datetime_object.strftime(<span class="hljs-string">&quot;%Y&quot;</span>)<br>mm = datetime_object.strftime(<span class="hljs-string">&quot;%m&quot;</span>)<br><span class="hljs-built_in">dd</span> = datetime_object.strftime(<span class="hljs-string">&quot;%d&quot;</span>)<br>hh = datetime_object.strftime(<span class="hljs-string">&quot;%H:00&quot;</span>)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;================&quot;</span>, args)<br><br>import sys<br>import logging<br>import cdsapi<br>c = cdsapi.Client()<br>try:<br>    c.retrieve(<br>        <span class="hljs-string">&quot;reanalysis-era5-pressure-levels&quot;</span>,<br>        &#123;<br>            <span class="hljs-string">&quot;product_type&quot;</span>: <span class="hljs-string">&quot;reanalysis&quot;</span>,<br>            <span class="hljs-string">&quot;format&quot;</span>: <span class="hljs-string">&quot;grib&quot;</span>,<br>            <span class="hljs-string">&quot;variable&quot;</span>: [<br>                <span class="hljs-string">&quot;geopotential&quot;</span>,<br>                <span class="hljs-string">&quot;relative_humidity&quot;</span>,<br>                <span class="hljs-string">&quot;specific_humidity&quot;</span>,<br>                <span class="hljs-string">&quot;temperature&quot;</span>,<br>                <span class="hljs-string">&quot;u_component_of_wind&quot;</span>,<br>                <span class="hljs-string">&quot;v_component_of_wind&quot;</span><br>            ],<br>            <span class="hljs-string">&quot;pressure_level&quot;</span>: [<br>                <span class="hljs-string">&#x27;1&#x27;</span>, <span class="hljs-string">&#x27;2&#x27;</span>, <span class="hljs-string">&#x27;3&#x27;</span>,<br>                <span class="hljs-string">&#x27;5&#x27;</span>, <span class="hljs-string">&#x27;7&#x27;</span>, <span class="hljs-string">&#x27;10&#x27;</span>,<br>                <span class="hljs-string">&#x27;20&#x27;</span>, <span class="hljs-string">&#x27;30&#x27;</span>, <span class="hljs-string">&#x27;50&#x27;</span>,<br>                <span class="hljs-string">&#x27;70&#x27;</span>, <span class="hljs-string">&#x27;100&#x27;</span>, <span class="hljs-string">&#x27;125&#x27;</span>,<br>                <span class="hljs-string">&#x27;150&#x27;</span>, <span class="hljs-string">&#x27;175&#x27;</span>, <span class="hljs-string">&#x27;200&#x27;</span>,<br>                <span class="hljs-string">&#x27;225&#x27;</span>, <span class="hljs-string">&#x27;250&#x27;</span>, <span class="hljs-string">&#x27;300&#x27;</span>,<br>                <span class="hljs-string">&#x27;350&#x27;</span>, <span class="hljs-string">&#x27;400&#x27;</span>, <span class="hljs-string">&#x27;450&#x27;</span>,<br>                <span class="hljs-string">&#x27;500&#x27;</span>, <span class="hljs-string">&#x27;550&#x27;</span>, <span class="hljs-string">&#x27;600&#x27;</span>,<br>                <span class="hljs-string">&#x27;650&#x27;</span>, <span class="hljs-string">&#x27;700&#x27;</span>, <span class="hljs-string">&#x27;750&#x27;</span>,<br>                <span class="hljs-string">&#x27;775&#x27;</span>, <span class="hljs-string">&#x27;800&#x27;</span>, <span class="hljs-string">&#x27;825&#x27;</span>,<br>                <span class="hljs-string">&#x27;850&#x27;</span>, <span class="hljs-string">&#x27;875&#x27;</span>, <span class="hljs-string">&#x27;900&#x27;</span>,<br>                <span class="hljs-string">&#x27;925&#x27;</span>, <span class="hljs-string">&#x27;950&#x27;</span>, <span class="hljs-string">&#x27;975&#x27;</span>,<br>                <span class="hljs-string">&#x27;1000&#x27;</span><br>            ],<br>            <span class="hljs-string">&quot;grid&quot;</span>: [args.resoln, args.resoln],<br>            <span class="hljs-string">&quot;year&quot;</span>: yyyy,<br>            <span class="hljs-string">&quot;month&quot;</span>: [<br>                mm<br>            ],<br>            <span class="hljs-string">&quot;day&quot;</span>: [<br>                <span class="hljs-built_in">dd</span><br>            ],<br>            <span class="hljs-string">&quot;time&quot;</span>: [<br>                hh<br>            ],<br>        <span class="hljs-comment">#    &quot;area&quot;:[15, 90, 10, 120], # North, West, South, East. Default: global</span><br>        &#125;,<br>        args.ofile)<br>except Exception as err:<br>    <span class="hljs-keyword">if</span> str(err) == <span class="hljs-string">&quot;no data is available within your requested subset. Request returned no data.&quot;</span>:<br>        logging.exception(err)<br>        sys.exit(96)<br>    <span class="hljs-keyword">else</span>:<br>        raise err<br><br><br></code></pre></td></tr></table></figure><h2 id="vtable">Vtable</h2><p>The Vtable that comes with WRF includes not only Vtable.ECMWF, but also Vtable.ERA-interim.pl and Vtable.ERA-interim.ml, where Vtable.ERA-interim.pl corresponds to the ERA-Interim data of the pressure level, Vtable.ERA-interim.ml corresponds to the ERA-Interim data of the model level.</p><h3 id="vtable.era-interim.pl">Vtable.ERA-interim.pl</h3><p><strong>Latest commit b5df64a on Apr 12, 2011</strong> For use with ERA-interim pressure-level output For ERA-interim data at NCAR, use the pl (sc and uv) and sfc sc files. &gt; <a href="https://github.com/openwfm/wrf-fire/blob/master/WPS/ungrib/Variable_Tables/Vtable.ERA-interim.pl">Vtable.ERA-interim.pl</a></p><h3 id="vtable.ecmwf">Vtable.ECMWF</h3><p><strong>Latest commit 5c01f57 on Jun 12, 2010</strong> &gt; <a href="https://github.com/openwfm/wrf-fire/blob/master/WPS/ungrib/Variable_Tables/Vtable.ECMWF">Vtable.ECMWF</a></p><h3 id="vtable.era-interim.ml">Vtable.ERA-interim.ml</h3><p><strong>Latest commit b5df64a on Apr 12, 2011</strong> For use with ERA-interim model-level output. For ERA-interim data at NCAR, use the ml (sc and uv) and sfc sc files. &gt; <a href="https://github.com/openwfm/wrf-fire/blob/master/WPS/ungrib/Variable_Tables/Vtable.ERA-interim.ml">Vtable.ERA-interim.ml</a></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">ln</span> -s /xxx/ERA-interim.pl Vtable<br><br><span class="hljs-comment"># If Vtable.ERA-interim.pl works for you, I don&#x27;t think you need to switch to Vtable.ECMWRF.</span><br><span class="hljs-comment"># If not, Please use Vtable.ECMWF to ungrib ERA5 data. </span><br><span class="hljs-built_in">ln</span> -s /xxx/Vtable.ECMWF Vtable<br></code></pre></td></tr></table></figure><h2 id="link_grib.csh">./link_grib.csh</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ ./link_grib.csh ../DATA/ERA5/*.grib<br></code></pre></td></tr></table></figure><h2 id="namelist.wps-setup-ungrib">namelist.wps, setup &amp;ungrib</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">&amp;ungrib<br> out_format = <span class="hljs-string">&#x27;WPS&#x27;</span>,<br> prefix = <span class="hljs-string">&#x27;FILE&#x27;</span>,<br>/<br></code></pre></td></tr></table></figure><h2 id="ungrib.exe">./ungrib.exe</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ ./ungrib.exe<br></code></pre></td></tr></table></figure><p>Outputs are format of <strong>FILE:2022-06-27_15</strong> that is intermediate file that are ready for WRF metgrid or MPAS init.</p><h2 id="error-missingincomplete-configuration-file-homexx.cdsapirc">Error: Missing/incomplete configuration file: /home/xx/.cdsapirc??</h2><p>The reason is that the .cdsapirc file under /home/xx/ is missing. This file contains the downloaded Key. We go to this link (https://cds.climate.copernicus.eu/api-how-to) to get it as required To our Key, if there is no registration, the key will appear directly on the right after registration. At this time, we will copy the things on the right Copy the code shown next to the file $HOME/.cdsapirc (in your Unix/Linux environment).</p><p>check, &gt; ll -a /home/wpsze/.cdsapirc</p><h2 id="soilhgt-field-not-found-in-intermediate-file-era5">SOILHGT field not found in intermediate file ERA5</h2><p>Besides processing the time-dependent atmospheric and land-surface ERA5 fields, I think you will also need to use ungrib to process the ERA5 invariant fields, including SOILHGT. Once you've created an intermediate file with invariant fields, you can concatenate the contents of that file to each of your time-varying intermediate files. <a href="https://forum.mmm.ucar.edu/threads/error-while-interpolating-regional-initial-conditions-using-era-5-grib-data.12532/">link</a></p><p>The HGT_M value from geogrid comes from the static topographic data. The met_em files contain both that HGT_M value, which is identical to the value from geogrid, and <strong>SOILHGT, which is the terrain information coming from the input/first-guess data (e.g., GFS)</strong>. During real.exe, both are used again. The HGT value in the wrfinput* files comes from the HGT_M value and should still be the same at that time (if using the default namelist setting surface_input_source=3). <strong>real.exe also checks for SOILHGT, which is used for smoothing the coarse grid topography on domain 1 during the wrf process.</strong> <a href="https://forum.mmm.ucar.edu/threads/soilhgt.11582/">link</a></p><p>Smooth_cg_topo and ERA-5 / ERA-Interim data? &gt; For ECMWF and ERA, the Vtable says it uses grib code 129 level 0 for both SOILGEO and SOILHGT. Please download ERA5 terrain data from /FS/DECS/DS630.0/e5.oper.invariant/201601/e5.oper.invariant.128_129_z.regn320sc.2016010100_2016010100.grb ERA-I terrain can be found in https://rda.ucar.edu/datasets/ds627.0/, where if you download any sfc dataset, you can find terrain data in it.<a href="https://forum.mmm.ucar.edu/threads/smooth_cg_topo-and-era-5-era-interim-data.9323/">link</a></p>]]></content>
    
    
    <categories>
      
      <category>NWP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>WRF</tag>
      
      <tag>WPS</tag>
      
      <tag>MPAS</tag>
      
      <tag>IC/BC</tag>
      
      <tag>ERA5</tag>
      
      <tag>ECMWF</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>WRF | WPS namelist.wps Best Practices</title>
    <link href="/2023/04/30/WPS_namelist_wps_Best_Practices/"/>
    <url>/2023/04/30/WPS_namelist_wps_Best_Practices/</url>
    
    <content type="html"><![CDATA[<h1 id="wps-namelist.wps-best-practices">WPS namelist.wps: Best Practices</h1><p><a href="https://www2.mmm.ucar.edu/wrf/users/namelist_best_prac_wps.html">https://www2.mmm.ucar.edu/wrf/users/namelist_best_prac_wps.html</a></p><ol type="1"><li>In namelist.wps, multiple columns are used for multiple domains; however max_domains determines how many columns will be used. For example, if you use 3 columns, but only set max_dom = 2, the last column will be ignored.</li><li>Not all parameters have mulitple columns.</li></ol><h2 id="max_dom">max_dom</h2><p>Nested domains are necessary when scaling down from coarse first-guess (input) data to a fine resolution, and the recommended ratios for coarse data resolution to the parent domain are odd ratios of <strong>3:1 or 5:1</strong>. For example, if your domain of interest needs to have a resolution of 3 km, but your input data have a resolution of 27 km, and you are using a 3:1 ratio, your domain 01, should be around 9 km, and then you can have a nested domain with 3 km grid spacing. In this case, max_dom = 3.</p><h2 id="parent_grid_ratio">parent_grid_ratio</h2><p>The nesting ratio relative to the domain's parent. <strong>For the coarsest domain, parent_grid_ratio should be set to 1</strong>. <strong>Recommended ratios are 3 or 5</strong>. If you are unfamiliar with the model, it is best to leave this set to 3. It is not recommended to use an even number ratio since it is best to have a center grid cell for the fine domain that corresponds with the center of the coarse domain. grid cell.</p><h2 id="i_-j_parent_start">i_, j_parent_start</h2><p>It is good practice to keep nest boundaries away from coarse domain boundaries, and to keep them away from steep topography. As a rough approximation, <strong>keep about 1/3 of the coarse-grid domain surrounding each side of the nest</strong>. This does not have to be exact, and the nest does not have to be centered perfectly, but this helps to stay away from problems later. If the prevailing winds are westerly, it is better to place the nest further away from the west boundary, than the east.</p><h2 id="e_we-e_sn">e_we, e_sn</h2><p>It is recommended to have domains <strong>no smaller than about 100x100</strong>. Note that there will be about 10 grid points (minimum of 5) on each side, in the boundary zone. If domains are too small, the solution will be determined by forcing data. When considering the size of the coarse domain, <strong>there is no need to be economical. Doubling the size of the coarse grid domain will only result in a 25% nested forecast time increase</strong>. <strong>It's also important to consider the speed at which systems are moving through the simulated region. A multi-day forecast needs a much larger domain than a short forecast. If cost is prohibitive, consider adding an external domain.</strong></p><h2 id="geog_data_res">geog_data_res</h2><p>Prior to V3.8, if you wish to use the MODIS data, it would be necessary to specify:</p><blockquote><p>geog_data_res = 'modis_30s+10m', 'modis_30s+2m', 'modis_30s+30s'</p></blockquote><p>Possible available resolutions are <strong>10m (~19km), 5m (~9km), 2m (~4km), and 30s (~0.9km)</strong>. When there are multiple resolutions available for geographical input data, choose a resolution that is <strong>slightly better</strong> than your grid resolution. For example, <strong>if your grid resolution is 9km, using 2 minute static data would be ideal</strong>.</p><h2 id="dx-dy">dx, dy</h2><p>This is given in meters for the Lambert, Polar, and Mercator projections. For the 'lat-lon' projection, this is given in degrees latitude. For namelist.wps it is only necessary to specify the coarse domain resolution, as nest domains will be calculated based on parent_grid_ratio. It is recommended that <strong>dx and dy have the same value</strong> for Mercator, Polar, and Lambert projections.</p><h2 id="map_proj">map_proj</h2><ul><li>lambert: well-suited for mid-latitudes; domain cannot contain poles; domain cannot be periodic in west-east direction</li><li>mercator: well-suited for low-latitudes; may be used for a "channel" domain (periodic in west-east direction).</li><li>polar: good for high-latitude domains, especially if the domain contains a pole</li><li>lat-lon: also called cylindrical equidistant; required for global domains (but does not have to be global); can be used in its normal or rotated aspect</li></ul><p>It is best to check the range of the map scale factor (e.g., <strong>MAPFRAC_M</strong> for the map factor in the center of a grid cell) after running geogrid.exe (this can be checked easily with the ncview program). <strong>Values should be close to 1 to ensure the projection is not causing distortion.</strong></p><h2 id="ref_lat-ref_lon">ref_lat, ref_lon</h2><p>Real values specifying the latitude and longitude of a location whose (i,j) location in the simulation is known. &gt; For ARW, ref_lat and ref_lon give the latitude and longitude of a known location in the domain (it's recommended that these are set to the center of the coarse domain</p><h2 id="truelat12">truelat1/2</h2><ul><li>truelat1: A real value specifying the first true latitude for the Lambert conformal conic projection, or the true latitude for the polar stereographic projection, or the Mercator projection.</li><li>truelat2: A real value specifying the second true latitude for the Lambert conformal conic projection.</li></ul><h2 id="stand_lon">stand_lon</h2><p>If this longitude is set to the <strong>same value as ref_lon</strong>, your coarsest domain will be centered.</p><h2 id="geog_data_path">geog_data_path</h2><p>It's best to set this to <strong>the absolute path.</strong></p><h2 id="ungrid">&amp;ungrid</h2><h3 id="out_format">out_format</h3><p>If you are running ungrib in the WPS/ program, this should be set to <strong>"WPS."</strong></p><h3 id="prefix">prefix</h3><p>The prefix that will be assigned to intermediate files (produced from the ungrib.exe program). This can be left as set to 'FILE' or can be changed to anything you choose like GFS, ERA5, SST.</p><blockquote><p>If you will be using more than one type of input data, and it's necessary to run ungrib twice, you may consider setting this to something that is meaningful to the data type (e.g., "SST" for sea surface temperature data). If you do need to run ungrib twice, set this to only one prefix name per ungrib.exe run.</p></blockquote><h2 id="metgrid">&amp;metgrid</h2><h3 id="fg_name">fg_name</h3><p>This is the prefix that was used when the intermediate files were created (see above). To combine different data sources, <strong>list all prefixes</strong> (e.g., fg_name = 'GFS', 'SST'), that combine GFS and SST</p>]]></content>
    
    
    <categories>
      
      <category>WRF</category>
      
    </categories>
    
    
    <tags>
      
      <tag>WRF</tag>
      
      <tag>WPS</tag>
      
      <tag>namelist.wps</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>WRF | WPS namelist.wps Examples</title>
    <link href="/2023/04/30/WPS_namelist_wps_examples/"/>
    <url>/2023/04/30/WPS_namelist_wps_examples/</url>
    
    <content type="html"><![CDATA[<h1 id="wps-namelist.wps-examples">WPS namelist.wps Examples</h1><h2 id="namelist.wps">namelist.wps</h2><p><a href="https://github.com/wrf-model/WPS/blob/master/namelist.wps">Git namelist.wps</a></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs sh">&amp;share<br> wrf_core = <span class="hljs-string">&#x27;ARW&#x27;</span>,<br> max_dom = 2,<br> start_date = <span class="hljs-string">&#x27;2019-09-04_12:00:00&#x27;</span>,<span class="hljs-string">&#x27;2019-09-04_12:00:00&#x27;</span>,<br> end_date   = <span class="hljs-string">&#x27;2019-09-06_00:00:00&#x27;</span>,<span class="hljs-string">&#x27;2019-09-04_12:00:00&#x27;</span>,<br> interval_seconds = 10800<br>/<br><br>&amp;geogrid<br> parent_id         =   1,   1,<br> parent_grid_ratio =   1,   3,<br> i_parent_start    =   1,  53,<br> j_parent_start    =   1,  25,<br> e_we              =  150, 220,<br> e_sn              =  130, 214,<br> geog_data_res = <span class="hljs-string">&#x27;default&#x27;</span>,<span class="hljs-string">&#x27;default&#x27;</span>,<br> dx = 15000,<br> dy = 15000,<br> map_proj = <span class="hljs-string">&#x27;lambert&#x27;</span>,<br> ref_lat   =  33.00,<br> ref_lon   = -79.00,<br> truelat1  =  30.0,<br> truelat2  =  60.0,<br> stand_lon = -79.0,<br> geog_data_path = <span class="hljs-string">&#x27;/glade/work/wrfhelp/WPS_GEOG/&#x27;</span><br>/<br><br>&amp;ungrib<br> out_format = <span class="hljs-string">&#x27;WPS&#x27;</span>,<br> prefix = <span class="hljs-string">&#x27;FILE&#x27;</span>,<br>/<br><br>&amp;metgrid<br> fg_name = <span class="hljs-string">&#x27;FILE&#x27;</span><br>/<br></code></pre></td></tr></table></figure><h2 id="namelist.wps.all_options">namelist.wps.all_options</h2><p><a href="https://github.com/wrf-model/WPS/blob/master/namelist.wps.all_options">Git namelist.wps.all_options</a></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><code class="hljs sh">&amp;share<br> wrf_core = <span class="hljs-string">&#x27;ARW&#x27;</span>,<br> max_dom = 2,<br> start_date = <span class="hljs-string">&#x27;2006-08-16_12:00:00&#x27;</span>,<span class="hljs-string">&#x27;2006-08-16_12:00:00&#x27;</span>,<br> end_date   = <span class="hljs-string">&#x27;2006-08-16_18:00:00&#x27;</span>,<span class="hljs-string">&#x27;2006-08-16_12:00:00&#x27;</span>,<br> interval_seconds = 21600<br> active_grid = .<span class="hljs-literal">true</span>., .<span class="hljs-literal">true</span>.,<br> subgrid_ratio_x = 1<br> subgrid_ratio_y = 1<br> io_form_geogrid = 2,<br> opt_output_from_geogrid_path = <span class="hljs-string">&#x27;./&#x27;</span>,<br> debug_level = 0<br>/<br> start_date = <span class="hljs-string">&#x27;2000-01-24_12:00:00&#x27;</span>,<span class="hljs-string">&#x27;2000-01-24_12:00:00&#x27;</span>,<br> end_date   = <span class="hljs-string">&#x27;2000-01-25_12:00:00&#x27;</span>,<span class="hljs-string">&#x27;2000-01-24_12:00:00&#x27;</span>,<br> start_year   = 2006, 2006,<br> start_month  =   08,   08,<br> start_day    =   16,   16,<br> start_hour   =   12,   12,<br> start_minute =   00,   00,<br> start_second =   00,   00,<br> end_year     = 2006, 2006,<br> end_month    =   08,   08,<br> end_day      =   16,   16,<br> end_hour     =   18,   12,<br> end_minute   =   00,   00,<br> end_second   =   00,   00,<br><br>&amp;geogrid<br> parent_id         =   1,   1,<br> parent_grid_ratio =   1,   3,<br> i_parent_start    =   1,  31,<br> j_parent_start    =   1,  17,<br> s_we              =   1,   1,<br> e_we              =  74, 112,<br> s_sn              =   1,   1,<br> e_sn              =  61,  97,<br> !<br> !!!!!!!!!!!!!!!!!!!!!!!!!!!! IMPORTANT NOTE !!!!!!!!!!!!!!!!!!!!!!!!!!!!<br> ! The default datasets used to produce the MAXSNOALB and ALBEDO12M<br> ! fields have changed <span class="hljs-keyword">in</span> WPS v4.0. These fields are now interpolated<br> ! from MODIS-based datasets.<br> !<br> ! To match the output given by the default namelist.wps <span class="hljs-keyword">in</span> WPS v3.9.1,<br> ! the following setting <span class="hljs-keyword">for</span> geog_data_res may be used:<br> !<br> ! geog_data_res = <span class="hljs-string">&#x27;maxsnowalb_ncep+albedo_ncep+default&#x27;</span>, <span class="hljs-string">&#x27;maxsnowalb_ncep+albedo_ncep+default&#x27;</span>,<br> !<br> !!!!!!!!!!!!!!!!!!!!!!!!!!!! IMPORTANT NOTE !!!!!!!!!!!!!!!!!!!!!!!!!!!!<br> !<br> geog_data_res = <span class="hljs-string">&#x27;default&#x27;</span>,<span class="hljs-string">&#x27;default&#x27;</span>,<br> dx        = 30000,<br> dy        = 30000,<br> map_proj  = <span class="hljs-string">&#x27;lambert&#x27;</span>,<br> ref_lat   =  34.83,<br> ref_lon   = -81.03,<br> ref_x     =  37.0,<br> ref_y     =  30.5,<br> truelat1  =  30.0,<br> truelat2  =  60.0,<br> stand_lon = -98.0,<br> geog_data_path = <span class="hljs-string">&#x27;/glade/work/wrfhelp/WPS_GEOG/&#x27;</span><br> opt_geogrid_tbl_path = <span class="hljs-string">&#x27;geogrid/&#x27;</span><br>/<br> geog_data_res     = <span class="hljs-string">&#x27;modis_lakes+10m&#x27;</span>,<span class="hljs-string">&#x27;modis_lakes+2m&#x27;</span>,<br> geog_data_res     = <span class="hljs-string">&#x27;usgs_lakes+10m&#x27;</span>,<span class="hljs-string">&#x27;usgs_lakes+2m&#x27;</span>,<br><br>&amp;ungrib<br> out_format = <span class="hljs-string">&#x27;WPS&#x27;</span>,<br> prefix     = <span class="hljs-string">&#x27;FILE&#x27;</span>,<br> ec_rec_len = 26214508,<br> pmin = 100.<br>/<br><br>&amp;metgrid<br> fg_name         = <span class="hljs-string">&#x27;FILE&#x27;</span><br> constants_name  = <span class="hljs-string">&#x27;./TAVGSFC&#x27;</span><br> io_form_metgrid = 2, <br> opt_output_from_metgrid_path = <span class="hljs-string">&#x27;./&#x27;</span>,<br> opt_metgrid_tbl_path         = <span class="hljs-string">&#x27;metgrid/&#x27;</span>,<br> process_only_bdy = 5,<br>/<br><br>&amp;mod_levs<br> press_pa = 201300 , 200100 , 100000 , <br>             95000 ,  90000 , <br>             85000 ,  80000 , <br>             75000 ,  70000 , <br>             65000 ,  60000 , <br>             55000 ,  50000 , <br>             45000 ,  40000 , <br>             35000 ,  30000 , <br>             25000 ,  20000 , <br>             15000 ,  10000 , <br>              5000 ,   1000<br>/<br><br>&amp;plotfmt<br> ix = 100<br> jx = 100<br> ioff = 30<br> joff = 30<br>/<br></code></pre></td></tr></table></figure><h2 id="namelist.wps.global">namelist.wps.global</h2><p><a href="https://github.com/wrf-model/WPS/blob/master/namelist.wps.global">Git namelist.wps.global</a></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><code class="hljs sh">&amp;share<br> wrf_core = <span class="hljs-string">&#x27;ARW&#x27;</span>,<br> max_dom = 2,<br> start_date = <span class="hljs-string">&#x27;2006-08-16_12:00:00&#x27;</span>,<span class="hljs-string">&#x27;2006-08-16_12:00:00&#x27;</span>,<br> end_date   = <span class="hljs-string">&#x27;2006-08-16_12:00:00&#x27;</span>,<span class="hljs-string">&#x27;2006-08-16_12:00:00&#x27;</span>,<br> interval_seconds = 21600<br> io_form_geogrid = 2,<br>/<br><br>&amp;geogrid<br> parent_id         =   1,   1,<br> parent_grid_ratio =   1,   3,<br> i_parent_start    =   1,  31,<br> j_parent_start    =   1,  17,<br> e_we              =  129, 127,<br> e_sn              =  65,  64,<br> !<br> !!!!!!!!!!!!!!!!!!!!!!!!!!!! IMPORTANT NOTE !!!!!!!!!!!!!!!!!!!!!!!!!!!!<br> ! The default datasets used to produce the MAXSNOALB and ALBEDO12M<br> ! fields have changed <span class="hljs-keyword">in</span> WPS v4.0. These fields are now interpolated<br> ! from MODIS-based datasets.<br> !<br> ! To match the output given by the default namelist.wps <span class="hljs-keyword">in</span> WPS v3.9.1,<br> ! the following setting <span class="hljs-keyword">for</span> geog_data_res may be used:<br> !<br> ! geog_data_res = <span class="hljs-string">&#x27;maxsnowalb_ncep+albedo_ncep+default&#x27;</span>, <span class="hljs-string">&#x27;maxsnowalb_ncep+albedo_ncep+default&#x27;</span>,<br> !<br> !!!!!!!!!!!!!!!!!!!!!!!!!!!! IMPORTANT NOTE !!!!!!!!!!!!!!!!!!!!!!!!!!!!<br> !<br> geog_data_res = <span class="hljs-string">&#x27;default&#x27;</span>,<span class="hljs-string">&#x27;default&#x27;</span>,<br> map_proj = <span class="hljs-string">&#x27;lat-lon&#x27;</span>,<br> stand_lon = 0.<br> pole_lat = 90.0<br> pole_lon = 0.0<br> geog_data_path = <span class="hljs-string">&#x27;/glade/work/wrfhelp/WPS_GEOG/&#x27;</span><br>/<br> ref_lat = 45.0<br> ref_lon = -98<br> dx = 1.0<br> dy = 1.0<br><br>&amp;ungrib<br> out_format = <span class="hljs-string">&#x27;WPS&#x27;</span>,<br> prefix = <span class="hljs-string">&#x27;FILE&#x27;</span>,<br>/<br><br>&amp;metgrid<br> fg_name = <span class="hljs-string">&#x27;FILE&#x27;</span><br> io_form_metgrid = 2, <br>/<br><br>&amp;mod_levs<br> press_pa = 201300 , 200100 , 100000 , <br>             95000 ,  90000 , <br>             85000 ,  80000 , <br>             75000 ,  70000 , <br>             65000 ,  60000 , <br>             55000 ,  50000 , <br>             45000 ,  40000 , <br>             35000 ,  30000 , <br>             25000 ,  20000 , <br>             15000 ,  10000 , <br>              5000 ,   1000<br>/<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>WRF</category>
      
    </categories>
    
    
    <tags>
      
      <tag>WRF</tag>
      
      <tag>WPS</tag>
      
      <tag>namelist.wps</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>WRF | WRF em_real namelist.input Examples</title>
    <link href="/2023/04/30/WRF_em_real_namelist_input_Examples/"/>
    <url>/2023/04/30/WRF_em_real_namelist_input_Examples/</url>
    
    <content type="html"><![CDATA[<h1 id="wrf-em_real-namelist.input-examples">WRF em_real namelist.input Examples</h1><p>For em_real</p><h2 id="namelist.input.default">namelist.input.default</h2><p>The default namelist.input file for real cases had several settings that go against best practices and recommendations.</p><p><a href="https://github.com/wrf-model/WRF/blob/master/test/em_real/namelist.input.default">WRF/test/em_real/namelist.input.default</a> <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><code class="hljs sh">&amp;time_control<br>run_days                            = 0,! Number of simulation days. DO NOT ADD ADDITIONAL COLUMNS.<br>run_hours                           = 36,! Number of simulation hours. DO NOT ADD ADDITIONAL COLUMNS.<br>run_minutes                         = 0,! Number of simulation minutes. DO NOT ADD ADDITIONAL COLUMNS.<br>run_seconds                         = 0,! Number of simulation seconds. DO NOT ADD ADDITIONAL COLUMNS.<br>! *NOTE: real.exe does not <span class="hljs-built_in">read</span> run_days/hours/minutes/seconds. Only <span class="hljs-built_in">read</span> by wrf.exe<br>! real.exe only reads start_* and end_* parameters.<br>start_year                          = 2019, 2019, 2019,! Starting year of the simulation.<br>start_month                         = 09,   09,   09,! Starting month of the simulation.<br>start_day                           = 04,   04,   24,! Starting day of the simulation.<br>start_hour                          = 12,   12,   12,! Starting hour of the simulation.<br>end_year                            = 2019, 2019, 2019,! Ending year of the simulation.<br>end_month                           = 09,   09,   09,! Ending month of the simulation.<br>end_day                             = 06,   06,   06,! Ending day of the simulation.<br>end_hour                            = 00,   00,   00,! Ending hour of the simulation.<br>interval_seconds                    = 21600! Time interval (s) between input data. DO NOT ADD ADDITIONAL COLUMNS.<br>input_from_file                     = .<span class="hljs-literal">true</span>.,.<span class="hljs-literal">true</span>.,.<span class="hljs-literal">true</span>.,! Logical - whether input files (e.g., met_em*) will be used.<br>history_interval                    = 180,  60,   60,! Interval between <span class="hljs-built_in">history</span> output (mins). *Note: to change the units of history_interval, add _s (secs), _h (hours)<br>frames_per_outfile                  = 1000, 1000, 1000,! Number of <span class="hljs-built_in">history</span> output <span class="hljs-built_in">times</span> printed to each wrf output (wrfout) file.<br>restart                             = .<span class="hljs-literal">false</span>.,! Logical - whether the run is a <span class="hljs-string">&quot;restart&quot;</span> simulation. DO NOT ADD ADDITIONAL COLUMNS.<br>restart_interval                    = 7200,! Interval between restart (wrfrst) files (min). DO NOT ADD ADDITIONAL COLUMNS.<br>io_form_history                     = 2! File format <span class="hljs-keyword">for</span> <span class="hljs-built_in">history</span> (wrfout) files. See Users<span class="hljs-string">&#x27; Guide for options. DO NOT ADD ADDITIONAL COLUMNS.</span><br><span class="hljs-string">io_form_restart                     = 2! File format for restart (wrfrst) files. See Users&#x27;</span> Guide <span class="hljs-keyword">for</span> options. DO NOT ADD ADDITIONAL COLUMNS.<br>io_form_input                       = 2! File format <span class="hljs-keyword">for</span> the input (wrfinput) files. See Users<span class="hljs-string">&#x27; Guide for options. DO NOT ADD ADDITIONAL COLUMNS.</span><br><span class="hljs-string">io_form_boundary                    = 2! File format for the boundary (wrfbdy) file. See Users&#x27;</span> Guide <span class="hljs-keyword">for</span> options. DO NOT ADD ADDITIONAL COLUMNS.<br>/<br><br>&amp;domains<br>time_step                           = 90,! Time step <span class="hljs-keyword">for</span> model integration (s). Must use 6xDX (or less). DO NOT ADD ADDITIONAL COLUMNS.<br>time_step_fract_num                 = 0,! Numerator <span class="hljs-keyword">if</span> using fractional time step. DO NOT ADD ADDITIONAL COLUMNS.<br>time_step_fract_den                 = 1,! Denomenator <span class="hljs-keyword">if</span> using fractional time step. DO NOT ADD ADDITIONAL COLUMNS.<br>max_dom                             = 1,! Total number of domains <span class="hljs-keyword">for</span> the simulation. DO NOT ADD ADDITIONAL COLUMNS.<br>e_we                                = 150,    220,   200,! Number of grid spaces <span class="hljs-keyword">in</span> the x direction (west-east).<br>e_sn                                = 130,    214,   210,! Number of grid spaces <span class="hljs-keyword">in</span> the y direction (south-north).<br>e_vert                              = 45,     45,    45,! Number of full vertical levels. must be the same <span class="hljs-keyword">for</span> all domains.<br>dzstretch_s                         = 1.1! Surface stretch <span class="hljs-built_in">factor</span> when auto_levels_opt = 2 (<span class="hljs-built_in">which</span> is default). DO NOT ADD ADDITIONAL COLUMNS.<br>p_top_requested                     = 5000,! Pressure top (<span class="hljs-keyword">in</span> Pa) to use <span class="hljs-keyword">for</span> the simulation. The input data must go up to this value. DO NOT ADD ADDITIONAL COLUMNS.<br>num_metgrid_levels                  = 34,! Number of vertical levels <span class="hljs-keyword">in</span> the WPS output. DO NOT ADD ADDITIONAL COLUMNS.<br>num_metgrid_soil_levels             = 4,! Number of soil levels <span class="hljs-keyword">in</span> the WPS output. DO NOT ADD ADDITIONAL COLUMNS.<br>dx                                  = 15000,! Length (m) of each grid <span class="hljs-keyword">in</span> the x (west-east) direction (resolution). DO NOT ADD ADDITIONAL COLUMNS. <br>dy                                  = 15000,! Length (m) of each grid <span class="hljs-keyword">in</span> the y (south-north) direction (resolution). DO NOT ADD ADDITIONAL COLUMNS.  <br>grid_id                             = 1,     2,     3,! Identifier number of each domain.<br>parent_id                           = 0,     1,     2,! The ID of the parent of each domain.<br>i_parent_start                      = 1,     53,    30,! Starting location of the lower left corner i-indice within the parent domain.<br>j_parent_start                      = 1,     25,    30,! Starting location of the lower left corner j-indice within the parent domain.<br>parent_grid_ratio                   = 1,     3,     3,! Ratio of the parent to nest grid size (resolution).<br>parent_time_step_ratio              = 1,     3,     3,! Time_step ratio of the parent to nest.<br>feedback                            = 1,! Switch <span class="hljs-keyword">for</span> feedback from the nest to it<span class="hljs-string">&#x27;s parent at corresponding grid points (1=on;0=off). DO NOT ADD ADDITIONAL COLUMNS.</span><br><span class="hljs-string">smooth_option                       = 0! Smoothing option for the boundary between parent and nest domains (when feedback=1). DO NOT ADD ADDITIONAL COLUMNS.</span><br><span class="hljs-string">/</span><br><span class="hljs-string"></span><br><span class="hljs-string">&amp;physics</span><br><span class="hljs-string">physics_suite                       = &#x27;</span>CONUS<span class="hljs-string">&#x27;! Physics suite option (CONUS or tropical). See Users&#x27;</span> Guide <span class="hljs-keyword">for</span> details. DO NOT ADD ADDITIONAL COLUMNS.<br>mp_physics                          = -1,    -1,    -1,! Microphysics scheme. See Users<span class="hljs-string">&#x27; Guide for options (-1=option from suite). Every domain must be the same.</span><br><span class="hljs-string">cu_physics                          = -1,    -1,     0,! Cumulus scheme. See Users&#x27;</span> Guide <span class="hljs-keyword">for</span> options (-1=option from suite).<br>ra_lw_physics                       = -1,    -1,    -1,! Longwave radiation scheme. See Users<span class="hljs-string">&#x27; Guide for options (-1=option from suite). Every domain must be the same.</span><br><span class="hljs-string">ra_sw_physics                       = -1,    -1,    -1,! Shortwave radiation scheme. See Users&#x27;</span> Guide <span class="hljs-keyword">for</span> options (-1=option from suite). Every domain must be the same.<br>bl_pbl_physics                      = -1,    -1,    -1,! PBL scheme. See Users<span class="hljs-string">&#x27; Guide for options (-1=option from suite).</span><br><span class="hljs-string">sf_sfclay_physics                   = -1,    -1,    -1,! Surface layer scheme. See Users&#x27;</span> Guide <span class="hljs-keyword">for</span> options (-1=option from suite). Every domain must be the same.<br>sf_surface_physics                  = -1,    -1,    -1,! LSM scheme. See Users<span class="hljs-string">&#x27; Guide for options (-1=option from suite). Every domain must be the same.</span><br><span class="hljs-string">radt                                = 15,    15,    15,! Minutes between radiation physics calls (recommended 1 min per km of d01 dx). Every domain must be the same.</span><br><span class="hljs-string">bldt                                = 0,     0,     0,! Minutes between boundary-layer physics calls (recommended 0=every time step). Every domain must be the same.</span><br><span class="hljs-string">cudt                                = 0,     0,     0,! Minutes between cumulus physics calls. Set to 0 (called every time step) for all cumulus schemes except Kain-Fritsch.  Every domain must be the same.</span><br><span class="hljs-string">icloud                              = 1,! Option to couple subgrid-scale clouds from the PBL scheme to radiation schemes (only works with RRTM/RRTMG rad schemes). See Users&#x27;</span> Guide <span class="hljs-keyword">for</span> options. DO NOT ADD ADDITIONAL COLUMNS.<br>num_land_cat                        = 21,! Number of land categories from WPS input data. See Users<span class="hljs-string">&#x27; Guide for details. DO NOT ADD ADDITIONAL COLUMNS.</span><br><span class="hljs-string">sf_urban_physics                    = 0,     0,     0,! Option for activating urban canopy model (only for Noah LSM). See Users&#x27;</span> Guide <span class="hljs-keyword">for</span> details. Use same value <span class="hljs-keyword">for</span> all domains. <br>/<br><br>&amp;fdda<br>/<br><br>&amp;dynamics<br>hybrid_opt                          = 2,! Hybrid coordinate option (2=Klemp cubic form with etac; default beginning V4.0). DO NOT ADD ADDITIONAL COLUMNS. <br>w_damping                           = 0,! Vertical velocity damping flag (0=off;1=on). DO NOT ADD ADDITIONAL COLUMNS.<br>diff_opt                            = 2,      2,      2,! Turbulence and mixing option. See Users<span class="hljs-string">&#x27; Guide for options. </span><br><span class="hljs-string">km_opt                              = 4,      4,      4,! Eddy coefficient option. See Users&#x27;</span> Guide <span class="hljs-keyword">for</span> options.<br>diff_6th_opt                        = 0,      0,      0,! 6th order numerical diffusion option. See Users<span class="hljs-string">&#x27; Guide for options.</span><br><span class="hljs-string">diff_6th_factor                     = 0.12,   0.12,   0.12,! 6th order numerical diffusion non-dimensional rate (max 1.0 = complete removal of 2dx wave in 1 timestep). </span><br><span class="hljs-string">base_temp                           = 290.! Base state temp (K). For real cases only. DO NOT ADD ADDITIONAL COLUMNS.</span><br><span class="hljs-string">damp_opt                            = 3,! Upper-level damping option. See Users&#x27;</span> Guide <span class="hljs-keyword">for</span> options. DO NOT ADD ADDITIONAL COLUMNS.<br>zdamp                               = 5000.,  5000.,  5000.,! Damping depth (m) from model top.<br>dampcoef                            = 0.2,    0.2,    0.2,! Damping coefficient corresponding to damp_opt. See Users<span class="hljs-string">&#x27; Guide for details.</span><br><span class="hljs-string">khdif                               = 0,      0,      0,! Horizontal diffusion constant (m^2/s)</span><br><span class="hljs-string">kvdif                               = 0,      0,      0,! Vertical diffusion constant (m^2/s)</span><br><span class="hljs-string">non_hydrostatic                     = .true., .true., .true.,! Set to false to run the model hydrostatically.</span><br><span class="hljs-string">moist_adv_opt                       = 1,      1,      1,     ! Advection option for moisture. See Users&#x27;</span> Guide <span class="hljs-keyword">for</span> details.<br>scalar_adv_opt                      = 1,      1,      1,     ! Advection option <span class="hljs-keyword">for</span> scalars. See Users<span class="hljs-string">&#x27; Guide for details.</span><br><span class="hljs-string">gwd_opt                             = 1,      1,      0,! Switch for gravity wave drag option (1=on;0=off)</span><br><span class="hljs-string">/</span><br><span class="hljs-string"></span><br><span class="hljs-string">&amp;bdy_control</span><br><span class="hljs-string">spec_bdy_width                      = 5,! Total number of rows for specified boundary value nudging for real cases only. DO NOT ADD ADDITIONAL COLUMNS.</span><br><span class="hljs-string">specified                           = .true.! Specified boundary condition for real cases only. DO NOT ADD ADDITIONAL COLUMNS.</span><br><span class="hljs-string">/</span><br><span class="hljs-string"></span><br><span class="hljs-string">&amp;grib2</span><br><span class="hljs-string">/</span><br><span class="hljs-string"></span><br><span class="hljs-string">&amp;namelist_quilt</span><br><span class="hljs-string">nio_tasks_per_group = 0,! Number of I/O tasks per group for quilting. 0=no quilting. DO NOT ADD ADDITIONAL COLUMNS.</span><br><span class="hljs-string">nio_groups = 1,! Number of I/O groups for quilting. DO NOT ADD ADDITIONAL COLUMNS.</span><br><span class="hljs-string">/</span><br></code></pre></td></tr></table></figure></p><h2 id="examples.namelist-many-cases">examples.namelist (Many cases)</h2><p><a href="https://github.com/wrf-model/WRF/blob/master/test/em_real/examples.namelist">Git em_real/examples.namelist</a></p><blockquote><p>Note, this is not a namelist.input file. <strong>Find what interests you, and cut and paste them to your own namelist.input file.</strong> For more information on these namelist parameters, please see run/README.namelist or Chapter 5 of the User's Guide.</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br></pre></td><td class="code"><pre><code class="hljs sh">Note, this is not a namelist.input file. Find what interests you, and <span class="hljs-built_in">cut</span> and <span class="hljs-built_in">paste</span> them <br>      to your own namelist.input file. For more information on these namelist parameters,<br>      please see run/README.namelist or Chapter 5 of the User<span class="hljs-string">&#x27;s Guide.</span><br><span class="hljs-string"></span><br><span class="hljs-string">** More options for real in namelist record &amp;domains:</span><br><span class="hljs-string"></span><br><span class="hljs-string"> p_top_requested                     = 5000</span><br><span class="hljs-string"> interp_type                         = 2</span><br><span class="hljs-string"> extrap_type                         = 2</span><br><span class="hljs-string"> t_extrap_type                       = 2</span><br><span class="hljs-string"> lowest_lev_from_sfc                 = .false.</span><br><span class="hljs-string"> use_levels_below_ground             = .true.</span><br><span class="hljs-string"> use_surface                         = .true.</span><br><span class="hljs-string"> lagrange_order                      = 2</span><br><span class="hljs-string"> force_sfc_in_vinterp                = 1</span><br><span class="hljs-string"> zap_close_levels                    = 500</span><br><span class="hljs-string"> sfcp_to_sfcp                        = .false.</span><br><span class="hljs-string"> adjust_heights                      = .false.</span><br><span class="hljs-string"> smooth_cg_topo                      = .false.</span><br><span class="hljs-string"> eta_levels                          = 1.000, 0.990, 0.978, 0.964, 0.946,</span><br><span class="hljs-string">                                       0.922, 0.894, 0.860, 0.817, 0.766,</span><br><span class="hljs-string">                                       0.707, 0.644, 0.576, 0.507, 0.444,</span><br><span class="hljs-string">                                       0.380, 0.324, 0.273, 0.228, 0.188,</span><br><span class="hljs-string">                                       0.152, 0.121, 0.093, 0.069, 0.048,</span><br><span class="hljs-string">                                       0.029, 0.014, 0.000,</span><br><span class="hljs-string"></span><br><span class="hljs-string">** Using sst_update option (add these to namelist records &amp;time_control and</span><br><span class="hljs-string">   &amp;physics respectively):</span><br><span class="hljs-string"></span><br><span class="hljs-string"> &amp;time_control</span><br><span class="hljs-string"> auxinput4_inname                    = &quot;wrflowinp_d&lt;domain&gt;&quot;</span><br><span class="hljs-string"> auxinput4_interval                  = 360, 360, 360, </span><br><span class="hljs-string"> io_form_auxinput4                   = 2</span><br><span class="hljs-string"></span><br><span class="hljs-string"> &amp;physics</span><br><span class="hljs-string"> sst_update                          = 1,</span><br><span class="hljs-string"></span><br><span class="hljs-string">** Using qna_update option (add these to namelist records &amp;time_control and</span><br><span class="hljs-string">   &amp;physics respectively):</span><br><span class="hljs-string"></span><br><span class="hljs-string"> &amp;time_control</span><br><span class="hljs-string"> auxinput17_inname                   = &quot;wrfqnainp_d&lt;domain&gt;&quot;</span><br><span class="hljs-string"> auxinput17_interval                 = 360, 360, 360,</span><br><span class="hljs-string"> io_form_auxinput17                  = 2</span><br><span class="hljs-string"></span><br><span class="hljs-string"> &amp;physics</span><br><span class="hljs-string"> qna_update                          = 1,</span><br><span class="hljs-string"></span><br><span class="hljs-string">** Using Noah-MP option (Use sf_surface_physics option = 4, and add</span><br><span class="hljs-string">   &amp;noah_mp namelist record)</span><br><span class="hljs-string"></span><br><span class="hljs-string">&amp;physics</span><br><span class="hljs-string">   sf_surface_physics = 4</span><br><span class="hljs-string"></span><br><span class="hljs-string">&amp;noah_mp</span><br><span class="hljs-string"> dveg     = 4,</span><br><span class="hljs-string"> opt_crs  = 1,</span><br><span class="hljs-string"> opt_btr  = 1,</span><br><span class="hljs-string"> opt_run  = 1,</span><br><span class="hljs-string"> opt_sfc  = 1, </span><br><span class="hljs-string"> opt_frz  = 1, </span><br><span class="hljs-string"> opt_inf  = 1, </span><br><span class="hljs-string"> opt_rad  = 3, </span><br><span class="hljs-string"> opt_alb  = 2,</span><br><span class="hljs-string"> opt_snf  = 1,</span><br><span class="hljs-string"> opt_tbot = 2, </span><br><span class="hljs-string"> opt_stc  = 1,</span><br><span class="hljs-string">/</span><br><span class="hljs-string"></span><br><span class="hljs-string">** Using UCM urban model</span><br><span class="hljs-string">&amp;physics</span><br><span class="hljs-string"> sf_urban_physics                    = 1,      1,     1,</span><br><span class="hljs-string"></span><br><span class="hljs-string">** Using BEP urban model</span><br><span class="hljs-string">&amp;physics</span><br><span class="hljs-string"> sf_urban_physics                    = 2,      2,     2,</span><br><span class="hljs-string"></span><br><span class="hljs-string">** Using BEM urban model</span><br><span class="hljs-string">&amp;physics</span><br><span class="hljs-string"> sf_urban_physics                    = 3,      3,     3,</span><br><span class="hljs-string"></span><br><span class="hljs-string">** Using lake model</span><br><span class="hljs-string">&amp;physics</span><br><span class="hljs-string"> sf_lake_physics                     = 1,      1,     1,</span><br><span class="hljs-string"> lakedepth_default                   = 50.,    50.,   50.,</span><br><span class="hljs-string"> lake_min_elev                       = 5.,     5.,    5.,</span><br><span class="hljs-string"></span><br><span class="hljs-string">** Using shallow water roughness (constant depth)</span><br><span class="hljs-string">&amp;physics</span><br><span class="hljs-string">shalwater_z0                        = 1,       1,     1, </span><br><span class="hljs-string">shalwater_depth                     = 40.0,</span><br><span class="hljs-string"></span><br><span class="hljs-string">** Using shallow water roughness (with bathymetry data)</span><br><span class="hljs-string">&amp;physics</span><br><span class="hljs-string">shalwater_z0                        = 1,       1,     1, </span><br><span class="hljs-string">shalwater_depth                     = 0.0,</span><br><span class="hljs-string"></span><br><span class="hljs-string">** Using stochastic backscatter scheme (new namelist record since v3.6)</span><br><span class="hljs-string"></span><br><span class="hljs-string">&amp;stoch</span><br><span class="hljs-string"> stoch_force_opt                     = 1,        1,        1,</span><br><span class="hljs-string"> stoch_vertstruc_opt                 = 0,        0,        0,</span><br><span class="hljs-string"> tot_backscat_psi                    = 1.E-05,   1.E-05,   1.E-05,</span><br><span class="hljs-string"> tot_backscat_t                      = 1.E-06,   1.E-06,   1.E-06,</span><br><span class="hljs-string"> nens                                = 1,</span><br><span class="hljs-string"> ztau_psi                            = 10800.0,</span><br><span class="hljs-string"> ztau_t                              = 10800.0,</span><br><span class="hljs-string"> rexponent_psi                       =-1.83,</span><br><span class="hljs-string"> rexponent_t                         =-1.83,</span><br><span class="hljs-string"> zsigma2_eps                         = 0.0833,</span><br><span class="hljs-string"> zsigma2_eta                         = 0.0833,</span><br><span class="hljs-string"> kminforc                            = 1,</span><br><span class="hljs-string"> kminforc                            = 1,</span><br><span class="hljs-string"> kminforct                           = 1,</span><br><span class="hljs-string"> lminforct                           = 1,</span><br><span class="hljs-string"> kmaxforc                            = 1000000,</span><br><span class="hljs-string"> lmaxforc                            = 1000000,</span><br><span class="hljs-string"> kmaxforct                           = 1000000,</span><br><span class="hljs-string"> lmaxforct                           = 1000000,</span><br><span class="hljs-string"> perturb_bdy                         = 0,</span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string">** Using DFI options (note this is a separate namelist record):</span><br><span class="hljs-string"></span><br><span class="hljs-string"> &amp;dfi_control</span><br><span class="hljs-string"> dfi_opt                             = 3,</span><br><span class="hljs-string"> dfi_nfilter                         = 7,</span><br><span class="hljs-string"> dfi_cutoff_seconds                  = 3600,</span><br><span class="hljs-string"> dfi_write_filtered_input            = .true.</span><br><span class="hljs-string"> dfi_write_dfi_history               = .false.</span><br><span class="hljs-string"> dfi_bckstop_year                    = 2000,</span><br><span class="hljs-string"> dfi_bckstop_month                   = 01,</span><br><span class="hljs-string"> dfi_bckstop_day                     = 24,</span><br><span class="hljs-string"> dfi_bckstop_hour                    = 10,</span><br><span class="hljs-string"> dfi_bckstop_minute                  = 00,</span><br><span class="hljs-string"> dfi_bckstop_second                  = 00,</span><br><span class="hljs-string"> dfi_fwdstop_year                    = 2000,</span><br><span class="hljs-string"> dfi_fwdstop_month                   = 01,</span><br><span class="hljs-string"> dfi_fwdstop_day                     = 24,</span><br><span class="hljs-string"> dfi_fwdstop_hour                    = 13,</span><br><span class="hljs-string"> dfi_fwdstop_minute                  = 00,</span><br><span class="hljs-string"> dfi_fwdstop_second                  = 00,</span><br><span class="hljs-string"> /</span><br><span class="hljs-string"></span><br><span class="hljs-string"> &amp;domains</span><br><span class="hljs-string"> time_step_dfi                       = 60</span><br><span class="hljs-string"></span><br><span class="hljs-string">** Using gridded nudging option (note this is a separate namelist record) for</span><br><span class="hljs-string">   upperair nudging</span><br><span class="hljs-string"></span><br><span class="hljs-string">** Upper air gridded nudging requires an file generated by the real</span><br><span class="hljs-string">   program.  Activating grid_fdda for the real program is adequate.</span><br><span class="hljs-string"></span><br><span class="hljs-string"> &amp;fdda</span><br><span class="hljs-string"> grid_fdda                           = 1,     1,     1,</span><br><span class="hljs-string"> gfdda_inname                        = &quot;wrffdda_d&lt;domain&gt;&quot;,</span><br><span class="hljs-string"> gfdda_end_h                         = 24,    24,    24,</span><br><span class="hljs-string"> gfdda_interval_m                    = 360,   360,   360,</span><br><span class="hljs-string"> fgdt                                = 0,     0,     0,</span><br><span class="hljs-string"> if_no_pbl_nudging_uv                = 0,     0,     0,</span><br><span class="hljs-string"> if_no_pbl_nudging_t                 = 1,     1,     1,</span><br><span class="hljs-string"> if_no_pbl_nudging_q                 = 1,     1,     1,</span><br><span class="hljs-string"> if_zfac_uv                          = 0,     0,     0,</span><br><span class="hljs-string">  k_zfac_uv                          = 10,   10,    10,</span><br><span class="hljs-string"> if_zfac_t                           = 0,     0,     0,</span><br><span class="hljs-string">  k_zfac_t                           = 10,   10,    10,</span><br><span class="hljs-string"> if_zfac_q                           = 0,     0,     0,</span><br><span class="hljs-string">  k_zfac_q                           = 10,   10,    10,</span><br><span class="hljs-string"> guv                                 = 0.0003,     0.0003,     0.0003,</span><br><span class="hljs-string"> gt                                  = 0.0003,     0.0003,     0.0003,</span><br><span class="hljs-string"> gq                                  = 0.0003,     0.0003,     0.0003,</span><br><span class="hljs-string"> if_ramping                          = 1,</span><br><span class="hljs-string"> dtramp_min                          = 60.0,</span><br><span class="hljs-string"> io_form_gfdda                       = 2,</span><br><span class="hljs-string"></span><br><span class="hljs-string">** Using gridded surface nudging option (note this is a separate namelist </span><br><span class="hljs-string">   record)</span><br><span class="hljs-string"></span><br><span class="hljs-string">** Note that upper-air and surface gridded nudging may be used together </span><br><span class="hljs-string">   or separately.  Surface nudging requires an input file generated by the</span><br><span class="hljs-string">   obsgrid program.</span><br><span class="hljs-string"></span><br><span class="hljs-string"> &amp;fdda</span><br><span class="hljs-string"> grid_sfdda                          = 1,     1,     1,</span><br><span class="hljs-string"> sgfdda_inname                       = &quot;wrfsfdda_d&lt;domain&gt;&quot;,</span><br><span class="hljs-string"> sgfdda_end_h                        = 24,    24,    24,</span><br><span class="hljs-string"> sgfdda_interval_m                   = 360,   360,   360,</span><br><span class="hljs-string"> io_form_sgfdda                      = 2,</span><br><span class="hljs-string"> guv_sfc                             = 0.0003,     0.0003,     0.0003,</span><br><span class="hljs-string"> gt_sfc                              = 0.0003,     0.0003,     0.0003,</span><br><span class="hljs-string"> gq_sfc                              = 0.0003,     0.0003,     0.0003,</span><br><span class="hljs-string"> rinblw                              = 250.,       250.,       250., </span><br><span class="hljs-string"></span><br><span class="hljs-string">** Using observation nudging option (note &amp;fdda is a separate namelist record):</span><br><span class="hljs-string"></span><br><span class="hljs-string"> &amp;time_control</span><br><span class="hljs-string"> auxinput11_interval_s               = 180 , 180 , 180</span><br><span class="hljs-string"> auxinput11_end_h                    = 6   , 6   , 6</span><br><span class="hljs-string"></span><br><span class="hljs-string"> &amp;fdda</span><br><span class="hljs-string"> obs_nudge_opt                       = 1,1,1,</span><br><span class="hljs-string"> max_obs                             = 150000,</span><br><span class="hljs-string"> fdda_start                          = 0.,  0.,  0.,</span><br><span class="hljs-string"> fdda_end                            = 720.,720.,720.,</span><br><span class="hljs-string"> obs_nudge_wind                      = 1,1,1,</span><br><span class="hljs-string"> obs_coef_wind                       = 6.E-4,6.E-4,6.E-4,</span><br><span class="hljs-string"> obs_nudge_temp                      = 1,1,1,</span><br><span class="hljs-string"> obs_coef_temp                       = 6.E-4,6.E-4,6.E-4,</span><br><span class="hljs-string"> obs_nudge_mois                      = 1,1,1,</span><br><span class="hljs-string"> obs_coef_mois                       = 6.E-4,6.E-4,6.E-4,</span><br><span class="hljs-string"> obs_rinxy                           = 240.,240.,180.,</span><br><span class="hljs-string"> obs_rinsig                          = 0.1,</span><br><span class="hljs-string"> obs_twindo                          = 0.6666667,0.6666667,0.6666667,</span><br><span class="hljs-string"> obs_npfi                            = 10,</span><br><span class="hljs-string"> obs_ionf                            = 2, 2, 2,</span><br><span class="hljs-string"> obs_idynin                          = 0,</span><br><span class="hljs-string"> obs_dtramp                          = 40.,</span><br><span class="hljs-string"> obs_prt_freq                        = 10, 10, 10,</span><br><span class="hljs-string"> obs_prt_max                         = 10</span><br><span class="hljs-string"> obs_ipf_errob                       = .true.</span><br><span class="hljs-string"> obs_ipf_nudob                       = .true.</span><br><span class="hljs-string"> obs_ipf_in4dob                      = .true</span><br><span class="hljs-string"> obs_no_pbl_nudge_uv                 = 0</span><br><span class="hljs-string"> obs_no_pbl_nudge_t                  = 0</span><br><span class="hljs-string"> obs_no_pbl_nudge_q                  = 0</span><br><span class="hljs-string"> obs_sfc_scheme_horiz                = 0</span><br><span class="hljs-string"> obs_sfc_scheme_vert                 = 0</span><br><span class="hljs-string"> obs_max_sndng_gap                   = 20</span><br><span class="hljs-string"> obs_nudgezfullr1_uv                 = 50</span><br><span class="hljs-string"> obs_nudgezrampr1_uv                 = 50</span><br><span class="hljs-string"> obs_nudgezfullr2_uv                 = 50</span><br><span class="hljs-string"> obs_nudgezrampr2_uv                 = 50</span><br><span class="hljs-string"> obs_nudgezfullr4_uv                 = -5000</span><br><span class="hljs-string"> obs_nudgezrampr4_uv                 = 50  </span><br><span class="hljs-string"> obs_nudgezfullr1_t                  = 50 </span><br><span class="hljs-string"> obs_nudgezrampr1_t                  = 50</span><br><span class="hljs-string"> obs_nudgezfullr2_t                  = 50</span><br><span class="hljs-string"> obs_nudgezrampr2_t                  = 50</span><br><span class="hljs-string"> obs_nudgezfullr4_t                  = -5000</span><br><span class="hljs-string"> obs_nudgezrampr4_t                  = 50  </span><br><span class="hljs-string"> obs_nudgezfullr1_q                  = 50 </span><br><span class="hljs-string"> obs_nudgezrampr1_q                  = 50</span><br><span class="hljs-string"> obs_nudgezfullr2_q                  = 50</span><br><span class="hljs-string"> obs_nudgezrampr2_q                  = 50</span><br><span class="hljs-string"> obs_nudgezfullr4_q                  = -5000</span><br><span class="hljs-string"> obs_nudgezrampr4_q                  = 50</span><br><span class="hljs-string"> obs_nudgezfullmin                   = 50</span><br><span class="hljs-string"> obs_nudgezrampmin                   = 50</span><br><span class="hljs-string"> obs_nudgezmax                       = 3000</span><br><span class="hljs-string"> obs_sfcfact                         = 1.0</span><br><span class="hljs-string"> obs_sfcfacr                         = 1.0</span><br><span class="hljs-string"> obs_dpsmx                           = 7.5</span><br><span class="hljs-string"> /</span><br><span class="hljs-string"></span><br><span class="hljs-string">** Using spectral nudging option </span><br><span class="hljs-string"></span><br><span class="hljs-string"> &amp;fdda</span><br><span class="hljs-string"> grid_fdda                           = 2,     2,     2,</span><br><span class="hljs-string"> gfdda_inname                        = &quot;wrffdda_d&lt;domain&gt;&quot;,</span><br><span class="hljs-string"> gfdda_end_h                         = 24,    24,    24,</span><br><span class="hljs-string"> gfdda_interval_m                    = 360,   360,   360,</span><br><span class="hljs-string"> fgdt                                = 0,     0,     0,</span><br><span class="hljs-string"> fgdtzero                            = 0,     0,     0,</span><br><span class="hljs-string"> if_no_pbl_nudging_uv                = 0,     0,     0,</span><br><span class="hljs-string"> if_no_pbl_nudging_t                 = 0,     0,     0,</span><br><span class="hljs-string"> if_no_pbl_nudging_ph                = 0,     0,     0,</span><br><span class="hljs-string"> if_zfac_uv                          = 0,     0,     0,</span><br><span class="hljs-string">  k_zfac_uv                          = 10,   10,    10,</span><br><span class="hljs-string"> if_zfac_t                           = 0,     0,     0,</span><br><span class="hljs-string">  k_zfac_t                           = 10,   10,    10,</span><br><span class="hljs-string"> if_zfac_ph                          = 0,     0,     0,</span><br><span class="hljs-string">  k_zfac_ph                          = 10,   10,    10,</span><br><span class="hljs-string"> dk_zfac_uv                          = 1,     1,     1,</span><br><span class="hljs-string"> dk_zfac_t                           = 1,     1,     1,</span><br><span class="hljs-string"> dk_zfac_ph                          = 1,     1,     1,</span><br><span class="hljs-string"> guv                                 = 0.0003,     0.0003,     0.0003,</span><br><span class="hljs-string"> gt                                  = 0.0003,     0.0003,     0.0003,</span><br><span class="hljs-string"> gph                                 = 0.0003,     0.0003,     0.0003,</span><br><span class="hljs-string"> xwavenum                            = 3,</span><br><span class="hljs-string"> ywavenum                            = 3,</span><br><span class="hljs-string"> if_ramping                          = 1,</span><br><span class="hljs-string"> dtramp_min                          = 60.0,</span><br><span class="hljs-string"> io_form_gfdda                       = 2,</span><br><span class="hljs-string"></span><br><span class="hljs-string">** Using adaptive time step option (add these in namelist record &amp;domains):</span><br><span class="hljs-string"></span><br><span class="hljs-string"> use_adaptive_time_step              = .true.,</span><br><span class="hljs-string"> step_to_output_time                 = .true.,</span><br><span class="hljs-string"> target_cfl                          = 1.2, 1.2, 1.2,</span><br><span class="hljs-string"> target_hcfl                         = .84, .84, .84,</span><br><span class="hljs-string"> max_step_increase_pct               = 5,   51,  51,</span><br><span class="hljs-string"> starting_time_step                  = -1,  -1,  -1,</span><br><span class="hljs-string"> max_time_step                       = 360, 120, 40,</span><br><span class="hljs-string"> min_time_step                       =  90,  30, 10,</span><br><span class="hljs-string"> adaptation_domain                   =  1,</span><br><span class="hljs-string"></span><br><span class="hljs-string">** Using automatic vortex-following option (tropical storm tracking only;</span><br><span class="hljs-string">   add these in namelist record &amp;domains):</span><br><span class="hljs-string"></span><br><span class="hljs-string"> vortex_interval                     = 15, 15, 15,</span><br><span class="hljs-string"> max_vortex_speed                    = 40, 40, 40,</span><br><span class="hljs-string"> corral_dist                         =  8, 15, 15,</span><br><span class="hljs-string"> track_level                         = 50000,</span><br><span class="hljs-string"></span><br><span class="hljs-string">** Miscellaneous physics options for namelist record &amp;physics:</span><br><span class="hljs-string"></span><br><span class="hljs-string">Topographic shading (only effective when grid sizes are a few kilometers)</span><br><span class="hljs-string"></span><br><span class="hljs-string"> slope_rad                           = 1,     1,     1,</span><br><span class="hljs-string"> topo_shading                        = 1,     1,     1,</span><br><span class="hljs-string"> shadlen                             = 25000, </span><br><span class="hljs-string"></span><br><span class="hljs-string">Setting threshold value for defining seaice if seaice is not in the input file:</span><br><span class="hljs-string"></span><br><span class="hljs-string"> seaice_threshold                    = 271,</span><br><span class="hljs-string"></span><br><span class="hljs-string">Switching off latent heating from a microphysics scheme (must also set cu_physics = 0):</span><br><span class="hljs-string"></span><br><span class="hljs-string"> no_mp_heating                       = 0,</span><br><span class="hljs-string"></span><br><span class="hljs-string">** Using precipiatiion bucket in a time interval (minutes):</span><br><span class="hljs-string"></span><br><span class="hljs-string"> prec_acc_dt                         = 60.</span><br><span class="hljs-string"></span><br><span class="hljs-string">** Using bucket accumulations for multi-year simulations (guideline: mean monthly accumulation)</span><br><span class="hljs-string"></span><br><span class="hljs-string"> bucket_mm                           = 100.</span><br><span class="hljs-string"> bucket_J                            = 1.e9</span><br><span class="hljs-string"></span><br><span class="hljs-string">** Optional gravitational settling of fog/cloud droplets (MYNN PBL only)</span><br><span class="hljs-string"></span><br><span class="hljs-string"> grav_settling                       = 1,       ; default 0</span><br><span class="hljs-string"></span><br><span class="hljs-string">** Using implicit gravity-wave damping option (add these in namelist record &amp;dynamics):</span><br><span class="hljs-string"></span><br><span class="hljs-string"> damp_opt                            = 3,</span><br><span class="hljs-string"> zdamp                               = 5000.,  5000.,  5000.,</span><br><span class="hljs-string"> dampcoef                            = 0.2,    0.2,    0.2</span><br><span class="hljs-string"></span><br><span class="hljs-string">** Using expanded boundary zone and exponential decay option (add or modify these in</span><br><span class="hljs-string">    namelist record &amp;bdy_control). </span><br><span class="hljs-string">    spec_zone is ALWAYS = 1 </span><br><span class="hljs-string">    relax_zone is ALWAYS = spec_bdy_width - spec_zone</span><br><span class="hljs-string"></span><br><span class="hljs-string">&amp;bdy_control</span><br><span class="hljs-string"> spec_bdy_width                      = 10,</span><br><span class="hljs-string"> specified                           = .true.,</span><br><span class="hljs-string"> spec_exp                            = 0.33</span><br><span class="hljs-string"></span><br><span class="hljs-string">For a tropical channel configuration, set the following:</span><br><span class="hljs-string"></span><br><span class="hljs-string"> specified                           = .true.,</span><br><span class="hljs-string"> periodic_x                          = .true.,</span><br><span class="hljs-string"></span><br><span class="hljs-string">** Using split lateral boundary files</span><br><span class="hljs-string">     The run-time flag multi_bdy_files must be set to TRUE (default is false), and the</span><br><span class="hljs-string">     lateral boundary files must have a date associated. When using the split LBC option,</span><br><span class="hljs-string">     there is ALWAYS and ONLY a single time LBC time in each file.</span><br><span class="hljs-string"></span><br><span class="hljs-string"> multi_bdy_files                     = .true.</span><br><span class="hljs-string"></span><br><span class="hljs-string">Also requires</span><br><span class="hljs-string">&amp;time_control</span><br><span class="hljs-string"> bdy_inname                          = &quot;wrfbdy_d&lt;domain&gt;_&lt;date&gt;&quot;</span><br><span class="hljs-string"></span><br><span class="hljs-string">** using io quilting option to improve output efficiency for large domain runs</span><br><span class="hljs-string">    (note that this is a separate namelist record):</span><br><span class="hljs-string"></span><br><span class="hljs-string"> &amp;namelist_quilt</span><br><span class="hljs-string"> nio_tasks_per_group = 2,</span><br><span class="hljs-string"> nio_groups = 1,</span><br><span class="hljs-string"></span><br><span class="hljs-string">** for tc bogusing:</span><br><span class="hljs-string">   Helpful hints</span><br><span class="hljs-string">   1) The TC bogus *MUST* only be run with a single processor: serial </span><br><span class="hljs-string">      (with or without a nest build option), or as a DM build with np=1.</span><br><span class="hljs-string">   2) Run the TC program for only the initial model time. Remember to copy </span><br><span class="hljs-string">      your metgrid file to a safe location and then let the TC scheme </span><br><span class="hljs-string">      generate the auxiliary files.</span><br><span class="hljs-string">   3) The TC program does not handle soil moisture or soil temperature </span><br><span class="hljs-string">      correctly. After running the TC program, use an NCL script to put the </span><br><span class="hljs-string">      modified fields back into the original metgrid file (remember that you</span><br><span class="hljs-string">      are keeping a pristine copy elsewhere). The modified fields to copy</span><br><span class="hljs-string">      are:  &quot;RH&quot;, &quot;TT&quot;, &quot;UU&quot;, &quot;VV&quot;, &quot;GHT&quot;, &quot;PRES&quot;, &quot;PMSL&quot;, &quot;PSFC&quot;.</span><br><span class="hljs-string">   4) The TC program runs quickly, only a few seconds. It is a good idea to </span><br><span class="hljs-string">      process multiple runs, and vary the TC initialization. It would be </span><br><span class="hljs-string">      reasonable to select the maximum wind speed (vmax_meters_per_second) </span><br><span class="hljs-string">      from 30 to 60 by 5, select the radius of maximum winds ((m), rmax) = </span><br><span class="hljs-string">      50000 to 200000 by 50000, and select a tuning parameter for the </span><br><span class="hljs-string">      vortex (vmax_ratio) = 0.5 to 0.9 by 0.1. Look at the resulting </span><br><span class="hljs-string">      bogus storms (sea level pressure, surface wind speeds, and </span><br><span class="hljs-string">      overall storm size), and choose the best.  </span><br><span class="hljs-string">   5) Remember to also consider starting the TC program at a later or</span><br><span class="hljs-string">      earlier time during your parameter space exploration.</span><br><span class="hljs-string">   6) The bogus storm will organize better if the initialization of the</span><br><span class="hljs-string">      tropical storm is entirely over water, and if the storm is able to </span><br><span class="hljs-string">      develop over water for several days.</span><br><span class="hljs-string">   7) After the metgrid file is finalized, and the real program is run,</span><br><span class="hljs-string">      use DFI in WRF. Removing and then introducing an entire bogus typhoon</span><br><span class="hljs-string">      is the definition of unbalanced. Running DFI for 2-3 hours back and forth</span><br><span class="hljs-string">      will be a benefit. For a successful implementation of a TC bogus storm in </span><br><span class="hljs-string">      WRF, the storm should not oscillate in size, should not be radiating </span><br><span class="hljs-string">      massive amounts of gravity waves, and should not rapidly weaken.</span><br><span class="hljs-string"></span><br><span class="hljs-string"> &amp;tc</span><br><span class="hljs-string"> insert_bogus_storm                  = .true.,</span><br><span class="hljs-string"> remove_storm                        = .false.,</span><br><span class="hljs-string"> num_storm                           = 1,</span><br><span class="hljs-string"> latc_loc                            = 15.,</span><br><span class="hljs-string"> lonc_loc                            = -90.,</span><br><span class="hljs-string"> vmax_meters_per_second              = 30,</span><br><span class="hljs-string"> rmax                                = 50000,</span><br><span class="hljs-string"> vmax_ratio                          = 0.5,</span><br><span class="hljs-string"> /</span><br><span class="hljs-string"></span><br><span class="hljs-string">** for regional climate surface diagnostics such as max/min/mean/std of T2/Q2/wind/rainfall</span><br><span class="hljs-string">between selected output times (e.g. daily) in auxhist3</span><br><span class="hljs-string"></span><br><span class="hljs-string"> &amp;time_control</span><br><span class="hljs-string"> output_diagnostics      = 1</span><br><span class="hljs-string"> auxhist3_outname        = &#x27;</span>wrfxtrm_d&lt;domain&gt;_&lt;<span class="hljs-built_in">date</span>&gt;<span class="hljs-string">&#x27;</span><br><span class="hljs-string"> io_form_auxhist3        = 2</span><br><span class="hljs-string"> auxhist3_interval       = 1440</span><br><span class="hljs-string"> frames_per_auxhist3     = 1</span><br><span class="hljs-string"> /</span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string">** for pressure-level (and some surface) diagnostics, output is on stream 23,</span><br><span class="hljs-string">where the listed pressure levels are in Pa.  For the height level interpolation,</span><br><span class="hljs-string">the unit is stream 22.</span><br><span class="hljs-string"></span><br><span class="hljs-string"> &amp;time_control</span><br><span class="hljs-string"> io_form_auxhist23                   =  2,</span><br><span class="hljs-string"> auxhist23_interval                  = 30,   30,    30,</span><br><span class="hljs-string"> frames_per_auxhist23                =  1,    1,     1, </span><br><span class="hljs-string"> auxhist23_outname                   = &quot;PLEVS_d&lt;domain&gt;_&lt;date&gt;&quot;</span><br><span class="hljs-string"> /</span><br><span class="hljs-string"></span><br><span class="hljs-string"> &amp;diags</span><br><span class="hljs-string"> p_lev_diags                         = 1</span><br><span class="hljs-string"> num_press_levels                    = 4</span><br><span class="hljs-string"> press_levels                        = 85000, 70000, 50000, 25000</span><br><span class="hljs-string"> use_tot_or_hyd_p                    = 2</span><br><span class="hljs-string"> /</span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string">** for height-level diagnostics, output is on stream 22 (negative values</span><br><span class="hljs-string">for z_levels means AGL, so -500 is 500 m AGL, and 10000 is 10 km).</span><br><span class="hljs-string"></span><br><span class="hljs-string"> &amp;time_control</span><br><span class="hljs-string"> io_form_auxhist22                   =  2,</span><br><span class="hljs-string"> auxhist22_interval                  = 30,   30,    30,</span><br><span class="hljs-string"> frames_per_auxhist22                =  1,    1,     1, </span><br><span class="hljs-string"> auxhist22_outname                   = &quot;ZLEVS_d&lt;domain&gt;_&lt;date&gt;&quot;</span><br><span class="hljs-string"> /</span><br><span class="hljs-string"></span><br><span class="hljs-string"> &amp;diags</span><br><span class="hljs-string"> z_lev_diags                         = 1</span><br><span class="hljs-string"> num_z_levels                        = 2</span><br><span class="hljs-string"> z_levels                            = -500, 10000</span><br><span class="hljs-string"> /</span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string">** For solar diagnostics, 2-D fields of variables relevant to solar forecasting are output </span><br><span class="hljs-string">when option solar_diagnostics is activated in diags section of namelist, as shown below.</span><br><span class="hljs-string">Also, if tslist is present when solar_diagnostics is activated, then these same variables</span><br><span class="hljs-string">are output to the time series files for the location(s) specified in tslist.</span><br><span class="hljs-string">All variables are calculated in phys/module_diag_solar.F and defined in registry.solar_fields</span><br><span class="hljs-string"></span><br><span class="hljs-string"> &amp;diags</span><br><span class="hljs-string"> solar_diagnostics                   =  1</span><br><span class="hljs-string"> /</span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string">** Using different flux formulation for tropical storm simulations</span><br><span class="hljs-string">   (best for grid spacing less than 2 km) </span><br><span class="hljs-string">   simple 1-D ocean mixed layer, or University of Miami 3DPWP ocean model</span><br><span class="hljs-string">   (add these in namelist record &amp;physics):</span><br><span class="hljs-string"></span><br><span class="hljs-string"> isftcflx                            = 1,</span><br><span class="hljs-string"> sf_ocean_physics                    = 0 (off), 1 (OML), 2 (3D PWP)</span><br><span class="hljs-string"> oml_hml0                            = 50,</span><br><span class="hljs-string"> oml_gamma                           = 0.14</span><br><span class="hljs-string"> omdt                                = 1</span><br><span class="hljs-string"></span><br><span class="hljs-string"> Add these in the &amp;domains section.  Note that the example here is for</span><br><span class="hljs-string"> a warm ocean: ocean_z is the depth of each layer (m), from the surface</span><br><span class="hljs-string"> downward; the associated temperature is ocean_t (K); and the associated </span><br><span class="hljs-string"> salinity is ocean_s (ppt).</span><br><span class="hljs-string"></span><br><span class="hljs-string"> ocean_levels                        = 30,</span><br><span class="hljs-string"> ocean_z                             =       5.,       15.,       25.,       35.,       45.,       55.,</span><br><span class="hljs-string">                                            65.,       75.,       85.,       95.,      105.,      115.,</span><br><span class="hljs-string">                                           125.,      135.,      145.,      155.,      165.,      175.,</span><br><span class="hljs-string">                                           185.,      195.,      210.,      230.,      250.,      270.,</span><br><span class="hljs-string">                                           290.,      310.,      330.,      350.,      370.,      390.</span><br><span class="hljs-string"> ocean_t                             = 302.3493,  302.3493,  302.3493,  302.1055,  301.9763,  301.6818,</span><br><span class="hljs-string">                                       301.2220,  300.7531,  300.1200,  299.4778,  298.7443,  297.9194,</span><br><span class="hljs-string">                                       297.0883,  296.1443,  295.1941,  294.1979,  293.1558,  292.1136,</span><br><span class="hljs-string">                                       291.0714,  290.0293,  288.7377,  287.1967,  285.6557,  284.8503,</span><br><span class="hljs-string">                                       284.0450,  283.4316,  283.0102,  282.5888,  282.1674,  281.7461</span><br><span class="hljs-string"> ocean_s                             =  34.0127,   34.0127,   34.0127,   34.3217,   34.2624,   34.2632,</span><br><span class="hljs-string">                                        34.3240,   34.3824,   34.3980,   34.4113,   34.4220,   34.4303,</span><br><span class="hljs-string">                                        34.6173,   34.6409,   34.6535,   34.6550,   34.6565,   34.6527,</span><br><span class="hljs-string">                                        34.6490,   34.6446,   34.6396,   34.6347,   34.6297,   34.6247,</span><br><span class="hljs-string">                                        34.6490,   34.6446,   34.6396,   34.6347,   34.6297,   34.6247</span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string">References for 3D ocean circulation model:</span><br><span class="hljs-string">Lee, C.-Y., and S. S. Chen, 2013: Stable Boundary Layer and Its Impact on Tropical Cyclone Structure in a Coupled Atmosphere-Ocean Model, Mon. Wea. Rev.</span><br><span class="hljs-string">Price, J. F., T. B. Sanford, and G. Z. Forristal, 1994: Forced stage response to a moving hurricane. J. Phy. Oceanogr., 24, 233-260.</span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string">** Using the ACOM Forward Lagrangian trajectory calculation:</span><br><span class="hljs-string"></span><br><span class="hljs-string">&amp;domains</span><br><span class="hljs-string"> num_traj                            = 25,</span><br><span class="hljs-string"></span><br><span class="hljs-string">&amp;physics</span><br><span class="hljs-string"> traj_opt                            = 1,</span><br><span class="hljs-string"> dm_has_traj                         = .true.,  ..true.,  .true.</span><br><span class="hljs-string"> </span><br><span class="hljs-string"></span><br><span class="hljs-string">For domain #1, the file must &quot;wrfinput_traj_d01&quot; exist in the working directory. Similarly for domain 2, 3, etc. Each domain</span><br><span class="hljs-string">has a separate file for a namelist.</span><br><span class="hljs-string"></span><br><span class="hljs-string">&amp;traj_default</span><br><span class="hljs-string"> traj_def%start_time        = &#x27;</span>2000-01-24_12:00:00<span class="hljs-string">&#x27;,</span><br><span class="hljs-string"> traj_def%stop_time         = &#x27;</span>2000-01-25_12:00:00<span class="hljs-string">&#x27;,</span><br><span class="hljs-string"> traj_def%dyn_name(1:6)     = &#x27;</span>p<span class="hljs-string">&#x27;, &#x27;</span>T<span class="hljs-string">&#x27;, &#x27;</span>z<span class="hljs-string">&#x27;, &#x27;</span>u<span class="hljs-string">&#x27;, &#x27;</span>v<span class="hljs-string">&#x27;, &#x27;</span>w<span class="hljs-string">&#x27;,</span><br><span class="hljs-string"> traj_def%hyd_name(1)       = &#x27;</span>QVAPOR<span class="hljs-string">&#x27;,</span><br><span class="hljs-string">/</span><br><span class="hljs-string">  </span><br><span class="hljs-string">&amp;traj_spec</span><br><span class="hljs-string"> traj_type%start_time = &#x27;</span>2000-01-24_12:00:00<span class="hljs-string">&#x27;,  &#x27;</span>2000-01-24_12:00:00<span class="hljs-string">&#x27;,  </span><br><span class="hljs-string">                        &#x27;</span>2000-01-24_12:00:00<span class="hljs-string">&#x27;,  &#x27;</span>2000-01-24_12:00:00<span class="hljs-string">&#x27;,  </span><br><span class="hljs-string">                        &#x27;</span>2000-01-24_12:00:00<span class="hljs-string">&#x27;,  &#x27;</span>2000-01-24_12:00:00<span class="hljs-string">&#x27;,  </span><br><span class="hljs-string">                        &#x27;</span>2000-01-24_12:00:00<span class="hljs-string">&#x27;,  &#x27;</span>2000-01-24_12:00:00<span class="hljs-string">&#x27;,  </span><br><span class="hljs-string">                        &#x27;</span>2000-01-24_12:00:00<span class="hljs-string">&#x27;,  &#x27;</span>2000-01-24_12:00:00<span class="hljs-string">&#x27;,  </span><br><span class="hljs-string">                        &#x27;</span>2000-01-24_12:00:00<span class="hljs-string">&#x27;,  </span><br><span class="hljs-string"> traj_type%stop_time  = &#x27;</span>2000-01-25_12:00:00<span class="hljs-string">&#x27;,  &#x27;</span>2000-01-25_12:00:00<span class="hljs-string">&#x27;,  </span><br><span class="hljs-string">                        &#x27;</span>2000-01-25_12:00:00<span class="hljs-string">&#x27;,  &#x27;</span>2000-01-25_12:00:00<span class="hljs-string">&#x27;,  </span><br><span class="hljs-string">                        &#x27;</span>2000-01-25_12:00:00<span class="hljs-string">&#x27;,  &#x27;</span>2000-01-25_12:00:00<span class="hljs-string">&#x27;,  </span><br><span class="hljs-string">                        &#x27;</span>2000-01-25_12:00:00<span class="hljs-string">&#x27;,  &#x27;</span>2000-01-25_12:00:00<span class="hljs-string">&#x27;,  </span><br><span class="hljs-string">                        &#x27;</span>2000-01-25_12:00:00<span class="hljs-string">&#x27;,  &#x27;</span>2000-01-25_12:00:00<span class="hljs-string">&#x27;,  </span><br><span class="hljs-string">                        &#x27;</span>2000-01-25_12:00:00<span class="hljs-string">&#x27;,  </span><br><span class="hljs-string"> traj_type%lev        = 60., 60., 60., 60., 60., 60., 60., 60., 60., 60., 60., </span><br><span class="hljs-string"> traj_type%lon        = -79.88470, -79.74551, -79.60422, -79.46072, </span><br><span class="hljs-string">                        -79.31503, -79.16708, -79.01682, -78.86417, </span><br><span class="hljs-string">                        -78.70911, -78.55151, -78.39142,</span><br><span class="hljs-string"> traj_type%lat        =  29.18063,  29.70515,  30.23069,  30.75718,  </span><br><span class="hljs-string">                         31.28461,  31.81292,  32.34208,  32.87204,  </span><br><span class="hljs-string">                         33.40276,  33.93421,  34.46631,</span><br><span class="hljs-string">/</span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string">** Vertical nesting</span><br><span class="hljs-string"></span><br><span class="hljs-string">The WRF model now supports vertical nesting for a coincident (online)</span><br><span class="hljs-string">model simulation (during a single model run, differing numbers of</span><br><span class="hljs-string">vertical levels may be used per domain).  This is activated with a switch</span><br><span class="hljs-string">to turn on the option (vert_refine_method).  The namelist array eta_levels</span><br><span class="hljs-string">is manually filled in for each domain.  Below is an example for two </span><br><span class="hljs-string">domains.  </span><br><span class="hljs-string"></span><br><span class="hljs-string">NOTE: The user is restricted to using the RRTM LW and Dudhia SW radiation schemes.</span><br><span class="hljs-string">NOTE: The user is restricted from using the hybrid vertical coordinate.</span><br><span class="hljs-string"></span><br><span class="hljs-string"> &amp;domains</span><br><span class="hljs-string"> max_dom                             = 2,</span><br><span class="hljs-string"> e_vert                              = 35,    45,</span><br><span class="hljs-string"> eta_levels(1:35)                    = 1., 0.993, 0.983, 0.97, 0.954, 0.934, 0.909, 0.88, 0.8406663, 0.8013327, </span><br><span class="hljs-string">                                       0.761999, 0.7226653, 0.6525755, 0.5877361, 0.5278192, 0.472514, </span><br><span class="hljs-string">                                       0.4215262, 0.3745775, 0.3314044, 0.2917579, 0.2554026, 0.2221162, </span><br><span class="hljs-string">                                       0.1916888, 0.1639222, 0.1386297, 0.1156351, 0.09525016, 0.07733481, </span><br><span class="hljs-string">                                       0.06158983, 0.04775231, 0.03559115, 0.02490328, 0.0155102, 0.007255059, 0.</span><br><span class="hljs-string"> eta_levels(36:81)                   = 1.0000, 0.9946, 0.9875, 0.9789, 0.9685, 0.9562, 0.9413, 0.9238, 0.9037, 0.8813, 0.8514,</span><br><span class="hljs-string">                                       0.8210, 0.7906, 0.7602, 0.7298, 0.6812, 0.6290, 0.5796, 0.5333, 0.4901, 0.4493, 0.4109,</span><br><span class="hljs-string">                                       0.3746, 0.3412, 0.3098, 0.2802, 0.2524, 0.2267, 0.2028, 0.1803, 0.1593, 0.1398, 0.1219,</span><br><span class="hljs-string">                                       0.1054, 0.0904, 0.0766, 0.0645, 0.0534, 0.0433, 0.0341, 0.0259, 0.0185, 0.0118, 0.0056, 0.    </span><br><span class="hljs-string"> vert_refine_method                  = 0,     2,</span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string">** Tropopause data level of max winds data, for program real.exe only</span><br><span class="hljs-string"></span><br><span class="hljs-string">When information (mostly NCEP supplied through GFS or NAM) is available </span><br><span class="hljs-string">in the Grib2 file, AND extracted with ungrib, the metgrid program inserts</span><br><span class="hljs-string">flag information into the data stream that is input by real.  The real</span><br><span class="hljs-string">program is able to use the available u, v, T, height fields (each may be on</span><br><span class="hljs-string">a tropopause .OR. the level of max winds) in the vertical interpolation.</span><br><span class="hljs-string">To &quot;tune&quot; the data, the user may select a level below which the max wind </span><br><span class="hljs-string">inforamtion is ignored.  The default is 300 hPa.  The user may also </span><br><span class="hljs-string">select the level that when exceeded the trop and maxw fields are ignored</span><br><span class="hljs-string">(due to the horizontal pressure difference detecting a user-defined</span><br><span class="hljs-string">discontinuity, and the metgrid horizontal interpolation across the </span><br><span class="hljs-string">discontinuity would be suspect).  By default, this option is turned off.</span><br><span class="hljs-string">The user may choose to individually activate the vertical interpolation of</span><br><span class="hljs-string">either the level of max winds .OR. the tropopause level.</span><br><span class="hljs-string"></span><br><span class="hljs-string">Default (all pressure units Pa):</span><br><span class="hljs-string"> &amp;domains</span><br><span class="hljs-string"> maxw_horiz_pres_diff                = 5000</span><br><span class="hljs-string"> trop_horiz_pres_diff                = 5000</span><br><span class="hljs-string"> maxw_above_this_level               = 30000</span><br><span class="hljs-string"> use_maxw_level                      = 0 (0=do not use level, 1 = use level)</span><br><span class="hljs-string"> use_trop_level                      = 0 (0=do not use level, 1 = use level)</span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string">** Using aerosol option aer_opt = 2:</span><br><span class="hljs-string"></span><br><span class="hljs-string">&amp;physics</span><br><span class="hljs-string"> aer_opt            = 2,</span><br><span class="hljs-string"> aer_type           = 1,</span><br><span class="hljs-string"> aer_aod550_opt     = 1,</span><br><span class="hljs-string"> aer_aod550_val     = 0.12,</span><br><span class="hljs-string"> aer_angexp_opt     = 1,</span><br><span class="hljs-string"> aer_angexp_val     = 1.3,</span><br><span class="hljs-string"> aer_ssa_opt        = 1,</span><br><span class="hljs-string"> aer_ssa_val        = 0.85,</span><br><span class="hljs-string"> aer_asy_opt        = 1,</span><br><span class="hljs-string"> aer_asy_val        = 0.90,</span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string">** Using Jimenez wind-farm scheme</span><br><span class="hljs-string"></span><br><span class="hljs-string">In the &amp;physics namelist record, set the MAX_DOM value:</span><br><span class="hljs-string"> windfarm                            = 1,    1,    1</span><br><span class="hljs-string"></span><br><span class="hljs-string">Also in the directory with namelist.input, is the file defining the</span><br><span class="hljs-string">specifics of the wind turbine type: wind-turbine-1.tbl</span><br><span class="hljs-string"></span><br><span class="hljs-string">The location of wind turbines are specified as lat lon, and </span><br><span class="hljs-string">the turbine type: windturbines.txt</span><br><span class="hljs-string"></span><br><span class="hljs-string">** Using stochastic schemes</span><br><span class="hljs-string">&amp;stoch</span><br><span class="hljs-string"> skebs              = 1, 1, 1, </span><br><span class="hljs-string"> rand_perturb       = 1, 1, 1, </span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string">** Using kfcupscheme cu_physics (cumulus scheme option). This has been tested with</span><br><span class="hljs-string">the CAM radiation scheme and is not recommended with other radiation schemes.</span><br><span class="hljs-string">Regarding cu_rad_feedback, users want the parameterized clouds to affect radiation.  </span><br><span class="hljs-string">Turning it off is only useful as a sensitivity study to determine the importance of </span><br><span class="hljs-string">that effect. Regarding shallowcu_forced_ra option, setting it to true will override </span><br><span class="hljs-string">the cloud fraction calculations to a prescribed maximum cloud fraction (a value of 0.36)</span><br><span class="hljs-string">which can be changed by the user for sensitivity testing purposes.</span><br><span class="hljs-string"></span><br><span class="hljs-string">&amp;physics</span><br><span class="hljs-string"> cu_physics          = 10,    10,    10,</span><br><span class="hljs-string"> ra_lw_physics       = 3,     3,     3,</span><br><span class="hljs-string"> ra_sw_physics       = 3,     3,     3,</span><br><span class="hljs-string"> cu_rad_feedback     =.true.,.true.,.true.,</span><br><span class="hljs-string"> shallowcu_forced_ra = .false.,.false.,.false.,</span><br><span class="hljs-string"> numBins             = 21,    21,    21,</span><br><span class="hljs-string"> thBinSize           = 0.1,   0.1,   0.1,</span><br><span class="hljs-string"> rBinSize            = 0.0001,0.0001,0.0001,</span><br><span class="hljs-string"> minDeepFreq         = 0.333, 0.333, 0.333,</span><br><span class="hljs-string"> minShallowFreq      = 0.01,  0.01,  0.01, </span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string">** To write out an input file during the model simulation.</span><br><span class="hljs-string"></span><br><span class="hljs-string">&amp;time_control</span><br><span class="hljs-string"> write_input                         = .TRUE.,</span><br><span class="hljs-string"> inputout_interval_m                 = 60, 60, 60</span><br><span class="hljs-string"> input_outname                       = &quot;wrfinput_out_d&lt;domain&gt;_&lt;date&gt;&quot;</span><br><span class="hljs-string"> inputout_begin_h                    = 3, 6, 6</span><br><span class="hljs-string"> inputout_end_h                      = 9, 6, 6</span><br><span class="hljs-string"></span><br><span class="hljs-string">** To use climatological data in Thompson microphysics option 28: in addition to</span><br><span class="hljs-string">process additional data in metgrid, use these:</span><br><span class="hljs-string"></span><br><span class="hljs-string">&amp;domains</span><br><span class="hljs-string"> wif_input_opt                       = 1</span><br><span class="hljs-string"> num_wif_levels                      = 30</span><br><span class="hljs-string"></span><br><span class="hljs-string">&amp;physics</span><br><span class="hljs-string"> mp_physics                          = 28,    28,    28,</span><br><span class="hljs-string"> use_aero_icbc                       = .true.</span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string">** The hybrid vertical coordinate (HVC) requires three pieces:</span><br><span class="hljs-string">1. The WRF and real codes must be built with HVC activated (./configure -hyb)</span><br><span class="hljs-string">2. The eta location (etac) at which the eta levels higher up in the atmosphere</span><br><span class="hljs-string">   become isobaric must be defined (suggested default in Registry).</span><br><span class="hljs-string">3. The run-time option to select the HVC (hybrid_opt, default is OFF): </span><br><span class="hljs-string">&amp;dynamics</span><br><span class="hljs-string"> hybrid_opt          = 2,</span><br><span class="hljs-string"> etac                = 0.2,</span><br><span class="hljs-string"></span><br><span class="hljs-string">** New mechanism to specify physics:</span><br><span class="hljs-string"></span><br><span class="hljs-string">&amp;physics</span><br><span class="hljs-string"> physics_suite = &#x27;</span>CONUS<span class="hljs-string">&#x27;</span><br><span class="hljs-string"></span><br><span class="hljs-string">which is equivalent to</span><br><span class="hljs-string"></span><br><span class="hljs-string"> mp_physics         = 8,</span><br><span class="hljs-string"> cu_physics         = 6,</span><br><span class="hljs-string"> ra_lw_physics      = 4,</span><br><span class="hljs-string"> ra_sw_physics      = 4,</span><br><span class="hljs-string"> bl_pbl_physics     = 2,</span><br><span class="hljs-string"> sf_sfclay_physics  = 2,</span><br><span class="hljs-string"> sf_surface_physics = 2,</span><br><span class="hljs-string"></span><br><span class="hljs-string">&amp;physics</span><br><span class="hljs-string"> physics_suite = &#x27;</span>TROPICAL<span class="hljs-string">&#x27;</span><br><span class="hljs-string"></span><br><span class="hljs-string">which is equivalent to</span><br><span class="hljs-string"></span><br><span class="hljs-string"> mp_physics         = 6,</span><br><span class="hljs-string"> cu_physics         = 16,</span><br><span class="hljs-string"> ra_lw_physics      = 4,</span><br><span class="hljs-string"> ra_sw_physics      = 4,</span><br><span class="hljs-string"> bl_pbl_physics     = 1,</span><br><span class="hljs-string"> sf_sfclay_physics  = 91,</span><br><span class="hljs-string"> sf_surface_physics = 2,</span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string">To overwrite the cu_physics option for a second nest, set </span><br><span class="hljs-string"></span><br><span class="hljs-string"> &amp;physics</span><br><span class="hljs-string"> physics_suite                       = &#x27;</span>tropical<span class="hljs-string">&#x27;</span><br><span class="hljs-string"> cu_physics                          = -1,    -1,     0,</span><br><span class="hljs-string"> ...</span><br><span class="hljs-string"></span><br><span class="hljs-string">** New way to automatically choose levels (default auto_levels_opt=2)</span><br><span class="hljs-string"> max_dz                              = 1000.</span><br><span class="hljs-string"> auto_levels_opt                     = 2</span><br><span class="hljs-string"> dzbot                               = 50.</span><br><span class="hljs-string"> dzstretch_s                         = 1.3</span><br><span class="hljs-string"> dzstretch_u                         = 1.1</span><br><span class="hljs-string"></span><br><span class="hljs-string">** Using the scale-adaptive SMS-3DTKE subgrid turbulent mixing scheme: </span><br><span class="hljs-string"> &amp;physics</span><br><span class="hljs-string">   bl_pbl_physics = 0,</span><br><span class="hljs-string">   sf_sfclay_physics = 1(or 5, 91), </span><br><span class="hljs-string"> /</span><br><span class="hljs-string"> &amp;dynamics</span><br><span class="hljs-string">   diff_opt       = 2,</span><br><span class="hljs-string">   km_opt         = 5, </span><br><span class="hljs-string"> /</span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string">** Using lightning option</span><br><span class="hljs-string"> &amp;physics</span><br><span class="hljs-string"> lightning_option                    = 2,</span><br><span class="hljs-string"> iccg_method                         = 1,</span><br><span class="hljs-string"> iccg_prescribed_num                 = 2,</span><br><span class="hljs-string"> iccg_prescribed_den                 = 1,</span><br><span class="hljs-string"> cldtop_adjustment                   = 0,</span><br><span class="hljs-string"> lightning_dt                        = 5,   ; default: time_step</span><br><span class="hljs-string"> lightning_start_seconds             = 600,</span><br><span class="hljs-string"> flashrate_factor                    = 1.0,</span><br><span class="hljs-string"> ltng_temp_upper                    = -45., ; used by lnox_opt=2</span><br><span class="hljs-string"> ltng_temp_lower                    = -15., ; used by lnox_opt=2</span><br><span class="hljs-string"> /</span><br><span class="hljs-string"> </span><br><span class="hljs-string"> &amp;chem</span><br><span class="hljs-string"> lnox_opt                           = 2,</span><br><span class="hljs-string"> n_ic                               = 200,</span><br><span class="hljs-string"> n_cg                               = 200,</span><br><span class="hljs-string"> lnox_passive                       = .false.,</span><br><span class="hljs-string"> /</span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string">** Using the irrigation parameterizations:</span><br><span class="hljs-string">&amp;physics</span><br><span class="hljs-string"> sf_surf_irr_scheme                  = 3,</span><br><span class="hljs-string"> irr_daily_amount                    = 5.7,</span><br><span class="hljs-string"> irr_start_hour                      = 2,</span><br><span class="hljs-string"> irr_num_hours                       = 3,</span><br><span class="hljs-string"> irr_start_julianday                 = 135,</span><br><span class="hljs-string"> irr_end_julianday                   = 350,</span><br><span class="hljs-string"> irr_ph                              = 0,</span><br><span class="hljs-string"> irr_freq                            = 1,</span><br><span class="hljs-string">/</span><br></code></pre></td></tr></table></figure><h2 id="namelist.input-d0115km">namelist.input d01=15km</h2><p><a href="https://github.com/wrf-model/WRF/blob/master/test/em_real/namelist.input">Git em_real/namelist.input</a></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><code class="hljs sh">&amp;time_control<br>run_days                            = 0,<br>run_hours                           = 36,<br>run_minutes                         = 0,<br>run_seconds                         = 0,<br>start_year                          = 2019, 2019,<br>start_month                         = 09,   09, <br>start_day                           = 04,   04,<br>start_hour                          = 12,   12,<br>end_year                            = 2019, 2019,<br>end_month                           = 09,   09,<br>end_day                             = 06,   06,<br>end_hour                            = 00,   00,<br>interval_seconds                    = 10800<br>input_from_file                     = .<span class="hljs-literal">true</span>.,.<span class="hljs-literal">true</span>.,<br>history_interval                    = 60,  60,<br>frames_per_outfile                  = 1, 1,<br>restart                             = .<span class="hljs-literal">false</span>.,<br>restart_interval                    = 7200,<br>io_form_history                     = 2<br>io_form_restart                     = 2<br>io_form_input                       = 2<br>io_form_boundary                    = 2<br>/<br><br>&amp;domains<br>time_step                           = 90,<br>time_step_fract_num                 = 0,<br>time_step_fract_den                 = 1,<br>max_dom                             = 2,<br>e_we                                = 150,    220,<br>e_sn                                = 130,    214,<br>e_vert                              = 45,     45,<br>dzstretch_s                         = 1.1<br>p_top_requested                     = 5000,<br>num_metgrid_levels                  = 34,<br>num_metgrid_soil_levels             = 4,<br>dx                                  = 15000,<br>dy                                  = 15000,<br>grid_id                             = 1,     2,<br>parent_id                           = 0,     1,<br>i_parent_start                      = 1,     53,<br>j_parent_start                      = 1,     25,<br>parent_grid_ratio                   = 1,     3,<br>parent_time_step_ratio              = 1,     3,<br>feedback                            = 1,<br>smooth_option                       = 0<br>/<br><br>&amp;physics<br>physics_suite                       = <span class="hljs-string">&#x27;CONUS&#x27;</span><br>mp_physics                          = -1,    -1,<br>cu_physics                          = -1,    -1,<br>ra_lw_physics                       = -1,    -1,<br>ra_sw_physics                       = -1,    -1,<br>bl_pbl_physics                      = -1,    -1,<br>sf_sfclay_physics                   = -1,    -1,<br>sf_surface_physics                  = -1,    -1,<br>radt                                = 15,    15,<br>bldt                                = 0,     0,<br>cudt                                = 0,     0,<br>icloud                              = 1,<br>num_land_cat                        = 21,<br>sf_urban_physics                    = 0,     0,<br>fractional_seaice                   = 1,<br>/<br><br>&amp;fdda<br>/<br><br>&amp;dynamics<br>hybrid_opt                          = 2, <br>w_damping                           = 0,<br>diff_opt                            = 2,      2,<br>km_opt                              = 4,      4,<br>diff_6th_opt                        = 0,      0,<br>diff_6th_factor                     = 0.12,   0.12,<br>base_temp                           = 290.<br>damp_opt                            = 3,<br>zdamp                               = 5000.,  5000.,<br>dampcoef                            = 0.2,    0.2,<br>khdif                               = 0,      0,<br>kvdif                               = 0,      0,<br>non_hydrostatic                     = .<span class="hljs-literal">true</span>., .<span class="hljs-literal">true</span>.,<br>moist_adv_opt                       = 1,      1,<br>scalar_adv_opt                      = 1,      1,<br>gwd_opt                             = 1,      0,<br>/<br><br>&amp;bdy_control<br>spec_bdy_width                      = 5,<br>specified                           = .<span class="hljs-literal">true</span>.<br>/<br><br>&amp;grib2<br>/<br><br>&amp;namelist_quilt<br>nio_tasks_per_group = 0,<br>nio_groups = 1,<br>/<br></code></pre></td></tr></table></figure><h2 id="namelist.input-d014km">namelist.input d01=4km</h2><p><a href="https://github.com/wrf-model/WRF/blob/master/test/em_real/namelist.input.4km">Git em_real/namelist.input.4km</a></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><code class="hljs sh">&amp;time_control<br>run_days                            = 0,<br>run_hours                           = 12,<br>run_minutes                         = 0,<br>run_seconds                         = 0,<br>start_year                          = 2001, 2001, 2001,<br>start_month                         = 06,   06,   06,<br>start_day                           = 11,   11,   11,<br>start_hour                          = 12,   12,   12,<br>end_year                            = 2001, 2001, 2001,<br>end_month                           = 06,   06,   06,<br>end_day                             = 12,   12,   12,<br>end_hour                            = 12,   12,   12,<br>interval_seconds                    = 10800<br>input_from_file                     = .<span class="hljs-literal">true</span>.,.<span class="hljs-literal">true</span>.,.<span class="hljs-literal">true</span>.,<br>history_interval                    = 60,   60,   60,<br>frames_per_outfile                  = 1,    1,    1,<br>restart                             = .<span class="hljs-literal">false</span>.,<br>restart_interval                    = 1440,<br>io_form_history                     = 2<br>io_form_restart                     = 2<br>io_form_input                       = 2<br>io_form_boundary                    = 2<br>/<br><br>&amp;domains<br>time_step                           = 24,<br>time_step_fract_num                 = 0,<br>time_step_fract_den                 = 1,<br>max_dom                             = 1,<br>e_we                                = 225,   112,   94,<br>e_sn                                = 202,   97,    91,<br>e_vert                              = 35,    35,    35,<br>p_top_requested                     = 5000,<br>num_metgrid_levels                  = 32<br>num_metgrid_soil_levels             = 4,<br>dx                                  = 4000,<br>dy                                  = 4000,<br>grid_id                             = 1,     2,     3,<br>parent_id                           = 0,     1,     2,<br>i_parent_start                      = 1,     31,    30,<br>j_parent_start                      = 1,     17,    30,<br>parent_grid_ratio                   = 1,     3,     3,<br>parent_time_step_ratio              = 1,     3,     3,<br>feedback                            = 1,<br>smooth_option                       = 0<br>/<br><br>&amp;physics<br>mp_physics                          = 8,     8,     8,<br>ra_lw_physics                       = 4,     4,     4,<br>ra_sw_physics                       = 4,     4,     4,<br>radt                                = 10,    10,    10,<br>sf_sfclay_physics                   = 1,     1,     1,<br>sf_surface_physics                  = 2,     2,     2,<br>bl_pbl_physics                      = 1,     1,     1,<br>bldt                                = 0,     0,     0,<br>ysu_topdown_pblmix                  = 1,<br>cu_physics                          = 0,     0,     0,<br>cudt                                = 0,     0,     0,<br>icloud                              = 1,<br>num_land_cat                        = 21,<br>sf_urban_physics                    = 0,     0,     0,<br>/<br><br>&amp;fdda<br>/<br><br>&amp;dynamics<br>hybrid_opt                          = 2, <br>w_damping                           = 0,<br>diff_opt                            = 1,      1,      1,<br>km_opt                              = 4,      4,      4,<br>diff_6th_opt                        = 0,      0,      0,<br>diff_6th_factor                     = 0.12,   0.12,   0.12,<br>base_temp                           = 290.<br>damp_opt                            = 3,<br>zdamp                               = 5000.,  5000.,  5000.,<br>dampcoef                            = 0.2,    0.2,    0.2<br>khdif                               = 0,      0,      0,<br>kvdif                               = 0,      0,      0,<br>non_hydrostatic                     = .<span class="hljs-literal">true</span>., .<span class="hljs-literal">true</span>., .<span class="hljs-literal">true</span>.,<br>moist_adv_opt                       = 2,      2,      2,<br>scalar_adv_opt                      = 2,      2,      2,<br>/<br><br>&amp;bdy_control<br>spec_bdy_width                      = 5,<br>specified                           = .<span class="hljs-literal">true</span>.,<br>/<br><br>&amp;grib2<br>/<br><br>&amp;namelist_quilt<br>nio_tasks_per_group = 0,<br>nio_groups = 1,<br>/<br></code></pre></td></tr></table></figure><h2 id="namelist.input.pbl-les">namelist.input.PBL-LES</h2><p><a href="https://github.com/wrf-model/WRF/blob/master/test/em_real/namelist.input.pbl-les">Git PBL LES</a></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><code class="hljs sh">&amp;time_control<br>run_days                            = 0,<br>run_hours                           = 12,<br>run_minutes                         = 0,<br>run_seconds                         = 0,<br>start_year                          = 2001, 2001, 2001,<br>start_month                         = 06,   06,   06,<br>start_day                           = 11,   11,   11,<br>start_hour                          = 12,   12,   12,<br>start_minute                        = 00,   00,   00,<br>start_second                        = 00,   00,   00,<br>end_year                            = 2001, 2001, 2001,<br>end_month                           = 06,   06,   06,<br>end_day                             = 12,   12,   12,<br>end_hour                            = 12,   12,   12,<br>end_minute                          = 00,   00,   00,<br>end_second                          = 00,   00,   00,<br>interval_seconds                    = 10800<br>input_from_file                     = .<span class="hljs-literal">true</span>.,.<span class="hljs-literal">true</span>.,.<span class="hljs-literal">true</span>.,<br>history_interval                    = 60,   60,   60,<br>frames_per_outfile                  = 1,    1,    1,<br>restart                             = .<span class="hljs-literal">false</span>.,<br>restart_interval                    = 60,<br>io_form_history                     = 2<br>io_form_restart                     = 2<br>io_form_input                       = 2<br>io_form_boundary                    = 2<br>/<br><br>&amp;domains<br>time_step                           = 5,<br>time_step_fract_num                 = 0,<br>time_step_fract_den                 = 1,<br>max_dom                             = 3,<br>e_we                                = 225,   112,   94,<br>e_sn                                = 202,   97,    91,<br>e_vert                              = 35,    35,    35,<br>p_top_requested                     = 5000,<br>num_metgrid_levels                  = 40<br>num_metgrid_soil_levels             = 4,<br>dx                                  = 1000,<br>dy                                  = 1000,<br>grid_id                             = 1,     2,     3,<br>parent_id                           = 0,     1,     2,<br>i_parent_start                      = 1,     31,    30,<br>j_parent_start                      = 1,     17,    30,<br>parent_grid_ratio                   = 1,     3,     3,<br>parent_time_step_ratio              = 1,     3,     3,<br>feedback                            = 1,<br>smooth_option                       = 0<br>/<br><br>&amp;physics<br>mp_physics                          = 8,     8,     8,<br>ra_lw_physics                       = 4,     4,     4,<br>ra_sw_physics                       = 4,     4,     4,<br>radt                                = 1,     1,     1,<br>sf_sfclay_physics                   = 1,     1,     1,<br>sf_surface_physics                  = 2,     2,     2,<br>bl_pbl_physics                      = 1,     0,     0,<br>bldt                                = 0,     0,     0,<br>ysu_topdown_pblmix                  = 1,<br>cu_physics                          = 0,     0,     0,<br>cudt                                = 0,     0,     0,<br>icloud                              = 1,<br>num_land_cat                        = 21,<br>sf_urban_physics                    = 0,     0,     0,<br>/<br><br>&amp;dynamics<br>hybrid_opt                          = 2, <br>w_damping                           = 0,<br>diff_opt                            = 2,      2,      2,<br>km_opt                              = 4,      3,      3,<br>diff_6th_opt                        = 0,      0,      0,<br>diff_6th_factor                     = 0.12,   0.12,   0.12,<br>base_temp                           = 290.<br>damp_opt                            = 3,<br>zdamp                               = 5000.,  5000.,  5000.,<br>dampcoef                            = 0.2,    0.2,    0.2<br>khdif                               = 0,      0,      0,<br>kvdif                               = 0,      0,      0,<br>non_hydrostatic                     = .<span class="hljs-literal">true</span>., .<span class="hljs-literal">true</span>., .<span class="hljs-literal">true</span>.,<br>moist_adv_opt                       = 2,      2,      2,<br>scalar_adv_opt                      = 2,      2,      2,<br>/<br><br>&amp;bdy_control<br>spec_bdy_width                      = 5,<br>specified                           = .<span class="hljs-literal">true</span>.,<br>/<br><br>&amp;namelist_quilt<br>nio_tasks_per_group = 0,<br>nio_groups = 1,<br>/<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>WRF</category>
      
    </categories>
    
    
    <tags>
      
      <tag>WRF</tag>
      
      <tag>namelist.input</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>WRF | WRF namelist.input: Best Practices</title>
    <link href="/2023/04/30/WRF_namelist_input_Best_Practices/"/>
    <url>/2023/04/30/WRF_namelist_input_Best_Practices/</url>
    
    <content type="html"><![CDATA[<h1 id="wrf-namelist.input-best-practices">WRF namelist.input: Best Practices</h1><p><a href="https://www2.mmm.ucar.edu/wrf/users/namelist_best_prac_wrf.html">https://www2.mmm.ucar.edu/wrf/users/namelist_best_prac_wrf.html</a></p><p><a href="https://github.com/wrf-model/WRF/blob/master/run/README.namelist">Git: WRF/run/README.namelist</a></p><ol type="1"><li>In namelist.input, multiple columns are used for multiple domains; however max_dom determines how many columns will be used. For example, if you use 3 columns, but only set max_dom = 2, the last column will be ignored.</li><li>Not all parameters have mulitple columns. In the descriptions below, it has been specified if a parameter is to be used for multiple domains (max_dom). If this is not shown, then you must only specify one value (in the first column), or you will receive a namelist error upon running.</li></ol><h2 id="domains">&amp;domains</h2><h3 id="time_step">time_step</h3><p>It is recommended to use a value of <strong>5-6xDX (in km)</strong> for a typical case. If you are using many vertical levels and/or with map-scale-factors much larger than 1, you will need to use a smaller time_step. If you are getting CFL errors that stop your run, this means your run has become unstable and <strong>you may need to decrease this value to about 4xDX (or perhaps even 3xDX)</strong>. It makes things easier if you use a time step that evenly divides into your history_interval, so that your output times will be evenly spaced.</p><h3 id="e_vert-max_dom">e_vert (max_dom)</h3><p>The number of vertical (or Eta) levels onto which real.exe will interpolate the incoming data. This number must be the same for each domain. It is not recommended to have fewer than 35 levels.** Typically 40-60 levels is recommended**.</p><h3 id="p_top_requested">p_top_requested</h3><p>The pressure top (in Pa) to use in the model. This level must be available in the incoming WPS data. &gt; The <strong>default and recommended value is 5000 Pa</strong>, and it is not suggested to use a level any lower (in the atmosphere) than this.</p><h3 id="num_metgrid_levels">num_metgrid_levels</h3><p>look for the value near the top of the log.ncdump file. &gt; ncdump -h met_em.d01.<date> &gt;&amp; log.ncdump</p><h3 id="feedback">feedback</h3><p>This determines whether feedback will be used when using nesting, and should be used to determine whether the run will be a one-way or two-way nested run. When feedback is on, the values of the coarse domain are overwritten by the values of the variables (average of cell values for mass points, and average of the cell-face values for horizontal momentum points) in the nest at the coincident points. For masked fields, only the single point value at the collocating points is fed back. If the parent_grid_ratio is even, an arbitrary choice of the southwest corner point value is used for feedback. This is the reason it is recommended to use an odd parent_grid_ratio with this option. When feedback is off , it is equivalent to a one-way nested run, since nest results are not reflected in the parent domain.</p><p><strong>usually, set is feedback = 0 (off)</strong></p><h3 id="smooth_option">smooth_option</h3><p>Determines whether smoothing is to be used for the parent domain in the area of the nest <strong>if feedback is on (feedback = 1)</strong>. Three options are available: - 0 = no smoothing - 1 = 1-2-1 smoothing - 2 = smoothing-desmoothing. <strong>It is typically recommended to keep this option set to 0.</strong></p><h2 id="physics">&amp;physics</h2><h3 id="mp_physics-max_dom">mp_physics (max_dom)</h3><p>WSM6 or ...</p><h3 id="ra_lw_physics-max_dom">ra_lw_physics (max_dom)</h3><p>This should be set to the same option for each domain. <strong>We recommend using the RRTMG option (option 4).</strong></p><h3 id="ra_sw_physics-max_dom">ra_sw_physics (max_dom)</h3><p>This should be set to the same option for each domain. <strong>We recommend using the RRTMG option (option 4).</strong></p><h3 id="radt-max_dom">radt (max_dom)</h3><p>Minutes between radiation physics calls. It is recommended to <strong>use 1 minute per km of dx</strong> (e.g., <strong>set to 10 for 10km parent domain</strong>). If you are running a high-resolution domain and compute time is a concern, then it is okay to use radt = 10-15 min, along with setting 'swint_opt'.<strong>Use the same value for all domains</strong>.</p><h3 id="sf_sfclay_physics-max_dom">sf_sfclay_physics (max_dom)</h3><p>Surface layer physics option. A given option may only work with a certain PBL option. This should be set to <strong>the same option for each domain</strong>.</p><h3 id="sf_surface_physics-max_dom">sf_surface_physics (max_dom)</h3><p>Land surface model (LSM) option. This choice must be made prior to running real.exe. num_soil_layers must also match this option. This should be set to the <strong>same option for each domain</strong>. If you decide to change this option later, <strong>make sure num_soil_layers is set correctly for the new option, and you will need to re-run real.exe</strong>.</p><h3 id="num_soil_layers">num_soil_layers</h3><p>If you choose to use a different LSM later, you must make sure this value is set correctly for the new model, and you will need to re-run real.exe.</p><h3 id="bl_pbl_physics-max_dom">bl_pbl_physics (max_dom)</h3><p>This option <strong>should be used when your domain grid size is &gt; 500m</strong>.</p><h3 id="bldt-max_dom">bldt (max_dom)</h3><p>Minutes between boundary layer physics calls. This should be set to the <strong>same option for each domain</strong>. <strong>The typical/recommended value is 0 (every time step)</strong>.</p><blockquote><p><strong>bldt (max_dom) = 0, ! minutes between boundary-layer physics calls</strong></p></blockquote><h3 id="cu_physics-max_dom">cu_physics (max_dom)</h3><ul><li>For a grid size &gt;10 km, a cumulus scheme is necessary.</li><li>It is not necessary when the grid size is &lt; 4km.</li><li>In <strong>between 4km and 10km is a somewhat gray area</strong>, so avoid this range if possible.<ul><li>If you must use this size, however, you can try the <strong>GF and MSKF schemes (options 3 and 11), as these schemes are scale-aware</strong>.</li></ul></li></ul><h3 id="cudt">cudt ?</h3><p>Minutes between cumulus physics calls. The<strong>typical/recommended value is every time step</strong>, as <strong>most cumulus schemes are cheap to run</strong>. Note: for the KF scheme this is also used for averaging time for vertical velocity trigger. This options is not used by the G3 or GD schemes.</p><blockquote><p><strong>cudt (max_dom) = 0, ! minutes between cumulus physics calls</strong></p></blockquote><h3 id="isfflx">isfflx ?</h3><p>Option that determines heat and moisture fluxes from the surface. Use this option if you wish to turn off surface sensible and latent heat fluxes for some of the surface physics options. It may also be used to control how surface fluxes are used in idealized simulations (e.g., LES).</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh">isfflx                              = 1,! heat and moisture fluxes from the surface<br>                                                 (only works <span class="hljs-keyword">for</span> sf_sfclay_physics = 1,5,7,11)<br>                                                 1 = with fluxes from the surface <br>                                                 0 = no flux from the surface<br>                                                     with bl_pbl_physics=0 this uses tke_drag_coefficient<br>                                                     and tke_heat_flux <span class="hljs-keyword">in</span> vertical diffusion<br>                                                 2 = use drag from sf_sfclay_physics and heat flux from<br>                                                     tke_heat_flux with bl_pbl_physics=0<br></code></pre></td></tr></table></figure><blockquote><p><strong>isfflx = 1,</strong></p></blockquote><h3 id="ifsnow">ifsnow ?</h3><p>This option can be turned off to remove snow effects for the simple soil model (sf_surface_physics = 1).</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">ifsnow                              = 1,! snow-cover effects<br>                                                 (only works <span class="hljs-keyword">for</span> sf_surface_physics = 1)<br>                                                 1 = with snow-cover effect<br>                                                 0 = without snow-cover effect<br></code></pre></td></tr></table></figure><blockquote><p><strong>ifsnow = 1,</strong></p></blockquote><h3 id="icloud">icloud ?</h3><p>Option to compute cloud fraction for radiation.</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sh">icloud                              = 1,! cloud effect to the optical depth <span class="hljs-keyword">in</span> radiation<br>                                                 (only works <span class="hljs-keyword">for</span> ra_sw_physics = 1,4 and ra_lw_physics = 1,4)<br>                                                 Since 3.6, this also controls the cloud fraction options<br>                                                 1 = with cloud effect, and use cloud fraction option 1<br>                                                     (Xu-Randall method) <br>                                                 0 = without cloud effect<br>                                                 2 = with cloud effect, and use cloud fraction option 2 (0/1 based<br>                                                     on threshold<br>                                                 3 = with cloud effect, and use cloud fraction option 3, based on<br>                                                     Sundqvist et al. (1989) (since 3.7)<br></code></pre></td></tr></table></figure><blockquote><p><strong>icloud = 1,</strong></p></blockquote><p>or consider the icloud = 3 that may be better.</p><h3 id="surface_input_source">surface_input_source</h3><p>Where landuse and soil category data come from. Available options are: <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh">surface_input_source                = 3,! <span class="hljs-built_in">where</span> landuse and soil category data come from:<br>                                                 1 = WPS/geogrid but with dominant categories recomputed<br>                                                 2 = GRIB data from another model (only possible<br>                                                     (VEGCAT/SOILCAT are <span class="hljs-keyword">in</span> met_em files from WPS)<br>                                                 3 = use dominant land and soil categories from WPS/geogrid (default since 3.8)<br></code></pre></td></tr></table></figure></p><h3 id="num_land_cat">num_land_cat</h3><p>The number of land categories in the input static/geogrid data. This must match what's produced in WPS/geogrid. Available options are: <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh">num_land_cat                        = 21,      ! number of land categories <span class="hljs-keyword">in</span> input data.<br>                                                 24 - <span class="hljs-keyword">for</span> USGS (default); 20 <span class="hljs-keyword">for</span> MODIS<br>                                                 28 - <span class="hljs-keyword">for</span> USGS <span class="hljs-keyword">if</span> including lake category<br>                                                 21 - <span class="hljs-keyword">for</span> MODIS <span class="hljs-keyword">if</span> including lake category (default since 3.8)<br>                                      40 - <span class="hljs-keyword">for</span> NCLD<br></code></pre></td></tr></table></figure> and may be 5x for LCZ dataset (Urban).</p><h3 id="sf_urban_physics-max_dom">sf_urban_physics (max_dom)</h3><p>This value <strong>must be the same for each domain, and it must be set for each domain.</strong></p><h2 id="dynamics">&amp;dynamics</h2><h3 id="w_damping">w_damping ??</h3><p>Vertical velocity damping flag. Options are 1=with damping; 0=without damping. <strong>For real-time/operational runs, this should always be turned on for model stability</strong> (it is only activated when required.) For budget studies, do not use this option.</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">w_damping                           = 0,       ! vertical velocity damping flag (<span class="hljs-keyword">for</span> operational use)<br>                                                 0 = without damping<br>                                                 1 = with    damping<br></code></pre></td></tr></table></figure><h3 id="diff_opt-max_dom">diff_opt (max_dom) ?</h3><p>Turbulence and mixing option.</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sh">diff_opt(max_dom)                   = 1,! turbulence and mixing option:<br>                                                 0 = no turbulence or explicit<br>                                                     spatial numerical filters (km_opt IS IGNORED).<br>                                                 1 = evaluates 2nd order<br>                                                     diffusion term on coordinate surfaces.<br>                                                     uses kvdif <span class="hljs-keyword">for</span> vertical diff unless PBL option<br>                                                     is used. may be used with km_opt = 1 and 4.<br>                                                     (= 1, recommended <span class="hljs-keyword">for</span> real-data cases)<br>                                                 2 = evaluates mixing terms <span class="hljs-keyword">in</span><br>                                                     physical space (stress form) (x,y,z).<br>                                                     turbulence parameterization is chosen<br>                                                     by specifying km_opt.<br></code></pre></td></tr></table></figure><blockquote><p><strong>diff_opt = 1, 1, 1,</strong></p></blockquote><h3 id="km_opt-max_dom">km_opt (max_dom) ?</h3><p>Eddy coefficient option.</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sh">km_opt(max_dom)                     = 4,! eddy coefficient option<br>                                                 1 = constant (use khdif kvdif)<br>                                                 2 = 1.5 order TKE closure (3D)<br>                                                 3 = Smagorinsky first order closure (3D)<br>                                                     Note: option 2 and 3 are not recommended <span class="hljs-keyword">for</span> DX &gt; 2 km<br>                                                 4 = horizontal Smagorinsky first order closure<br>                                                     (recommended <span class="hljs-keyword">for</span> real-data cases)<br>                                                 5 = SMS-3DTKE scale-adaptive LES/PBL scheme. It must be<br>                                                     used with diff_opt = 2. PBL schemes must be turned off<br>                                                     (bl_pbl_physics=0). It can work with sf_sfclay_physics = 1, 5, 91.<br></code></pre></td></tr></table></figure><blockquote><p><strong>km_opt = 4, 4, 4,</strong></p></blockquote><h3 id="diff_6th_opt">diff_6th_opt ?</h3><p>6th order numerical diffusion option.</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">diff_6th_opt (max_dom)              = 0,       ! 6th-order numerical diffusion<br>                                                 0 = no 6th-order diffusion (default)<br>                                                 1 = 6th-order numerical diffusion (not recommended)<br>                                                 2 = 6th-order numerical diffusion but prohibit up-gradient diffusion<br></code></pre></td></tr></table></figure><blockquote><p><strong>diff_6th_opt = 0, 0, 0,</strong></p></blockquote><h3 id="diff_6th_factor">diff_6th_factor ?</h3><p>6th order numerical diffusion non-dimensional rate. The maximum value is 1.0, which corresponds to complete removal of 2dx wave in one timestep.</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">diff_6th_factor (max_dom)           = 0.12,    ! 6th-order numerical diffusion non-dimensional rate (max value 1.0<br>                                                     corresponds to complete removal of 2dx wave <span class="hljs-keyword">in</span> one timestep)<br></code></pre></td></tr></table></figure><blockquote><p><strong>diff_6th_factor = 0.12, 0.12, 0.12,</strong></p></blockquote><h3 id="base_temp">base_temp ?</h3><p>Base state sea-level (surface) temperature (in K). This option can help to improve simulations when the model top is higher than 20 km (~ 50 mb). Note: This option is only available for real data, and em-only. This is a representative temperature at sea-level in the middle of your domain, regardless of the topography height at that point. <strong>Typical values range from 270-300 K</strong>. This value must stay the same through initialization, model runs, and restarts.</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">base_temp                           = 290.,    ! real-data, em ONLY, base sea-level temp (K)<br></code></pre></td></tr></table></figure><blockquote><p><strong>base_temp = 290.,</strong></p></blockquote><h3 id="damp_opt">damp_opt ?</h3><p>Upper-level damping flag.</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh">damp_opt                            = 0,! upper level damping flag <br>                                                 0 = without damping<br>                                                 1 = with diffusive damping, maybe used <span class="hljs-keyword">for</span> real-data cases <br>                                                     (dampcoef nondimensional ~0.01-0.1)<br>                                                 2 = with Rayleigh  damping (dampcoef inverse time scale [1/s] e.g. .003; idealized <span class="hljs-keyword">case</span> only<br>                                                     not <span class="hljs-keyword">for</span> real-data cases)<br>                                                 3 = with w-Rayleigh damping (dampcoef inverse time scale [1/s] e.g. .2; <br>                                                     <span class="hljs-keyword">for</span> real-data cases)<br></code></pre></td></tr></table></figure><blockquote><p><strong>damp_opt = 0,</strong></p></blockquote><h3 id="zdamp-max_dom">zdamp (max_dom) ?</h3><p>Damping depth (in meters) from model top. <strong>(default is 5000.)</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">zdamp (max_dom)                     = 5000.,! damping depth (m) from model top<br></code></pre></td></tr></table></figure><blockquote><p><strong>z_damp = 5000., 5000., 5000.,</strong></p></blockquote><h3 id="dampcoef-max_dom">dampcoef (max_dom) ??</h3><p>Damping coefficient (also see damp_opt above)</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">dampcoef (max_dom)                  = 0.,! damping coefficient (see above)<br></code></pre></td></tr></table></figure><blockquote><p><strong>dampcoef = 0.2, 0.2, 0.2,</strong></p></blockquote><h3 id="khdif-max_dom">khdif (max_dom) ?</h3><p>Horizontal diffusion constant (m^2/s)</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">khdif (max_dom)                     = 0,; horizontal diffusion constant (m^2/s). A typical value should be 0.1*DX <span class="hljs-keyword">in</span> meters.<br></code></pre></td></tr></table></figure><h3 id="kvdif-max_dom">kvdif (max_dom) ?</h3><p>Vertical diffusion constant (m^2/s)</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">kvdif (max_dom)                     = 0,! vertical diffusion constant (m^2/s). A typical value should be 100.<br></code></pre></td></tr></table></figure><h3 id="non_hydrostatic-max_dom">non_hydrostatic (max_dom) ??</h3><p>Whether running the model in hydrostatic or non-hydrotstatic (default) mode.</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">non_hydrostatic (max_dom)           = .<span class="hljs-literal">true</span>.,! whether running the model <span class="hljs-keyword">in</span> hydrostatic or non-hydro mode<br></code></pre></td></tr></table></figure><h3 id="moist_adv_opt-max_dom">moist_adv_opt (max_dom)</h3><p>Positive-definite or monotonic advection to help eliminate over/under prediction of moisture. Option are: - 0 = advection with no bounds or filters in place - <strong>1 = positive-definite advection of moisure (default)</strong> - 2 = monotonic option</p><h3 id="scalar_adv_opt-max_dom">scalar_adv_opt (max_dom)</h3><p>Positive-definite advection of scalars. Options are: - 0 = advection with no bounds or filters in place - <strong>1 = positive-definite advection of moisure (default)</strong> - 2 = monotonic option</p><h2 id="bdy_control">&amp;bdy_control</h2><h3 id="spec_bdy_width">spec_bdy_width</h3><p>The number of rows for specified boundary value nudging. This value is the total of 'spec_zone' and 'relax_zone' (see below). <strong>A wider boundary zone may work better for coarser driving data</strong>.</p><blockquote><p><strong>spec_bdy_width = 5,</strong></p></blockquote><h3 id="spec_zone">spec_zone</h3><p>The number of points in specified zone (specific boundary condition option). Leave this <strong>set to the default of 1</strong>.</p><blockquote><p><strong>spec_zone = 1,</strong></p></blockquote><h3 id="relax_zone">relax_zone</h3><p>The number of points in relaxation zone (specific boundary condition option). A <strong>wider boundary zone may work better for coarser driving data</strong>.</p><blockquote><p><strong>relax_zone = 4,</strong></p></blockquote><h3 id="specified-max_dom">specified (max_dom)</h3><p>Specified boundary conditions.</p><blockquote><p>The first row and column are specified with external model values (spec_zone = 1, which should not be changed). The rows and columns in relax_zone have values blended from an external model and WRF. The value of relax_zone may be changed, as long as spec_bdy_width = spec_zone + relax_zone. This can be used with periodic_x in tropical channel simulations.</p></blockquote><p><strong>This can only be turned on (.true.) for domain 01 - must be false for all other domains. This is for real data cases only</strong>.</p><blockquote><p><strong>specified = .true., .false., .false.,</strong></p></blockquote><h3 id="nested-max_dom">nested (max_dom)</h3><p>Nested boundary conditions. This <strong>must be set to .true. for nests.</strong> This can be used for real or idealized cases.</p><blockquote><p><strong>nested = .false., .true., .true.,</strong></p></blockquote>]]></content>
    
    
    <categories>
      
      <category>WRF</category>
      
    </categories>
    
    
    <tags>
      
      <tag>WRF</tag>
      
      <tag>namelist.input</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>zsh &amp; oh-my-zsh</title>
    <link href="/2023/04/30/zsh_oh_my_zsh/"/>
    <url>/2023/04/30/zsh_oh_my_zsh/</url>
    
    <content type="html"><![CDATA[<h1 id="zsh-oh-my-zsh">zsh &amp; oh-my-zsh</h1><p>The pre-installed shell of most Linux distributions is bash. But, zsh is more powerfull tool on the terminal.</p><h2 id="zsh">zsh</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">sudo</span> apt install zsh<br><br><span class="hljs-comment"># change the default shell</span><br><span class="hljs-built_in">sudo</span> chsh -s $(<span class="hljs-built_in">which</span> zsh) $(<span class="hljs-built_in">whoami</span>)<br></code></pre></td></tr></table></figure><p>Note: Because the Shell can set different default values â€‹â€‹according to each account, so referring to the syntax of this article, a whoami technique is used to dynamically obtain the name of the currently logged-in account through the command to set it.</p><h3 id="install-oh-my-zsh">Install oh-my-zsh</h3><p>After installing zsh in the previous step, we can start to adjust the command line appearance settings we want, but the original zsh was too difficult to set up, so it didnâ€™t receive much attention when it first appeared many years ago, until someone wrote a set The framework called oh-my-zsh helps everyone use zsh, and zsh became popular. Now almost all zsh useful tools support oh-my-zsh, so of course it is necessary to install this thing</p><p>Installation <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">sh -c <span class="hljs-string">&quot;<span class="hljs-subst">$(curl -fsSL https://raw.githubusercontent.com/robbyrussell/oh-my-zsh/master/tools/install.sh)</span>&quot;</span><br></code></pre></td></tr></table></figure> After execution, if there is no error message, it means success, and you will find more folders of oh-my-zsh ~/.oh-my-zsh</p><p>However, oh-my-zsh has a lot of built-in themes, and there are many screenshots on its github wiki for reference &gt; https://github.com/ohmyzsh/ohmyzsh/wiki/Themes</p><p>It is very simple to switch the built-in theme, directly modify your ~/.zshrc, and change the original ZSH_THEME="robbyrussell" to what you want</p><h3 id="edit-.zshrc">Edit .zshrc</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># some more ls aliases</span><br><span class="hljs-built_in">alias</span> ll=<span class="hljs-string">&#x27;ls -alF&#x27;</span><br><span class="hljs-built_in">alias</span> la=<span class="hljs-string">&#x27;ls -A&#x27;</span><br><span class="hljs-built_in">alias</span> l=<span class="hljs-string">&#x27;ls -CF&#x27;</span><br><br><span class="hljs-comment"># export TERM=&#x27;xterm-256color&#x27;</span><br><span class="hljs-comment"># # To determine the prompt format, use the $PS1 variable.</span><br><span class="hljs-comment"># PS1=&quot;%&#123;$fg[red]%&#125;%n%&#123;$reset_color%&#125;@%&#123;$fg[green]%&#125;%m %&#123;$fg[yellow]%&#125;%(5~|%-1~/.../%3~|%4~) %&#123;$reset_color%&#125;%% &quot;</span><br></code></pre></td></tr></table></figure><blockquote><p>ZSH_THEME=â€agnosterâ€ # Try changing robbyrussell to agnoster After any zsh settings are modified, the following commands must be executed to take effect</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">exec</span> <span class="hljs-variable">$SHELL</span><br></code></pre></td></tr></table></figure><h3 id="conda-problem">Conda problem</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs sh">CommandNotFoundError: Your shell has not been properly configured to use <span class="hljs-string">&#x27;conda activate&#x27;</span>.<br>To initialize your shell, run<br><br>    $ conda init &lt;SHELL_NAME&gt;<br><br>Currently supported shells are:<br>  - bash<br>  - fish<br>  - tcsh<br>  - xonsh<br>  - zsh<br>  - powershell<br><br>See <span class="hljs-string">&#x27;conda init --help&#x27;</span> <span class="hljs-keyword">for</span> more information and options.<br>IMPORTANT: You may need to close and restart your shell after running <span class="hljs-string">&#x27;conda init&#x27;</span>.<br></code></pre></td></tr></table></figure><p>do <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">conda init zsh<br></code></pre></td></tr></table></figure></p><h3 id="zsh-autosuggestions">zsh-autosuggestions</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">git <span class="hljs-built_in">clone</span> https://github.com/zsh-users/zsh-autosuggestions <span class="hljs-variable">$&#123;ZSH_CUSTOM:-~/.oh-my-zsh/custom&#125;</span>/plugins/zsh-autosuggestions<br></code></pre></td></tr></table></figure><p>In .zshrc, &gt; plugins=(zsh-autosuggestions) and then, source ~/.zshrc</p><p>Usage &gt; If you think it is correct, you can press CTRL+F to accept it</p><h3 id="quick-jump-cd--">quick jump: cd -</h3><p>As mentioned earlier, switching between different paths is a headache in command line work. In addition to the abbreviation completion mentioned above, is there a faster way for me to immediately switch to a certain path I recently jumped to? path? Of course there is the <strong>"cd -"</strong> command</p><p>After inputting cd followed by a minus sign, press tab once to list the recent paths visited after this login, and then enter the number according to the prompt below and press Enter to pass, for example, input:** $ cd -5 &lt; Press Enter&gt;** to jump to the ~/software/libclang-python3 path. Of course, instead of entering numbers, you can press tab again to enter the selection mode, use the up and down keys or ctrl+n/p to select, press Enter to confirm, and ctrl+g to return.</p><h3 id="jump-d">jump: d</h3><p>Zsh's directory jump is more intelligent, you don't need to enter cd, just enter the path directly. .. means back one directory, ../../ means back two levels, and so on. (The function of ... is the same as that of ../../) Enter d to list all directories visited by the current session, and then press the number prompted to enter the corresponding directory. <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh">~ &gt; d<br>0 ~ <br>1 ~/Applications <br>2 ~/.proxychains <br>3 /opt/homebrew-cask/Caskroom<br>~ &gt; 1<br>~/Applications<br></code></pre></td></tr></table></figure></p><h2 id="zsh-mkdirsource...-not-found">zsh mkdir/source/...: not found</h2><p>Using bash for all script, &gt; #!/bin/bash</p><h2 id="building-zsh-without-root">Building zsh without root</h2><blockquote><p>No terminal handling library found</p></blockquote><p>Have to install <strong>ncurses</strong> <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">wget https://invisible-island.net/ncurses/#download_ncurses<br>ex<br></code></pre></td></tr></table></figure> output is <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sh">=== output ===<br>** Configuration summary <span class="hljs-keyword">for</span> NCURSES 6.3 20211021:<br><br>       extended funcs: <span class="hljs-built_in">yes</span><br>       xterm terminfo: xterm-new<br><br>        bin directory: /home/wpsze/zsh/ncurses/bin<br>        lib directory: /home/wpsze/zsh/ncurses/lib<br>    include directory: /home/wpsze/zsh/ncurses/include/ncurses<br>        man directory: /home/wpsze/zsh/ncurses/share/man<br>   terminfo directory: /home/wpsze/zsh/ncurses/share/terminfo<br><br>** Include-directory is not <span class="hljs-keyword">in</span> a standard location<br>=====<br></code></pre></td></tr></table></figure></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs sh">wget -O zsh.tar.xz https://sourceforge.net/projects/zsh/files/latest/download --no-check-certificate<br>tar -xvf zsh.tar<br><span class="hljs-built_in">cd</span> zsh<br><br>INSTALLATION_PATH=<span class="hljs-string">&#x27;/home/wpsze/zsh/ncurses/&#x27;</span><br><span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$INSTALLATION_PATH</span>/bin/:<span class="hljs-variable">$PATH</span><br><span class="hljs-built_in">export</span> LD_LIBRARY_PATH=<span class="hljs-variable">$INSTALLATION_PATH</span>/lib:<span class="hljs-variable">$LD_LIBRARY_PATH</span><br><span class="hljs-built_in">export</span> CFLAGS=-I<span class="hljs-variable">$INSTALLATION_PATH</span>/include<br><br><span class="hljs-built_in">export</span> CPPFLAGS=<span class="hljs-string">&quot;-I<span class="hljs-variable">$INSTALLATION_PATH</span>/include&quot;</span> <br><span class="hljs-built_in">export</span> LDFLAGS=<span class="hljs-string">&quot;-L<span class="hljs-variable">$INSTALLATION_PATH</span>/lib&quot;</span><br><br>./configure --prefix=<span class="hljs-variable">$HOME</span>/zsh<br>make <br>make install<br></code></pre></td></tr></table></figure><p>Error <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">/usr/bin/ld: /home/wpsze/zsh/ncurses//lib/libncurses.a(comp_captab.o): relocation R_X86_64_32 against `.rodata<span class="hljs-string">&#x27; can not be used when making a shared object; recompile with -fPIC</span><br><span class="hljs-string">/usr/bin/ld: final link failed: Nonrepresentable section on output</span><br><span class="hljs-string">collect2: error: ld returned 1 exit status</span><br></code></pre></td></tr></table></figure> and <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs sh">zsh configuration<br>-----------------<br>zsh version               : 5.9<br>host operating system     : x86_64-pc-linux-gnu<br><span class="hljs-built_in">source</span> code location      : .<br>compiler                  : gcc -std=gnu11<br>preprocessor flags        : -I/home/wpsze/zsh/ncurses//include<br>executable compiler flags : -I/home/wpsze/zsh/ncurses//include -fPIC<br>module compiler flags     : -I/home/wpsze/zsh/ncurses//include -fPIC -fPIC<br>executable linker flags   : -L/home/wpsze/zsh/ncurses//lib  -rdynamic<br>module linker flags       : -L/home/wpsze/zsh/ncurses//lib  -shared<br>library flags             : -ldl -lncurses -lrt -lm  -lc<br>installation <span class="hljs-built_in">basename</span>     : zsh<br>binary install path       : /home/wpsze/zsh/bin<br>man page install path     : /home/wpsze/zsh/share/man<br>info install path         : /home/wpsze/zsh/share/info<br><span class="hljs-built_in">functions</span> install path    : /home/wpsze/zsh/share/zsh/5.9/functions<br>See config.modules <span class="hljs-keyword">for</span> installed modules and <span class="hljs-built_in">functions</span>.<br></code></pre></td></tr></table></figure> &gt; gcc -std=gnu11 -L/home/wpsze/zsh/ncurses//lib -rdynamic -o zsh main.o <code>cat stamp-modobjs</code> -ldl -lncurses -lrt -lm -lc</p><blockquote><p>recompile with -fPIC</p></blockquote><p>Not solved</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">6903 LIBS=<span class="hljs-string">&quot;<span class="hljs-variable">$ac_func_search_save_LIBS</span> -fPIC&quot;</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>HPC</tag>
      
      <tag>shell script</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>GFS/FNL dataset</title>
    <link href="/2023/04/27/GFS_FNL/"/>
    <url>/2023/04/27/GFS_FNL/</url>
    
    <content type="html"><![CDATA[<h1 id="news-2024-july">News (2024 July)</h1><p><strong>RDA Data Services Unavailable July 30, 2024</strong></p><p>New setup goes to</p><p><a href="https://waipangsze.github.io/2024/08/16/GFS_FNL_RDA_upgrade/" class="uri">https://waipangsze.github.io/2024/08/16/GFS_FNL_RDA_upgrade/</a></p><h1 id="gfs">GFS</h1><p>The Global Forecast System (GFS)<sup id="fnref:1" class="footnote-ref"><a href="#fn:1" rel="footnote"><span class="hint--top hint--rounded" data-aria-label="[GFS Data Access](https://www.ncei.noaa.gov/products/weather-climate-models/global-forecast)">[1]</span></a></sup> is a National Centers for Environmental Prediction (NCEP) weather forecast model that generates data for dozens of atmospheric and land-soil variables, including temperatures, winds, precipitation, soil moisture, and atmospheric ozone concentration. The system couples four separate models (atmosphere, ocean model, land/soil model, and sea ice) that work together to accurately depict weather conditions.</p><h2 id="specifications">Specifications</h2><p>The GFS<sup id="fnref:2" class="footnote-ref"><a href="#fn:2" rel="footnote"><span class="hint--top hint--rounded" data-aria-label="[GFS home page](https://www.emc.ncep.noaa.gov/emc/pages/numerical_forecast_systems/gfs.php)">[2]</span></a></sup> <sup id="fnref:3" class="footnote-ref"><a href="#fn:3" rel="footnote"><span class="hint--top hint--rounded" data-aria-label="[Global Models Verification](https://www.emc.ncep.noaa.gov/users/verification/global/)">[3]</span></a></sup> is run four times a day, producing forecasts up to 16 days in advance. The forecast component uses the Finite Volume Cubed (FV3) model with a resolution of ~13 km, with the atmosphere coupled to the NCEP Global Wave Model. In the vertical, the model is divided into 127 vertical layers. It produces hourly forecast output for the first 120 hours, then 3 hourly for days 5-16. Details on the June 2019 implementation of the initial FV3 version of the GFS (GFSv15) and the March 2021 implementation of GFSv16 can be found in the links listed below.</p><h2 id="download">Download</h2><p>NCEP GFS 0.25 Degree Global Forecast Grids Historical Archive ds084.1 | DOI: 10.5065/D65D8PWK &gt; https://rda.ucar.edu/datasets/ds084.1/ &gt; The NCEP operational Global Forecast System analysis and forecast grids are on a 0.25 by 0.25 global latitude longitude grid. Grids include analysis and forecast time steps at a 3 hourly interval from 0 to 240, and a 12 hourly interval from 240 to 384. Model forecast runs occur at 00, 06, 12, and 18 UTC daily.</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/sh</span><br><span class="hljs-comment">#################################################################</span><br><span class="hljs-comment"># Csh Script (wpsze: to sh script) to retrieve 34 online Data files of &#x27;ds084.1&#x27;,</span><br><span class="hljs-comment"># total 7.16G. This script uses &#x27;wget&#x27; to download data.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Highlight this script by Select All, Copy and Paste it into a file;</span><br><span class="hljs-comment"># make the file executable and run it on command line.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># You need pass in your password as a parameter to execute</span><br><span class="hljs-comment"># this script; or you can set an environment variable RDAPSWD</span><br><span class="hljs-comment"># if your Operating System supports it.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Contact rdahelp@ucar.edu (RDA help desk) for further assistance.</span><br><span class="hljs-comment">#################################################################</span><br><br>wget --no-check-certificate -O \<br>Authentication.<span class="hljs-built_in">log</span> --save-cookies auth.rda_ucar_edu \<br>--article-data=<span class="hljs-string">&quot;email=**xxx@gmail.com**&amp;passwd=**xxx**&amp;action=login&quot;</span> https://rda.ucar.edu/cgi-bin/login<br><br>yyyy=<span class="hljs-string">&#x27;2023&#x27;</span><br>mm=<span class="hljs-string">&#x27;03&#x27;</span><br><span class="hljs-built_in">dd</span>=<span class="hljs-string">&#x27;19&#x27;</span><br>hh=<span class="hljs-string">&#x27;00&#x27;</span><br>yyyymm=<span class="hljs-variable">$&#123;yyyy&#125;</span><br><br><span class="hljs-keyword">for</span> gfsfile <span class="hljs-keyword">in</span> $(<span class="hljs-built_in">seq</span> 0 3 12); <span class="hljs-keyword">do</span> <span class="hljs-comment"># Forecast time = 12, 24, 36, 48, 60, 72, 84, 96, 108, 130, 142, 154</span><br>tmp=$(<span class="hljs-built_in">printf</span> <span class="hljs-string">&quot;%03d&quot;</span> <span class="hljs-variable">$&#123;gfsfile&#125;</span>)<br>tmp=<span class="hljs-string">&quot;<span class="hljs-variable">$&#123;yyyy&#125;</span>/<span class="hljs-variable">$&#123;yyyy&#125;</span><span class="hljs-variable">$&#123;mm&#125;</span><span class="hljs-variable">$&#123;dd&#125;</span>/gfs.0p25.<span class="hljs-variable">$&#123;yyyy&#125;</span><span class="hljs-variable">$&#123;mm&#125;</span><span class="hljs-variable">$&#123;dd&#125;</span><span class="hljs-variable">$&#123;hh&#125;</span>.f<span class="hljs-variable">$&#123;tmp&#125;</span>.grib2&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$&#123;tmp&#125;</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;downloading ...&quot;</span><br>wget --no-check-certificate -N --load-cookies auth.rda_ucar_edu https://rda.ucar.edu/data/ds084.1/<span class="hljs-variable">$&#123;tmp&#125;</span><br><span class="hljs-keyword">done</span><br></code></pre></td></tr></table></figure><h2 id="rename-gfs-files-by-soft-link">Rename GFS files by soft-link</h2><p>If your operational process needs the format of GFS files like as &gt; gfs_20170724_0000_0p25_000</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/sh</span><br><br>old_gfs=`<span class="hljs-built_in">ls</span> ./*.grib2`<br><br><span class="hljs-keyword">for</span> eachfile <span class="hljs-keyword">in</span> <span class="hljs-variable">$&#123;old_gfs&#125;</span><br><span class="hljs-keyword">do</span><br>   <span class="hljs-built_in">echo</span> <span class="hljs-variable">$&#123;eachfile&#125;</span><br>   <span class="hljs-built_in">echo</span> <span class="hljs-variable">$&#123;eachfile:11:8&#125;</span>, <span class="hljs-variable">$&#123;eachfile:19:2&#125;</span>, <span class="hljs-variable">$&#123;eachfile:23:3&#125;</span><br>   <span class="hljs-built_in">echo</span> gfs_<span class="hljs-variable">$&#123;eachfile:11:8&#125;</span>_00<span class="hljs-variable">$&#123;eachfile:19:2&#125;</span>_0p25_<span class="hljs-variable">$&#123;eachfile:23:3&#125;</span><br>   <span class="hljs-built_in">ln</span> -s <span class="hljs-variable">$&#123;eachfile&#125;</span> gfs_<span class="hljs-variable">$&#123;eachfile:11:8&#125;</span>_00<span class="hljs-variable">$&#123;eachfile:19:2&#125;</span>_0p25_<span class="hljs-variable">$&#123;eachfile:23:3&#125;</span><br><span class="hljs-keyword">done</span><br></code></pre></td></tr></table></figure><h2 id="usage-of-gfs-on-wrfnwp">Usage of GFS on WRF/NWP</h2><p>GFS Data &gt; https://www2.mmm.ucar.edu/wrf/OnLineTutorial/DATA/GFS/gfs.php &gt; GFS (Global Forecast System) is a model product from NCEP. &gt; Type: GRIB1 / GRIB2 data</p><p>Resolution: &gt; 0.25 deg global data &gt; Output frequency 3 hourly &gt; 34 pressure levels</p><p>Availability: &gt; From NCAR's RDA site: https://rda.ucar.edu/datasets/ds084.1/</p><p>Vtable: <strong>Vtable.GFS</strong></p><h3 id="namelist.wps">namelist.wps</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># Edit namelist.wps</span><br>start_date = <span class="hljs-string">&#x27;2019-11-29_12:00:00&#x27;</span>,<br>end_date = <span class="hljs-string">&#x27;2019-12-01_00:00:00&#x27;</span>,<br>interval_seconds = 10800,<br>prefix = <span class="hljs-string">&#x27;FILE&#x27;</span>,<br></code></pre></td></tr></table></figure><h3 id="script">Script</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># Notes on running UNGRIB for this data</span><br><span class="hljs-comment"># Examine the GRIB files, e.g.,</span><br><span class="hljs-comment"># ./util/g2print.exe ../DATA/co_blizzard/gfs.0p25.2019112912.f000.grib2</span><br><br><span class="hljs-built_in">ln</span> -sf ungrib/Variable_Tables/Vtable.GFS Vtable<br>./link_grib.csh ../DATA/co_blizzard/gfs.0p25.2019<br><br>./ungrib.exe<br><span class="hljs-comment"># This will create an ungrib.log for your records.</span><br><br><span class="hljs-comment"># Examine the intermediate files, e.g.,</span><br><span class="hljs-comment"># ./util/rd_intermediate.exe FILE:2019-11-29_12</span><br><span class="hljs-comment"># ncl /util/plotfmt_ncl &#x27;filename=&quot;FILE:2019-11-29_12&quot;&#x27;</span><br></code></pre></td></tr></table></figure><h2 id="usage-of-fnl-on-wrfnwp">Usage of FNL on WRF/NWP</h2><p>The NCEP FNL (Final) Operational Global Analysis<sup id="fnref:4" class="footnote-ref"><a href="#fn:4" rel="footnote"><span class="hint--top hint--rounded" data-aria-label="[FNL more](https://rda.ucar.edu/OS/web/datasets/ds083.2/docs/more.html)">[4]</span></a></sup> <sup id="fnref:5" class="footnote-ref"><a href="#fn:5" rel="footnote"><span class="hint--top hint--rounded" data-aria-label="[GFS vs FNL](https://rda.ucar.edu/OS/web/datasets/ds083.2/docs/FNLvGFS.pdf)">[5]</span></a></sup> <sup id="fnref:6" class="footnote-ref"><a href="#fn:6" rel="footnote"><span class="hint--top hint--rounded" data-aria-label="[Analysis,  reanalysis, forecastâ€”whatâ€™s the difference?](https://rda.ucar.edu/OS/web/datasets/ds083.2/docs/Analysis.pdf)">[6]</span></a></sup> is on 1x1 degree grids are available every six hours. The analyses are from the NCEP Final Analyses (FNL). These were operationally prepared by NCEP, but are available for download from NCAR/RDA.</p><p>This product is from the Global Data Assimilation System (GDAS), which continuously collects observational data from the Global Telecommunications System (GTS), and other sources, for many analyses. The FNLs are made with the same model which NCEP uses in the Global Forecast System (GFS), <strong>but the FNLs are prepared about an hour or so after the GFS is initialized. The FNLs are delayed so that more observational data can be used</strong>. <em>The GFS is run earlier in support of time critical forecast needs, and uses the FNL from the previous 6 hour cycle as part of its initialization</em>.</p><p>FNLæ•°æ®é›†å’ŒGFSæ•°æ®é›†è™½æœ‰è”ç³»ï¼Œä½†åœ¨åŒä¸€èµ„æ–™åŒåŒ–å’Œé¢„æŠ¥ç³»ç»Ÿä¸­å´æœ‰ä¸åŒçš„äº§å“ã€‚å®ƒä»¬å…±äº«ç›¸åŒçš„åŸºç¡€æ¨¡å‹å’Œæ•°æ®åŒåŒ–æŠ€æœ¯ã€‚å®ƒä»¬åŒ…å«ç›¸åŒçš„æ•°æ®æºâ€”â€”<strong>ä½†æ˜¯åœ¨gfså’Œfnlçš„åˆå§‹æ¡ä»¶ä¸­å¸æ”¶çš„â€œçœŸå®â€æ•°æ®çš„æ•°é‡æœ‰ç»†å¾®çš„å·®åˆ«</strong>ã€‚å³ä½¿æœ‰ncepçš„å·¨å¤§è®¡ç®—èµ„æºï¼Œè¿è¡Œä¸€ä¸ªå…¨çƒnwpæ¨¡å‹ä¹Ÿéœ€è¦æ—¶é—´ã€‚å› æ­¤ï¼Œä»–ä»¬éœ€è¦å°½æ—©å¯åŠ¨gfsæ¥è·å¾—é¢„æŠ¥è€Œä¸æ˜¯åæŠ¥ã€‚fnlæ˜¯æœ€ç»ˆçš„åˆ†æç»“æœï¼Œæ¯”gfsç¨æ™šä¸€äº›ï¼Œä»¥ä¾¿èƒ½åŒ…æ‹¬æ‰€æœ‰å¯ç”¨çš„è§‚æµ‹æ•°æ®ã€‚é€šå¸¸ï¼Œfnlæ¯”gfså¤šæ‘„å–çº¦10%çš„è§‚å¯Ÿç»“æœã€‚è™½ç„¶å¼€å§‹æ—¶é—´è¾ƒæ™šï¼Œä½†ä»æœ‰è¶³å¤Ÿçš„æ—¶é—´ï¼Œå› æ­¤6å°æ—¶çš„fnl6å°æ—¶é¢„æŠ¥å¯ä½œä¸ºä¸‹ä¸€ä¸ªgfsèµ„æ–™åŒåŒ–å‘¨æœŸçš„èƒŒæ™¯åœºä¾‹å¦‚ï¼Œå¦‚æœä½ æƒ³è¦00zçš„æ°”çƒæ•°æ®ï¼Œä½ å¿…é¡»ç­‰å¾…æ°”çƒä¸Šå‡ç©¿è¿‡å¤§æ°”å±‚ã€‚å¯¹äºèƒ½å¤Ÿåˆ°è¾¾å¹³æµå±‚çš„å¤§å‹æ°¦æ°”ç®±æ¥è¯´ï¼Œè¿™å¯èƒ½éœ€è¦å¤šè¾¾90åˆ†é’Ÿã€‚ç„¶åæ°”çƒçš„æ•°æ®éœ€è¦ä»ä¸–ç•Œå„åœ°ä¼ é€åˆ°ç¾å›½é©¬é‡Œå…°å·çš„ncepä¸­å¿ƒã€‚å¦‚æœä½ æƒ³è¦00zçš„å«æ˜Ÿæ•°æ®ï¼Œä½ å¿…é¡»ç­‰å¾…å«æ˜Ÿç»è¿‡ä¸€ä¸ªåœ°é¢ç«™ï¼Œè¿™æ ·å®ƒæ‰èƒ½ä¸‹è½½æ•°æ®ã€‚åœ°é¢ç«™ç„¶åé€šè¿‡é™†åœ°æˆ–æµ·åº•ç”µç¼†(å¦‚æœæœ‰çš„è¯)ä¼ é€æ•°æ®ï¼Œæˆ–è€…é€šè¿‡å¦ä¸€é¢—(é€šä¿¡)å«æ˜Ÿä¼ é€æ•°æ®ã€‚<sup id="fnref:7" class="footnote-ref"><a href="#fn:7" rel="footnote"><span class="hint--top hint--rounded" data-aria-label="[FNLå†åˆ†ææ•°æ®å’ŒGFSæ•°æ®ä¹‹é—´çš„åŒºåˆ«å’Œè”ç³»](http://www.ihamodel.com/?p=17426)">[7]</span></a></sup></p><p>For further information about the FNL archives at NCAR: See, http://rda.ucar.edu/datasets/ds083.2.</p><p>Type: &gt; GRIB2 data</p><p>Resolution: &gt; 1deg global data &gt; Output frequency 6 hourly &gt; 34 pressure levels</p><p>Availability: &gt; http://rda.ucar.edu/datasets/ds083.2 &gt; Follow the tab to "Data Access -&gt; Internet Download". You must register (it is free) to access the data.</p><p>Vtable: <strong>Vtable.GFS</strong></p><h3 id="namelist.wps-1">namelist.wps</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh">Edit namelist.wps<br>start_date = <span class="hljs-string">&#x27;2019-11-25_12:00:00&#x27;</span>,<br>end_date = <span class="hljs-string">&#x27;2019-11-27_00:00:00&#x27;</span>,<br>interval_seconds = 21600,<br>prefix = <span class="hljs-string">&#x27;FILE&#x27;</span>,<br></code></pre></td></tr></table></figure><h3 id="script-1">Script</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># Notes on running UNGRIB for this data</span><br><span class="hljs-comment"># Examine the GRIB files, e.g.,</span><br><span class="hljs-comment"># ./util/g2print.exe ../DATA/boulder_snow/fnl_20191125_12_00.grib2</span><br><span class="hljs-built_in">ln</span> -sf ungrib/Variable_Tables/Vtable.GFS Vtable<br><br>./link_grib.csh ../DATA/boulder_snow/fnl_2019<br><br>./ungrib.exe<br><span class="hljs-comment"># This will create an ungrib.log for your records.</span><br><br><span class="hljs-comment"># Examine the intermediate files, e.g.,</span><br><span class="hljs-comment"># ./util/rd_intermediate.exe FILE:2019-11-25_12</span><br><span class="hljs-comment"># ncl /util/plotfmt.ncl &#x27;filename=&quot;FILE:2019-11-25_12&quot;&#x27;</span><br></code></pre></td></tr></table></figure><h2 id="read-and-plot-grib2-files">Read and Plot grib2 files</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">import xarray as xr<br>ds = xr.open_dataset(<span class="hljs-string">&#x27;./fnl_20191125_12_00.grib2&#x27;</span>,engine=<span class="hljs-string">&#x27;pynio&#x27;</span>)<br>ds<br></code></pre></td></tr></table></figure><section class="footnotes"><div class="footnote-list"><ol><li><span id="fn:1" class="footnote-text"><span><a href="https://www.ncei.noaa.gov/products/weather-climate-models/global-forecast">GFS Data Access</a> <a href="#fnref:1" rev="footnote" class="footnote-backref"> â†©</a></span></span></li><li><span id="fn:2" class="footnote-text"><span><a href="https://www.emc.ncep.noaa.gov/emc/pages/numerical_forecast_systems/gfs.php">GFS home page</a> <a href="#fnref:2" rev="footnote" class="footnote-backref"> â†©</a></span></span></li><li><span id="fn:3" class="footnote-text"><span><a href="https://www.emc.ncep.noaa.gov/users/verification/global/">Global Models Verification</a> <a href="#fnref:3" rev="footnote" class="footnote-backref"> â†©</a></span></span></li><li><span id="fn:4" class="footnote-text"><span><a href="https://rda.ucar.edu/OS/web/datasets/ds083.2/docs/more.html">FNL more</a> <a href="#fnref:4" rev="footnote" class="footnote-backref"> â†©</a></span></span></li><li><span id="fn:5" class="footnote-text"><span><a href="https://rda.ucar.edu/OS/web/datasets/ds083.2/docs/FNLvGFS.pdf">GFS vs FNL</a> <a href="#fnref:5" rev="footnote" class="footnote-backref"> â†©</a></span></span></li><li><span id="fn:6" class="footnote-text"><span><a href="https://rda.ucar.edu/OS/web/datasets/ds083.2/docs/Analysis.pdf">Analysis, reanalysis, forecastâ€”whatâ€™s the difference?</a> <a href="#fnref:6" rev="footnote" class="footnote-backref"> â†©</a></span></span></li><li><span id="fn:7" class="footnote-text"><span><a href="http://www.ihamodel.com/?p=17426">FNLå†åˆ†ææ•°æ®å’ŒGFSæ•°æ®ä¹‹é—´çš„åŒºåˆ«å’Œè”ç³»</a> <a href="#fnref:7" rev="footnote" class="footnote-backref"> â†©</a></span></span></li></ol></div></section>]]></content>
    
    
    <categories>
      
      <category>NWP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>WRF</tag>
      
      <tag>WPS</tag>
      
      <tag>MPAS</tag>
      
      <tag>IC/BC</tag>
      
      <tag>NCEP</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Git/Github</title>
    <link href="/2023/04/27/Git_GitHub/"/>
    <url>/2023/04/27/Git_GitHub/</url>
    
    <content type="html"><![CDATA[<h1 id="create-an-empty-git-repo">Create an empty git repo</h1><p>Git settings will be recorded in the <code>~/.gitconfig</code> ã€<code>~/.config/git/config</code> file under the home page of the user's directory. We need to use the config command to set it.</p><p>Git é™„å¸¶ä¸€å€‹åç‚º <code>git config</code> çš„å·¥å…·ï¼Œè®“ä½ èƒ½å¤ å–å¾—å’Œè¨­å®šçµ„æ…‹åƒæ•¸ã€‚ä»»ä½•å€‰å„²ä¸­ Git è³‡æ–™å¤¾çš„ config æª”æ¡ˆï¼ˆä½æ–¼ <code>.git/config</code>ï¼‰ï¼šé€™å€‹å€‰å„²çš„å°ˆç”¨è¨­å®š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ git config --global user.name <span class="hljs-string">&quot;&lt;username&gt;&quot;</span><br>$ git config --global user.email <span class="hljs-string">&quot;&lt;email&gt;&quot;</span><br></code></pre></td></tr></table></figure><p>Follow this command, you can set the color of Git's output (output) results. <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ git config --global color.ui auto<br></code></pre></td></tr></table></figure></p><p>change editor, <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ git config --global core.editor <span class="hljs-string">&quot;vim&quot;</span><br></code></pre></td></tr></table></figure></p><p>è‹¥ä½ æƒ³æª¢æŸ¥è¨­å®šå€¼ï¼Œå¯ä½¿ç”¨ <code>git config --list</code> å‘½ä»¤åˆ—å‡ºæ‰€æœ‰ Git åœ¨ç›®å‰ä½ç½®èƒ½æ‰¾åˆ°çš„è¨­å®šå€¼, <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ git config --list<br></code></pre></td></tr></table></figure></p><p>Follow the steps below to set the newly created tutorial directory as a Git database <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ <span class="hljs-built_in">mkdir</span> tutorial<br>$ <span class="hljs-built_in">cd</span> tutorial<br>$ git init<br><br><span class="hljs-comment">## Initialized empty Git repository in /Users/yourname/Desktop/tutorial/.git/</span><br>$ git status<br>$ git add .<br>$ git commit -m <span class="hljs-string">&quot;first commit&quot;</span><br>$ git commit --amend<br>$ git status<br>$ git <span class="hljs-built_in">log</span><br>$ git <span class="hljs-built_in">log</span> --all --graph --oneline<br></code></pre></td></tr></table></figure></p><p><img src="https://i.imgur.com/AnlwuNk.png" width="600" /></p><h1 id="create-branch-and-swich">Create branch and swich</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ git checkout -b iss53 <span class="hljs-comment"># åŒæ™‚å»ºç«‹ä¸”åˆ‡æ›åˆ†æ”¯</span><br>Switched to a new branch <span class="hljs-string">&quot;iss53&quot;</span><br>This is shorthand <span class="hljs-keyword">for</span>:<br><br>$ git branch iss53<br>$ git checkout iss53<br></code></pre></td></tr></table></figure><h1 id="git-push">git push</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ git remote add &lt;name&gt; &lt;url&gt;<br>$ git remote add origin https://xxx/tutorial.git<br></code></pre></td></tr></table></figure><p>Execute the following command to submit the push to the remote database origin, specify the parameter -u item when executing the submission, and then omit the specified branch name. But when pushing to a blank remote database, you must specify the name of the remote database and branch, which must not be omitted. During the process, the system will/may ask for user name and password</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ git push -u origin master<br>$ git push origin HEAD:refs/for/master<br>$ git <span class="hljs-built_in">clone</span> &lt;repository&gt; &lt;directory&gt;<br></code></pre></td></tr></table></figure><ol type="1"><li>git push <é ç«¯ä¸»æ©Ÿåç¨±> <æœ¬æ©Ÿåˆ†æ”¯åç¨±> : <é ç«¯åˆ†æ”¯åç¨±><ol type="1"><li>ä¾‹å¦‚ <code>git push origin masterï¼šrefs/for/master</code><ol type="1"><li>æ˜¯å°‡æœ¬åœ°çš„masteråˆ†æ”¯æ¨é€åˆ°é ç«¯ä¸»æ©Ÿoriginä¸Šçš„å°æ‡‰masteråˆ†æ”¯</li><li>origin æ˜¯é ç«¯ä¸»æ©Ÿåï¼Œ</li><li>ç¬¬ä¸€å€‹masteræ˜¯æœ¬åœ°åˆ†æ”¯åï¼Œ</li><li>ç¬¬äºŒå€‹masteræ˜¯é ç«¯åˆ†æ”¯åã€‚</li></ol></li><li><code>git push origin master</code><ol type="1"><li>å¦‚æœé ç«¯åˆ†æ”¯è¢«çœç•¥ï¼Œå¦‚ä¸Šå‰‡è¡¨ç¤ºå°‡æœ¬åœ°åˆ†æ”¯æ¨é€åˆ°èˆ‡ä¹‹å­˜åœ¨è¿½è¹¤é—œä¿‚çš„é ç«¯åˆ†æ”¯ï¼ˆé€šå¸¸å…©è€…åŒåï¼‰ï¼Œå¦‚æœè©²é ç«¯åˆ†æ”¯ä¸å­˜åœ¨ï¼Œå‰‡æœƒè¢«æ–°å»º</li><li>ï¼ˆä¾‹å¦‚ï¼Œå¦‚æœåªæ˜¯git push origin HEADï¼Œä¹Ÿå°±æ˜¯æ²’æœ‰æŒ‡å®šé ç«¯åˆ†æ”¯ï¼Œå‰‡æœƒæ¨é€åˆ°èˆ‡ç›®å‰åˆ†æ”¯åŒåçš„é ç«¯åˆ†æ”¯ï¼Œå¦‚æœé ç«¯æ²’æœ‰é€™å€‹åŒååˆ†æ”¯ï¼Œå‰‡åœ¨é ç«¯ç¨‹å¼åº«å»ºç«‹ä¸€å€‹å’Œç›®å‰åˆ†æ”¯åç¨±ä¸€æ¨£çš„é ç«¯åˆ†æ”¯)</li></ol></li><li><code>git push origin HEAD:refs/for/master</code><ol type="1"><li>ï¼ˆæ³¨æ„é€™è£¡çš„orginå’ŒHEADæ²’ä»€éº¼é—œä¿‚ï¼Œæ¯”å¦‚èªªï¼šgit branch --set-upstream-to=origin/dev dev_local é€™è£¡æ˜¯origin/devï¼Œä¸­é–“æœ‰å€‹/ï¼Œæ„æ€å°±æ˜¯é ç«¯å‡½å¼åº«çš„devåˆ†æ”¯ï¼‰</li><li>git push è‚¯å®šæ˜¯æ¨é€</li><li>origin : æ˜¯é ç«¯çš„å‡½å¼åº«çš„åå­—</li><li>HEAD: æ˜¯ä¸€å€‹ç‰¹åˆ¥çš„æŒ‡é‡ï¼Œå®ƒæ˜¯ä¸€å€‹æŒ‡å‘ä½ æ­£åœ¨å·¥ä½œçš„æœ¬åœ°åˆ†æ”¯çš„æŒ‡é‡ï¼Œå¯ä»¥æŠŠå®ƒç•¶ä½œæœ¬åœ°åˆ†æ”¯çš„åˆ¥åï¼Œgité€™æ¨£å°±å¯ä»¥çŸ¥é“ä½ å·¥ä½œåœ¨å“ªå€‹åˆ†æ”¯</li><li>refs/for :æ„ç¾©åœ¨æ–¼æˆ‘å€‘æäº¤ç¨‹å¼ç¢¼åˆ°ä¼ºæœå™¨ä¹‹å¾Œæ˜¯éœ€è¦ç¶“é code review ä¹‹å¾Œæ‰èƒ½é€²è¡Œmergeçš„</li><li>refs/headsï¼š ä¸éœ€è¦</li></ol></li></ol></li></ol><h1 id="git-pull">git pull</h1><p>git pull - Fetch from and integrate with another repository or a local branch</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ git pull --rebase<br>You are not currently on a branch.<br>Please specify <span class="hljs-built_in">which</span> branch you want to rebase against.<br>See git-pull(1) <span class="hljs-keyword">for</span> details.<br><br>    git pull &lt;remote&gt; &lt;branch&gt;<br><br>$ git branch<br>master<br>....<br><br>$ git checkout master<br>Updating files: 100% (43/43), <span class="hljs-keyword">done</span>.<br>Previous HEAD position was c1d75b7 Merge <span class="hljs-string">&quot;MPAS Benchmark System - added GFS support to scorecard&quot;</span><br>Switched to branch <span class="hljs-string">&#x27;master&#x27;</span><br>Your branch is up to <span class="hljs-built_in">date</span> with <span class="hljs-string">&#x27;origin/master&#x27;</span>.<br><br>$ git <span class="hljs-built_in">log</span><br>$ git pull --rebase<br></code></pre></td></tr></table></figure><h1 id="æ’¤éŠ·ä¿®æ”¹å ´æ™¯">æ’¤éŠ·ä¿®æ”¹å ´æ™¯</h1><p>æ’¤éŠ·ä¿®æ”¹å ´æ™¯ å·¥ä½œå€æ–‡ä»¶ä¿®æ”¹äº†ï¼Œä½†é‚„æ²’é€²å…¥ç‰ˆæœ¬ç®¡ç†ï¼Œç¾åœ¨ä¸æƒ³è¦äº†ï¼Œå¦‚ä½•å›é€€ã€æ’¤éŠ·å·²æœ‰çš„ä¿®æ”¹</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs cmake"><span class="hljs-comment"># å»ºè­°ä½¿ç”¨restoreæŒ‡ä»¤</span><br>git restore &lt;<span class="hljs-keyword">file</span>&gt;<br><span class="hljs-comment"># revert all local change</span><br>git restore .<br><span class="hljs-comment"># Warning this will reset all of your unpushed commits to master!:</span><br>git reset<br><span class="hljs-comment"># To remove untracked files and untracked directories (e.g., new files, generated files):</span><br>git clean -fd<br></code></pre></td></tr></table></figure><h1 id="stash-æš«å­˜ä¿®æ”¹å…§å®¹">stash æš«å­˜ä¿®æ”¹å…§å®¹</h1><p>æœ‰æ™‚å€™æˆ‘å€‘æœƒé‡åˆ°éœ€è‡¨æ™‚ä¿®æ”¹å®ƒåˆ†æ”¯çš„ç‹€æ³ï¼Œé€™é‚Šçš„è‡¨æ™‚ä»£è¡¨æ­£åœ¨é–‹ç™¼çš„é …ç›®ä¸¦ä¸æ˜¯å®ƒåˆ†æ”¯çš„å…§å®¹ï¼Œæ¯”å¦‚èªª master åˆ†æ”¯éœ€åšç·Šæ€¥ä¿®æ”¹ï¼Œä½†æˆ‘å€‘ç›®å‰æ­£åœ¨è·‘ feature åˆ†æ”¯çš„é€²åº¦ï¼Œé€™æ™‚ä½ å¯èƒ½æœƒå°‡ feature å°šæœªæäº¤æˆ commit çš„ä¿®æ”¹å…§å®¹è¤‡è£½åˆ°ä¸€å€‹ç©ºç™½æ–‡ä»¶ä¸Šï¼Œä»¥ç¢ºä¿ä¿®æ”¹å…§å®¹ä¸æœƒä¸è¦‹ï¼Œæœ€å¾Œç•¶ master åˆ†æ”¯ä¿®æ”¹å®Œæˆæ™‚ï¼Œå†å°‡ä¿®æ”¹å…§å®¹è²¼å›åˆ° feature ä¸Šï¼Œé€™ç¢ºå¯¦ä¹Ÿæ˜¯å€‹è¾¦æ³•ï¼Œä½†å…¶å¯¦ä¸ç”¨é€™éº¼éº»ç…©ï¼ŒGit æœ¬èº«å°±æœ‰å°ˆé–€è™•ç†æ­¤æƒ…æ³çš„æŒ‡ä»¤ï¼Œåç‚º stashï¼Œå¯å°‡ç•¶ä¸‹åˆ†æ”¯çš„ä¿®æ”¹å…§å®¹æš«å­˜èµ·ä¾†ï¼Œæ—¥å¾Œæœ‰éœ€è¦å†å°‡å®ƒå–å‡ºå³å¯ã€‚</p><p>æˆ‘å€‘å¯ä½¿ç”¨ä»¥ä¸‹æŒ‡ä»¤å°‡ç•¶å‰åˆ†æ”¯çš„ä¿®æ”¹çµ¦æš«å­˜ä¸‹ä¾†ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh">æš«å­˜ç•¶å‰åˆ†æ”¯ä¿®æ”¹å…§å®¹ï¼š<br>git stash<br>git status <span class="hljs-comment">#check: working tree clean</span><br><br>æš«å­˜ç•¶å‰åˆ†æ”¯ä¿®æ”¹å…§å®¹ (åŒ…å«æœªè¿½è¹¤)ï¼š<br>git stash -u<br>git status <span class="hljs-comment">#check: working tree clean</span><br></code></pre></td></tr></table></figure><p>æˆ‘å€‘å¯ä½¿ç”¨ä»¥ä¸‹æŒ‡ä»¤æŸ¥çœ‹æ‰€æœ‰æš«å­˜å…§å®¹ï¼š <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">git stash list<br></code></pre></td></tr></table></figure></p><p>å‡è¨­ä½ å·²ç¶“å®Œæˆè‡¨æ™‚çš„ä»»å‹™ï¼Œæ­¤æ™‚å¯ä½¿ç”¨ä»¥ä¸‹æŒ‡ä»¤<strong>å–å‡ºæš«å­˜å…§å®¹</strong>ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh">å°‡æœ€æ–°æš«å­˜å¥—ç”¨è‡³ç•¶å‰åˆ†æ”¯ï¼ŒæˆåŠŸå¾ŒéŠ·æ¯€æš«å­˜ (å³ stash@&#123;0&#125;)ï¼š<br>git stash pop<br><br>å°‡æŒ‡å®šæš«å­˜å¥—ç”¨è‡³ç•¶å‰åˆ†æ”¯ï¼ŒæˆåŠŸå¾ŒéŠ·æ¯€æš«å­˜ï¼š<br>git stash pop stash@&#123;1&#125;<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨ pop å¯ä»¥æŠŠæŸå€‹ stash æ‹¿å‡ºä¾†ä¸¦å¥—ç”¨åœ¨ç›®å‰çš„åˆ†æ”¯ä¸Šï¼Œå¥—ç”¨å®Œæˆå³éŠ·æ¯€é€™å€‹æš«å­˜å…§å®¹ï¼Œå¦‚æœä½ <strong>ä¸æƒ³éŠ·æ¯€æš«å­˜å…§å®¹</strong>ï¼Œå¯æ”¹ç”¨ä»¥ä¸‹æŒ‡ä»¤ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh">å°‡æœ€æ–°æš«å­˜å¥—ç”¨è‡³ç•¶å‰åˆ†æ”¯ï¼ŒæˆåŠŸå¾Œä¿ç•™æš«å­˜ï¼š<br>git stash apply<br><br>å°‡æŒ‡å®šæš«å­˜å¥—ç”¨è‡³ç•¶å‰åˆ†æ”¯ï¼ŒæˆåŠŸå¾Œä¿ç•™æš«å­˜ï¼š<br>git stash apply stash@&#123;1&#125;<br></code></pre></td></tr></table></figure><p>apply åªæœƒå°‡æš«å­˜åšå¥—ç”¨çš„å‹•ä½œï¼Œä¸¦ä¸æœƒéŠ·æ¯€æš«å­˜ï¼Œå¦‚æœä½ ä¸æƒ³è¦æŸå€‹æš«å­˜äº†ï¼Œå¯ä½¿ç”¨ä»¥ä¸‹æŒ‡ä»¤ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh">åˆªé™¤æœ€æ–°æš«å­˜ (å³ stash@&#123;0&#125;)<br>git stash drop<br><br>åˆªé™¤æŒ‡å®šæš«å­˜ï¼š<br>git stash drop stash@&#123;1&#125;<br><br>åˆªé™¤å…¨éƒ¨æš«å­˜ï¼š<br>git stash clear<br></code></pre></td></tr></table></figure><h1 id="åˆä½µæœ¬åœ°å¤šæ¬¡æäº¤è¨˜éŒ„å ´æ™¯">åˆä½µæœ¬åœ°å¤šæ¬¡æäº¤è¨˜éŒ„å ´æ™¯</h1><p>å ´æ™¯ï¼šæœ‰æ™‚é–‹ç™¼æŸä¸€å€‹åŠŸèƒ½æ™‚æœƒæäº¤å¾ˆå¤šæ¬¡commitï¼Œé€™æ¨£æœƒé¡¯å¾—ç‰ˆæœ¬æ—¥èªŒå¾ˆäº‚ï¼Œå°¤å…¶æ˜¯åœ¨å¤šäººå”ä½œçš„é–‹ç™¼å ´æ™¯ä¸­ã€‚é€™æ™‚å¯ä»¥å°‡å¤šå€‹ç·Šå¯†ç›¸é—œçš„commitåˆä½µæˆä¸€å€‹ã€‚</p><p>ç°¡å–®æƒ…æ³ï¼šåªæ˜¯å°æœ€æ–°ä¸€æ¬¡çš„commité€²è¡Œä¿®æ­£çš„è©±ï¼Œå¯ä»¥ä½¿ç”¨</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">git commit -v --amend<br></code></pre></td></tr></table></figure><p>æ›´è¤‡é›œæƒ…æ³ï¼š <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh">git rebase -i HEAD~4 <span class="hljs-comment"># åˆä½µæœ€è¿‘4æ¬¡æäº¤è¨˜éŒ„</span><br><span class="hljs-comment"># é€²å…¥viç·¨è¼¯æ¨¡å¼ï¼Œä¾ç…§æç¤ºå°æ‡‰commité¸æ“‡æŒ‡ä»¤ï¼Œå¸¸ç”¨çš„åŒ…æ‹¬pick,edit,squash,fixup</span><br>s cacc52da add: qrcode<br>s f072ef48 update: indexeddb hack<br>s 4e84901a feat: add indexedDB floder<br>p 8f33126c feat: add test2.js<br></code></pre></td></tr></table></figure> åˆä½µæˆåŠŸå¾Œï¼Œgit logæœƒç™¼ç¾å››å€‹ç‰ˆæœ¬è³‡è¨Šè®Šæˆäº†ä¸€å€‹ã€‚</p><p>å¦‚æœç•°å¸¸é€€å‡ºviç·¨è¼¯çª—å£ï¼Œå¯ä»¥åŸ·è¡Œ <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">git rebase --edit-todo<br><span class="hljs-comment">#é€²å…¥ç·¨è¼¯è¦–çª—ç¹¼çºŒç·¨è¼¯å„²å­˜</span><br>git rebase --<span class="hljs-built_in">continue</span><br></code></pre></td></tr></table></figure></p><p>ä¸è¦åˆä½µå·²ç¶“æäº¤é ç«¯åˆ†æ”¯çš„è¨˜éŒ„ï¼Œå¦å‰‡æœƒå ±éŒ¯ <figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs console">error: cannot &#x27;squash&#x27; without a previous commit<br></code></pre></td></tr></table></figure></p><h1 id="æ‹‰å–ä¸»åˆ†æ”¯æœ€æ–°ç‰ˆæœ¬åˆ°å€‹äººé–‹ç™¼åˆ†æ”¯å ´æ™¯">æ‹‰å–ä¸»åˆ†æ”¯æœ€æ–°ç‰ˆæœ¬åˆ°å€‹äººé–‹ç™¼åˆ†æ”¯å ´æ™¯</h1><p>é€™åœ¨åœ˜éšŠé–‹ç™¼ä¸­å¾ˆå¸¸è¦‹ï¼Œä¸»åˆ†æ”¯é »ç¹æ›´æ–°ï¼Œå€‹äººé–‹ç™¼ç‰¹æ€§åˆ†æ”¯ç›¸æ¯”ä¸»åˆ†æ”¯æœƒè½å¾Œï¼Œéœ€è¦åŠæ™‚æ›´æ–°masterä¸»åˆ†æ”¯æœ€æ–°è®Šå‹•</p><ul><li>æ–¹æ³•ä¸€ï¼šä½¿ç”¨git merge masteråˆä½µä¸»åˆ†æ”¯æœ€æ–°è®Šå‹•ï¼Œä½†gitæ—¥èªŒè£¡æœƒå‡ºç¾mergeè³‡è¨Šã€‚</li><li>æ–¹æ³•äºŒï¼šå¦‚æœå¸Œæœ›ä¿æŒä¹¾æ·¨çš„commitï¼Œä½¿ç”¨git rebaseã€‚</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh">git rebase master<br><span class="hljs-comment"># å¦‚æœå‡ºç¾è¡çªï¼Œéœ€è¦è§£æ±ºè¡çªï¼Œç„¶å¾Œgit add</span><br>git add something<br>git rebase --<span class="hljs-built_in">continue</span><br><br><span class="hljs-comment"># å¾Œæ‚”é¸é …ï¼Œçµ‚æ­¢rebaseæ“ä½œ</span><br>git rebase --abort<br></code></pre></td></tr></table></figure><h1 id="ç‰ˆæœ¬å›æ»¾å ´æ™¯">ç‰ˆæœ¬å›æ»¾å ´æ™¯</h1><p>ç†è§£GITä¸‰ç¨®æ¨¡å¼ï¼šå·¥ä½œå€ã€æš«å­˜å€ã€ç‰ˆæœ¬åº«</p><ul><li>å ´æ™¯1ï¼šå·¥ä½œç›®éŒ„ç¨‹å¼ç¢¼æª”æ¡ˆä¿®æ”¹å®Œï¼Œä½†é‚„æœª <code>git add</code> ç´å…¥äº†æš«å­˜å€<ul><li>ä½¿ç”¨ <code>git checkout .</code> ä½¿ç”¨æš«å­˜å€æ–‡ä»¶è¦†è“‹å·¥ä½œå€æ–‡ä»¶</li></ul></li><li>å ´æ™¯2ï¼šå·²ç¶“åŸ·è¡Œ <code>git add</code> ç´å…¥æš«å­˜å€ï¼Œä½†é‚„æ²’æäº¤commitåˆ°ç‰ˆæœ¬åº«ã€‚<ul><li><code>git reset</code> #å…ˆç”¨HEADæŒ‡æ¨™è¦†è“‹ç›®å‰çš„æš«å­˜å€å…§å®¹</li><li><code>git checkout .</code> #å†ç”¨æš«å­˜å€å…§å®¹è¦†è“‹å·¥ä½œå€å…§å®¹</li><li><code>git reset --hard</code> #ç›´æ¥ä½¿ç”¨HEADè¦†è“‹ç›®å‰æš«å­˜å€å’Œå·¥ä½œå€</li></ul></li><li>å ´æ™¯3ï¼šå·²ç¶“ commit æäº¤åˆ°æœ¬åœ°ç‰ˆæœ¬è¨˜éŒ„ä¸­ï¼Œä½†é‚„æ²’æœ‰æ¨é€åˆ° git push é ç«¯å€‰åº«.<ul><li><code>git reset --hard &lt;last_commit_id&gt;</code> #è¦†è“‹æœ¬æ©Ÿç‰ˆæœ¬åº«ã€æš«å­˜å€å’Œå·¥ä½œå€</li></ul></li><li>å ´æ™¯4ï¼šå·²ç¶“ <code>git push</code> æ¨é€åˆ°é ç«¯å€‰åº«<ul><li><code>git reset --hard &lt;commit_id&gt;</code></li><li><code>git push origin &lt;remote_branch&gt; --forc</code>e</li></ul></li></ul><h1 id="èª¤åœ¨ä¸»åˆ†æ”¯é–‹ç™¼å ´æ™¯">èª¤åœ¨ä¸»åˆ†æ”¯é–‹ç™¼å ´æ™¯</h1><p>å°ˆæ¡ˆè¦å®šdevelopåˆ†æ”¯ç‚ºé–‹ç™¼ä¸»åˆ†æ”¯ï¼Œæˆå“¡ä¸èƒ½ç›´æ¥åœ¨è©²åˆ†æ”¯ä¸Šä¿®æ”¹æäº¤ï¼Œå¿…é ˆå»ºç«‹é¡ä¼¼feature/xxxç‰¹æ€§åˆ†æ”¯é€²è¡Œé–‹ç™¼ã€‚ä½†æœ‰æ™‚å€™æ‹‰å–ç‰ˆæœ¬å¾Œå¿˜äº†å‰µå»ºç‰¹æ€§åˆ†æ”¯ï¼Œç›´æ¥åœ¨developåˆ†æ”¯ä¿®æ”¹ã€‚æ­¤æ™‚å¦‚ä½•è™•ç†ï¼Ÿ</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># æš«å­˜developåˆ†æ”¯ä¿®æ”¹å…§å®¹</span><br>git stash<br><span class="hljs-comment"># ç„¶å¾Œå»ºç«‹ç‰¹æ€§åˆ†æ”¯</span><br>git checkout -b new_branch <span class="hljs-comment"># # åŒæ™‚å»ºç«‹ä¸”åˆ‡æ›åˆ†æ”¯</span><br><span class="hljs-comment"># å°‡æš«å­˜ä¿®æ”¹æ”¾åˆ°æ–°åˆ†æ”¯ä¸­</span><br>git stash pop<br><span class="hljs-comment"># æ­¤æ™‚å¯ä»¥æ­£å¸¸ä½¿ç”¨git addç¹¼çºŒé–‹ç™¼</span><br></code></pre></td></tr></table></figure><h1 id="æ¯”å°æª”æ¡ˆèˆ‡ç‰ˆæœ¬å·®ç•°">æ¯”å°æª”æ¡ˆèˆ‡ç‰ˆæœ¬å·®ç•°</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sh">git diff <span class="hljs-comment">#åœ¨ä»€éº¼åƒæ•¸éƒ½ä¸åŠ çš„ä½¿ç”¨æƒ…æ³ï¼Œæ¯”å°çš„æ˜¯ã€Œå·¥ä½œç›®éŒ„ã€èˆ‡ã€Œç´¢å¼•ã€(index)ä¹‹é–“çš„å·®ç•°</span><br>git diff commit1 commit2 <span class="hljs-comment">#æ¯”å°å…©å€‹ç‰ˆæœ¬é–“çš„å·®ç•°</span><br>git diff HEAD <span class="hljs-comment"># æœ€å¸¸ç”¨çš„æŒ‡ä»¤ï¼Œå› ç‚ºé€™ä»£è¡¨ä½ è¦æ‹¿ã€Œå·¥ä½œç›®éŒ„ã€èˆ‡ã€Œç•¶å‰åˆ†æ”¯çš„æœ€æ–°ç‰ˆã€é€²è¡Œæ¯”å°</span><br>git diff --cached HEAD <span class="hljs-comment"># æœ€å¸¸ç”¨çš„æŒ‡ä»¤(ç´¢å¼•(index)ç‹€æ…‹)ï¼Œé€™å€‹èªæ³•ä»£è¡¨çš„æ˜¯ã€Œç•¶å‰çš„ç´¢å¼•ç‹€æ…‹ã€èˆ‡ã€Œç•¶å‰åˆ†æ”¯çš„æœ€æ–°ç‰ˆã€é€²è¡Œæ¯”å°ã€‚</span><br><br>git diff =&gt; å·¥ä½œç›®éŒ„ vs ç´¢å¼•(index)<br>git diff HEAD =&gt; å·¥ä½œç›®éŒ„ vs HEAD<br>git diff --cached HEAD =&gt; ç´¢å¼•(index) vs HEAD<br>git diff --cached =&gt; ç´¢å¼• vs HEAD<br>git diff HEAD^ HEAD =&gt; HEAD^ vs HEAD<br></code></pre></td></tr></table></figure><h1 id="git-merge">git merge</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># å…ˆåˆ‡æ›åˆ°ä¸»åˆ†æ”¯</span><br>$ git checkout master<br> <br><span class="hljs-comment"># ä½¿ç”¨ fast-forward</span><br>$ git merge &lt;branch&gt; <br><br>or <br><span class="hljs-comment"># ä½¿ç”¨ no-fast-forward</span><br>$ git merge &lt;branch&gt; --no-ff <br></code></pre></td></tr></table></figure><h1 id="git-rebase">git rebase</h1><p>Rebase æ˜¯ â€œRe-â€ èˆ‡ â€œBaseâ€ çš„è¤‡åˆå­—ï¼Œé€™è£¡çš„ â€œBaseâ€ ä»£è¡¨ã€ŒåŸºç¤ç‰ˆæœ¬ã€çš„æ„æ€ï¼Œè¡¨ç¤ºä½ æƒ³è¦é‡æ–°ä¿®æ”¹ç‰¹å®šåˆ†æ”¯çš„ã€ŒåŸºç¤ç‰ˆæœ¬ã€ï¼ŒæŠŠå¦å¤–ä¸€å€‹åˆ†æ”¯çš„è®Šæ›´ï¼Œç•¶æˆæˆ‘é€™å€‹åˆ†æ”¯çš„åŸºç¤ã€‚</p><p>åŠŸèƒ½ä¸€ï¼šåˆä½µç‰ˆæœ¬ <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># åˆ‡æ›è‡³ branch1 åˆ†æ”¯ï¼š</span><br>git checkout branch1<br> <br><span class="hljs-comment"># ç„¶å¾ŒåŸ·è¡Œ Rebase å‹•ä½œï¼ŒæŠŠ master ç•¶æˆæˆ‘å€‘çš„åŸºç¤ç‰ˆæœ¬ï¼š </span><br>git rebase master<br></code></pre></td></tr></table></figure></p><p>åŠŸèƒ½äºŒï¼šä¿®æ”¹æ­·å² commit ç´€éŒ„ <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">é™¤ä¸Šè¿°åŠŸèƒ½å¤–ï¼Œrebase é‚„èƒ½ç”¨ä¾†ä¿®æ”¹ç‰¹å®šåˆ†æ”¯ç·šä¸Šä»»ä½•ä¸€å€‹ç‰ˆæœ¬çš„ç‰ˆæœ¬è³‡è¨Š<br>git rebase -i HEAD~3<br></code></pre></td></tr></table></figure></p><ul><li>è«‹éå¸¸å°å¿ƒä½¿ç”¨ï¼Œå› ç‚º rebase æœƒæ”¹è®Šæ­·å²ç´€éŒ„</li></ul><h1 id="updates-were-rejected">Updates were rejected</h1><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs console">To github.com:waipangsze/waipangsze.github.io.git<br> ! [rejected]            hexo -&gt; hexo (non-fast-forward)<br>error: failed to push some refs to &#x27;git@github.com:waipangsze/waipangsze.github.io.git&#x27;<br>hint: Updates were rejected because the tip of your current branch is behind<br>hint: its remote counterpart. Integrate the remote changes (e.g.<br>hint: &#x27;git pull ...&#x27;) before pushing again.<br>hint: See the &#x27;Note about fast-forwards&#x27; in &#x27;git push --help&#x27; for details.<br></code></pre></td></tr></table></figure><p>é€™æ˜¯å› ç‚ºé ç«¯ repository å’Œæˆ‘æœ¬åœ°çš„ repository è¡çªå°è‡´çš„; ä½†æ˜¯å»æ²’æœ‰pullåˆ°æœ¬åœ°ã€‚é€™æ¨£å°±ç”¢ç”Ÿäº†ç‰ˆæœ¬è¡çªçš„å•é¡Œã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh">1. ä½¿ç”¨å¼ºåˆ¶pushçš„æ–¹æ³•<br>git push -u origin master -f<br>è¿™æ ·ä¼šä½¿è¿œç¨‹ä¿®æ”¹ä¸¢å¤±&amp;#xff0c;ä¸€èˆ¬æ˜¯ä¸å¯å–çš„&amp;#xff0c;å°¤å…¶æ˜¯å¤šäººåä½œå¼€å‘çš„æ—¶å€™ã€‚<br><br>2. pushå‰å…ˆå°†è¿œç¨‹repositoryä¿®æ”¹pullä¸‹æ¥<br>git pull origin master<br>git push -u origin master<br></code></pre></td></tr></table></figure><h1 id="conflicts">Conflicts</h1><p>Between your last push and the next push, if someone else pushes to update the remote database but you do not update your local database, your push will be rejected. At this time, you need to perform a merge operation to import other people's modification history,otherwise the push will be rejected.</p><h2 id="resolve-conflict">Resolve conflict</h2><blockquote><p>The upper part separated by == is the editing content of the local database, and the lower part is the editing content of the remote database. After modifying all conflicting places, performing a commit will submit the commit content of the conflicting merge message.</p></blockquote><h1 id="git-addcommitpush">git add/commit/push</h1><p>When the remote github repo is known, You can git clone the remote address first Then copy the project file to be submitted to the clone folder</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># Add all files, such as submitting only some files requires a single git add file name</span><br>git add. <br>git commit -m <span class="hljs-string">&quot;remarks for submission&quot;</span><br><span class="hljs-comment"># Make some changes</span><br>git commit --amend<br><br><span class="hljs-comment"># Force push can overwrite master</span><br>git push -u -f origin master<br></code></pre></td></tr></table></figure><p>If you git <strong>commit --amend</strong> here, then error "Your branch and 'origin/master' have diverged" will reject your git push. The process here is,</p><ol type="1"><li>git clone github repo (latest one with commit ID A)</li><li>you make something changes</li><li>$ git commit --amend -m "remarks for submission"</li><li>The above commit with amend will create a New commit ID and rewrite the original commit ID A. Therefore, it can not reconignate two commit ID's and tell your branch and remote 'origin/master' have diverged.</li></ol><p>The solution is, <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">git rebase origin/master <span class="hljs-comment"># git rebase origin main</span><br><span class="hljs-comment"># or</span><br>git merge origin/master <span class="hljs-comment"># git merge origin main</span><br></code></pre></td></tr></table></figure> <a href="https://poanchen.github.io/blog/2020/09/19/what-to-do-when-git-branch-has-diverged">WHAT TO DO WHEN GIT BRANCH HAS DIVERGED?</a></p><h1 id="common-error">Common Error</h1><h2 id="rejected-master---master-non-fast-forward">[rejected] master -&gt; master (non-fast-forward)</h2><blockquote><p>! [rejected] master -&gt; master (non-fast-forward) error: failed to push some refs to â€™â€™ To prevent you from losing history, non-fast-forward updates were rejected Merge the remote changes (e.g. 'git pull') before pushing again. See the 'Note about fast-forwards' section of 'git push --help' for details.</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ git pull origin master<br><br><span class="hljs-comment"># * branch master -&gt; FETCH_HEAD</span><br><span class="hljs-comment"># CONFLICT (content): Merge conflict in file</span><br><span class="hljs-comment"># Automatic merge failed; fix conflicts and then commit the result.</span><br><span class="hljs-comment"># A warning message will appear warning about conflicts during the merge.</span><br></code></pre></td></tr></table></figure><p>The conficts like, &gt; &lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD &gt; commit records the state of the index &gt; ======= &gt; pull Get the content of the remote database &gt; &gt;&gt;&gt;&gt;&gt;&gt;&gt; 4c0182374230cd6eaa93b30049ef2386264fe12a</p><p>Modify the conflicting places, import the modifications of both parties, and delete the redundant marked lines.</p><blockquote><p>commit records the state of the index pull Get the content of the remote database</p></blockquote><p>When the content is modified and the file conflict is resolved, a commit is required. <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ git add sample.txt<br>$ git commit -m <span class="hljs-string">&quot;merge&quot;</span><br></code></pre></td></tr></table></figure></p><h1 id="gitignore-file-itself-is-not-being-ignored">.gitignore file itself is not being ignored</h1><p>This means that .gitignore is a tracked file.... so you changed it, so it shows up as changed. This would be the expected result... and it makes sense. Do you want to ignore .gitignore? This is not quite a good idea because by tracking it, everyone gets to ignore the same things in the project. Now, if you would like to be the only person in the project to be ignoring the files that you started the question from, you might have to consider adding that to <strong>.git/info/exclude</strong> so that it's only on you and no one else.</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh"> $ <span class="hljs-built_in">cat</span> .git/info/exclude<br><span class="hljs-comment"># git ls-files --others --exclude-from=.git/info/exclude</span><br><span class="hljs-comment"># Lines that start with &#x27;#&#x27; are comments.</span><br><span class="hljs-comment"># For a project mostly in C, the following would be a good set of</span><br><span class="hljs-comment"># exclude patterns (uncomment them if you want to use them):</span><br><span class="hljs-comment"># *.[oa]</span><br><span class="hljs-comment"># *~</span><br></code></pre></td></tr></table></figure><h1 id="æŒçºŒæ•´åˆcontinuous-integration-ciç³»çµ±">æŒçºŒæ•´åˆï¼ˆContinuous integration CIï¼‰ç³»çµ±</h1><p>ç•¶é–‹ç™¼äººå“¡å°‡æœ¬æ©ŸGitå€‰åº«ä¸­çš„ç¨‹å¼ç¢¼æ›´æ–°å¾Œï¼ŒåŸ·è¡Œcommitå’Œpushæ“ä½œï¼›è©²å‹•ä½œæœƒç”¢ç”Ÿä¸€å€‹äº‹ä»¶ï¼Œä¸¦è§¸ç™¼Jenkinsé€²è¡Œå»ºç½®ã€‚å¦‚æœé–‹ç™¼äººå“¡åœ¨ç¨‹å¼ç¢¼ä¸­åŠ å…¥å’ŒJunitæˆ–testngæ¸¬è©¦æ¡ˆä¾‹ï¼Œä¹Ÿæœƒåœ¨å»ºç½®éç¨‹ä¸­åŸ·è¡Œï¼›å»ºç½®å®Œæˆå¾Œï¼Œjenkinsæœƒå°‡å»ºç½®çš„çµæœä»¥GerritæŠ•ç¥¨çš„æ–¹å¼å‚³åˆ°Gerritä¼ºæœå™¨ä¸Šã€‚å°ˆæ¡ˆOwnerç™»å…¥Gerrit Web UIï¼Œé€²è¡ŒCode Reviewæ™‚æœƒçœ‹åˆ°Jenkinså»ºç½®çš„çµæœä¸¦é€²è¡Œcode reviewã€‚åªæœ‰ç•¶å»ºç½®æˆåŠŸï¼Œä¸”code reviewé€šéæ™‚ï¼Œå°ˆæ¡ˆowneræ‰æœƒå°‡ç¨‹å¼ç¢¼åˆåˆ°ä¸»åˆ†æ”¯ä¸Šï¼Œå¦‚æœèªªjenkinsä¸Šå»ºç½®å¤±æ•—ï¼Œå‰‡è¡¨ç¤ºç¨‹å¼ç¢¼è‚¯å®šæœ‰å•é¡Œï¼ŒOwnerä¸ç”¨Code Reviewï¼Œç›´æ¥é€šçŸ¥é–‹ç™¼æª¢æŸ¥ç¨‹å¼ç¢¼ä¸¦é‡æ–°æäº¤ã€‚</p><p>è¿‘å¹´ä¾†ï¼Œç”±æ–¼é–‹æºå°ˆæ¡ˆã€ç¤¾ç¾¤çš„æ´»èºç†±åº¦å¤§å¢ï¼Œé€²è€Œå¼•ä¾†æŒçºŒæ•´åˆï¼ˆCIï¼‰ç³»çµ±çš„èª•ç”Ÿï¼Œä¹Ÿè¶Šç™¼çš„è½åˆ°æ›´å¤šçš„äººåœ¨èªªå”åŒé–‹ç™¼ã€æ•æ·é–‹ç™¼ã€è¿­ä»£é–‹ç™¼ã€æŒçºŒæ•´åˆå’Œå–®å…ƒæ¸¬è©¦é€™äº›æ‹‰é¢¨çš„è¡“èªã€‚ç„¶è€Œï¼Œå¤§éƒ½æ˜¯åƒ…åƒ…è½åˆ°åœ¨èªªè€Œå·²ï¼Œåœ‹å…§ä¹Ÿå¾ˆå°‘æœ‰å…¬å¸èƒ½æœ‰å®Œæ•´çš„ CI é«”ç³»æµç¨‹ã€‚åä¹‹ä¸€äº›é–‹æºå°ˆæ¡ˆéƒ½æœ‰å®Œæ•´çš„ CIé«”ç³»ï¼Œä¾‹å¦‚openstackã€‚ç‚ºäº†å¯¦ç¾ç¨‹å¼ç¢¼è¨—ç®¡-&gt;ç¨‹å¼ç¢¼å¯©æ ¸-&gt;ç¨‹å¼ç¢¼ç™¼ä½ˆçš„ä¸€å¥—è‡ªå‹•åŒ–æµç¨‹ï¼Œæˆ‘ç‰¹æ„åœ¨IDCä¼ºæœå™¨ä¸Šéƒ¨ç½²äº†<code>Gitlab+Gerrit+Jenkins</code>å°æ¥ç’°å¢ƒï¼Œ</p><p><img src="https://i.imgur.com/Lsz18A6.png" width="600" /></p><ol type="1"><li><code>Gitlab</code>ä¸Šé€²è¡Œç¨‹å¼ç¢¼è¨—ç®¡ åœ¨gitlabä¸Šå»ºç«‹çš„å°ˆæ¡ˆè¨­å®šæˆPrivateï¼Œä¸€èˆ¬ä½¿ç”¨è€…å°é€™å€‹å°ˆæ¡ˆå°±åªæœ‰pullæ¬Šé™ï¼Œä¸èƒ½ç›´æ¥é€²è¡Œpushï¼ŒGitè‡ªå¸¶code reviewåŠŸèƒ½ã€‚<ul><li>å¼·åˆ¶Review ï¼šåœ¨Gitlab ä¸Šå»ºç«‹çš„é …ç›®ï¼ŒæŒ‡å®šç›¸é—œä½¿ç”¨è€…åªæœ‰Reporteræ¬Šé™ï¼Œé€™æ¨£ä½¿ç”¨è€…æ²’æœ‰æ¬Šé™ä½¿ç”¨git pushåŠŸèƒ½ï¼Œåªèƒ½git reviewåˆ°Gerrit ç³»çµ±ä¸Šï¼ŒJenkinsåœ¨ç›£è½Gerritä¸Šçš„é …ç›®äº‹ä»¶æœƒè§¸ç™¼å»ºç½®ä»»å‹™ä¾†æ¸¬è©¦ç¨‹å¼ç¢¼ï¼Œ Jenkins æŠŠæ¸¬è©¦çµæœé€éssh gerrit çµ¦é€™å€‹å°ˆæ¡ˆæ‰“ä¸ŠVerified ï¼ˆè³‡è¨Šæ ¡é©—ï¼‰æˆåŠŸæˆ–å¤±æ•—æ¨™è¨˜ï¼ŒæˆåŠŸé€šçŸ¥å…¶å®ƒäººå“¡Reviewï¼ˆç¨‹å¼ç¢¼å¯©æ ¸ï¼‰ ã€‚</li><li>Gitlabä¿è­·Master åˆ†æ”¯ï¼šåœ¨Gitlab ä¸Šå‰µå»ºçš„å°ˆæ¡ˆå¯ä»¥æŠŠMaster åˆ†æ”¯ä¿è­·èµ·ä¾†ï¼Œæ™®é€šç”¨æˆ¶å¯ä»¥è‡ªå·±å‰µå»ºåˆ†æ”¯ä¸¦æäº¤ä»£ç¢¼åˆ°è‡ªå·±çš„åˆ†æ”¯ä¸Šï¼Œæ²’æœ‰æ¬Šé™ç›´æ¥æäº¤åˆ°Masteråˆ†æ”¯ï¼Œç”¨æˆ¶æœ€å¾Œæäº¤ç”³è«‹æŠŠè‡ªå·±çš„åˆ†æ”¯Mergeåˆ°Master ï¼Œç®¡ç†å“¡æ”¶åˆ°Merge è«‹æ±‚å¾Œï¼Œ Review å¾Œé¸æ“‡æ˜¯å¦åˆä½µã€‚</li><li>å¯ä»¥å°‡gitlabå’Œgerritéƒ¨ç½²åœ¨å…©å°æ©Ÿå™¨ä¸Šï¼Œé€™æ¨£gitlabæ—¢å¯ä»¥è¨—ç®¡gerritç¨‹å¼ç¢¼ï¼Œä¹Ÿå¯ä»¥ä½œç‚ºgerritçš„å‚™ä»½ã€‚</li><li>å› ç‚ºgitlabå’Œgerritåšäº†åŒæ­¥ï¼Œgerritä¸Šçš„ç¨‹å¼ç¢¼æœƒåŒæ­¥åˆ°gitlabã€‚é€™æ¨£å³ä½¿gerritéƒ¨ç½²æ©Ÿæ•…éšœï¼Œå®ƒè£¡é¢çš„ç¨‹å¼ç¢¼ä¹Ÿä¸æœƒéºå¤±ï¼Œå¯ä»¥å»gitlabä¸Šæ‹¿ã€‚</li></ul></li><li><code>Gerrit</code>å¯©æ ¸ä»£ç¢¼<ul><li>Gerritæ˜¯ä¸€æ¬¾è¢«Androidé–‹æºå°ˆæ¡ˆå»£æ³›æ¡ç”¨çš„code review(ç¨‹å¼ç¢¼å¯©æ ¸)ç³»çµ±ã€‚æ™®é€šç”¨æˆ¶å°‡gitlabè£¡çš„å°ˆæ¡ˆcloneåˆ°æœ¬åœ°ï¼Œä¿®æ”¹ç¨‹å¼ç¢¼å¾Œï¼Œé›–ä¸èƒ½ç›´æ¥pushåˆ°ç¨‹å¼ç¢¼ä¸­å¿ƒ ï¼Œä½†æ˜¯å¯ä»¥é€égit reviewæäº¤åˆ°gerritä¸Šé€²è¡Œå¯©æ ¸ã€‚ gerritç›¸é—œå¯©æ ¸å“¡çœ‹åˆ°reviewè³‡è¨Šå¾Œï¼Œåˆ¤æ–·æ˜¯å¦é€šéï¼Œé€éå³commitæäº¤ã€‚ç„¶å¾Œï¼Œgerritç¨‹å¼ç¢¼æœƒå’Œgitlabå®ŒæˆåŒæ­¥ã€‚</li><li>grritçš„ç²¾é«“åœ¨æ–¼ä¸å…è¨±ç›´æ¥å°‡æœ¬åœ°ä¿®æ”¹åŒæ­¥åˆ°é ç«¯å€‰åº«ã€‚å®¢æˆ¶æ©Ÿå¿…é ˆå…ˆpushåˆ°é ç«¯å€‰åº«çš„refs/for/*åˆ†æ”¯ä¸Šï¼Œç­‰å¾…å¯©æ ¸ã€‚</li><li>gerritä¸Šä¹Ÿå¯ä»¥æ¯”è¼ƒç¨‹å¼ç¢¼å¯©æ ¸æäº¤å‰å¾Œçš„å…§å®¹ç‹€æ…‹ã€‚</li></ul></li><li><code>jenkins</code>ä»£ç¢¼ç™¼å¸ƒ<ul><li>ç•¶ä½¿ç”¨è€…git reviewå¾Œï¼Œç¨‹å¼ç¢¼é€éjenkinsè‡ªå‹•æ¸¬è©¦ï¼ˆverifiedï¼‰ã€äººå·¥review å¾Œï¼Œç¨‹å¼ç¢¼åªæ˜¯mergeåˆ°äº†Gerritçš„å°ˆæ¡ˆä¸­ï¼Œä¸¦æ²’æœ‰mergeåˆ°Gitlabçš„å°ˆæ¡ˆä¸­ï¼Œæ‰€ä»¥éœ€è¦ç•¶Gerrit å°ˆæ¡ˆå€‰åº«æœ‰è®Šæ›´æ™‚è‡ªå‹•åŒæ­¥åˆ°Gitlabçš„é …ç›®å€‰åº«ä¸­ã€‚ Gerrit è‡ªå‚™ä¸€å€‹ Replication åŠŸèƒ½ï¼ŒåŒæ™‚æˆ‘å€‘åœ¨å®‰è£ Gerrit æ™‚å€™é è¨­å®‰è£äº†é€™å€‹ Pluginï¼Œé€éæ–°å¢replication.config çµ¦ Gerrit</li></ul></li></ol><h1 id="references">References</h1><ol type="1"><li><a href="https://mp.weixin.qq.com/s/YhTDnBKXC1ENbu8i6-1pJw">æ—¥å¸¸å¼€å‘åœºæ™¯Gitä½¿ç”¨æŠ€å·§è®°å½•</a></li><li><a href="https://mp.weixin.qq.com/s?__biz=MzkxNTM4ODc4Ng==&amp;mid=2247485667&amp;idx=1&amp;sn=898316a92cbc30b0aa216d1d464d8949&amp;chksm=c15ea8fef62921e8ea69a5fbeceedea1ed43fa87a79b8f2cd2860c475617fe05d8ca99d50804&amp;cur_album_id=3026951976829517826&amp;scene=189#wechat_redirect">Git commitæäº¤ä¿¡æ¯è§„èŒƒ</a></li><li><a href="https://awdr74100.github.io/2020-05-06-git-stash/">Git ç‰ˆæœ¬æ§åˆ¶ç³»çµ± - stash æš«å­˜ä¿®æ”¹å…§å®¹</a></li><li><a href="https://www.maxlist.xyz/2020/05/02/git-merge-rebase/">ã€Gitæ•™å­¸ã€‘åˆ†æ”¯åˆä½µ: merge èˆ‡ rebase å·®ç•°</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>Git</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Github</tag>
      
      <tag>git</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>WRF | WRF/WPS Geographical Static Data</title>
    <link href="/2023/04/27/WRF_geographical_static_Data/"/>
    <url>/2023/04/27/WRF_geographical_static_Data/</url>
    
    <content type="html"><![CDATA[<h1 id="wrf-geographical-static-data">WRF geographical static Data</h1><ul><li><a href="https://www2.mmm.ucar.edu/wrf/users/download/get_sources_wps_geog.html">WPS V4 Geographical Static Data Downloads Page</a></li></ul><p>These are all the mandatory fields required to run WPS and WRF.</p><p>All are under:</p><ul><li><a href="https://www2.mmm.ucar.edu/wrf/src/wps_files/" class="uri">https://www2.mmm.ucar.edu/wrf/src/wps_files/</a></li></ul><p>Download links:</p><ul><li><a href="http://www2.mmm.ucar.edu/wrf/src/wps_files/geog_complete.tar.bz2" class="uri">http://www2.mmm.ucar.edu/wrf/src/wps_files/geog_complete.tar.bz2</a><ul><li>This is a large compressed file (â‰ˆ 2.3 GB)</li><li>This file will expand to about 50GB in size.</li><li>bunzip2 geog complete.tar.bz2</li><li>tar -xf geog complete.tar</li></ul></li><li><a href="https://www2.mmm.ucar.edu/wrf/users/download/get_sources_wps_geog.html" class="uri">https://www2.mmm.ucar.edu/wrf/users/download/get_sources_wps_geog.html</a><ul><li>Highest Resolution of each Mandatory Field (*Note: ~29G Uncompressed (2.6G Compressed))</li><li>WPS Geographical Input Data Mandatory for Specific Applications</li><li>Optional WPS Geographical Input Data</li></ul></li></ul><p>For the WPS geographical input data download sets that correspond to <strong>Version 3</strong> of the WPS/WRF code.</p><ul><li><a href="https://www2.mmm.ucar.edu/wrf/users/download/get_sources_wps_geog_V3.html" class="uri">https://www2.mmm.ucar.edu/wrf/users/download/get_sources_wps_geog_V3.html</a></li></ul><h2 id="landuse">Landuse</h2><p><a href="https://forum.mmm.ucar.edu/threads/references-for-geogrid-static-data.168/">References for geogrid static data</a></p><p>The Noah LSM page identifies the sources of data that they use. We believe, with high probability, that we are using the same. The topography data is definitely the USGS GTOPO30, the soil category data is probably the hybrid STATSGO/FAO, and the land-cover data is probably the USGS GLCC v2 land-use/land-cover data. For future reference, here is a link to the Noah page: <a href="http://www.ral.ucar.edu/research/land/technology/lsm.php">Land Atmosphere Interactions | Research Applications Laboratory</a></p><p>The 30-arc-second MODIS land use datasets (both with and without lakes) are probably derived from the "Modified IGBP MODIS" data in the Noah link.</p><p>To the best of our knowledge, all of the land cover data in the 'landuse_*' directories are the USGS GLCC data from 1992-1993. The coarser resolutions are derived from the 30-arc-second data.</p><p>The data in the 'modis_landuse_20class_15s' directory is based on:</p><ul><li><ol type="1"><li>Broxton, P. D., Zeng, X., Sulla-Menashe, D., &amp; Troch, P. A. (2014). A</li></ol></li></ul><p>global land cover climatology using MODIS data. Journal of Applied Meteorology and Climatology, 53(6), 1593-1605. DOI: 10.1175/JAMC-D-13-0270.1 and</p><ul><li><ol start="2" type="1"><li>ftp://ftp.emc.ncep.noaa.gov/mmb/gcp/ldas/noahlsm/README</li></ol></li></ul><p>The data in the 'modis_landuse_20class_30s' directory were provided by NCEP and include the addition of a tundra class; these data were most likely collected in 2001.</p><p>The data in the 'modis_landuse_20class_30s_with_lakes' directory are the same as in the 'modis_landuse_20class_30s' directory, but have an inland water body category that was added by NCAR.</p><p>The data in the 'modis_landuse_21class_30s' data were modified by Boston University, most likely based on data collected in 2004.</p><h3 id="in-summary">In summary:</h3><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">landuse_30s</span> - USGS GLCC, <span class="hljs-number">1992</span>-<span class="hljs-number">1993</span><br><span class="hljs-attribute">landuse_30s_with_lakes</span> - USGS GLCC, <span class="hljs-number">1992</span>-<span class="hljs-number">1993</span>, lakes added by NCAR<br><span class="hljs-attribute">landuse_2m</span> - USGS GLCC, <span class="hljs-number">1992</span>-<span class="hljs-number">1993</span>, coarsened from <span class="hljs-number">30</span>s<br><span class="hljs-attribute">landuse_5m</span> - USGS GLCC, <span class="hljs-number">1992</span>-<span class="hljs-number">1993</span>, coarsened from <span class="hljs-number">30</span>s<br><span class="hljs-attribute">landuse_10m</span> - USGS GLCC, <span class="hljs-number">1992</span>-<span class="hljs-number">1993</span>, coarsened from <span class="hljs-number">30</span>s<br><br><span class="hljs-attribute">modis_landuse_20class_15s</span> - MODIS, See reference<br><span class="hljs-attribute">modis_landuse_20class_30s</span> - MODIS, NCEP included tundra class, <span class="hljs-number">2001</span><br><span class="hljs-attribute">modis_landuse_20class_30s_with_lakes</span> - MODIS, NCEP included tundra class, <span class="hljs-number">2001</span>, lakes added by NCAR<br><span class="hljs-attribute">modis_landuse_21class_30s</span> - MODIS, modified by BU, <span class="hljs-number">2004</span><br></code></pre></td></tr></table></figure><h1 id="interpolation-options-for-different-resolution">Interpolation options for different resolution</h1><ol type="1"><li>Is there an algorithm in geogrid/src that compares the original binary data resolution to the model resolution to apply the interpolation option differently?</li></ol><ul><li>No, I don't think so. The interpolation option is always dependent on that specified in GEOGRID.TBL</li></ul><ol start="2" type="1"><li>If not, is there an algorithm that applies appropriate interpolation options when receiving categorical or continuous variables?</li></ol><ul><li>For both categorical and continuous variables, the interpolation is conducted based on the option given in GEOGRID.TBL.</li></ul><h1 id="references">References</h1><ol type="1"><li><a href="https://www2.mmm.ucar.edu/wrf/users/tutorial/presentation_pdfs/202101/duda_wps_advanced.pdf">Advanced Usage of the WRF Preprocessing System</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>WRF</category>
      
    </categories>
    
    
    <tags>
      
      <tag>WRF</tag>
      
      <tag>WPS</tag>
      
      <tag>geodata</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Git rebase -i </title>
    <link href="/2023/04/26/Git-rebase-i/"/>
    <url>/2023/04/26/Git-rebase-i/</url>
    
    <content type="html"><![CDATA[<h1 id="use-rebase--i-to-merge-commits">Use rebase -i to merge commits</h1><blockquote><p>Ref: https://backlog.com/git-tutorial/tw/stepup/stepup7_5.html</p></blockquote><p>To merge past commits, use the rebase -i command</p><blockquote><p>$ git rebase -i HEAD~~</p></blockquote><p>The default text editor will open automatically, and you will see commits from HEAD to HEAD~~</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs sh">pick 9a54fd4 add commit instructions<br>pick 0d4a808 Add instructions <span class="hljs-keyword">for</span> pull<br><br><span class="hljs-comment"># Rebase 326fc9f..0d4a808 onto d286baa</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Commands:</span><br><span class="hljs-comment">#  p, pick = use commit</span><br><span class="hljs-comment">#  r, reword = use commit, but edit the commit message</span><br><span class="hljs-comment">#  e, edit = use commit, but stop for amending</span><br><span class="hljs-comment">#  s, squash = use commit, but meld into previous commit</span><br><span class="hljs-comment">#  f, fixup = like &quot;squash&quot;, but discard this commit&#x27;s log message</span><br><span class="hljs-comment">#  x, exec = run command (the rest of the line) using shell</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># If you remove a line here THAT COMMIT WILL BE LOST.</span><br><span class="hljs-comment"># However, if you remove everything, the rebase will be aborted.</span><br><span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure><p>Change the "pick" in the <strong>second line to "squash", save and exit</strong>. Since you need to submit after merging, the editor will remind you to edit the latest submission message, please save and exit after editing the message. In this way, the two commits are merged into one commit. Please check the history with the log command.</p><h1 id="amend-commits-with-rebase--i">Amend commits with rebase -i</h1><blockquote><p>Ref: https://backlog.com/git-tutorial/tw/stepup/stepup7_6.html</p></blockquote><p>Use the rebase -i command to select the commits to amend</p><blockquote><p>$ git rebase -i HEAD~~</p><p>The default text editor will open commits from HEAD to HEAD~~</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs sh">pick 9a54fd4 add commit instructions<br>pick 0d4a808 Add instructions <span class="hljs-keyword">for</span> pull<br><br><span class="hljs-comment"># Rebase 326fc9f..0d4a808 onto d286baa</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Commands:</span><br><span class="hljs-comment">#  p, pick = use commit</span><br><span class="hljs-comment">#  r, reword = use commit, but edit the commit message</span><br><span class="hljs-comment">#  e, edit = use commit, but stop for amending</span><br><span class="hljs-comment">#  s, squash = use commit, but meld into previous commit</span><br><span class="hljs-comment">#  f, fixup = like &quot;squash&quot;, but discard this commit&#x27;s log message</span><br><span class="hljs-comment">#  x, exec = run command (the rest of the line) using shell</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># If you remove a line here THAT COMMIT WILL BE LOST.</span><br><span class="hljs-comment"># However, if you remove everything, the rebase will be aborted.</span><br><span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure><p><strong>Change the text of "pick" in the first line to "edit"</strong>, save and exit. Then, the following content will be displayed, and the commit to be modified will be checked out.</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh">Stopped at d286baa... add commit<br>You can amend the commit now, with<br><br>        git commit --amend<br><br>Once you are satisfied with your changes, run<br><br>        git rebase --<span class="hljs-built_in">continue</span><br></code></pre></td></tr></table></figure><p>open sample.txt ï¼Œmake changes.</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ git add sample.txt<br>$ git commit --amend<br></code></pre></td></tr></table></figure><p>You now need to execute "git rebase --continue" to complete the rebase.</p><blockquote><p>$ git rebase --continue</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>Git</category>
      
    </categories>
    
    
    <tags>
      
      <tag>git rebase</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>GNU GCC</title>
    <link href="/2023/04/25/GNU/"/>
    <url>/2023/04/25/GNU/</url>
    
    <content type="html"><![CDATA[<p>GNU<sup id="fnref:1" class="footnote-ref"><a href="#fn:1" rel="footnote"><span class="hint--top hint--rounded" data-aria-label="[GNU](https://www.gnu.org/)">[1]</span></a></sup> <sup id="fnref:2" class="footnote-ref"><a href="#fn:2" rel="footnote"><span class="hint--top hint--rounded" data-aria-label="[List of GNU packages](https://en.wikipedia.org/wiki/List_of_GNU_packages)">[2]</span></a></sup> is an operating system that is free softwareâ€”that is, it respects users' freedom. The GNU operating system consists of GNU packages (programs specifically released by the GNU Project) as well as free software released by third parties. The development of GNU made it possible to use a computer without software that would trample your freedom.</p><h2 id="gnu-compiler-collection-gcc">GNU Compiler Collection (GCC)</h2><p>As of May 2021, the recent 11.1 release of GCC includes front ends for C (gcc), C++ (g++), Objective-C, Fortran (gfortran), Ada (GNAT), Go (gccgo) and D (gdc, since 9.1) programming languages, with the OpenMP and OpenACC parallel language extensions being supported since GCC 5.1. Versions prior to GCC 7 also supported Java (gcj), allowing compilation of Java to native machine code. Modula-2 support, previously offered by third parties, will be merged into GCC 13. Regarding language version support for C++ and C, since GCC 11.1 the default target is gnu++17, a superset of C++17, and gnu11, a superset of C11, with strict standard support also available. GCC also provides experimental support for C++20 and upcoming C++23. <sup id="fnref:3" class="footnote-ref"><a href="#fn:3" rel="footnote"><span class="hint--top hint--rounded" data-aria-label="[GCC GNU Compiler Collection](https://en.wikipedia.org/wiki/GNU_Compiler_Collection)">[3]</span></a></sup></p><h2 id="installation">Installation</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/bash</span><br><span class="hljs-comment">############################## Directory Listing ############################</span><br><span class="hljs-built_in">export</span> HOME=`<span class="hljs-built_in">pwd</span>`<br><span class="hljs-built_in">export</span> download_DIR=<span class="hljs-variable">$HOME</span>/download_DIR/<br><span class="hljs-built_in">export</span> libs_DIR=<span class="hljs-variable">$HOME</span>/Library/<br><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$HOME</span><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$download_DIR</span><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$libs_DIR</span><br><br><span class="hljs-built_in">mkdir</span> -p download_DIR<br><span class="hljs-built_in">mkdir</span> -p Library<br><br><span class="hljs-comment">############################## GCC ############################</span><br><span class="hljs-built_in">cd</span> <span class="hljs-variable">$download_DIR</span><br><br>gcc_version=<span class="hljs-string">&quot;12.2.0&quot;</span> <span class="hljs-comment"># 4.8.5/8.3.0/9.3.0/10.3.0/12.2.0</span><br><br>wget -c --no-check-certificate https://ftp.gnu.org/gnu/gcc/gcc-<span class="hljs-variable">$&#123;gcc_version&#125;</span>/gcc-<span class="hljs-variable">$&#123;gcc_version&#125;</span>.tar.gz<br>tar -xvf gcc-<span class="hljs-variable">$&#123;gcc_version&#125;</span>.tar.gz<br><span class="hljs-built_in">cd</span> gcc-<span class="hljs-variable">$&#123;gcc_version&#125;</span><br><br>./contrib/download_prerequisites<br>./configure --prefix=<span class="hljs-variable">$libs_DIR</span>/gcc-v<span class="hljs-variable">$&#123;gcc_version&#125;</span> --enable-languages=c,c++,fortran --disable-multilib<br><br>make<br>make -j &amp;&amp; make install<br>gcc --version<br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;===================&quot;</span><br><span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$PATH</span>:/<span class="hljs-variable">$libs_DIR</span>/gcc-v<span class="hljs-variable">$&#123;gcc_version&#125;</span>/bin<br>gcc --version<br><br></code></pre></td></tr></table></figure><h2 id="bug-and-error">Bug and Error</h2><blockquote><p>Bug: configure: error: Building GCC requires GMP 4.2+, MPFR 3.1.0+ and MPC 0.8.0+.??? <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># Inside the gcc directory, do this command:</span><br>./contrib/download_prerequisites<br><span class="hljs-comment"># After that script, GMP, MPFR, and MPC will be ready to use. Continue with ./configure.</span><br></code></pre></td></tr></table></figure></p></blockquote><section class="footnotes"><div class="footnote-list"><ol><li><span id="fn:1" class="footnote-text"><span><a href="https://www.gnu.org/">GNU</a> <a href="#fnref:1" rev="footnote" class="footnote-backref"> â†©</a></span></span></li><li><span id="fn:2" class="footnote-text"><span><a href="https://en.wikipedia.org/wiki/List_of_GNU_packages">List of GNU packages</a> <a href="#fnref:2" rev="footnote" class="footnote-backref"> â†©</a></span></span></li><li><span id="fn:3" class="footnote-text"><span><a href="https://en.wikipedia.org/wiki/GNU_Compiler_Collection">GCC GNU Compiler Collection</a> <a href="#fnref:3" rev="footnote" class="footnote-backref"> â†©</a></span></span></li></ol></div></section>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>HPC</tag>
      
      <tag>NWP</tag>
      
      <tag>gnu</tag>
      
      <tag>gcc</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>WRF | WRF installation on a Linux-based machine</title>
    <link href="/2023/04/25/WRF_installation_on_a_Linux_based_machine/"/>
    <url>/2023/04/25/WRF_installation_on_a_Linux_based_machine/</url>
    
    <content type="html"><![CDATA[<h1 id="wrf">WRF</h1><ul><li>Version 1.0: WRF was first released December 2000</li><li>Version 2.0: May 2004</li><li>Version 3.0: April 2008</li><li>Version 4.0: June 2018 (add hybrid vertical coordinate)</li><li>Version 4.1: April 2019</li><li>Version 4.2: April 2020</li><li>Version 4.3: May 2021</li><li>Version 4.4: April 2022</li><li>Version 4.5: April 2023<ul><li>4.5.1: July 2023</li><li>4.5.2: December 2023</li></ul></li><li>Version 4.6: May 2024</li></ul><h1 id="wrf-installation-on-a-linux-based-machine">WRF installation on a Linux-based machine</h1><p>Weather Research &amp; Forecasting Model (WRF) is a state of the art mesoscale numerical weather prediction system designed for both atmospheric research and operational forecasting applications <sup id="fnref:1" class="footnote-ref"><a href="#fn:1" rel="footnote"><span class="hint--top hint--rounded" data-aria-label="[WRF](https://www.mmm.ucar.edu/models/wrf)">[1]</span></a></sup>.</p><p>The installation steps are,</p><ol type="1"><li>Source gcc compiler</li><li>Test gcc compiler</li><li>Install all requried libraries</li><li>Test libraries</li><li>Install WRF</li><li>Install WPS</li></ol><p>Three shell scripts are under the same directory,</p><blockquote><p>gcc_env.sh wrf_env.sh wrf_env_install.sh wrf_wps_install.sh</p></blockquote><h2 id="gcc-version-gcc_env.sh">GCC version (gcc_env.sh)</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/bash</span><br><br><span class="hljs-built_in">export</span> gcc_libs_DIR=/home/wpsze/gcc/<br><span class="hljs-built_in">export</span> LD_LIBRARY_PATH=<span class="hljs-variable">$gcc_libs_DIR</span>/lib:<span class="hljs-variable">$LD_LIBRARY_PATH</span><br><span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$gcc_libs_DIR</span>/bin:<span class="hljs-variable">$PATH</span><br><br><span class="hljs-built_in">export</span> gcc_version=<span class="hljs-string">&quot;gcc-v4.8.5&quot;</span> <span class="hljs-comment"># 4.8.5/8.3.0/9.3.0/10.3.0/12.2.0</span><br><br><span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$gcc_libs_DIR</span>/<span class="hljs-variable">$&#123;gcc_version&#125;</span>/bin:<span class="hljs-variable">$PATH</span><br><span class="hljs-built_in">export</span> LD_LIBRARY_PATH=<span class="hljs-variable">$gcc_libs_DIR</span>/<span class="hljs-variable">$&#123;gcc_version&#125;</span>/lib:<span class="hljs-variable">$LD_LIBRARY_PATH</span><br><span class="hljs-built_in">export</span> LD_LIBRARY_PATH=<span class="hljs-variable">$gcc_libs_DIR</span>/<span class="hljs-variable">$&#123;gcc_version&#125;</span>/lib64:<span class="hljs-variable">$LD_LIBRARY_PATH</span><br><br>gcc --version<br>gfortran --version<br></code></pre></td></tr></table></figure><h3 id="testing-system-compatibility">Testing System Compatibility</h3><p>We have to test the compiler system in your computer/clsuter. #### Download test tar files,</p><blockquote><p>http://www2.mmm.ucar.edu/wrf/OnLineTutorial/compile_tutorial/tar_files/Fortran_C_tests.tar</p></blockquote><h4 id="run_gcc_test.sh">run_gcc_test.sh</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/bash</span><br><span class="hljs-built_in">source</span> gcc_env.sh<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;==========================================================================================&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot; All tests are from http://www2.mmm.ucar.edu/wrf/OnLineTutorial/compile_tutorial/tar_files/Fortran_C_tests.tar &quot;</span><br>gfortran --version<br>gcc --version<br>cpp --version<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;==========================================================================================&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=============================== Fortran_C_tests.tar  =====================================&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;==========================================================================================&quot;</span><br><span class="hljs-comment"># Unpack the test files by entering the following input into the terminal:</span><br><span class="hljs-comment"># tar -xf Fortran_C_tests.tar</span><br><br><span class="hljs-comment"># TEST #1: FIXED FORMAT FORTRAN TEST</span><br>gfortran TEST_1_fortran_only_fixed.f<br>./a.out<br><span class="hljs-comment"># SUCCESS test 1 fortran only fixed format</span><br><br><span class="hljs-comment"># TEST #2: FREE FORMAT FORTRAN TEST</span><br>gfortran TEST_2_fortran_only_free.f90<br>./a.out<br><span class="hljs-comment"># Assume Fortran 2003: has FLUSH, ALLOCATABLE, derived type, and ISO C Binding</span><br><span class="hljs-comment"># SUCCESS test 2 fortran only free format</span><br><br><span class="hljs-comment"># TEST #3: C</span><br>gcc TEST_3_c_only.c<br>./a.out<br><span class="hljs-comment"># SUCCESS test 3 c only</span><br><br><span class="hljs-comment"># TEST #4: FORTRAN CALLING A C FUNCTION (GCC AND GFORTRAN HAVE DIFFERENT DEFAULTS, </span><br><span class="hljs-comment"># SO WE FORCE BOTH TO ALWAYS USE 64 BIT (-M64) WHEN COMBINING THEM)</span><br>gcc -c -m64 TEST_4_fortran+c_c.c<br>gfortran -c -m64 TEST_4_fortran+c_f.f90<br>gfortran -m64 TEST_4_fortran+c_f.o TEST_4_fortran+c_c.o<br>./a.out<br><span class="hljs-comment"># C function called by Fortran</span><br><span class="hljs-comment"># Values are xx = 2.00 and ii = 1</span><br><span class="hljs-comment"># SUCCESS test 4 fortran calling c</span><br><br><span class="hljs-comment"># TEST #5: CSH</span><br>./TEST_csh.csh<br><span class="hljs-comment"># SUCCESS csh test</span><br><span class="hljs-comment">#  TEST #6: PERL</span><br>./TEST_perl.pl<br><span class="hljs-comment"># SUCCESS perl test</span><br><span class="hljs-comment">#  TEST #7: SH</span><br>./TEST_sh.sh<br><span class="hljs-comment"># SUCCESS sh test</span><br></code></pre></td></tr></table></figure><h2 id="wrf-v3.8.1-2">WRF v3.8.1 <sup id="fnref:2" class="footnote-ref"><a href="#fn:2" rel="footnote"><span class="hint--top hint--rounded" data-aria-label="[WRFv3.8.1 installation on a Linux machine](https://metclim.ucd.ie/2017/06/wrf-installation-on-a-linux-machine/)">[2]</span></a></sup></h2><p>Using a version of gfortran which is 4.4.0 or newer is recommended.</p><blockquote><p>https://www2.mmm.ucar.edu/wrf/OnLineTutorial/compile_tutorial/tar_files/ netcdf-4.1.3 mpich-3.0.4 zlib-1.2.7 libpng-1.2.50 JasPer-1.900.1</p></blockquote><p>The above libraries are requried for running WRF and download to folder wrf_instsall/.</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">source</span> gcc_env.sh<br><span class="hljs-comment">#export gcc_version=&quot;gcc-v4.8.5&quot; # and change gcc_env.sh !!!!!!</span><br><br><span class="hljs-built_in">export</span> HOME=`<span class="hljs-built_in">pwd</span>`<br><span class="hljs-built_in">export</span> download_DIR=<span class="hljs-variable">$HOME</span>/wrf_install/<br><span class="hljs-built_in">export</span> libs_DIR=<span class="hljs-variable">$HOME</span>/Library/<br><br><span class="hljs-built_in">export</span> LD_LIBRARY_PATH=<span class="hljs-variable">$libs_DIR</span>/lib:<span class="hljs-variable">$LD_LIBRARY_PATH</span><br><span class="hljs-built_in">export</span> LDFLAGS=-L<span class="hljs-variable">$libs_DIR</span>/lib<br><span class="hljs-built_in">export</span> CPPFLAGS=-I<span class="hljs-variable">$libs_DIR</span>/include<br><br>gcc --version<br>gfortran --version<br><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$HOME</span><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$download_DIR</span><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$libs_DIR</span><br><br><span class="hljs-built_in">mkdir</span> -p wrf_install<br><span class="hljs-built_in">mkdir</span> -p Library<br><br><span class="hljs-comment">############################## zlib ############################</span><br><span class="hljs-built_in">cd</span> <span class="hljs-variable">$download_DIR</span><br><span class="hljs-built_in">rm</span> -rf zlib-1.2.7/<br>tar xvf zlib-1.2.7.tar.gz<br><br><span class="hljs-built_in">cd</span> zlib-1.2.7/<br><br>./configure --prefix=<span class="hljs-variable">$libs_DIR</span><br>make<br>make install<br><br><span class="hljs-comment">############################## libpng ############################</span><br><span class="hljs-built_in">cd</span> <span class="hljs-variable">$download_DIR</span><br><span class="hljs-built_in">rm</span> -rf libpng-1.2.50<br>tar xvf libpng-1.2.50.tar.gz<br><br><span class="hljs-built_in">cd</span> libpng-1.2.50/<br><br>./configure --prefix=<span class="hljs-variable">$libs_DIR</span><br>make<br>make install<br><br><span class="hljs-comment">############################## netcdf-C ############################</span><br><span class="hljs-built_in">cd</span> <span class="hljs-variable">$download_DIR</span><br><span class="hljs-built_in">rm</span> -rf netcdf-4.1.3<br>tar xvf netcdf-4.1.3.tar.gz<br><br><span class="hljs-built_in">cd</span> netcdf-4.1.3/<br><br><span class="hljs-built_in">export</span> LD_LIBRARY_PATH=<span class="hljs-variable">$libs_DIR</span>/lib:<span class="hljs-variable">$LD_LIBRARY_PATH</span><br><span class="hljs-built_in">export</span> LDFLAGS=-L<span class="hljs-variable">$libs_DIR</span>/lib<br><span class="hljs-built_in">export</span> CPPFLAGS=-I<span class="hljs-variable">$libs_DIR</span>/include<br><br><span class="hljs-comment"># ./configure --prefix=$libs_DIR</span><br>./configure --prefix=<span class="hljs-variable">$libs_DIR</span> --disable-dap --disable-netcdf-4 --disable-shared<br>make<br>make install<br><br><span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$libs_DIR</span>/bin:<span class="hljs-variable">$PATH</span><br><span class="hljs-built_in">export</span> NETCDF=<span class="hljs-variable">$libs_DIR</span><br><span class="hljs-comment">############################## JasPer ############################</span><br><span class="hljs-built_in">cd</span> <span class="hljs-variable">$download_DIR</span><br><span class="hljs-built_in">rm</span> -rf jasper-1.900.1<br>tar vxf jasper-1.900.1.tar.gz<br><br><span class="hljs-built_in">cd</span> jasper-1.900.1<br><br><span class="hljs-comment">#sed -i &#x27;s|char|const char|g&#x27; src/libjasper/jpg/jpg_dummy.c</span><br><br>./configure --prefix=<span class="hljs-variable">$libs_DIR</span><br><br>make<br>make install<br><span class="hljs-comment">##############################MPICH############################</span><br><span class="hljs-built_in">cd</span> <span class="hljs-variable">$download_DIR</span><br><span class="hljs-built_in">rm</span> mpich-3.0.4<br>tar vxf mpich-3.0.4.tar.gz<br><br><span class="hljs-built_in">cd</span> mpich-3.0.4/<br>./configure --prefix=<span class="hljs-variable">$libs_DIR</span> <span class="hljs-comment">#--with-device=ch3</span><br><br>make<br>make install<br><br><span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$libs_DIR</span>/bin:<span class="hljs-variable">$PATH</span><br></code></pre></td></tr></table></figure><p>and, combine all required libaries in wrf_env.sh</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/bash</span><br><span class="hljs-built_in">source</span> gcc_env.sh<br><span class="hljs-built_in">export</span> HOME=`<span class="hljs-built_in">pwd</span>`<br><span class="hljs-built_in">export</span> libs_DIR=<span class="hljs-variable">$HOME</span>/Library/<br><span class="hljs-built_in">export</span> LD_LIBRARY_PATH=<span class="hljs-variable">$libs_DIR</span>/lib:<span class="hljs-variable">$LD_LIBRARY_PATH</span><br><span class="hljs-built_in">export</span> LDFLAGS=-L<span class="hljs-variable">$libs_DIR</span>/lib<br><span class="hljs-built_in">export</span> CPPFLAGS=-I<span class="hljs-variable">$libs_DIR</span>/include<br><span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$libs_DIR</span>/bin:<span class="hljs-variable">$PATH</span><br><span class="hljs-built_in">export</span> NETCDF=<span class="hljs-variable">$libs_DIR</span><br></code></pre></td></tr></table></figure><h3 id="library-compatibility-tests">Library Compatibility Tests</h3><p>We have to test the Library in your computer/clsuter. #### Download test tar files,</p><blockquote><p>http://www2.mmm.ucar.edu/wrf/OnLineTutorial/compile_tutorial/tar_files/Fortran_C_NETCDF_MPI_tests.tar</p></blockquote><h4 id="run_library_test.sh">run_library_test.sh</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/bash</span><br><span class="hljs-built_in">source</span> wrf_env.sh<br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=================================================================&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=================== Fortran_C_NETCDF_MPI_tests.tar ==============&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=================================================================&quot;</span><br><br><span class="hljs-comment"># To unpack the tar file, type:</span><br><span class="hljs-comment"># wget -c https://www2.mmm.ucar.edu/wrf/OnLineTutorial/compile_tutorial/tar_files/Fortran_C_NETCDF_MPI_tests.tar</span><br><span class="hljs-comment"># tar -xf Fortran_C_NETCDF_MPI_tests.tar</span><br><br><span class="hljs-comment"># Test #1: Fortran + C + NetCDF</span><br><br><span class="hljs-comment"># The NetCDF-only test requires the include file from the NETCDF package be in this directory. Copy the file here:</span><br><span class="hljs-built_in">cp</span> <span class="hljs-variable">$&#123;NETCDF&#125;</span>/include/netcdf.inc .<br><br><span class="hljs-comment"># Compile the Fortran and C codes for the purpose of this test </span><br><span class="hljs-comment"># (the -c option says to not try to build an executable). Type the following commands:</span><br>gfortran -c 01_fortran+c+netcdf_f.f<br>gcc -c 01_fortran+c+netcdf_c.c<br>gfortran 01_fortran+c+netcdf_f.o 01_fortran+c+netcdf_c.o \<br>     -L<span class="hljs-variable">$&#123;NETCDF&#125;</span>/lib -lnetcdff -lnetcdf<br>./a.out<br><br><span class="hljs-comment"># The following should be displayed on your screen:</span><br><span class="hljs-comment"># C function called by Fortran</span><br><span class="hljs-comment"># Values are xx = 2.00 and ii = 1</span><br><span class="hljs-comment"># SUCCESS test 1 fortran + c + netcdf</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=================================================================&quot;</span><br><span class="hljs-comment"># Test #2: Fortran + C + NetCDF + MPI</span><br><br><span class="hljs-comment"># The NetCDF+MPI test requires include files from both of these packages be in this directory, </span><br><span class="hljs-comment"># but the MPI scripts automatically make the mpif.h file available without assistance, </span><br><span class="hljs-comment"># so no need to copy that one. Copy the NetCDF include file here:</span><br><span class="hljs-built_in">cp</span> <span class="hljs-variable">$&#123;NETCDF&#125;</span>/include/netcdf.inc .<br><br><span class="hljs-comment"># Note that the MPI executables mpif90 and mpicc are used below when compiling. Issue the following commands:</span><br>mpif90 -c 02_fortran+c+netcdf+mpi_f.f<br>mpicc -c 02_fortran+c+netcdf+mpi_c.c<br>mpif90 02_fortran+c+netcdf+mpi_f.o \<br>02_fortran+c+netcdf+mpi_c.o \<br>     -L<span class="hljs-variable">$&#123;NETCDF&#125;</span>/lib -lnetcdff -lnetcdf<br>mpirun ./a.out<br><br><span class="hljs-comment"># The following should be displayed on your screen:</span><br><span class="hljs-comment"># C function called by Fortran</span><br><span class="hljs-comment"># Values are xx = 2.00 and ii = 1</span><br><span class="hljs-comment"># status = 2</span><br><span class="hljs-comment"># SUCCESS test 2 fortran + c + netcdf + mpi</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=================================================================&quot;</span><br></code></pre></td></tr></table></figure><h3 id="install-wrfv3.8.1">Install WRFv3.8.1</h3><h4 id="download">Download</h4><blockquote><p>http://www2.mmm.ucar.edu/wrf/src/WRFV3.8.1.TAR.gz</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/bash</span><br><span class="hljs-comment"># WRF will not compile using GCC version 6 or higher. </span><br><span class="hljs-comment"># It will only work with version 4.8.5. </span><br><span class="hljs-comment"># The GCC6 module loads automatically when you log in.</span><br><span class="hljs-comment"># If you unload it, the system will default to GCC 4.8.5.</span><br><br><span class="hljs-built_in">source</span> wrf_env.sh<br><span class="hljs-built_in">export</span> HOME=`<span class="hljs-built_in">pwd</span>` <br><span class="hljs-built_in">export</span> libs_DIR=/home/wpsze/WRFv381/Library/ <span class="hljs-comment"># HOME = /home/wpsze/WRFv381/</span><br><span class="hljs-built_in">export</span> download_DIR=<span class="hljs-variable">$HOME</span>/wrf_install/<br><br><span class="hljs-comment"># gunzip WRFV3.8.1.TAR.gz</span><br><span class="hljs-comment"># tar -xf WRFV3.8.1.TAR</span><br><br><span class="hljs-built_in">cd</span> <span class="hljs-variable">$download_DIR</span><br><br><span class="hljs-built_in">cd</span> WRFV3/<br><br><span class="hljs-built_in">export</span> WRF_DIR=<span class="hljs-string">&quot;WRFV3&quot;</span><br><br><span class="hljs-comment">#./clean -a ## running or not</span><br><br>./configure <br><span class="hljs-comment">##  34 (dmpar) GNU [gfortran/gcc]</span><br><br>./compile -j 4 em_real 2&gt;&amp;1 | <span class="hljs-built_in">tee</span> compile.log<br><span class="hljs-comment">#./compile em_real 2&gt;&amp;1 | tee compile.log</span><br><br><span class="hljs-comment"># # #It should fail on the first time (namely main/real.exe is not created)</span><br><span class="hljs-comment"># # #with the following error:</span><br><span class="hljs-comment"># # #+++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><br><span class="hljs-comment"># # #real_em.f90:32.7:</span><br><br><span class="hljs-comment"># # #   USE module_initialize_real, ONLY : wrfu_initialize, find_my_parent, find_my_</span><br><span class="hljs-comment"># # 1</span><br><span class="hljs-comment"># # #Fatal Error: Can&#x27;t open module file &#x27;module_initialize_real.mod&#x27; for reading at (1): No such file or</span><br><span class="hljs-comment"># # #directory</span><br><span class="hljs-comment"># # #nup_em.f90:90.7:</span><br><br><span class="hljs-comment"># # #   USE module_initialize_real, only : wrfu_initialize</span><br><span class="hljs-comment"># # #       1</span><br><span class="hljs-comment"># # #Fatal Error: Can&#x27;t open module file &#x27;module_initialize_real.mod&#x27; for reading at (1): No such file or</span><br><span class="hljs-comment"># # #directory</span><br><span class="hljs-comment"># # #+++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><br><br><span class="hljs-comment"># # #Then it should end successfully when running the</span><br><span class="hljs-comment"># # #command a second time (do not understand why but it works...)</span><br><br><span class="hljs-comment"># # # ---&gt;                  Executables successfully built                  &lt;---</span><br></code></pre></td></tr></table></figure><p>This should return the following four files:</p><blockquote><p>wrf.exe real.exe ndown.exe tc.exe</p></blockquote><h3 id="install-wpsv3.8.1">Install WPSv3.8.1</h3><h4 id="download-1">Download</h4><blockquote><p>http://www2.mmm.ucar.edu/wrf/src/WPSV3.8.1.TAR.gz</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/bash</span><br><span class="hljs-built_in">source</span> wrf_env.sh<br><span class="hljs-built_in">export</span> HOME=`<span class="hljs-built_in">pwd</span>` <br><span class="hljs-built_in">export</span> libs_DIR=/home/wpsze/WRFv381/Library/ <span class="hljs-comment"># HOME = /home/wpsze/WRFv381/</span><br><span class="hljs-built_in">export</span> download_DIR=<span class="hljs-variable">$HOME</span>/wrf_install/<br><br><span class="hljs-built_in">cd</span> <span class="hljs-variable">$download_DIR</span><br><span class="hljs-comment">#tar xvf xxxx.tar.gz</span><br><span class="hljs-built_in">cd</span> WPS/<br><span class="hljs-built_in">export</span> WRF_DIR=../WRFV3/<br><span class="hljs-built_in">export</span> JASPERLIB=<span class="hljs-variable">$libs_DIR</span>/lib/<br><span class="hljs-built_in">export</span> JASPERINC=<span class="hljs-variable">$libs_DIR</span>/include/<br><br><span class="hljs-comment">#then option 1 Linux x86_64, gfortran    (serial)</span><br><br><span class="hljs-comment"># ./clean -a</span><br><br>./configure<br><br><span class="hljs-comment"># 1 (dmpar) gfortran</span><br><br>./compile 2&gt;&amp;1 | <span class="hljs-built_in">tee</span> compile.log<br></code></pre></td></tr></table></figure><p>This should return the three executable files needed to run WPS.</p><blockquote><p>geogrid.exe metgrid.exe ungrib.exe</p></blockquote><h2 id="wrf-v4.4.0">WRF v4.4.0</h2><section class="footnotes"><div class="footnote-list"><ol><li><span id="fn:1" class="footnote-text"><span><a href="https://www.mmm.ucar.edu/models/wrf">WRF</a> <a href="#fnref:1" rev="footnote" class="footnote-backref"> â†©</a></span></span></li><li><span id="fn:2" class="footnote-text"><span><a href="https://metclim.ucd.ie/2017/06/wrf-installation-on-a-linux-machine/">WRFv3.8.1 installation on a Linux machine</a> <a href="#fnref:2" rev="footnote" class="footnote-backref"> â†©</a></span></span></li></ol></div></section>]]></content>
    
    
    <categories>
      
      <category>WRF</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NWP</tag>
      
      <tag>gnu</tag>
      
      <tag>gcc</tag>
      
      <tag>WRF</tag>
      
      <tag>WPS</tag>
      
      <tag>Installation</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Slurm</title>
    <link href="/2023/04/24/Slurm/"/>
    <url>/2023/04/24/Slurm/</url>
    
    <content type="html"><![CDATA[<p>SLURM (Simple Linux Utility for Resource Management) <sup id="fnref:1" class="footnote-ref"><a href="#fn:1" rel="footnote"><span class="hint--top hint--rounded" data-aria-label="[Slurm](https://slurm.schedmd.com/documentation.html)">[1]</span></a></sup> <sup id="fnref:5" class="footnote-ref"><a href="#fn:5" rel="footnote"><span class="hint--top hint--rounded" data-aria-label="[Slurmä¸­è‹±æ–‡å°ç…§æ–‡æª”](https://docs.slurm.cn/master/man-pages-shou-ce)">[5]</span></a></sup> is a powerful and flexible workload manager, designed for distributed computing environments. It is an open-source, highly-scalable system that provides advanced job scheduling, efficient job submission, and comprehensive system monitoring capabilities. SLURM allows users to manage computing resources efficiently, enabling more efficient and cost-effective research and data analysis. Overall, SLURM provides a highly efficient and flexible resource management solution for distributed computing environments. Its features make it an excellent choice for researchers and scientists looking to optimize their computing resources, streamline their workflows, and enhance their productivity.</p><p>Usual commands:</p><table><thead><tr class="header"><th style="text-align: left;">Purpose</th><th style="text-align: left;">Command</th></tr></thead><tbody><tr class="odd"><td style="text-align: left;">To check what queues (partitions) are available</td><td style="text-align: left;">sinfo</td></tr><tr class="even"><td style="text-align: left;">To submit job</td><td style="text-align: left;">sbatch <your_job_script></td></tr><tr class="odd"><td style="text-align: left;">To view the queue status</td><td style="text-align: left;">squeue</td></tr><tr class="even"><td style="text-align: left;">To view the queue status of your job</td><td style="text-align: left;">squeue -u $USER</td></tr><tr class="odd"><td style="text-align: left;">To cancel a running or pending job</td><td style="text-align: left;">scancel JOBID</td></tr><tr class="even"><td style="text-align: left;">To view detailed information of your job</td><td style="text-align: left;">scontrol show job JOBID</td></tr><tr class="odd"><td style="text-align: left;">To View resource accounting information for finished and running jobs</td><td style="text-align: left;">sacct</td></tr><tr class="even"><td style="text-align: left;">To View resource accounting information for running jobs</td><td style="text-align: left;">sstat</td></tr></tbody></table><h2 id="sample-script">Sample script</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/bash</span><br><br><span class="hljs-comment"># NOTE: Lines starting with &quot;#SBATCH&quot; are valid SLURM commands or statements,</span><br><span class="hljs-comment">#       while those starting with &quot;#&quot; and &quot;##SBATCH&quot; are comments.  Uncomment</span><br><span class="hljs-comment">#       &quot;##SBATCH&quot; line means to remove one # and start with #SBATCH to be a</span><br><span class="hljs-comment">#       SLURM command or statement.</span><br><br><span class="hljs-comment">#SBATCH -J slurm_job # Slurm job name</span><br><span class="hljs-comment">#SBATCH -t 48:00:00  # time limit: (D-HH:MM or D-HH:MM:SS)</span><br><br><span class="hljs-comment"># Enable email notificaitons when job begins and ends, uncomment if you need it</span><br><span class="hljs-comment">##SBATCH --mail-user=waipangsze@gmail.com # Update your email address</span><br><span class="hljs-comment">##SBATCH --mail-type=end           # NONE, BEGIN, END, FAIL, REQUEUE, ALL</span><br><br><span class="hljs-comment"># Choose partition (queue) to use. Note: replace &lt;partition_to_use&gt; with the name of partition</span><br><span class="hljs-comment">#SBATCH -p &lt;partition_to_use&gt;</span><br><br><span class="hljs-comment"># Use memory, nodes and cores</span><br><span class="hljs-comment">#SBATCH --mem=32000            # memory per node in MB </span><br><span class="hljs-comment">#SBATCH --nodes=1              # number of nodes</span><br><span class="hljs-comment">#SBATCH --ntasks-per-node=16   # number of cores</span><br><br><span class="hljs-comment"># Setup runtime environment if necessary</span><br><span class="hljs-comment"># For example, setup intel MPI environment</span><br>module gnu8<br><span class="hljs-comment"># Setup runtime environment if necessary </span><br><span class="hljs-comment"># or you can source ~/.bashrc or ~/.bash_profile </span><br><span class="hljs-comment"># Go to the job submission directory and run your application</span><br><span class="hljs-built_in">cd</span> <span class="hljs-variable">$HOME</span>/apps/slurm<br>mpirun ./your_mpi_application<br><br><span class="hljs-comment"># or another work</span><br>module load intel/compiler/64/2017/17.0.0<br>module load intel/mkl/64/2017/0.098<br>module load intel/mpi/64/2017/0.098<br><span class="hljs-built_in">cd</span> /gpfs/projects/samples/intel_mpi_hello/<br>mpiicc mpi_hello.c -o intel_mpi_hello<br>mpirun ./intel_mpi_hello<br><br><span class="hljs-comment"># or GPU</span><br><span class="hljs-comment">#SBATCH -N 1 -n 8 -p GPU-V100 --gres=gpu:v100:2</span><br>./your-gpu-prog<br></code></pre></td></tr></table></figure><p>You have to module what you need (compiler and correspoinding libraries)<sup id="fnref:2" class="footnote-ref"><a href="#fn:2" rel="footnote"><span class="hint--top hint--rounded" data-aria-label="[HKUST ITSC: JOB SCHEDULING SYSTEM (SLURM)](https://itsc.hkust.edu.hk/services/academic-teaching-support/high-performance-computing/hpc3-cluster/jobs)">[2]</span></a></sup>.</p><p>Upon job completion, the standard output will be stored in the job submission directory under the filename <strong>slurm-<your_slurm_jobid>.out</strong> or assign filename as</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#SBATCH --output=slurm.out     # file to collect standard output</span><br><span class="hljs-comment">#SBATCH --error=slurm.err      # file to collect standard errors</span><br></code></pre></td></tr></table></figure><p>If the time limit is not specified in the submit script, SLURM will assign the default run time, 3 days. This means the job will be terminated by SLURM in 72 hrs. If the memory limit is not requested, SLURM will assign the default 16 GB. The maximum allowed memory per node is 128 GB. To see how much RAM per node your job is using, you can run commands sacct or sstat to query MaxRSS for the job on the node.</p><h2 id="query-job-information">Query job information</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/bash</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;===========================================================&quot;</span><br>sacct --format=JobID,Jobname,start,end,elapsed,nnodes,ncpus,AveRSS,MaxRSS,MaxDiskRead,MaxDiskWrite,CPUTime,MaxVMSize<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;===========================================================&quot;</span><br>squeue -o<span class="hljs-string">&quot;%.7i %.9P %.8j %.8u %.2t %.10M %.6D %C %m %z %V %l&quot;</span><br>squeue -o<span class="hljs-string">&quot;%.7i %o&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;===========================================================&quot;</span><br></code></pre></td></tr></table></figure><p><a href="https://slurm.schedmd.com/sinfo.html"><strong>sinfo</strong></a></p><p><a href="https://slurm.schedmd.com/squeue.html"><strong>squeue</strong></a></p><p><a href="https://slurm.schedmd.com/sacct.html"><strong>sacct</strong></a></p><p><a href="https://slurm.schedmd.com/scontrol.html"><strong>scontrol</strong></a></p><p>One more for check historical jobs, <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">alias</span> sacct_job=<span class="hljs-string">&#x27;sacct --format=&quot;JobId,JobName%50,Partition,Nodelist,Account,AllocCPUS,State,Submit,Start,End,Elapsed&quot;&#x27;</span><br><br>sacct_job --starttime=2023-05-01<br></code></pre></td></tr></table></figure></p><h3 id="seff">seff</h3><p>The Slurm job efficiency report (seff)<sup id="fnref:3" class="footnote-ref"><a href="#fn:3" rel="footnote"><span class="hint--top hint--rounded" data-aria-label="[Slurm command: seff](https://bugs.schedmd.com/show_bug.cgi?id=1611)">[3]</span></a></sup></p><p>Summary: seff takes a jobid and reports on the efficiency of that job's cpu and memory utilization. The rpm/tarball comes with an 'smail' utility that allows for Slurm end-of-job emails to include a seff report. This allows users to become aware if they are wasting resources. <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># This script is roughtly equivalent to:</span><br><span class="hljs-comment"># sacct -P -n -a --format JobID,User,Group,State,Cluster,AllocCPUS,REQMEM,TotalCPU,Elapsed,MaxRSS,ExitCode,NNodes,NTasks -j &lt;job_id&gt;</span><br></code></pre></td></tr></table></figure></p><p>or copy from github <a href="https://github.com/SchedMD/slurm/blob/260ced654c920481eaf03558e887741e673cca53/contribs/seff/seff">SchedMd slurm seff</a></p><h2 id="ulimit--s-unlimited">ulimit -s unlimited</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">ulimit</span> -l unlimited<br><span class="hljs-built_in">ulimit</span> -s unlimited<br></code></pre></td></tr></table></figure><h2 id="slurm-job-dependencies">SLURM Job Dependencies</h2><p>You may submit jobs that runs depending on status of the previously submitted jobs or schedule a bunch of jobs to run one after the other.<sup id="fnref:4" class="footnote-ref"><a href="#fn:4" rel="footnote"><span class="hint--top hint--rounded" data-aria-label="[HKU slurm-job-dependencies](https://hpc.hku.hk/guide/slurm-guide/slurm-job-dependencies/)">[4]</span></a></sup> <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># Format is </span><br>$ sbatch --dependency=<span class="hljs-built_in">type</span>:job_id jobfile<br>$ sbatch --dependency=<span class="hljs-built_in">type</span>:job_id,job_id,job_id jobfile <span class="hljs-comment"># requires more than one job to be completed</span><br><br>jobID=$(sbatch first_job.sh)<br>sbatch --dependency=afterok:<span class="hljs-variable">$&#123;jobID&#125;</span> second_job.sh<br></code></pre></td></tr></table></figure></p><h2 id="submit-a-job-to-a-specific-node">Submit a job to a specific node</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">sbatch --nodelist=node[01-09]<br>sbatch --nodelist=node01<br>sbatch --exclude=node[10-19] <span class="hljs-comment"># Slurm sbatch exclude nodes or node list</span><br></code></pre></td></tr></table></figure><h2 id="mem-per-cpu">--mem-per-cpu</h2><ul><li><a href="https://researchcomputing.princeton.edu/support/knowledge-base/memory" class="uri">https://researchcomputing.princeton.edu/support/knowledge-base/memory</a></li></ul><p>In this case the correct action would be to decrease the required memory by using something like <strong>#SBATCH --mem-per-cpu=3G</strong>. It is wise to request more memory than you actually need for safety. Remember that the job will fail if it runs out of memory.</p><div class="note note-primary">            <p>However, it is important not to request an excessive amount because that would make it harder for the job scheduler to schedule the job which results in longer queue times.</p>          </div><h2 id="parameters-for-openmp">Parameters for OpenMP</h2><p>The OMP_STACKSIZE environment variable controls the size of the stack for threads created by the OpenMP implementation. <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># Parameters for OpenMP</span><br><span class="hljs-built_in">export</span> OMP_STACKSIZE=512m <span class="hljs-comment"># the number is suffixed by B, K, M or G</span><br><span class="hljs-built_in">export</span> OMP_NUM_THREADS=1<br></code></pre></td></tr></table></figure></p><h1 id="references">References</h1><ol type="1"><li><a href="https://docs.hpc.sjtu.edu.cn/job/slurm.html">ä¸Šæµ·äº¤å¤§è¶…ç®—å¹³å°ç”¨æˆ·æ‰‹å†Œ Documentation Slurm ä½œä¸šè°ƒåº¦ç³»ç»Ÿ</a></li><li><a href="https://scc.ustc.edu.cn/zlsc/user_doc/html/slurm/index.html">ä¸­å›½ç§‘å¤§è¶…ç®—ä¸­å¿ƒç”¨æˆ·ä½¿ç”¨æ‰‹å†Œ Slurmä½œä¸šè°ƒåº¦ç³»ç»Ÿ</a><section class="footnotes"><div class="footnote-list"><ol><li><span id="fn:1" class="footnote-text"><span><a href="https://slurm.schedmd.com/documentation.html">Slurm</a> <a href="#fnref:1" rev="footnote" class="footnote-backref"> â†©</a></span></span></li><li><span id="fn:2" class="footnote-text"><span><a href="https://itsc.hkust.edu.hk/services/academic-teaching-support/high-performance-computing/hpc3-cluster/jobs">HKUST ITSC: JOB SCHEDULING SYSTEM (SLURM)</a> <a href="#fnref:2" rev="footnote" class="footnote-backref"> â†©</a></span></span></li><li><span id="fn:3" class="footnote-text"><span><a href="https://bugs.schedmd.com/show_bug.cgi?id=1611">Slurm command: seff</a> <a href="#fnref:3" rev="footnote" class="footnote-backref"> â†©</a></span></span></li><li><span id="fn:4" class="footnote-text"><span><a href="https://hpc.hku.hk/guide/slurm-guide/slurm-job-dependencies/">HKU slurm-job-dependencies</a> <a href="#fnref:4" rev="footnote" class="footnote-backref"> â†©</a></span></span></li><li><span id="fn:5" class="footnote-text"><span><a href="https://docs.slurm.cn/master/man-pages-shou-ce">Slurmä¸­è‹±æ–‡å°ç…§æ–‡æª”</a> <a href="#fnref:5" rev="footnote" class="footnote-backref"> â†©</a></span></span></li><li><span id="fn:6" class="footnote-text"><span><a href="https://hpc.hku.hk/guide/slurm-guide/slurm-job-script/">HKU SLURM Job script</a> <a href="#fnref:6" rev="footnote" class="footnote-backref"> â†©</a></span></span></li></ol></div></section></li></ol>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>slurm</tag>
      
      <tag>HPC</tag>
      
      <tag>NWP</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Setting up Blog on github.io</title>
    <link href="/2023/04/23/github-io/"/>
    <url>/2023/04/23/github-io/</url>
    
    <content type="html"><![CDATA[<p>This article shares the process of setting up blog website on github.io.</p><h2 id="create-a-new-github-and-git-clone-to-local-computer">Create a new github and git clone to local computer</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># the project to your own account and renaming the repo with &lt;yourusername&gt;.github.io</span><br>git <span class="hljs-built_in">clone</span> git@github.com:xxx/xxx.github.io<br></code></pre></td></tr></table></figure><h2 id="install-packages">Install packages</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh">conda create -n jekyll<br>conda activate jekyll<br>conda install -c conda-forge c-compiler compilers cxx-compiler<br>conda install -c conda-forge ruby<br>gem update --system<br>gem install bundler<br>gem install jekyll<br>gem install jekyll-paginate<br></code></pre></td></tr></table></figure><p>Remark: $ conda install -c conda-forge ruby=3.3.3</p><p>and checking, <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">which</span> jekyll<br><span class="hljs-built_in">which</span> ruby<br><span class="hljs-built_in">ln</span> -s /xxx/anaconda3/envs/jekyll/bin/ruby /xxx/anaconda3/envs/jekyll/share/rubygems/bin/ruby<br>bundle init<br>bundle install<br>bundle update --bundler<br>bundle add jekyll<br>gem <span class="hljs-string">&quot;jekyll&quot;</span><br>gem <span class="hljs-string">&quot;jekyll-paginate&quot;</span><br>bundle update<br>bundle <span class="hljs-built_in">exec</span> jekyll -v<br>vim Gemfile + gem <span class="hljs-string">&quot;jekyll-paginate&quot;</span><br></code></pre></td></tr></table></figure></p><h2 id="run-on-local-computer">Run on local computer</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">bundle update<br>bundle <span class="hljs-built_in">exec</span> jekyll serve<br></code></pre></td></tr></table></figure><p>iMac is <figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs vim">Run in <span class="hljs-keyword">verbose</span> <span class="hljs-keyword">mode</span> <span class="hljs-keyword">to</span> see <span class="hljs-keyword">all</span> warnings.<br>                    done in <span class="hljs-number">2.362</span> seconds.<br> Auto-regeneration: enabled <span class="hljs-keyword">for</span> <span class="hljs-string">&#x27;/Users/wpsze/Documents/git-local/waipangsze.github.io&#x27;</span><br>    Server address: http://<span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">4000</span><br>  Server running... press ctrl-<span class="hljs-keyword">c</span> <span class="hljs-keyword">to</span> <span class="hljs-keyword">stop</span>.<br>[<span class="hljs-number">2022</span>-<span class="hljs-number">06</span>-<span class="hljs-number">01</span> <span class="hljs-number">13</span>:<span class="hljs-number">15</span>:<span class="hljs-number">18</span>] ERROR `/js/pageContent.js<span class="hljs-string">&#x27; not found.</span><br></code></pre></td></tr></table></figure></p><p>Open a browser with the ip address in above output</p><h2 id="upload-to-github">Upload to github</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh">git pull --rebase <span class="hljs-comment"># do this at the beginning</span><br>git status<br>git add . <span class="hljs-comment"># add all files</span><br>git commit --amend<br>git push (-f)<br>git push -u origin main<br></code></pre></td></tr></table></figure><h2 id="errors">Errors</h2><ol type="1"><li>jekyll/share/rubygems/bin/ruby: No such file or directory</li><li>Error installing jekyll: Failed to build gem native extension</li><li>cannot load such file â€“ jekyll-paginate</li><li>Could not locate Gemfile (bundle init)</li><li>jekyll is not currently included in the bundle, perhaps you meant to add it to your Gemfile (Edit Gemfile, + gem "jekyll", "~&gt; 4.3"</li><li>make: /usr/bin/mkdir: Command not found ==&gt; in .zshrc, add source ~/.bashrc, and sudo ln -s /bin/mkdir /usr/bin/mkdir</li></ol><p>Reference: 1. <a href="https://s-canchi.github.io/2021-04-30-jekyll-conda/">Setting up a blog site with jekyll using conda</a> 2. <a href="https://github.com/kitian616/jekyll-TeXt-theme">TeXt Theme</a> 3. <a href="https://github.com/kitian616/jekyll-TeXt-theme/tree/master/docs/_posts">_posts</a> 4. <a href="https://github.com/Gaohaoyang/gaohaoyang.github.io/tree/master">gaohaoyang.github.io)</a> 5. <a href="https://gaohaoyang.github.io/">Welcome to HyG's Blog! è¿™é‡Œè®°å½•ç€æˆ‘çš„å‰ç«¯å­¦ä¹ ä¹‹è·¯</a></p>]]></content>
    
    
    <categories>
      
      <category>github</category>
      
    </categories>
    
    
    <tags>
      
      <tag>github.io</tag>
      
      <tag>blog</tag>
      
      <tag>jekyll</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
