<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>WRF | ncview/ncvis -- a NetCDF visual browser</title>
    <link href="/2024/10/10/ncview/"/>
    <url>/2024/10/10/ncview/</url>
    
    <content type="html"><![CDATA[<h1 id="ncview">ncview</h1><ul><li><a href="https://cirrus.ucsd.edu/~pierce/software/ncview/index.html">ncview website | David W. Pierce</a></li><li>ncmaps brings scientific colormaps to ncview. <a href="https://github.com/TomLav/ncmaps/tree/main" class="uri">https://github.com/TomLav/ncmaps/tree/main</a></li></ul><p><strong>Ncview is designed to be the fastest way to see what's in a netCDF file</strong>. Of course I'm biased since I wrote the thing, but I think everybody who works with netCDF files can benefit from having ncview in their toolkit. Ncview doesn't replace existing analysis packages, such as IDL, NCL, Matlab, Ferret, or R; instead it supplements them by providing a quick and easy way to get an enormous amount of information from your netCDF file.</p><h2 id="installation">Installation</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">conda install conda-forge::ncview<br></code></pre></td></tr></table></figure><h2 id="command-prompt">Command prompt</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">ncview xxx.nc<br></code></pre></td></tr></table></figure><figure><img src="https://i.imgur.com/lGIE5ba.png" alt="ncview" /><figcaption>ncview</figcaption></figure><p>In particular, the following attributes are taken into account:</p><ul><li><strong>missing_value</strong>: This attribute, which must be of the same type as the variable it is associated with, is an important one to set if you have missing values that are indicated by some “special” number such as -999.9, 1.0e35, or whatever. If you don’t set this attribute, ncview will not work properly.</li><li><strong>units</strong>: A character-type attribute that gives the units of the variable it is associated with. For example, “meters” or “Years”.</li><li><strong>long_name</strong>: A character-type attribute that gives the extended, or more descriptive, name of the variable it is associated with. For instance, if the variable’s name is “Lon”, its long_name might be “Longitude”.</li><li><strong>title</strong>: This global character-type attribute gives some short, descriptive summary of the meaning or parameters of the data file. For instance, it might be “Run 017: dx=4, dy=5, nT=45 yrs” or “El Nino Simulation, no mixed layer, D. Pierce SIO/CRD”.</li><li><strong>add_offset, scale_factor</strong>: Ncview respects these attributes, transparently scaling and offsetting the data as specified. See the netCDF documentation on these attributes for details. In essence, these attributes let you implement a form of data packing.</li></ul><h1 id="packed-data-values">Packed Data Values</h1><p>What are <strong>add_offset, scale_factor</strong> ?</p><ul><li><a href="https://www.unidata.ucar.edu/software/netcdf/workshops/2010/bestpractices/Packing.html" class="uri">https://www.unidata.ucar.edu/software/netcdf/workshops/2010/bestpractices/Packing.html</a></li></ul><div class="note note-warning">            <p>Conventions for packing numeric data to <strong>save space</strong> have some subtleties.</p>          </div><p>Packed data is stored in a netCDF file using a smaller data type than the original data, for example, packing doubles into shorts. The netCDF library itself does not do packing and unpacking, but the Java-netCDF library will do automatic unpacking, see class VariableDS.</p><p>Recommendations:</p><p>For each variable with packed data, add two attributes called scale_factor and add_offset, such that</p><blockquote><p>unpacked_value = packed_value * scale_factor + add_offset</p></blockquote><p>The type of the stored variable is the type of the packed data type, typically byte, short, or int.</p><p>The type of the scale_factor and add_offset attributes should be the type that you want the unpacked data to be, typically float or double.</p><p>To compute the scale and offset for maximum precision packing of a set of numbers, use:</p><blockquote><p>add_offset = dataMin<br />scale_factor = (dataMax - dataMin) / (2^n - 1)</p></blockquote><p>where n is the number of bits of the packed (integer) data type.</p><p>To avoid introducing a bias into the unpacked values due to truncation when packing, round to the nearest integer rather than just truncating towards zero:</p><blockquote><p>packed_value = nint((unpacked_value - add_offset) / scale_factor)</p></blockquote><p>The precision of the data will be</p><blockquote><p>1.0 / scale_factor.</p></blockquote><p>Example, packing 32-bit floats into 16-bit shorts:</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs text">variables:<br>  short data(z, y, x) ;<br>    data:scale_offset = 34.02f ;<br>    data:add_offset = 1.54f ;<br></code></pre></td></tr></table></figure><h1 id="ncvis">ncvis</h1><ul><li><a href="https://github.com/SEATStandards/ncvis" class="uri">https://github.com/SEATStandards/ncvis</a></li></ul><p>NetCDF Visualizer</p><p>Developed by Paul A. Ullrich</p><div class="note note-warning">            <p>In order for ncvis to run the resources directory must be in the same folder as ncvis or the NCVIS_RESOURCE_DIR environment variable must be set to the path of the ncvis resources folder. This directory is where ncvis stores <strong>fonts</strong>, <strong>colormaps</strong> and <strong>shapefiles</strong>.</p>          </div><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">conda install conda-forge::ncvis<br></code></pre></td></tr></table></figure><figure><img src="https://user-images.githubusercontent.com/5330916/187129223-b9d47718-fff3-4fd9-8efb-4f71bd86d3e2.png" alt="ncvis" /><figcaption>ncvis</figcaption></figure>]]></content>
    
    
    <categories>
      
      <category>NWP</category>
      
      <category>ML</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NWP</tag>
      
      <tag>ML</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>AI for Numerical Weather Prediction (NWP)</title>
    <link href="/2024/10/09/AI-for-Numerical-Weather-Prediction-NWP/"/>
    <url>/2024/10/09/AI-for-Numerical-Weather-Prediction-NWP/</url>
    
    <content type="html"><![CDATA[<h1 id="introduction-to-ai-in-numerical-weather-prediction">Introduction to AI in Numerical Weather Prediction</h1><p>Artificial Intelligence (AI) is transforming the field of Numerical Weather Prediction (NWP), significantly enhancing the accuracy and efficiency of weather forecasting. Traditional NWP relies on complex physical models to simulate atmospheric processes, but the integration of AI and machine learning (ML) is introducing new methodologies that leverage vast datasets to improve predictions.</p><p>AI technologies, particularly machine learning algorithms, excel at analyzing large volumes of meteorological data from diverse sources, including satellites, radar systems, and surface sensors. These algorithms can identify intricate patterns and correlations that may be overlooked by conventional methods, leading to more precise forecasts. For instance, models like Google DeepMind's GraphCast can predict weather conditions up to ten days in advance in less than a minute, outperforming traditional systems that require hours on supercomputers.</p><div class="note note-warning">            <p><a href="https://www.ecmwf.int/en/about/media-centre/aifs-blog">ECMWF | AIFS Blog</a></p>          </div><ul><li><a href="https://charts.ecmwf.int/products/plwww_3m_fc_aifs_wp_mean?area=Northern%20Extra-tropics&amp;parameter=Geopotential%20500hPa&amp;score=Root%20mean%20square%20error">Scores of forecasts of upper-air parameters by AIFS - experimental machine learning model</a></li><li><a href="https://charts.ecmwf.int/streaming/20241009-0750/81/ps2png-worker-commands-76f744c54b-4xnd6-6fe5cac1a363ec1525f54343b6cc9fd8-zisedq81.png">Scores of forecasts of upper-air parameters by experimental machine learning models</a></li></ul><figure><img src="https://charts.ecmwf.int/streaming/20241009-0750/81/ps2png-worker-commands-76f744c54b-4xnd6-6fe5cac1a363ec1525f54343b6cc9fd8-zisedq81.png" alt="ECMWF | Scores of forecasts of upper-air parameters by experimental machine learning models (Higher is better)" /><figcaption>ECMWF | Scores of forecasts of upper-air parameters by experimental machine learning models <strong>(Higher is better)</strong></figcaption></figure><figure><img src="https://charts.ecmwf.int/streaming/20241009-0710/e3/ps2png-worker-commands-76f744c54b-rk8tn-6fe5cac1a363ec1525f54343b6cc9fd8-ue79gh2y.png" alt="ECMWF | Scores of forecasts of upper-air parameters by experimental machine learning models (Lower is better)" /><figcaption>ECMWF | Scores of forecasts of upper-air parameters by experimental machine learning models <strong>(Lower is better)</strong></figcaption></figure><h1 id="run-ai-models-yourself-from-ecmwf-open-data">Run AI models yourself from ECMWF open data</h1><p>26 September 2024<br />The AIFS team</p><ul><li><a href="https://www.ecmwf.int/en/about/media-centre/aifs-blog/2024/run-ai-models-yourself-ecmwf-open-data" class="uri">https://www.ecmwf.int/en/about/media-centre/aifs-blog/2024/run-ai-models-yourself-ecmwf-open-data</a></li><li>To announce that users can now run AI models using ECMWF's open data themselves. This breakthrough democratizes access to cutting-edge weather forecasting technology and opens new possibilities for research, education, and application development.</li><li>success of machine learning models like FourCastNet, Pangu-Weather, GraphCast and FuXi, ECMWF is now empowering users to harness these AI tools directly.</li></ul><h2 id="the-power-of-open-data-and-ai">The power of open data and AI</h2><p>By combining ECMWF's high-quality open data with state-of-the-art AI models, users can:</p><ul><li>generate rapid forecasts on their own computer</li><li>explore multi-model ensemble forecasting techniques with AI</li><li>conduct research on model performance and intercomparison without any accounts/licences.</li><li><strong>Plugins already exist for Pangu-Weather, FourCastNet (versions 1 and 2), GraphCast, FuXi and, most recently, Aurora.</strong></li><li><a href="https://github.com/ecmwf-lab/ai-models" class="uri">https://github.com/ecmwf-lab/ai-models</a></li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh">pip install ai-models <br><br>pip install ai-models-panguweather <span class="hljs-comment"># Or another model </span><br>pip install ai-models-fourcastnet<br>pip install ai-models-graphcast  <span class="hljs-comment"># Install details at https://github.com/ecmwf-lab/ai-models-graphcast</span><br>pip install ai-models-fourcastnetv2 <br><br>ai-models panguweather --input ecmwf-open-data <br></code></pre></td></tr></table></figure><p>See</p><ul><li><a href="https://github.com/ecmwf-lab/ai-models-panguweather">ai-models-panguweather</a>,</li><li><a href="ai-models-fourcastnet">ai-models-fourcastnet</a>,</li><li><a href="ai-models-fourcastnetv2">ai-models-fourcastnetv2</a> and</li><li><a href="ai-models-graphcast">ai-models-graphcast</a></li></ul><p>for more details about these models.</p><div class="note note-warning">            <p>To fix ONNX or version issue, we suggest that you <strong>install ai-models in a conda environment and install the CUDA libraries in that environment</strong>.</p>          </div><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh">conda create -n ai-models python=3.10<br>conda activate ai-models<br>conda install cudatoolkit<br>pip install ai-models<br>...<br></code></pre></td></tr></table></figure><h3 id="running-the-models">Running the models</h3><p>To run model, make sure it has been installed, then simply run:</p><div class="note note-warning">            <p>By default, the model will be run for <strong>a 10-day lead time (240 hours)</strong>, using <strong>yesterday's 12Z analysis</strong> from ECMWF's MARS archive.</p>          </div><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">ai-models &lt;model-name&gt;<br><br><span class="hljs-comment"># To produce a 15 days forecast, use the --lead-time HOURS option:</span><br>ai-models --lead-time 360 &lt;model-name&gt;<br></code></pre></td></tr></table></figure><h3 id="performances-considerations">Performances Considerations</h3><p>The AI models can run on a CPU; however, they perform significantly better on a GPU.</p><div class="note note-warning">            <p><strong>A 10-day forecast can take several hours on a CPU but only around one minute on a modern GPU.</strong></p>          </div><div class="note note-warning">            <p><strong>We strongly recommend running these models on a computer equipped with a GPU for optimal performance.</strong></p>          </div><p>It you see the following message when running a model, it means that the <strong>ONNX runtime was not able to find a the CUDA libraries on your system</strong>:</p><blockquote><p>[W:onnxruntime:Default, onnxruntime_pybind_state.cc:541 CreateExecutionProviderInstance] Failed to create CUDAExecutionProvider. Please reference https://onnxruntime.ai/docs/reference/execution-providers/CUDA-ExecutionProvider.html#requirements to ensure all dependencies are met.</p></blockquote><h3 id="assets">Assets</h3><p>The AI models rely on weights and other assets created during training. The first time you run a model, you will need to download the <strong>trained weights</strong> and <strong>any additional required assets</strong>.</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># To download the assets before running a model, use the following command:</span><br>ai-models --download-assets &lt;model-name&gt;<br><br><span class="hljs-comment"># The assets will be downloaded if needed and stored in the current directory. You can provide a different directory to store the assets:</span><br>ai-models --download-assets --assets &lt;some-directory&gt; &lt;model-name&gt;<br><br><span class="hljs-comment"># Then, for running, later on, simply use:</span><br>ai-models --assets &lt;some-directory&gt;  &lt;model-name&gt;<br><span class="hljs-comment"># or </span><br><span class="hljs-built_in">export</span> AI_MODELS_ASSETS=&lt;some-directory&gt;<br>ai-models &lt;model-name&gt;<br></code></pre></td></tr></table></figure><p>For better organisation of the assets directory, you can use the <strong>--assets-sub-directory</strong> option. This option will store the assets of each model in its own subdirectory within the specified assets directory.</p><h3 id="input-data">Input data</h3><p>The models require input data (initial conditions) to run. You can provide the input data using different sources, as described below:</p><h4 id="from-mars">From MARS</h4><div class="note note-warning">            <p>By default, <strong>ai-models use yesterday's 12Z analysis from ECMWF</strong>, fetched from the Centre's MARS archive using the <a href="https://www.ecmwf.int/en/computing/software/ecmwf-web-api">ECMWF WebAPI</a>. <strong>You will need an ECMWF account to access that service</strong>.</p>          </div><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># To change the date or time, use the --date and --time options, respectively:</span><br><br>ai-models --<span class="hljs-built_in">date</span> YYYYMMDD --time HHMM &lt;model-name&gt;<br></code></pre></td></tr></table></figure><h4 id="from-the-cds-era5">From the CDS (ERA5)</h4><p>You can start the models <strong>using ERA5 (ECMWF Reanalysis version 5) data</strong> for the <a href="https://cds.climate.copernicus.eu/">Copernicus Climate Data Store (CDS)</a>. You will need to create an account on the CDS. The data will be downloaded using the <a href="https://cds.climate.copernicus.eu/api-how-to">CDS API</a>).</p><p>To access the CDS, simply add <strong>--input cds</strong> on the command line. <strong>Please note that ERA5 data is added to the CDS with a delay</strong>, so you will also have to provide a date with --date YYYYMMDD.</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">ai-models --input cds --<span class="hljs-built_in">date</span> 20230110 --time 0000 &lt;model-name&gt;<br></code></pre></td></tr></table></figure><h4 id="from-a-grib-file">From a GRIB file</h4><p>If you have input data in the GRIB format, you can provide the file using the <strong>--file</strong> option:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">ai-models --file &lt;some-grib-file&gt; &lt;model-name&gt;<br></code></pre></td></tr></table></figure><div class="note note-warning">            <p>The GRIB file can contain more fields than the ones required by the model. The ai-models command will automatically select the necessary fields from the file.</p>          </div><div class="note note-warning">            <p>GFS grib files?</p>          </div><p>To find out the list of fields needed by a specific model as initial conditions, use the following command:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">ai-models --fields &lt;model-name&gt;<br></code></pre></td></tr></table></figure><h3 id="output">Output</h3><p>By default, the model output will be written in GRIB format in a file called <strong>&lt;model-name&gt;.grib</strong>. You can change the file name with the option <strong>--path <file-name></strong>. If the path you specify contains placeholders between { and }, multiple files will be created based on the <a href="https://confluence.ecmwf.int/display/ECC">eccodes</a> keys. For example:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">ai-models --path <span class="hljs-string">&#x27;out-&#123;step&#125;.grib&#x27;</span> &lt;model-name&gt;<br></code></pre></td></tr></table></figure><p><strong>This command will create a file for each forecasted time step.</strong></p><p>If you want to disable writing the output to a file, use the <strong>--output none</strong> option.</p><h3 id="command-line-options">Command line options</h3><p>It has the following options:</p><ul><li><code>--help</code>: Displays this help message.</li><li><code>--models</code>: Lists all installed models.</li><li><code>--debug</code>: Turns on debug mode. This will print additional information to the console.</li></ul><h4 id="input">Input</h4><ul><li><code>--input INPUT</code>: The input source for the model. This can be a <code>mars</code>, <code>cds</code> or <code>file</code>.</li><li><p><code>--file FILE</code>: The specific file to use as input. This option will set <code>--source</code> to <code>file</code>.</p></li><li><code>--date DATE</code>: The analysis date for the model. This defaults to yesterday.</li><li><p><code>--time TIME</code>: The analysis time for the model. This defaults to 1200.</p></li></ul><h4 id="output-1">Output</h4><ul><li><code>--output OUTPUT</code>: The output destination for the model. Values are <code>file</code> or <code>none</code>.</li><li><code>--path PATH</code>: The path to write the output of the model.</li></ul><h4 id="run">Run</h4><ul><li><code>--lead-time HOURS</code>: The number of hours to forecast. The default is 240 (10 days).</li></ul><h4 id="assets-management">Assets management</h4><ul><li><code>--assets ASSETS</code>: Specifies the path to the directory containing the model assets. The default is the current directory, but you can override it by setting the <code>$AI_MODELS_ASSETS</code> environment variable.</li><li><code>--assets-sub-directory</code>: Enables organising assets in <code>&lt;assets-directory&gt;/&lt;model-name&gt;</code> subdirectories.</li><li><code>--download-assets</code>: Downloads the assets if they do not exist.</li></ul><h4 id="misc.-options">Misc. options</h4><ul><li><code>--fields</code>: Print the list of fields needed by a model as initial conditions.</li><li><code>--expver EXPVER</code>: The experiment version of the model output.</li><li><code>--class CLASS</code>: The 'class' metadata of the model output.</li><li><code>--metadata KEY=VALUE</code>: Additional metadata metadata in the model output</li></ul><h1 id="available-products">Available products</h1><p>The output of these ML models are forecasts with 6-hourly time steps out to 10 days initialised from the ECMWF operational analysis. All forecasts are produced on a 0.25 x 0.25-degree grid.</p><h2 id="fourcastnetv2-small">FourCastNetv2-small:</h2><p>Upper-air fields are z (geopotential), r (relative humidity), t (temperature), u (U component of wind), and v (V component of wind) on the following pressure levels: 1000hPa, 925hPa, 850hPa, 700hPa, 600hPa, 500hPa, 400hP, 300hPa, 250hPa, 200hPa, 150hPa, 100hPa and 50hPa</p><p>The single-level fields are msl (mean sea level pressure), sp (surface pressure), 10u (10 metre U wind component), 10v (10 metre U wind component), 100u (100 metre U wind component), 100v (100 metre V wind component, 2t (2 metre temperature) and tcwv (total column vertically-integrated water vapour).</p><h2 id="graphcast">Graphcast:</h2><p>Upper-air fields are z (geopotential), q (specific humidity), t (temperature), u (U component of wind), v (V component of wind), w (vertical wind component) on the following pressure levels: 1000hPa, 925hPa, 850hPa, 700hPa, 600hPa, 500hPa, 400hP, 300hPa, 250hPa, 200hPa, 150hPa, 100hPa and 50hPa</p><p>The single-level fields are msl (mean sea level pressure), 10u (10 metre U wind component), 10v (10 metre U wind component), and 2t (2 metre temperature).</p><h2 id="pangu-weather">Pangu-Weather:</h2><p>Upper-air fields are z (geopotential), q (specific humidity), t (temperature), u (U component of wind), and v (V component of wind) on the following pressure levels: 1000hPa, 925hPa, 850hPa, 700hPa, 600hPa, 500hPa, 400hPa, 300hPa, 250hPa, 200hPa, 150hPa, 100hPa and 50hPa</p><p>The single-level fields are msl (mean sea level pressure), 10u (10 metre U wind component), 10v (10 metre U wind component) and 2t (2 metre temperature).</p><h1 id="hands-on">Hands-on</h1><h1 id="references">References</h1><ol type="1"><li><a href="https://www.ecmwf.int/en/about/media-centre/aifs-blog">ECMWF | AIFS Blog</a></li><li><a href="https://www.ecmwf.int/en/about/media-centre/aifs-blog/2024/run-ai-models-yourself-ecmwf-open-data">ECMWF | 2024 Run AI models yourself from ECMWF open data</a></li><li><a href="https://www.ecmwf.int/en/about/media-centre/aifs-blog/2024/data-driven-regional-modelling">ECMWF | 2024 Data-driven regional modelling</a><ul><li>some great work for limited-area modelling with Neural-LAM (Oskarsson et al. 2023).</li><li>In contrast to Neural-LAM, the approach we are currently testing keeps a global model. Over the domain where high-resolution data are available, here the Nordics, a finer-resolution graph is used in the model, to be able to ingest and output data from high-resolution regional analysis, reanalysis or forecast datasets.</li></ul></li><li><a href="https://www.ecmwf.int/en/about/media-centre/aifs-blog/2024/enter-ensembles">ECMWF | 2024 Enter the ensembles</a></li><li><a href="https://www.ecmwf.int/en/forecasts/dataset/machine-learning-model-data">ECMWF | 2023 Machine Learning model data</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>NWP</category>
      
      <category>ML</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NWP</tag>
      
      <tag>ML</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>WRF | Reduce the amount of wrfout data</title>
    <link href="/2024/10/08/reduce-wrfout-size/"/>
    <url>/2024/10/08/reduce-wrfout-size/</url>
    
    <content type="html"><![CDATA[<h1 id="how-to-reduce-the-amount-of-wrfout-data">How to reduce the amount of wrfout data</h1><ul><li><a href="https://forum.mmm.ucar.edu/threads/how-to-reduce-the-amount-of-wrfout-data.8642/">How to reduce the amount of wrfout data</a></li></ul><p>Two methods,</p><ul><li>Go into the WRF/Registry/Registry.EM_COMMON file, and then look for the variables you don’t want. You can remove the ‘h’ from out I/O column. After you do this for all of the variables you want removed, you will need to save the file, go back to the WRF/ directory, issue a ‘clean -a’ and then reconfigure and recompile</li><li>You can also use the Runtime I/O option, which will allow you to add a couple lines to your namelist, and create a text file that the model will read when it is run. With this method, you don't have to recompile the code, but you have to be careful to type everything correctly, and have no spaces in the text file. You can read about it here: <a href="http://www2.mmm.ucar.edu/wrf/users/docs/user_guide_v4/v4.1/users_guide_chap5.html#runtimeio" class="uri">http://www2.mmm.ucar.edu/wrf/users/docs/user_guide_v4/v4.1/users_guide_chap5.html#runtimeio</a></li></ul><div class="note note-warning">            <p>Just be careful removing variables. If you ever want to go back and plot specific things, or if you will use the files for anything else later, you may be missing something you didn't realize you would need.</p>          </div><h1 id="iofields_filename-not-working-wrfv4">iofields_filename not working WRFv4</h1><ul><li><a href="https://forum.mmm.ucar.edu/threads/iofields_filename-not-working-wrfv4.12353/#post-29058">iofields_filename not working WRFv4</a></li><li>iofields_filename = 'myoutfields.txt','youtfields.txt','myoutfields.txt','myoutfields.txt',</li><li>Your 'myoutfields.txt' file is set up like <figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs text">-:h:0:Times,LU_INDEX,ZS,DZS,FNM<br>-:h:0:FNP,RDNW,RDN,DNW,DN,CFN<br>-:h:0:CFN1,THIS_IS_AN_IDEAL_RUN<br>-:h:0:CF1,CF2,CF3,ITIMESTEP<br>-:h:0:SHDMAX,SHDMIN,SNOALB,TSLB<br>-:h:0:SMOIS,SH2O,SMCREL,SFROFF<br></code></pre></td></tr></table></figure></li></ul><p>But it should all be on a single line. Change the file so that it's in the following format:</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs text">-:h:0:Times,LU_INDEX,ZS,DZS,FNM,FNP,RDNW,RDN,DNW,DN,CFN,CFN1,THIS_IS_AN_IDEAL_RUN,CF1,CF2,CF3,ITIMESTEP<br></code></pre></td></tr></table></figure><div class="note note-warning">            <p>I also had to remove the variable "Times" from the myoutfields.txt file to get it to run correctly, so you may need to do that, as well. Hopefully these will fix the problem.</p>          </div><h1 id="減少wrfout輸出變數">減少wrfout輸出變數</h1><ul><li><a href="https://mp.weixin.qq.com/s/wIeD4TjlZus-3HeHQRxfvw">減少wrfout輸出變數</a></li><li>具體方法在userguide中也提到過，可以透過修改Registry來實現，ARW核心對應的是Registry/Registry.EM_COMMON文件，對其修改，然後再重新編譯（clean -a、configure、compile）。</li><li>但在3.2版本後，可以透過直接在namelist.input中可以指定剔除不需要輸出的變量，即： <figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs text">&amp;time_control<br>iofields_filename = &quot;my_file_d01.txt&quot;, &quot;my_file_d02.txt&quot;<br>ignore_iofields_warning = .true.,<br></code></pre></td></tr></table></figure></li></ul><p>在my_file_d01.txt檔案中，可以指明需要刪除的變數有哪些，具體內容如下：</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs text">-:h:0:RAINC,RAINNC<br></code></pre></td></tr></table></figure><ul><li><p><strong>-</strong> 表示刪除，<strong>+</strong> 表示增加；</p></li><li><p><strong>h</strong> 表示history，這裡可以理解為輸出，i表示輸入；</p></li><li><p><strong>0-24</strong> ：表示經過的通道，一般 <strong>預設0</strong> ；</p></li></ul><p>可以直接進行換行，但每一行的開頭需要類似 <strong>-:h:0:格式</strong>，然後後面的變數之間用英文逗號隔開。</p><ul><li>ignore_iofields_warning表示碰到錯誤時如何處理，如果設定為.true.則會列印警告訊息且繼續運行，如果設定為.false.時碰到錯誤會直接中斷，建議設定為.true.，所有的domain都通用，不用單獨設定。</li></ul><p>其中註意事項包括：</p><ul><li>多個domain可以使用同一個控製文件，類似上面的 my_file_d01.txt;</li><li>my_file_d01.txt檔案中的變數需完全正確，如果某個變數設定不正確，可以正常執行，但會出現warning，如下：WARNING: Unable to modify mask for wdntc. Variable not found. File: my_file_d01.txt at line 4，根據報錯可以發現第4行的wdntc不正確，重新修改以後可以正常運作。</li></ul>]]></content>
    
    
    <categories>
      
      <category>WRF</category>
      
    </categories>
    
    
    <tags>
      
      <tag>wrfout</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Global map of Local Climate Zones (LCZ)</title>
    <link href="/2024/10/07/Global-LCZ-for-Urban/"/>
    <url>/2024/10/07/Global-LCZ-for-Urban/</url>
    
    <content type="html"><![CDATA[<h1 id="global-map-of-local-climate-zones">Global map of Local Climate Zones</h1><ul><li><a href="https://zenodo.org/records/8419340" class="uri">https://zenodo.org/records/8419340</a></li></ul><h2 id="description">Description</h2><figure><img src="https://i.imgur.com/46uEI6Z.png" alt="A global 100 m spatial resolution Local Climate Zone (LCZ) map" /><figcaption>A global 100 m spatial resolution Local Climate Zone (LCZ) map</figcaption></figure><p>A global 100 m spatial resolution Local Climate Zone (LCZ) map, derived from multiple earth observation datasets and expert LCZ class labels.</p><p>The LCZ map is based on the LCZ typology (Stewart and Oke, 2012) that distinguish urban surfaces accounting for their typical combination of micro-scale land-covers and associated physical properties. The LCZ scheme is distinguished from other land use / land cover schemes by its focus on urban and rural landscape types, which can be described by any of the 17 classes in the LCZ scheme.</p><p>Out of the 17 LCZ classes, 10 reflect the 'built' environment, and each LCZ type is associated with generic numerical descriptions of key urban canopy parameters critical to model atmospheric responses to urbanisation. In addition, since LCZs were originally designed as a new framework for urban heat island studies (Stewart and Oke, 2012), they also contain a limited set (7) of 'natural' land-cover classes that can be used as 'control' or 'natural reference' areas. As these seven natural classes in the LCZ scheme can not capture the heterogeneity of the world’s existing natural ecosystems, we advise users - if required - to combine the built LCZ classes with any other land-cover product that provides a wider range of natural land-cover classes.</p><ul><li>Stewart ID, Oke TR. (2012). Local Climate Zones for Urban Temperature Studies. Bull Am Meteorol Soc. 93(12):1879-1900. doi:10.1175/BAMS-D-11-00019.1</li></ul><h2 id="versions">Versions</h2><p>If there are there multiple versions of the dataset, list the file updated, when and why update was made:</p><ul><li>_v1: initial release of the data (20220222)</li><li>_v2: add LCZ map of Iceland, consistent with the global LCZ map procedure (20221115)</li><li>_v3: Mosaicing two Global Forest Canopy Height products two cover remote areas (eg. islands) (20231008)</li></ul><h2 id="files-and-brief-description">Files and brief description</h2><p>Files and brief description:</p><ol type="1"><li><strong>lcz_filter_v3.tif</strong></li></ol><div class="note note-primary">            <p>The recommended global LCZ map, compressed as GeoTIFF, with LCZ classes indicated by numbers 1-17</p>          </div><p><strong>The recommended global LCZ map, compressed as GeoTIFF, with LCZ classes indicated by numbers 1-17</strong>. LCZ labels are obtained after applying the morphological Gaussian filter described in Demuzere et al. (2020). The official color scheme - as indicated in the table below - is embedded into the GeoTIFF.</p><figure><img src="https://i.imgur.com/pRByENm.jpeg" alt="Official class description" /><figcaption>Official class description</figcaption></figure><p>The table below describes,</p><table><thead><tr class="header"><th style="text-align: left;">LCZ class number</th><th style="text-align: center;">Official class description</th><th style="text-align: left;">Official hex color</th></tr></thead><tbody><tr class="odd"><td style="text-align: left;">LCZ 1</td><td style="text-align: center;">Compact highrise</td><td style="text-align: left;">'#910613'</td></tr><tr class="even"><td style="text-align: left;">LCZ 2</td><td style="text-align: center;">Compact midrise</td><td style="text-align: left;">'#D9081C'</td></tr><tr class="odd"><td style="text-align: left;">LCZ 3</td><td style="text-align: center;">Compact lowrise</td><td style="text-align: left;">'#FF0A22'</td></tr><tr class="even"><td style="text-align: left;">LCZ 4</td><td style="text-align: center;">Open highrise</td><td style="text-align: left;">'#C54F1E'</td></tr><tr class="odd"><td style="text-align: left;">LCZ 5</td><td style="text-align: center;">Open midrise</td><td style="text-align: left;">'#FF6628'</td></tr><tr class="even"><td style="text-align: left;">LCZ 6</td><td style="text-align: center;">Open lowrise</td><td style="text-align: left;">'#FF985E'</td></tr><tr class="odd"><td style="text-align: left;">LCZ 7</td><td style="text-align: center;">Lightweight low-rise</td><td style="text-align: left;">'#FDED3F'</td></tr><tr class="even"><td style="text-align: left;">LCZ 8</td><td style="text-align: center;">Large lowrise</td><td style="text-align: left;">'#BBBBBB'</td></tr><tr class="odd"><td style="text-align: left;">LCZ 9</td><td style="text-align: center;">Sparsely built</td><td style="text-align: left;">'#FFCBAB'</td></tr><tr class="even"><td style="text-align: left;">LCZ 10</td><td style="text-align: center;">Heavy Industry</td><td style="text-align: left;">'#565656'</td></tr><tr class="odd"><td style="text-align: left;">LCZ 11 (A)</td><td style="text-align: center;">Dense trees</td><td style="text-align: left;">'#006A18'</td></tr><tr class="even"><td style="text-align: left;">LCZ 12 (B)</td><td style="text-align: center;">Scattered trees</td><td style="text-align: left;">'#00A926'</td></tr><tr class="odd"><td style="text-align: left;">LCZ 13 (C)</td><td style="text-align: center;">Bush, scrub</td><td style="text-align: left;">'#628432'</td></tr><tr class="even"><td style="text-align: left;">LCZ 14 (D)</td><td style="text-align: center;">Low plants</td><td style="text-align: left;">'#B5DA7F'</td></tr><tr class="odd"><td style="text-align: left;">LCZ 15 (E)</td><td style="text-align: center;">Bare rock or paved</td><td style="text-align: left;">'#000000'</td></tr><tr class="even"><td style="text-align: left;">LCZ 16 (F)</td><td style="text-align: center;">Bare soil or sand</td><td style="text-align: left;">'#FCF7B1'</td></tr><tr class="odd"><td style="text-align: left;">LCZ 17 (G)</td><td style="text-align: center;">Water</td><td style="text-align: left;">'#656BFA'</td></tr></tbody></table><p>Other characteristics: - Projection: World Geodetic System 1984 (EPSG:4326) - Size: 389620, 155995 - Spatial Resolution: 0.000898° (~ 100 m) - Representative for the nominal year of 2018</p><ol type="1"><li>lcz_v3.tif</li></ol><p>Same as 1., but presenting the raw LCZ map, <strong>before applying the morphological Gaussian filter.</strong></p><ol start="3" type="1"><li>lcz_probability_v3.tif</li></ol><p>A probability layer (%) that identifies how often the modal LCZ was chosen per pixel (e.g. a probability of 60% means that the modal LCZ class was mapped 30 times out of 50 LCZ models). This is a pixel-based probability, derived from the lcz_v3.tif map.</p><h1 id="convert-tif-to-netcdf">Convert tif to netcdf</h1><p>GDAL is a translator library for raster and vector geospatial data formats that is released under an MIT style Open Source License by the Open Source Geospatial Foundation</p><p>https://gdal.org/</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">micromamba <span class="hljs-built_in">env</span> create -n gdal<br>micromamba install -c conda-forge gdal=3.6.1<br></code></pre></td></tr></table></figure><p>and then,</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh">whereis gdal_translate<br><br><span class="hljs-comment"># for checking</span><br>gdal_translate --long-usage<br><br>gdal_translate -of netCDF -co <span class="hljs-string">&quot;FOMRAT=NC4&quot;</span> lcz_filter_v3.tif lcz_filter_v3.nc <br></code></pre></td></tr></table></figure><p>The detail of file,</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs text">netcdf lcz_filter_v3 &#123;<br>dimensions:<br>lon = 389620 ;<br>lat = 155995 ;<br>variables:<br>char crs ;<br>crs:grid_mapping_name = &quot;latitude_longitude&quot; ;<br>crs:long_name = &quot;CRS definition&quot; ;<br>crs:longitude_of_prime_meridian = 0. ;<br>crs:semi_major_axis = 6378137. ;<br>crs:inverse_flattening = 298.257223563 ;<br>crs:spatial_ref = &quot;GEOGCS[\&quot;WGS 84\&quot;,DATUM[\&quot;WGS_1984\&quot;,SPHEROID[\&quot;WGS 84\&quot;,6378137,298.257223563,AUTHORITY[\&quot;EPSG\&quot;,\&quot;7030\&quot;]],AUTHORITY[\&quot;EPSG\&quot;,\&quot;6326\&quot;]],PRIMEM[\&quot;Greenwich\&quot;,0,AUTHORITY[\&quot;EPSG\&quot;,\&quot;8901\&quot;]],UNIT[\&quot;degree\&quot;,0.0174532925199433,AUTHORITY[\&quot;EPSG\&quot;,\&quot;9122\&quot;]],AXIS[\&quot;Latitude\&quot;,NORTH],AXIS[\&quot;Longitude\&quot;,EAST],AUTHORITY[\&quot;EPSG\&quot;,\&quot;4326\&quot;]]&quot; ;<br>crs:crs_wkt = &quot;GEOGCS[\&quot;WGS 84\&quot;,DATUM[\&quot;WGS_1984\&quot;,SPHEROID[\&quot;WGS 84\&quot;,6378137,298.257223563,AUTHORITY[\&quot;EPSG\&quot;,\&quot;7030\&quot;]],AUTHORITY[\&quot;EPSG\&quot;,\&quot;6326\&quot;]],PRIMEM[\&quot;Greenwich\&quot;,0,AUTHORITY[\&quot;EPSG\&quot;,\&quot;8901\&quot;]],UNIT[\&quot;degree\&quot;,0.0174532925199433,AUTHORITY[\&quot;EPSG\&quot;,\&quot;9122\&quot;]],AXIS[\&quot;Latitude\&quot;,NORTH],AXIS[\&quot;Longitude\&quot;,EAST],AUTHORITY[\&quot;EPSG\&quot;,\&quot;4326\&quot;]]&quot; ;<br>crs:GeoTransform = &quot;-170.0007776279147 0.000898315284119518 0 80.03809518448114 0 -0.000898315284119518 &quot; ;<br>double lat(lat) ;<br>lat:standard_name = &quot;latitude&quot; ;<br>lat:long_name = &quot;latitude&quot; ;<br>lat:units = &quot;degrees_north&quot; ;<br>double lon(lon) ;<br>lon:standard_name = &quot;longitude&quot; ;<br>lon:long_name = &quot;longitude&quot; ;<br>lon:units = &quot;degrees_east&quot; ;<br>byte Band1(lat, lon) ;<br>Band1:long_name = &quot;GDAL Band Number 1&quot; ;<br>Band1:_Unsigned = &quot;true&quot; ;<br>Band1:valid_range = 0s, 255s ;<br>Band1:_FillValue = 0b ;<br>Band1:grid_mapping = &quot;crs&quot; ;<br><br>// global attributes:<br>:GDAL_AREA_OR_POINT = &quot;Area&quot; ;<br>:Conventions = &quot;CF-1.5&quot; ;<br>:GDAL = &quot;GDAL 3.6.1, released 2022/12/14&quot; ;<br>:history = &quot;Mon Oct 07 12:05:03 2024: GDAL CreateCopy( lcz_filter_v3.nc, ... )&quot; ;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="part-of-lcz-dataset">Part of LCZ dataset</h1><p>Global tiff is large, and if we only consider a specific area like GBA/Tokyo/Houston.</p><p>Fast and easy Local Climate Zone mapping</p><p>https://lcz-generator.rub.de/</p><ul><li>China, People's Republic of - Hong Kong-Macau-Guangdong Greater Bay Area:<ul><li>https://lcz-generator.rub.de/factsheets/c672ca892c88d1e078a81e7a085913396172f81c/c672ca892c88d1e078a81e7a085913396172f81c_factsheet.html</li></ul></li><li>Japan - Tokyo:<ul><li>https://lcz-generator.rub.de/factsheets/67a3371158ad3ac12d720fde089622c259e8e400/67a3371158ad3ac12d720fde089622c259e8e400_factsheet.html</li></ul></li><li>United States of America - Houston:<ul><li>https://lcz-generator.rub.de/factsheets/037c80744fc1034b8472f594d829c53ce1cccfa7/037c80744fc1034b8472f594d829c53ce1cccfa7_factsheet.html</li></ul></li></ul><p><img src="" /></p><div class="group-image-container"><div class="group-image-row"><div class="group-image-wrap"><img src="https://i.imgur.com/4pyAoGS.jpeg" alt="GBA" /></div></div><div class="group-image-row"><div class="group-image-wrap"><img src="https://i.imgur.com/rO8Cz9d.jpeg" alt="Tokyo" /></div><div class="group-image-wrap"><img src="https://i.imgur.com/b3plh7O.jpeg" alt="Houston" /></div></div></div><figure><img src="https://i.imgur.com/lGIE5ba.png" alt="ncview" /><figcaption>ncview</figcaption></figure><h1 id="references">References</h1><ol type="1"><li>Demuzere, M., Kittner, J., &amp; Bechtel, B. (2021). LCZ Generator: a web application to create Local Climate Zone maps. Frontiers in Environmental Science, 9, 637455.</li><li>Zhao, N., Ma, A., Zhong, Y., Zhao, J., &amp; Cao, L. (2019). Self-training classification framework with spatial-contextual information for local climate zones. Remote Sensing, 11(23), 2828.</li><li>杨俊, 任嘉义, 于文博. 局地气候分区视角下城市气候与人居环境研究进展. 生态学报, 2024, 44(11): 4489-4506.<ol type="1"><li>了解人居环境中的气候问题是主动改善和提升的首要条件。这在传统研究中已有大量成果, 如基于“城-郊”二元框架计算城市热岛强度并探讨城郊热力差异[4—6]；结合土地利用/土地覆被分析城市热力景观时空特征[7—9]；分析长时间序列下极端天气、热浪事件发生频率和持续时间[10—12]；探究空气污染与城市功能区的耦合关系[13—15]；以及定量评价气候变化导致的热风险和生态风险等[16—18]。研究普遍以城市行政边界或人口梯度为基准, 忽视了相似地理单元的空间特性。2012年Stewart和Oke提出将局地气候分区(Local Climate Zones, LCZ)作为城市气候研究的通用框架[19], 填补了传统气候分类在中/微观尺度研究中的局限, 得到广泛运用。</li><li>局地气候分区根据城市形态、地表覆盖、地表结构及材质等差异, 将城市下垫面划分为17个基本区域, 包括10个建筑类型和7个自然类型。每个LCZ都有特定范围的相关气候参数, 不同LCZ类型具有不同的局部气候条件(图 1)。LCZ分类体系提出用两个LCZ之间的温差定义并计算城市热岛强度[19—20], 克服了传统研究中城乡的刻板边界。同时建立了城市气候研究基础框架, 规范了全球城市气候研究范式。目前世界各地研究绘制了丰富的LCZ地图, 本研究将对往期文献中LCZ地图制作数据源、方法和已有LCZ数据集进行全面梳理。</li></ol></li><li>许亘昱, 石玉蓉, &amp; 张宇峰. (2023). 规划控制要素视角下城市热环境的测度与优化——以广州中心城区为例. 热带地理, 43(6), 1070-1082.<ol type="1"><li>城市下垫面类别和土地开发强度的多样性造成了城市内部热岛强度的差异。Stewart等（2012）在充分论证传统城郊二元法研究城市热岛问题的不足后，提出了局地气候分区（Local Climate Zone，下文简称LCZ）体系。LCZ将城市下垫面分为10种建成类型和7种自然类型（图4），以天空角系数、高宽比、建筑密度、不透水表面积占比、透水表面积占比、粗糙元高度、地形粗糙类型、热导纳、反射率和人为热等的区间为属性。LCZ用定量方法区分城市的土地构成，相较于传统规划领域方法—从土地利用功能角度出发的定性分类方法，其能更好地体现功能相同的土地利用类型在地块的建筑密度、容积率和绿地率等方面的差异，且具有分析比较的普适性（Bechtel et al., 2015），以LCZ为基础的城市热岛强度分类已通过经验和模型得到证实（Fenner et al., 2014; Stewart et al., 2014; Leconte et al., 2015）。</li></ol></li></ol>]]></content>
    
    
    <categories>
      
      <category>NWP</category>
      
      <category>WRF</category>
      
      <category>MPAS</category>
      
    </categories>
    
    
    <tags>
      
      <tag>WRF</tag>
      
      <tag>MPAS</tag>
      
      <tag>Urban</tag>
      
      <tag>UCM</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Polar Vortex | 極地渦旋</title>
    <link href="/2024/10/04/Polar-Vortex/"/>
    <url>/2024/10/04/Polar-Vortex/</url>
    
    <content type="html"><![CDATA[<h1 id="極地渦旋">極地渦旋</h1><p>極地渦旋（Polar Vortex；或極地漩渦），是<strong>一種發生於極地的，介於對流層與平流層的中、上部的</strong>，持續性且大規模的氣旋。這種渦旋在冬季極夜的時候最為強大，因為此時的溫度梯度最大；隨後會持續縮減，到夏季極晝前後甚至會消失。</p><ul><li><strong>兩極對流層中層至平流層的低氣壓系統</strong></li></ul><table><thead><tr class="header"><th style="text-align: left;">典型的極地漩渦（2013年11月）</th><th style="text-align: left;">弱勢的極地漩渦（2014年1月5日）</th></tr></thead><tbody><tr class="odd"><td style="text-align: left;"><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/7/76/November2013_polar_vortex_geopotentialheight_mean_Large.jpg/300px-November2013_polar_vortex_geopotentialheight_mean_Large.jpg" /></td><td style="text-align: left;"><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/b/bb/Jan52014_polar_vortex_geopotentialheight_mean_Large.jpg/300px-Jan52014_polar_vortex_geopotentialheight_mean_Large.jpg" /></td></tr></tbody></table><p>極地渦旋（Polar Vortex）是長期存在於<strong>兩極對流層中層至平流層的低氣壓系統</strong>，一般分為數個中心，分佈於不同經度，每個系統直徑不超過1000公里。極地渦旋在冬季增強，在夏季減弱，當極地渦旋增強並向南擴展時，冷空氣便會迅速南下影響中緯度地區。</p><ul><li><strong>在極地渦旋南面是西風帶地區，兩者交界處常常出現高空急流（jet stream），風力特別強勁，風速往往達每小時200公里以上</strong>。</li><li>極地渦旋出現於北極地帶，它是一股股強風，<strong>位於大氣層高處，將極冷的空氣鎖在北極地區</strong>。</li><li>極地渦旋是<strong>空氣極冷的低壓帶，在北極地區上空旋轉</strong>。</li><li>高速氣流的擾動和較暖的空氣入侵，可能會打亂極地渦旋，將北極地區的空氣向南送至中緯度地區。</li></ul><p><img src="https://i.imgur.com/n2Z0yr3.jpeg" /></p><ul><li><strong>極地渦旋：距地表 16-48 公里</strong></li><li><strong>極地急流：距地表 8-15 公里</strong></li></ul><p><img src="https://i.imgur.com/LFYWREb.png" /></p><h2 id="原理">原理</h2><p>From <a href="http://www.metapp.org.tw/index.php/bossweathernews/293-test" class="uri">http://www.metapp.org.tw/index.php/bossweathernews/293-test</a>,</p><p>北極在冷季時，地表的長短波輻射損失的能量遠大於永夜所能吸收的太陽短波輻射，</p><ul><li>地表降溫，再由於混合、擴散使得其上的冷氣團向上發展，但由於空氣較冷、較重會使氣柱收縮，而在中高層大氣呈現凹陷，</li><li>它的特點是<strong>旋轉的冷空氣團可以從對流層中部延伸到平流層，通常在地表以上 10 至 50 公里</strong>（6 至 30 英里）的高度之間, (It is characterized by a rotating mass of cold air that can extend from the middle troposphere into the stratosphere, typically between altitudes of 10 to 50 kilometers (6 to 30 miles) above the surface)</li><li><strong>地面冷重的高氣壓</strong>即所謂「北極氣團」，而其<strong>中高層凹陷的相對低氣壓</strong>，</li></ul><p>近年來被冠以「北極渦旋」。所以它是地表熱力不平衡而被動產生。它是果不是因。</p><p>如果北極變冷，中緯度氣溫不變，兩者之間的溫度對比差異變大，西風的強度增強，即所謂的「噴射氣流」將圍繞北極渦旋(極區)旋轉，所謂「正相北極震盪」成型。此時冷氣團仍盤據在極區，中緯度未受其影響而偏暖。或有以冷氣團因「噴流鎖住」而無法南下，而造成中緯度偏暖來做詮釋，其謬誤處在於噴流是本是溫度對比而產生，且能量僅佔可用位能的一小部份，細繩如何綁住大象。</p><p><strong>輻射不平衡造成地表能量喪失的效應並不僅只在北極，高緯度大的陸塊如亞洲的西伯利亞、蒙古，北美大陸、北歐皆有同樣的效應，在低層大氣形成「極地大陸冷氣團」，在地面因冷重的大氣而呈現高氣壓，氣柱收縮中高層亦有「極地渦旋」伴隨</strong>。當北極氣團與極地大陸冷氣團同時存在或僅有極地大陸冷氣團，且有一定強度時，中高層也會同時有「渦旋」伴隨，西風噴流圍繞而行，呈現噴流減弱，南北風增加的現象，轉變成「負相北極震盪」。</p><p>當強冷氣團南移過程，通過的地區帶來寒流，但比較暖濕環境也使它減弱，最終冷氣團或渦旋都會減弱消失。但是高緯度的能量消失仍會持續進行，但是其後將轉變為正相還是維持負相則是不一定的，還是要看北極或極地冷氣團的發展情況而定，因果關係是很清楚的。本來原已存在的「氣團學說」再配合「大氣動力」的理論，對於冬季的天氣變化已有完整的詮釋，新創的名詞並無高明之處，徒增困擾而已。</p><h2 id="metoffice-what-is-the-polar-vortex"><a href="https://youtu.be/XGPLHwARPSY">Metoffice | What is the Polar Vortex?</a></h2><ul><li>The <strong>polar vortex is a circulation of winds high up in the stratosphere</strong>, up to <strong>30 miles (50 km) above the earth</strong>. It is present in winter, and is not a new phenomenon, scientists have known about it for many years.</li><li>The winds regularly <strong>exceed 155 miles per hour (250 km per hour)</strong> – the strength of the winds in the strongest hurricanes (known as Category 5).</li><li>A strong polar vortex favours a <strong>strong jet stream</strong>. The jet stream is a fast moving ribbon of air around <strong>5 to 7 miles (8 to 11km) above the earth</strong> that drives weather systems from the Atlantic towards the UK.</li></ul><iframe width="560" height="315" src="https://www.youtube.com/embed/XGPLHwARPSY?si=yd2MGyNa0GhkBkCs" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe><h1 id="北極濤動-arctic-oscillation-ao">北極濤動 Arctic Oscillation (AO)</h1><ul><li><a href="https://www.weather.gov.hk/tc/whatsnew/d4_whatsnew_20160226.htm">香港天文台 |『氣象冷知識』：北極濤動</a></li></ul><iframe width="560" height="315" src="https://www.youtube.com/embed/qQnb9LNs2GE?si=OO2XSn5VoD4Jmasm" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe><p><a href="https://www.weather.gov.hk/tc/climate_change/ao.htm">北極濤動（AO）</a> (又稱北極震盪) 是指北半球中緯度地區（約北緯45度）與北極地區氣壓形勢差別的變化。它是一個代表北極地區大氣環流的重要氣候指數，可分為正位相和負位相。</p><p>北極通常受低氣壓系統支配，而高氣壓系統則位於中緯度地區。</p><ul><li>當AO處於正位相時，<strong>這些系統的氣壓差較正常強</strong>，限制了極區冷空氣向南擴展；</li><li>當AO處於負位相時，<strong>這些系統的氣壓差較正常弱</strong>，冷空氣較易向南侵襲。</li></ul><p>有關北極濤動的最新情況可參考： - <a href="https://www.cpc.ncep.noaa.gov/products/precip/CWlink/daily_ao_index/ao.shtml" class="uri">https://www.cpc.ncep.noaa.gov/products/precip/CWlink/daily_ao_index/ao.shtml</a></p><figure><img src="https://www.cpc.ncep.noaa.gov/products/precip/CWlink/daily_ao_index/ao.gefs.fcst.png" alt="The daily AO index and its forecasts using GFS and Ensemble mean forecast data are shown for the previous 120 days as indicated. Each daily value has been standardized by the standard deviation of the monthly AO index from 1979-2000." /><figcaption>The daily AO index and its forecasts using GFS and Ensemble mean forecast data are shown for the previous 120 days as indicated. Each daily value has been standardized by the standard deviation of the monthly AO index from 1979-2000.</figcaption></figure><h1 id="分析和文獻綜述">分析和文獻綜述</h1><h2 id="香港天文台-2014年3月-北半球極地渦旋的扭曲"><a href="https://www.hko.gov.hk/tc/education/articles/ele_140304.htm">香港天文台 | 2014年3月 北半球極地渦旋的扭曲</a></h2><ul><li>在正常情況下，由於北半球冬天極地和中高緯度地區地面出現較大的溫差，<strong>地面氣溫緊密梯度促使高空急流的產生。急流由西向東環繞地球高速流動，而在北極附近受高空急流所包圍的渦旋通常被稱為極地渦旋</strong>。若急流的速度較高，急流會隨較平直的路徑流動(圖一)，地面上的冷空氣會集中在極地或較高緯度地區，較少機會南下。</li><li>但近年主要因為北極海冰融化，以致極地吸收更多太陽輻射，北極地區氣溫上升的速度較中高緯度的為高，這使地面氣溫梯度減弱，高空急流的流速亦較為減慢，其流動方向便變得彎彎曲曲(圖二)，隨之讓極地渦旋變得較為扭曲。這情況就如一道洶湧的河川流到平原地區時，河水流速減慢，河道便變得彎曲。高空急流迂迴的南北流動，使部分地區持續受冷空氣南下所影響，而另一些地區則受暖空氣北上而出現變暖現象，整體來說促使了地域上溫度的分佈趨向互異和極端。</li></ul><table><thead><tr class="header"><th style="text-align: left;">正常情況</th><th style="text-align: left;">極地渦旋變得較為扭曲</th></tr></thead><tbody><tr class="odd"><td style="text-align: left;"><img src="https://i.imgur.com/nHubAl9.png" /></td><td style="text-align: left;"><img src="https://i.imgur.com/jzQOoXg.png" /></td></tr></tbody></table><h2 id="澳門氣象學會-2022-12-11-什麼是極地渦旋"><a href="https://www.mmets.org/?p=1735">澳門氣象學會 | 2022-12-11 什麼是「極地渦旋」?</a></h2><p>冬季到來的時候，北極沒有太陽照射，變得越來越寒冷，冷空氣漸漸堆積並“逆時針”旋轉起來，稱為「極地渦旋」。</p><figure><img src="https://i.imgur.com/lyvOTHn.jpeg" alt="極地渦旋, 北極濤動" /><figcaption>極地渦旋, 北極濤動</figcaption></figure><ul><li>冬季因冷空氣較多，「極地渦旋」範圍比夏天大很多。它在極區對流層及平流層的中、上層形成一股很強的圍繞整個極區的環流，由於環流是自西向東旋轉，而且風速可達每小時 160 公里，一般稱之為西風噴流，能鎖住極地冷空氣，不讓冷空氣輕易跑到中、低緯度地區，這情況氣象學上稱為“正”北極濤動(上左圖)。</li><li>相反，“負”北極濤動則表示，極地渦旋偏弱，圍繞極區的西風噴流減慢，變得曲曲折折，無法鎖住冷空氣，大家可想像成冰箱門沒關好，極區冷空氣順勢而下，跑到中、低緯度地區(上右圖)。</li></ul><p>立即來個簡單實戰，這是 2022 年 12 月 15 日早上 8 時的ECMWF預報圖，<strong>等值線是500hPa重力位高度，因高空沒有地面的摩擦力，風幾乎平行等值線</strong>，因此大家見到曲曲折折的粗紅線，代表“負”北極濤動，西風噴流速度慢，北極大冰箱的門已經打門。至於冷空氣的流向，則可以看上圖的顏色(850 hPa 溫度)，藍、紫色代表非常寒冷的空氣，圖中所見，這次極地冷空氣主要流向了東亞及歐洲。</p><figure><img src="https://i.imgur.com/9S3O3ER.jpeg" alt="2022 年 12 月 15 日早上 8 時的ECMWF預報圖，等值線是500hPa重力位高度" /><figcaption>2022 年 12 月 15 日早上 8 時的ECMWF預報圖，等值線是500hPa重力位高度</figcaption></figure><h2 id="香港天文台-2014年1月29日-溫暖的北極寒冷的大陸"><a href="https://www.hko.gov.hk/tc/blog/00000155.htm">香港天文台 | 2014年1月29日 溫暖的北極．寒冷的大陸</a></h2><ul><li>氣候變暖使北極海冰和陸地雪蓋減少，降低了地球的反射率。本來海冰和雪蓋的反射率遠較海洋和陸地高，能有效地把太陽光反射回太空，但海冰和雪蓋減少會暴露更多的海洋和陸地表面，增加了地球吸收太陽熱量的能力，這些額外的熱力令海水及陸地進一步升溫而促使更多的海冰及雪蓋融化，形成惡性循環。</li><li><strong>北極地區變暖的速度也因此較北半球其它地方快，極地與熱帶地區之間的溫差減少，導致北半球高空西風氣流減慢，容易出現蜿蜒起伏的波動</strong>。</li><li>波動西側的偏北氣流把極地冷空氣往南輸送，東側的偏南氣流則把熱帶區域的暖空氣推向更北的地方。</li><li>高空西風氣流減慢也會容易引發大氣阻塞形勢，出現移動緩慢的反氣旋，天氣系統在時間和空間上的演變會變得停滯不前。視乎相對於阻塞形勢的位置而定，某些地方可能長時間天晴，但另一些地方則可能被困在風暴的走道軌跡上，經歷一段陰雨的日子。假如阻塞形勢發生在冬季，受影響地區的異常寒冷或溫暖天氣可能持續數天至數週。近年印象猶新的例子是 2008 年年初影響中國大部分地區的寒潮，當時在阻塞形勢的驅動下西伯利亞的冷空氣長時間不斷向南擴散至香港。</li></ul><h2 id="香港天文台-2019年2月27日-全球變暖下的極地渦旋"><a href="https://www.hko.gov.hk/tc/blog/00000219.htm">香港天文台 | 2019年2月27日 全球變暖下的「極地渦旋」</a></h2><ul><li>極地渦旋是大氣高層的緊密旋轉氣流，它把冷空氣限制在北極地區。假如極地渦旋偏弱，西風急流會減慢，容易出現較多波動，這有利北極氣團南侵並為中緯度地區帶來嚴寒天氣。</li><li>近期一項研究發現在全球變暖的背景下，過去四十年極地渦旋的偏弱狀態越趨持續。科學家認為由於北極海冰的縮減，暴露出來的海洋釋放更多熱量到大氣中，因而影響了大氣環流。透過「氣候—反射率」的回饋機制，北極海冰的縮減亦助長北極的暖化：較少海冰 -&gt; 較深色的海洋暴露出來 -&gt; 吸收更多太陽熱力 -&gt; 海冰進一步減少。</li><li>目前，北極的暖化速度是這連結會以新視窗打開。全球平均的兩倍。</li><li>這個暖化速度的差異使極區與赤道之間的溫差減少，繼而減弱了極地渦旋和西風急流，使西風急流較為波動，有利北極冷空氣南侵。</li></ul><h2 id="中国气象报社-2023年12月21日-全球变暖了为何秋冬冷空气还那么强"><a href="https://www.cma.gov.cn/2011xwzx/2011xqxxw/2011xqxyw/202312/t20231221_5965542.html">中国气象报社 | 2023年12月21日 全球变暖了，为何秋冬冷空气还那么强？</a></h2><p>不是說全球暖化了嗎？為什麼秋冬的冷空氣還那麼強？</p><p>這與極地渦旋（以下簡稱「極渦」）有關。赤道與極地之間存在著巨大溫差，這種差異促使極圈外圍形成了一圈強勁的西風，稱為西風急流。西風急流就像「圍欄」一樣，約束極地的冷空氣，穩定的極渦能夠被強大的西風急流限制在北極地區。在全球暖化背景下，北極地區增溫速度是全球的2—3倍。北極地區增溫，其與中低緯度間的氣溫差減弱，難以維持強大的西風急流，極渦內的冷空氣變得“躁動不安”，更容易分裂南下。北極來的冷空氣，其溫度遠低於人們所處的中低緯度地區，因此導致多次寒潮天氣。</p><p>此外，根據歷史資料統計分析，厄爾尼諾背景下我國冬季氣溫整體偏暖，但階段性冷空氣活動較為頻繁，也就是說冷暖起伏比較明顯。</p><p>但是，冷空氣過程強度不僅受厄爾尼諾影響，也與極渦的分裂和中高緯西風帶的擾動有很大關係。今年12月中旬以來，極渦分裂為雙中心，分別位於格陵蘭島和西伯利亞上空。伴隨著歐亞大陸上空西風帶的劇烈扭曲，西伯利亞高壓異常增強，我國大部地區由前期盛行偏南風轉為偏北風，冷空氣南下，導致氣溫驟降。</p><p>另一方面，厄爾尼諾激發的菲律賓異常反氣旋將熱帶水汽向我國陸地輸送，來自中高緯的寒潮過程配合來自低緯的豐沛水汽條件，引起了我國中東部較大範圍的降雪過程。此外，地面積雪造成的晴空反照率增加也使得後期回溫較慢。</p><h2 id="年2021年歐亞大陸寒潮"><a href="https://zh.wikipedia.org/wiki/2020%E5%B9%B4%E2%80%942021%E5%B9%B4%E6%AD%90%E4%BA%9E%E5%A4%A7%E9%99%B8%E5%AF%92%E6%BD%AE">2020年－2021年歐亞大陸寒潮</a></h2><p>中國氣象局解釋是因北極高空急流減弱，挾帶大量極地冷氣團的極地渦旋（Polar vortex）南下導致的。在全球變暖的背景下，極地漩渦等天氣系統不穩定，加劇了極端天氣的可能性，極地漩渦本來會將冷空氣鎖定於高緯度地區，由於北極氣溫上升，和高緯度及低緯度的溫差減少，讓極地漩渦的範圍出現改變，冷空氣也隨之南下，觸發嚴重寒潮。</p><p>大家都知道北極冷，它不僅是地球的冷極之一，也是大氣的冷源，那裡聚集了大量冷氣團，導致極地低空形成冷性高壓，高空則形成冷性低壓，這個極地高空的冷性大型渦旋系統，就是極地渦旋，它也是影響我國的冷空氣來源之一。</p><p>在冬季，當極地渦旋四周的高空急流實力強，極地渦旋就老實窩在北極地區上空逆時針轉圈圈，極地以外地區的寒潮、冷空氣就相對不會那麼活躍，那麼這一年就可能是暖冬了；當高空急流減弱，裹挾了大量極地冷氣團的極地渦旋就有了南下的機會，影響北半球的冷空氣就更為​​活躍。</p><p>之前的跨年寒潮和這次凍哭我們的寒潮，之所以這麼冷，一方面是因為兩次寒潮間隔時間不遠，前一波剛凍透了土地，還沒來得及回暖，後一波緊跟而至，基礎氣溫本就低，再降溫，就雪上加霜，冷上加冷了。</p><p>另一方面是因為它們實力強勁，這兩股寒潮都是極地渦旋的部分主體南下，路過西伯利亞地區這個冷空氣「加油站」積蓄了更多能量，讓冷氣團的氣溫更低，降溫能力更強。</p>]]></content>
    
    
    <categories>
      
      <category>Meteorology</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Siberian high | 蒙古西伯利亞高壓</title>
    <link href="/2024/10/04/Siberian-high/"/>
    <url>/2024/10/04/Siberian-high/</url>
    
    <content type="html"><![CDATA[<h1 id="siberian-high-蒙古西伯利亞高壓">Siberian high | 蒙古西伯利亞高壓</h1><p><strong>西伯利亞高壓（Siberian High），又稱蒙古高壓、蒙古冷高壓、西伯利亞反氣旋 冷高壓（Siberian Anticyclone）</strong>，是一種位於歐亞大陸東北區域，發生在<strong>九月到次年四月的半永久性大陸反氣旋</strong>。在夏季，溫暖潮濕的氣流自太平洋流向西伯利亞。而在冬季則正好相反。這種變化是因為海洋和陸地的比熱熔差異，再加上歐亞大陸非常特殊的地理環境而造就的。<strong>從而在東亞和南亞地區形成了地球上範圍最大的季候風氣候。冬季在蒙古、西伯利亞一帶大範圍堆積形成冷高壓，其通常在一月份前後達到極盛</strong>。西伯利亞高壓是四個北半球主要的季節性大氣活動中心之一，勢力強盛可影響整個歐亞大陸，成為北半球覆蓋面積最廣的高壓。</p><ul><li>位於蒙古境內，氣壓值：1036hPa ~ 1050hPa，最強時可達1075hPa</li></ul><figure><img src="https://i.imgur.com/FG2FYYk.png" alt="西伯利亞高壓、蒙古冷高壓" /><figcaption>西伯利亞高壓、蒙古冷高壓</figcaption></figure><ul><li>北半球冬季時，歐亞大陸由於降溫快，在俄羅斯西伯利亞與蒙古一帶形成的高壓帶。</li><li>此高壓帶由於溫度低，又被稱為冷高壓。</li><li>隨著空氣由西伯利亞高氣壓流向海上低氣壓，形成亞洲的冬季季風。</li></ul><figure><img src="https://i.imgur.com/8jGvBCC.jpeg" alt="西伯利亞高壓示意圖、蒙古冷高壓示意圖" /><figcaption>西伯利亞高壓示意圖、蒙古冷高壓示意圖</figcaption></figure><h2 id="亚欧大陆冬季冷空气的策源地">亚欧大陆冬季冷空气的策源地？</h2><ul><li><a href="https://mp.weixin.qq.com/s/QEm7hwk_BACqcOQLx5t5lQ">蒙古和西伯利亚地区，为什么会成为亚欧大陆冬季冷空气的策源地？</a></li></ul><p>氣候可分為許多要素，常見的氣候要素包括氣溫、降水、光照等內容。就氣溫要素而言，世界各地冷熱不同，氣溫的分佈有很大的差異。影響氣溫的因素很多，包括緯度位置、海陸位置、地形海拔、大氣環流、洋流因素、下墊面因素以及人類活動因素等，其中緯度因素是影響氣溫最重要的因素。</p><p><strong>隨著緯度的增加，年平均正午太陽高度角就不斷降低，獲得太陽輻射的能量就減少，全球氣溫整體由赤道往兩極地區遞減</strong>。</p><figure><img src="https://i.imgur.com/us3UXq1.png" alt="隨著緯度的增加，年平均正午太陽高度角就不斷降低，獲得太陽輻射的能量就減少，全球氣溫整體由赤道往兩極地區遞減" /><figcaption>隨著緯度的增加，年平均正午太陽高度角就不斷降低，獲得太陽輻射的能量就減少，全球氣溫整體由赤道往兩極地區遞減</figcaption></figure><p>不過，在北半球最冷的地點並不在緯度最高的北極點，而是在西伯利亞東部的奧伊米亞康，極端最低氣溫達到-71.2℃，被稱為北半球「寒極」。此外，蒙古和西伯利亞地區，也被稱為亞歐大陸冬季冷空氣的策源地，這是為什麼？</p><ul><li>海陸的比熱差異</li></ul><p>我們知道，影響氣溫高低的因素很多，而緯度只是其中的一個因素，北極雖然地處高緯度地區，但是這一區域並不是陸地，而是分佈著北冰洋。在夏季季節，海水能夠儲存較多的熱量，從而到了冬季季節降溫就較慢，這就是由於海陸的比熱差異而產生的。反觀世界上最大的大陸亞歐大陸，由於是陸地比熱較小，夏季升溫快，同樣的冬季時降溫也快。</p><p>因此，到了冬季季節，亞歐大陸內部的氣溫明顯比同緯度的太平洋和大西洋地區低。除了比熱對氣溫的影響之外，地形海拔也起到了一定的影響作用，在對流層大氣中，海拔越高氣溫越低，大約海拔每升高1000米，氣溫就會下降大約6℃，而蒙古和西伯利亞地區的地形單元主要為蒙古高原、中西伯利亞高原和東西伯利亞山地，這些地區海拔相對較高，從而更降低了這一地區的氣溫。亞歐大陸內部大範圍的低溫區域，使得這一地區形成了一個範圍十分巨大的“冷高壓”，也被稱為“亞洲高壓”。</p><p>由於其中心主要位於蒙古和西伯利亞地區，所以也常被稱為“蒙古西伯利亞高壓”，<strong>由於這個高壓的存在，就把副極地低氣壓帶給切斷了，使之只保留在海洋上，位於太平洋上的稱為“阿留申低壓”，而位於大西洋上的稱為“冰島低壓”</strong>。亞洲高壓屬於典型的“極地大陸氣團”，其勢力十分巨大，可以影響到幾乎整個亞歐大陸。我們知道水平方向的空氣始終遵循從高壓流向低壓，因此在冬半年，<strong>近地面空氣就會從氣壓最高的蒙古西伯利亞高壓向四周流出。</strong></p><p>由於該區域往北是北冰洋，冬季氣溫也非常低，兩地間的氣壓差較小，因此往北的氣流並不十分明顯。同時，由於蒙古西伯利亞地區所在的緯度，主要受盛行西風帶控制，所以往西流出的氣流也不十分強大。而從蒙古西伯利亞高壓往東和往南流出的氣流則十分強勁，在地轉偏向力的影響下，在東亞地區形成了西北季風，在南亞和東南亞地區形成了東北季風。而來自蒙古西伯利亞高壓的西北季風就是影響我國冬半年大幅降溫的主要因素，也就是我們熟稱的「冷空氣」。</p><figure><img src="https://i.imgur.com/NxUfgIP.jpeg" alt="一月份海平面等壓線分佈圖" /><figcaption>一月份海平面等壓線分佈圖</figcaption></figure><h1 id="分析和文獻綜述">分析和文獻綜述</h1><h2 id="年1月東亞冷冬的綜觀天氣分析預報"><a href="https://www.science.ntu.edu.tw/fiveyears/newsletter35/Atmos-Yang.php?NumId=354">2018年1月東亞冷冬的綜觀天氣分析預報</a></h2><p>北半球在冬季時，由於陸地與海洋的比熱差異使得陸地上常形成性質較乾冷的大陸型冷高壓型態的氣團。對於東亞地區冬季氣候平均地面天氣型態而言，大陸型冷高壓的中心位置經常位於蒙古或西伯利亞地區，因此被稱之為蒙古高壓或西伯利亞高壓。在氣象分析上<strong>常以1020百帕(hPa)等壓線來界定蒙古高壓的氣團涵蓋範圍</strong>。</p><p>台灣冬季的寒流跟蒙古高壓的強度消長有很大的關係，但實際上影響台灣地區的冷空氣並不是蒙古高壓直接壟罩台灣，而是由蒙古高壓所分離出來的分裂高壓所造成的。我們可以想像成沙丘堆累積到一定的高度會崩落一小部分，在周圍形成小沙丘，而這個周圍的小沙丘就類似分裂高壓。乾冷的分裂高壓自蒙古往東南方向移動，當它分裂高壓的位置越靠近台灣，表示台灣受到冷高壓的影響就越顯著，氣溫通常也會降得更低。當分裂高壓與南方空氣相會時，南方潮濕的空氣遇上乾冷的分裂高壓抬升造成水氣凝結，經常導致台灣東北部降水甚至山區降雪的現象；反之，若南方水氣供應較不充足的情況下，台灣就處於較乾冷的天氣。</p><ul><li>地面天氣分析圖</li></ul><p>圖1: (a)韓國氣象廳(KMA) 2018年2月1日 0000UTC和 (b) 2018年2月3日 1200UTC 的地面天氣分析圖。</p><table><thead><tr class="header"><th style="text-align: left;">2018年2月1日 0000UTC</th><th style="text-align: left;">2018年2月3日 1200UTC</th></tr></thead><tbody><tr class="odd"><td style="text-align: left;"><img src="https://www.science.ntu.edu.tw/fiveyears/newsletter35/Images/1a.png" alt="1a" /></td><td style="text-align: left;"><img src="https://www.science.ntu.edu.tw/fiveyears/newsletter35/Images/1b.png" alt="1b" /></td></tr></tbody></table><p>除了地面天氣圖之外，氣象學家也會分析中高層等壓面上的高空天氣圖(如圖2)。等壓面上可以看到像波動般彎曲的等高線(見圖2的黑色實線)，<strong>由於高空風不受摩擦力的影響，所以高空風平行等高線吹拂</strong>。在高空天氣圖顯示中緯度地區等高線會在不同緯度間南北擺盪，這種波動現象稱之為「西風波」。以北半球的大氣環流而言，西風波高度場較高的波峰處稱作「脊」，高度場較低的波谷處稱作「槽」。槽前不穩定的大氣環境將會帶動地面的溫帶氣旋移動，槽後穩定的大氣環境則可以帶動地面的高壓氣團移動。因此在中緯度地區地面天氣圖中分裂高壓的移動，主要受到高空西風波動的牽引，因此高空西風帶中槽脊線的位置和移動對於台灣冬季的綜觀尺度(Synoptic Scale)天氣預報有著顯著的影響。2018年一月底至二月中旬一波接著一波不停歇的低溫寒流，<strong>與北太平洋白令海高空出現阻塞高壓有關(圖2)。這段期間西風偏弱，使得阻塞高壓和其西方的槽線系統移動減慢，槽後的地面高壓氣團及其挾帶的冷空氣便往低緯度地區移動，造成這次臺灣將近兩星期長時間的寒流現象。</strong></p><ul><li>500hPa 之高度(黑色實線)及溫度(紅色虛線)分析圖</li></ul><p>圖2: (a)韓國氣象廳(KMA) 2018年2月1日 0000UTC和 (b) 2018年2月3日 1200UTC 500hPa 之高度(黑色實線)及溫度(紅色虛線)分析圖，阻塞高壓位在白令海北邊。</p><table><thead><tr class="header"><th style="text-align: left;">2018年2月1日 0000UTC</th><th style="text-align: left;">2018年2月3日 1200UTC</th></tr></thead><tbody><tr class="odd"><td style="text-align: left;"><img src="https://www.science.ntu.edu.tw/fiveyears/newsletter35/Images/2a.png" alt="1a" /></td><td style="text-align: left;"><img src="https://www.science.ntu.edu.tw/fiveyears/newsletter35/Images/2b.png" alt="1b" /></td></tr></tbody></table><h2 id="秋-冬转换时期西伯利亚高压建立气候态和年际变化机理研究"><a href="https://iap.cas.cn/gb/xwdt/kyjz/202407/t20240709_7214328.html">2024 | 秋-冬转换时期西伯利亚高压建立气候态和年际变化机理研究</a></h2><p>东亚冬季风是全球最强的冬季风，也是北半球冬季北极冷空气向南运输的最主要通道。我国地处东亚季风区，显著地受到东亚冬季风的影响。西伯利亚高压是东亚冬季风环流系统的重要成员，探究西伯利亚高压对理解东亚冬季风和我国冬季天气气候至关重要。</p><p>西伯利亚高压又称“蒙古高压”，是北半球冬季位于欧亚大陆上的半永久性高压中心。存在显著的年循环特征：在秋季建立，冬季盛行（图1）。目前，较多的研究集中于分析西伯利亚高压在冬季盛期的变化，较少关注其在秋季的建立；而探究西伯利亚高压的建立对于理解东亚冬季风环流的建立和我国冬季次季节时间尺度的预报具有重要意义。</p><p>1. 客观定义“秋-冬转换时期西伯利亚高压建立”</p><figure><img src="https://iap.cas.cn/gb/xwdt/kyjz/202407/W020240709346896451892_ORIGIN.jpg" alt="欧亚大陆气候态海平面气压的逐月演变。" /><figcaption>欧亚大陆气候态海平面气压的逐月演变。</figcaption></figure><p>2. 西伯利亚高压建立的气候态特征和机理分析</p><figure><img src="https://iap.cas.cn/gb/xwdt/kyjz/202407/W020240709346896802817_ORIGIN.png" alt="西伯利亚高压建立气候态的热动力特征和机理示意图" /><figcaption>西伯利亚高压建立气候态的热动力特征和机理示意图</figcaption></figure><p>3. 西伯利亚高压建立年际变化的机理分析</p><figure><img src="https://iap.cas.cn/gb/xwdt/kyjz/202407/W020240709346897199095_ORIGIN.jpg" alt="西伯利亚高压建立偏早年的环流特征和机理示意图（偏晚年相反" /><figcaption>西伯利亚高压建立偏早年的环流特征和机理示意图（偏晚年相反</figcaption></figure><h1 id="references">References</h1><ol type="1"><li>侯亚红,杨修群,李刚.冬季西伯利亚高压变化特征及其与中国气温的关系[J].气象科技,2007,35(5):646~650</li><li><a href="https://www.cwa.gov.tw/Data/climate/Knowledge/pdf/201101-1.pdf">中央氣象局 | 2011-01 寒流與凍雨</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>Meteorology</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Subtropical high | 副熱帶高壓</title>
    <link href="/2024/10/03/Subtropical-high/"/>
    <url>/2024/10/03/Subtropical-high/</url>
    
    <content type="html"><![CDATA[<h1 id="副熱帶高壓">副熱帶高壓</h1><p>亞熱帶高壓（Subtropical high，又稱亞熱帶高氣壓、副熱帶高壓、副熱帶高氣壓），<strong>其脊線稱為副熱帶高壓脊</strong>，氣象學名詞，是指活躍於亞熱帶地區的高壓脊，分佈於南北緯30°左右，是一股經常存在但位置不固定的溫暖氣團。它的位置以及內裏氣流的流向可以影響到熱帶氣旋的生成和走向。</p><p>為動力成因，地球在赤道附近接收的熱輻射最大，導致出現沿熱帶輻合帶的大量對流。這裏的氣團上升然後發散，受地轉偏向力影響，分別向北和南兩個方向遠離赤道。隨着空氣向赤道兩側的中緯度地區移動，它會冷卻下沉並形成下沉氣流。這在兩個半球的30度平行線附近產生了一個高壓脊。下沉的空氣再次發散，一些空氣返回赤道，形成了<strong>哈德來環流(Hadley cell)</strong>。</p><p><strong>太陽輻射和地轉偏向力是最主要的原因。</strong>赤道地區的太陽輻射比較強烈，該區的空氣會上升，到了高空後就會向極地方向流動。而地轉偏向力使得氣流不斷發生偏移，隨著緯度的升高，地轉偏向力就越大，致使在副熱帶地區（北緯30度附近），氣流基本變成了自西向東流動，並對後續空氣進行阻礙。這一阻礙使得其他上空空氣聚集並且被迫下沉，於是便產生了副熱帶高壓。</p><p><strong>西北太平洋副高是常年存在的永久性暖性深厚系統（它從低到高都是高壓，因而氣象上稱之為深厚系統）</strong>，其強度和位置隨著季節產生變化。由於副高本身是個暖性高壓，加上其盛行的下沉氣流增溫效應，<strong>中心地帶（稱為脊線）</strong> 天氣基本格調是晴熱乾燥的，因此副高所在位置的天氣高溫少雨，如果副高穩定控制一個地區，這裏就非常容易出現乾旱和高溫天氣。</p><figure><img src="https://upload.wikimedia.org/wikipedia/commons/2/21/%E5%A4%A7%E6%B0%A3%E7%92%B0%E6%B5%81.png" alt="哈德來環流(Hadley cell)" /><figcaption>哈德來環流(Hadley cell)</figcaption></figure><p>副熱帶高壓影響下的氣候一般是高溫，且層結穩定，對流很不旺盛，所以降水較少。副熱帶高壓的西部層結較為不穩定，東部相對穩定。所以副熱帶高壓西部降水稍多，東部降水比較少。由於太陽輻射和地球自轉產生的地轉偏向力，南、北半球的副熱帶地區均存在一條高壓帶。又因為海陸分佈的影響，高壓帶分裂成若干高壓單體。</p><p>說到副熱帶高壓，有一個概念不得不提──那就是588線。實際預報業務中表徵副高活動的方法主要有兩種，一種是副高的脊線（副高內部東西風的分界線），而500hPa等壓面上588位勢什米這條等高線卻是預報員最常用、最關注的一條線，因為它雖然看不見、摸不著，卻能表徵副高的強度和位置變化，對我國的天氣影響巨大。</p><p>588線是預報員在高空500百帕等壓面上（約5500公尺高空）繪製的一條等位勢高度線。這條等值線圍起來的區域就是預報員常常提到的氣象名詞「副熱帶高壓」。它向西向北擴展，代表副高向西向北推移，它包含的範圍擴大時，表示副高強度增強等等。</p><h2 id="副高脊線控制">副高脊線控制</h2><p>在副高脊線控制的地區，往往以晴朗少雲的高溫天氣為主，如果副高強盛，則該地區還會出現乾旱災害。</p><ul><li>副高脊線的北側與西風帶鋒區相鄰，西風帶系統攜帶的冷空氣，與副高外圍引導輸送的水汽匯合，容易產生氣旋和鋒面活動，從而形成強降水。</li><li>副高脊線南側為東風氣流，沒有氣旋發展時，天氣晴好，但當有東風波和颱風等熱帶天氣系統活動時，則會出現雷暴大風、強降水等惡劣天氣。</li></ul><figure><img src="https://i.imgur.com/WA9G4fo.png" alt="副高脊線的南北側" /><figcaption>副高脊線的南北側</figcaption></figure><figure><img src="https://i.imgur.com/qso2WKa.png" alt="副高脊線" /><figcaption>副高脊線</figcaption></figure><ul><li><a href="https://www.hko.gov.hk/tc/whatsnew/d4_whatsnew_20160701.htm">香港天文台 |『氣象冷知識』：副熱帶高壓脊</a></li><li><a href="https://www.cwa.gov.tw/V8/C/C/Taiwan/taiwan_5_3.html">中華民國交通部中央氣象署 | 太平洋高壓</a><ul><li>比較近幾十年太平洋高壓於夏季(6月至8月)的強度變化(如圖)，可發現早期在1950至1970年代最西只到達東經135度左右，但近年來太平洋高壓有越來越往西延伸的趨勢，西伸的位置已覆蓋至臺灣上空，近10年西伸位置甚至接近中國華南，副高強度增強使得近年來夏季平均溫度偏高，極端高溫日數也有偏多的趨勢。</li></ul></li></ul><figure><img src="https://www.cwa.gov.tw/V8/C/K/Encyclopedia/climate/imgs/pacific_5_3_2.png" alt="夏季500百帕重力位高度場5870線的平均位置(代表太平洋高壓勢力範圍)，不同的數字代表不同的年代(10年)平均" /><figcaption>夏季500百帕重力位高度場5870線的平均位置(代表太平洋高壓勢力範圍)，不同的數字代表不同的年代(10年)平均</figcaption></figure><h1 id="颱風-熱帶氣旋-副熱帶高壓">颱風 熱帶氣旋 副熱帶高壓</h1><p>副高也是引導熱帶氣旋移動的主要天氣系統之一</p><ul><li><a href="https://www.hko.gov.hk/tc/%E5%A4%A9%E6%96%87%E5%8F%B0%E7%B6%B2%E8%AA%8C/106962/%E5%90%91%E6%9D%B1%E8%B5%B0%E7%9A%84%E3%80%8C%E7%9B%A7%E7%A2%A7%E3%80%8D">香港天文台 | 2022年5月11日 向東走的「盧碧」</a></li></ul><h1 id="中國降水帶的南北移動與副高的季節活動密切相關">中國降水帶的南北移動與副高的季節活動密切相關</h1><p>中國降水帶的南北移動與副高的季節活動密切相關：從每年3、4月份開始，我國陸續出現華南前汛期（4月至6月）、江南-長江中下游-江淮梅雨季節（6月至7月）、華北東北雨季（7月至8月）等</p><p>忙碌了整個夏季後，副高通常會在9月啟程回到西北太平洋養精蓄銳，等待來年再「衝業績」。但退場時，副高還會在南方地區停留，帶來「秋老虎」高溫天氣；此時副高位置偏西，冷暖空氣交彙的主戰場轉移到了華西地區，拉開了「華西秋雨」大幕。</p><p>在這幾個月裡，副高聯手夏季風為我國大部帶來豐沛的雨水、充足的陽光和適宜的氣溫，人們應季而作、應季而收，用勤勞和智慧打造了魚米之鄉、中原糧倉、北大倉… <img src="https://i.imgur.com/EexaFHc.gif" alt="中國降水帶的南北移動與副高的季節活動密切相關" /></p><figure><img src="https://i.imgur.com/stm6qRa.jpeg" alt="中國降水帶的南北移動與副高的季節活動密切相關" /><figcaption>中國降水帶的南北移動與副高的季節活動密切相關</figcaption></figure><p>捉摸不透的雨帶</p><p>副高西北側盛行偏南和西南暖濕氣流，是低層暖濕空氣輻合上升運動區，容易出現雷陣雨天氣，尤其北側是西風帶，經常帶來北方較冷的空氣，與暖空氣結合更容易形成激烈的天氣。</p><p>西北太平洋副高的強弱及位置，與我國中東部地區的天氣氣候以及旱澇等關係極其密切，決定了我國中東部地區的雨帶分佈。</p><figure><img src="https://i.imgur.com/wdGlty9.jpeg" alt="捉摸不透的雨帶" /><figcaption>捉摸不透的雨帶</figcaption></figure><h1 id="酷熱-降雨案例">酷熱, 降雨案例</h1><ul><li><a href="https://www.hko.gov.hk/tc/%E5%A4%A9%E6%B0%A3%E9%9A%A8%E7%AD%86/108835/%E3%80%8C%E7%86%B1%E3%80%8D%E9%AC%A7%E7%9A%84%E5%8D%97%E6%B5%B7">香港天文台 | 2024年7月11日「熱」鬧的南海</a><ul><li>受副熱帶高壓脊影響，過去一兩星期本港天氣持續酷熱，天文台在7月1日發出酷熱天氣警告至今已生效超過10日。最新預報顯示，副熱帶高壓脊南側的廣闊低壓槽在週末及下週將逐漸變得活躍，而低壓槽上亦可能有低壓區形成，甚至發展為熱帶氣旋。</li><li>(上) 衛星圖像可見南海中南部及菲律賓以東海域有兩組較明顯的對流雲團；</li><li>(下) 副熱帶高壓脊會在下週初向西伸展。</li></ul></li></ul><figure><img src="https://www.hko.gov.hk/tc/forecaster_blog/images/potentail_TC_pic1_v2.png" alt="(上) 衛星圖像可見南海中南部及菲律賓以東海域有兩組較明顯的對流雲團； (下) 副熱帶高壓脊會在下週初向西伸展。" /><figcaption>(上) 衛星圖像可見南海中南部及菲律賓以東海域有兩組較明顯的對流雲團； (下) 副熱帶高壓脊會在下週初向西伸展。</figcaption></figure><ul><li><a href="https://news.dayoo.com/society/202407/08/140000_54686673.htm">中国天气网 | 2024-07-08 副热带高压位置移动，全国天气将有这些变化</a><ul><li>今天（8日），冷、暖气流在四川盆地交汇形成了西南涡、在河南至苏皖北部的交汇形成了切变线。因此这一线还是强降雨重心，并且多伴随雷暴大风等强对流天气。</li></ul></li></ul><figure><img src="https://i.imgur.com/QYigRdk.jpeg" alt="2024-07-08 强降雨" /><figcaption>2024-07-08 强降雨</figcaption></figure><figure><img src="https://dayooimg.dayoo.com/Society/202407/08/54686673_bc0b3f49-404f-4fa6-b8b3-f7747104a1ae.gif" alt="2024-07-08 强降雨 FY-4B" /><figcaption>2024-07-08 强降雨 FY-4B</figcaption></figure><ul><li><a href="https://news.weather.com.cn/2024/06/3787477.shtml">中国天气网 | 2024-06-20 “教科书”级的梅雨形势即将出现，新一轮暴雨大暴雨最猛烈时段来了</a><ul><li>今年的梅雨开场即不同凡响。昨天，安徽芜湖、铜陵、宣城、黄山，浙江杭州、嘉兴，江西上饶、宜春，湖南长沙、常德、怀化等地局地均出现大暴雨（100～265毫米）。</li><li>今天夜间开始，随着北方冷涡引导冷空气南下与暖湿气流结合，同时副热带高压西伸北抬，低层急流加强催生出低涡并东移，将在贵州至江汉江淮一带激发出一条呈东北-西南走向的猛烈暴雨大暴雨区域。</li><li>这就是最典型的梅雨形势，接下来几天的情况跟它高度贴合，不过副高位置更偏北，强降雨集中区域也更为集中在江淮、江汉一带。</li></ul></li></ul><figure><img src="https://i.imgur.com/rTf08YT.jpeg" alt="2024-06-20 典型的梅雨形势" /><figcaption>2024-06-20 典型的梅雨形势</figcaption></figure><h1 id="沙漠-和火爐">沙漠 和「火爐」</h1><p>熱帶沙漠氣候：副熱帶高壓常年控制此地區，故其氣候終年高溫乾燥。</p><p>每年平均降雨量低於兩百五十公釐的地區就稱為沙漠，在沙漠裡最缺乏食物和水。大部分的沙漠分佈再南北韓十五度到三十五度間，在這緯度間為『副熱帶高壓帶』，由赤道上升向南北流動的空氣在緯度三十度左右下降，愈降愈轉暖，下降的暖空氣吸收濕氣，使地面乾燥，晴朗無雲加上炎陽高照，這一帶內的背風地區便成為沙漠。</p><figure><img src="https://i.imgur.com/YsjNaIl.jpeg" alt="我國的幾大沙漠和夏季傳統的四大「火爐」圖片來源：中國國家地理" /><figcaption>我國的幾大沙漠和夏季傳統的四大「火爐」圖片來源：中國國家地理</figcaption></figure><figure><img src="https://www.chiding.com.tw/upload/users/image/%E7%86%B1%E5%B8%B6%E3%80%81%E6%BA%AB%E5%B8%B6%E6%B2%99%E6%BC%A0%E5%88%86%E5%B8%83%E5%9C%96.jpg" alt="熱帶沙漠跟溫帶沙漠差在哪裡呢？ 圖片來源：奇鼎事業" /><figcaption>熱帶沙漠跟溫帶沙漠差在哪裡呢？ 圖片來源：奇鼎事業</figcaption></figure><h1 id="references">References</h1><ol type="1"><li><a href="http://tsw.hhups.tp.edu.tw/jyfen/ecology/209.htm">仙人掌的家--沙漠</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>Meteorology</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Google Map</title>
    <link href="/2024/10/02/google-map/"/>
    <url>/2024/10/02/google-map/</url>
    
    <content type="html"><![CDATA[<h1 id="embed-google-maps">Embed Google Maps</h1><p>Easily embed and customize Google Maps on your web page or blog by setting the Google.</p><p>To use the Maps Embed API on your web page, set the URL you've built as the value of an iframe's src attribute. Control the map's size with the iframe's height and width attributes, for example:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">iframe</span></span><br><span class="hljs-tag">  <span class="hljs-attr">width</span>=<span class="hljs-string">&quot;640&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">height</span>=<span class="hljs-string">&quot;480&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">frameborder</span>=<span class="hljs-string">&quot;0&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;border:0&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">referrerpolicy</span>=<span class="hljs-string">&quot;no-referrer-when-downgrade&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://www.google.com/maps/d/embed?mid=1Dmw1V2OwTV5C7KWjAhHR5bEZugqMnCA&amp;ehbc=2E312F&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">allowfullscreen</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">iframe</span>&gt;</span><br></code></pre></td></tr></table></figure><iframe width="640" height="480" frameborder="0" style="border:0" referrerpolicy="no-referrer-when-downgrade" src="https://www.google.com/maps/d/embed?mid=1Dmw1V2OwTV5C7KWjAhHR5bEZugqMnCA&amp;ehbc=2E312F" allowfullscreen></iframe><h1 id="references">References</h1><ol type="1"><li><a href="https://developers.google.com/maps/documentation/embed/embedding-map">Embedding Map</a></li><li><a href="https://www.tsg.com.tw/blog-detail2-173-0-google-maps.htm">Google Map如何嵌入網頁？地圖、路線地圖嵌入教學｜天矽科技客製化網頁設計</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>NWP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NWP</tag>
      
      <tag>WRF</tag>
      
      <tag>MPAS</tag>
      
      <tag>Google</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>WMO Information System 2.0 (WIS 2.0)</title>
    <link href="/2024/10/02/WISv2-WMO/"/>
    <url>/2024/10/02/WISv2-WMO/</url>
    
    <content type="html"><![CDATA[<h1 id="wis-2.0---world-meteorological-organization-wmo">WIS 2.0 - World Meteorological Organization WMO</h1><ul><li><a href="https://community.wmo.int/en/activity-areas/wis/WIS2-overview">WMO | WIS2 Overview</a> (<strong>Recommendation</strong>)</li><li><a href="https://community.wmo.int/en/activity-areas/wis">WMO | WMO Information System (WIS) v2</a></li><li><a href="https://community.wmo.int/en/activity-areas/wis/wis2-implementation">WMO | wis2 implementation</a></li><li><a href="https://community.wmo.int/en/activity-areas/wis/wis2-demonstration-projects">WMO | WIS 2.0 Demonstration Projects</a></li><li><a href="https://www.wis-jma.go.jp/cms/gisc_tokyo/workshop/file/2023/JMA-WS2023_Item04_WIS2.0-Architecture-and-Global-Services.pdf">Japan | Introduction to WIS2 (JMA WIS – Workshop 11.2023)</a> (<strong>Recommendation</strong>)</li><li><a href="https://www.ecmwf.int/en/newsletter/176/computing/wis-20-wmo-data-sharing-21st-century">ECMWF | WIS 2.0: WMO data sharing in the 21st century</a><ul><li><a href="https://www.ecmwf.int/sites/default/files/elibrary/072023/81382-wis-2-0-wmo-data-sharing-in-the-21st-century.pdf">pdf</a></li></ul></li><li><a href="https://www.cma.gov.cn/en/research/news/202305/t20230529_5537194.html">CMA | Congress acclaims WMO Information System as basis for data sharing</a></li></ul><figure><img src="https://community.wmo.int/sites/default/files/inline-images/WIS2_diagram.png" alt="WIS2 Global Services" /><figcaption>WIS2 Global Services</figcaption></figure><p>The WMO Information System 2.0 (WIS 2.0) is the framework for WMO data sharing in the 21st century for all WMO domains and disciplines. It supports the WMO Unified Data policy, the Global Basic Observing Network (GBON) and makes international, regional, and national data sharing simple, effective, and inexpensive. The idea that no Member should be left behind and the objective of lowering the barrier to adoption has been at the core of WIS 2.0 development. These objectives inspire the principles underpinning the WIS 2.0 technical framework, such as adopting open standards and Web technologies to facilitate sharing of increasing variety and volume of real-time data.</p><figure><img src="https://www.ecmwf.int/sites/default/files/styles/wide/public/2023-07/NL176_Giraud_C1-Figure-1.jpg?itok=wCpKEBKG" alt="In the WIS 2.0 Pilot phase, a number of Centres are operating one service. This map shows the situation in May 2023. (Image source: ECMWF)" /><figcaption>In the WIS 2.0 Pilot phase, a number of Centres are operating one service. This map shows the situation in May 2023. (Image source: ECMWF)</figcaption></figure><ul><li>WMO Information System 2.0(WIS 2.0), which is the framework for Earth Systems (meteorological, hydrological, climate and ocean) data sharing in the 21st century. It is based on the principle that no Member should be left behind.</li><li>The <strong>WIS 2.0 pilot phase started in the December 2022 and is scheduled for completion by the end of 2023.</strong> WIS 2.0 supports theWMO Unified Data policy, theGlobal Basic Observing Network (GBON)and makes international, regional, and national data sharing simple, effective, and inexpensive.</li><li>Training and capacity-building workshops are accompanying the rollout of WIS 2.0. Its new data-sharing infrastructure will <strong>gradually replace the Global Telecommunication System (GTS)</strong>.</li><li>The users of WIS 2.0 will be able to access data in real-time by subscribing to a Global Broker and receiving notifications when new data are available for download from a Global Cache or from the data provider. They will also be able to access data directly through Web APIs (application programming interfaces), connecting their software (or their browser) and processing or visualising data of their interest.</li><li>WMO has developed the <strong>open-source software “WIS2 in a box”</strong> to support Least Developed Countries and Small Island Developing States in implementing WIS 2.0.</li></ul><h1 id="wis-2.0-in-a-box">WIS 2.0 in a box</h1><p><a href="https://community.wmo.int/en/wis2box">WMO | WMO INFORMATION SYSTEM (WIS) 2.0 IN A BOX</a></p><p>The WIS2-in-a-box project was started in November 2021 to provide a system to share data using the WIS2 framework.</p><p>The WIS2box-software is implemented such as to offer the flexibility of being deployed both on private/public cloud or on-premises systems. The main features are:</p><ul><li>based on existing open-source software widely used in the operations of some WMO Members.</li><li>allows Members to share data internationally and nationally using message queuing protocols (MQP) and Web services in compliance with WIS2 technical regulations</li><li>provides Web APIs complying with Open Geospatial Consortium (OGC) standards, making access to data extremely easy from all common languages (Python, R, ...) and many open-source and proprietary programs (Excel).</li></ul><p>Demonstration instances of WIS2-in-a-box can be viewed at <a href="https://demo.wis2box.wis.wmo.int" class="uri">https://demo.wis2box.wis.wmo.int</a>.</p><h2 id="hosting-your-own-wis2-in-a-box">Hosting your own WIS2-in-a-box</h2><ul><li>The WIS2-in-box user guide, detailing how to setup your own WIS2 box, is available here: <a href="https://docs.wis2box.wis.wmo.int" class="uri">https://docs.wis2box.wis.wmo.int</a></li></ul><h2 id="example">Example</h2><p>WIS2 in a box is a reference implementation of a WMO WIS2 Node</p><ul><li>Many countries<ul><li><a href="https://demo.wis2box.wis.wmo.int/" class="uri">https://demo.wis2box.wis.wmo.int/</a></li></ul></li><li>CMA<ul><li><a href="https://wis2node.wis.cma.cn/" class="uri">https://wis2node.wis.cma.cn/</a></li></ul></li><li>Republic of Korea<ul><li><a href="https://wis2box.kma.go.kr/" class="uri">https://wis2box.kma.go.kr/</a></li></ul></li><li>Poland<ul><li><a href="https://wis2-pilot.imgw.pl/" class="uri">https://wis2-pilot.imgw.pl/</a></li></ul></li></ul><h1 id="hko-cma-wis-2.0">HKO-CMA-WIS 2.0</h1><ul><li><a href="https://www.hko.gov.hk/en/education/weather/data-and-technology/00704-Meteorological-information-sharing-in-the-21st-century.html">HKO | Meteorological Information Sharing in the 21st Century (December 2023)</a></li></ul><p>The Hong Kong Observatory (HKO) has recently <strong>set up a WIS 2.0 system on a public cloud and interfaced</strong> with the WIS 2.0 system operated by the China Meteorological Administration (CMA). Collaboration and partnership with CMA to develop and implement WIS 2.0 was underway.</p><ul><li>A conceptual diagram of information publish and subscribe under the framework of WIS 2.0.</li></ul><figure><img src="https://www.hko.gov.hk/en/education/weather/data-and-technology/images/703_fig1_data_exchange_e.png" alt="A conceptual diagram of information publish and subscribe under the framework of WIS 2.0" /><figcaption>A conceptual diagram of information publish and subscribe under the framework of WIS 2.0</figcaption></figure><figure><img src="https://www.hko.gov.hk/tc/education/weather/data-and-technology/images/703_fig1_data_exchange_c.png" alt="WIS 2.0框架下信息發布和訂閱概念圖" /><figcaption>WIS 2.0框架下信息發布和訂閱概念圖</figcaption></figure><h1 id="building-the-wis-2.0-global-weather-cache-on-aws">Building the WIS 2.0 global weather cache on AWS</h1><ul><li><a href="https://aws.amazon.com/blogs/publicsector/building-the-wis-2-0-global-weather-cache-on-aws/">Building the WIS 2.0 global weather cache on AWS</a></li></ul><p>The World Meteorological Organization (WMO) wants to build and modernize a global weather framework with WMO Information Systems (WIS) 2.0 to enable and democratize unified access to critical, up-to-date weather data across the world. Currently, lack of observations, easy access to data, computing power, human and capital resources, capacity, and budget hinders accurate and timely forecasts</p><figure><img src="https://d2908q01vomqb2.cloudfront.net/9e6a55b6b4563e652a23be9d623ca5055c356940/2024/06/24/wis2.0_header.png" alt="Building the WIS 2.0 global weather cache on AWS" /><figcaption>Building the WIS 2.0 global weather cache on AWS</figcaption></figure><p>WIS 2.0 data viewed in the WIS 2.0 in a box application. The map below shows US weather data observation locations in a map along with an observation location’s weather data.</p><figure><img src="https://d2908q01vomqb2.cloudfront.net/9e6a55b6b4563e652a23be9d623ca5055c356940/2024/06/24/wis2.0_figure2.png" alt="The map shows US weather data observation locations in a map along with an observation location’s weather data" /><figcaption>The map shows US weather data observation locations in a map along with an observation location’s weather data</figcaption></figure><h1 id="referecnes">Referecnes</h1><ol type="1"><li><a href="http://gisc.wis.cma.cn/wis/portal.pub?LA=en_US">For WIS.v1 CMA-WIS portal (Beijing Global Information System Center)</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>NWP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NWP</tag>
      
      <tag>WRF</tag>
      
      <tag>MPAS</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Pseudo-Global Warming (PGW) - Future Projection</title>
    <link href="/2024/09/30/PSG/"/>
    <url>/2024/09/30/PSG/</url>
    
    <content type="html"><![CDATA[<h1 id="pseudo-global-warming-pgw">Pseudo-Global Warming (PGW)</h1><h2 id="definition-and-concept">Definition and Concept</h2><p>Pseudo-Global Warming (PGW) is a regional climate modeling approach that involves imposing large-scale climate changes derived from global climate models (GCMs) onto a control regional climate simulation. This method contrasts with traditional dynamic downscaling, where regional models are driven directly by GCM outputs. Instead, PGW modifies the boundary conditions of a historical simulation to reflect projected future changes, allowing for a more flexible and computationally efficient analysis of climate impacts</p><p>To perform future projections using the <strong>Pseudo-Global Warming (PGW)</strong> approach, follow these key steps:</p><h2 id="methodology-for-pgw-projections">Methodology for PGW Projections</h2><h3 id="understanding-pgw-concept"><strong>1. Understanding PGW Concept</strong></h3><p>The PGW method involves modifying historical climate simulations by imposing future climate changes directly onto them. This is achieved by adjusting the boundary conditions of a control simulation based on projected changes derived from global climate models (GCMs).</p><h3 id="mathematical-representation"><strong>2. Mathematical Representation</strong></h3><p>The PGW approach can be mathematically expressed as:</p><p><span class="math display">\[\text{PGW} = \text{HIST} + \Delta\]</span></p><p>where:</p><ul><li><strong>HIST</strong> represents the current or historical climate conditions.</li><li><strong>Δ</strong> (Delta) is the perturbation derived from future climate projections,</li></ul><p>calculated as:</p><p><span class="math display">\[\Delta = \text{SCEN} - \text{CTRL}\]</span></p><p>Here, <strong>SCEN</strong> is a future climate scenario, and <strong>CTRL</strong> is the corresponding historical baseline.</p><figure><img src="https://eurec4a.eu/fileadmin/user_upload/eurec4a/Simulations/PGW.jpg" alt="Schematics of the principles of the Pseudo Global Warming (PGW) framework (image from EUREC4A)" /><figcaption>Schematics of the principles of the Pseudo Global Warming (PGW) framework (image from EUREC4A)</figcaption></figure><ul><li>Chow, T. N., Tam, C. Y., Chen, J., &amp; Hu, C. (2024). Effects of Background Synoptic Environment in Controlling South China Sea Tropical Cyclone Intensity and Size Changes in Pseudo–Global Warming Experiments. <a href="https://journals.ametsoc.org/view/journals/clim/37/5/JCLI-D-23-0503.1.xml">Journal of Climate, 37(5), 1811-1832.</a></li><li>Zhao, R., Tam, C. Y., Lee, S. M., &amp; Chen, J. (2024). Attributing extreme precipitation characteristics in South China Pearl River Delta region to anthropogenic influences based on pseudo global warming. <a href="https://agupubs.onlinelibrary.wiley.com/doi/10.1029/2023EA003266">Earth and Space Science, 11(3), e2023EA003266.</a><ul><li>In the second PGW experiment, human‐induced perturbations are computed as the monthly averages of the <strong>30‐year (1986–2005)</strong> mean differences between historical and historicalNat runs of CMIP5 seven‐model ensemblemean.</li><li>The perturbed fields include <strong>SST, air temperature, specific humidity, and horizontal wind components</strong>.</li></ul></li><li>Brogli, R., Heim, C., Mensch, J., Sørland, S. L., &amp; Schär, C. (2023). The pseudo-global-warming (PGW) approach: methodology, software package PGW4ERA5 v1. 1, validation, and sensitivity analyses. <a href="https://gmd.copernicus.org/articles/16/907/2023/">Geoscientific Model Development, 16(3), 907-926.</a><ul><li>Both SCEN and HIST periods must be chosen to be long enough to reduce the effects of internal variability (average of ∼ 30 years).</li><li>After applying Δ to the thermodynamic variables, it is thus essential to restore this balance using an adequate pressure adjustment</li></ul></li><li><a href="https://eurec4a.eu/eurec4a-multi-day-model-intercomparison-project/methodology">Pseudo Global Warming: Methodology</a><ul><li>The perturbation fields Delta are meant to be based on 30-year monthly means of the driving GCM. The required GCM fields include three-dimensional fields of temperature, specific humidity and wind (T, qv, u, v), as well as the geopotential height field (phi) on at least one pressure level. Monthly mean changes of these fields are linearly interpolated to the target date, and then merged with ERA5 information.</li></ul></li></ul><h3 id="data-requirements"><strong>3. Data Requirements</strong></h3><p>To implement PGW, you need:</p><ul><li>Historical climate data (e.g., from reanalysis datasets like ERA5).</li><li>Future climate projections from GCMs, typically focusing on thermodynamic and dynamic variables such as temperature, humidity, wind, and geopotential height.</li></ul><h3 id="simulation-setup"><strong>4. Simulation Setup</strong></h3><ul><li><strong>Select a GCM</strong>: Choose a transient GCM that provides future climate scenarios relevant to your region of interest.</li><li><strong>Derive Δ</strong>: Compute the perturbations (Δ) based on 30-year monthly means from the GCM outputs.</li><li><strong>Modify Boundary Conditions</strong>: Apply Δ to the historical data to create new boundary conditions for your regional climate model (RCM) simulations.</li></ul><h3 id="running-simulations"><strong>5. Running Simulations</strong></h3><ul><li>Execute the RCM with the modified boundary conditions. The PGW approach allows for shorter simulation periods (less than 30 years), which can be beneficial for high-resolution climate projections.</li><li>Ensure that interannual variability is not included in these projections since PGW assumes a consistent seasonal cycle.</li></ul><h3 id="analyzing-results"><strong>6. Analyzing Results</strong></h3><p>After running the simulations:</p><ul><li>Assess changes in key climate variables such as temperature, precipitation, and extreme weather events.</li><li>Compare results with traditional dynamic downscaling methods to validate the PGW approach's effectiveness in capturing plausible future scenarios.</li></ul><h2 id="advantages-of-pgw">Advantages of PGW</h2><ul><li><strong>Computational Efficiency</strong>: PGW requires less computational power compared to traditional methods, making it suitable for high-resolution studies.</li><li><strong>Flexibility</strong>: It allows researchers to easily modify simulation parameters and assess various future scenarios.</li></ul><h2 id="challenges-and-considerations">Challenges and Considerations</h2><p>Despite its advantages, implementing PGW poses challenges:</p><ul><li><strong>Complexity of Implementation</strong>: Care must be taken to ensure that modifications do not compromise the physical realism of the regional model. Adjustments to pressure and geopotential fields are critical for maintaining consistency between thermodynamic and dynamic changes.</li><li><strong>Interannual Variability</strong>: The PGW method typically does not account for changes in interannual variability, which can limit its applicability in certain contexts.</li><li><strong>Sensitivity to Initial Conditions</strong>: The effectiveness of PGW simulations can be sensitive to the choice of initial conditions and boundary settings, necessitating careful calibration.</li></ul><p>By following this structured methodology, researchers can effectively utilize the PGW approach to project future climate conditions while addressing specific regional impacts of global warming.</p><h2 id="step-by-step-process-of-pseudo-global-warming-pgw-using-cmip6">Step-by-Step Process of Pseudo-Global Warming (PGW) Using CMIP6</h2><p>The Pseudo-Global Warming (PGW) approach is a method for simulating future climate scenarios by modifying existing regional climate models (RCMs) using data from global climate models (GCMs). Below is a detailed step-by-step process using CMIP6 as an example.</p><h4 id="step-1-select-a-global-climate-model-gcm"><strong>Step 1: Select a Global Climate Model (GCM)</strong></h4><p>Choose a suitable GCM from the Coupled Model Intercomparison Project Phase 6 (CMIP6). For instance, you might select the CanESM5 model, which provides multiple ensemble runs to capture internal variability.</p><h4 id="step-2-obtain-historical-and-future-climate-data"><strong>Step 2: Obtain Historical and Future Climate Data</strong></h4><ul><li><strong>Historical Data (CTRL)</strong>: Gather historical climate data for a baseline period (e.g., 1971-2000) from the selected GCM.</li><li><strong>Future Scenario Data (SCEN)</strong>: Obtain future climate projections for a specific scenario (e.g., SSP2-4.5) from the same GCM for a future period (e.g., 2071-2100).</li></ul><h4 id="step-3-calculate-the-perturbation-field-δ"><strong>Step 3: Calculate the Perturbation Field (Δ)</strong></h4><p>Compute the perturbation field that represents the changes between the future scenario and the historical control:</p><p><span class="math display">\[\Delta = SCEN - CTRL\]</span></p><p>This field will include changes in key variables such as temperature, specific humidity, wind, and geopotential height. The perturbations should be based on monthly mean data over a defined period to ensure consistency with seasonal cycles .</p><h4 id="step-4-prepare-historical-simulation-hist"><strong>Step 4: Prepare Historical Simulation (HIST)</strong></h4><p>Run a historical simulation using an RCM with boundary conditions derived from reanalysis data (e.g., ERA5). This simulation will serve as the control run for your PGW experiment.</p><h4 id="step-5-modify-boundary-conditions"><strong>Step 5: Modify Boundary Conditions</strong></h4><p>Add the perturbation field Δ to the historical boundary conditions to create new lateral boundary conditions for the PGW simulation:</p><p><span class="math display">\[PGW = HIST + \Delta\]</span></p><p>This step ensures that the PGW simulation incorporates both thermodynamic and dynamic changes while preserving physical realism .</p><h4 id="step-6-run-pgw-simulation"><strong>Step 6: Run PGW Simulation</strong></h4><p>Execute the PGW simulation using the modified boundary conditions. This simulation will reflect how historical weather patterns might evolve under future climate scenarios. The synoptic environment will closely match that of the reanalysis data, reducing biases typical in conventional downscaling methods .</p><h4 id="step-7-analyze-results"><strong>Step 7: Analyze Results</strong></h4><p>After running the PGW simulation, analyze the outputs to assess changes in climate variables, such as temperature and precipitation patterns. This analysis can help evaluate potential impacts on local ecosystems, water resources, and extreme weather events.</p><h4 id="step-8-validate-against-observations"><strong>Step 8: Validate Against Observations</strong></h4><p>Compare the PGW simulation results with observed climate data to validate accuracy. This step is crucial for ensuring that the model captures realistic climate dynamics and can be used for impact assessments.</p><h3 id="example">Example</h3><h4 id="section"></h4><ul><li><a href="https://tccip.ncdr.nat.gov.tw/km_newsletter_one.aspx?nid=20191202172107">臺灣空氣品質變化與氣候變遷</a> 計畫流程示意圖。預計將進行對照組（CTRL）及實驗組（Pseudo-Global Warming, PGW），分別以WRF及CMAQ模擬現在及未來氣候狀態的空氣品質。橘色框為WRF初始及邊界條件，CTRL使用ECMWF ERA5資料，PGW則考慮未來氣候變化差異。</li></ul><figure><img src="https://tccip.ncdr.nat.gov.tw/upload/ckfinder/images/TCCIP%E7%AC%AC34%E6%9C%9F%E9%9B%BB%E5%AD%90%E5%A0%B1_%E5%9C%963.png" alt="流程示意圖" /><figcaption>流程示意圖</figcaption></figure>]]></content>
    
    
    <categories>
      
      <category>NWP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NWP</tag>
      
      <tag>WRF</tag>
      
      <tag>MPAS</tag>
      
      <tag>PGW</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Climate Models</title>
    <link href="/2024/09/30/climate-model/"/>
    <url>/2024/09/30/climate-model/</url>
    
    <content type="html"><![CDATA[<h1 id="climate-models">Climate models</h1><p>Climate models are systems of differential equations based on the basic laws of physics, fluid motion, and chemistry. To "run" a model, scientists divide the planet into a 3-dimensional grid, apply the basic equations, and evaluate the results. Atmospheric models calculate winds, heat transfer, radiation, relative humidity, and surface hydrology within each grid and evaluate interactions with neighboring points.</p><figure><img src="https://celebrating200years.noaa.gov/breakthroughs/climate_model/AtmosphericModelSchematic.png" alt="(Image source: NOAA)" /><figcaption>(Image source: NOAA)</figcaption></figure><h2 id="the-complexity-of-the-climate-models">The complexity of the climate models</h2><p>As computing power has increased since the 1970s, so has the complexity of the computer models used to simulate Earth's climate. Components are first developed separately and later coupled into comprehensive models.</p><figure><img src="https://climate.nasa.gov/rails/active_storage/blobs/redirect/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaHBBa2NqIiwiZXhwIjpudWxsLCJwdXIiOiJibG9iX2lkIn19--81d8c831c0e77e9a03d7575233db6494080cbf46/evolution_743px.jpg?disposition=inline" alt="(From NASA)" /><figcaption>(From NASA)</figcaption></figure><h2 id="climate-model-bias">Climate model bias</h2><p>Climate model bias is the difference between the statistics of the observations for the reference period and the statistics of the climate model simulation for the same period.</p><p>The bias of a climate model is determined by comparing the climate model output for a past period with observational data for that same period. For example the annual and seasonal climatological averages for all relevant climate variables are compared, the probability of certain extremes, variability, trends, etc. The smaller the bias, the higher the model skill to simulate the observed climate correctly. This skill is often used as a measure of quality. <strong>Model biases are determined by comparing the statistics of observational records for a certain period (often 30 years) with the simulated climate for the same period in the past (for projections). Biases can not be determined by comparing e.g. the weather on certain dates or in certain years in the past!</strong></p><ul><li>Gupta, A. S., Jourdain, N. C., Brown, J. N., &amp; Monselesan, D. (2013). Climate Drift in the CMIP5 Models. Journal of Climate, 26(21), 8597-8615. https://doi.org/10.1175/JCLI-D-12-00521.1<ul><li>Model drift refers to spurious long-term changes in general circulation models that are unrelated to either changes in external forcing or internal low-frequency variability. Drift can be caused by a number of factors. For example, a simulation's initial state may not be in dynamical balance with the representation of physics in the model; “coupling shock” may occur during the coupling of model components resulting in discontinuities in surface fluxes (e.g., Rahmstorf 1995) or numerical errors may exist in the model that mean that heat or moisture is not fully conserved</li></ul></li></ul><p>Climate model bias refers to the systematic differences between the outputs of climate models and actual observed climate statistics. These biases can arise from several factors, including:</p><h3 id="definition-of-climate-model-bias"><strong>1. Definition of Climate Model Bias</strong></h3><ul><li>Climate model bias is defined as the difference between a simulated climate statistic (from a model) and the corresponding real-world climate statistic (observations) for the same period. This can include discrepancies in temperature, precipitation, and other climate variables over time.</li></ul><h3 id="causes-of-bias"><strong>2. Causes of Bias</strong></h3><ul><li><strong>Spatial Resolution</strong>: Many climate models operate on large grid sizes, which can lead to inaccuracies in representing local climate features.</li><li><strong>Simplified Thermodynamic Processes and Physics</strong>: Models may oversimplify complex physical processes, such as convection or land-atmosphere interactions, leading to incorrect simulations of climate dynamics.</li><li><strong>Incomplete Understanding</strong>: The current understanding of the climate system is not exhaustive, which can result in biases in model outputs.</li></ul><h3 id="types-of-bias"><strong>3. Types of Bias</strong></h3><ul><li><strong>Mean Bias</strong>: The average difference between model outputs and observations.</li><li><strong>Variance Bias</strong>: Differences in variability, such as how extreme weather events are represented.</li><li><strong>Temporal Bias</strong>: Issues related to timing, such as incorrect seasonal patterns or shifts in monsoon timings.</li></ul><h3 id="implications-of-bias"><strong>4. Implications of Bias</strong></h3><p>Using uncorrected climate model outputs for impact assessments can yield unrealistic results. For example, if a model consistently underestimates rainfall extremes, it could misinform water resource management or flood risk assessments.</p><h3 id="bias-correction-methods"><strong>5. Bias Correction Methods</strong></h3><p>To address these biases, various statistical methods have been developed:</p><ul><li><strong>Delta Change Method</strong>:<ul><li>Adjusts historical observations based on projected changes from models (e.g., adding a predicted temperature increase to historical data).</li><li>The simplest approach is the Delta change method, which is often used in climate impact research. This approach uses the GCM or RCM response to climate change to modify observations. E.g. if the climate model predicts 3°C higher temperatures, 3°C is added to all historic observations to construct a new time series for the future climate. For rainfall usually a percentage change is calculated. If the climate model predicts a 20% increase in rainfall, a new time-series will be made by multiplying the historic rainfall by 1.2. For different months or seasons different delta factors can be defined. Note: this method does not take into account changes in climate variability such as increasing extreme rainfall or longer dry spells.</li></ul></li><li><strong>Quantile Mapping</strong>: A more sophisticated method that maps the cumulative distribution functions (CDFs) of observed and modeled data to adjust for biases across all quantiles.</li><li><strong>Linear Regression</strong>: Uses historical data to create a statistical relationship between observed and modeled outputs for future projections.</li></ul><p>Both the delta change and linear regression method are suitable to bias adjust relative humidity, humidity, wind speed and radiation.</p><p>Climate models produce area-average data, whereas many observations are point measurements. In order to determine the skill, climate model data should be compared with area-average data, otherwise the bias may be affected by the difference between area-average and point data. This is especially important for climate variables where large spatial differences are observed within a grid cell, e.g. precipitation. For this reason reanalysis data are often used to determine the skill of climate models. The quality of climate data for the future cannot be assessed in a direct way, since no observational data set is available for the future. It is generally assumed that the bias/skill for the future is the same as for the past/current climate (although this is not necessarily true). When the skill is good for the current climate, we generally have more confidence in the results for the future.</p><h3 id="challenges-with-bias-correction"><strong>6. Challenges with Bias Correction</strong></h3><p>While bias correction methods aim to improve model outputs, they have limitations:</p><ul><li>They may not fully correct underlying physical process misrepresentations.</li><li>They can introduce new artifacts or inconsistencies in spatial and temporal data.</li><li>The assumption that present-day biases will remain constant over time can be problematic, especially for variables like precipitation that may exhibit non-stationarity.</li></ul><p>In summary, understanding and correcting climate model bias is essential for improving the reliability of climate projections and their applications in impact studies.</p><h1 id="downscaling-climate-models">Downscaling climate models</h1><p>Downscaling climate models is a crucial process for obtaining localized climate information from global climate models (GCMs), which typically operate at coarse spatial resolutions. Below is an overview of how to perform downscaling and the associated challenges.</p><figure><img src="https://climateextremes.org.au/wp-content/uploads/Screenshot-2023-04-13-at-4.01.03-pm-1.png" alt="Downscaled temperature over south-east Australia. Data: NARCLiM" /><figcaption>Downscaled temperature over south-east Australia. Data: NARCLiM</figcaption></figure><ul><li><a href="https://tccip.ncdr.nat.gov.tw/km_column_one.aspx?kid=20230725084802">什麼是降尺度? 為什麼降尺度不是越細越好?</a></li></ul><h2 id="methods-of-downscaling">Methods of Downscaling</h2><h3 id="types-of-downscaling"><strong>1. Types of Downscaling</strong></h3><ul><li><strong>Dynamical Downscaling</strong>: This method uses regional climate models (RCMs) that are forced by GCM outputs. RCMs operate on finer spatial scales (typically &lt;50 km) and can capture local climate features more accurately by incorporating detailed physical processes.</li><li><strong>Statistical Downscaling</strong>: This approach establishes statistical relationships between large-scale climate variables from GCMs and local observations. It is less computationally intensive than dynamical downscaling and includes methods such as:<ul><li><strong>Bias Correction with Spatial Disaggregation (BCSD)</strong>: Adjusts GCM outputs based on historical data.</li><li><strong>Quantile Mapping</strong>: Corrects the distribution of model outputs to match observed data distributions.</li><li><strong>Localized Constructed Analogs (LOCA)</strong>: Finds analogous historical weather patterns to generate fine-resolution outputs.</li></ul></li></ul><h3 id="steps-for-downscaling"><strong>2. Steps for Downscaling</strong></h3><ol type="1"><li><strong>Select a GCM</strong>: Choose a suitable global climate model and the relevant emission scenario.</li><li><strong>Obtain Historical Data</strong>: Gather historical climate data for the region of interest to establish baseline conditions.</li><li><strong>Choose a Downscaling Method</strong>: Decide between dynamical or statistical downscaling based on available resources and required precision.</li><li><strong>Run the Downscaling Model</strong>:<ul><li>For dynamical downscaling, set up the RCM with appropriate boundary conditions from the GCM.</li><li>For statistical downscaling, develop statistical relationships using historical data and apply them to future GCM projections.</li></ul></li><li><strong>Validate Outputs</strong>: Compare downscaled results with observed data to assess accuracy and make necessary adjustments.</li></ol><h2 id="challenges-of-downscaling">Challenges of Downscaling</h2><h3 id="computational-demands"><strong>1. Computational Demands</strong></h3><ul><li>Both dynamical and statistical downscaling can be computationally intensive, especially when multiple RCMs or scenarios are involved. This can strain resources for many research groups, limiting their ability to conduct extensive simulations.</li></ul><h3 id="bias-issues"><strong>2. Bias Issues</strong></h3><ul><li>GCMs often have systematic biases in their outputs, which can propagate through the downscaling process. If not adequately addressed, these biases can lead to misleading local projections.</li></ul><h3 id="uncertainty-in-atmospheric-circulation"><strong>3. Uncertainty in Atmospheric Circulation</strong></h3><ul><li>The accuracy of downscaled projections is heavily reliant on the atmospheric circulation patterns provided by GCMs. Any uncertainty in these patterns can significantly affect regional climate outcomes.</li></ul><h3 id="limitations-of-statistical-methods"><strong>4. Limitations of Statistical Methods</strong></h3><ul><li>Statistical downscaling relies on historical relationships that may not hold true under future climate conditions, leading to potential inaccuracies in projections. Additionally, assumptions made during statistical modeling can introduce further biases.</li></ul><h3 id="scale-mismatch"><strong>5. Scale Mismatch</strong></h3><ul><li>The coarse resolution of GCMs may not adequately represent localized phenomena such as orographic precipitation or extreme weather events, which are vital for impact assessments.</li></ul><p>In summary, while downscaling is essential for obtaining high-resolution climate information necessary for local impact studies, it comes with significant challenges that need careful consideration and management to ensure reliable projections.</p><h1 id="references">References</h1><ul><li><a href="https://climate.copernicus.eu/sites/default/files/2021-12/10-c3s-uls-data-resources-climate-models.pdf">C3S User Learning Services Data Resources - Climate Models</a> ((<strong>Recommendation</strong>))</li><li><a href="https://climateextremes.org.au/a-closer-look-at-climate-modelling/">climateextremes.org.au: Types of models</a> ((<strong>Recommendation</strong>))</li><li><a href="https://skepticalscience.com/weather-forecasts-vs-climate-models-predictions.htm">The difference between weather and climate</a></li><li><a href="https://blogs.reading.ac.uk/weather-and-climate-at-reading/2022/weather-vs-climate-prediction/">Weather and Climate @ Reading: Weather vs. Climate Prediction</a></li><li><a href="https://www.climate.gov/maps-data/climate-data-primer/predicting-climate/climate-models">Climate gov: Climate Models</a></li><li><a href="https://www.earth-scan.com/blog/weather-vs-climate">earth-scan: weather-vs-climate</a></li><li><a href="https://climate.copernicus.eu/sites/default/files/2021-01/infosheet7.pdf">Copernicus Climate Change Service – Global Impacts: What is bias correction?</a></li><li>Kotamarthi R, Hayhoe K, Mearns LO, Wuebbles D, Jacobs J, Jurado J. <strong>Empirical-Statistical Downscaling</strong>. In: Downscaling Techniques for High-Resolution Climate Projections: From Global Change to Local Impacts. Cambridge University Press; 2021:82-101. (<a href="https://sci-hub.se/https://doi.org/10.1017/9781108601269.006">link</a>)</li><li>Xu, Z., Y. Han, C.-Y. Tam, Z.-L. Yang and C. Fu, 2021: <strong>A bias-corrected CMIP6 global dataset. for dynamical downscaling of future climate, 1979–2100</strong>, Scientific Data, doi: 10.1038/s41597-021-01079-3. <a href="https://atmosphericdynamicsgroup.github.io/database/cmip6.html" class="uri">https://atmosphericdynamicsgroup.github.io/database/cmip6.html</a></li><li><a href="https://probablefutures.org/zh/science/climate-models/">Probable Futures 是一项非营利性气候扫盲计划</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>NWP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NWP</tag>
      
      <tag>WRF</tag>
      
      <tag>MPAS</tag>
      
      <tag>PGW</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Differences Between Weather Models and Climate Models</title>
    <link href="/2024/09/30/weather-model-vs-climate-model/"/>
    <url>/2024/09/30/weather-model-vs-climate-model/</url>
    
    <content type="html"><![CDATA[<h2 id="differences-between-weather-models-and-climate-models">Differences Between Weather Models and Climate Models</h2><p>Understanding the distinctions between weather models and climate models is crucial for grasping how meteorologists and climate scientists predict atmospheric conditions over varying timescales. Here are the key differences:</p><h3 id="time-scale-of-predictions"><strong>1. Time Scale of Predictions</strong></h3><ul><li><strong>Weather Models</strong>: These models focus on short-term predictions, typically ranging from a few hours to about 15 days. They provide detailed forecasts for specific locations, such as whether it will rain tomorrow or if a storm is approaching.</li><li><strong>Climate Models</strong>: In contrast, climate models project conditions over much longer periods, often decades to hundreds of years. They analyze trends and averages rather than specific events, such as predicting whether summers will become drier in the next 50 years.</li></ul><h3 id="initial-vs.-foreced-boundary-value-problems"><strong>2. Initial vs. Foreced Boundary Value Problems</strong></h3><ul><li><strong>Weather Models</strong>: They operate as initial value problems, meaning they require precise initial conditions (like current temperature and pressure) to generate accurate forecasts. Small changes in these initial conditions can significantly impact the forecast outcome.</li><li><p><strong>Climate Models</strong>: In a climate model, you get climate variables for every day, but you don't care exactly on which day and exact location you get a certain value for this variable as long as the long term statistics are correct for the location and reference. This does not depend on the initial conditions of the simulation, but it depends on the parameters in the model itself or how the climate system is modelled (this is called a boundary value problem). These are "Foreced" boundary value problems, focusing on long-term changes influenced by factors like greenhouse gas concentrations and land use changes. The initial state is less critical; instead, the model uses projected future conditions to assess climate evolution.</p></li><li>預測未來氣候系統的演變是氣候科學的核心。如前所述，氣候預測是一個邊界值問題。模型必須假設長期限制氣候演變的條件將如何演變，例如對未來溫室氣體排放做出有根據的猜測。相反，天氣預報是一個初始值問題，首先取決於對天氣系統當前狀態的準確了解。氣候預測是一個邊界值的問題，在氣候案例中，最大的不確定性在於確定從太陽接收的能量（邊界值）如何在系統的各個組成部分（即大氣、海洋、陸地和冰凍圈）中分佈。<ul><li>Bracco, A., Brajard, J., Dijkstra, H. A., Hassanzadeh, P., Lessig, C., &amp; Monteleoni, C. (2024). Machine Learning for the Physics of Climate. arXiv preprint arXiv:2408.09627</li></ul></li><li><p>氣候變遷的預測不同於天氣預報，後者主要依賴初值，而前者既依賴初始條件,也依​​賴邊界條件或完全依賴邊界條件。短期氣候預測，就是依賴以上兩種條件，這種可預報性被洛崙茲稱為第一類可預報性。對於長期(幾十年或幾百年)的氣候變遷預測，如由人類活動造成的溫室氣體增加引起的全球氣候變化，將不依賴於大氣的初始條件，這是由於在模式長期積分之後，將完全喪失對初條件的記憶，因而失去它的影響。這種完全依賴詳細邊界條件變化的氣候預測被洛崙茲稱為第二類可預報性，其可預報性決定於外界強迫變化的時間尺度。由於氣候系統的慣性，即使施加於邊界的外強迫消失之後很久,氣候系統還將繼續變化相當長的時間，甚至長達千年以上，海平面上升的反應就是一個例子。雖然氣候本質上是一種混沌現象,表現為湍流或非週期現象，但有些情況下也表現出相當程度的週期性或準週期性，這就大大增加了氣候的可預測性。目前在氣候分析中廣泛使用的如子波分析法等,就是為揭示其不同時空尺度的周期性而進行的，另外一個氣候週期性著名的例子是地球軌道參數的米蘭科維奇循環。<a href="https://gd.weather.com.cn/climate/qhbhyw/11/1196273.shtml">link</a></p></li></ul><h3 id="resolution"><strong>3. Resolution</strong></h3><ul><li><strong>Weather Models</strong>: They typically have a finer spatial and temporal resolution, allowing for detailed predictions over smaller areas (often at a scale of 1 km or less). This granularity is essential for short-term forecasting.</li><li><strong>Climate Models</strong>: While they can also achieve high resolution, climate models generally operate on coarser grids (often around 50 km) due to the longer timeframes they analyze. The focus is on broader patterns rather than localized events.</li></ul><h3 id="data-assimilation"><strong>4. Data Assimilation</strong></h3><ul><li><strong>Weather Models</strong>: These models assimilate real-time observational data from satellites, weather stations, and radar to continuously update forecasts. This real-time data integration enhances accuracy for short-term predictions.</li><li><strong>Climate Models</strong>: Climate models do not incorporate real-time observations but instead rely on historical data and projections of future conditions based on various scenarios (e.g., different levels of greenhouse gas emissions) to simulate long-term trends.</li></ul><h3 id="purpose-and-application"><strong>5. Purpose and Application</strong></h3><ul><li><strong>Weather Models</strong>: Primarily used for immediate forecasting needs such as daily weather reports, severe weather warnings, and event planning. They help individuals and organizations prepare for short-term atmospheric conditions.</li><li><strong>Climate Models</strong>: Climate models are used to determine how the average and extreme conditions will change. Used to understand long-term climate change impacts, assess risks associated with global warming, and inform policy decisions regarding environmental management and sustainability. Their outputs guide infrastructure planning and disaster preparedness over extended periods.</li></ul><h3 id="summary-table">Summary Table</h3><table><thead><tr class="header"><th style="text-align: left;">Feature</th><th style="text-align: left;">Weather Models</th><th style="text-align: left;">Climate Models</th></tr></thead><tbody><tr class="odd"><td style="text-align: left;">Time Scale</td><td style="text-align: left;">Hours to 15 days</td><td style="text-align: left;">Decades to hundreds of years</td></tr><tr class="even"><td style="text-align: left;">Problem Type</td><td style="text-align: left;">Initial value problem</td><td style="text-align: left;">Boundary value problem</td></tr><tr class="odd"><td style="text-align: left;">Resolution</td><td style="text-align: left;">High (1 km or less)</td><td style="text-align: left;">Coarse (typically 50 km)</td></tr><tr class="even"><td style="text-align: left;">Data Assimilation</td><td style="text-align: left;">Real-time observational data</td><td style="text-align: left;">Historical data and future projections</td></tr><tr class="odd"><td style="text-align: left;">Purpose</td><td style="text-align: left;">Short-term forecasting</td><td style="text-align: left;">Long-term climate change analysis</td></tr></tbody></table><p>In summary, while both weather and climate models share foundational scientific principles, they serve different purposes and operate under distinct methodologies tailored to their respective timeframes and objectives.</p><figure><img src="https://www.esa.int/var/esa/storage/images/esa_multimedia/images/2021/04/weather_versus_climate_at_a_glance/23267896-1-eng-GB/Weather_versus_climate_at_a_glance_article.jpg" alt="‘Weather’ refers to short-term changes, and ‘climate’ to weather conditions averaged over at least 30 years (image source: ESA)." /><figcaption>‘Weather’ refers to short-term changes, and ‘climate’ to weather conditions averaged over at least 30 years (image source: ESA).</figcaption></figure><h1 id="references">References</h1><ul><li><a href="https://climate.copernicus.eu/sites/default/files/2021-12/10-c3s-uls-data-resources-climate-models.pdf">C3S User Learning Services Data Resources - Climate Models</a> ((<strong>Recommendation</strong>))</li><li><a href="https://climateextremes.org.au/a-closer-look-at-climate-modelling/">climateextremes.org.au: Types of models</a> ((<strong>Recommendation</strong>))</li><li><a href="https://skepticalscience.com/weather-forecasts-vs-climate-models-predictions.htm">The difference between weather and climate</a></li><li><a href="https://blogs.reading.ac.uk/weather-and-climate-at-reading/2022/weather-vs-climate-prediction/">Weather and Climate @ Reading: Weather vs. Climate Prediction</a></li><li><a href="https://www.climate.gov/maps-data/climate-data-primer/predicting-climate/climate-models">Climate gov: Climate Models</a></li><li><a href="https://www.earth-scan.com/blog/weather-vs-climate">earth-scan: weather-vs-climate</a></li><li><a href="https://climate.copernicus.eu/sites/default/files/2021-01/infosheet7.pdf">Copernicus Climate Change Service – Global Impacts: What is bias correction?</a></li><li>Kotamarthi R, Hayhoe K, Mearns LO, Wuebbles D, Jacobs J, Jurado J. <strong>Empirical-Statistical Downscaling</strong>. In: Downscaling Techniques for High-Resolution Climate Projections: From Global Change to Local Impacts. Cambridge University Press; 2021:82-101. (<a href="https://sci-hub.se/https://doi.org/10.1017/9781108601269.006">link</a>)</li><li>Xu, Z., Y. Han, C.-Y. Tam, Z.-L. Yang and C. Fu, 2021: <strong>A bias-corrected CMIP6 global dataset. for dynamical downscaling of future climate, 1979–2100</strong>, Scientific Data, doi: 10.1038/s41597-021-01079-3. <a href="https://atmosphericdynamicsgroup.github.io/database/cmip6.html" class="uri">https://atmosphericdynamicsgroup.github.io/database/cmip6.html</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>NWP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NWP</tag>
      
      <tag>WRF</tag>
      
      <tag>MPAS</tag>
      
      <tag>PGW</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Data assimilation (DA)</title>
    <link href="/2024/09/24/DA-intro/"/>
    <url>/2024/09/24/DA-intro/</url>
    
    <content type="html"><![CDATA[<h1 id="data-assimilation-da">Data assimilation (DA)</h1><p>Data assimilation (DA) (數據同化，或稱資料同化) is a technique by which numerical model data and observations are combined to obtain an analysis that best represents the state of the atmospheric phenomena of interest</p><h1 id="history">History</h1><ul><li>In 1901 Cleveland Abbe founded the United States Weather Bureau. He suggested that the atmosphere followed the principles of thermodynamics and hydrodynamics</li><li>In 1904, Vilhelm Bjerknes proposed a two-step procedure formodel-based weather forecasting. First, a analysis step of data assimilation to generate initial conditions, then a forecasting step solving the initial value problem.</li><li>In 1922, Lewis Fry Richardson carried out the first attempt to perform the weather forecast numerically.</li><li>In 1950, a team of the American meteorologists Jule Charney, Philip Thompson, Larry Gates, and Norwegian meteorologist Ragnar Fj ̈ortoft and the applied mathematician John von Neumann, succeeded in the first numerical weather forecast using the ENIAC digital computer.</li><li>In September 1954, Carl-Gustav Rossby’s group at the Swedish Meteorological and Hydrological Institute produced the first operational forecast (i.e. routine predictions for practical use) based on the barotropic equation. Operational numerical weather prediction in the United States began in 1955 under the Joint Numerical Weather Prediction Unit (JNWPU), a joint project by the U.S. Air Force, Navy, and Weather Bureau.</li><li>In 1959, Karl-Heinz Hinkelmann produced the first reasonable primitive equation forecast, 37 years after Richardson’s failed attempt. Hinkelmann did so by removing high-frequency noise from the numerical model during initialization.</li><li>In 1966, West Germany and the United States began producing operational forecasts based on primitive-equation models, followed by the United Kingdom in 1972, and Australia in 1977.</li></ul><h2 id="polynomial-fitting-of-panofsky">Polynomial Fitting of Panofsky</h2><blockquote><p>Panofsky, R. A. (1949). Objective weather-map analysis. Journal of Atmospheric Sciences, 6(6), 386-392.</p></blockquote><p><span class="math display">\[\begin{equation}\begin{split}p(x,y) = \sum_{i,j} a_{ij} x^i y^j, \qquad  i+j \leq 3\end{split}\end{equation}\tag{2}\]</span></p><ul><li>A field of 10 observations can be fitted accurately by a third-degree polynomial, with no smoothing of data.</li><li>The amount of smoothing will depend on the nature of the variable analyzed.</li></ul><h2 id="successive-correction-method-scm-of-cressman">Successive Correction Method (SCM) of Cressman</h2><blockquote><p>Cressman G P, 1959. An operational objective analysis system[J]. Mon Wea Rev, 87: 367-374.</p></blockquote><ul><li>Purpose:<ul><li>SCM is designed to improve the accuracy of gridded meteorological data by integrating observations from various sources, such as weather stations, into a coherent grid. This method is particularly useful in situations where observational data is sparse or unevenly distributed.</li></ul></li><li>Basic Principle:<ul><li>The method operates on the principle of iteratively correcting a background field (initial guess) using available observational data. Each iteration refines the grid values based on nearby observations, effectively merging the observational data with the background field.</li></ul></li><li>Weighting Function:<ul><li>Cressman's SCM employs a specific weighting function that determines how much influence each observation has on the grid point being corrected. This function typically decreases with distance from the observation point, allowing closer observations to have a greater impact on the grid value than those further away.</li></ul></li><li>Computational Efficiency:<ul><li>One of the advantages of SCM is its computational simplicity and efficiency, making it suitable for real-time applications in weather forecasting and analysis. It does not require complex background error covariance matrices or assumptions about error distributions, which simplifies its implementation compared to other assimilation methods like Optimal Interpolation (OI) or Variational methods.</li></ul></li></ul><h1 id="inverse-problem">Inverse Problem</h1><p>DA consists of using the actual result of some measurements to infer the values of the parameters that characterize the system.</p><h1 id="random-variable">Random Variable</h1><h2 id="bayesian">Bayesian</h2><h2 id="mathematics">Mathematics</h2><h1 id="references">References</h1><ol type="1"><li>朱国富, 2015. 数值天气预报中分析同化基本方法的历史发展脉络和评述. 气象, 41(8): 986-996. DOI: 10.7519/j.issn.1000-0526.2015.08.008.</li><li>朱国富, 2015. 理解大气资料同化的根本概念[J]. 气象, 41(4): 456-463. DOI:10.7519/j.issn.1000-0526.2015.04.008</li><li><a href="https://indico.cern.ch/event/289770/contributions/664473/attachments/541326/746202/DA_CERN_Perianez.pdf">2014: Data Assimilation in Numerical Weather Prediction models</a></li><li><a href="https://www.cwa.gov.tw/Data/climate/Info/lectures/100/20180517_Chen.pdf">2018: 中央氣象局全球資料同化系統</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>DA</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NWP</tag>
      
      <tag>WRF</tag>
      
      <tag>MPAS</tag>
      
      <tag>DA</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ONNX Open Neural Network Exchange</title>
    <link href="/2024/09/23/ONNX/"/>
    <url>/2024/09/23/ONNX/</url>
    
    <content type="html"><![CDATA[<h1 id="onnx-open-neural-network-exchange">ONNX Open Neural Network Exchange</h1><p>ONNX is an open format built to represent machine learning models. ONNX defines a common set of operators - the building blocks of machine learning and deep learning models - and a common file format to enable AI developers to use models with a variety of frameworks, tools, runtimes, and compilers.</p><ul><li>ONNX was originally named Toffee and was developed by the PyTorch team at Facebook. In September 2017 it was renamed to ONNX and announced by Facebook and Microsoft. Later, IBM, Huawei, Intel, AMD, Arm and Qualcomm announced support for the initiative.</li><li>In October 2017, Microsoft announced that it would add its Cognitive Toolkit and Project Brainwave platform to the initiative.</li><li>In November 2019 ONNX was accepted as graduate project in Linux Foundation AI.</li><li>In October 2020 Zetane Systems became a member of the ONNX ecosystem.</li></ul><p>隨著深度學習技術的發展，越來越多的框架被開發出來以滿足不同的需求。然而，不同的框架之間缺乏互通性可能會限制模型的部署和遷移能力。 Open Neural Network Exchange (ONNX) 格式旨在解決這個問題，它提供了一種標準化的方法來表示機器學習模型，從而實現了不同框架之間的模型轉換和共用。本文將探討如何在不同的深度學習框架之間有效率地轉換和部署模型，並提供一些實際的程式碼範例。</p><p>ONNX 是一種開放格式，用於表示機器學習模型，支援各種框架之間的模型轉換。 ONNX 支援多種常見的神經網路結構和操作，包括卷積、池化、活化函數等。透過 ONNX，開發者可以在一個框架中訓練模型，然後將其轉換為 ONNX 格式，最後在另一個框架中載入並執行。</p><h1 id="pytorch">Pytorch</h1><p>PyTorch export model with ONNX format</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python">PyTorch 匯出模型<br><span class="hljs-keyword">import</span> torch<br><span class="hljs-keyword">import</span> torchvision.models <span class="hljs-keyword">as</span> models<br>從 torch.onnx <span class="hljs-keyword">import</span> export<br><br><span class="hljs-comment"># 載入預先訓練的 ResNet-18 模型</span><br>model = models.resnet18(pretrained=<span class="hljs-literal">True</span>)<br>model.<span class="hljs-built_in">eval</span>()<br><br><span class="hljs-comment"># 匯出模型到 ONNX 格式</span><br>dummy_input = torch.randn(<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">224</span>, <span class="hljs-number">224</span>)<br>export(model, dummy_input, <span class="hljs-string">&quot;resnet18.onnx&quot;</span>, verbose=<span class="hljs-literal">True</span>, opset_version=<span class="hljs-number">11</span>)<br></code></pre></td></tr></table></figure><p>Loading ONNX models by PyTorch</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> onnxruntime <span class="hljs-keyword">as</span> ort<br><br><span class="hljs-comment"># 載入 ONNX 模型</span><br>ort_session = ort.InferenceSession(<span class="hljs-string">&quot;resnet18.onnx&quot;</span>)<br><br><span class="hljs-comment"># 預處理輸入數據</span><br>data = torch.randn(<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">224</span>, <span class="hljs-number">224</span>).numpy()<br><br><span class="hljs-comment"># 運行模型</span><br>ort_inputs = &#123;<br> ort_session.get_inputs()[<span class="hljs-number">0</span>].name: data&#125;<br>ort_outs = ort_session.run(<span class="hljs-literal">None</span>, ort_inputs)<br><br><span class="hljs-comment"># 輸出預測結果</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Output:&quot;</span>, ort_outs)<br></code></pre></td></tr></table></figure><h1 id="最佳實踐">最佳實踐</h1><ul><li>選擇合適的 ONNX 版本：ONNX 不斷更新以支援新的操作和改進效能。選擇最新的 ONNX 版本通常可以獲得更好的支援和效能。</li><li>驗證模型轉換：轉換模型後，應確保 ONNX 模型的行為與原生模型一致。可以透過比較兩個模型在相同輸入上的輸出來進行驗證。</li><li>檢查模型相容性：不是所有的框架都支援所有 ONNX 操作。確保目標框架支援你的模型中使用的操作。</li><li>最佳化模型：在匯出為 ONNX 格式之前，請考慮使用框架提供的工具進行模型最佳化，例如量化、剪枝等。</li><li>文件和測試：記錄轉換過程中的重要步驟，並進行充分的測試以確保模型的正確性和效能。</li></ul><h1 id="references">References</h1><ol type="1"><li><a href="https://onnx.ai/">https://onnx.ai/</a></li><li><a href="https://developer.aliyun.com/article/1598009">ONNX 模型互操作性的最佳实践</a></li><li><a href="https://learn.microsoft.com/zh-tw/azure/machine-learning/concept-onnx?view=azureml-api-2">ONNX 與 Azure Machine Learning</a></li><li><a href="https://datawhalechina.github.io/thorough-pytorch/%E7%AC%AC%E4%B9%9D%E7%AB%A0/9.1%20%E4%BD%BF%E7%94%A8ONNX%E8%BF%9B%E8%A1%8C%E9%83%A8%E7%BD%B2%E5%B9%B6%E6%8E%A8%E7%90%86.html#id7">9.1 使用ONNX进行部署并推理</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>ML</category>
      
    </categories>
    
    
    <tags>
      
      <tag>AI</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HPC 高性能计算平台</title>
    <link href="/2024/09/21/HPC/"/>
    <url>/2024/09/21/HPC/</url>
    
    <content type="html"><![CDATA[<h1 id="為什麼-hpc-如此重要">為什麼 HPC 如此重要？</h1><p>高效能運算 (HPC) 已不是新鮮事。數十年來，HPC 工作站和超級電腦在學術研究中扮演著不可或缺的角色，解決了複雜的問題並激發了發現和創新。近年來，數據量迅速激增，許多新的應用程式受益於 HPC 的強大功能，即跨共享資源執行運算密集型操作的能力，相較於傳統運算以更少的時間和更低的成本獲得結果。與此同時，HPC 硬體和軟體變得更容易獲得並且廣泛分佈。科學家、工程師和研究人員在一系列使用案例中仰賴著 HPC，包括天氣預報、石油和天然氣勘探、物理學、量子力學以及學術研究和商業應用的其他領域。</p><p>對於每一個涉及計算的課題組來說，購買超算機時還是建立自己的伺服器集群，成為了每個課題組的考量。筆者建議課題組針對專案需求，兩者靈活配置，不存在東風壓倒西風的說法；對於超算資源來說，短時間以較小的經費就可以撬動極大的計算資源，對於專案驗證或緊急的專案需求都是非常好的補充，對於許多大型專案的進展，沒有超算談何開展。當然回歸到課題組的實際需求，自建伺服器集群才是每個課題組最划算的算力投資。</p><p>超算中心產品的特點：完備的軟體運行環境及豐富的軟體選擇，穩定的技術支持，按需使用，靈活充值；缺點：昂貴且不易於管理，容易不知不覺就消耗了寶貴的科研經費（筆者接觸過課題組購置數萬機時，沒有有效管理，學生學習與試誤的過程中，就消耗殆盡；）</p><ul><li>1毛 = 1/10元 (人民幣)</li><li>超算中心價格基本上在0.1-0.3元一個核時(人民幣)，單價看起來還是不貴。</li><li>通常超算中心中主流的64核心節點，一般單價在0.1元每核心時，基於此計算一台64核心的伺服器長期租用，他的成本將會是：</li><li>每天的費用：64x0.1x24=153.6元；每年的費用可能高達56064元；目前一台超算中心的64核心節點，基本市場價格也就在5萬左右；我們也核算過各類伺服器配置，基本上超算同類的運算伺服器，租賃1年的費用，就等於您訂購這台伺服器費用了。</li><li>顯然從長期使用運算資源的角度來說，顯然自建自己的伺服器叢集是課題組更划算的選擇。</li><li>其次：自有的伺服器資源，可以做到更靈活的使用，軟體安裝也非常自由；文件資料本地存儲，使用快捷簡易等優點。</li></ul><p>首先说现在的超算价格：<a href="https://www.zhihu.com/question/523757254/answer/2530239695?utm_psn=1821112184379412482">link</a></p><ul><li>以北京超级云计算中心为代表的，主流超算中心，价格通常不超过0.1元每核时（搞活动的时候0.08元左右），按照题主描述，10万核时约需要8000~1万元。论性价比的话，</li><li>我更推荐一些不太知名的，价格从0.05到0.08元每核时不等。</li><li>其次，题主描述的10万核时应该是按照自己的18核至强计算出来的。不同CPU的性能差距很大，举个例子，<strong>AMD 7601计算1小时的，AMD 7452可能40分钟甚至半小时就算完了</strong>。最后，讨论下自己搭机器与租超算的优缺点。自己搭建机器，肯定无法兼顾性能与价格，例如预算6000以内的话，估计只能买1台双路AMD 7601，可能无法满足短时间内算完全部算例的需求。好处就是机器实打实的是自己的，这10万核时的任务算完了以后，机器还可以干别的用途，甚至卖了回血也可以。而超算与之相反，可以提供最高的算力，满足短期内大量的计算需求。缺点就是算完以后自己啥都留不下。</li></ul><p>实际上并行科技早就已经将超算商业化了，对于普通人也非常友好。我有个同学，自己有计算需求，但是课题组其他人没兴趣，她就自费只充了100块钱就够用了。就像充话费一样简单，使用也非常方便，超算就是一台远程linux电脑，远没有多数人想象的多么高冷神秘。<a href="https://www.zhihu.com/question/280917515/answer/1487285453">Link</a></p><p>例子:</p><ul><li>10万核时，0.1元每核时，需要1万人民币。</li></ul><h1 id="集群">集群</h1><ul><li><a href="http://www.chinahpc.com/">北京东方超算科技有限公司, ChinaHPC</a><ul><li>成立于2013年，创始团队来自于北京市计算中心和中国科学院超级计算中心，注册资金1000万元，坐落在北京市海淀区上地信息产业基地。</li><li><a href="http://www.chinahpc.cn/">东方超算云</a><ul><li>东方超算云的大规模算力集群位于全国一体化算力网络国家枢纽节点<strong>内蒙古自治区</strong></li><li>一期建设360个18KW高密度机柜，计算节点2000台，56000CPU核心，20PB分布式并行存储容量</li><li><a href="https://cloud.chinahpc.cn/#/login">Login website</a></li><li>公共计算平台服务资源<ul><li><strong>A区资源（0.1元核心小时）</strong>; 面向HPC、AI客户; 160节点; 处理器:2*Intel® Xeon® Platinum 9242 Processor（48核心、96线程、基础主频2.3GHz）; 内存：24x16GB 2933MHz，共384GB</li><li><strong>B区资源（0.08元核心小时）</strong>：面向大规模分布式并行，追求性价比用户; 1000节点; 处理器： Intel® Xeon® Processor E5-2680 v4 （28核心，基础主频2.4GHz，最大睿频3.3GHz); 内存：8*16GB ,共128GB 内存; 网络：Mellanox FDR 56Gb Infiniband</li></ul></li></ul></li></ul></li><li><a href="https://www.nscc-tj.cn/">国家超级计算天津中心, 天河一号</a><ul><li>中國人民解放軍國防科學技術大學和天津濱海新區提供的異構超級電腦</li><li>啟用時間: 天河-1：2009年10月29日，天河-1A：2010年10月28日</li><li>天河-1A使用的開源軟體包括：Linux作業系統，SLURM作業調度系統，Lustre叢集檔案系統</li><li>0.07元/核时，配置：单节点12核 , Intel Hexa Core Xeon X5670 ；主频 2.93GHz, 内存48G，私有高速网络，免费存储1TB</li></ul></li><li><a href="http://nscc-gz.cn/Product/HighPerformanceComputingService/ServiceCharacteristics.html">国家超级计算广州中心, 天河二号</a><ul><li>中山大學廣州校區東校園</li><li>啟用時間: 2013年</li><li><strong>天河二号</strong>拥有约17920个计算节点，每节点配备两颗Xeon E5系列12核心的中央处理器、三个Xeon Phi 57核心的协处理器（运算加速卡），总内存容量约1.4PB，全局存储总容量约12.4PB。</li><li>0.1元/核时，配置：单节点24核 , Intel Xeon E5-2692 v2 ；主频 2.2GHz, 内存64G，内存频率：DDR3 1333MHz，免费存储500GB</li></ul></li><li><a href="https://www.nscc-tj.cn/cjjs_zy_th3">国家超级计算天津中心同国防科技大学联合研制, 天河三号, （E级）超级计算机</a><ul><li>https://baike.baidu.com/item/%E5%A4%A9%E6%B2%B3%E4%B8%89%E8%99%9F/22052788</li><li><a href="https://www.weidunews.com/article/2024-02-18/1340.html">科技媒体解构中国迄今为止最强大的超级计算机</a></li></ul></li><li><a href="https://nscc.hnu.edu.cn/info/1058/1063.htm">国家超级计算长沙中心</a><ul><li>中心拥有“天河”系列超级计算机、“天河·天马”计算集群等计算平台。其中2022年建成的天河新一代主机系统采用全国产设备，峰值计算性能达200P Flops（64 位精度），可提供1000P Ops人工智能算力（16位精度）</li><li>“天河一号”高性能计算系统, 单节点配置：2*6核Intel Xeon Westmere EP，主频2.93GHz，内存48GB，1块Nvidia M2050 GPU</li><li>CPU：0.10元/核/小时；GPU：2元/块/小时；纯CPU（120核包年）：5万元/年。含GPU（120核包年）：10万元/年。<a href="https://nscc.hnu.edu.cn/info/1004/1414.htm">国家超级计算长沙中心2019年收费基本执行标准 2019</a></li><li>存储服务：天河存储0.5万元/TB/年；其它存储0.3万元/TB/年</li></ul></li><li><a href="http://www.nsccsz.cn/nsccsz2024/index.shtml">国家超级计算深圳中心(深圳云计算中心)</a><ul><li>深圳超算一期, 深圳超算二期</li><li>高性能计算集群约有3000余计算节点，CPU约70000核，总内存容量约230TB，全局存储总容量约20PB</li></ul></li><li><a href="https://www.nsccwx.cn/">神威·太湖之光</a><ul><li>啟用時間: 2015年12月31日</li><li>部署在江蘇省無錫市的國家超級計算無錫中心，由清華大學負責營運</li><li>整机处理器个数 40960个</li></ul></li><li><a href="http://www.blsc.cn/aboutus/">北京超级云计算中心</a><ul><li>成立于2011年，中国科学院和北京市政府共建，由北京北龙超级云计算有限责任公司运营</li><li>推荐使用T6区，配置：单节点96核，按核计费，Intel Xeon Platinum 9242@2.3GHz，384G内存，100Gps 高速网，免费存储500G，价格1毛/核时=0.1/核时。（用的多会有一些折扣）</li></ul></li><li><a href="https://hpc.pku.edu.cn/about.html">北京大学高性能计算校级公共平台</a><ul><li><a href="https://hpc.pku.edu.cn/ug/">北京大学高性能计算校级公共平台用户文档</a></li><li>每个CPU时0.06元, <a href="https://hpc.pku.edu.cn/guide_6.html">收费标准</a></li></ul></li><li><a href="http://hpc.ncpgr.cn/">作物遗传改良全国重点实验室生物信息计算平台</a><ul><li>生物信息高性能计算平台为华中农业大学作物遗传改良全国重点实验室公共技术平台，专注为实验室及全校用户提供高通量测序数据的存储和计算服务。</li><li>平台由155个刀片计算节点、2个GPU节点、6个八路大内存胖节点、多套并行存储组成，总体计算能力理论峰值为380万亿次，CPU核心数为5600核，存储硬件12.7PB(可用容量8.8PB)，主存储读写带宽超过45GB/s。平台预装了1000余款各类生物信息分析软件及相关使用文档、各类常用生物信息数据库，用户可使用本平台进行转录调控测序、单细胞测序、三维基因组测序、表观组测序、基因组组装注释等各类常见组学数据分析。可加速大规模重测序数据分析、复杂大基因组组装注释等需消耗大量资源的分析项目。</li><li>每个CPU时0.1元，并行存储空间每GB每月0.05元。重点室用户3折；重点实验室之外的用户不打折。根据用户上报的上一年度的文章，决定本年度的集群机时折扣。</li></ul></li><li><a href="https://hpc.whu.edu.cn/index.htm">武汉大学超级计算中心</a><ul><li>由475台CPU服务器、168台KNL服务器和174台GPU服务器组成</li><li>武汉大学超级计算中心收费办法（试行）2024年03月29日 <a href="https://hpc.whu.edu.cn/info/1008/1057.htm">link</a></li><li>普通节点 用户类型 CPU机时收费标准（元/CPU核小时）校内用户 0.06; 校外用户 0.10 <a href="https://hpc.whu.edu.cn/info/1008/1057.htm">link</a></li><li>存储空间租用服务</li><li>用户类型 收费标准（元/T年) 校内用户 120; 校外用户 500</li></ul></li><li><a href="https://scc.ustc.edu.cn/2010/0304/c386a1641/page.htm">中国科学技术大学超级计算中心</a><ul><li>瀚海 22 超级计算系统, 瀚海 20 超级计算系统, 曙光 TC4600 百万亿次超级计算系统</li><li><a href="https://scc.ustc.edu.cn/zlsc/user_doc/html/introduction/hanhai22-introduction.html">中国科大超算中心用户使用手册</a></li><li><a href="https://scc.ustc.edu.cn/2024/0228/c416a630736/page.htm">中国科学技术大学超级计算中心收费标准2023年11月15日版</a></li><li>CPU节点 0.02元/CPU核小时</li><li>免费使用1TB的存储容量，超过1TB后为30.00元/TB月</li><li>校外用户收费为校内用户的3倍</li></ul></li><li><a href="https://sc.hdu.edu.cn/">杭州电子科技大学超算中心</a><ul><li>曙光TC6000高性能计算集群有CPU计算节点68个</li><li><a href="https://sc.hdu.edu.cn/wp-content/uploads/2024/05/%E5%85%B3%E4%BA%8E%E5%85%AC%E5%B8%832024%E5%B9%B4%E5%BA%A6%E8%B6%85%E7%AE%97%E4%B8%AD%E5%BF%83%E6%94%B6%E8%B4%B9%E6%A0%87%E5%87%86%E7%9A%84%E9%80%9A%E7%9F%A5.pdf">关于公布 2024 年度超算中心收费标准的通知</a></li><li>校内用户 CPU 节点 0.06 元／核·小时; 存储空间 超出 200GB 部分，每100GB 费用为 10 元/月</li><li>校外用户 CPU 节点 0.12 元／核·小时; 存储空间 超出 200GB 部分，每100GB 费用为 20 元/月</li></ul></li></ul>]]></content>
    
    
    <categories>
      
      <category>HPC</category>
      
    </categories>
    
    
    <tags>
      
      <tag>HPC</tag>
      
      <tag>NWP</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Singularity Container</title>
    <link href="/2024/09/21/Singularity-Container/"/>
    <url>/2024/09/21/Singularity-Container/</url>
    
    <content type="html"><![CDATA[<h1 id="what-is-singularity">What is Singularity</h1><p>Singularity is a container platform to run complex applications on HPC clusters in a simple, portable, and reproducible way. It supports Docker images and is an alternative to Docker, whose security model and execution mode are not well-suited in an HPC environment.</p><p>Major features:</p><ul><li>Verifiable reproducibility and security, using cryptographic signatures, an immutable container image format, and in-memory decryption.</li><li>Integration over isolation by default. Easily make use of GPUs, high speed networks, parallel filesystems on a cluster or server by default.</li><li>Mobility of compute. The single file SIF container format is easy to transport and share.</li><li>A simple, effective security model. You are the same user inside a container as outside, and cannot gain additional privilege on the host system by default.</li></ul><p>容器是一種在隔離環境中運行應用程式的技術。與傳統虛擬機器 （VM） 相比，它們具有多項優勢，例如 更快的部署時間和可重複性。容器還允許開發人員建置和部署軟體，無需擔心底層基礎設施或作業系統詳細資訊。在生物資訊分析中，使用Singularity 容器技術具有以下優點：</p><ul><li>環境一致性和可重複性：專案常常依賴特定版本的軟體和函式庫。 Singularity 容器可以將軟體及其相依性打包在一起，確保分析環境的一致性，無論是在本機、伺服器或雲端平台。這對於實驗的可重複性至關重要，因為它保證了其他研究者可以準確地複製實驗條件，驗證和復現研究結果。</li><li>高效能運算（HPC）友善：Singularity 特別設計來支援高效能運算環境。<strong>它允許使用者以非特權方式運行容器，與 HPC 系統的安全模型相容。這意味著使用者可以在不需要管理員權限的情況下部署和執行容器，這對於多使用者的HPC環境是非常重要的。</strong></li><li>移植性：Singularity 容器可以在任何支援 Singularity 的系統上運行，不受作業系統版本限制。這種高度的移植性確保了生物資訊分析可以輕鬆地從一個運算環境遷移到另一個，無論是從個人電腦到雲端平台，還是在不同的研究機構之間共享。</li><li>資料和資源存取：Singularity 容器可以直接存取宿主機上的檔案系統和網絡，這簡化了資料的管理和傳輸過程。對於需要處理大量資料的生物資訊分析來說，能夠無縫存取外部資料儲存非常重要。</li><li>安全性：與其他容器技術相比，Singularity 提供了更強的安全保障。它防止了容器內的使用者取得宿主機的 root 權限，減少了安全風險。這一點對於確保生物資訊學資料的安全性尤其重要，特別是在處理敏感或受保護的資料時。</li></ul><p>From <a href="https://hpc.pku.edu.cn/_book/guide/soft/singularity.html">北京大學高效能運算平台</a>, <a href="https://hpc.pku.edu.cn/ug/guide/soft/singularity/">北京大學高效能運算校級公共平台使用者文檔</a></p><p>容器技術是一種以應用軟體為中心的虛擬化技術。以應用軟體為單元，將軟體及所有的依賴性打包成容器鏡像，打包後的容器鏡像可直接拷貝到不同的Linux主機上運作。透過容器技術，可以很好的解決安裝軟體時，依賴庫的安裝問題、軟體環境的隔離以及軟體環境的移植問題。</p><ul><li>Singularity為勞倫斯伯克利國家實驗室開發專門用於高效能運算場景的容器技術，Singularity完全基於可移植性進行虛擬化，更加輕量級，部署更快，Singularity目前被廣泛地各高效能運算中心。</li><li>透過Singularity來滿足作業運行的軟體環境，首先是創建或取得軟體鏡像，再將創建好的軟體鏡像上傳到叢集上運行；</li><li><strong>透過Singularity建立軟體映像，需要在有root權限的Linux主機上，或是在配置好fakeroot的Linux主機上以「fakeroot」的身份進行。</strong></li></ul><p>使用容器部署和使用軟體環境的步驟如下： 建構容器鏡像，建構容器鏡像的方式有三種：</p><ul><li>在本機擁有 root 權限的 Linux 主機上安裝 Singularity， 並使用 Singularity 部署容器鏡像；</li><li>在支援 fakeroot 的伺服器上，使用 Singularity 部署容器鏡像；</li><li>直接從倉庫中拉取已經建置好的容器鏡像；</li><li>將容器鏡像上傳到集群，透過 singularity 指令使用建構好的容器鏡像。</li></ul><p>容器的優點和缺點(相較於編譯安裝以及 conda 安裝管理軟體，容器有幾個十分明顯的優勢)</p><p>容器的優勢</p><ul><li>可移植性，透過容器部署好運算環境後，可以直接上傳到社會上高效能運算叢集上使用，也可以直接將容器鏡像分享給課題組的其他成員直接使用，大幅減少了部署環境的時間。</li><li>可複現性，尤其是一些生信軟體，依賴不同的計算工具，換個人安裝，雖然安裝的軟體版本相同，但是依賴的計算工具版本不同，都可能導致計算結果存在差異，而容器的使用可以很好的避免這個問題。</li><li><strong>易管理，不同容器相互隔絕，不存在依賴衝突等問題，例如平台上使用conda 打包了ncl、nco 和ncview，因為這些工具在安裝的時候同時也打包了netcdf 庫，如果用戶在編譯如cesm 和wrf等依賴netcdf 環境的軟體，可能會導致編譯和使用過程出現衝突。</strong></li></ul><p>容器有著這麼多的優點，效能損耗還低，有時候甚至還優於裸機效能，是否就代表所用運算軟體環境都適合用容器部署？答案是否定的，容器其實也有一些缺點需要使用者留意：</p><p>容器的缺點</p><ul><li>使用難度高，相較於裸機上安裝和使用軟體，容器概念的理解、接受還有使用還是需要一定門檻的</li><li><strong>跨節點應用由於要呼叫宿主機的 mpi ，相容性有一定的要求，可移植性需要驗證。</strong> 當然，平台也在致力於跨節點應用容器化的測試與打包</li><li><strong>最佳化問題，例如為了讓軟體運行更快，Intel 編譯軟體過程中可能會使用-Host 參數，讓編譯器根據主機CPU 型號進行指令優化，或者編譯過程中加入AVX512 的支持，這時候如果將鏡像移植到舊款架構的CPU 主機上，可能會導致鏡像無法正常運作軟體環境</strong></li></ul><h1 id="sifsingularity-image-file-sandbox">SIF（Singularity Image File）&amp; Sandbox</h1><p>兩種建立客製化 image 的方法。Singularity 的 image 支持兩種模式 sif 及 sandbox，兩者最大的差異就是 sandbox 會保留用戶在環境中，安裝的軟體及設定的參數。而 sif 則比較接近唯獨模式，僅提供環境運行所需要的套件，但當運行結束後不會保留在過程中安裝的套件。</p><ul><li>SIF（Singularity Image File）：壓縮的讀（read-only）的Singularity鏡件，是⽣產使⽤的主形式。</li><li>Sandbox 可 (writable)的器在形式，是件統中的⼀⽬錄，常⽤於開發或創建⾃⼰的容器，是開發使⽤的主形式。</li></ul><div class="note note-primary">            <p>SIF and sandbox images can be converted to each other.</p>          </div><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># 1. Convert the SIF format container to sandbox;</span><br>singularity build --sandbox centos76 centos76.sif<br><br><span class="hljs-comment"># 2. Convert the sandbox container image to SIF format;</span><br>singularity build centos76.sif centos76<br></code></pre></td></tr></table></figure><h2 id="singularity-container-image">Singularity Container Image</h2><p><a href="https://www.cuhk.edu.hk/itsc/hpc/singularity.html" class="uri">https://www.cuhk.edu.hk/itsc/hpc/singularity.html</a></p><div class="note note-primary">            <p>Note that Singularity versions prior to 3.0 used a slightly different image format, characterised by the extension .simg. You can still find these around in the web; newer Singularity versions are still able to run them.</p>          </div><p>By default, Singularity containers are <strong>read-only image file</strong> that usually end in <strong>.simg</strong>. You can copy the singuarity image file directly from others pre-build container with any copy file command like cp or scp. You can also pull the container from Docker Hub or Sinularity Hub repositories. Base on the container on the repositories, you may custom your own container desire for your job nature.</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#From Docker Hub</span><br>singularity pull docker://ubuntu:latest<br>singularity build centos7_python35.simg docker://centos/python-35-centos7<br>            <br><span class="hljs-comment">#From Singularity Hub</span><br>singularity pull shub://singularityhub/centos<br>singularity build tensorflow.simg shub://opensciencegrid/osgvo-tensorflow<br></code></pre></td></tr></table></figure><h1 id="installing-singularity-platform">Installing Singularity platform</h1><p><a href="https://docs.sylabs.io/guides/3.8/user-guide/quick_start.html" class="uri">https://docs.sylabs.io/guides/3.8/user-guide/quick_start.html</a></p><div class="note note-primary">            <p><strong>Docker and Singularity server installation requires root privileges</strong>, so you can choose to install Docker on your local personal computer to create an image, and then upload it to the server to run it with Singularity.</p>          </div><h2 id="install-development-libraries">install development libraries</h2><p>SingularityCE is a container platform. It allows you to create and run containers that package up pieces of software in a way that is portable and reproducible. You can build a container using SingularityCE on your laptop, and then run it on many of the largest HPC clusters in the world, local university or company clusters, a single server, in the cloud, or on a workstation down the hall. Your container is a single file, and you don’t have to worry about how to install all the software you need on each different operating system.</p><p>SingularityCE的使用不需要管理員權限,但安裝需要管理員權限</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ <span class="hljs-built_in">sudo</span> apt-get update &amp;&amp; <span class="hljs-built_in">sudo</span> apt-get install -y \<br>    build-essential \<br>    libssl-dev \<br>    uuid-dev \<br>    libgpgme11-dev \<br>    squashfs-tools \<br>    libseccomp-dev \<br>    wget \<br>    pkg-config \<br>    git \<br>    cryptsetup<br></code></pre></td></tr></table></figure><h2 id="install-go">Install Go</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ <span class="hljs-built_in">export</span> VERSION=1.16.4 OS=linux ARCH=amd64 &amp;&amp; \  <span class="hljs-comment"># Replace the values as needed</span><br>  wget https://dl.google.com/go/go<span class="hljs-variable">$VERSION</span>.<span class="hljs-variable">$OS</span>-<span class="hljs-variable">$ARCH</span>.tar.gz &amp;&amp; \ <span class="hljs-comment"># Downloads the required Go package</span><br>  <span class="hljs-built_in">sudo</span> tar -C /usr/local -xzvf go<span class="hljs-variable">$VERSION</span>.<span class="hljs-variable">$OS</span>-<span class="hljs-variable">$ARCH</span>.tar.gz &amp;&amp; \ <span class="hljs-comment"># Extracts the archive</span><br>  <span class="hljs-built_in">rm</span> go<span class="hljs-variable">$VERSION</span>.<span class="hljs-variable">$OS</span>-<span class="hljs-variable">$ARCH</span>.tar.gz    <span class="hljs-comment"># Deletes the ``tar`` file</span><br><br>$ <span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;export PATH=/usr/local/go/bin:$PATH&#x27;</span> &gt;&gt; ~/.bashrc &amp;&amp; \<br>  <span class="hljs-built_in">source</span> ~/.bashrc<br></code></pre></td></tr></table></figure><h2 id="download-singularityce-from-a-release">Download SingularityCE from a release</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ <span class="hljs-built_in">export</span> VERSION=3.8.1 &amp;&amp; <span class="hljs-comment"># adjust this as necessary \</span><br>    wget https://github.com/sylabs/singularity/releases/download/v<span class="hljs-variable">$&#123;VERSION&#125;</span>/singularity-ce-<span class="hljs-variable">$&#123;VERSION&#125;</span>.tar.gz &amp;&amp; \<br>    tar -xzf singularity-ce-<span class="hljs-variable">$&#123;VERSION&#125;</span>.tar.gz &amp;&amp; \<br>    <span class="hljs-built_in">cd</span> singularity-ce-<span class="hljs-variable">$&#123;VERSION&#125;</span><br></code></pre></td></tr></table></figure><p>then, Compile</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ ./mconfig &amp;&amp; \<br>    make -C builddir &amp;&amp; \<br>    <span class="hljs-built_in">sudo</span> make -C builddir install<br></code></pre></td></tr></table></figure><p>Finally, check</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ singularity --version<br>$ singularity <span class="hljs-built_in">help</span><br></code></pre></td></tr></table></figure><p>it has shown,</p><figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs vbnet">Linux container platform optimized <span class="hljs-keyword">for</span> High Performance Computing (HPC) <span class="hljs-built_in">and</span><br>Enterprise Performance Computing (EPC)<br><br><span class="hljs-symbol">Usage:</span><br>  singularity [<span class="hljs-keyword">global</span> options...]<br><br><span class="hljs-symbol">Description:</span><br>......<br></code></pre></td></tr></table></figure><h1 id="building-singularity-images">Building Singularity images</h1><div class="note note-primary">            <p>當鏡像庫平台沒有找到適用的現成鏡像，使用者可以在本地將軟體打包成鏡像，上傳到超算上運行。<strong>請注意，使用者只能在自己的電腦上製作鏡像，不能在超算上製作鏡像。</strong></p>          </div><h2 id="example-build-jedi-environment-with-singularity">Example: Build JEDI environment with Singularity</h2><p>From <a href="https://wiki.ucar.edu/display/JEDI/Build+JEDI+environment+with+Singularity" class="uri">https://wiki.ucar.edu/display/JEDI/Build+JEDI+environment+with+Singularity</a></p><h3 id="jcsda-singularity-latest">JCSDA-singularity-latest</h3><p>From <a href="https://singularityhub.github.io/singularityhub-archive/containers/JCSDA-singularity-latest/" class="uri">https://singularityhub.github.io/singularityhub-archive/containers/JCSDA-singularity-latest/</a></p><p>From <a href="https://singularityhub.github.io/singularityhub-archive/containers/MBlaschek-singularity-jupyter-jedi/" class="uri">https://singularityhub.github.io/singularityhub-archive/containers/MBlaschek-singularity-jupyter-jedi/</a></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ singularity --version<br><br>$ singularity pull shub://MBlaschek/singularity-jupyter:jedi<br>$ ll<br>963M Sep 22 14:10 singularity-jupyter_jedi.sif<br><br>$ singularity <span class="hljs-built_in">exec</span> singularity-jupyter_jedi.sif <span class="hljs-built_in">cat</span> /etc/os-release<br>NAME=<span class="hljs-string">&quot;Ubuntu&quot;</span><br>VERSION=<span class="hljs-string">&quot;16.04.6 LTS (Xenial Xerus)&quot;</span><br>ID=ubuntu<br>ID_LIKE=debian<br>PRETTY_NAME=<span class="hljs-string">&quot;Ubuntu 16.04.6 LTS&quot;</span><br>VERSION_ID=<span class="hljs-string">&quot;16.04&quot;</span><br>HOME_URL=<span class="hljs-string">&quot;http://www.ubuntu.com/&quot;</span><br>SUPPORT_URL=<span class="hljs-string">&quot;http://help.ubuntu.com/&quot;</span><br>BUG_REPORT_URL=<span class="hljs-string">&quot;http://bugs.launchpad.net/ubuntu/&quot;</span><br>VERSION_CODENAME=xenial<br>UBUNTU_CODENAME=xenial<br><br>$ singularity inspect singularity-jupyter_jedi.sif<br>MAINTAINER: Mark Miesch<br>SPECIES: JEDI<br>org.label-schema.build-date: Thursday_5_December_2019_10:5:35_UTC<br>org.label-schema.schema-version: 1.0<br>org.label-schema.usage.singularity.deffile.bootstrap: docker<br>org.label-schema.usage.singularity.deffile.from: jcsda/docker_base-gnu-openmpi-dev:latest<br>org.label-schema.usage.singularity.version: 3.4.2<br><br>$ singularity shell -e singularity-jupyter_jedi.sif<br></code></pre></td></tr></table></figure><p>What's inside the JEDI docker image? (note: seems not full set)</p><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs smali">When you start a Singularity container<span class="hljs-built_in"> instance </span>from the xinzhang8noaa-singularity-master.simg, we already prepapre the gnu version 7.2 compilers<span class="hljs-built_in"> and </span>most of the necessary libraiestools for GSI, OOPS, WRF etc., all libraries are installed under /usr/local, which include<br><br>git<br>git flow<br>emacs<br>open-mpi v2.1.0<br>zlib v1.2.11<br>szip v2.1.1<br>jpeg v9b<br>png v1.4.19<br>jasper v1.900.2<br>hdf5 v1.8.17<br>freetype v2.5.5<br>netcdf-c v4.4.11<br>netcdf-fortran v4.4.4<br>lapack v3.7.0<br>parallel-netcdf v1.8.1<br>xerces-c v3.1.4<br>esmf v7.0.0<br>udunites-2 v2.2.24<br>nco v4.6.6<br>grib_api v1.21.0<br>cdo v1.8.2<br>boost v1.65.1<br>eigen3 v3.3.4<br>pio 1.7.1<br>ecbuild<br>eckit<br>fckit<br><br>The major NCEP libraries are also installed at<span class="hljs-keyword"> :</span><br><br>/nwprod/lib/bacio/v2.0.1/libbacio_v2.0.1_4.a<br>/nwprod/lib/bacio/v2.0.1/libbacio_v2.0.1_8.a<br>/nwprod/lib/ip/v2.0.0/libip_v2.0.0_4.a<br>/nwprod/lib/ip/v2.0.0/libip_v2.0.0_8.a<br>/nwprod/lib/ip/v2.0.0/libip_v2.0.0_d.a<br>/nwprod/lib/sigio/v2.0.1/lib/libsigio_v2.0.1_4.a<br>/nwprod/lib/sigio/v2.0.1/libsigio_v2.0.1_4.a<br>/nwprod/lib/sp/v2.0.2/libsp_v2.0.2_4.a<br>/nwprod/lib/sp/v2.0.2/libsp_v2.0.2_8.a<br>/nwprod/lib/sp/v2.0.2/libsp_v2.0.2_d.a<br>/nwprod/lib/w3emc/v2.2.0/libw3emc_v2.2.0_4.a<br>/nwprod/lib/w3emc/v2.2.0/libw3emc_v2.2.0_8.a<br>/nwprod/lib/w3emc/v2.2.0/libw3emc_v2.2.0_d.a<br>/nwprod/lib/w3nco/v2.0.6/libw3nco_v2.0.6_4.a<br>/nwprod/lib/w3nco/v2.0.6/libw3nco_v2.0.6_8.a<br>/nwprod/lib/w3nco/v2.0.6/libw3nco_v2.0.6_d.a<br></code></pre></td></tr></table></figure><ul><li>Download WRF and WPS</li><li>Build WRF and WPS code</li><li>Download MPAS code</li><li>Build MPAS code</li><li>Test MPAS</li></ul><h2 id="example-lammps">Example: LAMMPS</h2><p>LAMMPS 是由桑迪亞國家實驗室開發的一套分子動力學類比的開源程式包。 LAMMPS使用MPI實現多機器平行計算，在新的版本中，支援基於CUDA和OpenCL的GPU計算。其以GNU通用公眾授權條款釋出，因而開源自由。 LAMMPS最初為一美國政府與私人機構合作專案，由美國能源部與另外三所私有企業實驗室合作開發。</p><p>LAMMPS is a classical molecular dynamics code with a focus on materials modeling. It's an acronym for Large-scale Atomic/Molecular Massively Parallel Simulator.</p><p>From <a href="http://docs.hpc.whu.edu.cn/files/whuhpcdocs.wiki/sbatch/singularity.html" class="uri">http://docs.hpc.whu.edu.cn/files/whuhpcdocs.wiki/sbatch/singularity.html</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 创建sandbox；</span><br><span class="hljs-comment"># 这里将创建的sandbox命名为ubuntu20_lammps,并使用docker hub上现有的容器 ubuntu:20.04 作为基础镜像。</span><br>singularity build --sandbox ./ubuntu20_lammps docker://ubuntu:20.04 <span class="hljs-comment"># sudo ??</span><br><br><span class="hljs-comment"># 进入创建好的sandbox，并进行修改；</span><br><span class="hljs-comment"># 其中-w表示可写。进入后singularity会自动挂载的HOME目录，如果是用root用户进入，则会挂载/root目录</span><br>singularity shell -w ./ubuntu20_lammps<br><br><span class="hljs-comment"># Ubuntu下安装LAMMPS并行版需要安装必要的依赖包</span><br>apt update &amp;&amp; apt upgrade -y<br>apt install openmpi-bin openmpi-doc libopenmpi-dev -y<br>apt install gcc g++ gfortran make wget vim -y<br><br><span class="hljs-comment"># 安装fftw</span><br>wget http://www.fftw.org/fftw-3.3.9.tar.gz<br>tar zxvf fftw-3.3.9.tar.gz<br><span class="hljs-built_in">cd</span> fftw-3.3.9<br>./configure --prefix=/opt/software/fftw_3.3.9 --enable-shared --enable-static --enable-fma<br>make -j &amp;&amp; make install<br><br><span class="hljs-comment"># 设置临时fftw环境变量</span><br><span class="hljs-built_in">export</span> PATH=/opt/software/fftw_3.3.9/bin:<span class="hljs-variable">$PATH</span><br><span class="hljs-built_in">export</span> LD_LIBRARY_PATH=/opt/software/fftw_3.3.9/lib:<span class="hljs-variable">$LD_LIBRARY_PATH</span><br><br><span class="hljs-comment"># 安装lammps</span><br>wget https://lammps.sandia.gov/tars/lammps-10Feb21.tar.gz<br>tar zxvf lammps-10Feb21.tar.gz<br><span class="hljs-built_in">cd</span> lammps-10Feb21<br><span class="hljs-built_in">cd</span> src<br>vim MAKE/OPTIONS/Makefile.g++_openmpi <span class="hljs-comment"># 修改如下行</span><br>  FFT_INC = -DFFT_FFTW -I/opt/software/fftw_3.3.9/include<br>  FFT_PATH = -L/opt/software/fftw_3.3.9/lib<br>  FFT_LIB = -lfftw3<br><br>make yes-std<br>make no-lib<br>make -j g++_openmpi<br><br><span class="hljs-built_in">mkdir</span> /opt/software/lammps<br><span class="hljs-built_in">cp</span> ./lmp_g++_openmpi /opt/software/lammps/<br><br><span class="hljs-comment"># 设置临时lammps环境变量</span><br><span class="hljs-built_in">export</span> PATH=/opt/software/lammps:<span class="hljs-variable">$PATH</span><br><br><span class="hljs-comment"># 验证(容器内)</span><br><span class="hljs-built_in">cd</span> /root<br><span class="hljs-built_in">cp</span> /opt/lammps-10Feb21/bench/in.lj .<br>mpirun --allow-run-as-root -np 2 --mca btl ^openib lmp_g++_openmpi -<span class="hljs-keyword">in</span> in.lj<br><br><br><span class="hljs-comment"># 退出容器，设置永久环境变量(宿主机)</span><br>vim ./ubuntu20_lammps/environment<br><span class="hljs-comment"># 加入下面两行</span><br><span class="hljs-built_in">export</span> PATH=/opt/software/fftw_3.3.9/bin:/opt/software/lammps:<span class="hljs-variable">$PATH</span><br><span class="hljs-built_in">export</span> LD_LIBRARY_PATH=/opt/software/fftw_3.3.9/lib:<span class="hljs-variable">$LD_LIBRARY_PATH</span><br><br><span class="hljs-comment"># 验证(宿主机)</span><br>singularity <span class="hljs-built_in">exec</span> ./ubuntu20_lammps mpirun --allow-run-as-root -np 2 --mca btl ^openib lmp_g++_openmpi -<span class="hljs-keyword">in</span> in.lj<br><br><span class="hljs-comment"># 把修改好的sandbox打包成sif格式；</span><br><span class="hljs-comment"># 删除不必要的安装包, 如 fftw-3.3.9.tar.gz lammps-10Feb21.tar.gz</span><br><span class="hljs-comment"># 使用前面创建的sandbox目录生成singularity image file格式镜像。</span><br>singularity build ubuntu20_lammps.sif ./ubuntu20_lammps<br></code></pre></td></tr></table></figure><p>then, run it on HPC,</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/bash</span><br><br><span class="hljs-comment">#SBATCH --partition=hpxg</span><br><span class="hljs-comment">#SBATCH --nodes=1</span><br><span class="hljs-comment">#SBATCH --ntasks-per-node=2</span><br><span class="hljs-comment">#SBATCH --time=1:00:00</span><br><br><span class="hljs-comment"># 加载超算平台预安装的 singularity</span><br>module load singularity<br><span class="hljs-comment"># or load by micromamba</span><br><br><span class="hljs-comment"># 测试in.lj算例</span><br>singularity <span class="hljs-built_in">exec</span> ubuntu20_lammps.sif mpirun -np 2 --mca btl ^openib lmp_g++_openmpi -<span class="hljs-keyword">in</span> in.lj<br></code></pre></td></tr></table></figure><h2 id="customize-definition-file-.def">Customize Definition File .def</h2><p>File 內容主要分為 Header 和 Sections 兩部分：</p><ul><li>Header：定義 base 映像檔的來源 (例：docker, library, yum…等)。</li><li>Sections：有多種選項可設定，主要會使用以下 2 個項目：<ul><li>%post：建立容器後將執行的內容。</li><li>%environment：容器建立好後，會將程式的環境變數會放到 /environment 內。</li></ul></li></ul><p>Execute definition file to create a container,</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ <span class="hljs-built_in">sudo</span> singularity build &lt;CONTAINER_NAME&gt;.sif &lt;DEF_FILE_NAME&gt;.def<br></code></pre></td></tr></table></figure><p>Header,</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">Bootstrap: library<br>From: debian:7<br></code></pre></td></tr></table></figure><p>Preferred bootstrap agents</p><ul><li>library (images hosted on the Container Library)</li><li>docker (images hosted on Docker Hub)</li><li>shub (images hosted on Singularity Hub)</li><li>oras (images from supporting OCI registries)</li><li>scratch (a flexible option for building a container from scratch)</li></ul><p>Here is an example definition file that uses every available section. We will discuss each section in turn. It is not necessary to include every section (or any sections at all) within a def file. Furthermore, multiple sections of the same name can be included and will be appended to one another during the build process.</p><p><a href="https://docs.sylabs.io/guides/3.7/user-guide/definition_files.html" class="uri">https://docs.sylabs.io/guides/3.7/user-guide/definition_files.html</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs bash">Bootstrap: library<br>From: ubuntu:18.04<br>Stage: build<br><br>%setup<br>    <span class="hljs-built_in">touch</span> /file1<br>    <span class="hljs-built_in">touch</span> <span class="hljs-variable">$&#123;SINGULARITY_ROOTFS&#125;</span>/file2<br><br>%files<br>    /file1<br>    /file1 /opt<br><br>%environment<br>    <span class="hljs-built_in">export</span> LISTEN_PORT=12345<br>    <span class="hljs-built_in">export</span> LC_ALL=C<br><br>%post<br>    apt-get update &amp;&amp; apt-get install -y netcat<br>    NOW=`<span class="hljs-built_in">date</span>`<br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;export NOW=\&quot;<span class="hljs-variable">$&#123;NOW&#125;</span>\&quot;&quot;</span> &gt;&gt; <span class="hljs-variable">$SINGULARITY_ENVIRONMENT</span><br><br>%runscript<br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Container was created <span class="hljs-variable">$NOW</span>&quot;</span><br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Arguments received: $*&quot;</span><br>    <span class="hljs-built_in">exec</span> <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$@</span>&quot;</span><br><br>%startscript<br>    nc -lp <span class="hljs-variable">$LISTEN_PORT</span><br><br>%<span class="hljs-built_in">test</span><br>    grep -q NAME=\&quot;Ubuntu\&quot; /etc/os-release<br>    <span class="hljs-keyword">if</span> [ $? -eq 0 ]; <span class="hljs-keyword">then</span><br>        <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Container base is Ubuntu as expected.&quot;</span><br>    <span class="hljs-keyword">else</span><br>        <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Container base is not Ubuntu.&quot;</span><br>        <span class="hljs-built_in">exit</span> 1<br>    <span class="hljs-keyword">fi</span><br><br>%labels<br>    Author d@sylabs.io<br>    Version v0.0.1<br><br>%<span class="hljs-built_in">help</span><br>    This is a demo container used to illustrate a def file that uses all supported sections.<br></code></pre></td></tr></table></figure><h3 id="case">case:</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><code class="hljs sh">BootStrap: library<br>From: ubuntu:18.04<br><br>%post<br>    apt-get -y update<br>    apt-get -y upgrade<br><br>    apt-get install -y \<br>    build-essential \<br>    vim \<br>    wget \<br>    curl \<br>    libssl-dev \<br>    git \<br>    tar \<br>    openssh-client \<br>    gzip \<br>    ca-certificates<br><br>    apt-get install -y bzip2<br><br>    apt-get clean<br><br>    <span class="hljs-built_in">export</span> SHELL=/bin/bash<br>    <span class="hljs-built_in">export</span> PATH=/root/.local/bin:<span class="hljs-variable">$PATH</span><br>    <br>    wget micro.mamba.pm/install.sh<br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;All paths are default.&quot;</span><br>    sed -i -e <span class="hljs-string">&#x27;s/-t 0/1 == 0/g&#x27;</span> install.sh<br>    <span class="hljs-built_in">chmod</span> +x install.sh<br>    bash install.sh<br><br>    <span class="hljs-comment"># &gt;&gt;&gt; mamba initialize &gt;&gt;&gt;</span><br>    <span class="hljs-comment"># !! Contents within this block are managed by &#x27;mamba init&#x27; !!</span><br>    <span class="hljs-built_in">export</span> MAMBA_EXE=<span class="hljs-string">&#x27;/root/.local/bin/micromamba&#x27;</span>;<br>    <span class="hljs-built_in">export</span> MAMBA_ROOT_PREFIX=<span class="hljs-string">&#x27;/root/micromamba&#x27;</span>;<br>    __mamba_setup=<span class="hljs-string">&quot;<span class="hljs-subst">$(<span class="hljs-string">&quot;<span class="hljs-variable">$MAMBA_EXE</span>&quot;</span> shell hook --shell bash --root-prefix <span class="hljs-string">&quot;<span class="hljs-variable">$MAMBA_ROOT_PREFIX</span>&quot;</span> 2&gt; /dev/null)</span>&quot;</span><br>    <span class="hljs-keyword">if</span> [ $? -eq 0 ]; <span class="hljs-keyword">then</span><br>        <span class="hljs-built_in">eval</span> <span class="hljs-string">&quot;<span class="hljs-variable">$__mamba_setup</span>&quot;</span><br>    <span class="hljs-keyword">else</span><br>        <span class="hljs-built_in">alias</span> micromamba=<span class="hljs-string">&quot;<span class="hljs-variable">$MAMBA_EXE</span>&quot;</span>  <span class="hljs-comment"># Fallback on help from mamba activate</span><br>    <span class="hljs-keyword">fi</span><br>    <span class="hljs-built_in">unset</span> __mamba_setup<br><br>    micromamba <span class="hljs-built_in">env</span> list<br><br>%environment<br>    <span class="hljs-built_in">export</span> SHELL=/bin/bash<br>    <span class="hljs-built_in">export</span> LC_ALL=C<br>    <span class="hljs-built_in">export</span> PATH=/usr/local/bin:<span class="hljs-variable">$PATH</span><br>    <span class="hljs-built_in">export</span> PATH=/root/.local/bin:<span class="hljs-variable">$PATH</span><br><br>    <span class="hljs-comment"># &gt;&gt;&gt; mamba initialize &gt;&gt;&gt;</span><br>    <span class="hljs-comment"># !! Contents within this block are managed by &#x27;mamba init&#x27; !!</span><br>    <span class="hljs-built_in">export</span> MAMBA_EXE=<span class="hljs-string">&#x27;/root/.local/bin/micromamba&#x27;</span>;<br>    <span class="hljs-built_in">export</span> MAMBA_ROOT_PREFIX=<span class="hljs-string">&#x27;/root/micromamba&#x27;</span>;<br>    __mamba_setup=<span class="hljs-string">&quot;<span class="hljs-subst">$(<span class="hljs-string">&quot;<span class="hljs-variable">$MAMBA_EXE</span>&quot;</span> shell hook --shell bash --root-prefix <span class="hljs-string">&quot;<span class="hljs-variable">$MAMBA_ROOT_PREFIX</span>&quot;</span> 2&gt; /dev/null)</span>&quot;</span><br>    <span class="hljs-keyword">if</span> [ $? -eq 0 ]; <span class="hljs-keyword">then</span><br>        <span class="hljs-built_in">eval</span> <span class="hljs-string">&quot;<span class="hljs-variable">$__mamba_setup</span>&quot;</span><br>    <span class="hljs-keyword">else</span><br>        <span class="hljs-built_in">alias</span> micromamba=<span class="hljs-string">&quot;<span class="hljs-variable">$MAMBA_EXE</span>&quot;</span>  <span class="hljs-comment"># Fallback on help from mamba activate</span><br>    <span class="hljs-keyword">fi</span><br>    <span class="hljs-built_in">unset</span> __mamba_setup<br><br>%runscript<br>    hostname<br><br>%labels<br>    Author wpsze<br>    Version v0.0.1<br><br>%<span class="hljs-built_in">help</span><br>  Singularity image used get dependencies from micromamba.<br></code></pre></td></tr></table></figure><p>(Fail, why??) then,</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ <span class="hljs-built_in">sudo</span> singularity build test.sif test.def<br></code></pre></td></tr></table></figure><h2 id="by-sanbox">By Sanbox</h2><p>建立沙盒容器</p><p>若需測試套件是否與容器環境相容時，您可以建立「沙盒容器」，既不影響原容器映像檔內容，也無需重建立容器，又可在容器內安裝或進行操作：</p><p>請先建立沙盒資料夾，放入容器映像檔的所有內容</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ <span class="hljs-built_in">sudo</span> singularity build --sandbox &lt;FOLDER_NAME&gt; docker://nvidia/cuda:10.1-devel-ubuntu18.04<br></code></pre></td></tr></table></figure><p><strong>使用 shell 方式進入沙盒容器內，並具有寫入的權限。</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ <span class="hljs-built_in">sudo</span> singularity shell --writable &lt;FOLDER_NAME&gt;/<br></code></pre></td></tr></table></figure><p>即可利用 apt 使用以下指令更新並安裝套件</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ apt-get update<br>$ apt-get install wget<br></code></pre></td></tr></table></figure><p>使用沙盒建立 Singularity 容器映像檔</p><div class="note note-primary">            <p>附註：由於沙盒未將套件寫入 definition file，您無法紀錄容器內有哪些套件，維護不易，較不推薦使用此方式建立容器映像檔。建議使用客製化 Singularity 容器之方式。</p>          </div><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ <span class="hljs-built_in">sudo</span> singularity build &lt;CONTAINER_NAME&gt;.sif &lt;FOLDER_NAME&gt;/<br></code></pre></td></tr></table></figure><ul><li>Assume that the sandbox image to be deleted is named molspin</li><li>First, enter the image to be deleted in readable mode<ul><li>singularity shell --fakeroot -w molspin</li></ul></li><li>Delete all files created based on fakeroot in the container<ul><li>rm -rf /* 1&gt;/dev/null 2&gt;&amp;1</li></ul></li><li>Exit the image<ul><li>exit</li></ul></li><li>Upload the created software image to the high-performance computing cluster and load the singularity software environment</li><li>Delete the rest<ul><li>rm -rf molspin</li></ul></li></ul><h2 id="example-nmap">Example: nmap</h2><h1 id="conda-install-singularity">Conda install singularity</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ micromamba <span class="hljs-built_in">env</span> create -n singularity<br>$ micromamba activate singularity<br>$ micromamba install conda-forge::singularity<br></code></pre></td></tr></table></figure><p>version = linux-ppc64le/singularity-3.8.7-hff88825_0.tar.bz2?</p><h1 id="running-singularity-images">Running Singularity images</h1><h2 id="build-or-pull">build or pull</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ singularity build ./jason-tensorflow.sif docker://tensorflow/tensorflow:latest-gpu<br>$ singularity pull ./jason-tensorflow.sif docker://tensorflow/tensorflow:latestgpu<br>$ singularity pull library://lolcow<br>$ <span class="hljs-built_in">ls</span><br>lolcow_latest.sif<br></code></pre></td></tr></table></figure><div class="note note-primary">            <ul><li>Inspect will show you labels, environment variables, and scripts associated with the image determined by the flags you pass.</li></ul>          </div><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ singularity inspect my-container.sif<br></code></pre></td></tr></table></figure><h2 id="run-exec-shell">run, exec, shell</h2><div class="note note-primary">            <p>singularity run Run the user-defined default command within a container</p>          </div><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ singularity run my-container.sif<br><br>$ singularity run lolcow_latest.sif <br> ______________________________<br>&lt; Sun Sep 22 00:17:43 HKT 2024 &gt;<br> ------------------------------<br>        \   ^__^<br>         \  (oo)\_______<br>            (__)\       )\/\<br>                ||----w |<br>                ||     ||<br></code></pre></td></tr></table></figure><div class="note note-primary">            <p>singularity exec Run a command within a container</p>          </div><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ singularity <span class="hljs-built_in">exec</span> my-container.sif my-command<br><br>$ singularity <span class="hljs-built_in">exec</span> lolcow_latest.sif cowsay WRF-MPAS<br> __________<br>&lt; WRF-MPAS &gt;<br> ----------<br>        \   ^__^<br>         \  (oo)\_______<br>            (__)\       )\/\<br>                ||----w |<br>                ||     ||<br></code></pre></td></tr></table></figure><div class="note note-primary">            <p>singularity shell Run a shell within a container</p>          </div><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ singularity shell my-container.sif<br><br>$ singularity shell lolcow_latest.sif <br>Singularity&gt; cowsay here is shell<br> _______________<br>&lt; here is shell &gt;<br> ---------------<br>        \   ^__^<br>         \  (oo)\_______<br>            (__)\       )\/\<br>                ||----w |<br>                ||     ||<br>Singularity&gt; cowsay going <br> _______<br>&lt; going &gt;<br> -------<br>        \   ^__^<br>         \  (oo)\_______<br>            (__)\       )\/\<br>                ||----w |<br>                ||     ||<br>Singularity&gt; <span class="hljs-built_in">exit</span><br><span class="hljs-built_in">exit</span><br></code></pre></td></tr></table></figure><h1 id="specifying-bind-paths">Specifying bind paths</h1><p>開發容器的目的之一主要是為了解決依賴函式庫的安裝、軟體環境的隔離、以及軟體環境的移植問題。因此，<strong>容器的核心特性之一就是它們的檔案系統與宿主機相隔離。</strong> 如果我們查看一個 singularity 容器的根目錄，也會看到與 Linux 主機根目錄相似的結構。這意味著容器內的應用程式只能看到（並與之互動）這個封閉環境中的檔案和目錄。與 Linux 下掛載（mount）外接硬碟設備類似，容器同樣需要透過掛載 (bind) 的操作與我們宿主機上的檔案系統互動。<a href="https://juejin.cn/post/7345293582365868041">link</a></p><p>當呼叫容器時，Singularity 會將主機作業系統 “swap” 為容器中的作業系統，導致我們無法存取主機檔案系統。<strong>然而，在日常使用場景中，已安裝至容器中的應用程式的輸入和輸出檔案往往儲存在主機檔案系統中，因此，我們需要從容器內讀取和寫入主機系統上的檔案。</strong></p><ul><li>singularity 使用 --bind/-B 宿主機目錄:容器內目錄 選項將主機系統上的目錄對應到容器內的目錄。這允許我們從容器內部存取主機上的文件，從而在主機系統上讀寫資料。</li></ul><p>如需要將多個目錄綁定到 Singularity 容器中，並且長期保持不變，我們可以進一步將這個變數寫入 .bashrc 檔案中。</p><p>Here’s an example of using the --bind option and binding /data on the host to /mnt in the container (/mnt does not need to already exist in the container):</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ <span class="hljs-built_in">ls</span> /data<br>bar  foo<br><br>$ singularity <span class="hljs-built_in">exec</span> --<span class="hljs-built_in">bind</span> /data:/mnt my_container.sif <span class="hljs-built_in">ls</span> /mnt<br>bar  foo<br></code></pre></td></tr></table></figure><p>You can bind multiple directories in a single command with this syntax:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ singularity shell --<span class="hljs-built_in">bind</span> /opt,/data:/mnt my_container.sif<br></code></pre></td></tr></table></figure><p>or</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ <span class="hljs-built_in">export</span> SINGULARITY_BIND=<span class="hljs-string">&quot;/opt,/data:/mnt&quot;</span><br><br>$ singularity shell my_container.sif<br></code></pre></td></tr></table></figure><h1 id="references">References</h1><ol type="1"><li><a href="https://docs.sylabs.io/guides/2.6/user-guide/singularity_and_docker.html">Singularity and Docker</a></li><li><a href="https://hpc.hku.hk/hpc/software/singularity-container/">HKU Singularity Container</a></li><li><a href="https://cloud.sylabs.io/library">Sylabs Cloud</a><ol type="1"><li>singularity pull ubuntu.sif library://library/default/ubuntu:21.04</li></ol></li><li><a href="https://ngc.nvidia.com/">NVIDIA NGC</a><ol type="1"><li>NVIDIA官方自己构建的pytorch和TensorFlow的容器镜像，每个里面包含了cuda、显卡驱动以及cudnn，据说比自己装的速度要快，使用时singularity需要 --nv 选项。</li></ol></li><li><a href="https://hub.docker.com/">Docker Hub</a><ol type="1"><li>singularity pull ubuntu.sif docker://ubuntu:latest</li></ol></li><li><a href="https://singularityhub.github.io/singularityhub-archive/">Singularity Hub Archive</a></li><li><a href="https://www.cnblogs.com/dechinphy/p/pytorch.html">从零开始制作PyTorch的Singularity容器镜像</a></li><li><a href="https://man.twcc.ai/@twccdocs/howto-twnia2-create-sglrt-container-zh">建立台灣杉二號的容器</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>HPC</tag>
      
      <tag>NWP</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>WRF | Predicting lightning activity using WRF-ELEC model</title>
    <link href="/2024/09/20/wrf4-elec-lightning/"/>
    <url>/2024/09/20/wrf4-elec-lightning/</url>
    
    <content type="html"><![CDATA[<h1 id="wrf-elec-model">WRF-ELEC model</h1><p>WRF-ELEC provides basic electrification and <strong>lightning using the NSSL microphysics scheme</strong>. The electrification parameterizations are based on past work in modeling. The basics of the charge separation schemes comes from Mansell et al. (2005). Their use in the <strong>NSSL 2-moment microphysics</strong> is shown in Mansell et al. 2010 and Mansell and Ziegler (2013). First implementation into WRF is described by Fierro et al. (2013), which includes details of the basic discharge scheme (cylindrical discharge regions centered on lightning initiation points).</p><ul><li>Mansell et al. 2005: Charge structure and lightning sensitivity in a simulated multicell thunderstorm. J. Geophys. Res., 110, D12101, doi:10.1029/2004JD005287</li><li>Mansell, E. R., C. L. Ziegler, and E. C. Bruning, 2010: Simulated electrification of a small thunderstorm with two-moment bulk microphysics. J. Atmos. Sci., 67, 171-194, doi:10. 1175/2009JAS2965.1.</li><li><strong>Fierro, A. O., E.R. Mansell, C. Ziegler and D. R. MacGorman 2013: The implementation of an explicit charging and discharge lightning scheme within the WRF-ARW model: Benchmark simulations of a continental squall line, a tropical cyclone and a winter storm. Monthly Weather Review, Volume 141, 2390-2415</strong> (see below)</li></ul><p>If you have trouble with this option please contact the developers directly (i.e., not wrf_help):</p><blockquote><p>Ted Mansell (Ted.Mansell <em>at</em> noaa.gov)<br />Alexandre Fierro (Alex.Fierro <em>at</em> noaa.gov)</p></blockquote><h2 id="boxmg">BoxMG</h2><ul><li>Black Box Multigrid (BoxMG) algorithm</li></ul><p>From <a href="https://github.com/MicroTed/wrf4-elec/blob/7c90e71bdc4db527d0ec034804e4fd200cdacf28/doc/README.electricity#L41" class="uri">https://github.com/MicroTed/wrf4-elec/blob/7c90e71bdc4db527d0ec034804e4fd200cdacf28/doc/README.electricity#L41</a>,</p><p>The <strong>BoxMG elliptic equation solver</strong> is required for WRF-ELEC to calculate the 3D electric potential. This library is distributed at the moment as a source code archive at</p><ul><li><a href="http://sourceforge.net/projects/boxmg4wrf/" class="uri">http://sourceforge.net/projects/boxmg4wrf/</a></li></ul><p>The git repository is recommended as the most up-to-date. Note that the code has only been compiled for Intel/AMD (non-Itanium) architecture under Linux and OS X using either Intel Fortran or GNU compilers. (For problems, contact <a href="mailto:ted.mansell@noaa.gov" class="email">ted.mansell@noaa.gov</a>)</p><div class="note note-primary">            <p><strong>BoxMG needs to be installed before configuring WRF.</strong></p>          </div><p>Install the code where you want the libraries to be and then follow the instructions in the INSTALL document:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ git <span class="hljs-built_in">clone</span> https://git.code.sf.net/p/boxmg4wrf/git boxmg4wrf<br>$ ll<br>34M boxmg4wrf<br></code></pre></td></tr></table></figure><ul><li><a href="https://sourceforge.net/p/boxmg4wrf/git/ci/main/tree/" class="uri">https://sourceforge.net/p/boxmg4wrf/git/ci/main/tree/</a><ul><li>Branches: main, boxmg4wrf-0.1, master, release0.0</li></ul></li></ul><p>git logg (2024-09-24)</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">* d8e89bc (HEAD -&gt; master, origin/master, origin/HEAD)  Fix mpi calls <span class="hljs-keyword">to</span> use single <span class="hljs-keyword">or</span> <span class="hljs-type">double</span> <span class="hljs-type">precision</span> <span class="hljs-keyword">as</span> <span class="hljs-keyword">set</span> <span class="hljs-keyword">by</span> RKIND (<span class="hljs-number">11</span> months ago) &lt;Ted Mansell&gt;<br>* <span class="hljs-number">817</span>df7a  <span class="hljs-keyword">Update</span> <span class="hljs-keyword">to</span> compile <span class="hljs-keyword">on</span> M1 mac (assumes <span class="hljs-keyword">using</span> gfortran <span class="hljs-keyword">as</span> compiler) (<span class="hljs-number">2</span> years ago) &lt;Ted Mansell&gt;<br>* <span class="hljs-number">3</span>cee0c8 (origin/boxmg4wrf<span class="hljs-number">-0.1</span>) Added <span class="hljs-keyword">comment</span> (<span class="hljs-number">2</span> years, <span class="hljs-number">9</span> months ago) &lt;Ted Mansell&gt;<br>* <span class="hljs-number">71</span>c38c1 - Added a <span class="hljs-keyword">check</span> <span class="hljs-keyword">for</span> gcc <span class="hljs-keyword">version</span> <span class="hljs-number">10</span> <span class="hljs-keyword">or</span> greater <span class="hljs-keyword">to</span> <span class="hljs-keyword">add</span> the -fallow-argument-mismatch compile flag - Updates <span class="hljs-keyword">to</span> test example ex_direct_1_f90 (e.g., <span class="hljs-type">double</span> quotes <span class="hljs-keyword">on</span> preprocessed <span class="hljs-keyword">include</span> files) (<span class="hljs-number">2</span> years, <span class="hljs-number">9</span> months ago) &lt;Ted Mansell&gt;<br>* <span class="hljs-number">0e19676</span> erm: <span class="hljs-keyword">add</span> sgl/dbl suffix <span class="hljs-keyword">for</span> libs (<span class="hljs-number">3</span> years, <span class="hljs-number">7</span> months ago) &lt;Ted Mansell&gt;<br>* <span class="hljs-number">6682023</span> erm: turn <span class="hljs-keyword">off</span> <span class="hljs-keyword">all</span> but the one that works (currently) (<span class="hljs-number">3</span> years, <span class="hljs-number">7</span> months ago) &lt;Ted Mansell&gt;<br>* <span class="hljs-number">3644096</span> erm: added dependcies <span class="hljs-keyword">for</span> &quot;check&quot; (<span class="hljs-number">3</span> years, <span class="hljs-number">7</span> months ago) &lt;Ted Mansell&gt;<br>* d98ff35 erm: Minor changes <span class="hljs-keyword">for</span> clarity (hopefully) (<span class="hljs-number">3</span> years, <span class="hljs-number">7</span> months ago) &lt;Ted Mansell&gt;<br>* aaaa34c erm: minor updates (<span class="hljs-number">3</span> years, <span class="hljs-number">7</span> months ago) &lt;Ted Mansell&gt;<br>* b54bb70 erm: added .gitignore file (<span class="hljs-number">3</span> years, <span class="hljs-number">7</span> months ago) &lt;Ted Mansell&gt;<br>* d96cb63 (origin/release0<span class="hljs-number">.0</span>) Initial <span class="hljs-keyword">commit</span> (<span class="hljs-number">3</span> years, <span class="hljs-number">7</span> months ago) &lt;Ted Mansell&gt;<br></code></pre></td></tr></table></figure><p>Compile:</p><ul><li>wrf_env.sh: go to <a href="https://waipangsze.github.io/2023/04/25/WRF_installation_on_a_Linux_based_machine/" class="uri">https://waipangsze.github.io/2023/04/25/WRF_installation_on_a_Linux_based_machine/</a></li></ul><p>To check environment variables,</p><ul><li>/ARCH/machine</li></ul><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs perl">ife<span class="hljs-string">q (<span class="hljs-variable">$(</span>findstring x86_64,<span class="hljs-variable">$(</span>UNAME_M)</span>),x86_64)<br><br>  BOXMG_CPU = AMD64<br></code></pre></td></tr></table></figure><ul><li>add these to Makefile to print variables,</li></ul><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs gams"><span class="hljs-symbol">$</span>(info <span class="hljs-symbol">$</span><span class="hljs-symbol">$</span>BOXMG_OS is [<span class="hljs-symbol">$</span>&#123;BOXMG_OS&#125;])<br><span class="hljs-symbol">$</span>(info <span class="hljs-symbol">$</span><span class="hljs-symbol">$</span>BOXMG_CPU is [<span class="hljs-symbol">$</span>&#123;BOXMG_CPU&#125;])<br><span class="hljs-symbol">$</span>(info <span class="hljs-symbol">$</span><span class="hljs-symbol">$</span>BOXMG_COMPILER is [<span class="hljs-symbol">$</span>&#123;BOXMG_COMPILER&#125;])<br><span class="hljs-symbol">$</span>(info <span class="hljs-symbol">$</span><span class="hljs-symbol">$</span>BOXMG_ARCHmake is [<span class="hljs-symbol">$</span>&#123;BOXMG_ARCHmake&#125;])<br><span class="hljs-symbol">$</span>(info <span class="hljs-symbol">$</span><span class="hljs-symbol">$</span>BOXMG_ARCH is [<span class="hljs-symbol">$</span>&#123;BOXMG_ARCH&#125;])<br><span class="hljs-symbol">$</span>(info <span class="hljs-symbol">$</span><span class="hljs-symbol">$</span>BOXMG_PRECISION is [<span class="hljs-symbol">$</span>&#123;BOXMG_PRECISION&#125;])<br><span class="hljs-symbol">$</span>(info <span class="hljs-symbol">$</span><span class="hljs-symbol">$</span>BOXMG_MPI is [<span class="hljs-symbol">$</span>&#123;BOXMG_MPI&#125;])<br></code></pre></td></tr></table></figure><ul><li>$ make</li></ul><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs stylus"> $ uname -<span class="hljs-selector-tag">a</span><br>Linux xxx <span class="hljs-number">4.18</span>.<span class="hljs-number">0</span>-<span class="hljs-number">477.10</span>.<span class="hljs-number">1</span><span class="hljs-selector-class">.el8_8</span><span class="hljs-selector-class">.x86_64</span> #<span class="hljs-number">1</span> SMP Tue May <span class="hljs-number">16</span> <span class="hljs-number">11</span>:<span class="hljs-number">38</span>:<span class="hljs-number">37</span> UTC <span class="hljs-number">2023</span> x86_64 x86_64 x86_64 GNU/Linux<br><br><span class="hljs-variable">$BOXMG_OS</span> is <span class="hljs-selector-attr">[Linux]</span><br><span class="hljs-variable">$BOXMG_CPU</span> is <span class="hljs-selector-attr">[AMD64]</span><br><span class="hljs-variable">$BOXMG_COMPILER</span> is <span class="hljs-selector-attr">[gnu]</span><br><span class="hljs-variable">$BOXMG_ARCHmake</span> is <span class="hljs-selector-attr">[./ARCH]</span><br><span class="hljs-variable">$BOXMG_ARCH</span> is <span class="hljs-selector-attr">[Linux-AMD64]</span><br><span class="hljs-variable">$BOXMG_PRECISION</span> is <span class="hljs-selector-attr">[SINGLE]</span><br><span class="hljs-variable">$BOXMG_MPI</span> is <span class="hljs-selector-attr">[yes]</span><br></code></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/bash</span><br><span class="hljs-built_in">export</span> WRF_ENV=<span class="hljs-string">&quot;/home/wpsze/WRF/WRFv440/wrf_env.sh&quot;</span><br><span class="hljs-built_in">source</span> <span class="hljs-variable">$&#123;WRF_ENV&#125;</span><br><br>gcc --version<br>gfortran --version<br>mpirun --version<br><span class="hljs-built_in">which</span> mpif90 &amp; mpif90 --version<br><span class="hljs-built_in">which</span> mpif77 <span class="hljs-comment"># Must</span><br><br><span class="hljs-built_in">export</span> BOXMG_MPI=<span class="hljs-built_in">yes</span><br>make<br></code></pre></td></tr></table></figure><div class="note note-success">            <p>The libraries ( libboxmg_opt_sgl.a, libboxmg-extras_opt_sgl.a ) will be in ./lib.</p>          </div><p>install process:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sh">.......<br>.......<br>gfortran   -funderscoring -DRKIND=4  -Waliasing -Wsurprising -O3  -c -o BMG_rand.o BMG_rand.f<br>ar csrv  ../../lib/libboxmg-extras_opt_sgl.a BMG_rand.o<br>a - BMG_rand.o<br><span class="hljs-built_in">rm</span> BMG_rand.o<br><br> $ ll lib<br>total 1.6M<br>drwxrwxr-x  2 wpsze wpsze  33K Sep 23 16:32 ./<br>drwxrwxr-x 11 wpsze wpsze  33K Sep 23 16:28 ../<br>-rw-rw-r--  1 wpsze wpsze    0 Sep 23 16:13 .keepme<br>-rw-rw-r--  1 wpsze wpsze 1.4M Sep 23 16:32 libboxmg-extras_opt_sgl.a<br>-rw-rw-r--  1 wpsze wpsze 1.4M Sep 23 16:30 libboxmg_opt_sgl.a<br></code></pre></td></tr></table></figure><ul><li><a href="https://forum.mmm.ucar.edu/threads/error-while-making-boxmg.12977/">Error while Making BoxMG?</a></li></ul><h3 id="test-boxmg">Test BoxMG</h3><ol type="1"><li>Go to /tests and make</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/bash</span><br><span class="hljs-built_in">export</span> WRF_ENV=<span class="hljs-string">&quot;/home/wpsze/WRF/WRFv440/wrf_env.sh&quot;</span><br><span class="hljs-built_in">source</span> <span class="hljs-variable">$&#123;WRF_ENV&#125;</span><br><br>gcc --version<br>gfortran --version<br>mpirun --version<br><span class="hljs-built_in">which</span> mpif90 &amp; mpif90 --version<br><span class="hljs-built_in">which</span> mpif77<br><br><span class="hljs-built_in">export</span> LDFLAGS=-L/EM/wpsze/WRF/WRF4-elec/wrf_install/boxmg4wrf/lib<br><span class="hljs-built_in">export</span> LD_LIBRARY_PATH=/EM/wpsze/WRF/WRF4-elec/wrf_install/boxmg4wrf/lib:<span class="hljs-variable">$LD_LIBRARY_PATH</span><br><span class="hljs-built_in">export</span> CPPFLAGS=-I/EM/wpsze/WRF/WRF4-elec/wrf_install/boxmg4wrf/include<br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$&#123;LD_LIBRARY_PATH&#125;</span><br><br><span class="hljs-built_in">export</span> BOXMG_MPI=<span class="hljs-built_in">yes</span><br><br>make<br></code></pre></td></tr></table></figure><p>it shows,</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">- <span class="hljs-keyword">building </span><span class="hljs-keyword">boxmg-sym-std-2D </span>objects in libboxmg_opt_sgl.a ... <br>- <span class="hljs-keyword">building </span><span class="hljs-keyword">boxmg-sym-std-3D </span>objects in libboxmg_opt_sgl.a ... <br>- linking objects .... <br>- the executable ex_direct_1_f90 has <span class="hljs-keyword">been </span>created.<br></code></pre></td></tr></table></figure><ul><li>boxmg-sym-std-3D/ex_direct_1_f90 is successful.</li><li>All the rest fails. (why? related RKIND issue.)</li></ul><h3 id="configurecompile-wrf">Configure/compile WRF</h3><div class="note note-danger">            <p>Important note:<br />Compile WRF using <strong>only one core</strong> with BoxMG !!!<br />./compile -j 1 em_real 2&gt;&amp;1 | tee compile.log</p>          </div><p>To configure WRF, two environment variables must be set: WRF_ELEC and BOXMG</p><p>For bash:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">export</span> WRF_ELEC=1<br><span class="hljs-built_in">export</span> BOXMGLIBDIR=[path to boxmg directory]<br></code></pre></td></tr></table></figure><p>For example, if the boxmg library directory is /home/wpsze/WRF/WRF4-elec/wrf_install/boxmg4wrf/lib, then (for bash)</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">export</span> BOXMGLIBDIR=/home/wpsze/WRF/WRF4-elec/wrf_install/boxmg4wrf/<br></code></pre></td></tr></table></figure><p>Then run 'configure' in the WRF main directory and select an option for <strong>'dmpar' (distributed memory parallel)</strong>. The code is set up only to use the MPI parallel solver from BoxMG, so do not compile for serial mode. (It can still be run on a single processor, however.)</p><h2 id="microtedwrf4-elec">MicroTed/wrf4-elec</h2><p><a href="https://github.com/MicroTed/wrf4-elec" class="uri">https://github.com/MicroTed/wrf4-elec</a></p><p>The impact of initial conditions in predicting lightning activity using the Weather Research and Forecasting (WRF) with the electrification (ELEC) extra package, known as WRF-ELEC model, has been investigated.</p><h3 id="an-example-of-namelist.input">An example of namelist.input</h3><p><a href="https://github.com/MicroTed/wrf4-elec/blob/7c90e71bdc4db527d0ec034804e4fd200cdacf28/test/em_quarter_ss/electest/namelist.input#L55" class="uri">https://github.com/MicroTed/wrf4-elec/blob/7c90e71bdc4db527d0ec034804e4fd200cdacf28/test/em_quarter_ss/electest/namelist.input#L55</a></p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs makefile">&amp;physics<br>mp_physics                          = 18,     1,     1,<br>elec_physics                        = 1,<br>nssl_ipelec                         = 2,<br>nssl_cccn                           = 0.8e9,<br>nssl_isaund                         = 11,<br>nssl_iscreen                        = 1,<br>nssl_idischarge                     = 1,<br>nssl_ibrkd                          = 4,<br>ra_lw_physics                       = 0,     0,     0,<br>ra_sw_physics                       = 0,     0,     0,<br>radt                                = 30,    30,    30,<br>sf_sfclay_physics                   = 0,     0,     0,<br>sf_surface_physics                  = 0,     0,     0,<br>bl_pbl_physics                      = 0,     0,     0,<br>bldt                                = 0,     0,     0,<br>cu_physics                          = 0,     0,     0,<br>cudt                                = 5,     5,     5,<br>num_soil_layers                     = 5,<br>/<br></code></pre></td></tr></table></figure><h2 id="readme.electricity">README.electricity</h2><div class="note note-primary">            <p><a href="https://github.com/MicroTed/wrf4-elec/blob/7c90e71bdc4db527d0ec034804e4fd200cdacf28/doc/README.electricity#L41" class="uri">https://github.com/MicroTed/wrf4-elec/blob/7c90e71bdc4db527d0ec034804e4fd200cdacf28/doc/README.electricity#L41</a></p>          </div><h2 id="wrf4-elecs-registry.elec">wrf4-elec's registry.elec</h2><p><a href="https://github.com/MicroTed/wrf4-elec/blob/main/Registry/registry.elec" class="uri">https://github.com/MicroTed/wrf4-elec/blob/main/Registry/registry.elec</a></p><div class="note note-primary">            <p>Look at namelist !!</p>          </div><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-comment"># SPACE CHARGE EXPLICIT LIGHTNING</span><br><span class="hljs-attribute">state</span>   real    scr            ikjftb  scalar      <span class="hljs-number">1</span>         -     \<br>   <span class="hljs-attribute">i0rhusdf</span>=(bdy_interp:dt)    <span class="hljs-string">&quot;SCR&quot;</span>       <span class="hljs-string">&quot;Rain space charge mixing ratio&quot;</span> <span class="hljs-string">&quot;# C kg(-1)&quot;</span><br><span class="hljs-attribute">state</span>   real    scw            ikjftb  scalar      <span class="hljs-number">1</span>         -     \<br>   <span class="hljs-attribute">i0rhusdf</span>=(bdy_interp:dt)    <span class="hljs-string">&quot;SCW&quot;</span>       <span class="hljs-string">&quot;cloud water space charge mixing ratio&quot;</span> <span class="hljs-string">&quot;# C kg(-1)&quot;</span><br><span class="hljs-attribute">state</span>   real    sci            ikjftb  scalar      <span class="hljs-number">1</span>         -     \<br>   <span class="hljs-attribute">i0rhusdf</span>=(bdy_interp:dt)    <span class="hljs-string">&quot;SCI&quot;</span>       <span class="hljs-string">&quot;cloud ice space charge mixing ratio&quot;</span> <span class="hljs-string">&quot;# C kg(-1)&quot;</span><br><span class="hljs-attribute">state</span>   real    scs            ikjftb  scalar      <span class="hljs-number">1</span>         -     \<br>   <span class="hljs-attribute">i0rhusdf</span>=(bdy_interp:dt)    <span class="hljs-string">&quot;SCS&quot;</span>       <span class="hljs-string">&quot;snow space charge mixing ratio&quot;</span> <span class="hljs-string">&quot;# C kg(-1)&quot;</span><br><span class="hljs-attribute">state</span>   real    sch            ikjftb  scalar      <span class="hljs-number">1</span>         -     \<br>   <span class="hljs-attribute">i0rhusdf</span>=(bdy_interp:dt)    <span class="hljs-string">&quot;SCH&quot;</span>       <span class="hljs-string">&quot;graupel water space charge mixing ratio&quot;</span> <span class="hljs-string">&quot;# C kg(-1)&quot;</span><br><span class="hljs-attribute">state</span>   real    schl           ikjftb  scalar      <span class="hljs-number">1</span>         -     \<br>   <span class="hljs-attribute">i0rhusdf</span>=(bdy_interp:dt)    <span class="hljs-string">&quot;SCHL&quot;</span>       <span class="hljs-string">&quot;hail water space charge mixing ratio&quot;</span> <span class="hljs-string">&quot;# C kg(-1)&quot;</span><br><span class="hljs-attribute">state</span>   real    sciona          ikjftb  scalar      <span class="hljs-number">1</span>         -     \<br>   <span class="hljs-attribute">i0rhusdf</span>=(bdy_interp:dt)    <span class="hljs-string">&quot;SCIONA&quot;</span>       <span class="hljs-string">&quot;Passive net ion space charge&quot;</span> <span class="hljs-string">&quot;# C kg(-1)&quot;</span><br><span class="hljs-attribute">state</span>   real    clnox          ikjftb  scalar      <span class="hljs-number">1</span>         -     \<br>   <span class="hljs-attribute">i0rhusdf</span>=(bdy_interp:dt)    <span class="hljs-string">&quot;CLNOX&quot;</span>      <span class="hljs-string">&quot;Lightning NOx concentration&quot;</span> <span class="hljs-string">&quot;# moles kg(-1)&quot;</span><br><span class="hljs-comment"># END SPACE CHARGE EXPLICIT LIGHTNING</span><br><br><span class="hljs-comment"># EXPLICIT LIGHTNING</span><br><span class="hljs-comment">#</span><br><span class="hljs-attribute">state</span>    real    rscghis_2d      ij   misc    <span class="hljs-number">1</span>         -     irh         <span class="hljs-string">&quot;rscghis_2d&quot;</span>             <span class="hljs-string">&quot;MAX NONINDUCTIVE CHARGING 2D&quot;</span>     <span class="hljs-string">&quot;C m-2&quot;</span><br><span class="hljs-attribute">state</span>    real    induc           ikj  misc    <span class="hljs-number">1</span>         -     irh         <span class="hljs-string">&quot;induc&quot;</span>                  <span class="hljs-string">&quot;TOTAL INDUCTIVE CHARGING &quot;</span>     <span class="hljs-string">&quot;C m-3&quot;</span><br><span class="hljs-attribute">state</span>    real    noninduc        ikj  misc    <span class="hljs-number">1</span>         -     irh         <span class="hljs-string">&quot;noninduc&quot;</span>               <span class="hljs-string">&quot;TOTAL NONINDUCTIVE CHARGING&quot;</span>     <span class="hljs-string">&quot;C m-3&quot;</span><br><span class="hljs-attribute">state</span>    real    sctot           ikj  misc    <span class="hljs-number">1</span>         -     irh         <span class="hljs-string">&quot;sctot&quot;</span>                  <span class="hljs-string">&quot;Total Space Charge Density&quot;</span>     <span class="hljs-string">&quot;C m-3&quot;</span><br><span class="hljs-attribute">state</span>    real    elecmag         ikj  misc    <span class="hljs-number">1</span>         -     irh         <span class="hljs-string">&quot;elecmag&quot;</span>                <span class="hljs-string">&quot;EFIELD MAGNITUDE&quot;</span>     <span class="hljs-string">&quot;V m-1&quot;</span><br><span class="hljs-attribute">state</span>    real    elecx           ikj  misc    <span class="hljs-number">1</span>         -     irh         <span class="hljs-string">&quot;elecx&quot;</span>                  <span class="hljs-string">&quot;EFIELD X-Component&quot;</span>     <span class="hljs-string">&quot;V m-1&quot;</span><br><span class="hljs-attribute">state</span>    real    elecy           ikj  misc    <span class="hljs-number">1</span>         -     irh         <span class="hljs-string">&quot;elecy&quot;</span>                  <span class="hljs-string">&quot;EFIELD Y-Component&quot;</span>     <span class="hljs-string">&quot;V m-1&quot;</span><br><span class="hljs-attribute">state</span>    real    elecz           ikj  misc    <span class="hljs-number">1</span>         -     irh         <span class="hljs-string">&quot;elecz&quot;</span>                  <span class="hljs-string">&quot;EFIELD Z-Component&quot;</span>     <span class="hljs-string">&quot;V m-1&quot;</span><br><span class="hljs-attribute">state</span>    real    pot             ikj  misc    <span class="hljs-number">1</span>         -     irh         <span class="hljs-string">&quot;pot&quot;</span>                    <span class="hljs-string">&quot;POTENTIAL&quot;</span>     <span class="hljs-string">&quot;V&quot;</span><br><span class="hljs-attribute">state</span>    real    light            ij  misc    <span class="hljs-number">1</span>         -     irh         <span class="hljs-string">&quot;light&quot;</span>                  <span class="hljs-string">&quot;lightning flash initiations&quot;</span>         <span class="hljs-string">&quot;flash origin density&quot;</span><br><span class="hljs-attribute">state</span>    real    lightdens        ij  misc    <span class="hljs-number">1</span>         -     irh         <span class="hljs-string">&quot;lightdens&quot;</span>              <span class="hljs-string">&quot;lightning flash density&quot;</span>    <span class="hljs-string">&quot;flash column-1&quot;</span><br><span class="hljs-attribute">state</span>    real    lightfod         ij  misc    <span class="hljs-number">1</span>         -     irh         <span class="hljs-string">&quot;lightfod&quot;</span>               <span class="hljs-string">&quot;normalized lightning flash origin density&quot;</span>   <span class="hljs-string">&quot;flash column-1&quot;</span><br><span class="hljs-attribute">state</span>    real    flshfedic        ij  misc    <span class="hljs-number">1</span>         -     irh         <span class="hljs-string">&quot;flshfedic&quot;</span>              <span class="hljs-string">&quot;IC lightning flash extent density&quot;</span>         <span class="hljs-string">&quot;flash column-1&quot;</span><br><span class="hljs-attribute">state</span>    real    flshfedicp       ij  misc    <span class="hljs-number">1</span>         -     irh         <span class="hljs-string">&quot;flshfedicp&quot;</span>             <span class="hljs-string">&quot;IC pos lightning flash extent density&quot;</span>         <span class="hljs-string">&quot;flash column-1&quot;</span><br><span class="hljs-attribute">state</span>    real    flshfedicn       ij  misc    <span class="hljs-number">1</span>         -     irh         <span class="hljs-string">&quot;flshfedicn&quot;</span>             <span class="hljs-string">&quot;IC neg lightning flash extent density&quot;</span>         <span class="hljs-string">&quot;flash column-1&quot;</span><br><span class="hljs-attribute">state</span>    real    flshfedcg        ij  misc    <span class="hljs-number">1</span>         -     irh         <span class="hljs-string">&quot;flshfedcg&quot;</span>              <span class="hljs-string">&quot;CG lightning flash extent density&quot;</span>         <span class="hljs-string">&quot;flash column-1&quot;</span><br><span class="hljs-attribute">state</span>    real    flshfedcgn       ij  misc    <span class="hljs-number">1</span>         -     irh         <span class="hljs-string">&quot;flshfedcgn&quot;</span>             <span class="hljs-string">&quot;CG neg lightning flash extent density&quot;</span>         <span class="hljs-string">&quot;flash column-1&quot;</span><br><span class="hljs-attribute">state</span>    real    flshfedcgp       ij  misc    <span class="hljs-number">1</span>         -     irh         <span class="hljs-string">&quot;flshfedcgp&quot;</span>             <span class="hljs-string">&quot;CG pos lightning flash extent density&quot;</span>         <span class="hljs-string">&quot;flash column-1&quot;</span><br><span class="hljs-attribute">state</span>    real    lightdis         ij  misc    <span class="hljs-number">1</span>         -     irh         <span class="hljs-string">&quot;lightdis&quot;</span>               <span class="hljs-string">&quot;lightning source density&quot;</span>     <span class="hljs-string">&quot;Source column-1&quot;</span><br><span class="hljs-attribute">state</span>    real    flshi           ikj  misc    <span class="hljs-number">1</span>         -     irh         <span class="hljs-string">&quot;flshi&quot;</span>                  <span class="hljs-string">&quot;Lightning init points&quot;</span>     <span class="hljs-string">&quot;count&quot;</span><br><span class="hljs-attribute">state</span>    real    flshn           ikj  misc    <span class="hljs-number">1</span>         -     irh         <span class="hljs-string">&quot;flshn&quot;</span>                  <span class="hljs-string">&quot;Negative channels&quot;</span>     <span class="hljs-string">&quot;count&quot;</span><br><span class="hljs-attribute">state</span>    real    flshp           ikj  misc    <span class="hljs-number">1</span>         -     irh         <span class="hljs-string">&quot;flshp&quot;</span>                  <span class="hljs-string">&quot;Positive channels&quot;</span>     <span class="hljs-string">&quot;count&quot;</span><br><span class="hljs-comment"># END EXPLICIT LIGHTNING</span><br><br><br><span class="hljs-comment"># Explicit lightning</span><br><span class="hljs-attribute">rconfig</span>   integer  nssl_ipelec            namelist,physics      max_domains   <span class="hljs-number">0</span>       rh       <span class="hljs-string">&quot;Electrification selection&quot;</span>  <span class="hljs-string">&quot;&quot;</span>      <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-attribute">rconfig</span>   integer  nssl_isaund            namelist,physics      <span class="hljs-number">1</span>             <span class="hljs-number">12</span>      rh       <span class="hljs-string">&quot;Charge separation selection&quot;</span>  <span class="hljs-string">&quot;&quot;</span>      <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-attribute">rconfig</span>   integer  nssl_iscreen           namelist,physics      <span class="hljs-number">1</span>             <span class="hljs-number">0</span>       rh       <span class="hljs-string">&quot;Screening layer parameterization flag&quot;</span>  <span class="hljs-string">&quot;&quot;</span>      <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-attribute">rconfig</span>   real     nssl_lightrad          namelist,physics      <span class="hljs-number">1</span>             <span class="hljs-number">12000</span>   rh       <span class="hljs-string">&quot;discharge cylinder radius (m)&quot;</span>  <span class="hljs-string">&quot;&quot;</span>      <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-attribute">rconfig</span>   integer  nssl_idischarge        namelist,physics      <span class="hljs-number">1</span>             <span class="hljs-number">1</span>       rh       <span class="hljs-string">&quot;lightning discharge flag&quot;</span>  <span class="hljs-string">&quot;&quot;</span>      <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-attribute">rconfig</span>   integer  nssl_ibrkd             namelist,physics      <span class="hljs-number">1</span>             <span class="hljs-number">4</span>       rh       <span class="hljs-string">&quot;Critical Breakeven Efield profile selection&quot;</span>  <span class="hljs-string">&quot;&quot;</span>      <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-attribute">rconfig</span>   real     nssl_elgtfestop        namelist,physics      <span class="hljs-number">1</span>             <span class="hljs-number">0</span>.<span class="hljs-number">8</span>     rh       <span class="hljs-string">&quot;3D lightning initial channel stopping fraction&quot;</span>  <span class="hljs-string">&quot;&quot;</span>      <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-attribute">rconfig</span>   real     nssl_ecrit             namelist,physics      <span class="hljs-number">1</span>             <span class="hljs-number">120000</span>  rh       <span class="hljs-string">&quot;Critical Breakeven Efield magnitude for discharge (V/m) assuming height-constant Ecrit profile&quot;</span>  <span class="hljs-string">&quot;&quot;</span>      <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-attribute">rconfig</span>   real     nssl_disfrac           namelist,physics      <span class="hljs-number">1</span>             <span class="hljs-number">0</span>.<span class="hljs-number">3</span>     rh       <span class="hljs-string">&quot;percentile of charge removed upon discharge (BLM)&quot;</span>  <span class="hljs-string">&quot;&quot;</span>      <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-attribute">rconfig</span>   real     nssl_einternal         namelist,physics      <span class="hljs-number">1</span>           <span class="hljs-number">200</span>.<span class="hljs-number">0</span>     rh       <span class="hljs-string">&quot;Lightning channel internal field (MSZ)&quot;</span>  <span class="hljs-string">&quot;&quot;</span>      <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-attribute">rconfig</span>   real     nssl_tgrnd             namelist,physics      <span class="hljs-number">1</span>           <span class="hljs-number">266</span>.<span class="hljs-number">16</span>    rh       <span class="hljs-string">&quot;Temperature threshold for CG (MSZ)&quot;</span>  <span class="hljs-string">&quot;&quot;</span>      <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-attribute">rconfig</span>   real     nssl_zgrnd             namelist,physics      <span class="hljs-number">1</span>             -<span class="hljs-number">1</span>.     rh       <span class="hljs-string">&quot;Height threshold for CG (MSZ)&quot;</span>  <span class="hljs-string">&quot;&quot;</span>      <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-attribute">rconfig</span>   integer  nssl_clnox             namelist,physics      <span class="hljs-number">1</span>             <span class="hljs-number">0</span>       rh       <span class="hljs-string">&quot;Lightning NOX prediction flag&quot;</span>  <span class="hljs-string">&quot;&quot;</span>      <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-comment"># end Explicit lightning</span><br><br><span class="hljs-attribute">rconfig</span>   integer  elec_physics           namelist,physics      <span class="hljs-number">1</span>            <span class="hljs-number">0</span>       irh       <span class="hljs-string">&quot;elec_physics&quot;</span>            <span class="hljs-string">&quot;&quot;</span>      <span class="hljs-string">&quot;&quot;</span><br><br><span class="hljs-comment"># external WRF-ELEC package</span><br><span class="hljs-attribute">package</span>   noelec             elec_physics==<span class="hljs-number">0</span>             -             -<br><span class="hljs-attribute">package</span>   eleclgt            elec_physics==<span class="hljs-number">1</span>             -             scalar:scr,scw,sci,scs,sch,schl,sciona;state:rscghis_2d,sctot,noninduc,induc,pot,elecmag,elecx,elecy,elecz,light,lightdens,lightdis<br><span class="hljs-comment"># for case of no hail (nssl_2momg)</span><br><span class="hljs-attribute">package</span>   eleclgtg           elec_physics==<span class="hljs-number">11</span>            -             scalar:scr,scw,sci,scs,sch,sciona;state:rscghis_2d,sctot,noninduc,induc,pot,elecmag,elecx,elecy,elecz,light,lightdens,lightdis,lightfod<br><br><span class="hljs-attribute">package</span> lightning1d          nssl_idischarge==<span class="hljs-number">1</span>   -    state:lightfod<br><span class="hljs-attribute">package</span> lightning3d          nssl_idischarge==<span class="hljs-number">2</span>   -    state:flshi,flshn,flshp,flshfedic,flshfedicp,flshfedicn,flshfedcg,flshfedcgp,flshfedcgn<br><span class="hljs-comment"># package lightning3da         nssl_idischarge==3   -    state:flshi,flshn,flshp</span><br><br><span class="hljs-attribute">package</span> nssl_cnox_off nssl_clnox==<span class="hljs-number">0</span>   -   -<br><span class="hljs-attribute">package</span> nssl_cnox_on  nssl_clnox==<span class="hljs-number">1</span>   -   scalar:clnox<br></code></pre></td></tr></table></figure><p>here noted,</p><!-- <style>tr:nth-child(even) {  background-color: #b2b2b2!important;  !color: #f4f4f4!important;}</style> --><table><thead><tr class="header"><th style="text-align: left;">elec_physics</th><th style="text-align: center;">nssl_ipelec</th><th style="text-align: center;">nssl_idischarge</th><th style="text-align: left;">outputs</th></tr></thead><tbody><tr class="odd"><td style="text-align: left;">1</td><td style="text-align: center;">2</td><td style="text-align: center;">1</td><td style="text-align: left;">?</td></tr><tr class="even"><td style="text-align: left;">1</td><td style="text-align: center;">3</td><td style="text-align: center;">1</td><td style="text-align: left;">scalar:scr,scw,sci,scs,sch,schl,sciona; <br> state:rscghis_2d,sctot,noninduc,induc,pot, <br> elecmag,elecx,elecy,elecz,light,lightdens,lightdis</td></tr><tr class="odd"><td style="text-align: left;">1</td><td style="text-align: center;">3</td><td style="text-align: center;">2</td><td style="text-align: left;">state:flshi,flshn,flshp,flshfedic, <br> flshfedicp,flshfedicn,flshfedcg,flshfedcgp,flshfedcgn</td></tr></tbody></table><h2 id="specific-namelist.input-options">Specific namelist.input options</h2><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><code class="hljs csharp">Specific namelist.input options are given below, along <span class="hljs-keyword">with</span> a list of output fields.<br><br><br>Electrification only works <span class="hljs-keyword">with</span> the NSSL <span class="hljs-number">2</span>-<span class="hljs-function">moment <span class="hljs-title">options</span> (<span class="hljs-params"><span class="hljs-keyword">with</span> hail</span>):</span><br><span class="hljs-function"></span><br><span class="hljs-function"> <span class="hljs-title">mp_physics</span>(<span class="hljs-params">max_dom</span>)</span><br>                                     = <span class="hljs-number">17</span>, NSSL <span class="hljs-number">2</span>-moment <span class="hljs-number">4</span>-<span class="hljs-function">ice <span class="hljs-title">scheme</span> (<span class="hljs-params">steady background CCN</span>)</span><br>                                     = <span class="hljs-number">18</span>, NSSL <span class="hljs-number">2</span>-moment <span class="hljs-number">4</span>-<span class="hljs-function">ice scheme <span class="hljs-keyword">with</span> predicted <span class="hljs-title">CCN</span> (<span class="hljs-params">better <span class="hljs-keyword">for</span> idealized than real cases</span>)</span><br>                                       ; to <span class="hljs-keyword">set</span> a <span class="hljs-keyword">global</span> CCN <span class="hljs-keyword">value</span>, use<br>                                     = <span class="hljs-number">22</span>, NSSL <span class="hljs-number">2</span>-moment <span class="hljs-number">3</span>-ice (hail species turned off)<br>                                       <br>Other variables <span class="hljs-keyword">in</span> the &amp;physics namelist:<br><br> elec_physics                        = <span class="hljs-number">0</span>, electrification (<span class="hljs-keyword">and</span> charge arrays) <span class="hljs-function">turned <span class="hljs-title">off</span> (<span class="hljs-params">DEFAULT</span>)</span><br>                                     = <span class="hljs-number">1</span>, <span class="hljs-function">electrification turned <span class="hljs-title">on</span> (<span class="hljs-params">only works <span class="hljs-keyword">with</span> mp_physics = <span class="hljs-number">17</span>, <span class="hljs-number">18</span>, <span class="hljs-keyword">or</span> <span class="hljs-number">22</span> i.e., <span class="hljs-number">2</span>-moment NSSL schemes</span>)</span><br><span class="hljs-function"></span><br><span class="hljs-function"> <span class="hljs-title">nssl_ipelec</span> (<span class="hljs-params">max_dom</span>)     ! NOTE: only <span class="hljs-keyword">set</span> <span class="hljs-keyword">this</span> to a nonzero <span class="hljs-keyword">value</span> <span class="hljs-keyword">on</span> the innermost domain</span><br>                                     = <span class="hljs-number">0</span>, <span class="hljs-function">charging turned <span class="hljs-title">off</span> (<span class="hljs-params">DEFAULT</span>)</span><br>                                     = <span class="hljs-number">2</span>, non-inductive charging only<br>                                     = <span class="hljs-number">3</span>, non-inductive + inductive charging<br>                                     = <span class="hljs-number">1</span>, <span class="hljs-function"><span class="hljs-keyword">not</span> <span class="hljs-title">used</span> (<span class="hljs-params">reserved <span class="hljs-keyword">for</span> future use</span>)</span><br><span class="hljs-function"></span><br><span class="hljs-function"> nssl_idischarge</span>                     = <span class="hljs-number">0</span>, no discharge<br>                                     = <span class="hljs-number">1</span>, Cylindrical <span class="hljs-string">&quot;1D&quot;</span> <span class="hljs-function">lightning scheme based <span class="hljs-keyword">on</span> Ziegler <span class="hljs-keyword">and</span> <span class="hljs-title">MacGorman</span> (<span class="hljs-params"><span class="hljs-number">1994</span>, JAS</span>)</span> <br>                                     = <span class="hljs-number">2</span>, <span class="hljs-number">3</span>D discrete discharge adapted <span class="hljs-keyword">from</span> MacGorman et al. (<span class="hljs-number">2001</span>)<br><br> nssl_iscreen                        = <span class="hljs-number">0</span>, <span class="hljs-function">no screening <span class="hljs-title">layer</span> (<span class="hljs-params">DEFAULT</span>)</span><br>                                     = <span class="hljs-number">1</span>, screening layer scheme of Ziegler et al. (<span class="hljs-number">1991</span>, JGR)<br>                                     = <span class="hljs-number">2</span>, <span class="hljs-function">screening layer only applied at cloud <span class="hljs-title">top</span> (<span class="hljs-params">seems to be better <span class="hljs-keyword">for</span> storm complexes <span class="hljs-keyword">and</span> large storms</span>)</span><br><span class="hljs-function"></span><br><span class="hljs-function"> nssl_ibrkd</span>                          = breakdown electric field profile to initiate lightning<br>                                     = <span class="hljs-number">1</span>, constant profile <span class="hljs-keyword">with</span> height <span class="hljs-keyword">with</span> <span class="hljs-keyword">value</span> <span class="hljs-keyword">set</span> <span class="hljs-keyword">by</span> nssl_ecrit<br>                                     = <span class="hljs-number">2</span> to <span class="hljs-number">5</span>, <span class="hljs-function">variants of vertical Ecrit profile of <span class="hljs-title">Dwyer</span> (<span class="hljs-params"><span class="hljs-number">2003</span>, GRL</span>) - &#x27;4&#x27; <span class="hljs-keyword">is</span> <span class="hljs-title">recommended</span> (<span class="hljs-params">DEFAULT <span class="hljs-keyword">is</span> <span class="hljs-number">4</span></span>).</span><br><span class="hljs-function"></span><br><span class="hljs-function"> nssl_isaund</span>                         = <span class="hljs-function">Calls the appropriate version of the <span class="hljs-title">UMIST</span> (<span class="hljs-params">e.g., Saunders et al. <span class="hljs-number">1991</span> scheme</span>)</span><br>                                     = <span class="hljs-number">-5</span> : Saunders etal <span class="hljs-number">1991</span> (following Helsdon et al. <span class="hljs-number">2001</span>, but use normal charging instead of <span class="hljs-string">&#x27;anomalous&#x27;</span> zones)<br>                                     = <span class="hljs-number">0</span> : Saunders <span class="hljs-number">1991</span> (modified <span class="hljs-keyword">as</span> <span class="hljs-keyword">in</span> Wojcik <span class="hljs-number">1994</span>)<br>                                     = <span class="hljs-number">2</span> : <span class="hljs-function">RR <span class="hljs-title">scheme</span> (<span class="hljs-params"> no extra factor </span>) (<span class="hljs-params">Mansell et al. <span class="hljs-number">2005</span>, JGR</span>)</span><br>                                     = <span class="hljs-number">4</span> : <span class="hljs-function">Saunders <span class="hljs-keyword">and</span> Peck <span class="hljs-title">Scheme</span> (<span class="hljs-params"> no extra factor </span>) (<span class="hljs-params">Mansell et al. <span class="hljs-number">2005</span>, JGR</span>)</span><br>                                     = <span class="hljs-number">9</span> : <span class="hljs-function">Saunders <span class="hljs-keyword">and</span> Peck <span class="hljs-title">Scheme</span> (<span class="hljs-params"> no extra factor, cutoff at <span class="hljs-number">-32.47</span> <span class="hljs-keyword">as</span> orig eq. <span class="hljs-keyword">from</span> sp98 </span>) (<span class="hljs-params">Mansell et al. <span class="hljs-number">2010</span>, JAS</span>)</span><br>                                     = <span class="hljs-number">10</span> : Brooks et al. RARcrit <span class="hljs-keyword">for</span> T &gt; <span class="hljs-number">-15</span> <span class="hljs-function"><span class="hljs-keyword">using</span> <span class="hljs-title">saund2</span> (<span class="hljs-params">otherwise same <span class="hljs-keyword">as</span> isaund=<span class="hljs-number">2</span></span>) (<span class="hljs-params"><span class="hljs-keyword">set</span> rarfac to negative <span class="hljs-keyword">in</span> saund2</span>)</span><br>                                     = <span class="hljs-number">11</span> : Brooks et al. RARcrit <span class="hljs-keyword">for</span> T &gt; <span class="hljs-number">-15</span> <span class="hljs-function"><span class="hljs-keyword">using</span> <span class="hljs-title">saund6</span> (<span class="hljs-params">otherwise same <span class="hljs-keyword">as</span> isaund=<span class="hljs-number">4</span></span>)</span><br>                                     = <span class="hljs-number">12</span> : Brooks et al. RARcrit <span class="hljs-keyword">for</span> T &gt; <span class="hljs-number">-15</span> <span class="hljs-function"><span class="hljs-keyword">using</span> <span class="hljs-title">saund6</span> (<span class="hljs-params">otherwise same <span class="hljs-keyword">as</span> isaund=<span class="hljs-number">9</span></span>) (<span class="hljs-params">DEFAULT</span>)</span><br>                                     = <span class="hljs-number">13</span> : Brooks et al. RARcrit <span class="hljs-keyword">for</span> T &gt; <span class="hljs-number">-15</span> <span class="hljs-function"><span class="hljs-keyword">using</span> <span class="hljs-title">saund8</span> (<span class="hljs-params">cosine roll-off function <span class="hljs-keyword">for</span> smoother approach to zero at low temperature</span>)</span><br><span class="hljs-function">                                   For <span class="hljs-title">Takahashi</span> (<span class="hljs-params"><span class="hljs-number">1978</span>, <span class="hljs-number">1984</span></span>) charge <span class="hljs-title">separation</span> (<span class="hljs-params">see below</span>)</span><br>                                     = <span class="hljs-number">1</span> : Takahashi <span class="hljs-number">1984</span> <span class="hljs-keyword">with</span> factors <span class="hljs-keyword">for</span> crystal size <span class="hljs-keyword">and</span> impact speed<br>                                     = <span class="hljs-number">3</span> : Takahashi <span class="hljs-number">1984</span> WITHOUT factors <span class="hljs-keyword">for</span> crystal size <span class="hljs-keyword">and</span> impact speed<br><br><br> nssl_lightrad                       = <span class="hljs-number">12000</span>, radius (m) of discharge cylinder <span class="hljs-keyword">for</span> <span class="hljs-number">1</span>-D discharge scheme<br><br> nssl_disfrac                        = <span class="hljs-number">0.3</span>, <span class="hljs-function">nominal fraction of charge removed per <span class="hljs-title">discharge</span> (<span class="hljs-params"><span class="hljs-keyword">for</span> <span class="hljs-number">1</span>D lightning</span>)</span><br><span class="hljs-function"></span><br><span class="hljs-function"> nssl_ecrit</span>                          = <span class="hljs-number">120000</span>, <span class="hljs-function">breakdown electric <span class="hljs-title">field</span> (<span class="hljs-params">Volts/m</span>) to initiate <span class="hljs-title">lightning</span> (<span class="hljs-params">i.e., constant <span class="hljs-keyword">value</span> <span class="hljs-keyword">with</span> height</span>). (<span class="hljs-params"><span class="hljs-keyword">for</span> nssl_ibrkd=<span class="hljs-number">1</span></span>)</span><br><span class="hljs-function"></span><br><span class="hljs-function"> 3D discharge namelist options</span><br><span class="hljs-function"> NSSL_EINTERNAL</span>  =   <span class="hljs-number">200.0000</span>  : <span class="hljs-function"><span class="hljs-keyword">internal</span> field <span class="hljs-keyword">for</span> channel <span class="hljs-title">resistance</span> (<span class="hljs-params">V/m</span>)</span><br><span class="hljs-function"> NSSL_TGRND</span>      =   <span class="hljs-number">266.1600</span>  : Temperature threshold <span class="hljs-keyword">for</span> considering CG flash<br> NSSL_ZGRND      =  <span class="hljs-number">-1.000000</span>  : <span class="hljs-function">Altitude threshold <span class="hljs-keyword">for</span> considering CG <span class="hljs-title">flash</span> (<span class="hljs-params">only <span class="hljs-keyword">if</span> &gt; <span class="hljs-number">0</span>, otherwise uses temperature</span>)</span><br><span class="hljs-function"></span><br><span class="hljs-function">The <span class="hljs-title">Takahashi</span> (<span class="hljs-params"><span class="hljs-number">1978</span>, <span class="hljs-number">1984</span></span>) charge separation requires a lookup table to be read <span class="hljs-keyword">in</span>. </span><br><span class="hljs-function">The table file <span class="hljs-keyword">is</span> &#x27;takahashi.txt&#x27; <span class="hljs-keyword">and</span> needs to be copied <span class="hljs-keyword">from</span> WRF/elec to the working </span><br><span class="hljs-function">directory. To use <span class="hljs-keyword">this</span> option, the NSSL microphysics can read an <span class="hljs-keyword">internal</span> namelist, </span><br><span class="hljs-function">which needs &#x27;nonigrd</span> = <span class="hljs-number">-1&#x27;</span>:<br><br>&amp;nssl_mp_params<br>  nonigrd = <span class="hljs-number">-1</span><br>/<br><br>Also <span class="hljs-keyword">set</span> the <span class="hljs-keyword">value</span> nssl_isaund=<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><h2 id="output-fields">Output fields</h2><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver"><span class="hljs-number">2</span>D, <span class="hljs-built_in">time</span>-dependent:<br><br>  LIGHT      : Sum <span class="hljs-keyword">of</span> lightning initations <span class="hljs-keyword">in</span> <span class="hljs-keyword">the</span> column (For <span class="hljs-number">1</span>D discharge, this counts all points that <br>                 have electric field magnitude that exceeds <span class="hljs-keyword">the</span> initiation threshold<br>  LIGHTDENS  : Flash extent density (FED; <span class="hljs-built_in">sum</span> <span class="hljs-keyword">of</span> <span class="hljs-keyword">the</span> <span class="hljs-built_in">number</span> <span class="hljs-keyword">of</span> flashes that extend <span class="hljs-keyword">into</span> <span class="hljs-keyword">the</span> grid column)<br>  LIGHTDIS   : A kind <span class="hljs-keyword">of</span> <span class="hljs-string">&quot;source point&quot;</span> density that adds up <span class="hljs-keyword">the</span> <span class="hljs-built_in">number</span> <span class="hljs-keyword">of</span> points <span class="hljs-keyword">in</span> <span class="hljs-keyword">a</span> column where<br>                 lightning charge is deposited<br>  rscghis_2d : column <span class="hljs-built_in">sum</span> <span class="hljs-keyword">of</span> charge separation (magnitude) over <span class="hljs-keyword">the</span> history interval<br><br>  For <span class="hljs-number">3</span>D lightning:<br><br>   flshfedic - FED <span class="hljs-built_in">from</span> IC flashes<br>   flshfedicp - FED <span class="hljs-built_in">from</span> IC flashes (pos. channels)<br>   flshfedicn - FED <span class="hljs-built_in">from</span> IC flashes (neg. channels)<br>   flshfedcg - FED <span class="hljs-built_in">from</span> CG flashes<br>   flshfedcgp - FED <span class="hljs-built_in">from</span> CG flashes (pos. channels)<br>   flshfedcgn - FED <span class="hljs-built_in">from</span> CG flashes (neg. channels)<br>   <br><span class="hljs-number">3</span>D, <span class="hljs-built_in">time</span>-dependent:<br><br>  POT         : Electric potential (Volts)<br>  ELECMAG     : Electric field magnitude (V/m)<br>  ELECX       : x-component <span class="hljs-keyword">of</span> E (V/m)<br>  ELECY       : y-component <span class="hljs-keyword">of</span> E (V/m)<br>  ELECZ       : z-component <span class="hljs-keyword">of</span> E (V/m)<br>  INDUC       : Inductive charge separation rate (C m^<span class="hljs-number">-3</span> s^<span class="hljs-number">-1</span>)<br>  NONINDUC    : Net noninductive charge separation rate (C m^<span class="hljs-number">-3</span> s^<span class="hljs-number">-1</span>)<br>  SCW         : Charge density carried <span class="hljs-keyword">by</span> cloud droplets (C/kg, i.e., <span class="hljs-string">&#x27;charge mixing ratio&#x27;</span>)<br>  SCR         : Charge density carried <span class="hljs-keyword">by</span> rain (C/kg)<br>  SCI         : Charge density carried <span class="hljs-keyword">by</span> cloud ice (C/kg)<br>  SCS         : Charge density carried <span class="hljs-keyword">by</span> snow (C/kg)<br>  SCH         : Charge density carried <span class="hljs-keyword">by</span> graupel (C/kg)<br>  SCHL        : Charge density carried <span class="hljs-keyword">by</span> hail (C/kg)<br>  SCTOT       : Net charge density (C m^<span class="hljs-number">-3</span>) Is NOT mixing ratio<br>  SCIONA      : Residual charge <span class="hljs-built_in">from</span> lightning <span class="hljs-keyword">and</span> evaporating hydrometeors that has <span class="hljs-keyword">not</span> been reattached <span class="hljs-built_in">to</span> another species (C/kg)<br><br>  For <span class="hljs-number">3</span>D lightning:<br>    FLSHN, FLSHP : Negative/positive <span class="hljs-string">&quot;channel&quot;</span> points<br>    FLSHI : Flash initiation points<br></code></pre></td></tr></table></figure><h2 id="sourceforege">sourceforege</h2><p><a href="https://sourceforge.net/projects/wrfelec/files/" class="uri">https://sourceforge.net/projects/wrfelec/files/</a></p><p>Source: README.wrfelec, updated 2015-05-04</p><h1 id="compilation-process-details">Compilation process details</h1><ul><li>BoxMG directory: /home/wpsze/WRF/WRF4-elec/wrf_install/boxmg4wrf/</li></ul><div class="note note-danger">            <p>Important note:<br />Compile WRF using <strong>only one core</strong> with BoxMG !!!<br />./compile -j 1 em_real 2&gt;&amp;1 | tee compile.log</p>          </div><p>part of script is shown below,</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">export</span> WRF_ELEC=1<br><span class="hljs-built_in">export</span> BOXMGLIBDIR=/home/wpsze/WRF/WRF4-elec/wrf_install/boxmg4wrf<br><br><span class="hljs-built_in">cd</span> wrf4-elec/<br><br>./clean -a<br>./configure <br><span class="hljs-comment">##  9 (dmpar) GNU [gfortran/gcc]</span><br><br>sed -i <span class="hljs-string">&quot;s/\s\stime\s//g&quot;</span> configure.wrf<br>./compile -j 1 em_real 2&gt;&amp;1 | <span class="hljs-built_in">tee</span> compile.log<br></code></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><code class="hljs sh">checking <span class="hljs-keyword">for</span> perl5... no<br>checking <span class="hljs-keyword">for</span> perl... found /usr/bin/perl (perl)<br>Will use NETCDF <span class="hljs-keyword">in</span> <span class="hljs-built_in">dir</span>: /home/wpsze/WRF/WRFv440/Library/<br>ADIOS2 not <span class="hljs-built_in">set</span> <span class="hljs-keyword">in</span> environment. Will configure WRF <span class="hljs-keyword">for</span> use without.<br>Will use HDF5 <span class="hljs-keyword">in</span> <span class="hljs-built_in">dir</span>: /home/wpsze/WRF/WRFv440/Library/<br>PHDF5 not <span class="hljs-built_in">set</span> <span class="hljs-keyword">in</span> environment. Will configure WRF <span class="hljs-keyword">for</span> use without.<br>Building WRF with electrification option<br>!-DWRF_ELEC=1<br>Will use BoxMG <span class="hljs-keyword">in</span> <span class="hljs-built_in">dir</span>: /home/wpsze/WRF/WRF4-elec/wrf_install/boxmg4wrf/<br>Will use <span class="hljs-string">&#x27;time&#x27;</span> to report timing information<br><span class="hljs-built_in">set</span> sw_boxmg_path<br>WRF_ELEC was found <span class="hljs-keyword">in</span>  -DWRF_ELEC=1<br><span class="hljs-variable">$JASPERLIB</span> or <span class="hljs-variable">$JASPERINC</span> not found <span class="hljs-keyword">in</span> environment, configuring to build without grib2 I/O...<br>------------------------------------------------------------------------<br>Please <span class="hljs-keyword">select</span> from among the following Linux x86_64 options:<br><br>  1. (dmpar)   PGI (pgf90/gcc)<br>  2. (dmpar)   PGI (pgf90/pgcc): SGI MPT<br>  3. (dmpar)   PGI (pgf90/gcc): PGI accelerator<br>  4. (dmpar)   INTEL (ifort/icc)<br>               INTEL (ifort/icc): Xeon Phi (MIC architecture)<br>  5. (dmpar)   INTEL (ifort/icc): Xeon (SNB with AVX mods)<br>  6. (dmpar)   INTEL (ifort/icc): SGI MPT<br>  7. (dmpar)   INTEL (ifort/icc): IBM POE<br>  8. (dmpar)   PATHSCALE (pathf90/pathcc)<br>  9. (dmpar)   GNU (gfortran/gcc)<br> 1.  (dmpar)   IBM (xlf90_r/cc_r)<br> 2.  (dmpar)   PGI (ftn/gcc): Cray XC CLE<br> 3.  (dmpar)   CRAY CCE (ftn $(NOOMP)/cc): Cray XE and XC<br> 4.  (dmpar)   INTEL (ftn/icc): Cray XC<br> 5.  (dmpar)   PGI (pgf90/pgcc)<br> 6.  (dmpar)   PGI (pgf90/gcc): -f90=pgf90<br> 7.  (dmpar)   PGI (pgf90/pgcc): -f90=pgf90<br> 8.  (dmpar)   INTEL (ifort/icc): HSW/BDW<br> 9.  (dmpar)   INTEL (ifort/icc): KNL MIC<br> 10. (dmpar)   AMD (flang/clang) :  AMD ZEN1/ ZEN2/ ZEN3 Architectures<br> 11. (dmpar)   FUJITSU (frtpx/fccpx): FX10/FX100 SPARC64 IXfx/Xlfx<br><br>Enter selection [1-20] : 9<br><br>......<br><br><span class="hljs-comment">######################</span><br>------------------------------------------------------------------------<br>Settings listed above are written to configure.wrf.<br>If you wish to change settings, please edit that file.<br>If you wish to change the default options, edit the file:<br>     <span class="hljs-built_in">arch</span>/configure.defaults<br>NetCDF <span class="hljs-built_in">users</span> note:<br> This installation of NetCDF supports large file support.  To DISABLE large file<br> support <span class="hljs-keyword">in</span> NetCDF, <span class="hljs-built_in">set</span> the environment variable WRFIO_NCD_NO_LARGE_FILE_SUPPORT<br> to 1 and run configure again. Set to any other value to avoid this message.<br>  <br><br>Testing <span class="hljs-keyword">for</span> NetCDF, C and Fortran compiler<br><br>This installation of NetCDF is 64-bit<br>                 C compiler is 64-bit<br>           Fortran compiler is 64-bit<br>              It will build <span class="hljs-keyword">in</span> 64-bit<br> <br>NetCDF version: 4.7.4<br>Enabled NetCDF-4/HDF-5: <span class="hljs-built_in">yes</span><br>NetCDF built with PnetCDF: no<br></code></pre></td></tr></table></figure><p>there is an extra folder called "elec",</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh"> $ <span class="hljs-built_in">ls</span> wrf4-elec/elec/<br>binwrf.pl                           module_discharge.F<br>depend.elec                         module_discharge_msz.F<br>include_microphysics_driver_elec.F  module_mp_nssl_2mom_elec.F<br>include_solve_lightningnudge.F      module_nudge_light.F<br>Makefile                            module_screen.F<br>module_boxmgsetup.F                 takahashi.txt<br>module_commasmpi.F<br></code></pre></td></tr></table></figure><h1 id="compile-errors">Compile Errors</h1><ol type="1"><li>Error NoahMP submodule files not populating WRF directories.<ol type="1"><li><a href="https://waipangsze.github.io/2024/06/04/WRF_install_Error_NoahMP_submodule_files/" class="uri">https://waipangsze.github.io/2024/06/04/WRF_install_Error_NoahMP_submodule_files/</a></li><li>Download noahmp @ xxxx folder to your local /WRF/phys/</li><li>wrf4-elec is noahmp @ 3be0b28</li></ol></li><li>time No such file or directory.<ol type="1"><li><a href="https://waipangsze.github.io/2024/05/29/WRF_install_time_error/" class="uri">https://waipangsze.github.io/2024/05/29/WRF_install_time_error/</a></li></ol></li></ol><h1 id="done">Done</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sh">---&gt;                  Executables successfully built                  &lt;---<br> <br>-rwxrwxr-x 1 wpsze wpsze 44236440 Sep 24 14:26 main/ndown.exe<br>-rwxrwxr-x 1 wpsze wpsze 44121776 Sep 24 14:26 main/real.exe<br>-rwxrwxr-x 1 wpsze wpsze 43532016 Sep 24 14:26 main/tc.exe<br>-rwxrwxr-x 1 wpsze wpsze 50585304 Sep 24 14:25 main/wrf.exe<br><br> $ <span class="hljs-built_in">ls</span> run/*exe<br>run/ndown.exe  run/real.exe  run/tc.exe  run/wrf.ex<br></code></pre></td></tr></table></figure><h1 id="wrf-elec-outputs">WRF-ELEC outputs</h1><p>It is important to note that the FOD and reflectivity are derived from ELEC, whereas the LPI originates from WRF-ARW simulations.</p><h2 id="simulated-radar-reflectivity">simulated radar reflectivity</h2><p>radar reflectivity is diagnosed.</p><ul><li><a href="https://wrf-python.readthedocs.io/en/latest/user_api/generated/wrf.dbz.html" class="uri">https://wrf-python.readthedocs.io/en/latest/user_api/generated/wrf.dbz.html</a></li><li>This function computes equivalent reflectivity factor [dBZ] at each model grid point assuming spherical particles of constant density, with exponential size distributions. This function is based on “dbzcalc.f” in RIP.</li></ul><p>or on namelist,</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">&amp;physics<br>...<br>do_radar_ref = 0, ; 1 = allows radar reflectivity to be computed using mp-scheme-specific parameters.  Currently works <span class="hljs-keyword">for</span> mp_physics = 2,4,6,7,8,10,14,16<br></code></pre></td></tr></table></figure><p>with do_radar_reflectivity=1 and after running got the REFL_10cm variable. But this variable REFL_10cm is giving the estimated 10 cm wavelength (S-band) radar reflectivity in dB relative to reflectivity (dBZ) as produced by the WRF microphysics scheme.</p><blockquote><p>but, above mp_physics = 17 or 18?</p></blockquote><h2 id="lightning_option-from-wrf-arw">lightning_option (from WRF-ARW)</h2><p>Lightning parameterization option to allow flash rate prediction without chemistry.</p><p><a href="https://ruc.noaa.gov/wrf/wrf-chem/Users_guide.pdf">WRF-Chem Version 4.4 User's Guide: Appendix C: Using the Lightning-NOx Parameterization in WRF-Chem</a></p><div class="note note-primary">            <p>(for convection resolved runs; must also use do_radar_ref = 1, and mp_physics = 2,4,6,7,8,10,14, or 16)</p>          </div><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">lightning_option (max_dom)                       Lightning parameterization <span class="hljs-keyword">option</span> <span class="hljs-keyword">to</span> allow flash rate prediction <span class="hljs-keyword">without</span> chemistry<br>                                    = <span class="hljs-number">0</span>        ! <span class="hljs-keyword">off</span><br>                                    = <span class="hljs-number">1</span>        ! PR92 based <span class="hljs-keyword">on</span> maximum w, redistributes flashes <span class="hljs-keyword">within</span> dBZ &gt; <span class="hljs-number">20</span> (<span class="hljs-keyword">for</span> convection resolved runs; must <span class="hljs-keyword">also</span> use <br>                     do_radar_ref = <span class="hljs-number">1</span>, <span class="hljs-keyword">and</span> mp_physics = <span class="hljs-number">2</span>,<span class="hljs-number">4</span>,<span class="hljs-number">6</span>,<span class="hljs-number">7</span>,<span class="hljs-number">8</span>,<span class="hljs-number">10</span>,<span class="hljs-number">14</span>, <span class="hljs-keyword">or</span> <span class="hljs-number">16</span>)<br>                                    = <span class="hljs-number">2</span>        ! PR92 based <span class="hljs-keyword">on</span> <span class="hljs-number">20</span> dBZ top, redistributes flashes <span class="hljs-keyword">within</span> dBZ &gt; <span class="hljs-number">20</span> (<span class="hljs-keyword">for</span> convection resolved runs; must <span class="hljs-keyword">also</span> use <br>                     do_radar_ref = <span class="hljs-number">1</span>, <span class="hljs-keyword">and</span> mp_physics = <span class="hljs-number">2</span>,<span class="hljs-number">4</span>,<span class="hljs-number">6</span>,<span class="hljs-number">7</span>,<span class="hljs-number">8</span>,<span class="hljs-number">10</span>,<span class="hljs-number">14</span>, <span class="hljs-keyword">or</span> <span class="hljs-number">16</span>)<br>                                    = <span class="hljs-number">3</span>        ! Predicting the potential <span class="hljs-keyword">for</span> lightning activity (based <span class="hljs-keyword">on</span> Yair et al, <span class="hljs-number">2010</span>, J. Geophys. Res., <span class="hljs-number">115</span>, D04205, doi:<span class="hljs-number">10.1029</span>/<span class="hljs-number">2008</span>JD010868) <br>                                    = <span class="hljs-number">11</span>       ! PR92 based <span class="hljs-keyword">on</span> <span class="hljs-keyword">level</span> <span class="hljs-keyword">of</span> neutral buoyancy <span class="hljs-keyword">from</span> convective parameterization (<span class="hljs-keyword">for</span> scales<br>                                                <span class="hljs-keyword">where</span> a CPS <span class="hljs-keyword">is</span> used, intended <span class="hljs-keyword">for</span> use at <span class="hljs-number">10</span> &lt; dx &lt; <span class="hljs-number">50</span> km; must <span class="hljs-keyword">also</span> use cu_physics = <span class="hljs-number">5</span> <span class="hljs-keyword">or</span> <span class="hljs-number">93</span>)<br>lightning_dt  (max_dom)             = <span class="hljs-number">0.</span>       ! <span class="hljs-type">time</span> <span class="hljs-type">interval</span> (seconds) <span class="hljs-keyword">for</span> calling lightning parameterization. <span class="hljs-keyword">Default</span> uses model <span class="hljs-type">time</span> step<br>lightning_start_seconds (max_dom)   = <span class="hljs-number">0.</span>       ! <span class="hljs-keyword">Start</span> <span class="hljs-type">time</span> <span class="hljs-keyword">for</span> calling lightning parameterization. Recommends at least <span class="hljs-number">10</span> minutes <span class="hljs-keyword">for</span> spin-up.<br>flashrate_factor  (max_dom)         = <span class="hljs-number">1.0</span>      ! Factor <span class="hljs-keyword">to</span> adjust the predicted number <span class="hljs-keyword">of</span> flashes. Recommends <span class="hljs-number">1.0</span> <span class="hljs-keyword">for</span> lightning_option = <span class="hljs-number">11</span><br>                                                <span class="hljs-keyword">between</span> dx=<span class="hljs-number">10</span> <span class="hljs-keyword">and</span> <span class="hljs-number">50</span> km. Manual tuning recommended <span class="hljs-keyword">for</span> <span class="hljs-keyword">all</span> other <span class="hljs-keyword">options</span> independently<br>                                                <span class="hljs-keyword">for</span> <span class="hljs-keyword">each</span> nest.<br>cellcount_method (max_dom)                       <span class="hljs-keyword">Method</span> <span class="hljs-keyword">for</span> counting storm cells. Used <span class="hljs-keyword">by</span> CRM <span class="hljs-keyword">options</span> (lightning_options=<span class="hljs-number">1</span>,<span class="hljs-number">2</span>).<br>                                    = <span class="hljs-number">0</span>,       ! model determines <span class="hljs-keyword">method</span> used<br>                                    = <span class="hljs-number">1</span>,       ! tile-wide, appropriate <span class="hljs-keyword">for</span> <span class="hljs-keyword">large</span> domains<br>                                    = <span class="hljs-number">2</span>,       ! <span class="hljs-keyword">domain</span>-wide, appropriate <span class="hljs-keyword">for</span> sing-storm domains<br>cldtop_adjustment (max_dom)         = <span class="hljs-number">0.</span>       ! Adjustment <span class="hljs-keyword">from</span> LNB <span class="hljs-keyword">in</span> km. Used <span class="hljs-keyword">by</span> lightning_option=<span class="hljs-number">11.</span> <span class="hljs-keyword">Default</span> <span class="hljs-keyword">is</span> <span class="hljs-number">0</span>, but recommends <span class="hljs-number">2</span> km<br>iccg_method (max_dom)                            IC:CG partitioning <span class="hljs-keyword">method</span> (IC: intra-cloud; CG: cloud-<span class="hljs-keyword">to</span>-ground)<br>                                    = <span class="hljs-number">0</span>        ! <span class="hljs-keyword">Default</span> <span class="hljs-keyword">method</span> depending <span class="hljs-keyword">on</span> lightning <span class="hljs-keyword">option</span>, currently <span class="hljs-keyword">all</span> <span class="hljs-keyword">options</span> use iccg_method=<span class="hljs-number">2</span> <span class="hljs-keyword">by</span> default<br>                                    = <span class="hljs-number">1</span>        ! <span class="hljs-keyword">Constant</span> everywhere, <span class="hljs-keyword">set</span> <span class="hljs-keyword">with</span> namelist <span class="hljs-keyword">options</span> iccg_prescribed (num|den)#, <span class="hljs-keyword">default</span> <span class="hljs-keyword">is</span> <span class="hljs-number">0.</span>/<span class="hljs-number">1.</span> (<span class="hljs-keyword">all</span> CG).<br>                                    = <span class="hljs-number">2</span>        ! Coarsely prescribed <span class="hljs-number">1995</span><span class="hljs-number">-1999</span> NLDN/OTD climatology based <span class="hljs-keyword">on</span> Boccippio et al. (<span class="hljs-number">2001</span>)<br>                                    = <span class="hljs-number">3</span>        ! Parameterization <span class="hljs-keyword">by</span> Price <span class="hljs-keyword">and</span> Rind (<span class="hljs-number">1993</span>) based <span class="hljs-keyword">on</span> cold-cloud depth<br>                                    = <span class="hljs-number">4</span>        ! Gridded <span class="hljs-keyword">input</span> via arrays iccg_in_(num|den) <span class="hljs-keyword">from</span> wrfinput <span class="hljs-keyword">for</span> monthly mapped ratios. <br>                                                Points <span class="hljs-keyword">with</span> <span class="hljs-number">0</span>/<span class="hljs-number">0</span> <span class="hljs-keyword">values</span> use ratio defined <span class="hljs-keyword">by</span> iccg_prescribed_(num|den)<br>iccg_prescribed_num (max_dom)       = <span class="hljs-number">0.</span>       ! Numerator <span class="hljs-keyword">of</span> <span class="hljs-keyword">user</span>-specified prescribed IC:CG<br>iccg_prescribed_den (max_dom)       = <span class="hljs-number">1.</span>       ! Denominator <span class="hljs-keyword">of</span> <span class="hljs-keyword">user</span>-specified prescribed IC:CG<br>ltng_temp_upper                     = <span class="hljs-number">-45.</span>     ! Temperature (C) <span class="hljs-keyword">of</span> upper peak <span class="hljs-keyword">of</span> LNOx vertical distribution <span class="hljs-keyword">for</span> IC lightning (used <span class="hljs-keyword">by</span> &amp;chem lnox_opt=<span class="hljs-number">2</span>).<br>ltng_temp_lower                     = <span class="hljs-number">-15.</span>     ! Temperatures (C) <span class="hljs-keyword">of</span> lower peak <span class="hljs-keyword">of</span> LNOx vertical distribution <span class="hljs-keyword">for</span> <span class="hljs-keyword">both</span> IC <span class="hljs-keyword">and</span> CG lightning (used <span class="hljs-keyword">by</span> &amp;chem lnox_opt=<span class="hljs-number">2</span>).<br></code></pre></td></tr></table></figure><p>From WRF-MPAS-A forum,</p><ul><li><a href="https://forum.mmm.ucar.edu/threads/wrf-lightning-scheme-only-being-run-at-model-output-times.16207/#post-40290">WRF lightning scheme only being run at model output times?</a></li><li><a href="https://forum.mmm.ucar.edu/threads/lightning-option.13017/#post-31892">Lightning option</a></li><li><a href="https://forum.mmm.ucar.edu/threads/large-differences-of-simulated-fields-u-v-w-t-with-lightning_option-3-lpi-on-and-off.9338/#post-22147">Large differences of simulated fields (U, V, W, T) with lightning_option = 3 (LPI) on and off</a><ul><li>An alternative is to calculate the LPI from the model output. This can be done quite simply using an NCL program.</li></ul></li></ul><p>From <a href="https://groups.google.com/a/ucar.edu/g/wrf-chem-lightning/c/v6nIeyL7G2g" class="uri">https://groups.google.com/a/ucar.edu/g/wrf-chem-lightning/c/v6nIeyL7G2g</a>,</p><div class="note note-primary">            <p>The lightning option = 1 you chose is appropriate for dx&lt;5km because it relies on the maximum updraft speed in the storm updraft. You chose dx=10km which will not produce updraft speeds representative of thunderstorms, and in fact the storms are likely represented by the convective parameterization.</p><p>For dx=10 km, you should use lightning_option = 11.</p>          </div><h2 id="lightlightdenselectric-potential-difference-pot-from-wrf-elec">light/lightdens/Electric POTential difference (POT) (From WRF-ELEC)</h2><p>Starting with the electrification processes (inductive and non-inductive processes), calculation method of the electric field, along with the BoxMG mathematical software for computation of POT is described.</p><figure><img src="https://i.imgur.com/kgs4meR.png" alt="WRF-ELEC" /><figcaption>WRF-ELEC</figcaption></figure><h1 id="what-is-the-time-interval-in-lightflash-column-1">What is the time interval in light(flash column-1)?</h1><p><a href="https://github.com/MicroTed/wrf4-elec/blob/7c90e71bdc4db527d0ec034804e4fd200cdacf28/phys/module_microphysics_driver.F#L117" class="uri">https://github.com/MicroTed/wrf4-elec/blob/7c90e71bdc4db527d0ec034804e4fd200cdacf28/phys/module_microphysics_driver.F#L117</a></p><p>!--light 2D flash origin densities per output time !--lightdens 2D flash extent densities per output time !--lightdis 2D total number of discharge points per output time</p><ul><li>per output time?<ul><li>To find the number of flashes between output times, simply subtract the flashcount array from the previous output time from the current output time to get number of flashes per dt (where64dt = time between output files).</li></ul></li></ul><p>From <a href="https://github.com/MicroTed/wrf4-elec/blob/7c90e71bdc4db527d0ec034804e4fd200cdacf28/dyn_em/solve_em.F#L157">solve_em.F</a>, <strong>diag_flag and diag_flag_hist</strong> are</p><ul><li>Set diagnostic flag value <strong>history output time</strong></li></ul><figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs fortran"><span class="hljs-comment">!-----------------------------------------------------------------------------</span><br><span class="hljs-comment">!</span><br><span class="hljs-comment">! Set restart flag value history output time</span><br><span class="hljs-comment">!-----------------------------------------------------------------------------</span><br>   restart_flag = <span class="hljs-literal">.false.</span><br>   <span class="hljs-keyword">if</span> ( Is_alarm_tstep(grid%domain_clock, grid%alarms(restart_alarm)) ) <span class="hljs-keyword">then</span><br>      restart_flag = <span class="hljs-literal">.true.</span><br>   <span class="hljs-keyword">endif</span><br><span class="hljs-comment">!</span><br><span class="hljs-comment">! Set diagnostic flag value history output time</span><br><span class="hljs-comment">!-----------------------------------------------------------------------------</span><br><br>   ke_diag = kms <span class="hljs-comment">! default to ke_diag=1 in case of nwp_diagnostics == 1</span><br>   diag_flag = <span class="hljs-literal">.false.</span><br>   <span class="hljs-keyword">if</span> ( Is_alarm_tstep(grid%domain_clock, grid%alarms(HISTORY_ALARM)) ) <span class="hljs-keyword">then</span><br>      diag_flag = <span class="hljs-literal">.true.</span><br>      ke_diag = <span class="hljs-built_in">min</span>(k_end,kde-<span class="hljs-number">1</span>) <span class="hljs-comment">! set depth to full domain for reflectivity field</span><br>   <span class="hljs-keyword">endif</span><br>   diag_flag_hist = diag_flag<br></code></pre></td></tr></table></figure><ul><li>In <a href="https://github.com/MicroTed/wrf4-elec/blob/7c90e71bdc4db527d0ec034804e4fd200cdacf28/elec/include_microphysics_driver_elec.F#L24">include_microphysics_driver_elec.F</a>,<ul><li>diag_flag_hist</li><li>clear_history = .true.</li><li>all set = 0.0</li></ul></li></ul><figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs fortran"><span class="hljs-comment">! this sets the clear flag for the next time step if a history dump is occurring now</span><br><span class="hljs-keyword">IF</span> ( diag_flag_hist ) <span class="hljs-keyword">THEN</span><br>   clear_history = <span class="hljs-literal">.true.</span><br><span class="hljs-keyword">ENDIF</span><br><br><span class="hljs-comment">!    add up flashes up to history dump </span><br><br><span class="hljs-comment">!     if (MOD(NINT(curr_secs),history_interval*60).eq.0) then</span><br><span class="hljs-keyword">IF</span> ( clear_history ) <span class="hljs-keyword">THEN</span><br>   clear_history = <span class="hljs-literal">.false.</span><br><span class="hljs-comment">!      write(0,*) &#x27;clear arrays&#x27;</span><br>light(:,:) = <span class="hljs-number">0.</span><br>lightdis(:,:) = <span class="hljs-number">0.</span><br>lightdens(:,:) = <span class="hljs-number">0.</span><br>induc(:,:,:) = <span class="hljs-number">0.0</span><br>noninduc(:,:,:) = <span class="hljs-number">0.0</span><br>   <span class="hljs-keyword">IF</span> ( idischarge == <span class="hljs-number">1</span> ) <span class="hljs-keyword">THEN</span><br>   lightfod(:,:) = <span class="hljs-number">0.</span><br>   ELSEIF ( idischarge &gt;= <span class="hljs-number">2</span> ) <span class="hljs-keyword">THEN</span><br>   flshfedic(:,:) = <span class="hljs-number">0.</span><br>   flshfedicp(:,:) = <span class="hljs-number">0.</span><br>   flshfedicn(:,:) = <span class="hljs-number">0.</span><br>   flshfedcg(:,:) = <span class="hljs-number">0.</span><br>   flshfedcgp(:,:) = <span class="hljs-number">0.</span><br>   flshfedcgn(:,:) = <span class="hljs-number">0.</span><br>   flshi(:,:,:) = <span class="hljs-number">0.</span><br>   flshn(:,:,:) = <span class="hljs-number">0.</span><br>   flshp(:,:,:) = <span class="hljs-number">0.</span><br>   <span class="hljs-keyword">ENDIF</span><br></code></pre></td></tr></table></figure><h1 id="wrf-practice">WRF practice</h1><table><thead><tr class="header"><th style="text-align: left;">option</th><th style="text-align: left;"></th></tr></thead><tbody><tr class="odd"><td style="text-align: left;">elec_physics</td><td style="text-align: left;">= 0, electrification (and charge arrays) turned off (DEFAULT) <br> = 1, electrification turned on (only works with mp_physics = 17, 18, or 22 i.e., 2-moment NSSL schemes)</td></tr><tr class="even"><td style="text-align: left;">nssl_ipelec (max_dom)</td><td style="text-align: left;">! NOTE: only set this to a nonzero value on the innermost domain <br> = 0, charging turned off <br> = 2, non-inductive charging only <br> = 3, non-inductive + inductive charging <br> = 1, not used (reserved for future use)</td></tr><tr class="odd"><td style="text-align: left;">nssl_idischarge</td><td style="text-align: left;"><br> = 0, no discharge <br> = 1, Cylindrical "1D" lightning scheme based on Ziegler and MacGorman (1994, JAS) <br> = 2, 3D discrete discharge adapted from MacGorman et al. (2001)</td></tr></tbody></table><ul><li>The WRF-ELEC model outputs a variety of variables related to electrification processes and lightning activity in thunderstorms. Some of the key output variables include:</li></ul><table><thead><tr class="header"><th>WRF-ELEC variables</th><th>Unit</th><th>Description</th></tr></thead><tbody><tr class="odd"><td>LIGHT(Time, south_north, west_east)</td><td>flash origin density</td><td>lightning flash initiations</td></tr><tr class="even"><td>LIGHTDENS(Time, south_north, west_east)</td><td>flash column-1</td><td>lightning flash density</td></tr><tr class="odd"><td>LIGHTFOD(Time, south_north, west_east)</td><td>flash column-1</td><td>normalized lightning flash origin density</td></tr><tr class="even"><td>LIGHTDIS(Time, south_north, west_east)</td><td>Source column-1</td><td>lightning source density</td></tr><tr class="odd"><td>POT(Time, bottom_top, south_north, west_east)</td><td>V</td><td>POTENTIAL</td></tr><tr class="even"><td>ELECMAG(Time, bottom_top, south_north, west_east)</td><td>V m-1</td><td>EFIELD MAGNITUDE</td></tr><tr class="odd"><td>ELECX(Time, bottom_top, south_north, west_east)</td><td>V m-1</td><td>EFIELD X-Component</td></tr><tr class="even"><td>ELECY(Time, bottom_top, south_north, west_east)</td><td>V m-1</td><td>EFIELD Y-Component</td></tr><tr class="odd"><td>ELECZ(Time, bottom_top, south_north, west_east)</td><td>V m-1</td><td>EFIELD Z-Component</td></tr><tr class="even"><td>SCTOT(Time, bottom_top, south_north, west_east)</td><td>C m-3</td><td>Total Space Charge Density</td></tr><tr class="odd"><td>RSCGHIS_2D(Time, south_north, west_east)</td><td>C m-2</td><td>MAX NONINDUCTIVE CHARGING 2D</td></tr><tr class="even"><td>INDUC(Time, bottom_top, south_north, west_east)</td><td>C m-3</td><td>TOTAL INDUCTIVE CHARGING</td></tr><tr class="odd"><td>NONINDUC(Time, bottom_top, south_north, west_east)</td><td>C m-3</td><td>TOTAL NONINDUCTIVE CHARGING</td></tr><tr class="even"><td>SCTOT(Time, bottom_top, south_north, west_east)</td><td>C m-3</td><td>Total Space Charge Density</td></tr></tbody></table><ul><li>If the lightning discharge flag (nssl_idischarge = 2) that is lightning3d, More output variables include: (LIGHTFOD is not calculated)</li></ul><table><thead><tr class="header"><th>WRF-ELEC variables</th><th>Unit</th><th>Description</th></tr></thead><tbody><tr class="odd"><td>FLSHFEDIC(Time, south_north, west_east)</td><td>flash column-1</td><td>IC lightning flash extent density</td></tr><tr class="even"><td>FLSHFEDICP(Time, south_north, west_east)</td><td>flash column-1</td><td>IC pos lightning flash extent density</td></tr><tr class="odd"><td>FLSHFEDICN(Time, south_north, west_east)</td><td>flash column-1</td><td>IC neg lightning flash extent density</td></tr><tr class="even"><td>FLSHFEDCG(Time, south_north, west_east)</td><td>flash column-1</td><td>CG lightning flash extent density</td></tr><tr class="odd"><td>FLSHFEDCGN(Time, south_north, west_east)</td><td>flash column-1</td><td>CG neg lightning flash extent density</td></tr><tr class="even"><td>FLSHFEDCGP(Time, south_north, west_east)</td><td>flash column-1</td><td>CG pos lightning flash extent density</td></tr><tr class="odd"><td>FLSHI(Time, bottom_top, south_north, west_east)</td><td>count</td><td>Lightning init points</td></tr><tr class="even"><td>FLSHN(Time, bottom_top, south_north, west_east)</td><td>count</td><td>Negative channels</td></tr><tr class="odd"><td>FLSHP(Time, bottom_top, south_north, west_east)</td><td>count</td><td>Positive channels</td></tr></tbody></table><h1 id="cost-elapsed-time">Cost: Elapsed time</h1><table><thead><tr class="header"><th style="text-align: left;">WRF-ELEC</th><th style="text-align: left;">mp</th><th style="text-align: left;">idischarge</th><th style="text-align: left;">Elapsed time</th></tr></thead><tbody><tr class="odd"><td style="text-align: left;">elec=0</td><td style="text-align: left;">17</td><td style="text-align: left;">none</td><td style="text-align: left;">4h49m</td></tr><tr class="even"><td style="text-align: left;">elec=1</td><td style="text-align: left;">17</td><td style="text-align: left;">1</td><td style="text-align: left;">6h13m</td></tr><tr class="odd"><td style="text-align: left;">elec=1</td><td style="text-align: left;">17</td><td style="text-align: left;">2</td><td style="text-align: left;">9h1m</td></tr></tbody></table><p>WRFv4.5-ELEC.</p><h1 id="literature-review">Literature review</h1><p>Lightning activity is related to two important factors: dynamic–thermodynamic and microphysical characteristics (e.g., Williams et al., 2005; Rosenfeld et al., 2008; Guo et al., 2016; Wang et al., 2018; Zhao et al., 2020). Since the dynamic–thermodynamic processes affect the development of thunderstorm significantly, lightning activity is influenced by various dynamic–thermodynamic variables: temperature (Price, 1993), relative humidity in the lower and middle troposphere (Xiong et al., 2006; Fan et al., 2007), convective available potential energy (Qie et al., 2004; Stolz et al., 2015), and many others.</p><h2 id="pr92">(1992) PR92</h2><blockquote><p>Price, C., and D. Rind (1992), A Simple Lightning Parameterization for Calculating Global Lightning Distributions, J. Geophys. Res., 97(D9), 9919-9933, doi:10.1029/92JD00719.<br />Wong, J., M. Barth, and D. Noone, 2013: Evaluating a lightning parameterization based on cloud-top height for mesoscale numerical model simulations, Geosci. Model Dev., 6, 429–443, GMD - Evaluating a lightning parameterization based on cloud-top height for mesoscale numerical model simulations.</p></blockquote><p>ref: <a href="https://ruc.noaa.gov/wrf/wrf-chem/Users_guide.pdf">WRF-Chem Version 4.4 User's Guide: Appendix C: Using the Lightning-NOx Parameterization in WRF-Chem</a></p><p>You may also find useful information in the actual code for the schemes:</p><ul><li>module_lightning_driver.F</li><li>module_ltng_crmpr92.F</li></ul><h2 id="prediction-of-lightning-flash-density-with-the-wrf-model">(2010) Prediction of lightning flash density with the WRF model</h2><blockquote><p><a href="https://pdfs.semanticscholar.org/a206/1d033ccf90082c05a1514df4920005035c0b.pdf" class="uri">https://pdfs.semanticscholar.org/a206/1d033ccf90082c05a1514df4920005035c0b.pdf</a><br />Lynn, B., and Yoav Yair. "Prediction of lightning flash density with the WRF model." Advances in Geosciences 23 (2010): 11-16.</p></blockquote><p>The <strong>Lightning Potential Index (LPI)</strong> is a measure of the potential for charge generation and separation that leads to lightning flashes in convective thunderstorms. It is calculated from model simulated updraft and microphysical fields. It was designed to predict the potential of lightning occurrence in operational weather forecasting models, but could possibly be used to improve short-range forecasts of heavy rain. <strong>The index is modified here to be model grid-scale transparent between 1 and 4 km (the approximate upper limit of explicit microphysical weather forecasts)</strong>. Two case studies show that the modification appears to work quite well, and that LPI can be calculated on both an extremely high resolution research-grid (i.e., 1.33 km) and high resolution (i.e., 4 km) operationally compatible forecast grid. Analytical expressions are presented to use the LPI to predict the hourly lightning flash density.</p><h2 id="fierro-et-al.">(2013) Fierro et al.</h2><blockquote><p>Fierro, A. O., Mansell, E. R., MacGorman, D. R., &amp; Ziegler, C. L. (2013). The implementation of an explicit charging and discharge lightning scheme within the WRF-ARW model: Benchmark simulations of a continental squall line, a tropical cyclone, and a winter storm. Monthly Weather Review, 141(7), 2390-2415.</p></blockquote><p>This work describes the recent implementation of explicit lightning physics within the Weather Research and Forecasting (WRF) Model.</p><ul><li>Charging of hydrometeors consists of five distinct noninductive parameterizations, polarization of cloud water, and the exchange of charge during collisional mass transfer.</li><li>The three components of the ambient electric field are explicitly solved for via the computationally efficient multigrid elliptic solver.</li><li>The discharge process employs concepts adapted from two well-documented bulk lightning models, whereby charge reduction is imposed within a prescribed volume centered at grid points characterized by electric field magnitudes exceeding a given breakdown threshold.</li></ul><p>This lightning model was evaluated through benchmark</p><ul><li>convection-allowing (3 km) model simulations of three contrasting convective systems: a continental squall line,</li><li>a major hurricane (Rita 2005), and</li><li>a winter storm.</li></ul><p>The areal coverage and magnitude of the simulated hourly flash origin density (FOD) for the continental squall line are qualitatively comparable to that of the total lightning data observations from Earth Networks Total Lightning Network (ENTLN). In agreement with the ENTLN observations, no FOD are simulated for the winter storm case. The simulated spatial FOD pattern of the hurricane and the eyewall gross charge structure were both in reasonable agreement with observations. The simulated FOD for all three cases were also evaluated against those obtained with the recently developed McCaul diagnostic lightning prediction schemes and exhibited overall good qualitative agreement with each other for Rita and the continental squall line.</p><h2 id="thunderstorm-indices-lpi-layrh-scp">Thunderstorm Indices (LPI, Layrh, SCP)</h2><p><strong>Thunderstorm Indices (LPI, Layrh, SCP)</strong> obtained from IMD-WRF (3km) Hourly outputs.</p><ul><li>Model GEFS - WRF Description</li><li><a href="https://srf.tropmet.res.in/srf/ts_prediction_system/lpi_model.php" class="uri">https://srf.tropmet.res.in/srf/ts_prediction_system/lpi_model.php</a></li><li><strong>Lightning Potential Index (LPI)</strong><ul><li>Here, LPI has been calculated using IMD-WRF (3km) hourly model output. 24 Hour accumulated LPI has been generated by adding hourly LPI values. The threat of LPI has been categorized in Low, Moderate and High. LOW: LPI &lt; 0.001 and &gt;0.0005; Moderate: LPI :&lt; 0.01 and &gt; 0.001; Threat Level: High: LPI &gt; 0.01.</li></ul></li><li><strong>SuperCell Composite Parameter (SCP)</strong><ul><li>SCP &gt; 1 indicated that the environment is conducive for thunderstorm formation. The Threat Level of SCP has been categorized in Low, Moderate and High. LOW: 3 &lt; SCP &lt; 5; Moderate: 5 &lt; SCP &lt; 7; High: SCP &gt; 7.</li></ul></li><li><strong>Layer Relative Humidity (LAYRH)</strong><ul><li>The threat level of Layrh has been categorized in Low, Moderate and High. LOW: 20 &lt; LAYRH &lt; 40; Moderate: 40 &lt; LAYRH &lt; 60; High : LAYRH &gt; 60</li></ul></li></ul><h2 id="numerical-study-of-performance-of-two-lightning-prediction-methods-based-on-lightning-potential-index-lpi-and-electric-potential-difference-pot-over-tehran-area">(2019) Numerical study of performance of two lightning prediction methods based on: Lightning Potential Index (LPI) and electric POTential difference (POT) over Tehran area</h2><blockquote><p><strong>Gharaylou, M., Farahani, M. M., Hosseini, M., &amp; Mahmoudian, A. (2019). Numerical study of performance of two lightning prediction methods based on: Lightning Potential Index (LPI) and electric POTential difference (POT) over Tehran area</strong>. Journal of Atmospheric and Solar-Terrestrial Physics, 193, 105067.</p></blockquote><p>The electric POTential difference (POT) and the Lightning Potential Index (LPI) performance in predicting the lightning activity is investigated and the probable relationship between them is examined. These two indices have a similar dependency on microphysical variables such as ice, graupel mixing ratios, and also updraft characteristics within the cloud. Regardless of this similarity, the LPI directly calculated from WRF model is a more favorable parameter for predicting the lightning events in comparison with the POT, which requires an extra package (ELEC) model. Ten years' available data over the Tehran area were reviewed and four thundercloud cases with distinct characteristics (CAPE, time-frequency, intensity) were selected. In order to acquire the associated physical properties, four simulations have been done using the WRF-ELEC model, which is initialized with ERA-Interim data.</p><h2 id="prediction-of-lightning-activity-using-wrf-elec-model">**(2020) Prediction of lightning activity using WRF-ELEC model</h2><blockquote><p><strong>Gharaylou, M., Farahani, M. M., Mahmoudian, A., &amp; Hosseini, M. (2020). Prediction of lightning activity using WRF-ELEC model: Impact of initial and boundary conditions</strong>. Journal of Atmospheric and Solar-Terrestrial Physics, 210, 105438.</p></blockquote><blockquote><ul><li><a href="https://sci-hub.se/https://doi.org/10.1016/j.jastp.2020.105438" class="uri">https://sci-hub.se/https://doi.org/10.1016/j.jastp.2020.105438</a></li></ul></blockquote><ul><li>The WRF model belongs to the first group in which lightning is predicted based on the <strong>Bulk Lightning Model (BLM)</strong>. Ziegler and MacGorman (1994) have studied lightning flashes in a twoand three-dimensional cloud models using the WRF model.</li><li>In the early 90s, Price and Rind (1992) developed a lightning parameterization scheme based on <strong>cloud-top height</strong>.</li><li>Furthermore, another lightning flash parameterization scheme has been introduced by Allen and Pickering (2002) and Allan et al. (2010) based on the <strong>square of deep convective mass flux</strong>.</li><li>Choi et al. (2005) and Zhao et al. (2009) incorporated the <strong>convective available potential energy (CAPE)</strong> in their comparative parameterizations.</li><li>Yair et al. (2010) introduced <strong>Lightning Potential Index (LPI)</strong>, an advanced index for evaluating the probability of lightning occurrence, incorporated the dynamic and microphysic concepts.</li><li>Following, Lynn et al. (2012) introduced the <strong>potential electrical energy (Ep) parameter</strong> into the WRF model, which was used to predict both <strong>Cloud-to-Ground (CG)</strong> and <strong>Intra-Cloud (IC)</strong> <em>lightning events</em>.</li><li>Afterwards, Wong et al. (2013) developed the lightning parameterization based on cloud-top height (Price and Rind, 1992).</li><li>Gharaylou et al. (2019) examined 2 indices which are used in predicting the lightning activities both in time and location. They compared the <strong>electric potential difference (POT)</strong> and the <strong>LPI</strong> performance in predicting the lightning associated with four events over a domain located in the north of Iran.</li><li><strong>The LPI is computationally less expensive and is directly calculated by the WRF model with less computational cost in comparison with the POT which requires an extra package (ELEC model).</strong><ul><li>LPI calculations have been discussed in our previous paper (Gharaylou et al., 2019)</li></ul></li></ul><h3 id="effect-of-initial-and-boundary-conditions-ibcs">Effect of Initial and boundary conditions (IBCs)</h3><ul><li>The mesoscale models ordinarily obtain their initial and boundary conditions (IBCs) from large scale global models. <strong>Applying different initial conditions highly influences the accuracy of the model prediction in local areas</strong> (Zhang et al., 2002, 2006).</li><li>A few works have been done to investigate the effect of initial conditions on lightning activity (Lynn et al., 2012).</li><li>Zepka et al. (2014) studied the impact of the resolution of the NCEP operational Global Forecast System.</li><li>As mentioned, <strong><em>there are very few works</em></strong> related to the assessment of IBC effects in the WRF-ELEC model for lightning prediction.<ul><li>WRF-ELEC model initialized with different datasets needs to be verified.</li></ul></li></ul><h1 id="case-hong-kong-lightning">Case: Hong Kong Lightning</h1><p>The "Hong Kong Observatory Lightning Statistics" refers to the detailed records of lightning activity in the Hong Kong region, primarily categorized into cloud-to-ground lightning and intra-cloud lightning. This data not only aids in understanding meteorological patterns but also enhances awareness of the safety risks associated with lightning strikes.</p><ul><li><a href="https://www.hko.gov.hk/tc/wservice/tsheet/llis.htm">香港天文台閃電位置資訊服務 HKO Lightning Location Information Service</a></li></ul><figure><img src="https://www.hko.gov.hk/tc/wservice/tsheet/images/fact2c.jpg" alt="閃電定位網絡各個探測站的位置分佈圖/Distribution of lightning sensor stations of the lightning location network" /><figcaption>閃電定位網絡各個探測站的位置分佈圖/Distribution of lightning sensor stations of the lightning location network</figcaption></figure><ul><li><a href="https://www.hko.gov.hk/en/wxinfo/llis/llis_map.htm">Lightning density map for Hong Kong</a></li></ul><figure><img src="https://www.hko.gov.hk/en/wxinfo/llis/images/ll_density_e.png" alt="Average yearly number of cloud-to-ground lightning strokes per square kilometer" /><figcaption>Average yearly number of cloud-to-ground lightning strokes per square kilometer</figcaption></figure><ul><li><a href="https://maps.weather.gov.hk/ocf/index_uc.html?data=ncln">閃電（試驗版） | 香港及珠江三角洲區域自動分區天氣預報/Automatic regional weather forecast in Hong Kong and the Pearl River Delta region</a></li></ul><h2 id="statistics-of-lightning-days-at-the-hko-weather-station">Statistics of lightning days at the HKO Weather Station</h2><figure><img src="../../../../figures/2024-09-20-wrf4-elec-lightning/Statistics_of_lightning_days_at_the_HKO_Weather_Station.png" alt="Statistics of lightning days at the HKO Weather Station (Last updated: August 31, 2024). From i-lens.hk" /><figcaption>Statistics of lightning days at the HKO Weather Station (Last updated: August 31, 2024). From <a href="https://i-lens.hk/hkweather/special_stat.php?event=LIGHTING_DAY&amp;station=HKO">i-lens.hk</a></figcaption></figure><h2 id="all-weather-stations---ranking-of-highest-daily-total-lightning-counts-in-history">All Weather Stations - Ranking of Highest Daily Total Lightning Counts in History</h2><p>From <a href="https://i-lens.hk/hkweather/rank.php?station=ALL&amp;element=L_BOTH&amp;type=MAX&amp;year=&amp;month=">i-lens.hk</a>, Last updated: August 31, 2024</p><table><thead><tr class="header"><th style="text-align: center;">Ranking</th><th style="text-align: center;">Weather Station</th><th style="text-align: center;">Start observation year</th><th style="text-align: center;">Observation date</th><th style="text-align: center;">Total number of lightning strikes per day (times)</th></tr></thead><tbody><tr class="odd"><td style="text-align: center;">1</td><td style="text-align: center;">Hong Kong Observatory</td><td style="text-align: center;">2005</td><td style="text-align: center;">2020-06-06</td><td style="text-align: center;">47537</td></tr><tr class="even"><td style="text-align: center;">2</td><td style="text-align: center;">Hong Kong Observatory</td><td style="text-align: center;">2005</td><td style="text-align: center;">2020-06-07</td><td style="text-align: center;">41446</td></tr><tr class="odd"><td style="text-align: center;">3</td><td style="text-align: center;">Hong Kong Observatory</td><td style="text-align: center;">2005</td><td style="text-align: center;">2019-04-20</td><td style="text-align: center;">36299</td></tr><tr class="even"><td style="text-align: center;">4</td><td style="text-align: center;">Hong Kong Observatory</td><td style="text-align: center;">2005</td><td style="text-align: center;">2023-06-01</td><td style="text-align: center;">36253</td></tr><tr class="odd"><td style="text-align: center;">5</td><td style="text-align: center;">Hong Kong Observatory</td><td style="text-align: center;">2005</td><td style="text-align: center;">2024-04-30</td><td style="text-align: center;">32603</td></tr><tr class="even"><td style="text-align: center;">6</td><td style="text-align: center;">Hong Kong Observatory</td><td style="text-align: center;">2005</td><td style="text-align: center;">2021-06-28</td><td style="text-align: center;">31859</td></tr><tr class="odd"><td style="text-align: center;">7</td><td style="text-align: center;">Hong Kong Observatory</td><td style="text-align: center;">2005</td><td style="text-align: center;">2019-08-25</td><td style="text-align: center;">24951</td></tr><tr class="even"><td style="text-align: center;">8</td><td style="text-align: center;">Hong Kong Observatory</td><td style="text-align: center;">2005</td><td style="text-align: center;">2019-04-19</td><td style="text-align: center;">22053</td></tr><tr class="odd"><td style="text-align: center;">9</td><td style="text-align: center;">Hong Kong Observatory</td><td style="text-align: center;">2005</td><td style="text-align: center;">2018-08-22</td><td style="text-align: center;">21152</td></tr><tr class="even"><td style="text-align: center;">10</td><td style="text-align: center;">Hong Kong Observatory</td><td style="text-align: center;">2005</td><td style="text-align: center;">2022-07-30</td><td style="text-align: center;">20187</td></tr><tr class="odd"><td style="text-align: center;">11</td><td style="text-align: center;">Hong Kong Observatory</td><td style="text-align: center;">2005</td><td style="text-align: center;">2019-06-13</td><td style="text-align: center;">19526</td></tr><tr class="even"><td style="text-align: center;">12</td><td style="text-align: center;">Hong Kong Observatory</td><td style="text-align: center;">2005</td><td style="text-align: center;">2010-09-09</td><td style="text-align: center;">18813</td></tr><tr class="odd"><td style="text-align: center;">13</td><td style="text-align: center;">Hong Kong Observatory</td><td style="text-align: center;">2005</td><td style="text-align: center;">2013-05-22</td><td style="text-align: center;">18568</td></tr><tr class="even"><td style="text-align: center;">14</td><td style="text-align: center;">Hong Kong Observatory</td><td style="text-align: center;">2005</td><td style="text-align: center;">2020-09-15</td><td style="text-align: center;">17879</td></tr><tr class="odd"><td style="text-align: center;">15</td><td style="text-align: center;">Hong Kong Observatory</td><td style="text-align: center;">2005</td><td style="text-align: center;">2020-05-30</td><td style="text-align: center;">17765</td></tr><tr class="even"><td style="text-align: center;">16</td><td style="text-align: center;">Hong Kong Observatory</td><td style="text-align: center;">2005</td><td style="text-align: center;">2006-06-09</td><td style="text-align: center;">17587</td></tr><tr class="odd"><td style="text-align: center;">17</td><td style="text-align: center;">Hong Kong Observatory</td><td style="text-align: center;">2005</td><td style="text-align: center;">2014-03-30</td><td style="text-align: center;">16823</td></tr><tr class="even"><td style="text-align: center;">18</td><td style="text-align: center;">Hong Kong Observatory</td><td style="text-align: center;">2005</td><td style="text-align: center;">2024-04-26</td><td style="text-align: center;">16328</td></tr><tr class="odd"><td style="text-align: center;">19</td><td style="text-align: center;">Hong Kong Observatory</td><td style="text-align: center;">2005</td><td style="text-align: center;">2010-09-08</td><td style="text-align: center;">14659</td></tr><tr class="even"><td style="text-align: center;">20</td><td style="text-align: center;">Hong Kong Observatory</td><td style="text-align: center;">2005</td><td style="text-align: center;">2023-04-21</td><td style="text-align: center;">14471</td></tr></tbody></table><h2 id="overview-of-climate-change-effects">Overview of Climate Change Effects</h2><p>Climate change, driven by the increase in greenhouse gases, has a profound impact on weather patterns. As global temperatures rise, more energy is available in the atmosphere, which intensifies convective storms. Since lightning is primarily a product of such storms, the increase in the frequency and intensity of these storms can lead to changes in lightning activity.</p><ul><li><strong>Increase Per Degree of Warming:</strong> Across the continental United States (CONUS), the CAPE × P proxy predicts a 12 ± 5% rise in lightning strike rates for each 1°C increase in global mean temperature (Romps et al., 2014). This research suggests that as the planet warms, lightning frequency will likely increase. A 12% rise in lightning activity is anticipated for every degree of warming, which could result in a 50% increase in lightning strikes in regions like the U.S. by the end of the century (Romps et al., 2014; Romps, 2021).</li><li><strong>Specific Regional Studies:</strong> Focused on the South China Sea (SCS) and surrounding regions in Southeast Asia to analyze long-term trends and future projections of lightning activity using the longest available satellite-based lightning dataset and climate models. The projections indicate that lightning activity in the SCS region is expected to increase by 10% under SSP245 and by 12% under SSP370 by the end of the 21st century. (Xu et al., 2023; Xu et al., 2024)</li><li><strong>Impact of Global Warming on Future Lightning Events</strong><ul><li>The IPCC AR6 defines several Shared Socioeconomic Pathways (SSPs) that describe possible future climate scenarios based on different levels of greenhouse gas emissions. (e.g., SSP5-8.5: Very high emissions, with warming over 4.4°C)</li></ul></li><li><strong>Regional Studies on Future Lightning Events (e.g., South China Sea)</strong></li></ul><p>From these papers,</p><ul><li>Romps, D. M., Seeley, J. T., Vollaro, D., &amp; Molinari, J. (2014). Projected increase in lightning strikes in the United States due to global warming. Science, 346(6211), 851-854.</li><li>Romps, D. M. (2019). Evaluating the future of lightning in cloud‐resolving models. Geophysical Research Letters, 46(24), 14863-14871.</li><li>Xu, L., Cao, X., Lan, X., Zhang, W., Sun, C., &amp; Zhang, Y. (2024). Future increase in lightning around the South China Sea under climate change. Earth and Space Science, 11(6), e2023EA003356.</li><li>Xu, Mingyi, et al. "Distribution of lightning spatial modes and climatic causes in China." Atmospheric and Oceanic Science Letters 16.2 (2023): 100338.</li></ul><h1 id="references">References</h1><ol type="1"><li>香港天文台<ol type="1"><li><a href="https://www.hko.gov.hk/tc/education/weather/thunderstorm-and-lightning/00031-what-are-thunderstorms.html">什麼是雷暴？</a></li><li><a href="https://www.hko.gov.hk/tc/publica/reprint/files/r622.pdf">2006-Reprint 622-探討閃電位置數據應用在臨近預報的前景</a></li><li><a href="https://www.weather.gov.hk/tc/publica/reprint/files/r817a.pdf">2009-Reprint 817-香港一次夏季雹暴的天氣過程分析及臨近預報系統的應用</a></li><li><a href="https://www.weather.gov.hk/en/publica/reprint/files/r1035.pdf">2012-Reprint 1035-利用閃電數據監測暴雨發展的個案分析</a></li><li><a href="https://www.hko.gov.hk/en/publica/reprint/files/r1337.pdf">2018-Reprint 1337-粵港澳閃電定位網絡的最新發展及與超強颱風天鴿相關之數據分析</a></li><li><a href="https://www.hko.gov.hk/tc/publica/reprint/files/r1341.pdf">2018-Reprint 1341-公眾定點閃電臨近預報服務</a></li><li><a href="https://www.hko.gov.hk/en/publica/reprint/files/r1358.pdf">2019-Reprint 1358-區域與全球閃電定位資料於珠三角地區的精細化比對</a></li><li><a href="https://www.hko.gov.hk/tc/publica/ghm_21/files/HPaper_WongCP.pdf">2020-在珠三角一帶與大雨相關的閃電特徵分析</a></li></ol></li><li><a href="https://mp.weixin.qq.com/s/yuzCZB2Nb5CydG3WCysK_w">世界气候“雷极”：印度尼西亚爪哇岛，平均年雷雨日数超过220天</a></li><li>徐良韬, 张义军, 王飞, 郑栋. 2012: 雷暴起电和放电物理过程在WRF模式中的耦合及初步检验. 大气科学, 36(5): 1041-1052. DOI: 10.3878/j.issn.1006-9895.2012.11235<ol type="1"><li>WRFv3.2.1</li><li>本文将雷暴云的起电、放电物理过程引入中尺度的WRF (Weather Research and Forecasting) 模式,并对超级单体和飑线过程进行了模拟研究.起电过程在Milbrandt双参数微物理方案中写入,包含霰、雹与冰晶、雪之间的非感应起电机制,以及霰、雹与云滴之间的感应起电机制.</li></ol></li><li>徐良韬, 陈双, 姚雯, 等. 利用起放电模式开展闪电活动的直接预报试验. 应用气象学报, 2018, 29(5): 534-545. DOI: 10.11898/1001-7313.20180503.<ol type="1"><li>WRFv3.4.1</li><li>利用耦合有起电和放电物理过程的中尺度起电放电模式WRF-Electric</li></ol></li><li>Wasson, G., &amp; Panda, S. K. (2024). Sensitivity of PBL parameterization schemes in simulating lightning and thunderstorm using WRF-ELEC model. Climate Dynamics, 1-23.<ol type="1"><li>The WRF-ELEC model, an auxiliary package integrated into WRF, is specifically designed to compute electric potential and overall lightning flash rate (source: <a href="https://sourceforge.net/projects/wrfelec" class="uri">https://sourceforge.net/projects/wrfelec</a>).</li><li>It incorporates explicit cloudresolving scale physics for lightning prediction (<a href="https://scholar.google.com/scholar_url?url=https://journals.ametsoc.org/view/journals/mwre/141/7/mwr-d-12-00278.1.xml%3Ftab_body%3Dpdf&amp;hl=en&amp;sa=T&amp;oi=gsr-r-ggp&amp;ct=res&amp;cd=0&amp;d=6841908713848986342&amp;ei=DTHtZqfdAfSC6rQP2qO70AU&amp;scisig=AFWwaeaoJDdXALkuhsn44g0xEyU5">Fierro et al.2013</a>). Detailed formulations can be found in <a href="https://scholar.google.com/scholar_url?url=https://agupubs.onlinelibrary.wiley.com/doi/abs/10.1029/2004jd005287&amp;hl=en&amp;sa=T&amp;oi=gsr-r&amp;ct=res&amp;cd=0&amp;d=13100036974408530565&amp;ei=JTHtZs_QIeqs6rQPw4y2sAM&amp;scisig=AFWwaeZ27Z0oFR35ZZvLDk-yrgo_">Mansell et al.(2005)</a> and <a href="https://scholar.google.com/scholar_url?url=https://journals.ametsoc.org/view/journals/mwre/141/7/mwr-d-12-00278.1.xml%3Ftab_body%3Dpdf&amp;hl=en&amp;sa=T&amp;oi=gsr-r-ggp&amp;ct=res&amp;cd=0&amp;d=6841908713848986342&amp;ei=OTHtZtytGPay6rQPxrKeiAM&amp;scisig=AFWwaeaoJDdXALkuhsn44g0xEyU5">Fierro et al. (2013)</a>.</li><li>skill scores were calculated for each experiment.<ol type="1"><li>standard statistics and skill score analysis of CAPE (J/kg) and accumulated total precipitation (mm),</li></ol></li></ol></li><li>Saleh, N., Gharaylou, M., Farahani,M. M., &amp; Alizadeh, O. (2023).Performance of lightning potentialindex, lightning threat index, and theproduct of CAPE and precipitationin the WRF model. Earth and SpaceScience, 10, e2023EA003104. <a href="https://doi.org/10.1029/2023EA003104" class="uri">https://doi.org/10.1029/2023EA003104</a></li><li><a href="https://weather.ndc.nasa.gov/sport/training/lfa/LFAtraining_20111025.pdf">2011: Lightning Forecast Algorithm (LFA) Overview</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>WRF</category>
      
    </categories>
    
    
    <tags>
      
      <tag>WRF-ELEC</tag>
      
      <tag>Lightning</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Setting up Hexo Blog on github.io</title>
    <link href="/2024/09/13/Hexo/"/>
    <url>/2024/09/13/Hexo/</url>
    
    <content type="html"><![CDATA[<h1 id="hexo">Hexo</h1><p><a href="https://hexo.io/zh-cn/docs/#%E4%BB%80%E4%B9%88%E6%98%AF-Hexo%EF%BC%9F">Hexo</a> 是一个快速、简洁且高效的博客框架。 Hexo 使用 Markdown（或其他标记语言）解析文章，在几秒内，即可利用靓丽的主题生成静态网页。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">micromamba <span class="hljs-built_in">env</span> create -n hexo<br>micromamba activate hexo<br>micromamba install conda-forge::nodejs<br></code></pre></td></tr></table></figure><ul><li>nodejs 22.8.0</li><li>git is installed</li></ul><p>底下是官方寫的 Quick Start，只需要短短五行指令就可以讓部落格跑起來。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh">npm install hexo-cli -g<br>hexo init blog<br><span class="hljs-built_in">cd</span> blog<br>npm install<br>hexo server<br></code></pre></td></tr></table></figure><p>display <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">INFO  Hexo is running at http://localhost:4000/ . Press Ctrl+C to stop.<br></code></pre></td></tr></table></figure></p><ul><li>如果你已經有部落格資料夾，那麼你可以跳過“hexo init blog”</li></ul><h2 id="useful-commands">Useful commands</h2><ul><li>清理 hexo ,类似于清理编译结果，例如 执行命令 <strong>hexo clean</strong></li><li>生成静态页面, 执行命令 <strong>hexo g</strong></li><li>启动服务，执行命令 <strong>hexo s</strong> ,默认在 4000 端口启动，访问本地4000端口即可查看本地网站</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh">hexo new <span class="hljs-string">&#x27;post name&#x27;</span><br>hexo clean<br>hexo generate    <span class="hljs-comment"># hexo g</span><br>hexo server      <span class="hljs-comment"># hexo s</span><br>hexo deploy      <span class="hljs-comment"># hexo d</span><br></code></pre></td></tr></table></figure><h2 id="theme-fluid">Theme: Fluid</h2><p>一款 Material Design 风格的主题</p><p><a href="https://github.com/fluid-dev/hexo-theme-fluid">An elegant Material-Design theme for Hexo</a></p><h3 id="step-1">Step 1</h3><p>下载 <a href="https://github.com/fluid-dev/hexo-theme-fluid/releases">最新 release 版本</a> 解压到 themes 目录，并将解压出的文件夹重命名为 fluid。</p><h3 id="step-2">Step 2</h3><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs txt">如下修改 Hexo 博客目录中的 **_config.yml**：<br><br>theme: fluid  # 指定主题<br><br>language: zh-CN  # 指定语言，会影响主题显示的语言，按需修改<br></code></pre></td></tr></table></figure><h3 id="step-3">Step 3</h3><p>首次使用主题的「关于页」需要手动创建：</p><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs actionscript">hexo <span class="hljs-keyword">new</span> page about<br></code></pre></td></tr></table></figure><p>创建成功后，编辑博客目录下 /source/about/index.md，添加 layout 属性。</p><p>修改后的文件示例如下：</p><figure class="highlight md"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs md">---<br>title: about<br><span class="hljs-section">layout: about</span><br><span class="hljs-section">---</span><br><br>这里写关于页的正文，支持 Markdown, HTML<br></code></pre></td></tr></table></figure><h2 id="filename">Filename</h2><p><a href="https://hexo.io/docs/writing" class="uri">https://hexo.io/docs/writing</a></p><p>By default, Hexo uses the post title as its filename. You can edit the new_post_name setting in _config.yml to change the default filename. For example, <strong>:year-:month-:day-:title.md</strong> will prefix filenames with the post creation date. You can use the following placeholders:</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-comment"># Writing</span><br><span class="hljs-comment">## new_post_name: :title.md # File name of new posts</span><br><span class="hljs-attr">new_post_name:</span> <span class="hljs-string">:year-:month-:day-:title.md</span><br></code></pre></td></tr></table></figure><p>in **_config.yml** under themes/fluid.</p><h2 id="math">math</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ micromamba install conda-forge::pandoc<br>$ npm uninstall hexo-renderer-marked --save<br>$ npm install hexo-renderer-pandoc --save<br></code></pre></td></tr></table></figure><p>and, <figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">math:</span><br>  <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">specific:</span> <span class="hljs-literal">false</span><br>  <span class="hljs-attr">engine:</span> <span class="hljs-string">mathjax</span><br></code></pre></td></tr></table></figure></p><h2 id="mermaid">mermaid</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ npm install hexo-filter-mermaid-diagrams<br></code></pre></td></tr></table></figure><h1 id="deploy-to-github">Deploy to github</h1><p>设置部署类型和 github 仓库位置和主分支，到网站配置文件 _config.yml 中修改如下：</p><p>表示部署类型为 git；</p><p>仓库为 git@github.com:username/github.io.git ，替换成你的仓库即可；</p><p>分支为 master 主分支；</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs text">deploy:<br>  type: git<br>  repo: git@github.com:waipangsze/waipangsze.github.io.git<br>  branch: main<br></code></pre></td></tr></table></figure><p>安装 git 扩展模块 hexo-deployer-git，到 blog 目录中执行命令：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ npm install hexo-deployer-git --save<br></code></pre></td></tr></table></figure><p>执行命令</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ hexo d <br></code></pre></td></tr></table></figure><p>部署到上面创建的 github 仓库中。</p><p>这一步就是向 github 仓库的master 分支提交文件，所以本地要有权限向你的 github 仓库提交。需要 <strong>sshkey</strong>,至于怎么添加 sshkey，如果不清楚，查一下就知道了。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">To github.com:waipangsze/waipangsze.github.io.git<br> + 4aa63c5...24ec1e5 HEAD -&gt; main (forced update)<br>Branch <span class="hljs-string">&#x27;master&#x27;</span> <span class="hljs-built_in">set</span> up to track remote branch <span class="hljs-string">&#x27;main&#x27;</span> from <span class="hljs-string">&#x27;git@github.com:waipangsze/waipangsze.github.io.git&#x27;</span>.<br>INFO  Deploy <span class="hljs-keyword">done</span>: git<br></code></pre></td></tr></table></figure><h1 id="hexo-blog-多設備同步">hexo blog 多設備同步</h1><p>From <a href="https://xuexuan.site/2021/02/04/hexo%E5%8D%9A%E5%AE%A2%E5%A4%9A%E8%AE%BE%E5%A4%87%E5%90%8C%E6%AD%A5/">hexo博客多设备同步</a></p><div class="note note-primary">            <p>github上的repo创建了两个分支，master保存静态页面，hexo用于保存网站的全部文件。</p>          </div><ul><li>将旧环境中的文件上传到github的hexo分支：</li><li>github上切换到hexo分支，git clone仓库到本地。</li><li>此时本地会多出一个username.github.io文件夹，命令行cd进去，删除除.git文件夹（如果你看不到这个文件夹，说明是隐藏了。windows下需要右击文件夹内空白处，点选’显示/隐藏 异常文件’，Mac下我就不知道了）外的其他文件夹。</li><li>命令行git add -A把工作区的变化（包括已删除的文件）提交到暂存区（ps:git add .提交的变化不包括已删除的文件）。</li><li>命令行git commint -m "some description"提交。</li><li>命令行git push origin hexo推送到远程hexo分支。此时刷下github，如果正常操作，hexo分支应该已经被清空了。</li><li>复制本地username.github.io文件夹中的.git文件夹到hexo项目根目录下。此时，hexo项目已经变成了和远程hexo分支关联的本地仓库了。而username.github.io文件夹的使命到此为止，你可以把它删掉，因为我们只是把它作为一个“中转站”的角色。以后每次发布新文章或修改网站样式文件时，git add . &amp; git commit -m "some description" &amp; git push origin hexo即可把环境文件推送到hexo分支。然后再hexo g -d发布网站并推送静态文件到master分支。</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sh">git <span class="hljs-built_in">clone</span> git@github.com:waipangsze/waipangsze.github.io.git<br>waipangsze.github.io/<br>git switch hexo <br>git <span class="hljs-built_in">log</span> <br><span class="hljs-built_in">cp</span> -r .git ../../blog/ <span class="hljs-comment"># delete all files except .git</span><br><span class="hljs-built_in">cd</span> ../../blog/<br><span class="hljs-built_in">cat</span> .gitignore <br>git status<br>git add .<br>git commit -a <span class="hljs-comment"># git commit -m &quot;xxxx&quot;</span><br>git push origin hexo<br></code></pre></td></tr></table></figure><p>新环境</p><p>这部分应该要简单一点，如果你已经搭建过一个hexo博客的话。</p><ul><li>新电脑上安装node.js和git。</li><li>安装hexo：npm install -g hexo-cli。</li><li>clone远程仓库到本地 git clone git@github.com:username/username.github.io.git。</li><li>根据packge.json安装依赖npm install。</li><li>本地生成网站并开启博客服务器：hexo g &amp; hexo s。如果一切正常，此时打开浏览器输入<a href="http://localhost:4000/" class="uri">http://localhost:4000/</a> 已经可以看到博客正常运行了。</li></ul><p>在两台电脑上的同步操作</p><p>至此，迁移工作已完成，在两台电脑之间的同步操作如下：</p><ul><li>git pull从远程hexo分支拉取最新的环境文件到本地，可以理解为svn的更新操作。比如在公司写了博客，回家在电脑上也要写需要先执行这一步操作。</li><li>文章写完，要发布时，需要先提交环境文件，再发布文章。按以下顺序执行命令：git add .、git commit -m "some descrption"、git push origin hexo、hexo g -d。</li></ul><h1 id="upload-to-github">Upload to github</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh">git pull --rebase <span class="hljs-comment"># do this at the beginning</span><br>git status<br>git add . <span class="hljs-comment"># add all files</span><br>git commit --amend<br><span class="hljs-comment"># git push (-f)</span><br>git push -u origin hexo<br></code></pre></td></tr></table></figure><h1 id="相關連結-icon">相關連結 icon</h1><p>官方的 icon 圖示，均引用自目前做網站最多人使用的免費 icon 圖庫 <a href="https://fontawesome.com/">Font Awesome</a>，Font Awesome 是一個基於CSS和LESS的字體和圖示工具套件。它由Dave Gandy製作，用於Twitter Bootstrap，後來被整合到BootstrapCDN 中。Font Awesome在使用第三方Font Scripts的網站中佔有20％的市場份額，排在Google字體之後的第二位。</p><h1 id="多张图片按一定布局组合显示">多张图片按一定布局组合显示</h1><div class="group-image-container"><div class="group-image-row"><div class="group-image-wrap"><img src="https://i.imgur.com/RwpxULg.png" alt="1" /></div><div class="group-image-wrap"><img src="https://i.imgur.com/RwpxULg.png" alt="2" /></div><div class="group-image-wrap"><img src="https://i.imgur.com/RwpxULg.png" alt="3" /></div></div><div class="group-image-row"><div class="group-image-wrap"><img src="https://i.imgur.com/RwpxULg.png" alt="4" /></div><div class="group-image-wrap"><img src="https://i.imgur.com/RwpxULg.png" alt="5" /></div></div></div><h1 id="展示pdf">展示PDF</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">npm install --save hexo-pdf<br></code></pre></td></tr></table></figure><p>and</p><figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs django"><span class="hljs-template-tag">&#123;% <span class="hljs-name">pdf</span> ../pdf/xxx.pdf %&#125;</span><br></code></pre></td></tr></table></figure><h1 id="統計網站的造訪地區和ip">統計網站的造訪地區和IP</h1><ol type="1"><li><a href="http://www.waylon.one/website/statistics-visitor-traffic/">通过 clustermaps 统计 Hexo 网站的访问地区和 IP</a></li></ol><p><a href="https://clustrmaps.com/">clustrmaps.com</a> 是美國的資料網站。</p><p>網址提供了產生訪客地址分佈圖的程式碼，可以嵌入到網站或部落格中，來顯示來自世界各地訪客的即時地圖，有助於發展您隱藏的興趣社群。最重要的是，這個功能是免費的，能夠滿足個人網站的需求。</p><ul><li>配置 clustrmaps<ul><li>網站註冊後，請造訪 Enter your website address 新增自己的網站地址，選擇免費的服務。</li><li>選擇自己喜歡的外掛格式，現在 Hexo 的 Next 兩個主題都是支援的，比較喜歡 Map widget 的主題。</li><li>點選選擇後，拷貝網站出現的腳本 javascript 程式碼，貼到主題下某個位置。</li><li>我把它放在 about.ejs or index.md 的最後。<ul><li><script type="text/javascript" id="clustrmaps" src="//clustrmaps.com/map_v2.js?d=-FD52b9oydXY9a4RbTCAxGTeHgh-1YTFnwSX0jxQlA0&cl=ffffff&w=a"></script></li></ul></li><li>重新部署網站，您就可以在首頁看到即時訪客來源圖，如我的網站首頁所示。另外，點擊地圖，可以看到更詳細的信息，包括訪客的地圖、瀏覽設備以及 IP。</li></ul></li></ul><h1 id="導入影片">導入影片</h1><p>The easiest way to get the correct link is to right-click on the YouTube video and select copy embed code.</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">iframe</span> <span class="hljs-attr">width</span>=<span class="hljs-string">&quot;560&quot;</span> <span class="hljs-attr">height</span>=<span class="hljs-string">&quot;315&quot;</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;xxx&quot;</span> <span class="hljs-attr">......</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">iframe</span>&gt;</span><br></code></pre></td></tr></table></figure><iframe width="560" height="315" src="https://www.youtube.com/embed/XGPLHwARPSY?si=yd2MGyNa0GhkBkCs" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe><h1 id="支持二级菜单下拉菜单">支持二级菜单（下拉菜单）</h1><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-comment"># 导航栏菜单，可自行增减，key 用来关联 languages/*.yml，如不存在关联则显示 key 本身的值；icon 是 css class，可以省略；增加 name 可以强制显示指定名称</span><br><span class="hljs-comment"># Navigation bar menu. `key` is used to associate languages/*.yml. If there is no association, the value of `key` itself will be displayed; if `icon` is a css class, it can be omitted; adding `name` can force the display of the specified name</span><br><span class="hljs-attr">menu:</span><br>  <span class="hljs-bullet">-</span> &#123; <span class="hljs-attr">key:</span> <span class="hljs-string">&quot;home&quot;</span>, <span class="hljs-attr">link:</span> <span class="hljs-string">&quot;/&quot;</span>, <span class="hljs-attr">icon:</span> <span class="hljs-string">&quot;iconfont icon-home-fill&quot;</span> &#125;<br>  <span class="hljs-bullet">-</span> &#123; <span class="hljs-attr">key:</span> <span class="hljs-string">&quot;archive&quot;</span>, <span class="hljs-attr">link:</span> <span class="hljs-string">&quot;/archives/&quot;</span>, <span class="hljs-attr">icon:</span> <span class="hljs-string">&quot;iconfont icon-archive-fill&quot;</span> &#125;<br>  <span class="hljs-bullet">-</span> &#123; <span class="hljs-attr">key:</span> <span class="hljs-string">&quot;category&quot;</span>, <span class="hljs-attr">link:</span> <span class="hljs-string">&quot;/categories/&quot;</span>, <span class="hljs-attr">icon:</span> <span class="hljs-string">&quot;iconfont icon-category-fill&quot;</span> &#125;<br>  <span class="hljs-bullet">-</span> &#123; <span class="hljs-attr">key:</span> <span class="hljs-string">&quot;tag&quot;</span>, <span class="hljs-attr">link:</span> <span class="hljs-string">&quot;/tags/&quot;</span>, <span class="hljs-attr">icon:</span> <span class="hljs-string">&quot;iconfont icon-tags-fill&quot;</span> &#125;<br>  <span class="hljs-bullet">-</span> &#123; <span class="hljs-attr">key:</span> <span class="hljs-string">&quot;links&quot;</span>, <span class="hljs-attr">link:</span> <span class="hljs-string">&quot;/links/&quot;</span>, <span class="hljs-attr">icon:</span> <span class="hljs-string">&quot;iconfont icon-link-fill&quot;</span> &#125;<br>  <span class="hljs-bullet">-</span> &#123; <span class="hljs-attr">key:</span> <span class="hljs-string">&quot;Bookmarks&quot;</span>, <span class="hljs-attr">link:</span> <span class="hljs-string">&quot;/bookmark/&quot;</span>, <span class="hljs-attr">icon:</span> <span class="hljs-string">&quot;iconfont icon-bookmark&quot;</span>&#125;<br>  <span class="hljs-bullet">-</span> &#123; <span class="hljs-attr">key:</span> <span class="hljs-string">&quot;about&quot;</span>, <span class="hljs-attr">link:</span> <span class="hljs-string">&quot;/about/&quot;</span>, <span class="hljs-attr">icon:</span> <span class="hljs-string">&quot;iconfont icon-user-fill&quot;</span>, <span class="hljs-attr">name:</span> <span class="hljs-string">&#x27;About Me&#x27;</span>&#125;<br>  <span class="hljs-bullet">-</span> &#123;<br>  <span class="hljs-attr">key:</span> <span class="hljs-string">&#x27;Docs&#x27;</span>,<br>  <span class="hljs-attr">icon:</span> <span class="hljs-string">&#x27;iconfont icon-books&#x27;</span>,<br>  <span class="hljs-attr">submenu:</span> [<br>    <span class="hljs-comment">#&#123; key: &#x27;Physics&#x27;, link: &#x27;/archives/&#x27; &#125;,</span><br>    <span class="hljs-comment">#&#123; key: &#x27;Mathematics&#x27;, link: &#x27;/tags/&#x27; &#125;,</span><br>    &#123; <span class="hljs-attr">key:</span> <span class="hljs-string">&#x27;Meteorology&#x27;</span>, <span class="hljs-attr">link:</span> <span class="hljs-string">&#x27;/categories/Meteorology/&#x27;</span>, <span class="hljs-attr">icon:</span> <span class="hljs-string">&quot;iconfont icon-plan&quot;</span> &#125;<br>  ]<br>  &#125;<br></code></pre></td></tr></table></figure><p>這裡我們使用/categories/Meteorology/中的鏈接，但它只是標題，沒有<strong>封面圖片</strong>。如何顯示<strong>封面圖片</strong>？</p><h2 id="on-category.ejs">On category.ejs</h2><p>這裡我們使用/categories/Meteorology/中的鏈接，但它只是標題，沒有<strong>封面圖片</strong>。如何顯示<strong>封面圖片</strong>？</p><p>它調用了程式碼,</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;%- <span class="hljs-title function_">partial</span>(<span class="hljs-string">&#x27;_partials/archive-list.ejs&#x27;</span>, &#123; <span class="hljs-attr">params</span>: &#123; <span class="hljs-attr">key</span>: page.<span class="hljs-property">layout</span>, <span class="hljs-attr">postTotal</span>: cat ? cat.<span class="hljs-property">posts</span>.<span class="hljs-property">length</span> : <span class="hljs-number">0</span> &#125; &#125;) %&gt;<br></code></pre></td></tr></table></figure><p>建立一個 my-list.ejs 並使用它的程式碼，</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;%- <span class="hljs-title function_">partial</span>(<span class="hljs-string">&#x27;_partials/my-list.ejs&#x27;</span>, &#123; <span class="hljs-attr">params</span>: &#123; <span class="hljs-attr">key</span>: page.<span class="hljs-property">layout</span>, <span class="hljs-attr">postTotal</span>: cat ? cat.<span class="hljs-property">posts</span>.<span class="hljs-property">length</span> : <span class="hljs-number">0</span> &#125; &#125;) %&gt;<br></code></pre></td></tr></table></figure><p>my-list.ejs 是什麼？ （複製自index.ejs，其中一部分）</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;div <span class="hljs-keyword">class</span>=<span class="hljs-string">&quot;list-group&quot;</span>&gt;<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;h4&quot;</span>&gt;</span>&lt;%= __(params.key + &#x27;.post_total&#x27;, params.postTotal) %&gt;<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br>  &lt;hr&gt;<br>  &lt;% <span class="hljs-keyword">var</span> dateCursor %&gt;<br>  &lt;% page.<span class="hljs-property">posts</span>.<span class="hljs-title function_">each</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">post</span>) &#123; %&gt;<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;row mx-auto index-card&quot;</span>&gt;</span></span><br><span class="language-xml">      &lt;% var post_url = url_for(post.path), index_img = post.index_img || theme.post.default_index_img %&gt;</span><br><span class="language-xml">      &lt;% if (index_img) &#123; %&gt;</span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;col-12 col-md-4 m-auto index-img&quot;</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;&lt;%= post_url %&gt;&quot;</span> <span class="hljs-attr">target</span>=<span class="hljs-string">&quot;&lt;%- theme.index.post_url_target %&gt;&quot;</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;&lt;%= url_for(index_img) %&gt;&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;&lt;%= post.title %&gt;&quot;</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">      &lt;% &#125; %&gt;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">article</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;col-12 col-md-&lt;%= index_img ? &#x27;8&#x27; : &#x27;12&#x27; %&gt; mx-auto index-info&quot;</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;index-header&quot;</span>&gt;</span></span><br><span class="language-xml">          &lt;% if (theme.index.post_sticky &amp;&amp; theme.index.post_sticky.enable &amp;&amp; post.sticky &gt; 0) &#123; %&gt;</span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;index-pin &lt;%= theme.index.post_sticky &amp;&amp; theme.index.post_sticky.icon %&gt;&quot;</span> <span class="hljs-attr">title</span>=<span class="hljs-string">&quot;Pin on top&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span></span><br><span class="language-xml">          &lt;% &#125; %&gt;</span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;&lt;%= post_url %&gt;&quot;</span> <span class="hljs-attr">target</span>=<span class="hljs-string">&quot;&lt;%- theme.index.post_url_target %&gt;&quot;</span>&gt;</span></span><br><span class="language-xml">            &lt;%= post.title %&gt;</span><br><span class="language-xml">          <span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span></span><br><span class="language-xml">  </span><br><span class="language-xml">        &lt;% var excerpt = post.description || post.excerpt || (theme.index.auto_excerpt.enable &amp;&amp; !post.encrypt &amp;&amp; post.content) %&gt;</span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;index-excerpt &lt;%= index_img ? &#x27;&#x27; : &#x27;index-excerpt__noimg&#x27; %&gt;&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;&lt;%= post_url %&gt;&quot;</span> <span class="hljs-attr">target</span>=<span class="hljs-string">&quot;&lt;%- theme.index.post_url_target %&gt;&quot;</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">            &lt;%- strip_html(excerpt).substring(0, 200).trim().replace(/\n/g, &#x27; &#x27;) %&gt;</span><br><span class="language-xml">          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span><br><span class="language-xml">  </span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;index-btm post-metas&quot;</span>&gt;</span></span><br><span class="language-xml">          &lt;% if (theme.index.post_meta.date) &#123; %&gt;</span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;post-meta mr-3&quot;</span>&gt;</span></span><br><span class="language-xml">              <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;iconfont icon-date&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span></span><br><span class="language-xml">              <span class="hljs-tag">&lt;<span class="hljs-name">time</span> <span class="hljs-attr">datetime</span>=<span class="hljs-string">&quot;&lt;%= full_date(post.date, &#x27;YYYY-MM-DD HH:mm&#x27;) %&gt;&quot;</span> <span class="hljs-attr">pubdate</span>&gt;</span></span><br><span class="language-xml">                &lt;%- date(post.date, config.date_format) %&gt;</span><br><span class="language-xml">              <span class="hljs-tag">&lt;/<span class="hljs-name">time</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">          &lt;% &#125; %&gt;</span><br><span class="language-xml">          &lt;% if (theme.index.post_meta.category &amp;&amp; post.categories.length &gt; 0) &#123; %&gt;</span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;post-meta mr-3 d-flex align-items-center&quot;</span>&gt;</span></span><br><span class="language-xml">              <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;iconfont icon-category&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span></span><br><span class="language-xml">              &lt;%- partial(&#x27;_partials/category-chains&#x27;, &#123; categories: post.categories, limit: 1 &#125;) %&gt;</span><br><span class="language-xml">            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">          &lt;% &#125; %&gt;</span><br><span class="language-xml">          &lt;% if (theme.index.post_meta.tag &amp;&amp; post.tags.length &gt; 0) &#123; %&gt;</span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;post-meta&quot;</span>&gt;</span></span><br><span class="language-xml">              <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;iconfont icon-tags&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span></span><br><span class="language-xml">              &lt;% post.tags.each(function(tag)&#123; %&gt;</span><br><span class="language-xml">                <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;&lt;%= url_for(tag.path) %&gt;&quot;</span>&gt;</span>#&lt;%- tag.name %&gt;<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span><br><span class="language-xml">              &lt;% &#125;) %&gt;</span><br><span class="language-xml">            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">          &lt;% &#125; %&gt;</span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">article</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">  &lt;% &#125;) %&gt;</span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><br>&lt;%- <span class="hljs-title function_">partial</span>(<span class="hljs-string">&#x27;_partials/paginator&#x27;</span>) %&gt;<br></code></pre></td></tr></table></figure><h1 id="範例網站">範例網站</h1><ol type="1"><li><a href="https://zkqiang.cn/">zkqiang's blog</a></li><li><a href="https://fantasyhh.github.io/archives/page/5/#board">秉烛夜读</a><ol type="1"><li><a href="https://github.com/fantasyhh/fantasyhh.github.io" class="uri">https://github.com/fantasyhh/fantasyhh.github.io</a></li></ol></li><li><a href="https://s81679.github.io/2020/02/25/hexo-theme-fluid/">來點鳥 blog</a></li><li><a href="https://www.eatrice.cn/post/%E4%BB%8E0%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AAhexo%E5%8D%9A%E5%AE%A2/">吃白饭的休伯利安号</a></li><li><a href="https://yuzhang.pages.dev/about/">Yu's Space</a></li><li><a href="https://blog.justlovesmile.top/about/">Justlovesmile</a></li><li><a href="https://zsyyblog.com/about/">zsyyblog.com</a></li><li><a href="https://yangyy.top/about/">Yangyy's Life</a></li><li><a href="https://blognas.hwb0307.com/me">Bensz’s blog</a></li><li><a href="https://neutrino7.top/about/#comment">七号中微子</a></li><li><a href="https://blog.zsd.name/posts/63716.html#%E8%87%AA%E5%AE%9A%E5%88%B6%E4%BF%AE%E6%94%B9">张赛东</a></li><li><a href="https://www.yousazoe.top/archives/e5b4d2d6.html">Fl0w3r | Hexo-Fluid 博客建站記錄</a></li><li><a href="https://www.tabirstrees.top/about/">南科大地空系空间物理研究生</a></li></ol><h1 id="references">References:</h1><ol type="1"><li><a href="https://fluid-dev.github.io/hexo-fluid-docs/en/guide/">Hexo Fluid Docs</a></li><li><a href="https://linyencheng.github.io/2022/09/14/relationships-between-frontend-and-backend/tool-hexo-blog/">用 Hexo 和 Github Pages 建立部落格吧</a></li><li><a href="https://mp.weixin.qq.com/s/Iy-ZXHHHRwHBCwozF5wtyg">用 GitHub + Hexo 免费搭建博客，保姆级教程</a></li><li><a href="https://wangxiaoyu-go.github.io/2018/11/23/hexo-filter-mermaid-diagrams/">Hexo中插入mermaid diagrams</a></li><li><a href="https://xuexuan.site/2021/02/04/hexo%E5%8D%9A%E5%AE%A2%E5%A4%9A%E8%AE%BE%E5%A4%87%E5%90%8C%E6%AD%A5/">hexo博客多设备同步</a></li><li><a href="https://blog.csdn.net/qq_30105599/article/details/118302086">多台电脑同步更新Hexo博客</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>github</category>
      
    </categories>
    
    
    <tags>
      
      <tag>github.io</tag>
      
      <tag>blog</tag>
      
      <tag>Hexo</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>DA-Meteorological Data Encoding(氣象數據編碼)</title>
    <link href="/2024/08/20/DA-obs-introduction/"/>
    <url>/2024/08/20/DA-obs-introduction/</url>
    
    <content type="html"><![CDATA[<h1 id="meteorological-data-encoding">Meteorological Data Encoding</h1><p>氣象數據編碼</p><ul><li><a href="https://www.hko.gov.hk/tc/education/weather/data-and-technology/00479-abc-of-meteorological-data-encoding.html">HKO 淺談氣象數據編碼 (2015)</a></li><li><a href="https://web.archive.org/web/20180215023559/https://www.eumetsat.int/website/wcm/idc/idcplg?IdcService=GET_FILE&amp;dDocName=PDF_CONF_P57_S5_01_KARHILA_V&amp;RevisionSelectionMethod=LatestReleased&amp;Rendition=Web">BUFR: A METEOROLOGICAL CODE FOR THE 21ST CENTURY (2010)</a></li><li><a href="https://photino.cwb.gov.tw/rdcweb/lib/cd/cd01conf/dissertation/2014WAF/A1/A1-23.pdf">中央氣象局新格式氣象觀測資料作業系統介紹 (2014)</a></li><li><a href="https://community.wmo.int/en/activity-areas/operational-information-service/migration-tac-tdcf">Migration TAC to TDCF</a></li></ul><p>Currently, most meteorological observations are being produced and transmitted in special formats known as</p><ul><li>Traditional Alphanumeric Codes (TAC) 傳統字符代碼</li><li>Table-Driven Code Forms (TDCF) 表格驅動代碼</li></ul><p>as promulgated by WMO. Both TAC and TDCF are ways of representing meteorological data intended for international exchange in real-time.</p><h2 id="bufr">BUFR</h2><ul><li>Binary Universal Form for the Representation of meteorological data</li><li>二進制通用數據表示格式</li></ul><p>BURF is TDCF.</p><p>The latest version is BUFR Edition 4. BUFR Edition 3 is also considered current for operational use. BUFR was created in 1988 with the goal of replacing the WMO's dozens of character-based, position-driven meteorological codes, such as <strong>SYNOP (surface observations)</strong>, <strong>TEMP (upper air soundings)</strong> and <strong>CLIMAT (monthly climatological data)</strong>. BUFR was designed to be portable, compact, and universal. Any kind of data can be represented, along with its specific spatial/temporal context and any other associated metadata. In the WMO terminology, BUFR belongs to the category of table-driven code forms, where the meaning of data elements is determined by referring to a set of tables that are kept and maintained separately from the message itself.</p><h1 id="little_r">LITTLE_R</h1><p><a href="https://www2.mmm.ucar.edu/wrf/users/wrfda/OnlineTutorial/Help/littler.html">What is LITTLE_R?</a></p><p>LITTLE_R is an ASCII-based observation file format, <strong>in use since the MM5 era</strong>. Because raw observation data files have many possible formats (such as ASCII, BUFR, PREPBUFR, MADIS, and HDF) LITTLE_R is designed to be an intermediate format so that <strong>WRFDA might be able to assimilate as many observation types as possible in a universal manner</strong>. It is a report-based file format, so all manner of observation types can easily be "cat-ted" together into an easy-to-read and -edit text file.</p><p><strong>It is the user's responsibility to develop an interface to convert their own observations to LITTLE_R format so they may be read by OBSPROC</strong>. We (UCAR) do not support any existing tools which do this. However, on this help page, we hope to describe the format as thoroughly as possible to aid the user in the conversion process.</p>]]></content>
    
    
    <categories>
      
      <category>DA</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NWP</tag>
      
      <tag>WRF</tag>
      
      <tag>MPAS</tag>
      
      <tag>DA</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ERA5 CDS upgrade (2024 Sep)</title>
    <link href="/2024/08/16/ERA5-2024-upgrade/"/>
    <url>/2024/08/16/ERA5-2024-upgrade/</url>
    
    <content type="html"><![CDATA[<h1 id="climate-data-store-cds">Climate Data Store (CDS)</h1><p>Some time ago, an upgrade notice was officially released on the Copernicus Climate Change Service (C3S) website. <strong>The old interface was closed in September 2024</strong>. Currently, the download of ERA5 data is gradually upgraded from the old CDS interface system to the new CDS-Beta.</p><p><a href="https://cds-beta.climate.copernicus.eu/">Climate Data Store</a></p><p>The Copernicus Climate Change Service (C3S) supports society by providing authoritative information about the past, present and future climate in Europe and the rest of the World.</p><ul><li><strong>15 May 2024</strong> BETA version of the new <a href="https://ewds-beta.climate.copernicus.eu/">CEMS Early Warning Data Store (EWDS)</a>. Your feedback is very useful for us. Please notice that access to the system might suffer some disruptions due to evolving updates.</li><li><strong>16 Jun 2024</strong> Check our <a href="https://confluence.ecmwf.int/x/uINmFw">informative page</a> to best prepare yourself to use CDS-Beta.</li><li><strong>16 Jun 2024</strong> CDS API syntax is changed and some keys or parameter names may have also changed. To avoid requests failing, please use the "Show API request code" tool on the dataset Download Form to check you are using the correct syntax for your API request.</li><li><strong>16 Jun 2024</strong> BETA version of the new CDS. Your feedback is very useful for us. Please notice that access to the system might suffer some disruptions due to evolving updates.</li><li><strong>18 Jul 2024</strong> Remember that you need to have an ECMWF account to use CDS-Beta. Your existing CDS credentials will not work in CDS-Beta!</li></ul><h2 id="registration-ecmwf-account">Registration ECMWF account</h2><p>registration address: https://www.ecmwf.int/ There is a <strong>Log in</strong> button in the upper right corner of the page, click on it directly!</p><h2 id="cds-beta-account-information-supplement-and-terms-upgrade">CDS-beta account information supplement and terms upgrade</h2><p>After successfully registering an ECMWF account, enter the page https://cds-beta.climate.copernicus.eu/</p><p>We need to go to the upgraded CDS page to complete the information, including: - country, - affiliation, - thematic activities, - activities sectors, and</p><p>Then, <strong>three Accet Terms &amp; Conditions</strong>. It’s all relatively simple! Finally, click Activate your profile to complete. Automatically return to the CDS-beta data customization home page.</p><h2 id="upgrade-cdsapi-library-and-.cdsapirc-key">Upgrade cdsapi library and .cdsapirc key</h2><p><strong>Note:</strong> We need to ensure that we have logged in to the CDS-beta account in advance!</p><p>Goto https://cds-beta.climate.copernicus.eu/how-to-api</p><h2 id="setup-the-cds-api-personal-access-token">Setup the CDS API personal access token</h2><p>Here is how to setup the CDS API personal access token:</p><p>If you do not have an account yet, please register. If you are not logged in, please login. Once logged in, copy the code displayed below to the file - <strong>$HOME/.cdsapirc</strong> (in your Unix/Linux environment):</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">url: https://cds-beta.climate.copernicus.eu/api<br>key: xxxxxx-xxxxx-xxxxx-xxxx-xxxx<br></code></pre></td></tr></table></figure><h2 id="install-the-cds-api-client">Install the CDS API client</h2><p>The CDS API client is a Python based library. It provides support for Python 3.</p><p>You can Install the CDS API client via the package management system pip, by running on Unix/Linux the command below.</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ conda install <span class="hljs-string">&#x27;cdsapi&gt;=0.7.0&#x27;</span><br></code></pre></td></tr></table></figure><p>and, (typing-extensions 4.9.0)</p><p>Version 0.7.0 or higher is required in order to be able to use the new data stores.</p><h2 id="use-the-cds-api-client-for-data-access">Use the CDS API client for data access</h2><p>Once the CDS API client is installed, it can be used to request data from the datasets listed in the CDS, ADS, ECDS and CEMS Early Warning DS catalogues.</p><p>One must agree to the Terms of Use of a dataset before downloading any data out of it. This step must be done manually from the dataset page (at the bottom of the download form).</p><p>At the bottom of each dataset download form, press the "Show API request code" button to display a Python code snippet that can be used to run the manually built request. The API call must have this syntax:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> cdsapi<br><br>client = cdsapi.Client()<br><br>dataset = <span class="hljs-string">&quot;&lt;DATASET-SHORT-NAME&gt;&quot;</span><br>request = &#123;<br>    &lt;SELECTION-REQUEST&gt;<br>&#125;<br>target = <span class="hljs-string">&quot;&lt;TARGET-FILE&gt;&quot;</span><br><br>client.retrieve(dataset, request, target)<br></code></pre></td></tr></table></figure><p>Example:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> cdsapi<br><br>client = cdsapi.Client()<br><br>dataset = <span class="hljs-string">&#x27;reanalysis-era5-pressure-levels&#x27;</span><br>request = &#123;<br>    <span class="hljs-string">&#x27;product_type&#x27;</span>: [<span class="hljs-string">&#x27;reanalysis&#x27;</span>],<br>    <span class="hljs-string">&#x27;variable&#x27;</span>: [<span class="hljs-string">&#x27;geopotential&#x27;</span>],<br>    <span class="hljs-string">&#x27;year&#x27;</span>: [<span class="hljs-string">&#x27;2024&#x27;</span>],<br>    <span class="hljs-string">&#x27;month&#x27;</span>: [<span class="hljs-string">&#x27;03&#x27;</span>],<br>    <span class="hljs-string">&#x27;day&#x27;</span>: [<span class="hljs-string">&#x27;01&#x27;</span>],<br>    <span class="hljs-string">&#x27;time&#x27;</span>: [<span class="hljs-string">&#x27;13:00&#x27;</span>],<br>    <span class="hljs-string">&#x27;pressure_level&#x27;</span>: [<span class="hljs-string">&#x27;1000&#x27;</span>],<br>    <span class="hljs-string">&#x27;data_format&#x27;</span>: <span class="hljs-string">&#x27;grib&#x27;</span>,<br>&#125;<br>target = <span class="hljs-string">&#x27;download.grib&#x27;</span><br><br>client.retrieve(dataset, request, target)<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>NWP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>WRF</tag>
      
      <tag>WPS</tag>
      
      <tag>MPAS</tag>
      
      <tag>IC/BC</tag>
      
      <tag>ERA5</tag>
      
      <tag>ECMWF</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>GFS/FNL/RDA upgrade (2024)</title>
    <link href="/2024/08/16/GFS_FNL_RDA_upgrade/"/>
    <url>/2024/08/16/GFS_FNL_RDA_upgrade/</url>
    
    <content type="html"><![CDATA[<h1 id="rda-team">RDA team</h1><p>RDA - Research Data Archive</p><h2 id="rda-data-services-unavailable-july-30-2024">RDA Data Services Unavailable July 30, 2024</h2><ul><li>July 26, 2024 Posted by: RDA Team</li></ul><p>Update on July 31, 2024: standard data file download, THREDDS access, and Globus transfer services have been restored. We continue to resolve issues with data search and subsetting services. Thank you for your patience during this maintenance period.</p><p>Due to scheduled updates on the NSF NCAR Research Data Archive, all RDA data access services, including downloads, data subsetting, and THREDDS data server access, will be unavailable July 30, 2024 beginning at 9:00 AM MDT. We anticipate services to be restored near the end of the day July 30. Please follow our Twitter profile (<span class="citation" data-cites="NCAR_RDA">@NCAR_RDA</span>) for updates.</p><p>The primary purpose of the downtime is to update the dataset numbering system for data collections archived in the RDA. After the update, <strong>all RDA datasets will be identified by a dataset number in the format 'dnnnnnn', where 'nnnnnn' is the serial number used to identify a dataset. Until now, dataset numbers have been in the format 'dnnn.n'. This format will be converted to the new format 'dnnn00n', in which the first three digits of the old format are placed in the first three positions of the new format, and the last digit of the old format will be placed in the last position of the new format. For example, the dataset ID 'ds094.1' will be converted to 'd094001', and the dataset ID 'ds351.0' will be converted to 'd351000'.</strong> Please contact us at rdahelp@ucar.edu if you have questions regarding this update.</p><h2 id="changes">Changes</h2><p>Goto <a href="https://waipangsze.github.io/2023/04/27/GFS_FNL/" class="uri">https://waipangsze.github.io/2023/04/27/GFS_FNL/</a></p><ul><li>old one: https://rda.ucar.edu/data/ds084.1/</li><li>new one: https://data.rda.ucar.edu/d084001/</li></ul>]]></content>
    
    
    <categories>
      
      <category>NWP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>WRF</tag>
      
      <tag>WPS</tag>
      
      <tag>MPAS</tag>
      
      <tag>IC/BC</tag>
      
      <tag>NCEP</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>WRF | WRF-DA Installation</title>
    <link href="/2024/08/16/wrf-DA_Installation/"/>
    <url>/2024/08/16/wrf-DA_Installation/</url>
    
    <content type="html"><![CDATA[<h1 id="preparation">Preparation</h1><p>Install all requried libraries of WRF.</p><p>Beginning with version 4.0, the basic WRF tar file now includes WRFDA, WRFPLUS, and WRF-Chem. Next to the WRFDA tar file link, there is a link to 'updates.' Take a look at that for additional information regarding this change. You can also find updated compiling instructions in the Users Guide: <a href="http://www2.mmm.ucar.edu/wrf/users/docs/user_guide_v4/v4.0/users_guide_chap6.html" class="uri">http://www2.mmm.ucar.edu/wrf/users/docs/user_guide_v4/v4.0/users_guide_chap6.html</a></p><h1 id="wrf-da">WRF-DA</h1><p><a href="https://www2.mmm.ucar.edu/wrf/users/wrfda/">WRF Data Assimilation System Users Page</a></p><p>The WRFDA system is in the public domain and is freely available for community use. It is designed to be a flexible, state-of-the-art atmospheric data assimilation system that is portable and efficient on available parallel computing platforms. WRFDA is suitable for use in a broad range of applications, across scales ranging from kilometers for regional and mesoscale modeling to thousands of kilometers for global scale modeling.</p><p>The Mesoscale and Microscale Meteorology (MMM) Laboratory of NCAR currently maintains and supports a subset of the overall WRF code (Version 4) that includes:</p><ul><li>WRF Software Framework (WSF)</li><li>Advanced Research WRF (ARW) dynamic solver, including one-way, two-way nesting and moving nests, grid and observation nudging</li><li>WRF Pre-Processing System (WPS)</li><li><strong>WRF Data Assimilation System (WRFDA)</strong></li><li>Numerous physics packages contributed by WRF partners and the research community</li></ul><h2 id="installation">Installation</h2><ul><li>wrf_env.sh</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/bash</span><br><br><span class="hljs-built_in">export</span> PATH=/home/wpsze/GNU_GCC/Library/gcc-v9.3.0/bin:<span class="hljs-variable">$PATH</span><br><span class="hljs-built_in">export</span> LD_LIBRARY_PATH=/home/wpsze/GNU_GCC/Library/gcc-v9.3.0/lib/<span class="hljs-variable">$&#123;LD_LIBRARY_PATH:+:$LD_LIBRARY_PATH&#125;</span><br><span class="hljs-built_in">export</span> LD_LIBRARY_PATH=/home/wpsze/GNU_GCC/Library/gcc-v9.3.0/lib64:<span class="hljs-variable">$LD_LIBRARY_PATH</span><br><br><span class="hljs-built_in">export</span> LD_LIBRARY_PATH=/home/wpsze/WRF/WRFv440/Library/lib:<span class="hljs-variable">$LD_LIBRARY_PATH</span><br><span class="hljs-built_in">export</span> LDFLAGS=-L/home/wpsze/WRF/WRFv440/Library/lib<br><span class="hljs-built_in">export</span> CPPFLAGS=-I/home/wpsze/WRF/WRFv440/Library/include<br><span class="hljs-built_in">export</span> NETCDF=/home/wpsze/WRF/WRFv440/Library/<br><span class="hljs-built_in">export</span> HDF5=/home/wpsze/WRF/WRFv440/Library/<br><span class="hljs-built_in">export</span> PATH=/home/wpsze/WRF/WRFv440/Library/bin:<span class="hljs-variable">$PATH</span><br><br>gcc --version<br>gfortran --version<br>mpirun --version<br><span class="hljs-built_in">which</span> mpif90 &amp; mpif90 --version<br><br>time mpif90 --version<br></code></pre></td></tr></table></figure><ul><li>wrf_da_install.sh</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/bash</span><br><span class="hljs-comment">############################## Directory Listing ############################</span><br><span class="hljs-built_in">export</span> HOME=`<span class="hljs-built_in">pwd</span>`<br><span class="hljs-built_in">export</span> download_DIR=<span class="hljs-variable">$HOME</span>/wrf_install/<br><span class="hljs-built_in">export</span> libs_DIR=<span class="hljs-variable">$HOME</span>/Library/<br><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$HOME</span><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$download_DIR</span><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$libs_DIR</span><br><br><span class="hljs-built_in">mkdir</span> -p wrf_install<br><span class="hljs-built_in">mkdir</span> -p Library<br><br><span class="hljs-comment">############################## WRF ############################</span><br><span class="hljs-built_in">source</span> /home/wpsze/WRF/WRFv440/wrf_env.sh<br><span class="hljs-comment">##################################################################</span><br><span class="hljs-comment"># Prior to version 4.0, WRFPlus code had been developed and maintained </span><br><span class="hljs-comment"># in a separated branch from WRF. From V4.0, it is now fully integrated </span><br><span class="hljs-comment"># into the same WRF branch. TLM/ADJ code is located in the &#x27;wrftladj&#x27; directory.</span><br><br><span class="hljs-comment"># Now WRF, WRFDA, and WRFPLUS are stored in the same package which you can get from GitHub. </span><br><span class="hljs-comment"># After downloading WRF package, decompress it three times, </span><br><span class="hljs-comment"># rename it to WRF, WRFDA, and WRFPLUS.</span><br><br><span class="hljs-built_in">cd</span> <span class="hljs-variable">$download_DIR</span><br><br><span class="hljs-built_in">rm</span> -rf WRFVDA4.5<br><br><span class="hljs-built_in">cp</span> -r WRFV4.4-raw WRFDAV4.4<br><br><span class="hljs-built_in">cd</span> WRFDAV4.4/<br><br>./clean -a<br><br>./configure wrfda<br><br><span class="hljs-comment">## rewrite: The character class \s will match the whitespace characters &lt;tab&gt; and &lt;space&gt;.</span><br><span class="hljs-comment">## and don&#x27;t include $(DM_FC) </span><br><span class="hljs-comment"># ** Not for all version **</span><br>sed -i <span class="hljs-string">&quot;s/\s\stime\s//g&quot;</span> configure.wrf<br><br>./compile all_wrfvar 2&gt;&amp;1 | <span class="hljs-built_in">tee</span> compile_wrfda.out<br><br><span class="hljs-comment"># After successful compilation, you can find the EXE file of WRFDA in the var/build/ directory</span><br><span class="hljs-comment"># ./var/build/da_wrfvar.exe</span><br></code></pre></td></tr></table></figure><p>End of compilation,</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs sh">......<br><span class="hljs-keyword">if</span> [ <span class="hljs-string">&quot;-DBUFR&quot;</span> = <span class="hljs-string">&quot;-DBUFR&quot;</span> ] ; <span class="hljs-keyword">then</span> \<br>gfortran -o obsproc.exe \<br>module_date.o module_namelist.o module_mm5.o module_map.o module_map_utils.o module_intp.o module_type.o module_func.o module_inside.o module_obs_merge.o module_per_type.o module_duplicate.o module_sort.o module_write.o module_complete.o module_recoverp.o module_diagnostics.o module_recoverh.o module_icao.o module_qc.o module_err_afwa.o module_err_ncep.o module_thin_ob.o \<br>module_decoded.o module_stntbl.o \<br>error_handler.o fm_decoder.o sort_platform.o qc_reduction.o check_obs.o setup.o \<br>obsproc.o  -O2 -ftree-vectorize -funroll-loops -w -ffree-form -ffree-line-length-none -fconvert=big-endian -frecord-marker=4      ../../external/bufr/libbufr.a; \<br><span class="hljs-keyword">else</span> \<br>gfortran -o obsproc.exe \<br>module_date.o module_namelist.o module_mm5.o module_map.o module_map_utils.o module_intp.o module_type.o module_func.o module_inside.o module_obs_merge.o module_per_type.o module_duplicate.o module_sort.o module_write.o module_complete.o module_recoverp.o module_diagnostics.o module_recoverh.o module_icao.o module_qc.o module_err_afwa.o module_err_ncep.o module_thin_ob.o \<br>module_decoded.o module_stntbl.o \<br>error_handler.o fm_decoder.o sort_platform.o qc_reduction.o check_obs.o setup.o \<br>obsproc.o  -O2 -ftree-vectorize -funroll-loops -w -ffree-form -ffree-line-length-none -fconvert=big-endian -frecord-marker=4      ; \<br><span class="hljs-keyword">fi</span><br>make[2]: Leaving directory <span class="hljs-string">&#x27;/home/wpsze/WRF/WRFv440/wrf_install/WRFDAV4.4/var/obsproc/src&#x27;</span><br>( /bin/rm -f obsproc.exe ;   <span class="hljs-built_in">ln</span> -s src/obsproc.exe . )<br>make[1]: Leaving directory <span class="hljs-string">&#x27;/home/wpsze/WRF/WRFv440/wrf_install/WRFDAV4.4/var/obsproc&#x27;</span><br>build started:   Fri Aug 16 15:09:14 HKT 2024<br>build completed: Fri Aug 16 15:13:51 HKT 2024<br></code></pre></td></tr></table></figure><h2 id="successful">Successful</h2><p>Checking, completely successful there should be 44 exe files.</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">ls</span> -l var/build/*exe var/obsproc/src/obsproc.exe<br></code></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs sh">da_advance_time.exe               gen_be_diags_read.exe<br>da_bias_airmass.exe               gen_be_ensmean.exe<br>da_bias_scan.exe                  gen_be_ensrf.exe<br>da_bias_sele.exe                  gen_be_ep1.exe<br>da_bias_verif.exe                 gen_be_ep2.exe<br>da_rad_diags.exe                  gen_be_etkf.exe<br>da_tune_obs_desroziers.exe        gen_be_hist.exe<br>da_tune_obs_hollingsworth1.exe    gen_be_stage0_gsi.exe<br>da_tune_obs_hollingsworth2.exe    gen_be_stage0_wrf.exe<br>da_update_bc_ad.exe               gen_be_stage1_1dvar.exe<br>da_update_bc.exe                  gen_be_stage1.exe<br>da_verif_grid.exe                 gen_be_stage1_gsi.exe<br>da_verif_obs.exe                  gen_be_stage2_1dvar.exe<br>da_wrfvar.exe                     gen_be_stage2a.exe<br>gen_be_addmean.exe                gen_be_stage2.exe<br>gen_be_cov2d3d_contrib.exe        gen_be_stage2_gsi.exe<br>gen_be_cov2d.exe                  gen_be_stage3.exe<br>gen_be_cov3d2d_contrib.exe        gen_be_stage4_global.exe<br>gen_be_cov3d3d_bin3d_contrib.exe  gen_be_stage4_regional.exe<br>gen_be_cov3d3d_contrib.exe        gen_be_vertloc.exe<br>gen_be_cov3d.exe                  gen_mbe_stage2.exe<br>gen_be_diags.exe<br></code></pre></td></tr></table></figure><p>and</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">/var/obsproc/src/obsproc.exe<br></code></pre></td></tr></table></figure><h2 id="error">Error</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">make[3]: time: No such file or directory make[3]: [makefile:42: module_io_int_idx.o] Error 127 (ignored)<br></code></pre></td></tr></table></figure><p>Solution: <a href="https://waipangsze.github.io/2024/05/29/WRF_install_time_error/">make -- time No such file or directory</a></p><h1 id="testcase">testcase</h1><ul><li><a href="https://forum.mmm.ucar.edu/threads/wrfda-4-5-with-wrf-3-9-testcase.13678/">wrfda 4.5 with wrf 3.9 testcase</a></li><li><a href="https://forum.mmm.ucar.edu/threads/error-the-input-file-appears-to-be-from-a-pre-v4-version-of-wrf-initialization-routines.5529/">ERROR: The input file appears to be from a pre-v4 version of WRF initialization routines</a></li><li><a href="https://www2.mmm.ucar.edu/wrf/users/wrfda/download/" class="uri">https://www2.mmm.ucar.edu/wrf/users/wrfda/download/</a></li></ul><blockquote><p>but in this link i don't have a 4.0 testdata and the last testdata that I have is for 3.9 So I've downloaded 3.9 testdata... As expected, it complained about old 3.9 data, so I had to include &gt; force_use_old_data=True</p></blockquote><h1 id="online-tutorial">Online Tutorial</h1><ul><li><a href="https://www2.mmm.ucar.edu/wrf/users/wrfda/OnlineTutorial/index.html">the WRFDA Online Tutorial!</a></li><li><a href="https://www2.mmm.ucar.edu/wrf/users/wrfda/OnlineTutorial/3dvar/index.html">3DVAR: The basics</a></li></ul><h1 id="references">References</h1><ul><li><a href="https://2018syocean.readthedocs.io/zh-cn/feature-delivery/hybrid/hybrid.html">2018沈阳海洋工程项目-WRFDA-混合数据同化技术/快速更新同化预报系统</a></li><li></li></ul>]]></content>
    
    
    <categories>
      
      <category>WRF</category>
      
    </categories>
    
    
    <tags>
      
      <tag>gnu</tag>
      
      <tag>Installation</tag>
      
      <tag>DA</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Spack and Intel OneAPI</title>
    <link href="/2024/08/13/spack_intel/"/>
    <url>/2024/08/13/spack_intel/</url>
    
    <content type="html"><![CDATA[<h1 id="spack">Spack</h1><p>Spack is a package management tool designed to support multiple versions and configurations of software on a wide variety of platforms and environments. It was designed for large supercomputing centers, where many users and application teams share common installations of software on clusters with exotic architectures, using libraries that do not have a standard ABI. Spack is non-destructive: installing a new version does not break existing installations, so many configurations can coexist on the same system. Most importantly, Spack is simple. It offers a simple spec syntax so that users can specify versions and configuration options concisely. Spack is also simple for package authors: package files are written in pure Python, and specs allow package authors to maintain a single file for many different builds of the same package.</p><p><a href="https://spack.readthedocs.io/en/latest/" class="uri">https://spack.readthedocs.io/en/latest/</a></p><h2 id="search-packages-online">Search packages online</h2><blockquote><p><a href="https://packages.spack.io/" class="uri">https://packages.spack.io/</a></p></blockquote><h1 id="installation">Installation</h1><p>Getting Spack is easy. You can clone it from the github repository using this command:</p><p>git clone -c feature.manyFiles=true https://github.com/spack/spack.git {:.info}</p><p>This will create a directory called spack.</p><p>Once you have cloned Spack, we recommend sourcing the appropriate script for your shell:</p><p>. spack/share/spack/setup-env.sh {:.info}</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh">For bash/zsh/sh<br>. spack/share/spack/setup-env.sh<br>(add into .bashrc)<br>For tcsh/csh<br><span class="hljs-built_in">source</span> spack/share/spack/setup-env.csh<br></code></pre></td></tr></table></figure><h1 id="intel">Intel</h1><p>IntelOneapi, https://spack.readthedocs.io/en/latest/build_systems/inteloneapipackage.html</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ spack <span class="hljs-built_in">env</span> create intel_oneapi <br>$ spack <span class="hljs-built_in">env</span> activate intel_oneapi<br>$ spack info --all intel-oneapi-mpi<br>$ spack info --all intel-oneapi-compilers<br></code></pre></td></tr></table></figure><p>try: module load intel-oneapi-mpi/2021.4.0 module load intel-oneapi-compilers/2021.4.0 <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ spack install --add intel-oneapi-compilers@2021.4.0<br><span class="hljs-comment"># Add the compilers to your compilers.yaml so spack can use them:</span><br>$ spack compiler add `spack location -i intel-oneapi-compilers@2021.4.0`/compiler/latest/linux/bin/intel64<br>$ spack compiler add `spack location -i intel-oneapi-compilers@2021.4.0`/compiler/latest/linux/bin<br><span class="hljs-comment"># Verify that the compilers are available:</span><br>$ spack compiler list or spack location -i intel-oneapi-compilers@2021.4.0<br></code></pre></td></tr></table></figure></p><p>Check,</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">which</span> mpiicc &amp;&amp; mpiicc --version<br><span class="hljs-built_in">which</span> mpiifort &amp;&amp; mpiifort --version<br><span class="hljs-built_in">which</span> mpiicpc &amp;&amp; mpiicpc --version<br><span class="hljs-built_in">which</span> icc &amp;&amp; icc --version<br><span class="hljs-built_in">which</span> ifort &amp;&amp; ifort --version<br></code></pre></td></tr></table></figure><p>one more step, install curl</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ spack info --all curl<br>$ spack install --add curl%intel<br></code></pre></td></tr></table></figure><h1 id="remark">Remark</h1><h2 id="spack-info---all-intel-oneapi-mpi">spack info --all intel-oneapi-mpi</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ spack info --all intel-oneapi-mpi<br><br>Package:   intel-oneapi-mpi<br><br>Description:<br>    Intel MPI Library is a multifabric message-passing library that<br>    implements the open-source MPICH specification. Use the library to<br>    create, maintain, and <span class="hljs-built_in">test</span> advanced, complex applications that perform<br>    better on high-performance computing (HPC) clusters based on Intel<br>    processors. LICENSE INFORMATION: By downloading and using this software,<br>    you agree to the terms and conditions of the software license agreements<br>    at https://intel.ly/393CijO.<br><br>Homepage: https://software.intel.com/content/www/us/en/develop/tools/oneapi/components/mpi-library.html<br><br>Maintainers: @rscohn2<br><br>Externally Detectable: <br>    False<br><br>Tags: <br>    None<br><br>Preferred version:  <br>    2021.13.1    https://registrationcenter-download.intel.com/akdlm/IRC_NAS/364c798c-4cad-4c01-82b5-e1edd1b476af/l_mpi_oneapi_p_2021.13.1.769_offline.sh<br><br>Safe versions:  <br>    2021.13.1    https://registrationcenter-download.intel.com/akdlm/IRC_NAS/364c798c-4cad-4c01-82b5-e1edd1b476af/l_mpi_oneapi_p_2021.13.1.769_offline.sh<br>    2021.13.0    https://registrationcenter-download.intel.com/akdlm/IRC_NAS/9f84e1e8-11b2-4bd1-8512-3e3343585956/l_mpi_oneapi_p_2021.13.0.719_offline.sh<br>    2021.12.1    https://registrationcenter-download.intel.com/akdlm/IRC_NAS/56b2dd0e-954d-4330-b0a7-b22992f7e6b7/l_mpi_oneapi_p_2021.12.1.8_offline.sh<br>    2021.12.0    https://registrationcenter-download.intel.com/akdlm/IRC_NAS/749f02a5-acb8-4bbb-91db-501ff80d3f56/l_mpi_oneapi_p_2021.12.0.538_offline.sh<br>    2021.11.0    https://registrationcenter-download.intel.com/akdlm//IRC_NAS/2c45ede0-623c-4c8e-9e09-bed27d70fa33/l_mpi_oneapi_p_2021.11.0.49513_offline.sh<br>    2021.10.0    https://registrationcenter-download.intel.com/akdlm/IRC_NAS/4f5871da-0533-4f62-b563-905edfb2e9b7/l_mpi_oneapi_p_2021.10.0.49374_offline.sh<br>    2021.9.0     https://registrationcenter-download.intel.com/akdlm/IRC_NAS/718d6f8f-2546-4b36-b97b-bc58d5482ebf/l_mpi_oneapi_p_2021.9.0.43482_offline.sh<br>    2021.8.0     https://registrationcenter-download.intel.com/akdlm/IRC_NAS/19131/l_mpi_oneapi_p_2021.8.0.25329_offline.sh<br>    2021.7.1     https://registrationcenter-download.intel.com/akdlm/IRC_NAS/19010/l_mpi_oneapi_p_2021.7.1.16815_offline.sh<br>    2021.7.0     https://registrationcenter-download.intel.com/akdlm/IRC_NAS/18926/l_mpi_oneapi_p_2021.7.0.8711_offline.sh<br>    2021.6.0     https://registrationcenter-download.intel.com/akdlm/IRC_NAS/18714/l_mpi_oneapi_p_2021.6.0.602_offline.sh<br>    2021.5.1     https://registrationcenter-download.intel.com/akdlm/IRC_NAS/18471/l_mpi_oneapi_p_2021.5.1.515_offline.sh<br>    2021.5.0     https://registrationcenter-download.intel.com/akdlm/IRC_NAS/18370/l_mpi_oneapi_p_2021.5.0.495_offline.sh<br>    2021.4.0     https://registrationcenter-download.intel.com/akdlm/IRC_NAS/18186/l_mpi_oneapi_p_2021.4.0.441_offline.sh<br>    2021.3.0     https://registrationcenter-download.intel.com/akdlm/IRC_NAS/17947/l_mpi_oneapi_p_2021.3.0.294_offline.sh<br>    2021.2.0     https://registrationcenter-download.intel.com/akdlm/IRC_NAS/17729/l_mpi_oneapi_p_2021.2.0.215_offline.sh<br>    2021.1.1     https://registrationcenter-download.intel.com/akdlm/IRC_NAS/17397/l_mpi_oneapi_p_2021.1.1.76_offline.sh<br><br>Deprecated versions:  <br>    None<br><br>Variants:<br>    build_system [generic]            generic<br>        Build systems supported by the package<br>    classic-names [<span class="hljs-literal">false</span>]             <span class="hljs-literal">false</span>, <span class="hljs-literal">true</span><br>        Use classic compiler names, e.g mpiicc instead of mpiicx<br>    envmods [<span class="hljs-literal">true</span>]                    <span class="hljs-literal">false</span>, <span class="hljs-literal">true</span><br>        Toggles environment modifications<br>    external-libfabric [<span class="hljs-literal">false</span>]        <span class="hljs-literal">false</span>, <span class="hljs-literal">true</span><br>        Enable external libfabric dependency<br>    generic-names [<span class="hljs-literal">false</span>]             <span class="hljs-literal">false</span>, <span class="hljs-literal">true</span><br>        Use generic names, e.g mpicc instead of mpiicx<br>    ilp64 [<span class="hljs-literal">false</span>]                     <span class="hljs-literal">false</span>, <span class="hljs-literal">true</span><br>        Build with ILP64 support<br><br>Installation Phases:<br>    install<br><br>Build Dependencies:<br>    None<br><br>Link Dependencies:<br>    libfabric<br><br>Run Dependencies:<br>    libfabric<br><br>Virtual Packages: <br>    intel-oneapi-mpi provides mpi@:3.1<br><br>Available Build Phase Test Methods:<br>    None<br><br>Available Install Phase Test Methods:<br>    None<br><br>Stand-Alone/Smoke Test Methods:<br>    Mpi.test_mpi_hello<br><br>Licenses: <br>    https://intel.ly/393CijO<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Spack</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Spack</tag>
      
      <tag>Intel</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Intel Instruction Set Extensions Technology 指令集擴充技術</title>
    <link href="/2024/08/07/Intel_Instruction_Set_Extensions_Technology/"/>
    <url>/2024/08/07/Intel_Instruction_Set_Extensions_Technology/</url>
    
    <content type="html"><![CDATA[<h1 id="intel-instruction-set-extensions-technology">Intel Instruction Set Extensions Technology</h1><p><a href="https://www.intel.com.tw/content/www/tw/zh/support/articles/000005779/processors.html">Intel® Instruction Set Extensions (指令集擴充技術)</a> are additional instructions that <strong>can increase performance</strong> when the same operations are performed on multiple data objects.</p><p>Instruction Set Extensions are additional instructions which can increase performance when the same operations are performed on multiple data objects. These can include <strong>SSE (Streaming SIMD Extensions) and AVX (Advanced Vector Extensions).</strong></p><p>Detailed instructions are listed in Intel® Architecture Instruction Set Extensions Programming Reference.</p><p>Instruction Set Extensions can include: - Single Instruction Multiple Data (SIMD) - Intel® Streaming SIMD Extensions (Intel® SSE,Intel® SSE2,Intel® SSE3, and Intel® SSE4) - Intel® Advanced Vector Extensions (Intel® AVX, Intel® AVX2, and Intel® AVX-512)</p><h2 id="identify-my-intel-processor">Identify My Intel Processor</h2><p>Linux Type the following command: <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ lscpu | grep <span class="hljs-string">&quot;Model name&quot;</span><br>Model name:                           Intel(R) Core(TM) i5-3470S CPU @ 2.90GHz<br></code></pre></td></tr></table></figure></p><h2 id="product-specifications">Product Specifications</h2><ul><li>Go to https://ark.intel.com/content/www/us/en/ark.html#<span class="citation" data-cites="Processors">@Processors</span></li><li>enter your CPU name<ul><li>like https://ark.intel.com/content/www/us/en/ark/products/68315/intel-core-i5-3470s-processor-6m-cache-up-to-3-60-ghz.html</li><li>It has shown <strong>Instruction Set Extensions = Intel® SSE4.1, Intel® SSE4.2, Intel® AVX</strong></li></ul></li></ul><h2 id="streaming-simd-extensions-sse">Streaming SIMD Extensions (SSE)</h2><p>SSE is a process or technology that enables single instruction multiple data. Older processors only process a single data element per instruction. SSE enables the instruction to handle multiple data elements. It's used in intensive applications, such as 3D graphics, for faster processing. SSE is designed to replace MMX™ Technology. It expanded over the generations of Intel® Processors to include SSE2, SSE3/SSE3S, and SSE4. Each iteration has brought new instructions and increased performance.</p><h2 id="intel-advanced-vector-extensions-intel-avx-and-avx2">Intel Advanced Vector Extensions (Intel® AVX and AVX2)</h2><p><strong>Intel® AVX is a 256-bit instruction set extension to Intel® SSE</strong> designed for applications that are Floating Point (FP) intensive. Intel AVX improves performance due to wider vectors, new extensible syntax, and rich functionality. <strong><em>Intel AVX2 was released in 2013</em></strong>, extending vector processing capability across floating-point and integer data domains. This results in higher performance and more efficient data management across a wide range of applications. Examples are image and audio/video processing, scientific simulations, financial analytics, and 3D modeling and analysis.</p><h2 id="intel-advanced-vector-extensions-512-intel-avx-512">Intel® Advanced Vector Extensions 512 (Intel® AVX-512)</h2><p>The Intel® AVX-512 enables processing of twice the number of data elements that Intel AVX/AVX2 can process with a single instruction and four times the capabilities of Intel SSE. Intel AVX-512 instructions are important because they open up higher performance capabilities for the most demanding computational tasks. Intel AVX-512 instructions offer the highest degree of compiler support in the design of the instruction capabilities.</p><h2 id="spec-flag-description-for-the-gnu-ccfortran-compiler">SPEC Flag Description for the GNU C/C++/Fortran Compiler</h2><p>Go to https://www.spec.org/omp2012/flags/gcc-linux64.html</p><p>Optimization Flags - -Ofast - -fopenmp - -fopenmp-simd - -m64 - -mavx512f - -mavx512cd - -mavx512er - -mavx512pf - -march=ivybridge - -march=native</p>]]></content>
    
    
    <categories>
      
      <category>Intel</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Intel</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>JupyterLab</title>
    <link href="/2024/07/31/JupyterLab/"/>
    <url>/2024/07/31/JupyterLab/</url>
    
    <content type="html"><![CDATA[<h1 id="jupyterlab">JupyterLab</h1><p>JupyterLab is the latest web-based interactive development environment for notebooks, code, and data. Its flexible interface allows users to configure and arrange workflows in data science, scientific computing, computational journalism, and machine learning. A modular design invites extensions to expand and enrich functionality.</p><h2 id="install">Install</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh">micromamba activate venv <br>micromamba install python=3.11<br>micromamba install -c conda-forge jupyterlab<br>micromamba install anaconda::ipykernel<br>micromamba install nodejs<br>micromamba install -c conda-forge jupyter-resource-usage<br>micromamba install -c conda-forge jupyterlab_execute_time<br></code></pre></td></tr></table></figure><h2 id="execute">Execute</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ jupyter-lab<br></code></pre></td></tr></table></figure><h2 id="added-other-kernels-to-jupyter">Added other kernels to Jupyter</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs sh"><br>micromamba activate new-env-1<br><br><span class="hljs-comment"># install python kernel for Jupyter</span><br><span class="hljs-comment"># avoid installation of any jupyter related modules</span><br>micromamba install anaconda::ipykernel<br><br><span class="hljs-comment"># added the kernel to Jupyter and name it as &quot;Environment(myproject)&quot;</span><br>python -m ipykernel install --user --name=mnew-env-1 --display-name=<span class="hljs-string">&#x27;Environment(new-env-1)&#x27;</span><br><br>micromamba deactivate<br><br>micromamba acitvate new-env-2<br><br><span class="hljs-comment"># install python kernel for Jupyter</span><br><span class="hljs-comment"># avoid installation of any jupyter related modules</span><br>micromamba install anaconda::ipykernel<br><br><span class="hljs-comment"># added the kernel to Jupyter and name it as &quot;Environment(myproject)&quot;</span><br>python -m ipykernel install --user --name=mnew-env-2 --display-name=<span class="hljs-string">&#x27;Environment(new-env-2)&#x27;</span><br></code></pre></td></tr></table></figure><h2 id="monitor-resource-usage-with-gpu-dashboard-in-jupyter">Monitor resource usage with GPU Dashboard in Jupyter</h2><p>A GPU dashboard is available for JupyterLab for showing the resource usage of GPU in real time, side by side with cells in your notebook. It is particularly useful in identifying any bottleneck or issues during code development.</p><p>You may activate your conda or python virtual environment for your kernel and run the following once to install the GPU dashboard.</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">pip install jupyterlab-nvdashboard<br></code></pre></td></tr></table></figure><h1 id="references">References</h1><ul><li><a href="https://hpc.hku.hk/hpc/software/jupyterlab/">HKU HPC</a></li><li><a href="https://github.com/jupyter-server/jupyter-resource-usage">jupyter-resource-usage</a></li><li><a href="https://jupyterlab-contrib.github.io/extensions.html">List of extensions and tools</a></li><li><a href="https://github.com/altair-viz/jupyterlab_voyager">Voyager is a JupyterLab MIME renderer extension to view CSV and JSON data in Voyager 2</a></li><li><a href="https://github.com/jupyterlab/debugger">jupyterlab/debugger</a></li><li><a href="https://jupyterlab.readthedocs.io/en/stable/user/extensions.html#id9">JupyterLab extension</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>Jupyter</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Jupyter</tag>
      
      <tag>python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ssh tunnel</title>
    <link href="/2024/07/04/ssh_tunnel/"/>
    <url>/2024/07/04/ssh_tunnel/</url>
    
    <content type="html"><![CDATA[<h1 id="introduction-to-ssh-tunnels">Introduction to SSH Tunnels</h1><p>Secure Shell, or SSH, is used to create a secure channel between a local and remote computer. While SSH is commonly used for secure terminal access and file transfers, it can also be used to create a secure tunnel between computers for forwarding other network connections that are not normally encrypted. SSH tunnels are also useful for allowing outside access to internal network resources.</p><p>An <strong>SSH tunneling (SSH Port Forwarding)</strong> establishes a connection between your local machine and the remote machine via a TCP port. When you configure your local application to use an SSH tunnel you tell it to connect to your local machine at a specified port, rather than the remote machine. The tunnel then carries your traffic securely to the remote machine.</p><p>SSH Port Forwarding： - Local Port Forwarding - Remote Port Forwarding - Dynamic Port Forwarding</p><p>For both local and remote port forwarding, there are three roles:</p><ul><li>Client<ul><li>Any machine from which you can type ssh to start Port Forwarding</li></ul></li><li>SSH server<ul><li>Clients can use SSH connections for machine learning</li></ul></li><li>target server<ul><li>Some machines you want to establish a connection to, usually to open services on this machine to the outside world</li></ul></li></ul><p><strong>Note that</strong> both the client and the SSH server can themselves be the target server. It does not mean that only three machines can be used for port forwarding!</p><h2 id="local-port-forwarding">Local Port Forwarding</h2><p>Local forwarding is used to forward a port from the client machine to the server machine.</p><p>Quite a few organizations for all incoming SSH access through a single <strong>jump server</strong>. The server may be a standard Linux/Unix box, usually with some extra hardening, intrusion detection, and/or logging, or it may be a commercial jump server solution.</p><p>To create a local port forward add the <strong>-L</strong> parameter to the ssh command line.</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ ssh -L 9090:localhost:8080 user@server-ip<br></code></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ ssh -L 9090:192.168.1.101:8080 user@server-ip<br></code></pre></td></tr></table></figure><p>The 192.168.1.101 here is relative to user@server-ip, so it is the IP address of the server behind the firewall or VPN. Then, you can visit 192.168.1.101:9090</p><h2 id="remote-port-forwarding">Remote Port Forwarding</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">ssh -R 9090:localhost:8080 user@server-ip<br></code></pre></td></tr></table></figure><h1 id="references">References</h1><p><a href="https://www.ssh.com/academy/iam/jump-server">What is a Jump Server?</a><br /><a href="https://johnliu55.tw/ssh-tunnel.html">SSH Tunneling (Port Forwarding) 詳解</a></p>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ssh</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Physics-informed neural networks (PINN)</title>
    <link href="/2024/06/26/PINN/"/>
    <url>/2024/06/26/PINN/</url>
    
    <content type="html"><![CDATA[<h1 id="pinn">PINN</h1><p>Physics-informed neural networks (PINNs) are a type of universal function approximators that can embed the knowledge of any physical laws that govern a given data-set in the learning process, and can be described by partial differential equations (PDEs).</p><figure><img src="https://upload.wikimedia.org/wikipedia/commons/9/90/Physics-informed_nerural_networks.png" alt="PINN" /><figcaption>PINN</figcaption></figure><h2 id="physics-informed-machine-learning">Physics-informed machine learning</h2><p><a href="https://www.nature.com/articles/s42254-021-00314-5.">Karniadakis, George Em, et al. "Physics-informed machine learning." Nature Reviews Physics 3.6 (2021): 422-440.</a></p>]]></content>
    
    
    <categories>
      
      <category>ML</category>
      
    </categories>
    
    
    <tags>
      
      <tag>PINN</tag>
      
      <tag>AI</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>JAX</title>
    <link href="/2024/06/25/PINN-JAX/"/>
    <url>/2024/06/25/PINN-JAX/</url>
    
    <content type="html"><![CDATA[<h1 id="jax">JAX</h1><p><a href="https://github.com/google/jax">JAX</a> is a Python library for accelerator-oriented array computation and program transformation, designed for high-performance numerical computing and large-scale machine learning.</p><p>With its updated version of <strong>Autograd</strong>, JAX can automatically differentiate native Python and NumPy functions. It can differentiate through loops, branches, recursion, and closures, and it can take derivatives of derivatives of derivatives. It supports reverse-mode differentiation (a.k.a. backpropagation) via grad as well as forward-mode differentiation, and the two can be composed arbitrarily to any order.</p><h1 id="installing-jax">Installing JAX</h1><p>https://jax.readthedocs.io/en/latest/installation.html</p><p>TL;DR For most users, a typical JAX installation may look something like this:</p><ul><li>CPU-only (Linux/macOS/Windows)</li><li>GPU (NVIDIA, CUDA 12)</li><li>TPU (Google Cloud TPU VM)</li></ul><h1 id="install-nvidia">Install (NVIDIA)</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ micromamba activate wpsze_venv<br>$ micromamba install jaxlib=*=*cuda* jax cuda-nvcc -c conda-forge -c nvidia<br><br>$ nvidia-smi<br></code></pre></td></tr></table></figure><h2 id="version-issue">Version Issue</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs sh">CUDA backend failed to initialize: Unable to use CUDA because of the following issues with CUDA components:<br>Outdated CUDA installation found.<br>Version JAX was built against: 11080<br>Minimum supported: 12010<br>Installed version: 11080<br>The <span class="hljs-built_in">local</span> installation version must be no lower than 12010.<br>--------------------------------------------------<br>Outdated cuBLAS installation found.<br>Version JAX was built against: 111103<br>Minimum supported: 120100<br>Installed version: 111103<br>The <span class="hljs-built_in">local</span> installation version must be no lower than 120100.<br>--------------------------------------------------<br>Outdated cuSPARSE installation found.<br>Version JAX was built against: 11705<br>Minimum supported: 12100<br>Installed version: 11705<br>The <span class="hljs-built_in">local</span> installation version must be no lower than 12100..(Set TF_CPP_MIN_LOG_LEVEL=0 and rerun <span class="hljs-keyword">for</span> more info.)<br>[0.        1.05      2.1       3.1499999 4.2      ]<br></code></pre></td></tr></table></figure><p><a href="https://docs.nvidia.com/cuda/archive/12.1.0/cuda-toolkit-release-notes/">Driver/CUDA version</a>,</p><table><thead><tr class="header"><th>CUDA Toolkit</th><th>Minimum Required Driver Version for CUDA Minor Version Compatibility*</th><th></th></tr></thead><tbody><tr class="odd"><td></td><td>Linux x86_64 Driver Version</td><td>Windows x86_64 Driver Version</td></tr><tr class="even"><td>CUDA 12.1.x</td><td>525.60.13</td><td>527.41</td></tr><tr class="odd"><td>CUDA 12.0.x</td><td>525.60.13</td><td>527.41</td></tr><tr class="even"><td>CUDA 11.8.x</td><td>450.80.02</td><td>452.39</td></tr><tr class="odd"><td>CUDA 11.7.x</td><td>450.80.02</td><td>452.39</td></tr></tbody></table><h1 id="install-cpu-only">Install (CPU only)</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">conda install jax -c conda-forge<br></code></pre></td></tr></table></figure><p>Test 1:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/python</span><br><br><span class="hljs-comment"># 导入库</span><br>from jax import grad<br>import jax.numpy as jnp<br><br><span class="hljs-comment"># 定义logistic函数</span><br>def logistic(x):  <br>    <span class="hljs-built_in">return</span> jnp.exp(x) / (jnp.exp(x) + 1)<br><br><span class="hljs-comment"># 获得logistic函数的梯度函数</span><br>grad_logistic = grad(logistic)<br><br><span class="hljs-comment"># 求值logistic函数在x = 1处的梯度 </span><br>grad_log_out = grad_logistic(1.0)   <br><span class="hljs-built_in">print</span>(grad_log_out)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Final result is 0.19661194 &quot;</span>)<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>ML</category>
      
    </categories>
    
    
    <tags>
      
      <tag>PINN</tag>
      
      <tag>AI</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>WRF | WRF: Why domains should be at least 100x100 grid spaces?</title>
    <link href="/2024/06/11/WRF-Why_domains_should_be_at_least_100_100_grid_spaces/"/>
    <url>/2024/06/11/WRF-Why_domains_should_be_at_least_100_100_grid_spaces/</url>
    
    <content type="html"><![CDATA[<h1 id="why-domains-should-be-at-least-100x100-grid-spaces"><a href="https://forum.mmm.ucar.edu/threads/why-domains-should-be-at-least-100x100-grid-spaces.16793/">Why domains should be at least 100x100 grid spaces?</a></h1><p>Each WRF domain should be at least 100x100 grid points (e_we and e_sn).</p><p>When running a simulation, the input data for the lateral boundaries, every so many intervals (e.g., every 3 hours), are much more coarse than the simulation you’re trying to run.</p><p>Synoptic-scale systems typically move through a large area in a short amount of time. If a domains is too small, there isn’t enough space for the model to develop anything of interest before the large-scale parcels have propagated through the domain and exited the other side. This is sometimes referred to as “sweeping,” meaning the <strong>input essentially wipes out what WRF is trying to simulate at high resolution, with different physics and higher-res terrain, landuse, the dynamics, and all the other features you want</strong>. Even if you’re only interested in microscale events, the large-scale factors are important for forcing.</p><p>Essentially, if your domain is too small, you’re basically going to get the output as if the domain was still a coarse-resolution. You want your domain to have enough space so that you can actually see the effect.</p><p>This is not a computational limitation. It’s more an issue of reasonable and beneficial output. {:.info}</p><p><strong>Also note that the model will use the rows and columns around the edges of the domain for communication. This is set, by default, to 5 rows and 5 columns (it can be changed with the &amp;bdy_control namelist parameter ‘spec_bdy_width,' but shouldn't be smaller than 5). This means that if e_we = 100 and e_sn = 100, at a minimum, the domain is already cut down to 90x90.</strong></p>]]></content>
    
    
    <categories>
      
      <category>WRF</category>
      
    </categories>
    
    
    <tags>
      
      <tag>WRF</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Spack-Stack (MPAS-JEDI)</title>
    <link href="/2024/06/10/spack_stack_jedi_mpas/"/>
    <url>/2024/06/10/spack_stack_jedi_mpas/</url>
    
    <content type="html"><![CDATA[<h1 id="spack-stack">spack-stack</h1><p>Spack-stack is a framework for installing software libraries to support NOAA's Unified Forecast System (UFS) applications and the Joint Effort for Data assimilation Integration (JEDI) coupled to several Earth system prediction models (MPAS, NEPTUNE, UM, FV3, GEOS, UFS).</p><p>Spack-stack provides a practical framework for setting up and managing software libraries that support the Unified Forecast System (UFS) and Joint Effort for Data assimilation Integration (JEDI) projects, along with several other Earth system prediction models, such as the Model for Prediction Across Scales (MPAS), the Navy Environmental Prediction System Utilizing a Nonhydrostatic Engine (NEPTUNE), the Unified Model (UM), and the Goddard Earth Observing System (GEOS). This project results from collaboration among the Joint Center for Satellite Data Assimilation (JCSDA), the National Oceanic and Atmospheric Administration’s (NOAA’s) Environmental Modeling Center (EMC) and Earth Prediction Innovation Center (EPIC), and the U.S. Naval Research Laboratory (NRL). Spack-stack utilizes the Spack package manager, originally developed at Lawrence Livermore National Laboratory to cater to scientific high-performance computing (HPC) workflows.</p><p><a href="https://www.jcsda.org/news-blog/2023/10/2/jedi-spack-stack-150-the-new-standard">SPACK-STACK 1.5.0</a> &gt; That started changing in 2021, when JCSDA and NOAA EMC began exploring Spack as an option for creating a single software stack that could be used for both the JEDI DA software environment and the Unified Forecast System (UFS) ecosystem.</p><p><a href="https://github.com/JCSDA/spack-stack">github spack-stack</a></p><p><a href="https://spack-stack.readthedocs.io/en/latest/#">spack-stack.readthedocs.io</a></p><p><a href="https://epic.noaa.gov/spack-stack/">Spack-stack</a></p><p><a href="https://www.google.com/search?q=ONE+STACK+TO+BUILD+THEM+ALL%3A+THE+NOAA-EMC%2FJCSDA+SPACK-STACK&amp;rlz=1C5CHFA_enHK1003HK1003&amp;sourceid=chrome&amp;ie=UTF-8">ONE STACK TO BUILD THEM ALL: THE NOAA-EMC/JCSDA SPACK-STACK (PPT)</a></p><p><a href="https://epic.noaa.gov/wp-content/uploads/2023/08/UIFCW-2023-Thu-17.-RICHERT_spack-stack-UIFCW-July-2023.pdf">spack-stack: A reproducible, many-platform software stack for operational weather applications (PPT)</a></p><p>spack-stack is a set of Spack configurations and extensions {:.info}</p><p>spack-stack is mainly a collection of Spack configuration files, but provides a Spack extension to simplify the installation process {:.info}</p><h1 id="new-spack-stack-directory-structure">New spack-stack directory structure</h1><p>To generate a new spack-stack directory structure,</p><p>run <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">git <span class="hljs-built_in">clone</span> --recurse-submodules https://github.com/JCSDA/spack-stack<br></code></pre></td></tr></table></figure></p><p>optionally with, e.g., '-b release/1.4.1' to specify the version</p><p>source &lt;path to spack-stack directory&gt;/setup.sh {:.info}</p><h1 id="new-environment">New environment</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ spack stack create <span class="hljs-built_in">env</span> --site &lt;site name&gt; --template &lt;template name&gt; --name &lt;environment name&gt;<br>$ <span class="hljs-built_in">cd</span> <span class="hljs-variable">$&#123;SPACK_STACK_DIR&#125;</span>/envs/&lt;environment name&gt;/<br>$ spack <span class="hljs-built_in">env</span> activate .<br><br><span class="hljs-comment"># If not using an existing site configuration, you may wish to modify config files and/or populate them using commands</span><br><span class="hljs-comment"># such as &#x27;spack external find&#x27; and &#x27;spack compiler find&#x27;.</span><br><span class="hljs-comment"># See https://spack-tutorial.readthedocs.io/en/latest/tutorial_configuration.html</span><br><br>$ spack concretize 2&gt;&amp;1 | <span class="hljs-built_in">tee</span> log.concretize<br>$ spack install [--verbose] [--fail-fast] 2&gt;&amp;1 | <span class="hljs-built_in">tee</span> log.install<br>$ spack module lmod refresh<br>$ spack stack setup-meta-modules<br></code></pre></td></tr></table></figure><h2 id="mpas-jdei">MPAS-JDEI</h2><p>Ref:<a href="https://www2.mmm.ucar.edu/projects/mpas-jedi/tutorial/202310NCU/">Welcome to the MPAS-JEDI tutorial practice guide</a></p><p>For example, if default is gcc@8.5.0.</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ git <span class="hljs-built_in">clone</span> -b release/1.5.1 --recurse-submodules https://github.com/JCSDA/spack-stack<br><br>$ <span class="hljs-built_in">cd</span> spack-stack<br><br>$ git status<br>On branch release/1.5.1<br>Your branch is up to <span class="hljs-built_in">date</span> with <span class="hljs-string">&#x27;origin/release/1.5.1&#x27;</span>.<br><br>nothing to commit, working tree clean<br><br>$ <span class="hljs-built_in">source</span> setup.sh<br><br>$ spack stack create <span class="hljs-built_in">env</span> --site linux.default --name jedi_gccv850_linux<br>Configuring basic directory information ...<br>  ... script directory: /home/wpsze/spack-stack/spack-stack/spack/lib/jcsda-emc/spack-stack/stack<br>  ... base directory: /home/wpsze/spack-stack/spack-stack/spack/lib/jcsda-emc/spack-stack<br>  ... spack directory: /home/wpsze/spack-stack/spack-stack/spack<br>Creating environment from command-line args<br>Successfully wrote environment at /home/wpsze/spack-stack/spack-stack/envs/jedi_gccv850_linux/spack.yaml<br><br>WARNING! User <span class="hljs-built_in">umask</span> is neither 0022 nor 0027, check before proceeding<br><br>==&gt; Created environment /home/wpsze/spack-stack/spack-stack/envs/jedi_gccv850_linux<br><br>$ spack <span class="hljs-built_in">env</span> activate envs/jedi_gccv850_linux<br><br>$ spack find<br>==&gt; In environment /home/wpsze/spack-stack/spack-stack/envs/jedi_gccv850_linux<br>==&gt; No root specs<br>==&gt; 0 installed packages<br><br><br><span class="hljs-comment">## MPAS-JEDI</span><br>$ spack add ecbuild eigen udunits gsl-lite environment-modules<br>$ spack add mpich<br>$ spack add hdf5^mpich parallelio^mpich<br>$ spack add ecmwf-atlas@0.31.1^mpich<br><br>$ spack install<br><br><span class="hljs-comment"># all are successful.</span><br><br> $ spack find<br>==&gt; In environment /home/wpsze/spack-stack/spack-stack/envs/jedi_gccv850_linux<br>==&gt; Root specs<br>ecbuild   ecmwf-atlas@0.31.1   eigen   environment-modules   gsl-lite   hdf5   mpich   parallelio   udunits <br><br>==&gt; Installed packages<br>-- linux-rocky8-haswell / gcc@8.5.0 -----------------------------<br>autoconf@2.69                       diffutils@3.9              fiat@1.2.0       libfabric@1.18.1   m4@1.4.19               pigz@2.7                util-macros@1.19.3<br>automake@1.16.5                     ecbuild@3.7.2              findutils@4.9.0  libffi@3.4.4       mpich@4.1.1             pkg-config@0.29.2       xz@5.4.1<br>berkeley-db@18.1.40                 eckit@1.23.1               flex@2.6.3       libiconv@1.17      ncurses@6.4             python@3.10.8           yaksa@0.2<br>bison@3.8.2                         ecmwf-atlas@0.31.1         gdbm@1.23        libmd@1.0.4        netcdf-c@4.9.2          readline@8.2            zlib@1.2.13<br>boost@1.78.0                        ectrans@1.2.0              gettext@0.21.1   libpciaccess@0.17  netcdf-fortran@4.6.0    snappy@1.1.10           zstd@1.5.2<br>bzip2@1.0.8                         eigen@3.4.0                gmake@4.4.1      libsigsegv@2.14    openblas@0.3.19         sqlite@3.42.0<br>c-blosc@1.21.4                      environment-modules@5.3.1  gsl-lite@0.37.0  libtool@2.4.7      openssl@1.1.1u          tar@1.34<br>ca-certificates-mozilla@2023-01-10  expat@2.5.0                hdf5@1.14.0      libxcrypt@4.4.35   parallel-netcdf@1.12.2  tcl@8.6.12<br>cmake@3.23.1                        fckit@0.10.1               libaec@1.0.6     libxml2@2.10.3     parallelio@2.5.10       udunits@2.2.28<br>curl@8.1.2                          fftw@3.3.10                libbsd@0.11.7    lz4@1.9.4          perl@5.38.0             util-linux-uuid@2.38.1<br>==&gt; 65 installed packages<br><br>$ spack module tcl refresh<br>==&gt; You are about to regenerate tcl module files <span class="hljs-keyword">for</span>:<br><br>-- linux-rocky8-haswell / gcc@8.5.0 -----------------------------<br>kmosf2b autoconf@2.69                       owkksle expat@2.5.0       o5fm2ib libpciaccess@0.17       zzdldzz pkg-config@0.29.2<br>3zzqcqa automake@1.16.5                     z5frtgj fckit@0.10.1      bcnervk libsigsegv@2.14         vu7mzai python@3.10.8<br>rksajpa berkeley-db@18.1.40                 dyhv6t6 fftw@3.3.10       oi52wco libtool@2.4.7           nbav53o readline@8.2<br>k4yohcw bison@3.8.2                         abwhtim fiat@1.2.0        dh3pgna libxcrypt@4.4.35        awehs3f snappy@1.1.10<br>3zcm66d boost@1.78.0                        th5cmuq findutils@4.9.0   56a6xgk libxml2@2.10.3          xmupg6k sqlite@3.42.0<br>yd6i5au bzip2@1.0.8                         hjgtmaq flex@2.6.3        rwcgkls lz4@1.9.4               vetdjwa tar@1.34<br>at3s3ei c-blosc@1.21.4                      lisu52h gdbm@1.23         uwicvjw m4@1.4.19               m3xviog tcl@8.6.12<br>edma3gu ca-certificates-mozilla@2023-01-10  wzfhnm7 gettext@0.21.1    jefb5lu mpich@4.1.1             uadvmuz udunits@2.2.28<br>h5p5rs7 cmake@3.23.1                        ba4vudd gmake@4.4.1       dzxkixc ncurses@6.4             wdfeec7 util-linux-uuid@2.38.1<br>jf7usug curl@8.1.2                          t4udhou gsl-lite@0.37.0   6d2z7tb netcdf-c@4.9.2          evqjofh util-macros@1.19.3<br>32jm5xp diffutils@3.9                       fja7tdm hdf5@1.14.0       3ltfgi2 netcdf-fortran@4.6.0    72t2yvx xz@5.4.1<br>pzidwlf ecbuild@3.7.2                       vbf3elz libaec@1.0.6      u5n5zri openblas@0.3.19         iyrk2i7 yaksa@0.2<br>wov4yva eckit@1.23.1                        65boafj libbsd@0.11.7     mgcs3tx openssl@1.1.1u          x54v3wn zlib@1.2.13<br>v45ibbv ecmwf-atlas@0.31.1                  63u4otp libfabric@1.18.1  56vql6d parallel-netcdf@1.12.2  bteldyo zstd@1.5.2<br>kb6u64z ectrans@1.2.0                       frf3blg libffi@3.4.4      efx7bmd parallelio@2.5.10<br>t4jxg3j eigen@3.4.0                         pnmrtbc libiconv@1.17     se4zvg5 perl@5.38.0<br>om7l5xf environment-modules@5.3.1           vgtevgl libmd@1.0.4       l3xczgm pigz@2.7<br><br>==&gt; Do you want to proceed? [y/n] y<br>==&gt; Regenerating tcl module files<br><br>$ spack stack setup-meta-modules<br>...<br>Metamodule generation completed successfully <span class="hljs-keyword">in</span> /home/wpsze/spack-stack/spack-stack/envs/jedi_gccv850_linux/install/modulefiles/Core<br></code></pre></td></tr></table></figure><p>Error: &gt; Error: eigen-3.4.0-t4jxg3j727pxxsr75zstl2eblmkzapfz: timeout: The read operation timed out &gt;&gt; rerun: $ spack install</p><blockquote><p>==&gt; Installing krb5-1.20.1-muktx57itqz6x2z74afwncpub2higpei msgfmt: error while opening "en_US.mo" for writing: Permission denied msgfmt: error while opening "de.mo" for writing: Permission denied &gt; No install git-lfs</p></blockquote><blockquote><p>Error: git-lfs-3.3.0-6ilwlfqmm7ud5crbugmcskju5gtkgk4j: Package was not installed &gt; <code>$ micromamba activate git-lfs</code> &gt; <code>$ micromamba install git-lfs</code></p></blockquote><p>Remark: Git Large File Storage (LFS) replaces large files such as audio samples, videos, datasets, and graphics with text pointers inside Git, while storing the file contents on a remote server like GitHub.com or GitHub Enterprise.</p><p>source env,</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#source $&#123;SPACK_DIR&#125;/setup.sh</span><br><span class="hljs-comment">#spack env activate $&#123;SPACK_ENV&#125;</span><br></code></pre></td></tr></table></figure><blockquote><p>** do above on local PC because git-lfs fails on workstation/cluster.</p></blockquote><h2 id="mpas_bundle">mpas_bundle</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ <span class="hljs-built_in">source</span> spack/share/spack/setup-env.sh<br>$ <span class="hljs-built_in">source</span> spack-stack/setup.sh<br>$ spack <span class="hljs-built_in">env</span> activate spack-stack/envs/jedi_gcc_linux<br>$ spack find<br><br>$ <span class="hljs-built_in">mkdir</span> mpas_bundle_v2<br>$ <span class="hljs-built_in">cd</span> mpas_bundle_v2<br>$ git <span class="hljs-built_in">clone</span> -b release/2.0.0 https://github.com/JCSDA/mpas-bundle.git code<br><br>$ <span class="hljs-built_in">mkdir</span> build<br>$ <span class="hljs-built_in">cd</span> build<br><br><span class="hljs-comment"># (no need) $ module list</span><br></code></pre></td></tr></table></figure><p>MPAS-JEDI uses cmake to automatically download the code from various github repositories, listed in CMakeLists.txt under ~code. Now type the command below under the build directory:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ git lfs install<br></code></pre></td></tr></table></figure><p>and then, <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sh">spack load ecbuild@3.7.2<br>spack load eigen@3.4.0 gsl-lite@0.37.0 hdf5@1.14.0 udunits@2.2.28 netcdf-c@4.9.2 netcdf-fortran@4.6.0 parallel-netcdf@1.12.2 parallelio@2.5.10<br>spack load openblas@0.3.19<br>spack load eckit@1.23.1<br>spack load fckit@0.10.1<br>spack load ecmwf-atlas@0.31.1<br>spack load cmake@3.23.1 mpich@4.1.1<br><br>$ cmake ../code<br><br>......<br>-- Configuring <span class="hljs-keyword">done</span><br>-- Generating <span class="hljs-keyword">done</span><br>-- Build files have been written to: /home/wpsze/mpas_bundle_v2/build<br></code></pre></td></tr></table></figure></p><p>After it completes, <strong>you will see the actual source code of various reporitories (e.g., oops, saber, ufo, ioda, crtm, mpas-jedi, and MPAS) is now under the code directory</strong>. Meanwhile, <strong>Makefile files to build executables are generated under the build directory</strong>. Now it is ready to compile MPAS-JEDI under 'build' using the standard make. However, it is NOT recommended to compile the code on the login node at the same time.</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ make -j14<br><br>.......<br>[100%]<br></code></pre></td></tr></table></figure><p>This requests xx min walltime of a login node with 14 cores. {:.info}</p><p>Once we reach 100% of the compilation, we can check mpas-jedi related executables:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ <span class="hljs-built_in">ls</span> bin/mpas*<br><br>bin/mpas_atmosphere                       bin/mpasjedi_forecast.x<br>bin/mpas_atmosphere_build_tables          bin/mpasjedi_gen_ens_pert_B.x<br>bin/mpas_data_checker.py                  bin/mpasjedi_hofx3d.x<br>bin/mpas_data_downloader.py               bin/mpasjedi_hofx.x<br>bin/mpas_init_atmosphere                  bin/mpasjedi_rtpp.x<br>bin/mpasjedi_convertstate.x               bin/mpasjedi_staticbinit.x<br>bin/mpasjedi_dirac.x                      bin/mpasjedi_variational.x<br>bin/mpasjedi_eda.x                        bin/mpas_namelist_gen<br>bin/mpasjedi_enkf.x                       bin/mpas_parse_atmosphere<br>bin/mpasjedi_enshofx.x                    bin/mpas_parse_init_atmosphere<br>bin/mpasjedi_error_covariance_training.x  bin/mpas_streams_gen<br><br>$ <span class="hljs-built_in">ls</span> bin/ioda-up*<br>bin/ioda-upgrade-v1-to-v2.x  bin/ioda-upgrade-v2-to-v3.x<br></code></pre></td></tr></table></figure><p>The last step is to ensure that the code was compiled properly by running the MPAS-JEDI ctests, with two lines of simple command:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ <span class="hljs-built_in">cd</span> mpas-jedi<br>$ ctest<br><br>100% tests passed, 0 tests failed out of 47<br><br>Label Time Summary:<br>executable    =  54.21 sec*proc (13 tests)<br>mpasjedi      = 380.26 sec*proc (47 tests)<br>mpi           = 287.59 sec*proc (43 tests)<br>script        = 326.05 sec*proc (34 tests)<br><br>Total Test time (real) = 380.91 sec<br></code></pre></td></tr></table></figure><p>To determine if a test passes or fails, <em>a comparison of the test log and reference file is done internally taking as reference a tolerance value</em>. This tolerance is specified via YAML file. These files can be found under <strong>mpas-jedi/test/testoutput</strong> in the build folder.</p><h2 id="converting-ncep-bufr-observation-into-ioda-hdf5-format">Converting NCEP BUFR observation into IODA-HDF5 format</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ <span class="hljs-built_in">cd</span> mpas_jedi_tutorial <br>$ git <span class="hljs-built_in">clone</span> https://github.com/NCAR/obs2ioda<br>$ <span class="hljs-built_in">cd</span> obs2ioda/obs2ioda-v2/src/<br></code></pre></td></tr></table></figure><p>NCEP BUFR library (https://github.com/NOAA-EMC/NCEPLIBS-bufr) is required to compile <strong>obs2ioda-v2.x</strong>. Edit <strong>obs2ioda-v2/src/Makefile</strong> to set proper <strong>BUFR_LIB</strong> before make. Here we have pre-build BUFR_LIB on Taiwania-3 and we put the pre-build BUFR_LIB path in Makefile.</p><h3 id="required-ncep-bufr-library">(Required) NCEP BUFR library</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ git <span class="hljs-built_in">clone</span> https://github.com/NOAA-EMC/NCEPLIBS-bufr<br><br>$ <span class="hljs-built_in">mkdir</span> build &amp;&amp; <span class="hljs-built_in">cd</span> build<br><br><span class="hljs-comment"># $ cmake -DCMAKE_INSTALL_PREFIX=path1 -DMASTER_TABLE_DIR=path2 .. # path1=./</span><br>$ cmake -DCMAKE_INSTALL_PREFIX=./ .. <br>-- Build files have been written to: /home/wpsze/mpas_jedi_tutorial/NCEPLIBS-bufr/build<br><br>$ make -j4<br>......<br>[100%] Built target outtest6_8<br><br>$ ctest<br>......<br>100% tests passed, 0 tests failed out of 94<br>Total Test time (real) =  30.62 sec<br><br>$ make install<br>......<br>-- Installing: /home/wpsze/mpas_jedi_tutorial/NCEPLIBS-bufr/build/bin/debufr<br></code></pre></td></tr></table></figure><p>Both <strong>path1</strong> and <strong>path2</strong> may be full or relative pathnames on the system, up to a maximum of 90 characters each.</p><p>Installation of the library and utilities will be under <strong>path1</strong>. Installation of the master BUFR tables will be under <strong>path2</strong>, or <em>under path1 if -DMASTER_TABLE_DIR=path2 is omitted from the above cmake command</em>.</p><p>If Python interoperability is desired, -DENABLE_PYTHON=ON can also be added to the above cmake command. However, version 3 of Python must be installed and available on the system.</p><h3 id="go-back-to-ioda">Go back to IODA</h3><h3 id="obs2ioda-v2.x">obs2ioda-v2.x</h3><p>https://github.com/jamiebresch/obs2ioda/blob/main/obs2ioda-v2/README.md</p><p>NCEP BUFR library (https://github.com/NOAA-EMC/NCEPLIBS-bufr) is required to compile <strong>obs2ioda-v2.x</strong>. Edit <strong>obs2ioda-v2/src/Makefile</strong> to set proper <strong>BUFR_LIB</strong> before make. <del>Here we have pre-build BUFR_LIB on Taiwania-3 and we put the pre-build BUFR_LIB path in Makefile.</del> We have to build one as above and put the build BUFR_LIB path in Makefile.</p><p>Default Makefile includes,</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#--------------</span><br><span class="hljs-comment">#INTEL compiler</span><br><span class="hljs-comment">#--------------</span><br>FC = ifort<br><span class="hljs-comment">#BUFR_LIB = -L/glade/u/home/hclin/extlib/intel -lbufr</span><br><span class="hljs-comment">#FFLAGS = -mcmodel medium # needed for intel error message &quot;failed to convert GOTPCREL relocation&quot;</span><br>BUFR_LIB = -L/glade/campaign/mmm/parc/ivette/pandac/converters/WRFDA_3DVAR_dmpar/var/external/bufr -lbufr<br>FFLAGS = -mcmodel medium <span class="hljs-comment"># needed for intel error message &quot;failed to convert GOTPCREL relocation&quot; # -g -traceback -debug all -check all</span><br><br>LIBS = -L$(NETCDF)/lib -lnetcdff -lnetcdf <span class="hljs-variable">$&#123;BUFR_LIB&#125;</span><br>INCS = -I$(NETCDF)/include<br>```   <br><br><span class="hljs-keyword">then</span>,<br><br>```sh<br>BUFR_LIB = -L/home/wpsze/mpas_jedi_tutorial/NCEPLIBS-bufr/build/lib -lbufr<br><span class="hljs-built_in">export</span> NETCDF=/home/wpsze/spack-stack/envs/jedi_gcc_linux/install/gcc/9.4.0/netcdf-fortran-4.6.0-gwqak4i/<br><span class="hljs-built_in">export</span> NETCDF=/home/wpsze/micromamba/envs/obs2ioda/x86_64-conda-linux-gnu/<br></code></pre></td></tr></table></figure><p>Then compile the converter by using make command:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ <span class="hljs-built_in">cd</span> obs2ioda/obs2ioda-v2/src/<br>$ make<br><span class="hljs-comment"># $ make clean</span><br></code></pre></td></tr></table></figure><p>If the compilation is successful, the executable file <strong>obs2ioda-v2.x</strong> will be generated.</p><h4 id="error-1">Error 1</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh">hsd.f90:306:11:<br><br>  306 |       <span class="hljs-keyword">if</span> ( fexist(ij) == .<span class="hljs-literal">false</span>. ) <span class="hljs-keyword">then</span><br>      |           1<br>Error: Logicals at (1) must be compared with .eqv. instead of ==<br>make: *** [Makefile:67: hsd.o] Error 1<br></code></pre></td></tr></table></figure><p>check, and then replace with "eqv"</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ grep -rin <span class="hljs-string">&quot;==&quot;</span> hsd.f90 <br>306:      <span class="hljs-keyword">if</span> ( fexist(ij) == .<span class="hljs-literal">false</span>. ) <span class="hljs-keyword">then</span><br>...<br></code></pre></td></tr></table></figure><p>to</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"> $ grep -rin <span class="hljs-string">&quot;eqv&quot;</span> hsd.f90 <br>306:      <span class="hljs-keyword">if</span> ( fexist(ij) .eqv. .<span class="hljs-literal">false</span>. ) <span class="hljs-keyword">then</span><br></code></pre></td></tr></table></figure><h4 id="error-2">Error 2</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">/usr/bin/ld: cannot find -lbufr<br>collect2: error: ld returned 1 <span class="hljs-built_in">exit</span> status<br>make: *** [Makefile:46: obs2ioda] Error 1<br></code></pre></td></tr></table></figure><p>check,</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">NCEPLIBS-bufr/build/include/ is bufr_4<br>NCEPLIBS-bufr/build/lib/ is libbufr_4.a<br></code></pre></td></tr></table></figure><h4 id="error-3">Error 3</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">/usr/bin/ld: warning: libnetcdf.so.19, needed by /home/wpsze/spack-stack/envs/jedi_gcc_linux/install/gcc/9.4.0/netcdf-fortran-4.6.0-gwqak4i/lib/libnetcdff.so, may conflict with libnetcdf.so.15<br></code></pre></td></tr></table></figure><p>Export,</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">export</span> NETCDF=/home/wpsze/spack-stack/envs/jedi_gcc_linux/install/gcc/9.4.0/netcdf-c-4.9.2-yhizvd3/<br><span class="hljs-built_in">export</span> NETCDFF=/home/wpsze/spack-stack/envs/jedi_gcc_linux/install/gcc/9.4.0/netcdf-fortran-4.6.0-gwqak4i/<br></code></pre></td></tr></table></figure><p>and, modify in Makefile</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">LIBS = -L$(NETCDF)/lib -L$(NETCDFF)/lib -lnetcdff -lnetcdf <span class="hljs-variable">$&#123;BUFR_LIB&#125;</span><br>INCS = -I$(NETCDF)/include -I$(NETCDFF)/include<br></code></pre></td></tr></table></figure><h4 id="error-4">Error 4</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs sh">hsd.o: <span class="hljs-keyword">in</span> <span class="hljs-keyword">function</span> `__ahi_hsd_mod_MOD_hisd_radiance_to_tbb<span class="hljs-string">&#x27;:</span><br><span class="hljs-string">hsd.f90:(.text+0x19ed): relocation truncated to fit: R_X86_64_PC32 against symbol `__ahi_hsd_mod_MOD_header&#x27;</span> defined <span class="hljs-keyword">in</span> .bss section <span class="hljs-keyword">in</span> hsd.o<br>hsd.f90:(.text+0x1a06): relocation truncated to fit: R_X86_64_PC32 against symbol `__ahi_hsd_mod_MOD_header<span class="hljs-string">&#x27; defined in .bss section in hsd.o</span><br><span class="hljs-string">hsd.f90:(.text+0x1a1a): relocation truncated to fit: R_X86_64_PC32 against symbol `__ahi_hsd_mod_MOD_header&#x27;</span> defined <span class="hljs-keyword">in</span> .bss section <span class="hljs-keyword">in</span> hsd.o<br>hsd.f90:(.text+0x1a50): relocation truncated to fit: R_X86_64_PC32 against symbol `__ahi_hsd_mod_MOD_header<span class="hljs-string">&#x27; defined in .bss section in hsd.o</span><br><span class="hljs-string">hsd.f90:(.text+0x1a58): relocation truncated to fit: R_X86_64_PC32 against symbol `__ahi_hsd_mod_MOD_header&#x27;</span> defined <span class="hljs-keyword">in</span> .bss section <span class="hljs-keyword">in</span> hsd.o<br>hsd.f90:(.text+0x1a64): relocation truncated to fit: R_X86_64_PC32 against symbol `__ahi_hsd_mod_MOD_header<span class="hljs-string">&#x27; defined in .bss section in hsd.o</span><br><span class="hljs-string">hsd.f90:(.text+0x1ad1): relocation truncated to fit: R_X86_64_PC32 against symbol `__ahi_hsd_mod_MOD_header&#x27;</span> defined <span class="hljs-keyword">in</span> .bss section <span class="hljs-keyword">in</span> hsd.o<br>hsd.f90:(.text+0x1ad9): relocation truncated to fit: R_X86_64_PC32 against symbol `__ahi_hsd_mod_MOD_header<span class="hljs-string">&#x27; defined in .bss section in hsd.o</span><br><span class="hljs-string">hsd.f90:(.text+0x1aea): relocation truncated to fit: R_X86_64_PC32 against symbol `__ahi_hsd_mod_MOD_header&#x27;</span> defined <span class="hljs-keyword">in</span> .bss section <span class="hljs-keyword">in</span> hsd.o<br>hsd.o: <span class="hljs-keyword">in</span> <span class="hljs-keyword">function</span> `__ahi_hsd_mod_MOD_pixlin_to_lonlat<span class="hljs-string">&#x27;:</span><br><span class="hljs-string">hsd.f90:(.text+0x1eca): relocation truncated to fit: R_X86_64_PC32 against symbol `__ahi_hsd_mod_MOD_header&#x27;</span> defined <span class="hljs-keyword">in</span> .bss section <span class="hljs-keyword">in</span> hsd.o<br>hsd.f90:(.text+0x1eed): additional relocation overflows omitted from the output<br>/usr/bin/ld: failed to convert GOTPCREL relocation; relink with --no-relax<br>collect2: error: ld returned 1 <span class="hljs-built_in">exit</span> status<br>make: *** [Makefile:46: obs2ioda] Error 1<br></code></pre></td></tr></table></figure><p>We use gfortran, <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#------------</span><br><span class="hljs-comment">#GNU compiler</span><br><span class="hljs-comment">#------------</span><br>FC = gfortran<br>BUFR_LIB = -L/home/wpsze/mpas_jedi_tutorial/NCEPLIBS-bufr/build/lib -lbufr_4<br><br>FFLAGS = -ffree-line-length-none -mcmodel=medium <br></code></pre></td></tr></table></figure></p><h3 id="finally-modified-makefile">Finally, modified Makefile</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#! /bin/sh -v</span><br><br><span class="hljs-comment">#------------</span><br><span class="hljs-comment">#GNU compiler</span><br><span class="hljs-comment">#------------</span><br>FC = gfortran<br>BUFR_LIB = -L/home/wpsze/mpas_jedi_tutorial/NCEPLIBS-bufr/build/lib -lbufr_4<br><br>FFLAGS = -ffree-line-length-none -mcmodel=medium <span class="hljs-comment">#-fbacktrace -ggdb -fcheck=bounds,do,mem,pointer -ffpe-trap=invalid,zero,overflow</span><br><br><span class="hljs-comment">#GNU10 = -fallow-argument-mismatch -fallow-invalid-boz</span><br><span class="hljs-comment">#FFLAGS = -mcmodel=medium -fpic -ffree-line-length-none $&#123;GNU10&#125; -fbacktrace -ggdb -fcheck=bounds,do,mem,pointer -ffpe-trap=invalid,zero,overflow</span><br><br><span class="hljs-comment">#GNU10 = #-fallow-argument-mismatch -fallow-invalid-boz</span><br><span class="hljs-comment">#FFLAGS = -ffree-line-length-none $&#123;GNU10&#125; #-fbacktrace -ggdb -fcheck=bounds,do,mem,pointer -ffpe-trap=invalid,zero,overflow</span><br><br><span class="hljs-comment">#--------------</span><br><span class="hljs-comment">#INTEL compiler</span><br><span class="hljs-comment">#--------------</span><br><span class="hljs-comment">#FC = ifort</span><br><span class="hljs-comment">#BUFR_LIB = -L/glade/u/home/hclin/extlib/intel -lbufr</span><br><span class="hljs-comment">#FFLAGS = -mcmodel medium # needed for intel error message &quot;failed to convert GOTPCREL relocation&quot;</span><br><span class="hljs-comment">#BUFR_LIB = -L/home/wpsze/mpas_jedi_tutorial/NCEPLIBS-bufr/build/lib -lbufr</span><br><span class="hljs-comment">#FFLAGS = -mcmodel medium # needed for intel error message &quot;failed to convert GOTPCREL relocation&quot; # -g -traceback -debug all -check all</span><br><br>LIBS = -L$(NETCDF)/lib -L$(NETCDFF)/lib -lnetcdff -lnetcdf <span class="hljs-variable">$&#123;BUFR_LIB&#125;</span><br>INCS = -I$(NETCDF)/include -I$(NETCDFF)/include<br></code></pre></td></tr></table></figure><h1 id="jedi-mpas-test-and-application-files">JEDI-MPAS Test and Application Files</h1><p>https://gdex.ucar.edu/dataset/147b_jcsda.html</p><p>JEDI-MPAS is the interface between the generic components of the Joint Effort for Data assimilation Integration (JEDI) system and the atmospheric core of the Model for Prediction Across Scales (MPAS). The JEDI software package is a unified, innovative data assimilation system for Earth System Prediction. Developed and distributed by UCP’s Joint Center for Satellite Data Assimilation (JCSDA), JEDI is versatile and sophisticated enough for a variety of applications, from operational weather forecasting and atmospheric research on High Performance Computing (HPC), to learning the fundamentals of data assimilation by running idealized toy models on your laptop. The atmospheric component of MPAS is a non-hydrostatic model using an unstructured centroidal Voronoi mesh with smoothly varying resolution for global or regional domains. The primary development partners for MPAS are Los Alamos National Laboratory and the National Center for Atmospheric Research.</p><p>This data set provides example observation files, model backgrounds, and other input files needed to run a variety of JEDI-MPAS applications, including the comprehensive suite of unit tests and example activities that are described in online tutorials. This data set accompanies JEDI-MPAS, version 1.0.0, released 24 September 20.</p><blockquote><p>Wget shell script - Download all files using Wget, preferred for Linux.</p></blockquote><h1 id="specific-issue-cluster">Specific Issue (cluster)</h1><blockquote><p>git-lfs issue Ran patch() for krb5 &amp; error while opening "en_US.mo" for writing: Permission denied</p></blockquote><p>If copy whole <strong>mpas_bundle_v2</strong> (e.g. local PC) that includes <strong>build</strong> and <strong>code</strong> to workstation or cluster,</p><ol type="1"><li>if your workstation/cluster has spack-stack (for jedi-mpas)</li><li>remove build/CMakeCache.txt</li><li>remove build/_deps/mpas_data-subbuild/CMakeCache.txt</li><li>run $ cmake ../code</li><li>it will re-generate your curren config</li></ol><p>Reference error: <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">CMake Error: The current CMakeCache.txt directory /xxx/mpas_bundle_v2_temp/build/CMakeCache.txt is different than the directory /home/wpsze/mpas_bundle_v2/build <span class="hljs-built_in">where</span> CMakeCache.txt was created. This may result <span class="hljs-keyword">in</span> binaries being created <span class="hljs-keyword">in</span> the wrong place. If you are not sure, reedit the CMakeCache.txt<br>CMake Error: The <span class="hljs-built_in">source</span> <span class="hljs-string">&quot;/EM/wpsze/cpas/CPAS-MPAS-JEDI/DA-obs2ioda-EM/mpas_bundle_v2_temp/code/CMakeLists.txt&quot;</span> does not match the <span class="hljs-built_in">source</span> <span class="hljs-string">&quot;/home/wpsze/mpas_bundle_v2/code/CMakeLists.txt&quot;</span> used to generate cache.  Re-run cmake with a different <span class="hljs-built_in">source</span> directory.<br>CMake Error: The current CMakeCache.txt directory /xxx/mpas_bundle_v2_temp/build/_deps/mpas_data-subbuild/CMakeCache.txt is different than the directory /home/wpsze/mpas_bundle_v2/build/_deps/mpas_data-subbuild <span class="hljs-built_in">where</span> CMakeCache.txt was created. This may result <span class="hljs-keyword">in</span> binaries being created <span class="hljs-keyword">in</span> the wrong place. If you are not sure, reedit the CMakeCache.txt<br></code></pre></td></tr></table></figure></p><ol type="1"><li><p>config done <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">-- Configuring <span class="hljs-keyword">done</span><br>-- Generating <span class="hljs-keyword">done</span><br>-- Build files have been written to: /xxx/mpas_bundle_v2_temp/build<br></code></pre></td></tr></table></figure></p></li><li><p>make -j12 <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">[100%] Built target mpasjedi_variational.x<br></code></pre></td></tr></table></figure></p></li><li><p>cd mpas-jedi &amp; ctest <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs sh">74% tests passed, 12 tests failed out of 47<br><br>Label Time Summary:<br>executable    =  42.47 sec*proc (13 tests)<br>mpasjedi      = 680.81 sec*proc (47 tests)<br>mpi           = 672.80 sec*proc (43 tests)<br>script        = 638.33 sec*proc (34 tests)<br><br>Total Test time (real) = 683.12 sec<br><br>The following tests FAILED:<br> 23 - test_mpasjedi_parameters_bumpcov (Failed)<br> 24 - test_mpasjedi_parameters_bumploc (Failed)<br> 25 - test_mpasjedi_dirac_bumpcov (Failed)<br> 29 - test_mpasjedi_3dvar_bumpcov (Failed)<br> 35 - test_mpasjedi_3dhybrid_bumpcov_bumploc (Failed)<br> 39 - test_mpasjedi_eda_3dhybrid (Failed)<br> 41 - test_mpasjedi_letkf_3dloc_4pe (Failed)<br> 42 - test_mpasjedi_lgetkf_4pe (Failed)<br> 44 - test_mpasjedi_parameters_bumpcov_2pe (Failed)<br> 45 - test_mpasjedi_parameters_bumploc_2pe (Failed)<br> 46 - test_mpasjedi_3dvar_2pe (Failed)<br> 47 - test_mpasjedi_3dhybrid_bumpcov_bumploc_2pe (Failed)<br>Errors <span class="hljs-keyword">while</span> running CTest<br>Output from these tests are <span class="hljs-keyword">in</span>: /xxx/build/mpas-jedi/Testing/Temporary/LastTest.<span class="hljs-built_in">log</span><br>Use <span class="hljs-string">&quot;--rerun-failed --output-on-failure&quot;</span> to re-run the failed cases verbosely.<br></code></pre></td></tr></table></figure></p></li></ol><h1 id="if-git-lfs-exists">if git-lfs exists,</h1><p>Assume your workstation or cluster already has git-lfs, then may skip the error on it. Try below,</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">set</span> -v<br><span class="hljs-built_in">source</span> /home/wpsze/spack/share/spack/setup-env.sh<br><span class="hljs-built_in">source</span> /home/wpsze/spack-stack/spack-stack/setup.sh<br><br>spack stack create <span class="hljs-built_in">env</span> --site linux.default --name gcc_mpich<br><br>spack <span class="hljs-built_in">env</span> activate /home/wpsze/spack-stack/spack-stack/envs/gcc_mpich<br>spack add gcc@10.5.0<br>spack install<br>spack compiler add `spack location -i gcc@10.5.0`<br><br>spack add environment-modules%gcc@10.5.0 ecbuild%gcc@10.5.0 eigen%gcc@10.5.0 udunits%gcc@10.5.0 gsl-lite%gcc@10.5.0<br>spack add mpich%gcc@10.5.0<br>spack add hdf5%gcc@10.5.0^mpich parallelio%gcc@10.5.0^mpich <br><br><span class="hljs-comment"># Tried atlas v0.31.1 can make successful compilation. Newer version like 0.35.0 fails.</span><br>spack add ecmwf-atlas@0.31.1%gcc@10.5.0^mpich<br>spack install<br>spack module tcl refresh<br><span class="hljs-comment">#spack stack setup-meta-modules</span><br></code></pre></td></tr></table></figure><h1 id="module-load">module load</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-function"><span class="hljs-title">module</span></span> () &#123;<br>  <span class="hljs-built_in">eval</span> $(<span class="hljs-variable">$&#123;SPACK_ENV&#125;</span>/install/gcc/x.x.x/environment-modules-xxx/bin/modulecmd bash <span class="hljs-variable">$@</span>)<br>&#125;<br><br>module load xxx<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Spack</category>
      
    </categories>
    
    
    <tags>
      
      <tag>MPAS</tag>
      
      <tag>DA</tag>
      
      <tag>Spack</tag>
      
      <tag>Spack-Stack</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ecFlow -- Installation &amp; Usage</title>
    <link href="/2024/06/07/ecflow_by_spack/"/>
    <url>/2024/06/07/ecflow_by_spack/</url>
    
    <content type="html"><![CDATA[<h1 id="using-spack">Using Spack</h1><p>Spack is a package management tool designed to support multiple versions and configurations of software on a wide variety of platforms and environments. It was designed for large supercomputing centers, where many users and application teams share common installations of software on clusters with exotic architectures, using libraries that do not have a standard ABI. Spack is non-destructive: installing a new version does not break existing installations, so many configurations can coexist on the same system. Most importantly, Spack is simple. It offers a simple spec syntax so that users can specify versions and configuration options concisely. Spack is also simple for package authors: package files are written in pure Python, and specs allow package authors to maintain a single file for many different builds of the same package.</p><p><a href="https://spack.readthedocs.io/en/latest/" class="uri">https://spack.readthedocs.io/en/latest/</a></p><h2 id="search-packages-online">Search packages online</h2><blockquote><p><a href="https://packages.spack.io/" class="uri">https://packages.spack.io/</a> <a href="https://packages.spack.io/package.html?name=ecflow" class="uri">https://packages.spack.io/package.html?name=ecflow</a></p></blockquote><h1 id="install-dont-use-spack">Install (don't use spack)</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ spack <span class="hljs-built_in">env</span> create ecFlow <br>$ spack <span class="hljs-built_in">env</span> activate ecFlow<br>$ spack info --all ecflow<br></code></pre></td></tr></table></figure><p>shows,</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs sh"> $ spack info --all ecflow<br>CMakePackage:   ecflow<br><br>Description:<br>    ecFlow is a work flow package that enables <span class="hljs-built_in">users</span> to run a large number<br>    of programs (with dependencies on each other and on time) <span class="hljs-keyword">in</span> a<br>    controlled environment. It provides tolerance <span class="hljs-keyword">for</span> hardware and software<br>    failures, combined with good restart capabilities.<br><br>Homepage: https://confluence.ecmwf.int/display/ECFLOW/<br><br>Maintainers: @AlexanderRichert-NOAA @climbfuji<br><br>Externally Detectable: <br>    False<br><br>Tags: <br>    None<br><br>Preferred version:  <br>    5.11.4    https://confluence.ecmwf.int/download/attachments/8650755/ecFlow-5.11.4-Source.tar.gz<br><br>Safe versions:  <br>    5.11.4    https://confluence.ecmwf.int/download/attachments/8650755/ecFlow-5.11.4-Source.tar.gz<br>    5.8.4     https://confluence.ecmwf.int/download/attachments/8650755/ecFlow-5.8.4-Source.tar.gz<br>    5.8.3     https://confluence.ecmwf.int/download/attachments/8650755/ecFlow-5.8.3-Source.tar.gz<br>    4.13.0    https://confluence.ecmwf.int/download/attachments/8650755/ecFlow-4.13.0-Source.tar.gz<br>    4.12.0    https://confluence.ecmwf.int/download/attachments/8650755/ecFlow-4.12.0-Source.tar.gz<br>    4.11.1    https://confluence.ecmwf.int/download/attachments/8650755/ecFlow-4.11.1-Source.tar.gz<br></code></pre></td></tr></table></figure><p>then, install,</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ spack install --add ecflow@5.11.4<br></code></pre></td></tr></table></figure><p>check version,</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ ecflow_client --version<br></code></pre></td></tr></table></figure><p>To uninstall a package, type spack uninstall package. This will ask the user for confirmation before completely removing the directory in which the package was installed.</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">spack uninstall --dependents ecflow@5.11.4<br></code></pre></td></tr></table></figure><h1 id="error">Error</h1><p>Not successful.</p><ul><li><a href="https://github.com/spack/spack/issues/44116">Installation issue: ecflow@5.11.4 with boost@1.85.0 #44116</a></li><li><a href="https://github.com/spack/spack/pull/44181">Bug fix for ecflow: versions up to 5.11.4 require boost 1.84 or earlier #44181</a></li><li><a href="https://github.com/JCSDA/spack/pull/432">Merge spack develop as of 2024/05/09 into spack-stack-dev #432</a></li></ul><h2 id="try-with-boost1.84.0">Try with boost@1.84.0</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs sh"> $ spack install --add ecflow%gcc ^boost@1.84.0<br>==&gt; Concretized ecflow%gcc ^boost@1.84.0<br>......<br>==&gt; Installing boost-1.84.0-7awv37536onadsx3urg2sfra7hippfov [29/33]<br>==&gt; No binary <span class="hljs-keyword">for</span> boost-1.84.0-7awv37536onadsx3urg2sfra7hippfov found: installing from <span class="hljs-built_in">source</span><br>==&gt; Using cached archive: //wpsze/spack/var/spack/cache/_source-cache/archive/cc/cc4b893acf645c9d4b698e9a0f08ca8846aa5d6c68275c14c3e7949c24109454.tar.bz2<br>==&gt; Applied patch //wpsze/spack/var/spack/repos/builtin/packages/boost/python_jam-1_77.patch<br>==&gt; Applied patch //wpsze/spack/var/spack/repos/builtin/packages/boost/bootstrap-compiler.patch<br>==&gt; Ran patch() <span class="hljs-keyword">for</span> boost<br>==&gt; boost: Executing phase: <span class="hljs-string">&#x27;install&#x27;</span><br>==&gt; boost: Successfully installed boost-1.84.0-7awv37536onadsx3urg2sfra7hippfov<br>  Stage: 29.98s.  Install: 2m 23.30s.  Post-install: 1m 8.91s.  Total: 4m 6.00s<br>[+] //wpsze/spack/opt/spack/linux-rocky8-haswell/gcc-8.5.0/boost-1.84.0-7awv37536onadsx3urg2sfra7hippfov<br>[+] //wpsze/spack/opt/spack/linux-rocky8-haswell/gcc-8.5.0/py-pip-23.1.2-7d22lvklf5zxutex5ggyhxp3oxpqhzai<br>[+] //wpsze/spack/opt/spack/linux-rocky8-haswell/gcc-8.5.0/py-setuptools-69.2.0-axw5axor273y224weubpqloritokktqx<br>[+] //wpsze/spack/opt/spack/linux-rocky8-haswell/gcc-8.5.0/py-numpy-1.26.4-3vq4eb6gkjjmc3i2pzn4y4pjqscg5bys<br>==&gt; Installing ecflow-5.11.4-4chvjzr5j33mtu5m3effo7lugzwskirx [33/33]<br>==&gt; No binary <span class="hljs-keyword">for</span> ecflow-5.11.4-4chvjzr5j33mtu5m3effo7lugzwskirx found: installing from <span class="hljs-built_in">source</span><br>==&gt; Using cached archive: //wpsze/spack/var/spack/cache/_source-cache/archive/48/4836a876277c9a65a47a3dc87cae116c3009699f8a25bab4e3afabf160bcf212.tar.gz<br>==&gt; Applied patch //wpsze/spack/var/spack/repos/builtin/packages/ecflow/ctsapi_cassert.patch<br>==&gt; ecflow: Executing phase: <span class="hljs-string">&#x27;cmake&#x27;</span><br>==&gt; ecflow: Executing phase: <span class="hljs-string">&#x27;build&#x27;</span><br>==&gt; ecflow: Executing phase: <span class="hljs-string">&#x27;install&#x27;</span><br>==&gt; ecflow: Successfully installed ecflow-5.11.4-4chvjzr5j33mtu5m3effo7lugzwskirx<br>  Stage: 1.25s.  Cmake: 19.16s.  Build: 3m 47.02s.  Install: 4.49s.  Post-install: 1.60s.  Total: 4m 20.25s<br>[+] //wpsze/spack/opt/spack/linux-rocky8-haswell/gcc-8.5.0/ecflow-5.11.4-4chvjzr5j33mtu5m3effo7lugzwskirx<br>==&gt; Updating view at //wpsze/spack/var/spack/environments/ecFlow/.spack-env/view<br></code></pre></td></tr></table></figure><p><strong>done</strong> and check,</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"> $ ecflow_client --version<br>Ecflow version(5.11.4) boost(1.84.0) compiler(gcc 8.5.0) protocol(JSON cereal 1.3.0) openssl(enabled) Compiled on Jun 10 2024 00:11:14<br></code></pre></td></tr></table></figure><h1 id="by-micromamba">By micromamba *****</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ micromamba create -n ecFlow<br>Empty environment created at prefix: /home/wpsze/micromamba/envs/ecFlow<br>$ micromamba activate ecFlow<br>|ecFlow|wpsze:/home/wpsze $ micromamba install ecflow -c conda-forge<br>|ecFlow|wpsze:/home/wpsze $ ecflow_client --version<br>Ecflow version(5.13.0) boost(1.84.0) compiler(gcc 12.3.0) protocol(JSON cereal 1.3.0) openssl(enabled) Compiled on Jun 20 2024 08:28:01<br><br> $ ecf*<br>ecflow_client        ecflow_http          ecflow_logsvr.pl     ecflow_standalone    ecflow_stop.sh       <br>ecflow_udp_client    ecflow_ui.x<br>ecflow_fuse.py       ecflow_logserver.sh  ecflow_server        <br>ecflow_start.sh      ecflow_udp           ecflow_ui<br></code></pre></td></tr></table></figure><p>and it installs,</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">+ libboost-python                  1.84.0  py312h389efb2_3      conda-forge      124kB<br>+ libboost-python-devel            1.84.0  py312h9cebb41_3      conda-forge       20kB<br>+ ecflow                           5.13.0  py312hc3ad225_0      conda-forge       17MB<br></code></pre></td></tr></table></figure><p>where boost is 1.84.0</p><h1 id="ecflow-quickstart">ecFlow Quickstart</h1><p><a href="https://confluence.ecmwf.int/display/ECFLOW/ecFlow+Quickstart">ecFlow Quickstart</a></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs sh"> $ ll ./ecflow_quickstart  <br>total 160K<br>drwxrwxr-x 3 wpsze wpsze  33K Jun  7 22:06 ./<br>drwxrwxr-x 3 wpsze wpsze  33K Jun  7 22:06 ../<br>-rw-rw-r-- 1 wpsze wpsze 2.4K Jun  7 17:51 ecflow_quickstart.tar.gz<br>-rw-r--r-- 1 wpsze wpsze 1.8K Nov  2  2022 head.h<br>-rw-r--r-- 1 wpsze wpsze  760 Nov  2  2022 instructions.txt<br>-rw-r--r-- 1 wpsze wpsze  209 Nov  1  2022 tail.h<br>drwxr-xr-x 2 wpsze wpsze  33K Nov  2  2022 <span class="hljs-built_in">test</span>/<br>-rw-r--r-- 1 wpsze wpsze  222 Nov  2  2022 test.def<br><br> $ ll <span class="hljs-built_in">test</span><br>total 165K<br>drwxr-xr-x 2 wpsze wpsze  33K Nov  2  2022 ./<br>drwxrwxr-x 3 wpsze wpsze  33K Jun  7 22:06 ../<br>-rw-r--r-- 1 wpsze wpsze  627 Nov  2  2022 t1.1<br>-rw-r--r-- 1 wpsze wpsze  877 Nov  2  2022 t1.2<br>-rw-r--r-- 1 wpsze wpsze  119 Nov  2  2022 t1.ecf<br>-rwxr-xr-x 1 wpsze wpsze 2.1K Nov  2  2022 t1.job1*<br>-rwxr-xr-x 1 wpsze wpsze 2.1K Nov  2  2022 t1.job2*<br>-rw-r--r-- 1 wpsze wpsze  627 Nov  2  2022 t2.1<br>-rw-r--r-- 1 wpsze wpsze  118 Nov  2  2022 t2.ecf<br>-rwxr-xr-x 1 wpsze wpsze 2.1K Nov  2  2022 t2.job1*<br><br> $ <span class="hljs-built_in">cat</span> <span class="hljs-built_in">test</span>/t1.ecf <br>%include <span class="hljs-string">&quot;../head.h&quot;</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;I, %ECF_NAME%, am part of a suite that lives in %ECF_HOME%&quot;</span><br><span class="hljs-built_in">sleep</span> 2<br><br>%include <span class="hljs-string">&quot;../tail.h&quot;</span><br><br> $ <span class="hljs-built_in">cat</span> <span class="hljs-built_in">test</span>/t2.ecf <br>%include <span class="hljs-string">&quot;../head.h&quot;</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;I, %ECF_NAME%, am part of a suite that lives in %ECF_HOME%&quot;</span><br><span class="hljs-built_in">sleep</span> 2<br><br>%include <span class="hljs-string">&quot;../tail.h&quot;</span><br></code></pre></td></tr></table></figure><h2 id="inspect-and-update-the-suite-definition">Inspect and update the suite definition</h2><p>The file <strong>test.def</strong> defines a suite called "test". Open this file in a text editor and note the structure.</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh">suite <span class="hljs-built_in">test</span><br>   edit ECF_HOME <span class="hljs-string">&quot;/replace/with/own/home/ecflow/quickstart&quot;</span><br>   task t1<br>   task t2<br>        trigger t1 eq complete<br>endsuite<br></code></pre></td></tr></table></figure><p>We define a suite called "test"; it defines a variable called <strong>ECF_HOME</strong>, then it defines two tasks <strong>("tasks" are things that actually run)</strong> and specifies that <strong>task t2 will be run as soon as task t1 has completed</strong>. The scripts corresponding to the tasks are specified in <strong>".ecf"</strong> files in the test directory. Have a look - they simply print some information about themselves, then sleep for 2 seconds.</p><p>The first thing you must do is to complete the path to your working directory in the <strong>ECF_HOME</strong> definition in test.def and save the file.</p><h2 id="start-an-ecflow-server">Start an ecFlow server</h2><p>We will start a <strong>new running instance of an ecFlow server using the default port (# start ecFlow with default port 3141)</strong>. It is possible to use a different port by <strong>adding --port=3500 (for example)</strong> to every ecFlow command-line action. Note also that we start it as a background task - it will run until the server is stopped. It can be run in the foreground, but in that case you will need to use a new terminal for any subsequent commands!</p><p>To start the ecflow server:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ ecflow_server &amp;<br>or<br>$ <span class="hljs-built_in">export</span> ECF_PORT=3141<br>$ ecflow_start.sh -d /home/wpsze/xxx -p <span class="hljs-variable">$ECF_PORT</span><br></code></pre></td></tr></table></figure><p><strong>make sure this port can be used</strong> {:.info}</p><h3 id="check-what-port-numbers-are-being-used">check what port numbers are being used</h3><h3 id="netstat--lnptu">netstat -lnptu</h3><p>You can check what port numbers are being used, with netstat: To list all open network ports on your machine, run <strong>netstat -lnptu</strong>. Here is a breakdown of the parameters:</p><p>l - List all listening ports n - Display the numeric IP addresses (i.e., don't do reverse DNS lookups p - List the process name that is attached to that port t - List all TCP connections u - List all UDP connections</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ netstat -lnptu<br>tcp        0      0 0.0.0.0:3141            0.0.0.0:*               LISTEN      169655/ecflow_serve<br></code></pre></td></tr></table></figure><p>Check that it is running:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ ecflow_client --ping --port=3141<br>ping server(localhost:3141) succeeded <span class="hljs-keyword">in</span> 00:00:00.034207  ~34 milliseconds<br></code></pre></td></tr></table></figure><p>or check</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"> $ ps -u wpsze -f | grep ecflow | grep -v grep<br>wpsze    3248171 3700943  0 14:26 pts/6    00:00:00 ecflow_server<br></code></pre></td></tr></table></figure><p>Please note <strong>“Host”</strong> and <strong>“Port Number”</strong> here. Also note that each user must use a unique port number (we recommend using a random number between 2500 and 9999)</p><p>To stop the ecflow server:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">ecflow_stop.sh -p <span class="hljs-variable">$ECF_PORT</span><br></code></pre></td></tr></table></figure><p>e.g.</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sh"> $ ecflow_stop.sh -p 3141<br>Fri Jun 28 08:57:33 UTC 2024<br><br>User <span class="hljs-string">&quot;10004&quot;</span> attempting to stop ecf server on ip:3141<br><br>Checking <span class="hljs-keyword">if</span> the server is running on ip:3141<br>ping server(ip:3141) succeeded <span class="hljs-keyword">in</span> 00:00:00.011797  ~11 milliseconds<br><br>Halting, check pointing and terminating the server<br>[1]+  Done                    ecflow_server<br></code></pre></td></tr></table></figure><p>and then,</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ ps -u wpsze -f | grep ecflow | grep -v grep<br></code></pre></td></tr></table></figure><p>has shown nothing now.</p><h2 id="load-your-suite-definition-into-the-server">Load your suite definition into the server **</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ ecflow_client --load=test.def --port=3141<br></code></pre></td></tr></table></figure><p>More, <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh">ecflow_client --<span class="hljs-built_in">help</span><br>ecflow_client --load=/my/home/fred.def<br>ecflow_client --load=/my/home/exotic.def            <span class="hljs-comment"># will error if suites of same name exists</span><br>ecflow_client --load=/my/home/exotic.def force      <span class="hljs-comment"># overwrite suite&#x27;s of same name in the server</span><br>ecflow_client --load=/my/home/exotic.def check_only <span class="hljs-comment"># Just check, don&#x27;t send to server</span><br>ecflow_client --load=/my/home/exotic.def stats      <span class="hljs-comment"># Show defs statistics, don&#x27;t send to server</span><br>ecflow_client --load=host1.3141.check               <span class="hljs-comment"># Load checkpoint file to the server</span><br>ecflow_client --load=host1.3141.check <span class="hljs-built_in">print</span>         <span class="hljs-comment"># print definition to standard out in defs format</span><br></code></pre></td></tr></table></figure></p><p>Check that it is loaded by asking the server to give you back the suite definition:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ ecflow_client --get --port=3141<br><span class="hljs-comment">#5.11.4</span><br>suite <span class="hljs-built_in">test</span><br>  edit ECF_HOME <span class="hljs-string">&#x27;/EM/wpsze/ecflow/ecflow_quickstart/&#x27;</span><br>  task t1<br>  task t2<br>    trigger t1 eq complete<br>endsuite<br><span class="hljs-comment"># enddef</span><br></code></pre></td></tr></table></figure><h2 id="monitor-and-interact-via-the-gui">Monitor and interact via the GUI</h2><h3 id="start-ecflowui-local-pc">Start ecFlowUI: (Local PC)</h3><p>When opening the ecflow GUI flow for the first time you will need to add your server to the GUI. In the GUI click on <strong>“Servers” and then “Manage servers”</strong>. A new window will appear. Click on <strong>“Add server”. Here you need to add the Name, Host, and Port of your server</strong>. For “Host” and “Port” please refer to the last section of output from the previous step.</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ ecflow_ui &amp;<br></code></pre></td></tr></table></figure><h3 id="ssh-tunnel">ssh tunnel</h3><p>SSH tunneling, or SSH port forwarding, is a method of transporting arbitrary data over an encrypted SSH connection. SSH tunnels allow connections made to a local port (that is, to a port on your own desktop) to be forwarded to a remote machine via a secure channel.</p><p>on local PC terminal, <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ ssh -L 9090:localhost:3141 server.ip<br>$ ssh -NL 9090:localhost:3141 server.ip<br></code></pre></td></tr></table></figure> where local PC's port 9090 to server.ip's port 3141</p><p>and you can set ecflow_ui config, - host=localhost - port=local PC's port 9090</p><h3 id="ecflowui-has-started">ecFlowUI has started</h3><p>Once ecFlowUI has started, you must tell it how to reach your server. Go to the</p><p>Servers → Manage Servers menu, click "Add server", then enter the details of your server. Name can be anything you want - it's for you to identify the server to your self; something like "localtest" would be fine here. Host should in this case be "localhost", and Port should be XXX. The other fields can be left blank, but keep the "Add server to current view" box ticked.</p><p>You should now see your suite loaded into the GUI! To make the server active, right-click on the top-level node representing the server ("localtest in our case) and choose <strong>"Restart"</strong>. Now right-click on the "test" node and <strong>choose "Begin"</strong> to make the suite active. The default behaviour is to only refresh its view of the suite every 60 seconds, so you will need to click the green refresh button at the top every so often to see the progress of the tasks.</p><figure><img src="https://confluence.ecmwf.int/download/attachments/52464709/worddavd23273b6552a14558257676bb73f41be.png?version=1&amp;modificationDate=1448363109499&amp;api=v2" alt="ecflow-ui_Task" /><figcaption>ecflow-ui_Task</figcaption></figure><p>The diagram shows the typical status changes for a Task.</p><h2 id="start">Start</h2><p>At this time, the service is stopped and needs to be started manually.</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-variable">$ecflow_client</span> --begin --host=login05 --port=3141<br></code></pre></td></tr></table></figure><p>Since no triggering mechanism is added, t1 will be executed immediately after the service starts.</p><h2 id="replace-suite">Replace suite</h2><p>Replace the entire suite, <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">ecflow_client --replace=/test test.def --port=3141<br></code></pre></td></tr></table></figure></p><h2 id="check-the-status-of-the-server">check the status of the server</h2><p>To check the status of the server, enter the following unix command <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh">ecflow_client --host=login05 --port=3141 --stats<br>Server statistics<br>   Version                         Ecflow version(5.13.0) boost(1.84.0) compiler(gcc 12.3.0) protocol(JSON cereal 1.3.0) openssl(enabled) Compiled on Jun 20 2024 08:28:01<br>   Status                          RUNNING<br>   Host                            xxx.com<br>   Port                            3141<br>   Up since                        2024-Jul-02 23:44:29<br>......<br></code></pre></td></tr></table></figure> If ecflow_server is in <strong>halted state</strong>, the server needs to be restarted.</p><h2 id="ecflow-variables">ecFlow variables</h2><p><a href="https://confluence.ecmwf.int/display/ECFLOW/ecFlow++variables">ecFlow variables</a></p><blockquote><p>ECF_HOME ECF_INCLUDE ECF_FILES</p></blockquote><h2 id="execute-rerun-requeue">Execute, rerun, requeue</h2><p>In ecflow_ui, it is important to understand the distinction between execute, rerun and re-queue.</p><p>These options are available with the right mouse button over a task.</p><blockquote><p><strong>Execute</strong>: This means run the task immediately. (Hence ignores any dependency that holds the task).</p></blockquote><p>This option preserves the previous output, from the job. You should see output files t1.1, t1.2, t1.3, each time the task is run.</p><blockquote><p><strong>Rerun</strong>: This places the task, back into the queued state.</p></blockquote><p>The task will now honour any dependencies that would hold the job. i.e. time dependencies, limits, triggers, suspend, etc. (You will be introduced to these terms later on in the tutorial) If the task does run, the previous output is preserved.</p><blockquote><p><strong>Re-queue</strong>: This resets the task back to the queued state.</p></blockquote><p>If the task has a default status, this is applied. The task output number is reset, such that the next output will be written to t1.1. This will overwrite any existing output with that extension when the task runs. Any subsequent calls to execute or rerun will now overwrite the output files, t1.2,t1.3 etc.</p><h2 id="add-description">Add description</h2><p>The manual page makes the documentation in the <strong>ecf script</strong> visible in ecflow_ui.</p><p>The description page is the combination of all the text before the directives <strong>%manual</strong> and <strong>%end</strong>. (or create <strong>f1.man</strong>)</p><p>e.g. edit t2.ecf <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sh">%manual<br>   Manual <span class="hljs-keyword">for</span> task t2<br>   Operations: <span class="hljs-keyword">if</span> this task fails, <span class="hljs-built_in">set</span> it to complete and report next working day<br>   Analyst:    Check something ?<br>%end<br> <br>%include &lt;head.h&gt;<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;I am part of a suite that lives in %ECF_HOME%&quot;</span><br>%include &lt;tail.h&gt;<br> <br>%manual<br>   There can be multiple manual pages <span class="hljs-keyword">in</span> the same file.<br>   When viewed they are simply concatenated.<br>%end<br></code></pre></td></tr></table></figure></p><h2 id="familys">familys</h2><p>Tasks can be organized into a tree structure similar to a Unix file system, where <strong>task is like a file</strong> and <strong>family is like a folder</strong>.</p><p>A suite is a family with additional properties (see Dates). <strong>family</strong> can contain other families. Similar to directories, tasks in different families can have the same name.</p><p>Unless a file location is specified, ecFlow assumes that the structure of the suite corresponds to the location of the task file in the file system.</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># Definition of the suite test.</span><br> suite <span class="hljs-built_in">test</span><br>   edit ECF_INCLUDE <span class="hljs-string">&quot;<span class="hljs-variable">$ECF_HOME</span>/course&quot;</span>  <span class="hljs-comment"># replace &#x27;$ECF_HOME&#x27; with the path to your ECF_HOME directory</span><br>   edit ECF_HOME    <span class="hljs-string">&quot;<span class="hljs-variable">$ECF_HOME</span>/course&quot;</span><br>   family f1<br>      task t1<br>      task t2<br>   endfamily<br>endsuite<br></code></pre></td></tr></table></figure><h2 id="time-dependencies">Time Dependencies</h2><p><a href="https://confluence.ecmwf.int/display/ECFLOW/Time+Dependencies">Time Dependencies</a></p><h2 id="time-triggers">Time Triggers</h2><p><a href="https://confluence.ecmwf.int/display/ECFLOW/Time+Triggers">Time Triggers</a></p><h2 id="add-a-cron">Add a Cron</h2><p><a href="https://confluence.ecmwf.int/display/ECFLOW/Add+a+Cron">Add a Cron</a></p><h2 id="repeat-repeat">Repeat *** <a href="https://confluence.ecmwf.int/display/ECFLOW/Repeat">Repeat</a></h2><p>It is sometimes useful to repeat the same task or family several times, looping on a specific value. You can do that by defining a repeat attribute. You can iterate over sequences of:</p><ul><li>strings</li><li>integers</li><li>dates</li></ul><p>A sequence of integers or dates is created by specifying the first and the last element, with an optional increment (the default is one).</p><p>From <strong>ecflow5 we can also loop over an arbitrary list of dates</strong>. <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">repeat datelist YMD 20130101 20130102 20130103 20200101 20190101<br>repeat <span class="hljs-built_in">date</span> YMD 20090331 20121212 1  <span class="hljs-comment"># &lt;start&gt; &lt;end&gt; &lt;increment&gt;</span><br></code></pre></td></tr></table></figure></p><blockquote><p>The following generated variables, are accessible for trigger expressions YMD, YMD_YYYY, YMD_MM, YMD_DD, YMD_DOW,YMD_JULIAN</p></blockquote><p>e.g. <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs sh"><br><span class="hljs-comment"># Definition of the suite test.</span><br>suite <span class="hljs-built_in">test</span><br> edit ECF_INCLUDE <span class="hljs-string">&quot;<span class="hljs-variable">$HOME</span>/course&quot;</span><br> edit ECF_HOME    <span class="hljs-string">&quot;<span class="hljs-variable">$HOME</span>/course&quot;</span><br> family f4<br>     edit SLEEP 2<br>     repeat string NAME a b c d e f<br>     family f5<br>         repeat <span class="hljs-built_in">integer</span> VALUE 1 10<br>         task t1<br>             repeat <span class="hljs-built_in">date</span> DATE 20101230 20110105<br>             label info <span class="hljs-string">&quot;&quot;</span><br>             label <span class="hljs-built_in">date</span> <span class="hljs-string">&quot;&quot;</span><br>     endfamily<br> endfamily<br>endsuite<br></code></pre></td></tr></table></figure></p><p><a href="https://confluence.ecmwf.int/display/ECFLOW/Glossary#term-trigger">repeat &amp; trigger</a></p><p>When we use relative time attributes under a Repeat. They are automatically reset when the repeat loops. Take for example: <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sh">suite <span class="hljs-built_in">test</span><br> edit ECF_HOME    <span class="hljs-string">&quot;<span class="hljs-variable">$HOME</span>/course&quot;</span><br> edit ECF_INCLUDE <span class="hljs-string">&quot;<span class="hljs-variable">$HOME</span>/course&quot;</span><br> edit ECF_FILES <span class="hljs-string">&quot;<span class="hljs-variable">$HOME</span>/course&quot;</span><br>  family hc00<br>    repeat <span class="hljs-built_in">integer</span> HYEAR 1993 2017<br>    task t1<br>    task t2<br>      trigger t1  == complete<br>  endfamily<br>endsuite<br></code></pre></td></tr></table></figure></p><p><strong>Repeat increment</strong></p><p>A repeat under a family node will only increment when all the child nodes are complete.</p><p>In the example above, <strong>once task t1, and t2 are complete</strong>, the repeat integer rep will increment to the next value.</p><h2 id="with-sbatch">with SBATCH</h2><p>sbatch.h <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c++">#SBATCH --qos=%QUEUE%<br>#SBATCH --job-name=%TASK%_%FAMILY1:NOT_DEF%<br>#SBATCH --account=%ACCOUNT%<br>#SBATCH --output=%ECF_JOBOUT%<br>#SBATCH --error=%ECF_JOBOUT%<br>#SBATCH --time=%RQ_TIME%<br></code></pre></td></tr></table></figure></p><h1 id="references">References</h1><ol type="1"><li><a href="https://perillaroc.github.io/ecflow-tutorial-cn/chap01/">ECFLOW教程 2018</a></li><li><strong><a href="https://cemc-ecflow-tutorial-2023.readthedocs.io/zh-cn/latest/">CEMC ecFlow 实战教程 本教程用于 CEMC 2023 培训的 ecFlow 上机实习环节</a></strong></li><li><a href="https://confluence.ecmwf.int/display/ECFLOW/Conda-forge">The latest ecflow is available for Linux and macOS from conda forge</a></li><li><a href="https://git.ecmwf.int/projects/USS">https://git.ecmwf.int/projects/USS</a></li><li><a href="https://confluence.ecmwf.int/display/UDOC/HPC2020%3A+Using+ecFlow">HPC2020: Using ecFlow</a></li><li><a href="http://qxkj.ijournals.cn/qxkj/article/abstract/20190122">基于ECFLOW实现华中区域快速更新-同化预报业务流程</a></li><li><a href="https://mp.weixin.qq.com/s/d17lDCd7f2_hS0S4E1mgTg">ecFlow学习笔记：编译V5.X版本</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>MPAS</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Installation</tag>
      
      <tag>Micromamba</tag>
      
      <tag>Spack</tag>
      
      <tag>ecFlow</tag>
      
      <tag>Conda</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Spack</title>
    <link href="/2024/06/07/spack/"/>
    <url>/2024/06/07/spack/</url>
    
    <content type="html"><![CDATA[<h1 id="spack">Spack</h1><p>Spack is a package management tool designed to support multiple versions and configurations of software on a wide variety of platforms and environments. It was designed for large supercomputing centers, where many users and application teams share common installations of software on clusters with exotic architectures, using libraries that do not have a standard ABI. Spack is non-destructive: installing a new version does not break existing installations, so many configurations can coexist on the same system. Most importantly, Spack is simple. It offers a simple spec syntax so that users can specify versions and configuration options concisely. Spack is also simple for package authors: package files are written in pure Python, and specs allow package authors to maintain a single file for many different builds of the same package.</p><p><a href="https://spack.readthedocs.io/en/latest/" class="uri">https://spack.readthedocs.io/en/latest/</a></p><h2 id="search-packages-online">Search packages online</h2><blockquote><p><a href="https://packages.spack.io/" class="uri">https://packages.spack.io/</a></p></blockquote><h1 id="installation">Installation</h1><p>Getting Spack is easy. You can clone it from the github repository using this command:</p><p>git clone -c feature.manyFiles=true https://github.com/spack/spack.git {:.info}</p><p>This will create a directory called spack.</p><p>Once you have cloned Spack, we recommend sourcing the appropriate script for your shell:</p><p>. spack/share/spack/setup-env.sh {:.info}</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh">For bash/zsh/sh<br>. spack/share/spack/setup-env.sh<br>(add into .bashrc)<br>For tcsh/csh<br><span class="hljs-built_in">source</span> spack/share/spack/setup-env.csh<br></code></pre></td></tr></table></figure><p>Sourcing these files will put the spack command in your PATH, set up your MODULEPATH to use Spack’s packages, and add other useful shell integration for certain commands, environments, and modules. For bash and zsh, it also sets up tab completion.</p><ul><li>spack env create yourEnvironmentName</li><li>spack env activate yourEnvironmentName</li><li>spack env list # You can see a list of your available environments</li><li>spack env status # you can see which environment you are currently<br /></li><li>spack env deactivate</li><li>spack find # to see what packages are installed in the current environment</li><li>spack add python@3.10</li><li>spack add compilerName@compilerVersion</li><li>spack install --add xxx</li><li>compilerPath=$(spack location -i compilerName@compilerVersion)</li><li>spack add python@3.10%gcc@9.5.0 # As a general rule, you should use the same compiler for installing all of your packages within an environment</li><li>spack env remove yourEnvironmentName</li></ul><h1 id="compiler-configuration">Compiler configuration</h1><p>Spack has the ability to build packages with multiple compilers and compiler versions. Compilers can be made available to Spack by specifying them manually in <strong>compilers.yaml</strong> or <strong>packages.yaml</strong>, or automatically by running spack compiler find, but for convenience Spack will automatically detect compilers the first time it needs them.</p><p>You can see which compilers are available to Spack by running</p><p>spack compilers or spack compiler list {:.info}</p><blockquote><p>Any of these compilers can be used to build Spack packages.</p></blockquote><p>spack compiler add {:.info}</p><p>An alias for <strong>spack compiler find</strong>.</p><p>spack compiler find {:.info}</p><p>Lists the compilers currently available to Spack. If you do not see a compiler in this list, but you want to use it with Spack, you can simply run spack compiler find with the path to where the compiler is installed. For example:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ spack compiler find /usr/local/tools/ic-13.0.079<br>==&gt; Added 1 new compiler to ~/.spack/linux/compilers.yaml<br>    intel@13.0.079<br></code></pre></td></tr></table></figure><p>Or you can run spack compiler find with no arguments to force auto-detection. This is useful if you do not know where compilers are installed, but you know that new compilers have been added to your PATH. For example, you might load a module, like this:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ module load gcc/4.9.0<br>$ spack compiler find<br>==&gt; Added 1 new compiler to ~/.spack/linux/compilers.yaml<br>    gcc@4.9.0<br></code></pre></td></tr></table></figure><p>This loads the environment module for gcc-4.9.0 to add it to PATH, and then it adds the compiler to Spack.</p><p>spack compiler info {:.info}</p><p>If you want to see specifics on a particular compiler, you can run spack compiler info on it:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ spack compiler info intel@15<br>intel@15.0.0:<br>  paths:<br>    cc  = /usr/local/bin/icc-15.0.090<br>    cxx = /usr/local/bin/icpc-15.0.090<br>    f77 = /usr/local/bin/ifort-15.0.090<br>    <span class="hljs-built_in">fc</span>  = /usr/local/bin/ifort-15.0.090<br>  modules = []<br>  operating_system = centos6<br></code></pre></td></tr></table></figure><p>This shows which C, C++, and Fortran compilers were detected by Spack. Notice also that we didn’t have to be too specific about the version. We just said intel@15, and information about the only matching Intel compiler was displayed.</p><h2 id="manual-compiler-configuration">Manual compiler configuration</h2><p>If auto-detection fails, you can manually configure a compiler by editing your <strong>~/.spack/<platform>/compilers.yaml file</strong>. You can do this by running <strong>spack config edit compilers</strong>, which will open the file in your favorite editor.</p><h2 id="build-your-own-compiler">Build Your Own Compiler</h2><p>If you are particular about which compiler/version you use, you might wish to have Spack build it for you. For example:</p><blockquote><p>$ spack install gcc@4.9.3</p></blockquote><p>Once that has finished, you will need to add it to your <strong>compilers.yaml</strong> file.</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">spack add gcc@4.9.3<br>spack install<br>spack compiler add `spack location -i gcc@4.9.3`<br></code></pre></td></tr></table></figure><p>You can then set Spack to use it by default by adding the following to your packages.yaml file:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">packages:<br>  all:<br>    compiler: [gcc@4.9.3]<br></code></pre></td></tr></table></figure><h1 id="specs-dependencies">Specs &amp; dependencies</h1><p>We know that <strong>spack install</strong>, <strong>spack uninstall</strong>, and other commands take a package name with an optional version specifier. In Spack, that descriptor is called a spec. Spack uses specs to refer to a particular build configuration (or configurations) of a package. Specs are more than a package name and a version; you can use them to specify the compiler, compiler version, architecture, compile options, and dependency options for a build. In this section, we’ll go over the full syntax of specs.</p><p>Here is an example of a much longer spec than we’ve seen thus far:</p><blockquote><p>mpileaks <span class="citation" data-cites="1.2:1.4">@1.2:1.4</span> %gcc@4.7.5 +debug -qt target=x86_64 ^callpath <span class="citation" data-cites="1.1">@1.1</span> %gcc@4.7.2</p></blockquote><p>If provided to spack install, this will install the mpileaks library at <strong>some version between 1.2 and 1.4 (inclusive)</strong>, built using <strong>gcc at version 4.7.5</strong> for a generic x86_64 architecture, with <strong>debug options enabled</strong>, and <strong>without Qt support</strong>. Additionally, it says to link it with the <strong>callpath library (which it depends on)</strong>, and to <strong>build callpath with gcc 4.7.2</strong>. Most specs will not be as complicated as this one, but this is a good example of what is possible with specs.</p><p>More formally, a spec consists of the following pieces:</p><ul><li>Package name identifier (mpileaks above)</li><li>@ Optional version specifier (<span class="citation" data-cites="1.2:1.4">@1.2:1.4</span>)</li><li>% Optional compiler specifier, with an optional compiler version (gcc or gcc@4.7.3)</li><li>+ or - or ~ Optional variant specifiers (+debug, -qt, or ~qt) for boolean variants. Use ++ or -- or ~~ to propagate variants through the dependencies (++debug, --qt, or ~~qt).</li><li>name=<value> Optional variant specifiers that are not restricted to boolean variants. Use name==<value> to propagate variant through the dependencies.</li><li>name=<value> Optional compiler flag specifiers. Valid flag names are cflags, cxxflags, fflags, cppflags, ldflags, and ldlibs. Use name==<value> to propagate compiler flags through the dependencies.</li><li>target=&lt;value&gt; os=&lt;value&gt; Optional architecture specifier (target=haswell os=CNL10)</li><li>^ Dependency specs (^callpath@1.1)</li></ul><p>套件表示法 @ 開頭表示版本號 % 開頭表示編譯器 ^ 開頭表示依賴項</p><h1 id="spack-load">Spack load</h1><p>There are several different ways to use Spack packages once you have installed them. As you’ve seen, spack packages are installed into long paths with hashes, and you need a way to get them into your path. The easiest way is to use <strong>spack load</strong>, which is described in this section.</p><blockquote><p>spack load mpich %gcc@4.4.7</p></blockquote><h1 id="slurm">Slurm</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/sh</span><br><span class="hljs-comment"># This file is called submit-script.sh</span><br><span class="hljs-comment">#SBATCH --partition=shared       # default &quot;shared&quot;, if not specified</span><br><span class="hljs-comment">#SBATCH --time=0-04:30:00        # run time in days-hh:mm:ss</span><br><span class="hljs-comment">#SBATCH --nodes=1                # require 1 nodes</span><br><span class="hljs-comment">#SBATCH --ntasks-per-node=64     # cpus per node (by default, &quot;ntasks&quot;=&quot;cpus&quot;)</span><br><span class="hljs-comment">#SBATCH --mem-per-cpu=4000       # RAM per node in megabytes</span><br><span class="hljs-comment">#SBATCH --error=job.%J.err</span><br><span class="hljs-comment">#SBATCH --output=job.%J.out</span><br><span class="hljs-comment"># v---Remember to activate your Spack environment!! </span><br>spack <span class="hljs-built_in">env</span> activate yourEnvironmentName<br>srun --mpi=pmix -n 64 /home/username/mpiprogram<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Spack</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Spack</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>WRF | WRF uses Pnetcdf</title>
    <link href="/2024/06/05/WRF-install-pnetcdf/"/>
    <url>/2024/06/05/WRF-install-pnetcdf/</url>
    
    <content type="html"><![CDATA[<h1 id="issue">Issue</h1><p>To Be Tested.</p><h1 id="remark">Remark</h1><ol type="1"><li><p><a href="https://forum.mmm.ucar.edu/threads/parallel-netcdf4-i-o-support-as-opposed-to-pnetcdf.9509/">Parallel Netcdf4 I/O support (as opposed to pnetcdf)</a> &gt; Unfortunately the WRF model is not capable of using parallel I/O. If you are using netCDF-4, you must install it without activating parallel I/O based on HDF5. It is possible to use compression with netcdf-4 and HDF5 (without parallel I/O). See this page for details: https://www2.mmm.ucar.edu/wrf/users/building_netcdf4.html</p></li><li><a href="http://climate-cms.wikis.unsw.edu.au/WRF_Build_with_Parallel_NetCDF_Support">WRF Build with Parallel NetCDF Support</a></li></ol><ul><li>export PNETCDF=/projects/WRF/parallel-netcdf/xxx/ (BASH)</li><li>Configure namelist to use pNetCDF</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sh">In the namelist.input, the following settings support pNetCDF by setting value to 11:<br><br>io_form_boundary<br><br>io_form_history<br><br>io_form_auxinput2<br><br>io_form_auxhist2<br><br>Note that you need <span class="hljs-built_in">set</span> nocolons = .<span class="hljs-literal">true</span>. <span class="hljs-keyword">in</span> the section &amp;time_control of namelist.input<br></code></pre></td></tr></table></figure><ul><li><p>With pNetCDF support:</p><ul><li>Timing for Writing wrfout_d03_2010-02-06_01_00_00 for domain 3: 77.62950 elapsed seconds. Timing for Writing wrfout_d03_2010-02-06_02_00_00 for domain 3: 75.74540 elapsed seconds. Timing for Writing wrfout_d03_2010-02-06_03_00_00 for domain 3: 80.26440 elapsed seconds.</li></ul></li><li>Without pNetCDF support:<ul><li>Timing for Writing wrfout_d03_2010-02-06_01:00:00 for domain 3: 315.81271 elapsed seconds. Timing for Writing wrfout_d03_2010-02-06_02:00:00 for domain 3: 299.80011 elapsed seconds. Timing for Writing wrfout_d03_2010-02-06_03:00:00 for domain 3: 307.18109 elapsed seconds.</li></ul></li></ul>]]></content>
    
    
    <categories>
      
      <category>WRF</category>
      
    </categories>
    
    
    <tags>
      
      <tag>WRF</tag>
      
      <tag>Installation</tag>
      
      <tag>Pnetcdf</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ssh setup</title>
    <link href="/2024/06/05/ssh/"/>
    <url>/2024/06/05/ssh/</url>
    
    <content type="html"><![CDATA[<p><a href="https://en.wikipedia.org/wiki/Secure_Shell">The Secure Shell Protocol (SSH)</a> is a cryptographic network protocol for operating network services securely over an unsecured network. Its most notable applications are remote login and command-line execution.</p><p>SSH was designed for Unix-like operating systems as a replacement for Telnet and unsecured remote Unix shell protocols, such as the Berkeley Remote Shell (rsh) and the related rlogin and rexec protocols, which all use insecure, plaintext methods of authentication, like passwords.</p><p>安全外殼協定（Secure Shell Protocol，簡稱SSH）是一種加密的網路傳輸協定，可在不安全的網路中為網路服務提供安全的傳輸環境[1]。SSH通過在網路中建立安全隧道來實現SSH客戶端與伺服器之間的連線[2]。SSH最常見的用途是遠端登入系統，人們通常利用SSH來傳輸命令列介面和遠端執行命令。SSH使用頻率最高的場合是類Unix系統，但是Windows作業系統也能有限度地使用SSH。2015年，微軟宣布將在未來的作業系統中提供原生SSH協定支援[3]，Windows 10 1803版本已提供OpenSSH工具</p><h1 id="generate-a-key-pair">Generate a key pair</h1><p>In you local PC,</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ ssh-keygen<br>or<br>$ ssh-keygen -t rsa<br></code></pre></td></tr></table></figure><p>where -t rsa option specifies that the type of the key should be RSA. Other choices include DSA, ECDSA, and ED25519. Select the protocol your SSH connection will use.</p><p>and id_rsa/id_rsa.pub are generated on .ssh.</p><ul><li>id_rsa contains the private key.</li><li>id_rsa.pub contains the public key.</li></ul><h1 id="id_rsa.pub">id_rsa.pub</h1><p>Copy id_rsa.pub to remote machine .ssh/authorized_keys</p><h1 id="ssh-login-without-password">ssh login without password</h1><p>In your SSH session with the remote machine, update the permissions of the .ssh directory and authorized_keys file in case they need it:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ <span class="hljs-built_in">chmod</span> 700 ~/.ssh<br>$ <span class="hljs-built_in">chmod</span> 600 ~/.ssh/authorized_keys<br></code></pre></td></tr></table></figure><p>Now, close your connection and your Terminal or Command Prompt. When you reopen it and try to connect to the remote server again from the client where you have your private key saved, you should receive a request to enter the passphrase instead of your username and password.</p><p>Reference: 1. <a href="https://www.strongdm.com/blog/ssh-passwordless-login">How to Set Up SSH Passwordless Login (Step-by-Step Tutorial)</a></p>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ssh</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MPAS | use_mp_re/config_microp_re -- use effective radii computed in mp schemes in RRTMG</title>
    <link href="/2024/06/04/MPAS_config_microp_re/"/>
    <url>/2024/06/04/MPAS_config_microp_re/</url>
    
    <content type="html"><![CDATA[<h1 id="in-wrf">In WRF,</h1><p>WRF Model Version 3.8: UPDATES</p><p>Add a new namelist, use_mp_re, to control the interaction between effective radii computed in some microphysics with RRTMG radiation. {:.info}</p><p>use_mp_re = 1 ! whether to use effective radii computed in mp schemes in RRTMG - 0: do not use; - 1: use effective radii - (The mp schemes that compute effective radii are 3,4,6,7,8,10,14,16,18,24,26,28,50-53,55)</p><h1 id="in-mpas-version-7.0">In MPAS Version 7.0,</h1><p>A fix for the communication of effective radii between the WSM6 and RRTMG schemes when config_microp_re=true. {:.info}</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">var</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;re_cloud&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;real&quot;</span> <span class="hljs-attr">dimensions</span>=<span class="hljs-string">&quot;nVertLevels nCells Time&quot;</span> <span class="hljs-attr">units</span>=<span class="hljs-string">&quot;m&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">description</span>=<span class="hljs-string">&quot;effective radius of cloud water droplets&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">packages</span>=<span class="hljs-string">&quot;mp_thompson_in;mp_wsm6_in&quot;</span>/&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">var</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;re_ice&quot;</span>  <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;real&quot;</span> <span class="hljs-attr">dimensions</span>=<span class="hljs-string">&quot;nVertLevels nCells Time&quot;</span>  <span class="hljs-attr">units</span>=<span class="hljs-string">&quot;m&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">description</span>=<span class="hljs-string">&quot;effective radius of cloud ice crystals&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">packages</span>=<span class="hljs-string">&quot;mp_thompson_in;mp_wsm6_in&quot;</span>/&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">var</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;re_snow&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;real&quot;</span> <span class="hljs-attr">dimensions</span>=<span class="hljs-string">&quot;nVertLevels nCells Time&quot;</span>  <span class="hljs-attr">units</span>=<span class="hljs-string">&quot;m&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">description</span>=<span class="hljs-string">&quot;effective radius of snow crystals&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">packages</span>=<span class="hljs-string">&quot;mp_thompson_in;mp_wsm6_in&quot;</span>/&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">var</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;rre_cloud&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;real&quot;</span> <span class="hljs-attr">dimensions</span>=<span class="hljs-string">&quot;nVertLevels nCells Time&quot;</span> <span class="hljs-attr">units</span>=<span class="hljs-string">&quot;microns&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">description</span>=<span class="hljs-string">&quot;effective radius of cloud water droplets calculated in RRTMG radiation&quot;</span>/&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">var</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;rre_ice&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;real&quot;</span> <span class="hljs-attr">dimensions</span>=<span class="hljs-string">&quot;nVertLevels nCells Time&quot;</span> <span class="hljs-attr">units</span>=<span class="hljs-string">&quot;microns&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">description</span>=<span class="hljs-string">&quot;effective radius of cloud ice crystals calculated in RRTMG radiation&quot;</span>/&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">var</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;rre_snow&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;real&quot;</span> <span class="hljs-attr">dimensions</span>=<span class="hljs-string">&quot;nVertLevels nCells Time&quot;</span> <span class="hljs-attr">units</span>=<span class="hljs-string">&quot;microns&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">description</span>=<span class="hljs-string">&quot;effective radius of snow crystals calculated in RRTMG radiation&quot;</span>/&gt;</span><br></code></pre></td></tr></table></figure><h1 id="references">References</h1><p>1.<a href="https://www2.mmm.ucar.edu/wrf/users/workshops/WS2022/full_presentations/session4.wong.pdf">Comparison of WRF and Regional MPAS: Ensuring Consistent Physics Configurations, 2022</a></p><h1 id="papers">Papers</h1><ol type="1"><li><ol start="1994" type="1"><li>Kiehl, J. T. <a href="https://agupubs.onlinelibrary.wiley.com/doi/abs/10.1029/94JD01117">Sensitivity of a GCM climate simulation to differences in continental versus maritime cloud drop size. Journal of Geophysical Research: Atmospheres, 99(D11), 23107-23115.</a></li></ol></li></ol><p>Extensive observations indicate a distinct difference between maritime and continental effective drop size, <span class="math inline">\(r_e\)</span>, for warm clouds. The latest version of the NCAR Community Climate Model (CCM2) is used to explore the sensitivity of differentiating between continental and maritime <span class="math inline">\(r_e\)</span> on the simulated climate. <strong>The results of this study indicate that the smaller drop size over continents leads to a reduction of surface-absorbed solar radiation from 20 to 60 <span class="math inline">\(W m^{−2}\)</span>. This reduction in surface solar flux leads to a cooling of the continents by up to −3.5 K. The reduction in surface solar flux and temperature also leads to a reduction in latent heat flux and precipitation over land.</strong> In the January simulation, there is a significant shift in tropical precipitation associated with the Australian monsoon. This shift leads to a response in the extra tropical geopotential height field over the western United States. All of these changes reduce biases in the current version of CCM2. {:.info}</p><ol start="2" type="1"><li><ol start="1994" type="1"><li>J.T. Kiehl. <a href="https://ntrs.nasa.gov/api/citations/19960000201/downloads/19960000201.pdf">Cloud Formation and Radiative Modeling in the NCAR CCM2: The Present and Future</a>, National Center for Atmospheric Research, U.S.A.</li></ol></li></ol><p>Although the CCM2 is generally an improvement over CCM1, there are stilt biases in CCM2. These are: (1) northern summer continents that are too warm, (2) excessive precipitation over land, and (3) a weak Northern Hemisphere winter stationary wave pattern in the Pacific Northwest. It is believed that to a large degree these biases are related to cloud properties.</p><p><strong>Observations indicate that over continents the warm cloud'-drop effective radius is approximately 5 <span class="math inline">\(\mu m\)</span>, while over oceans the drop size is more like 10 <span class="math inline">\(\mu m\)</span></strong>. A sensitivity study has been carried out (Kiehl, 1994) where the distinction is made between continental and maritime drop size. This simulation was compared to a control where the effective drop size was set to 10 <span class="math inline">\(\mu m\)</span> everywhere. <strong>The smaller drop size over continents led to higher cloud albedos over land regions. This, in turn, led to less solar radiation absorbed at the surface, which led to a reduction of surface temperature (maximum reduction of around 5 K)</strong>. Furthermore, the latent heat flux over land decreased, which led to a decrease in local precipitation. Thus, adopting a more realistic cloud-drop size for land and ocean led to an improved climate simulation. In January, there was an improvement in the Australian monsoon simulation, with a. displacement of the maximum precipitation in the northeast. This shift in tropical heating led to a shift in the Northern Hemisphere planetary wave structure, which again decreased the known bias in the control model.</p><p>CCM2 employs a prescribFa zonally symmetric in-cloud liquid-water path (Kiehl et al., 1994). Hack and Kiehl (1994) have recently replaced this with a local diagnostic for in-cloud liquid water. This new approach to in-cloud liquid water leads to further improvements in the summer land-surface temperature bias. This approach also vastly improves the shortwave cloud forcing over the North Atlantic storm track region.</p><p>The conclusion of these studies is that improvements in the diagnosis of cloud microphysical properties (drop size and liquid water content) leads to a significant improvement in the simulated climate of CCM2. Future research in the area will focus on implementation of a prognostic formulation for cloud water and ice concentration.</p><ol start="3" type="1"><li>Kiehl, J. T., Hack, J. J., Bonan, G. B., Boville, B. A., Williamson, D. L., &amp; Rasch, P. J. (1998). <a href="https://doi.org/10.1175/1520-0442(1998)011%3C1131:TNCFAR%3E2.0.CO;2">The National Center for Atmospheric Research Community Climate Model: CCM3. Journal of Climate, 11(6), 1131-1149.</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>MPAS</category>
      
    </categories>
    
    
    <tags>
      
      <tag>WRF</tag>
      
      <tag>Parametrization</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>WRF | Error Error Error NoahMP submodule files not populating WRF directories</title>
    <link href="/2024/06/04/WRF_install_Error_NoahMP_submodule_files/"/>
    <url>/2024/06/04/WRF_install_Error_NoahMP_submodule_files/</url>
    
    <content type="html"><![CDATA[<h1 id="issue">Issue</h1><p>While installing latest WRF, encounter</p><blockquote><p>Error Error Error NoahMP submodule files not populating WRF directories</p></blockquote><h2 id="new-in-version-4.4">New in Version 4.4</h2><p>Physics</p><p>The NoahMP code has been moved to an external repository and is linked to WRF repository via a submodule. This submodule is automatically pulled in to build the code during compiling, as long as the compilation is done with internet access. If compiling without internet access, or you are not sure if the computer you are using to compile supports git (git is used during the compiling process to access code in submodule), or in the rare case that one checks out another branch, other than ‘master,’ it may be necessary to issue the following commands while connected to the internet to ensure the submodule is available for compiling.</p><ul><li>git clone https://github.com/wrf-model/WRF.git</li><li>git submodule update --init --recursive</li></ul><p>Or in one command: - git clone --recurse-submodule https://github.com/wrf-model/WRF.git</p><p>After this, it is okay to go offline to compile. In the case you would like to remove code in the submodule, use ‘clean -aa’ instead of ‘clean -a’. <a href="https://github.com/wrf-model/WRF/commit/a49fe581285d">Details</a></p><p>If downloading the files from the section below, please choose either the v4.4.tar.gz file, or the v4.4.zip file. DO NOT choose those named "Source Code." They do not include the mandatory NoahMP submodule - needed for compiling WRF.</p><h1 id="solution">Solution</h1><ol type="1"><li>Go to specific WRF version and /phys/</li><li>Download <strong>noahmp @ xxxx</strong> folder to your local /WRF/phys/<ul><li>WRFv4.5.2 is noahmp @ 8a8073e</li><li>WRFv4.6.0 is noahmp @ 848f54a</li></ul></li></ol><p>It is</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs stylus">WRFV4.<span class="hljs-number">5</span>/phys/noahmp  <br> $ ls<br>drivers  parameters  README<span class="hljs-selector-class">.md</span>  <span class="hljs-attribute">src</span><br><br>.<br>├── drivers<br>│   └── wrf<br>│       └── module_sf_noahmpdrv<span class="hljs-selector-class">.F</span><br>├── parameters<br>│   ├── GENPARM<span class="hljs-selector-class">.TBL</span><br>│   ├── MPTABLE<span class="hljs-selector-class">.TBL</span><br>│   └── SOILPARM<span class="hljs-selector-class">.TBL</span><br>├── README<span class="hljs-selector-class">.md</span><br>└── <span class="hljs-attribute">src</span><br>    ├── module_sf_noahmp_glacier<span class="hljs-selector-class">.F</span><br>    ├── module_sf_noahmp_groundwater<span class="hljs-selector-class">.F</span><br>    └── module_sf_noahmplsm<span class="hljs-selector-class">.F</span><br><br><span class="hljs-number">4</span> directories, <span class="hljs-number">8</span> files<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>WRF</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Installation</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MPAS | Official MPAS Installation lib -- Preliminary requirements</title>
    <link href="/2024/06/03/MPAS_install_official_mpas_lib_install/"/>
    <url>/2024/06/03/MPAS_install_official_mpas_lib_install/</url>
    
    <content type="html"><![CDATA[<h1 id="preliminary-requirements-the-easiest-route">Preliminary requirements: the easiest route</h1><p>Installing the full set of I/O libraries required by MPAS can be tedious. To make this easier, we've prepared a shell script that may be helpful:</p><p>Preliminary requirements: the easiest route</p><p><a href="https://www2.mmm.ucar.edu/projects/mpas/scripts/mpas_lib_install.sh" class="uri">https://www2.mmm.ucar.edu/projects/mpas/scripts/mpas_lib_install.sh</a></p><p>Notes:</p><ul><li>Before running or following the above script, you will need to have downloaded the library sources from <a href="https://www2.mmm.ucar.edu/projects/mpas/scripts" class="uri">https://www2.mmm.ucar.edu/projects/mpas/scripts</a></li><li>If you already have an MPI library, skip the MPICH installation</li><li>After editing paths and compiler names at the top, you may be able to run the script, but in general the script may be best used as a guide</li></ul><p>attached below,</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/usr/bin/env bash</span><br><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Sources for all libraries used in this script can be found at</span><br><span class="hljs-comment"># http://www2.mmm.ucar.edu/people/duda/files/mpas/sources/ </span><br><span class="hljs-comment">#</span><br><br><span class="hljs-comment"># Where to find sources for libraries - generally, the directory into which</span><br><span class="hljs-comment"># you have downloaded the sources from the URL, above</span><br><span class="hljs-built_in">export</span> LIBSRC=/sysdisk2/duda/sources<br><br><span class="hljs-comment"># Where to install libraries - this directory must be writable by you</span><br><span class="hljs-built_in">export</span> LIBBASE=/sysdisk2/duda/mpas-libs<br><br><span class="hljs-comment"># Compilers</span><br><span class="hljs-built_in">export</span> SERIAL_FC=gfortran<br><span class="hljs-built_in">export</span> SERIAL_F77=gfortran<br><span class="hljs-built_in">export</span> SERIAL_CC=gcc<br><span class="hljs-built_in">export</span> SERIAL_CXX=g++<br><span class="hljs-built_in">export</span> MPI_FC=mpifort<br><span class="hljs-built_in">export</span> MPI_F77=mpifort<br><span class="hljs-built_in">export</span> MPI_CC=mpicc<br><span class="hljs-built_in">export</span> MPI_CXX=mpic++<br><br><br><span class="hljs-built_in">export</span> CC=<span class="hljs-variable">$SERIAL_CC</span><br><span class="hljs-built_in">export</span> CXX=<span class="hljs-variable">$SERIAL_CXX</span><br><span class="hljs-built_in">export</span> F77=<span class="hljs-variable">$SERIAL_F77</span><br><span class="hljs-built_in">export</span> FC=<span class="hljs-variable">$SERIAL_FC</span><br><span class="hljs-built_in">unset</span> F90  <span class="hljs-comment"># This seems to be set by default on NCAR&#x27;s Cheyenne and is problematic</span><br><span class="hljs-built_in">unset</span> F90FLAGS<br><span class="hljs-built_in">export</span> CFLAGS=<span class="hljs-string">&quot;-g&quot;</span><br><span class="hljs-built_in">export</span> FFLAGS=<span class="hljs-string">&quot;-g -fbacktrace&quot;</span><br><span class="hljs-built_in">export</span> FCFLAGS=<span class="hljs-string">&quot;-g -fbacktrace -fallow-argument-mismatch&quot;</span><br><span class="hljs-built_in">export</span> F77FLAGS=<span class="hljs-string">&quot;-g -fbacktrace -fallow-argument-mismatch&quot;</span><br><br><br><span class="hljs-comment">########################################</span><br><span class="hljs-comment"># MPICH</span><br><span class="hljs-comment">########################################</span><br>tar xzvf <span class="hljs-variable">$&#123;LIBSRC&#125;</span>/mpich-3.3.1.tar.gz <br><span class="hljs-built_in">cd</span> mpich-3.3.1<br>./configure --prefix=<span class="hljs-variable">$&#123;LIBBASE&#125;</span><br>make -j 4<br><span class="hljs-comment">#make check</span><br>make install<br><span class="hljs-comment">#make testing</span><br><span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$&#123;LIBBASE&#125;</span>/bin:<span class="hljs-variable">$PATH</span><br><span class="hljs-built_in">export</span> LD_LIBRARY_PATH=<span class="hljs-variable">$&#123;LIBBASE&#125;</span>/lib:<span class="hljs-variable">$LD_LIBRARY_PATH</span><br><span class="hljs-built_in">cd</span> ..<br><span class="hljs-built_in">rm</span> -rf mpich-3.3.1<br><br><span class="hljs-comment">########################################</span><br><span class="hljs-comment"># zlib</span><br><span class="hljs-comment">########################################</span><br>tar xzvf <span class="hljs-variable">$&#123;LIBSRC&#125;</span>/zlib-1.2.11.tar.gz<br><span class="hljs-built_in">cd</span> zlib-1.2.11<br>./configure --prefix=<span class="hljs-variable">$&#123;LIBBASE&#125;</span> --static<br>make -j 4<br>make install<br><span class="hljs-built_in">cd</span> ..<br><span class="hljs-built_in">rm</span> -rf zlib-1.2.11<br><br><span class="hljs-comment">########################################</span><br><span class="hljs-comment"># HDF5</span><br><span class="hljs-comment">########################################</span><br>tar xjvf <span class="hljs-variable">$&#123;LIBSRC&#125;</span>/hdf5-1.10.5.tar.bz2<br><span class="hljs-built_in">cd</span> hdf5-1.10.5<br><span class="hljs-built_in">export</span> FC=<span class="hljs-variable">$MPI_FC</span><br><span class="hljs-built_in">export</span> CC=<span class="hljs-variable">$MPI_CC</span><br><span class="hljs-built_in">export</span> CXX=<span class="hljs-variable">$MPI_CXX</span><br>./configure --prefix=<span class="hljs-variable">$&#123;LIBBASE&#125;</span> --enable-parallel --with-zlib=<span class="hljs-variable">$&#123;LIBBASE&#125;</span> --disable-shared<br>make -j 4<br><span class="hljs-comment">#make check</span><br>make install<br><span class="hljs-built_in">cd</span> ..<br><span class="hljs-built_in">rm</span> -rf hdf5-1.10.5<br><br><span class="hljs-comment">########################################</span><br><span class="hljs-comment"># Parallel-netCDF</span><br><span class="hljs-comment">########################################</span><br>tar xzvf <span class="hljs-variable">$&#123;LIBSRC&#125;</span>/pnetcdf-1.12.2.tar.gz<br><span class="hljs-built_in">cd</span> pnetcdf-1.12.2<br><span class="hljs-built_in">export</span> CC=<span class="hljs-variable">$SERIAL_CC</span><br><span class="hljs-built_in">export</span> CXX=<span class="hljs-variable">$SERIAL_CXX</span><br><span class="hljs-built_in">export</span> F77=<span class="hljs-variable">$SERIAL_F77</span><br><span class="hljs-built_in">export</span> FC=<span class="hljs-variable">$SERIAL_FC</span><br><span class="hljs-built_in">export</span> MPICC=<span class="hljs-variable">$MPI_CC</span><br><span class="hljs-built_in">export</span> MPICXX=<span class="hljs-variable">$MPI_CXX</span><br><span class="hljs-built_in">export</span> MPIF77=<span class="hljs-variable">$MPI_F77</span><br><span class="hljs-built_in">export</span> MPIF90=<span class="hljs-variable">$MPI_FC</span><br><span class="hljs-comment">### Will also need gcc in path</span><br>./configure --prefix=<span class="hljs-variable">$&#123;LIBBASE&#125;</span><br>make -j 4<br><span class="hljs-comment">#make check</span><br><span class="hljs-comment">#make ptest</span><br><span class="hljs-comment">#make testing</span><br>make install<br><span class="hljs-built_in">export</span> PNETCDF=<span class="hljs-variable">$&#123;LIBBASE&#125;</span><br><span class="hljs-built_in">cd</span> ..<br><span class="hljs-built_in">rm</span> -rf pnetcdf-1.12.2<br><br><span class="hljs-comment">########################################</span><br><span class="hljs-comment"># netCDF (C library)</span><br><span class="hljs-comment">########################################</span><br>tar xzvf <span class="hljs-variable">$&#123;LIBSRC&#125;</span>/netcdf-c-4.6.3.tar.gz<br><span class="hljs-built_in">cd</span> netcdf-c-4.6.3<br><span class="hljs-built_in">export</span> CPPFLAGS=<span class="hljs-string">&quot;-I<span class="hljs-variable">$&#123;LIBBASE&#125;</span>/include&quot;</span><br><span class="hljs-built_in">export</span> LDFLAGS=<span class="hljs-string">&quot;-L<span class="hljs-variable">$&#123;LIBBASE&#125;</span>/lib&quot;</span><br><span class="hljs-built_in">export</span> LIBS=<span class="hljs-string">&quot;-lhdf5_hl -lhdf5 -lz -ldl&quot;</span><br><span class="hljs-built_in">export</span> CC=<span class="hljs-variable">$MPI_CC</span><br>./configure --prefix=<span class="hljs-variable">$&#123;LIBBASE&#125;</span> --disable-dap --enable-netcdf4 --enable-pnetcdf --enable-cdf5 --enable-parallel-tests --disable-shared<br>make -j 4 <br><span class="hljs-comment">#make check</span><br>make install<br><span class="hljs-built_in">export</span> NETCDF=<span class="hljs-variable">$&#123;LIBBASE&#125;</span><br><span class="hljs-built_in">cd</span> ..<br><span class="hljs-built_in">rm</span> -rf netcdf-c-4.6.3<br><br><span class="hljs-comment">########################################</span><br><span class="hljs-comment"># netCDF (Fortran interface library)</span><br><span class="hljs-comment">########################################</span><br>tar xzvf <span class="hljs-variable">$&#123;LIBSRC&#125;</span>/netcdf-fortran-4.5.2.tar.gz<br><span class="hljs-built_in">cd</span> netcdf-fortran-4.5.2<br><span class="hljs-built_in">export</span> FC=<span class="hljs-variable">$MPI_FC</span><br><span class="hljs-built_in">export</span> F77=<span class="hljs-variable">$MPI_F77</span><br><span class="hljs-built_in">export</span> LIBS=<span class="hljs-string">&quot;-lnetcdf -lpnetcdf <span class="hljs-variable">$&#123;LIBS&#125;</span>&quot;</span><br>./configure --prefix=<span class="hljs-variable">$&#123;LIBBASE&#125;</span> --enable-parallel-tests --disable-shared<br>make -j 4<br><span class="hljs-comment">#make check</span><br>make install<br><span class="hljs-built_in">cd</span> ..<br><span class="hljs-built_in">rm</span> -rf netcdf-fortran-4.5.2<br><br><span class="hljs-comment">########################################</span><br><span class="hljs-comment"># PIO</span><br><span class="hljs-comment">########################################</span><br>git <span class="hljs-built_in">clone</span> https://github.com/NCAR/ParallelIO<br><span class="hljs-built_in">cd</span> ParallelIO<br>git checkout -b pio-2.5.8 pio2_5_8<br><span class="hljs-built_in">export</span> PIOSRC=`<span class="hljs-built_in">pwd</span>`<br><span class="hljs-built_in">cd</span> ..<br><span class="hljs-built_in">mkdir</span> pio<br><span class="hljs-built_in">cd</span> pio<br><span class="hljs-built_in">export</span> CC=<span class="hljs-variable">$MPI_CC</span><br><span class="hljs-built_in">export</span> FC=<span class="hljs-variable">$MPI_FC</span><br>cmake -DNetCDF_C_PATH=<span class="hljs-variable">$NETCDF</span> -DNetCDF_Fortran_PATH=<span class="hljs-variable">$NETCDF</span> -DPnetCDF_PATH=<span class="hljs-variable">$PNETCDF</span> -DHDF5_PATH=<span class="hljs-variable">$NETCDF</span> -DCMAKE_INSTALL_PREFIX=<span class="hljs-variable">$LIBBASE</span> -DPIO_USE_MALLOC=ON -DCMAKE_VERBOSE_MAKEFILE=1 -DPIO_ENABLE_TIMING=OFF <span class="hljs-variable">$PIOSRC</span><br>make<br><span class="hljs-comment">#make check</span><br>make install<br><span class="hljs-built_in">cd</span> ..<br><span class="hljs-built_in">rm</span> -rf pio ParallelIO<br><span class="hljs-built_in">export</span> PIO=<span class="hljs-variable">$LIBBASE</span><br><br><span class="hljs-comment">########################################</span><br><span class="hljs-comment"># Other environment vars needed by MPAS</span><br><span class="hljs-comment">########################################</span><br><span class="hljs-built_in">export</span> MPAS_EXTERNAL_LIBS=<span class="hljs-string">&quot;-L<span class="hljs-variable">$&#123;LIBBASE&#125;</span>/lib -lhdf5_hl -lhdf5 -ldl -lz&quot;</span><br><span class="hljs-built_in">export</span> MPAS_EXTERNAL_INCLUDES=<span class="hljs-string">&quot;-I<span class="hljs-variable">$&#123;LIBBASE&#125;</span>/include&quot;</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>MPAS</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Installation</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MPAS | Installation by Spack and Intel</title>
    <link href="/2024/06/01/MPAS_intel_spack_installation/"/>
    <url>/2024/06/01/MPAS_intel_spack_installation/</url>
    
    <content type="html"><![CDATA[<h1 id="using-spack">Using Spack</h1><p>Spack is a package management tool designed to support multiple versions and configurations of software on a wide variety of platforms and environments. It was designed for large supercomputing centers, where many users and application teams share common installations of software on clusters with exotic architectures, using libraries that do not have a standard ABI. Spack is non-destructive: installing a new version does not break existing installations, so many configurations can coexist on the same system. Most importantly, Spack is simple. It offers a simple spec syntax so that users can specify versions and configuration options concisely. Spack is also simple for package authors: package files are written in pure Python, and specs allow package authors to maintain a single file for many different builds of the same package.</p><p><a href="https://spack.readthedocs.io/en/latest/" class="uri">https://spack.readthedocs.io/en/latest/</a></p><h2 id="search-packages-online">Search packages online</h2><blockquote><p><a href="https://packages.spack.io/" class="uri">https://packages.spack.io/</a></p></blockquote><h1 id="install-intel-compiler-and-intel-onempi">Install Intel compiler and intel-onempi</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ spack <span class="hljs-built_in">env</span> create intel_oneapi <br>$ spack <span class="hljs-built_in">env</span> activate intel_oneapi<br>$ spack info --all intel-oneapi-mpi<br>$ spack info --all intel-oneapi-compilers<br></code></pre></td></tr></table></figure><p>Try to install <a href="https://spack.readthedocs.io/en/latest/build_systems/inteloneapipackage.html">intel-oneapi-mpi/2021.4.0</a>,</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ spack install --add intel-oneapi-compilers@2021.4.0<br><span class="hljs-comment"># Add the compilers to your compilers.yaml so spack can use them:</span><br><span class="hljs-comment"># For 2023.x and earlier versions, use:</span><br>$ spack compiler add `spack location -i intel-oneapi-compilers@2021.4.0`/compiler/latest/linux/bin/intel64<br>$ spack compiler add `spack location -i intel-oneapi-compilers@2021.4.0`/compiler/latest/linux/bin<br><span class="hljs-comment"># Verify that the compilers are available:</span><br>$ spack compiler list<br>$ spack location -i intel-oneapi-compilers@2021.4.0<br></code></pre></td></tr></table></figure><p>Then, install intel-onempi,</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ spack install --add intel-oneapi-mpi@2021.4.0%intel<br></code></pre></td></tr></table></figure><p>Done.</p><p>And, check</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh">spack <span class="hljs-built_in">env</span> activate intel_oneapi<br><br><span class="hljs-built_in">which</span> mpiicc &amp;&amp; mpiicc --version<br><span class="hljs-built_in">which</span> mpiifort &amp;&amp; mpiifort --version<br><span class="hljs-built_in">which</span> mpiicpc &amp;&amp; mpiicpc --version<br><span class="hljs-built_in">which</span> icc &amp;&amp; icc --version<br><span class="hljs-built_in">which</span> ifort &amp;&amp; ifort --version<br></code></pre></td></tr></table></figure><p>Additionally, install curl and cmake,</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ spack info --all curl<br>$ spack install --add curl%intel<br>$ spack info --all cmake<br>$ spack install --add cmake%intel<br></code></pre></td></tr></table></figure><h1 id="install-enviroment-for-mpas">Install enviroment for MPAS</h1><p>Prepare</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/bash</span><br><br><span class="hljs-comment">#------------------------------------------------#</span><br><span class="hljs-comment">#Author:         wpsze</span><br><span class="hljs-comment">#Email：         </span><br><span class="hljs-comment">#date:           </span><br><span class="hljs-comment">#Version:        </span><br><span class="hljs-comment">#Description:    The purpose of the script</span><br><span class="hljs-comment">#Copyright (C)： 2022 All rights reserved</span><br><span class="hljs-comment">#------------------------------------------------#</span><br><br><span class="hljs-built_in">export</span> libs_DIR=/home/wpsze/MPAS-A/intel/modules_library/Library/<br><br><span class="hljs-comment"># intel compiler &amp; intel onempi</span><br>spack <span class="hljs-built_in">env</span> activate intel_oneapi<br><br><span class="hljs-built_in">which</span> mpiicc &amp;&amp; mpiicc --version<br><span class="hljs-built_in">which</span> mpiifort &amp;&amp; mpiifort --version<br><span class="hljs-built_in">which</span> mpiicpc &amp;&amp; mpiicpc --version<br><span class="hljs-built_in">which</span> icc &amp;&amp; icc --version<br><span class="hljs-built_in">which</span> ifort &amp;&amp; ifort --version<br><br><span class="hljs-comment"># MPAS env</span><br><span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$libs_DIR</span>/bin:<span class="hljs-variable">$PATH</span><br><span class="hljs-built_in">export</span> LD_LIBRARY_PATH=<span class="hljs-variable">$libs_DIR</span>/lib:<span class="hljs-variable">$LD_LIBRARY_PATH</span><br><span class="hljs-built_in">export</span> LDFLAGS=-L<span class="hljs-variable">$libs_DIR</span>/lib<br><span class="hljs-built_in">export</span> CPPFLAGS=-I<span class="hljs-variable">$libs_DIR</span>/include<br><br><span class="hljs-built_in">export</span> PNETCDF_PATH=<span class="hljs-variable">$libs_DIR</span><br><span class="hljs-built_in">export</span> PNETCDF=<span class="hljs-variable">$libs_DIR</span><br><span class="hljs-built_in">export</span> NETCDF_PATH=<span class="hljs-variable">$libs_DIR</span><br><span class="hljs-built_in">export</span> NETCDF=<span class="hljs-variable">$libs_DIR</span><br><span class="hljs-built_in">export</span> PIO=<span class="hljs-variable">$libs_DIR</span><br><br><br><span class="hljs-built_in">export</span> CC=mpiicc<br><span class="hljs-built_in">export</span> CXX=mpiicpc<br><span class="hljs-built_in">export</span> FC=mpiifort<br><span class="hljs-built_in">export</span> F77=mpiifort<br><span class="hljs-built_in">export</span> F90=mpiifort<br><span class="hljs-built_in">export</span> MPIF90=mpiifort<br><span class="hljs-built_in">export</span> MPIF77=mpiifort<br><span class="hljs-built_in">export</span> MPIFC=mpiifort<br><span class="hljs-built_in">export</span> MPICC=mpiicc<br><span class="hljs-built_in">export</span> MPICXX=mpiicpc<br><br><span class="hljs-built_in">export</span> CFLAGS=<span class="hljs-string">&#x27;-O3 -fPIC -static-intel&#x27;</span><br><span class="hljs-built_in">export</span> CXXFLAGS=<span class="hljs-string">&#x27;-O3 -fPIC -static-intel&#x27;</span><br><span class="hljs-built_in">export</span> FFLAGS=<span class="hljs-string">&#x27;-O3 -fPIC -static-intel&#x27;</span><br></code></pre></td></tr></table></figure><p>Then, env sh</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">############################## Directory Listing ############################</span><br><span class="hljs-built_in">export</span> HOME=`<span class="hljs-built_in">pwd</span>`<br><br><span class="hljs-built_in">source</span> /home/wpsze/MPAS-A/intel/modules_library/mpas_env_intel.sh<br><br><span class="hljs-built_in">export</span> download_DIR=<span class="hljs-variable">$HOME</span>/mpas_install/<br><br>TARGET=ifort<br><br><span class="hljs-built_in">which</span> mpiicc &amp;&amp; mpiicc --version<br><span class="hljs-built_in">which</span> mpiifort &amp;&amp; mpiifort --version<br><span class="hljs-built_in">which</span> mpiicpc &amp;&amp; mpiicpc --version<br><span class="hljs-built_in">which</span> icc &amp;&amp; icc --version<br><span class="hljs-built_in">which</span> ifort &amp;&amp; ifort --version<br><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$HOME</span><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$download_DIR</span><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$libs_DIR</span><br><br>mpiicc --version<br>mpiifort --version<br><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$HOME</span><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$download_DIR</span><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$libs_DIR</span><br><br><span class="hljs-built_in">mkdir</span> -p mpas_install<br><span class="hljs-built_in">mkdir</span> -p Library<br><br>do_download=False <span class="hljs-comment"># True or False</span><br>compile_all=True<br><br><span class="hljs-comment"># Currently Loaded Modules:</span><br><span class="hljs-comment">#  1) ncarenv/1.0 (xx)      4) ncarcompilers/1.0 (xx)  7) pnetcdf/1.11.2  10) ncview/2.1.7 (already)</span><br><span class="hljs-comment">#  2) ncarbinlibs/1.1 (xx)  5) netcdf/4.7.0        8) pio/1.9.23 (2.5.2)      11) metis/5.1.0</span><br><span class="hljs-comment">#  3) gnu/8.3.0 (done)         6) mpich/3.3.1         9) ncl/6.6.2 (already)       12) hdf5/1.10.5</span><br><br><span class="hljs-comment">#do_mpich=False ## intel-onempi</span><br>do_zlib=False<br>do_hdf5=True<br>do_pnetcdf=False<br>do_netcdfC=False<br>do_netcdfF=False<br>do_pio=False<br>do_metis=fTrue<br><br><span class="hljs-comment">############################## Downloading Libraries ############################</span><br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$do_download</span>  == True ]]; <span class="hljs-keyword">then</span><br>    <span class="hljs-built_in">cd</span> <span class="hljs-variable">$download_DIR</span><br>    wget -c https://zlib.net/zlib-1.2.13.tar.gz<br>    wget -c https://www.gfd-dennou.org/arch/netcdf/unidata-mirror/netcdf-c-4.7.4.tar.gz<br>    wget -c https://www.gfd-dennou.org/arch/netcdf/unidata-mirror/netcdf-fortran-4.5.3.tar.gz<br>    <span class="hljs-comment"># wget -c https://github.com/pmodels/mpich/releases/download/v4.0.2/mpich-4.0.2.tar.gz</span><br>    wget -c https://www.mpich.org/static/downloads/3.3.1/mpich-3.3.1.tar.gz<br>    wget -c https://parallel-netcdf.github.io/Release/pnetcdf-1.11.2.tar.gz <br>    <span class="hljs-comment"># Pio is from https://github.com/NCAR/ParallelIO/releases</span><br>    <span class="hljs-comment"># metis is from http://glaros.dtc.umn.edu/gkhome/metis/metis/download</span><br>    wget -c https://hdf-wordpress-1.s3.amazonaws.com/wp-content/uploads/manual/HDF5/HDF5_1_12_0/source/hdf5-1.12.0.tar.gz<br><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$compile_all</span> == True ]]; <span class="hljs-keyword">then</span><br><span class="hljs-comment">###################################################################</span><br><span class="hljs-built_in">export</span> LD_LIBRARY_PATH=<span class="hljs-variable">$libs_DIR</span>/lib:<span class="hljs-variable">$LD_LIBRARY_PATH</span><br><span class="hljs-built_in">export</span> LDFLAGS=-L<span class="hljs-variable">$libs_DIR</span>/lib<br><span class="hljs-built_in">export</span> CPPFLAGS=-I<span class="hljs-variable">$libs_DIR</span>/include<br><span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$libs_DIR</span>/bin:<span class="hljs-variable">$PATH</span><br><br><span class="hljs-comment">#export PNETCDF_PATH=$libs_DIR/bin:$PATH</span><br><span class="hljs-comment">#export PNETCDF=$libs_DIR/bin:$PATH</span><br><br><span class="hljs-comment">#export NETCDF_PATH=$libs_DIR/bin:$PATH</span><br><span class="hljs-comment">#export NETCDF=$libs_DIR/bin:$PATH</span><br><br><span class="hljs-comment">############################## zlib ############################ *** zlib test OK ***</span><br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$&#123;do_zlib&#125;</span>  == True ]]; <span class="hljs-keyword">then</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== zlib ====&quot;</span><br><span class="hljs-built_in">cd</span> <span class="hljs-variable">$download_DIR</span><br>tar xvf zlib-1.2.13.tar.gz 1&gt;/dev/null 2&gt;&amp;1 <br><span class="hljs-built_in">cd</span> zlib-1.2.13/<br><br>./configure --prefix=<span class="hljs-variable">$libs_DIR</span> <span class="hljs-comment">#--static</span><br>make -j 4<br>make install<br>make check<br><span class="hljs-built_in">cd</span> ..<br><span class="hljs-built_in">rm</span> -rf zlib-1.2.13<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== zlib (end) ====&quot;</span><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-comment">############################## HDF5 ############################ </span><br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$&#123;do_hdf5&#125;</span> == True ]]; <span class="hljs-keyword">then</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== hdf5 ====&quot;</span><br><span class="hljs-built_in">cd</span> <span class="hljs-variable">$download_DIR</span><br>tar xvf hdf5-1.12.0.tar.gz 1&gt;/dev/null 2&gt;&amp;1 <br><span class="hljs-built_in">cd</span> hdf5-1.12.0/<br><br>./configure --prefix=<span class="hljs-variable">$libs_DIR</span> --enable-parallel --with-zlib=<span class="hljs-variable">$libs_DIR</span> --enable-fortran <span class="hljs-comment">#--disable-shared</span><br>make -j 4<br>make check<br>make install<br><span class="hljs-built_in">cd</span> ..<br><span class="hljs-built_in">rm</span> -rf hdf5-1.12.0<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== hdf5 (end) ====&quot;</span><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-comment">############################## pnetcdf ############################ PnetCDF has been successfully installed </span><br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$&#123;do_pnetcdf&#125;</span> == True ]]; <span class="hljs-keyword">then</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== pnetcdf ====&quot;</span><br><span class="hljs-built_in">cd</span> <span class="hljs-variable">$download_DIR</span><br>tar xvf pnetcdf-1.11.2.tar.gz 1&gt;/dev/null 2&gt;&amp;1 <br><span class="hljs-built_in">cd</span> pnetcdf-1.11.2/<br><br>./configure --prefix=<span class="hljs-variable">$libs_DIR</span><br>make -j 4<br>make check<br>make ptest<br>make testing<br>make install<br><span class="hljs-built_in">cd</span> ..<br><span class="hljs-built_in">rm</span> -rf pnetcdf-1.11.2<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== pnetcdf (end) ====&quot;</span><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-comment">############################## netcdf-C ############################  Congratulations! You have successfully installed netCDF!</span><br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$&#123;do_netcdfC&#125;</span> == True ]]; <span class="hljs-keyword">then</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== netcdf-C ====&quot;</span><br><span class="hljs-comment">## -disable-dap：--disable-dap的原因是缺少一个‘curl’的lib</span><br><span class="hljs-comment">## 4.1.3以后的版本Fortran和C分开了。把disable--netcdf-4 写进去也无所谓</span><br><span class="hljs-built_in">cd</span> <span class="hljs-variable">$download_DIR</span><br>tar xvf netcdf-c-4.7.4.tar.gz 1&gt;/dev/null 2&gt;&amp;1 <br><span class="hljs-built_in">cd</span> netcdf-c-4.7.4/<br><br><span class="hljs-comment">#export LIBS=&quot;-lhdf5_hl -lhdf5 -lz -ldl&quot;</span><br><br><span class="hljs-built_in">export</span> LD_LIBRARY_PATH=<span class="hljs-variable">$libs_DIR</span>/lib:<span class="hljs-variable">$LD_LIBRARY_PATH</span><br><span class="hljs-built_in">export</span> LDFLAGS=-L<span class="hljs-variable">$libs_DIR</span>/lib<br><span class="hljs-built_in">export</span> CPPFLAGS=-I<span class="hljs-variable">$libs_DIR</span>/include<br><br><span class="hljs-comment">#./configure --prefix=$libs_DIR --disable-dap --enable-pnetcdf --enable-netcdf4 --enable-cdf5 --enable-parallel-tests --disable-shared</span><br>./configure --prefix=<span class="hljs-variable">$libs_DIR</span> --enable-shared --enable-netcdf4 --disable-filter-testing --disable-dap<br>make -j 4 <br>make check<br>make install<br><span class="hljs-built_in">cd</span> ..<br><span class="hljs-built_in">rm</span> -rf netcdf-c-4.7.4<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== netcdf-C (end) ====&quot;</span><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-comment">############################## netcdf-F ############################ </span><br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$&#123;do_netcdfF&#125;</span> == True ]]; <span class="hljs-keyword">then</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== netcdf-F ====&quot;</span><br><span class="hljs-built_in">cd</span> <span class="hljs-variable">$download_DIR</span><br>tar xvf netcdf-fortran-4.5.3.tar.gz 1&gt;/dev/null 2&gt;&amp;1 <br><span class="hljs-built_in">cd</span> netcdf-fortran-4.5.3/<br><br><br><span class="hljs-built_in">export</span> LD_LIBRARY_PATH=<span class="hljs-variable">$libs_DIR</span>/lib:<span class="hljs-variable">$LD_LIBRARY_PATH</span><br><span class="hljs-built_in">export</span> LDFLAGS=-L<span class="hljs-variable">$libs_DIR</span>/lib<br><span class="hljs-built_in">export</span> CPPFLAGS=-I<span class="hljs-variable">$libs_DIR</span>/include<br><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># configure: error: netcdf-c version 4.7.4 or greater is required</span><br><br>nc-config --cflags<br>nc-config --libs<br>./configure --prefix=<span class="hljs-variable">$libs_DIR</span> --enable-shared <span class="hljs-comment">#--enable-parallel-tests #--disable-shared</span><br><br><span class="hljs-comment">#CFLAGS=$(nc-config --cflags) LDFLAGS=$(nc-config --libs) ./configure --prefix=$libs_DIR --enable-parallel-tests #--disable-shared</span><br><br>make -j 4 <br>make check<br>make install<br><span class="hljs-built_in">cd</span> ..<br><span class="hljs-built_in">rm</span> -rf netcdf-fortran-4.5.3<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== netcdf-F (end) ====&quot;</span><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-comment">############################## Pio ############################</span><br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$&#123;do_pio&#125;</span> == True ]]; <span class="hljs-keyword">then</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== PIO ====&quot;</span><br><span class="hljs-built_in">cd</span> <span class="hljs-variable">$download_DIR</span><br>tar xvf ParallelIO-pio2_5_8.tar.gz 1&gt;/dev/null 2&gt;&amp;1<br><span class="hljs-built_in">cd</span> ParallelIO-pio2_5_8/<br><br><span class="hljs-comment">#./configure --prefix=$libs_DIR --enable-fortran</span><br><span class="hljs-comment">#cmake -DNetCDF_C_PATH=$libs_DIR -DNetCDF_Fortran_PATH=$libs_DIR -DPnetCDF_PATH=$libs_DIR -DPIO_ENABLE_TIMING=OFF -DCMAKE_INSTALL_PREFIX=$libs_DIR</span><br>cmake -DNetCDF_C_PATH=<span class="hljs-variable">$NETCDF</span> -DNetCDF_Fortran_PATH=<span class="hljs-variable">$NETCDF</span> -DPnetCDF_PATH=<span class="hljs-variable">$PNETCDF</span> -DHDF5_PATH=<span class="hljs-variable">$libs_DIR</span> -DCMAKE_INSTALL_PREFIX=<span class="hljs-variable">$libs_DIR</span> -DPIO_USE_MALLOC=ON -DCMAKE_VERBOSE_MAKEFILE=1 -DPIO_ENABLE_TIMING=OFF ./<br>make<br><span class="hljs-comment">#make check</span><br>make install<br><span class="hljs-built_in">cd</span> ..<br><span class="hljs-built_in">rm</span> -rf ParallelIO-pio2_5_8<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== PIO (end) ====&quot;</span><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-comment">############################## metis ############################</span><br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$&#123;do_metis&#125;</span> == True ]]; <span class="hljs-keyword">then</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== metis ====&quot;</span><br><br>        <span class="hljs-comment">## metis is serial </span><br>        <span class="hljs-built_in">export</span> CC=icc<br>        <span class="hljs-built_in">export</span> CXX=icpc<br>        <span class="hljs-built_in">export</span> FC=ifort<br>        <span class="hljs-built_in">export</span> F77=ifort<br>        <span class="hljs-built_in">export</span> F90=ifort<br><br><span class="hljs-built_in">cd</span> <span class="hljs-variable">$download_DIR</span><br>tar xvf metis-5.1.0.tar.gz 1&gt;/dev/null 2&gt;&amp;1<br><span class="hljs-built_in">cd</span> metis-5.1.0/<br><span class="hljs-comment">#./configure --prefix=$libs_DIR</span><br><br>make config prefix=<span class="hljs-variable">$libs_DIR</span><br>make<br><span class="hljs-comment">#make check</span><br>make install<br><span class="hljs-built_in">cd</span> ..<br><span class="hljs-built_in">rm</span> -rf metis-5.1.0<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== metis (end) ====&quot;</span><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-keyword">fi</span><br></code></pre></td></tr></table></figure><h1 id="mpasv7.3">MPASv7.3</h1><h1 id="reference">Reference</h1><ol type="1"><li><p><a href="https://forum.mmm.ucar.edu/threads/full-wrf-and-wps-installation-example-intel.15229/">Full WRF and WPS Installation Example (Intel)</a></p></li><li><p><a href="https://forum.mmm.ucar.edu/threads/make-ifort-error.340/">Make ifort error</a></p></li></ol><p>In Makefile,</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs sh">ifort:<br>( $(MAKE) all \<br><span class="hljs-string">&quot;FC_PARALLEL = mpif90&quot;</span> \<br><span class="hljs-string">&quot;CC_PARALLEL = mpicc&quot;</span> \<br><span class="hljs-string">&quot;CXX_PARALLEL = mpicxx&quot;</span> \<br><span class="hljs-string">&quot;FC_SERIAL = ifort&quot;</span> \<br><span class="hljs-string">&quot;CC_SERIAL = icc&quot;</span> \<br><span class="hljs-string">&quot;CXX_SERIAL = icpc&quot;</span> \<br><span class="hljs-string">&quot;FFLAGS_PROMOTION = -real-size 64&quot;</span> \<br><span class="hljs-string">&quot;FFLAGS_OPT = -O3 -convert big_endian -free -align array64byte&quot;</span> \<br><span class="hljs-string">&quot;CFLAGS_OPT = -O3&quot;</span> \<br><span class="hljs-string">&quot;CXXFLAGS_OPT = -O3&quot;</span> \<br><span class="hljs-string">&quot;LDFLAGS_OPT = -O3&quot;</span> \<br><span class="hljs-string">&quot;FFLAGS_DEBUG = -g -convert big_endian -free -CU -CB -check all -fpe0 -traceback&quot;</span> \<br><span class="hljs-string">&quot;CFLAGS_DEBUG = -g -traceback&quot;</span> \<br><span class="hljs-string">&quot;CXXFLAGS_DEBUG = -g -traceback&quot;</span> \<br><span class="hljs-string">&quot;LDFLAGS_DEBUG = -g -fpe0 -traceback&quot;</span> \<br><span class="hljs-string">&quot;FFLAGS_OMP = -qopenmp&quot;</span> \<br><span class="hljs-string">&quot;CFLAGS_OMP = -qopenmp&quot;</span> \<br><span class="hljs-string">&quot;CORE = <span class="hljs-subst">$(CORE)</span>&quot;</span> \<br><span class="hljs-string">&quot;DEBUG = <span class="hljs-subst">$(DEBUG)</span>&quot;</span> \<br><span class="hljs-string">&quot;USE_PAPI = <span class="hljs-subst">$(USE_PAPI)</span>&quot;</span> \<br><span class="hljs-string">&quot;OPENMP = <span class="hljs-subst">$(OPENMP)</span>&quot;</span> \<br><span class="hljs-string">&quot;CPPFLAGS = <span class="hljs-subst">$(MODEL_FORMULATION)</span> -D_MPI&quot;</span> )<br></code></pre></td></tr></table></figure><p>where use <strong>mpif90/mpicc/mpicxx</strong> but now we want to use <strong>mpiifort/mpiicc/mpiicpc</strong>.</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># After reading your comment I decided to edit the Makefile, and in the lines of ifort I made the following change:</span><br><span class="hljs-comment"># Code:</span><br>ifort:<br>        ( $(MAKE) all \<br>        <span class="hljs-string">&quot;FC_PARALLEL = mpiifort&quot;</span> \<br>        <span class="hljs-string">&quot;CC_PARALLEL = mpiicc&quot;</span> \<br>        <span class="hljs-string">&quot;CXX_PARALLEL = mpiicpc&quot;</span> \<br>        <span class="hljs-string">&quot;FC_SERIAL = ifort&quot;</span> \<br>        <span class="hljs-string">&quot;CC_SERIAL = icc&quot;</span> \<br>        <span class="hljs-string">&quot;CXX_SERIAL = icpc&quot;</span> \<br></code></pre></td></tr></table></figure><h1 id="for-mpasv8.1.0">For MPASv8.1.0,</h1><p><a href="https://github.com/MPAS-Dev/MPAS-Model/releases/tag/v8.1.0" class="uri">https://github.com/MPAS-Dev/MPAS-Model/releases/tag/v8.1.0</a></p><p>The top-level Makefile provides a new intel build target for the Intel oneAPI Fortran, C, and C++ compiler suite. {:.info}</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs sh">intel-mpi:   <span class="hljs-comment"># BUILDTARGET Intel compiler suite with Intel MPI library</span><br>( $(MAKE) all \<br><span class="hljs-string">&quot;FC_PARALLEL = mpiifort&quot;</span> \<br><span class="hljs-string">&quot;CC_PARALLEL = mpiicc&quot;</span> \<br><span class="hljs-string">&quot;CXX_PARALLEL = mpiicpc&quot;</span> \<br><span class="hljs-string">&quot;FC_SERIAL = ifort&quot;</span> \<br><span class="hljs-string">&quot;CC_SERIAL = icc&quot;</span> \<br><span class="hljs-string">&quot;CXX_SERIAL = icpc&quot;</span> \<br><span class="hljs-string">&quot;FFLAGS_PROMOTION = -real-size 64&quot;</span> \<br><span class="hljs-string">&quot;FFLAGS_OPT = -O3 -convert big_endian -free -align array64byte&quot;</span> \<br><span class="hljs-string">&quot;CFLAGS_OPT = -O3&quot;</span> \<br><span class="hljs-string">&quot;CXXFLAGS_OPT = -O3&quot;</span> \<br><span class="hljs-string">&quot;LDFLAGS_OPT = -O3&quot;</span> \<br><span class="hljs-string">&quot;FFLAGS_DEBUG = -g -convert big_endian -free -CU -CB -check all -fpe0 -traceback&quot;</span> \<br><span class="hljs-string">&quot;CFLAGS_DEBUG = -g -traceback&quot;</span> \<br><span class="hljs-string">&quot;CXXFLAGS_DEBUG = -g -traceback&quot;</span> \<br><span class="hljs-string">&quot;LDFLAGS_DEBUG = -g -fpe0 -traceback&quot;</span> \<br><span class="hljs-string">&quot;FFLAGS_OMP = -qopenmp&quot;</span> \<br><span class="hljs-string">&quot;CFLAGS_OMP = -qopenmp&quot;</span> \<br><span class="hljs-string">&quot;PICFLAG = -fpic&quot;</span> \<br><span class="hljs-string">&quot;BUILD_TARGET = <span class="hljs-subst">$(@)</span>&quot;</span> \<br><span class="hljs-string">&quot;CORE = <span class="hljs-subst">$(CORE)</span>&quot;</span> \<br><span class="hljs-string">&quot;DEBUG = <span class="hljs-subst">$(DEBUG)</span>&quot;</span> \<br><span class="hljs-string">&quot;USE_PAPI = <span class="hljs-subst">$(USE_PAPI)</span>&quot;</span> \<br><span class="hljs-string">&quot;OPENMP = <span class="hljs-subst">$(OPENMP)</span>&quot;</span> \<br><span class="hljs-string">&quot;CPPFLAGS = <span class="hljs-subst">$(MODEL_FORMULATION)</span> -D_MPI&quot;</span> )<br></code></pre></td></tr></table></figure><p>$ make intel-mpi CORE=core options {:.info}</p>]]></content>
    
    
    <categories>
      
      <category>MPAS</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Installation</tag>
      
      <tag>MPAS</tag>
      
      <tag>Spack</tag>
      
      <tag>Intel</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MPAS | install ParallelIO-pio2_5_8</title>
    <link href="/2024/05/31/MPAS_install_ParallelIO-pio2_error/"/>
    <url>/2024/05/31/MPAS_install_ParallelIO-pio2_error/</url>
    
    <content type="html"><![CDATA[<h1 id="issue-solution">Issue &amp; solution</h1><ol type="1"><li><p>needs cmake &gt; $ micromamba env create -n mpas_env python=3.9 &gt; micromamba install anaconda::cmake</p></li><li><p>cmake</p></li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">export</span> libs_DIR=<span class="hljs-variable">$HOME</span>/Library/<br><span class="hljs-comment">### Compilers</span><br><span class="hljs-built_in">export</span> MPI_FC=mpifort<br><span class="hljs-built_in">export</span> MPI_F77=mpifort<br><span class="hljs-built_in">export</span> MPI_F90=mpifort<br><span class="hljs-built_in">export</span> MPI_CC=mpicc<br><span class="hljs-built_in">export</span> MPI_CXX=mpic++<br><span class="hljs-comment">### all serial are same as MPI</span><br><span class="hljs-built_in">export</span> FC=<span class="hljs-variable">$&#123;MPI_FC&#125;</span><br><span class="hljs-built_in">export</span> F77=<span class="hljs-variable">$&#123;MPI_F77&#125;</span><br><span class="hljs-built_in">export</span> F90=<span class="hljs-variable">$&#123;MPI_F77&#125;</span><br><span class="hljs-built_in">export</span> CC=<span class="hljs-variable">$&#123;MPI_F77&#125;</span><br><span class="hljs-built_in">export</span> CXX=<span class="hljs-variable">$&#123;MPI_F77&#125;</span><br></code></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">############################## Pio ############################</span><br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$&#123;do_pio&#125;</span> == True ]]; <span class="hljs-keyword">then</span><br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== PIO ====&quot;</span><br>    <span class="hljs-built_in">cd</span> <span class="hljs-variable">$download_DIR</span><br>    tar xvf ParallelIO-pio2_5_8.tar.gz 1&gt;/dev/null 2&gt;&amp;1<br>    <span class="hljs-built_in">cd</span> ParallelIO-pio2_5_8/<br><br>    <span class="hljs-built_in">export</span> CC=mpicc <br>    <span class="hljs-built_in">export</span> FC=mpif90 <br>    <span class="hljs-comment">#./configure --prefix=$libs_DIR --enable-fortran</span><br>    <span class="hljs-comment">#cmake -DNetCDF_C_PATH=$libs_DIR -DNetCDF_Fortran_PATH=$libs_DIR -DPnetCDF_PATH=$libs_DIR -DPIO_ENABLE_TIMING=OFF -DCMAKE_INSTALL_PREFIX=$libs_DIR</span><br>    cmake -DNetCDF_C_PATH=<span class="hljs-variable">$NETCDF</span> -DNetCDF_Fortran_PATH=<span class="hljs-variable">$NETCDF</span> -DPnetCDF_PATH=<span class="hljs-variable">$PNETCDF</span> -DHDF5_PATH=<span class="hljs-variable">$libs_DIR</span> -DCMAKE_INSTALL_PREFIX=<span class="hljs-variable">$libs_DIR</span> -DPIO_USE_MALLOC=ON -DCMAKE_VERBOSE_MAKEFILE=1 -DPIO_ENABLE_TIMING=OFF ./<br>    make<br>    <span class="hljs-comment">#make check</span><br>    make install<br>    <span class="hljs-built_in">cd</span> ..<br>    <span class="hljs-built_in">rm</span> -rf ParallelIO-pio2_5_8<br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== PIO (end) ====&quot;</span><br><span class="hljs-keyword">fi</span><br></code></pre></td></tr></table></figure><p>where ./ is PIO directory.</p><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs basic"><span class="hljs-symbol">568 </span>Install the project...<br><span class="hljs-symbol">569 </span>/EM/wpsze/micromamba/envs/mpas_env/bin/cmake -P cmake_install.cmake<br><span class="hljs-symbol">570 </span>-- Install configuration: <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-symbol">571 </span>-- Installing: /EM/wpsze/MPAS-A/modules_library/Library/lib/libpio.settings<br><span class="hljs-symbol">572 </span>-- Installing: /EM/wpsze/MPAS-A/modules_library/Library/lib/libpioc.a<br><span class="hljs-symbol">573 </span>-- Installing: /EM/wpsze/MPAS-A/modules_library/Library/include/pio.h<br><span class="hljs-symbol">574 </span>-- Installing: /EM/wpsze/MPAS-A/modules_library/Library/include/uthash.h<br><span class="hljs-symbol">575 </span>-- Installing: /EM/wpsze/MPAS-A/modules_library/Library/lib/libpiof.a<br><span class="hljs-symbol">576 </span>-- Installing: /EM/wpsze/MPAS-A/modules_library/Library/include/pio.<span class="hljs-keyword">mod</span><br><span class="hljs-symbol">577 </span>-- Installing: /EM/wpsze/MPAS-A/modules_library/Library/include/pio_nf.<span class="hljs-keyword">mod</span><br><span class="hljs-symbol">578 </span>-- Installing: /EM/wpsze/MPAS-A/modules_library/Library/include/pio_types.<span class="hljs-keyword">mod</span><br><span class="hljs-symbol">579 </span>-- Installing: /EM/wpsze/MPAS-A/modules_library/Library/include/piolib_mod.<span class="hljs-keyword">mod</span><br><span class="hljs-symbol">580 </span>-- Installing: /EM/wpsze/MPAS-A/modules_library/Library/include/pionfget_mod.<span class="hljs-keyword">mod</span><br><span class="hljs-symbol">581 </span>-- Installing: /EM/wpsze/MPAS-A/modules_library/Library/include/pio_kinds.<span class="hljs-keyword">mod</span><br><span class="hljs-symbol">582 </span>-- Installing: /EM/wpsze/MPAS-A/modules_library/Library/include/pio_support.<span class="hljs-keyword">mod</span><br><span class="hljs-symbol">583 </span>-- Installing: /EM/wpsze/MPAS-A/modules_library/Library/include/piodarray.<span class="hljs-keyword">mod</span><br><span class="hljs-symbol">584 </span>-- Installing: /EM/wpsze/MPAS-A/modules_library/Library/include/pionfatt_mod.<span class="hljs-keyword">mod</span><br><span class="hljs-symbol">585 </span>-- Installing: /EM/wpsze/MPAS-A/modules_library/Library/include/pionfput_mod.<span class="hljs-keyword">mod</span><br></code></pre></td></tr></table></figure><p>Output files are,</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash"> $ <span class="hljs-built_in">ls</span> Library/lib/*pio*<br>Library/lib/libpioc.a  Library/lib/libpiof.a<br> $ <span class="hljs-built_in">ls</span> Library/include/*pio*<br>Library/include/H5FDmpio.h  Library/include/piodarray.mod  Library/include/piolib_mod.mod    Library/include/pionfget_mod.mod  Library/include/pio_support.mod<br>Library/include/mpiof.h     Library/include/pio.h          Library/include/pio.mod           Library/include/pio_nf.mod        Library/include/pio_types.mod<br>Library/include/mpio.h      Library/include/pio_kinds.mod  Library/include/pionfatt_mod.mod  Library/include/pionfput_mod.mod<br></code></pre></td></tr></table></figure><p>Ref: 1. <a href="https://forum.mmm.ucar.edu/threads/mpas-a-installation-failed-due-to-pio1-f90-and-pio2-f90.9902/">MPAS-A installation failed due to pio1.f90 and pio2.f90</a> 2.</p>]]></content>
    
    
    <categories>
      
      <category>MPAS</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Installation</tag>
      
      <tag>PIO</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MPAS | install Metis</title>
    <link href="/2024/05/31/MPAS_install_metis_error/"/>
    <url>/2024/05/31/MPAS_install_metis_error/</url>
    
    <content type="html"><![CDATA[<h1 id="metis---serial-graph-partitioning-and-fill-reducing-matrix-ordering">METIS - Serial Graph Partitioning and Fill-reducing Matrix Ordering</h1><p><a href="http://glaros.dtc.umn.edu/gkhome/metis/metis/overview">METIS</a> is a set of serial programs for partitioning graphs, partitioning finite element meshes, and producing fill reducing orderings for sparse matrices. The algorithms implemented in METIS are based on the multilevel recursive-bisection, multilevel k-way, and multi-constraint partitioning schemes developed in our lab.</p><h1 id="issue-solution">Issue &amp; Solution</h1><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs clean">############################## metis ############################<br><span class="hljs-keyword">if</span> [[ $&#123;do_metis&#125; == <span class="hljs-literal">True</span> ]]; then<br>echo <span class="hljs-string">&quot;=== metis ====&quot;</span><br>cd $download_DIR<br>tar xvf metis<span class="hljs-number">-5.1</span><span class="hljs-number">.0</span>.tar.gz <span class="hljs-number">1</span>&gt;/dev/null <span class="hljs-number">2</span>&gt;&amp;<span class="hljs-number">1</span><br>cd metis<span class="hljs-number">-5.1</span><span class="hljs-number">.0</span>/<br>#./configure --prefix=$libs_DIR<br><br>make config prefix=$libs_DIR<br>make<br>#make check<br>make install<br>cd ..<br>rm -rf metis<span class="hljs-number">-5.1</span><span class="hljs-number">.0</span><br>echo <span class="hljs-string">&quot;=== metis (end) ====&quot;</span><br>fi<br></code></pre></td></tr></table></figure><p>Output files are,</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash"> $ <span class="hljs-built_in">ls</span> Library/bin/*meti*<br>Library/bin/gpmetis  Library/bin/m2gmetis  Library/bin/mpmetis  Library/bin/ndmetis<br> $ <span class="hljs-built_in">ls</span> Library/lib/*meti*<br>Library/lib/libmetis.a<br> $ <span class="hljs-built_in">ls</span> Library/include/*meti*<br>Library/include/metis.h<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>MPAS</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Installation</tag>
      
      <tag>Metis</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MPAS | MPAS Installation</title>
    <link href="/2024/05/31/MPAS_installation/"/>
    <url>/2024/05/31/MPAS_installation/</url>
    
    <content type="html"><![CDATA[<h1 id="for-mpasv7.0-and-above">For MPASv7.0 and above,</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/bash</span><br><br><span class="hljs-comment">#------------------------------------------------#</span><br><span class="hljs-comment">#Author:         wpsze</span><br><span class="hljs-comment">#Email：         </span><br><span class="hljs-comment">#date:           </span><br><span class="hljs-comment">#Version:        0.0 </span><br><span class="hljs-comment">#Description:    Install libraries that MPAS needs </span><br><span class="hljs-comment">#Copyright (C)： 2022 All rights reserved</span><br><span class="hljs-comment">#------------------------------------------------#</span><br><br><span class="hljs-comment">## ./mpas_env_install_gcc10_3_0.sh 2&gt;&amp;1 |tee log.log</span><br><br><span class="hljs-comment">############################## Directory Listing ############################</span><br><span class="hljs-built_in">export</span> HOME=`<span class="hljs-built_in">pwd</span>`<br><br><span class="hljs-built_in">source</span> /home/wpsze/MPAS-A/mpas_env.sh<br><br>gcc --version<br>g++ --version<br>gfortran --version<br>mpif90 --version<br>mpicc --version<br>make --version<br>cmake --version<br><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$NETCDF</span><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$PNETCDF</span><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$PIO</span><br><br><span class="hljs-comment">##--Intel MPI与Open MPI、MPICH等MPI实现不同：</span><br><span class="hljs-comment">##--mpiicc、mpiicpc和mpiifort命令：使用Intel编译器</span><br><span class="hljs-comment">##--mpicc、mpif90和mpifc命令：默认使用GNU编译器</span><br><br>do_init_atmosphere=True <span class="hljs-comment"># True, False</span><br>do_atmosphere=True<br>do_build_tables=True<br><br>mpas_version=<span class="hljs-string">&quot;MPASv8&quot;</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Copy MPAS-Model to build-mpas ... &quot;</span><br><span class="hljs-built_in">rm</span> -rf build-mpas<br><span class="hljs-built_in">cp</span> -r MPAS-Model-8.0.0 build-mpas<br><span class="hljs-built_in">cd</span> build-mpas<br><br><span class="hljs-comment">############################## init_atmosphere ############################ -g -O0 -fbacktrace</span><br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$&#123;do_init_atmosphere&#125;</span> == True ]]; <span class="hljs-keyword">then</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== init_atmosphere ====&quot;</span><br><br>make clean CORE=init_atmosphere<br>make clean CORE=atmosphere<br><br><span class="hljs-comment"># mpas_dmpar.F:</span><br> <span class="hljs-comment"># call MPI_Allreduce(inArray, outArray, nElements, MPI_INTEGERKIND, MPI_MAX, dminfo % comm, mpi_ierr) </span><br><span class="hljs-comment"># Warning: Rank mismatch between actual argument at (1) and actual argument at (2) (scalar and rank-1)</span><br><br><span class="hljs-comment">#export FFLAGS=&quot;-w -fallow-argument-mismatch -O2&quot;</span><br><span class="hljs-comment">#export FCFLAGS=&quot;-w -fallow-argument-mismatch -O2&quot;</span><br><br><span class="hljs-comment"># make gfortran CORE=init_atmosphere PRECISION=single DEBUG=true USE_PIO2=true &gt;&amp; log_build2.txt</span><br><br>make -j8 gfortran CORE=init_atmosphere PRECISION=single USE_PIO2=<span class="hljs-literal">true</span> 2&gt;&amp;1 |<span class="hljs-built_in">tee</span> log_build_init.txt<br><br><span class="hljs-comment">### Check MPAS model.</span><br><span class="hljs-comment">#ls -la init_atmosphere_model</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== init_atmosphere (end) ====&quot;</span><br>: <span class="hljs-string">&#x27;</span><br><span class="hljs-string">*******************************************************************************</span><br><span class="hljs-string">MPAS was built with default single-precision reals.</span><br><span class="hljs-string">Debugging is off.</span><br><span class="hljs-string">Parallel version is on.</span><br><span class="hljs-string">Papi libraries are off.</span><br><span class="hljs-string">TAU Hooks are off.</span><br><span class="hljs-string">MPAS was built without OpenMP support.</span><br><span class="hljs-string">MPAS was built with .F files.</span><br><span class="hljs-string">The native timer interface is being used</span><br><span class="hljs-string">Using the PIO 2 library.</span><br><span class="hljs-string">*******************************************************************************</span><br><span class="hljs-string">make[1]: Leaving directory /home/wpsze/MPAS-A/mpasv73/MPAS-Model-7.3</span><br><span class="hljs-string">If compilation of the init_atmosphere core was successful, we should also have an executable file named init_atmosphere_model</span><br><span class="hljs-string">&#x27;</span><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-comment">############################## atmosphere_model ############################</span><br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$&#123;do_atmosphere&#125;</span> == True ]]; <span class="hljs-keyword">then</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== atmosphere_model ====&quot;</span><br><span class="hljs-comment"># To preserve all executables except atmosphere_model and clean the MPAS infrastructure, run: </span><br>make clean CORE=atmosphere<br><br><span class="hljs-comment">#export FFLAGS=&quot;-w -fallow-argument-mismatch -O2&quot;</span><br><span class="hljs-comment">#export FCFLAGS=&quot;-w -fallow-argument-mismatch -O2&quot;</span><br><br><span class="hljs-comment"># DEBUG=true</span><br><br>make gfortran CORE=atmosphere PRECISION=single USE_PIO2=<span class="hljs-literal">true</span> 2&gt;&amp;1 |<span class="hljs-built_in">tee</span> log_build_atm.txt<br><br><span class="hljs-comment">### Check MPAS model.</span><br><span class="hljs-comment">#ls -la atmosphere_model</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== atmosphere_model (end) ====&quot;</span><br>: <span class="hljs-string">&#x27;</span><br><span class="hljs-string">*******************************************************************************</span><br><span class="hljs-string">MPAS was built with default single-precision reals.</span><br><span class="hljs-string">Debugging is off.</span><br><span class="hljs-string">Parallel version is on.</span><br><span class="hljs-string">Papi libraries are off.</span><br><span class="hljs-string">TAU Hooks are off.</span><br><span class="hljs-string">MPAS was built without OpenMP support.</span><br><span class="hljs-string">MPAS was built with .F files.</span><br><span class="hljs-string">The native timer interface is being used</span><br><span class="hljs-string">Using the PIO 2 library.</span><br><span class="hljs-string">*******************************************************************************</span><br><span class="hljs-string">&#x27;</span><br><br><span class="hljs-built_in">wait</span><br><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-keyword">if</span> [[ -f atmosphere_model ]]; <span class="hljs-keyword">then</span><br><span class="hljs-built_in">mkdir</span> -p <span class="hljs-variable">$HOME</span>/<span class="hljs-variable">$&#123;mpas_version&#125;</span><br><span class="hljs-built_in">mv</span> streams.init_atmosphere <span class="hljs-variable">$HOME</span>/<span class="hljs-variable">$&#123;mpas_version&#125;</span><br><span class="hljs-built_in">mv</span> namelist.init_atmosphere <span class="hljs-variable">$HOME</span>/<span class="hljs-variable">$&#123;mpas_version&#125;</span><br><span class="hljs-built_in">mv</span> init_atmosphere_model <span class="hljs-variable">$HOME</span>/<span class="hljs-variable">$&#123;mpas_version&#125;</span><br><br><span class="hljs-built_in">mv</span> atmosphere_model <span class="hljs-variable">$HOME</span>/<span class="hljs-variable">$&#123;mpas_version&#125;</span><br><span class="hljs-built_in">mv</span> build_tables <span class="hljs-variable">$HOME</span>/<span class="hljs-variable">$&#123;mpas_version&#125;</span><br><span class="hljs-built_in">mv</span> namelist.atmosphere <span class="hljs-variable">$HOME</span>/<span class="hljs-variable">$&#123;mpas_version&#125;</span><br><span class="hljs-built_in">mv</span> streams.atmosphere <span class="hljs-variable">$HOME</span>/<span class="hljs-variable">$&#123;mpas_version&#125;</span><br><span class="hljs-built_in">mv</span> stream_list.atmosphere.diagnostics <span class="hljs-variable">$HOME</span>/<span class="hljs-variable">$&#123;mpas_version&#125;</span><br><span class="hljs-built_in">mv</span> stream_list.atmosphere.output <span class="hljs-variable">$HOME</span>/<span class="hljs-variable">$&#123;mpas_version&#125;</span><br><span class="hljs-built_in">mv</span> stream_list.atmosphere.surface <span class="hljs-variable">$HOME</span>/<span class="hljs-variable">$&#123;mpas_version&#125;</span><br><br><span class="hljs-built_in">mv</span> ./src/core_atmosphere/physics/physics_wrf/files/* <span class="hljs-variable">$HOME</span>/<span class="hljs-variable">$&#123;mpas_version&#125;</span>/<br><br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$&#123;do_build_tables&#125;</span> == True ]]; <span class="hljs-keyword">then</span><br><span class="hljs-built_in">cd</span> <span class="hljs-variable">$HOME</span>/<span class="hljs-variable">$&#123;mpas_version&#125;</span><br>./build_tables<br><span class="hljs-keyword">fi</span><br><br><span class="hljs-keyword">fi</span><br></code></pre></td></tr></table></figure><p>and,</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/bash</span><br><br><span class="hljs-comment">#------------------------------------------------#</span><br><span class="hljs-comment">#Author:         wpsze</span><br><span class="hljs-comment">#homeail：        </span><br><span class="hljs-comment">#date:           </span><br><span class="hljs-comment">#Version:        0.0 </span><br><span class="hljs-comment">#Description:    Install libraries that MPAS needs </span><br><span class="hljs-comment">#Copyright (C)： 2022 All rights reserved</span><br><span class="hljs-comment">#------------------------------------------------#</span><br><br><span class="hljs-comment">############################## Directory Listing ############################</span><br><span class="hljs-built_in">export</span> HOME=`<span class="hljs-built_in">pwd</span>`<br><span class="hljs-built_in">export</span> download_DIR=<span class="hljs-variable">$HOME</span>/mpas_install/<br><span class="hljs-built_in">export</span> libs_DIR=<span class="hljs-variable">$HOME</span>/Library/<br><br><span class="hljs-built_in">export</span> PATH=/home/wpsze/GNU_GCC/Library/gcc-v9.3.0/bin:<span class="hljs-variable">$PATH</span><br><span class="hljs-built_in">export</span> LD_LIBRARY_PATH=/home/wpsze/GNU_GCC/Library/gcc-v9.3.0/lib/<span class="hljs-variable">$&#123;LD_LIBRARY_PATH:+:$LD_LIBRARY_PATH&#125;</span><br><span class="hljs-comment">#export LD_LIBRARY_PATH=/home/wpsze/GNU_GCC/Library/gcc-v9.3.0/lib:$LD_LIBRARY_PATH</span><br><span class="hljs-built_in">export</span> LD_LIBRARY_PATH=/home/wpsze/GNU_GCC/Library/gcc-v9.3.0/lib64:<span class="hljs-variable">$LD_LIBRARY_PATH</span><br><br><span class="hljs-built_in">export</span> LD_LIBRARY_PATH=<span class="hljs-variable">$libs_DIR</span>/lib:<span class="hljs-variable">$LD_LIBRARY_PATH</span><br><span class="hljs-built_in">export</span> LDFLAGS=-L<span class="hljs-variable">$libs_DIR</span>/lib<br><span class="hljs-built_in">export</span> CPPFLAGS=-I<span class="hljs-variable">$libs_DIR</span>/include<br><br><span class="hljs-built_in">source</span> /home/wpsze/micromamba/etc/profile.d/micromamba.sh <span class="hljs-comment"># install cmake</span><br>micromamba activate mpas_env<br><br>gcc --version<br>gfortran --version<br><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$HOME</span><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$download_DIR</span><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$libs_DIR</span><br><br><span class="hljs-built_in">mkdir</span> -p mpas_install<br><span class="hljs-built_in">mkdir</span> -p Library<br><br>do_download=False <span class="hljs-comment"># True or False</span><br>compile_all=True<br><br><span class="hljs-comment"># Currently Loaded Modules:</span><br><span class="hljs-comment">#  1) ncarenv/1.0 (xx)      4) ncarcompilers/1.0 (xx)  7) pnetcdf/1.11.2  10) ncview/2.1.7 (already)</span><br><span class="hljs-comment">#  2) ncarbinlibs/1.1 (xx)  5) netcdf/4.7.0        8) pio/1.9.23 (2.5.2)      11) metis/5.1.0</span><br><span class="hljs-comment">#  3) gnu/8.3.0 (done)         6) mpich/3.3.1         9) ncl/6.6.2 (already)       12) hdf5/1.10.5</span><br><br>do_mpich=False<br>do_zlib=False<br>do_hdf5=False<br>do_pnetcdf=False<br>do_netcdfC=False<br>do_netcdfF=False<br>do_pio=False<br>do_metis=True<br><br><span class="hljs-comment">############################## Downloading Libraries ############################</span><br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$do_download</span>  == True ]]; <span class="hljs-keyword">then</span><br>    <span class="hljs-built_in">cd</span> <span class="hljs-variable">$download_DIR</span><br>    wget -c https://zlib.net/zlib-1.2.13.tar.gz<br>    wget -c https://www.gfd-dennou.org/arch/netcdf/unidata-mirror/netcdf-c-4.7.4.tar.gz<br>    wget -c https://www.gfd-dennou.org/arch/netcdf/unidata-mirror/netcdf-fortran-4.5.3.tar.gz<br>    <span class="hljs-comment"># wget -c https://github.com/pmodels/mpich/releases/download/v4.0.2/mpich-4.0.2.tar.gz</span><br>    wget -c https://www.mpich.org/static/downloads/3.3.1/mpich-3.3.1.tar.gz<br>    wget -c https://parallel-netcdf.github.io/Release/pnetcdf-1.11.2.tar.gz <br>    <span class="hljs-comment"># Pio is from https://github.com/NCAR/ParallelIO/releases</span><br>    <span class="hljs-comment"># metis is from http://glaros.dtc.umn.edu/gkhome/metis/metis/download</span><br>    wget -c https://hdf-wordpress-1.s3.amazonaws.com/wp-content/uploads/manual/HDF5/HDF5_1_12_0/source/hdf5-1.12.0.tar.gz<br><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$compile_all</span> == True ]]; <span class="hljs-keyword">then</span><br><span class="hljs-comment">###################################################################</span><br><span class="hljs-built_in">export</span> LD_LIBRARY_PATH=<span class="hljs-variable">$libs_DIR</span>/lib:<span class="hljs-variable">$LD_LIBRARY_PATH</span><br><span class="hljs-built_in">export</span> LDFLAGS=-L<span class="hljs-variable">$libs_DIR</span>/lib<br><span class="hljs-built_in">export</span> CPPFLAGS=-I<span class="hljs-variable">$libs_DIR</span>/include<br><span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$libs_DIR</span>/bin:<span class="hljs-variable">$PATH</span><br><br><span class="hljs-comment">#export PNETCDF_PATH=$libs_DIR/bin:$PATH</span><br><span class="hljs-comment">#export PNETCDF=$libs_DIR/bin:$PATH</span><br><br><span class="hljs-comment">#export NETCDF_PATH=$libs_DIR/bin:$PATH</span><br><span class="hljs-comment">#export NETCDF=$libs_DIR/bin:$PATH</span><br><br><span class="hljs-comment">#export PIO=$libs_DIR/bin:$PATH</span><br><br><span class="hljs-comment">############################## MPICH ############################</span><br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$&#123;do_mpich&#125;</span>  == True ]]; <span class="hljs-keyword">then</span><br><span class="hljs-comment">#export PATH=$libs_DIR/gcc-v8.3.0/bin:$PATH</span><br><span class="hljs-comment">#export LD_LIBRARY_PATH=$libs_DIR/gcc-v8.3.0/lib:$LD_LIBRARY_PATH</span><br><span class="hljs-comment">#export LD_LIBRARY_PATH=$libs_DIR/gcc-v8.3.0/lib64:$LD_LIBRARY_PATH</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== MPICH ====&quot;</span><br><span class="hljs-built_in">cd</span> <span class="hljs-variable">$download_DIR</span><br>tar xvf mpich-4.0.2.tar.gz 1&gt;/dev/null 2&gt;&amp;1  <span class="hljs-comment"># 3.3.1 4.0.2</span><br><span class="hljs-built_in">cd</span> mpich-4.0.2/<br><br>./configure --prefix=<span class="hljs-variable">$libs_DIR</span> --with-device=ch3 <span class="hljs-comment">#--enable-pic</span><br>make -j 4<br>make check<br>make install<br><span class="hljs-comment">#make testing</span><br><span class="hljs-built_in">cd</span> ..<br><span class="hljs-built_in">rm</span> -rf mpich-4.0.2<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== MPICH (end) ====&quot;</span><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-comment">### Compilers</span><br><span class="hljs-comment">## commment out for mpich</span><br><span class="hljs-built_in">export</span> SERIAL_FC=gfortran<br><span class="hljs-built_in">export</span> SERIAL_F77=gfortran<br><span class="hljs-built_in">export</span> SERIAL_CC=gcc<br><span class="hljs-built_in">export</span> SERIAL_CXX=g++<br><span class="hljs-built_in">export</span> MPI_FC=mpifort<br><span class="hljs-built_in">export</span> MPI_F77=mpifort<br><span class="hljs-built_in">export</span> MPI_F90=mpifort<br><span class="hljs-built_in">export</span> MPI_CC=mpicc<br><span class="hljs-built_in">export</span> MPI_CXX=mpic++<br><span class="hljs-comment">### all serial are same as MPI</span><br><span class="hljs-built_in">export</span> FC=<span class="hljs-variable">$&#123;MPI_FC&#125;</span><br><span class="hljs-built_in">export</span> F77=<span class="hljs-variable">$&#123;MPI_F77&#125;</span><br><span class="hljs-built_in">export</span> F90=<span class="hljs-variable">$&#123;MPI_F77&#125;</span><br><span class="hljs-built_in">export</span> CC=<span class="hljs-variable">$&#123;MPI_F77&#125;</span><br><span class="hljs-built_in">export</span> CXX=<span class="hljs-variable">$&#123;MPI_F77&#125;</span><br><br><span class="hljs-comment">############################## zlib ############################ *** zlib test OK ***</span><br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$&#123;do_zlib&#125;</span>  == True ]]; <span class="hljs-keyword">then</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== zlib ====&quot;</span><br><span class="hljs-built_in">cd</span> <span class="hljs-variable">$download_DIR</span><br>tar xvf zlib-1.2.13.tar.gz 1&gt;/dev/null 2&gt;&amp;1 <br><span class="hljs-built_in">cd</span> zlib-1.2.13/<br><br>./configure --prefix=<span class="hljs-variable">$libs_DIR</span> <span class="hljs-comment">#--static</span><br>make -j 4<br>make install<br>make check<br><span class="hljs-built_in">cd</span> ..<br><span class="hljs-built_in">rm</span> -rf zlib-1.2.13<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== zlib (end) ====&quot;</span><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-comment">############################## HDF5 ############################ </span><br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$&#123;do_hdf5&#125;</span> == True ]]; <span class="hljs-keyword">then</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== hdf5 ====&quot;</span><br><span class="hljs-built_in">cd</span> <span class="hljs-variable">$download_DIR</span><br>tar xvf hdf5-1.12.0.tar.gz 1&gt;/dev/null 2&gt;&amp;1 <br><span class="hljs-built_in">cd</span> hdf5-1.12.0/<br><br>./configure --prefix=<span class="hljs-variable">$libs_DIR</span> --enable-parallel --with-zlib=<span class="hljs-variable">$libs_DIR</span> --enable-fortran <span class="hljs-comment">#--disable-shared</span><br>make -j 4<br>make check<br>make install<br><span class="hljs-built_in">cd</span> ..<br><span class="hljs-built_in">rm</span> -rf hdf5-1.12.0<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== hdf5 (end) ====&quot;</span><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-comment">############################## pnetcdf ############################ PnetCDF has been successfully installed </span><br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$&#123;do_pnetcdf&#125;</span> == True ]]; <span class="hljs-keyword">then</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== pnetcdf ====&quot;</span><br><span class="hljs-built_in">cd</span> <span class="hljs-variable">$download_DIR</span><br>tar xvf pnetcdf-1.11.2.tar.gz 1&gt;/dev/null 2&gt;&amp;1 <br><span class="hljs-built_in">cd</span> pnetcdf-1.11.2/<br><br>./configure --prefix=<span class="hljs-variable">$libs_DIR</span><br>make -j 4<br>make check<br>make ptest<br>make testing<br>make install<br><span class="hljs-built_in">cd</span> ..<br><span class="hljs-built_in">rm</span> -rf pnetcdf-1.11.2<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== pnetcdf (end) ====&quot;</span><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-comment">############################## netcdf-C ############################  Congratulations! You have successfully installed netCDF!</span><br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$&#123;do_netcdfC&#125;</span> == True ]]; <span class="hljs-keyword">then</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== netcdf-C ====&quot;</span><br><span class="hljs-comment">## -disable-dap：--disable-dap的原因是缺少一个‘curl’的lib</span><br><span class="hljs-comment">## 4.1.3以后的版本Fortran和C分开了。把disable--netcdf-4 写进去也无所谓</span><br><span class="hljs-built_in">cd</span> <span class="hljs-variable">$download_DIR</span><br>tar xvf netcdf-c-4.7.4.tar.gz 1&gt;/dev/null 2&gt;&amp;1 <br><span class="hljs-built_in">cd</span> netcdf-c-4.7.4/<br><br><span class="hljs-comment"># have to define below parameters</span><br><span class="hljs-built_in">export</span> FC=mpifort<br><span class="hljs-built_in">export</span> F77=mpifort<br><span class="hljs-built_in">export</span> F90=mpifort<br><span class="hljs-built_in">export</span> CC=mpicc<br><span class="hljs-built_in">export</span> CXX=mpic++<br><br><span class="hljs-comment">#export LIBS=&quot;-lhdf5_hl -lhdf5 -lz -ldl&quot;</span><br><br><span class="hljs-built_in">export</span> LD_LIBRARY_PATH=<span class="hljs-variable">$libs_DIR</span>/lib:<span class="hljs-variable">$LD_LIBRARY_PATH</span><br><span class="hljs-built_in">export</span> LDFLAGS=-L<span class="hljs-variable">$libs_DIR</span>/lib<br><span class="hljs-built_in">export</span> CPPFLAGS=-I<span class="hljs-variable">$libs_DIR</span>/include<br><br><span class="hljs-comment">#./configure --prefix=$libs_DIR --disable-dap --enable-pnetcdf --enable-netcdf4 --enable-cdf5 --enable-parallel-tests --disable-shared</span><br>./configure --prefix=<span class="hljs-variable">$libs_DIR</span> --enable-shared --enable-netcdf4 --disable-filter-testing --disable-dap<br>make -j 4 <br>make check<br>make install<br><span class="hljs-built_in">cd</span> ..<br><span class="hljs-built_in">rm</span> -rf netcdf-c-4.7.4<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== netcdf-C (end) ====&quot;</span><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-comment">############################## netcdf-F ############################ </span><br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$&#123;do_netcdfF&#125;</span> == True ]]; <span class="hljs-keyword">then</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== netcdf-F ====&quot;</span><br><span class="hljs-built_in">cd</span> <span class="hljs-variable">$download_DIR</span><br>tar xvf netcdf-fortran-4.5.3.tar.gz 1&gt;/dev/null 2&gt;&amp;1 <br><span class="hljs-built_in">cd</span> netcdf-fortran-4.5.3/<br><br><br><span class="hljs-built_in">export</span> LD_LIBRARY_PATH=<span class="hljs-variable">$libs_DIR</span>/lib:<span class="hljs-variable">$LD_LIBRARY_PATH</span><br><span class="hljs-built_in">export</span> LDFLAGS=-L<span class="hljs-variable">$libs_DIR</span>/lib<br><span class="hljs-built_in">export</span> CPPFLAGS=-I<span class="hljs-variable">$libs_DIR</span>/include<br><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># configure: error: netcdf-c version 4.7.4 or greater is required</span><br><br>nc-config --cflags<br>nc-config --libs<br>./configure --prefix=<span class="hljs-variable">$libs_DIR</span> --enable-shared <span class="hljs-comment">#--enable-parallel-tests #--disable-shared</span><br><br><span class="hljs-comment">#CFLAGS=$(nc-config --cflags) LDFLAGS=$(nc-config --libs) ./configure --prefix=$libs_DIR --enable-parallel-tests #--disable-shared</span><br><br>make -j 4 <br>make check<br>make install<br><span class="hljs-built_in">cd</span> ..<br><span class="hljs-built_in">rm</span> -rf netcdf-fortran-4.5.3<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== netcdf-F (end) ====&quot;</span><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-comment">############################## Pio ############################</span><br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$&#123;do_pio&#125;</span> == True ]]; <span class="hljs-keyword">then</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== PIO ====&quot;</span><br><span class="hljs-built_in">cd</span> <span class="hljs-variable">$download_DIR</span><br>tar xvf ParallelIO-pio2_5_8.tar.gz 1&gt;/dev/null 2&gt;&amp;1<br><span class="hljs-built_in">cd</span> ParallelIO-pio2_5_8/<br><br><span class="hljs-built_in">export</span> CC=mpicc <br><span class="hljs-built_in">export</span> FC=mpif90 <br><span class="hljs-comment">#./configure --prefix=$libs_DIR --enable-fortran</span><br><span class="hljs-comment">#cmake -DNetCDF_C_PATH=$libs_DIR -DNetCDF_Fortran_PATH=$libs_DIR -DPnetCDF_PATH=$libs_DIR -DPIO_ENABLE_TIMING=OFF -DCMAKE_INSTALL_PREFIX=$libs_DIR</span><br>cmake -DNetCDF_C_PATH=<span class="hljs-variable">$NETCDF</span> -DNetCDF_Fortran_PATH=<span class="hljs-variable">$NETCDF</span> -DPnetCDF_PATH=<span class="hljs-variable">$PNETCDF</span> -DHDF5_PATH=<span class="hljs-variable">$libs_DIR</span> -DCMAKE_INSTALL_PREFIX=<span class="hljs-variable">$libs_DIR</span> -DPIO_USE_MALLOC=ON -DCMAKE_VERBOSE_MAKEFILE=1 -DPIO_ENABLE_TIMING=OFF ./<br>make<br><span class="hljs-comment">#make check</span><br>make install<br><span class="hljs-built_in">cd</span> ..<br><span class="hljs-built_in">rm</span> -rf ParallelIO-pio2_5_8<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== PIO (end) ====&quot;</span><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-comment">############################## metis ############################</span><br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$&#123;do_metis&#125;</span> == True ]]; <span class="hljs-keyword">then</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== metis ====&quot;</span><br><span class="hljs-built_in">cd</span> <span class="hljs-variable">$download_DIR</span><br>tar xvf metis-5.1.0.tar.gz 1&gt;/dev/null 2&gt;&amp;1<br><span class="hljs-built_in">cd</span> metis-5.1.0/<br><span class="hljs-comment">#./configure --prefix=$libs_DIR</span><br><br>make config prefix=<span class="hljs-variable">$libs_DIR</span><br>make<br><span class="hljs-comment">#make check</span><br>make install<br><span class="hljs-built_in">cd</span> ..<br><span class="hljs-built_in">rm</span> -rf metis-5.1.0<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== metis (end) ====&quot;</span><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-keyword">fi</span><br></code></pre></td></tr></table></figure><h1 id="for-mpasv6.3-and-before">For MPASv6.3 and before</h1><p>Install cmake, curl and unzip !!! {:.warning}</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">source</span> /home/wpsze/micromamba/etc/profile.d/micromamba.sh <span class="hljs-comment"># install cmake</span><br>micromamba activate mpas_env<br></code></pre></td></tr></table></figure><h1 id="mpas_env.sh">mpas_env.sh</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/bash</span><br><br><span class="hljs-comment">#------------------------------------------------#</span><br><span class="hljs-comment">#Author:         wpsze</span><br><span class="hljs-comment">#Email：         </span><br><span class="hljs-comment">#date:           2022-10-21 23:13:49</span><br><span class="hljs-comment">#Version:        0.0 </span><br><span class="hljs-comment">#Description:    The purpose of the script</span><br><span class="hljs-comment">#Copyright (C)： 2022 All rights reserved</span><br><span class="hljs-comment">#------------------------------------------------#</span><br><br><span class="hljs-comment"># Install: make/cmake</span><br><span class="hljs-comment"># Actually: can install gnu </span><br><span class="hljs-built_in">source</span> /home/wpsze/micromamba/etc/profile.d/micromamba.sh<br>micromamba activate mpas_env<br><br><span class="hljs-built_in">export</span> libs_DIR=/EM/wpsze/MPAS-A/modules_library/Library/<br><br><span class="hljs-comment"># GCC env</span><br><span class="hljs-built_in">export</span> PATH=/home/wpsze/GNU_GCC/Library/gcc-v9.3.0/bin:<span class="hljs-variable">$PATH</span><br><span class="hljs-built_in">export</span> LD_LIBRARY_PATH=/home/wpsze/GNU_GCC/Library/gcc-v9.3.0/lib/<span class="hljs-variable">$&#123;LD_LIBRARY_PATH:+:$LD_LIBRARY_PATH&#125;</span><br><span class="hljs-built_in">export</span> LD_LIBRARY_PATH=/home/wpsze/GNU_GCC/Library/gcc-v9.3.0/lib64:<span class="hljs-variable">$LD_LIBRARY_PATH</span><br><br><span class="hljs-comment"># MPAS env </span><br><span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$libs_DIR</span>/bin:<span class="hljs-variable">$PATH</span><br><span class="hljs-built_in">export</span> LD_LIBRARY_PATH=<span class="hljs-variable">$libs_DIR</span>/lib:<span class="hljs-variable">$LD_LIBRARY_PATH</span><br><span class="hljs-built_in">export</span> LDFLAGS=-L<span class="hljs-variable">$libs_DIR</span>/lib<br><span class="hljs-built_in">export</span> CPPFLAGS=-I<span class="hljs-variable">$libs_DIR</span>/include<br><br><span class="hljs-built_in">export</span> PNETCDF_PATH=<span class="hljs-variable">$libs_DIR</span><br><span class="hljs-built_in">export</span> PNETCDF=<span class="hljs-variable">$libs_DIR</span><br><span class="hljs-built_in">export</span> NETCDF_PATH=<span class="hljs-variable">$libs_DIR</span><br><span class="hljs-built_in">export</span> NETCDF=<span class="hljs-variable">$libs_DIR</span><br><span class="hljs-built_in">export</span> PIO=<span class="hljs-variable">$libs_DIR</span><br><br><span class="hljs-comment">##--Intel MPI与Open MPI、MPICH等MPI实现不同：</span><br><span class="hljs-comment">##--mpiicc、mpiicpc和mpiifort命令：使用Intel编译器</span><br><span class="hljs-comment">##--mpicc、mpif90和mpifc命令：默认使用GNU编译器</span><br><span class="hljs-comment">## </span><br><span class="hljs-built_in">export</span> FC=mpifort<br><span class="hljs-built_in">export</span> F77=mpifort<br><span class="hljs-built_in">export</span> F90=mpifort<br><span class="hljs-built_in">export</span> CC=mpicc<br><span class="hljs-built_in">export</span> MPIF90=mpifort<br><span class="hljs-built_in">export</span> MPIF77=mpifort<br><span class="hljs-built_in">export</span> MPIFC=mpifort<br><span class="hljs-built_in">export</span> MPICC=mpicc<br><br>gcc --version<br>gfortran --version<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>MPAS</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Installation</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MPAS | MPAS Installation (More)</title>
    <link href="/2024/05/31/MPAS_installation_more/"/>
    <url>/2024/05/31/MPAS_installation_more/</url>
    
    <content type="html"><![CDATA[<p>The repository URL can be found from the MPAS GitHub page at <a href="https://github.com/MPAS-Dev/MPAS-Model" class="uri">https://github.com/MPAS-Dev/MPAS-Model</a></p><h1 id="compiling-mpas">Compiling MPAS</h1><p>There is no “configuration” step for MPAS, unlike, e.g., for the WRF model - All build flags are either set in the top-level Makefile or on the command-line General MPAS build command:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ make target CORE=core options<br></code></pre></td></tr></table></figure><p>target can be either - <strong>clean</strong> or - <strong>gfortran</strong> - <strong>ifort</strong> - nvhpc - llvm - <strong>intel-mpi (MPASv8.1.0)</strong> ... plus a few others...</p><p>For MPAS-Atmosphere, core may be - atmosphere - init_atmosphere</p><p>options can be zero or more of - <strong>DEBUG=true</strong> - AUTOCLEAN=true - <strong>PRECISION=single</strong> - OPENMP=true</p><p>Typical build of both the init_atmosphere and atmosphere cores involves:</p><ul><li>make gfortran CORE=init_atmosphere (build init_atmosphere_model)</li><li>make clean CORE=atmosphere (clean any infrastructure files used by both init_atmosphere and atmosphere)</li><li>make gfortran CORE=atmosphere (build atmosphere_model)</li></ul><p>By default, MPAS cores are built with double-precision reals</p><p>MPAS-Atmosphere can be built in single precision - Add PRECISION=single to build commands for single-precision executables - <strong>execution time ~35% less compared with double-precision</strong> - output files approximately half as large</p><p>For mpich, - see https://www.mpich.org/static/downloads/4.2.0/mpich-4.2.0-installguide.pdf</p><h1 id="for-mpasv7.0-and-above">For MPASv7.0 and above,</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/bash</span><br><br><span class="hljs-comment">#------------------------------------------------#</span><br><span class="hljs-comment">#Author:         wpsze</span><br><span class="hljs-comment">#Email：         </span><br><span class="hljs-comment">#date:           </span><br><span class="hljs-comment">#Version:        0.0 </span><br><span class="hljs-comment">#Description:    Install libraries that MPAS needs </span><br><span class="hljs-comment">#Copyright (C)： 2022 All rights reserved</span><br><span class="hljs-comment">#------------------------------------------------#</span><br><br><span class="hljs-comment">## ./mpas_env_install_gcc10_3_0.sh 2&gt;&amp;1 |tee log.log</span><br><br><span class="hljs-comment">############################## Directory Listing ############################</span><br><span class="hljs-built_in">export</span> HOME=`<span class="hljs-built_in">pwd</span>`<br><br><span class="hljs-built_in">source</span> /home/wpsze/MPAS-A/mpas_env.sh<br><br>gcc --version<br>g++ --version<br>gfortran --version<br>mpif90 --version<br>mpicc --version<br>make --version<br>cmake --version<br><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$NETCDF</span><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$PNETCDF</span><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$PIO</span><br><br><span class="hljs-comment">##--Intel MPI与Open MPI、MPICH等MPI实现不同：</span><br><span class="hljs-comment">##--mpiicc、mpiicpc和mpiifort命令：使用Intel编译器</span><br><span class="hljs-comment">##--mpicc、mpif90和mpifc命令：默认使用GNU编译器</span><br><br>do_init_atmosphere=True <span class="hljs-comment"># True, False</span><br>do_atmosphere=True<br>do_build_tables=True<br><br>mpas_version=<span class="hljs-string">&quot;MPASv8&quot;</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Copy MPAS-Model to build-mpas ... &quot;</span><br><span class="hljs-built_in">rm</span> -rf build-mpas<br><span class="hljs-built_in">cp</span> -r MPAS-Model-8.0.0 build-mpas<br><span class="hljs-built_in">cd</span> build-mpas<br><br><span class="hljs-comment">############################## init_atmosphere ############################ -g -O0 -fbacktrace</span><br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$&#123;do_init_atmosphere&#125;</span> == True ]]; <span class="hljs-keyword">then</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== init_atmosphere ====&quot;</span><br><br>make clean CORE=init_atmosphere<br>make clean CORE=atmosphere<br><br><span class="hljs-comment"># mpas_dmpar.F:</span><br> <span class="hljs-comment"># call MPI_Allreduce(inArray, outArray, nElements, MPI_INTEGERKIND, MPI_MAX, dminfo % comm, mpi_ierr) </span><br><span class="hljs-comment"># Warning: Rank mismatch between actual argument at (1) and actual argument at (2) (scalar and rank-1)</span><br><br><span class="hljs-comment">#export FFLAGS=&quot;-w -fallow-argument-mismatch -O2&quot;</span><br><span class="hljs-comment">#export FCFLAGS=&quot;-w -fallow-argument-mismatch -O2&quot;</span><br><br><span class="hljs-comment"># make gfortran CORE=init_atmosphere PRECISION=single DEBUG=true USE_PIO2=true &gt;&amp; log_build2.txt</span><br><br>make -j8 gfortran CORE=init_atmosphere PRECISION=single USE_PIO2=<span class="hljs-literal">true</span> 2&gt;&amp;1 |<span class="hljs-built_in">tee</span> log_build_init.txt<br><br><span class="hljs-comment">### Check MPAS model.</span><br><span class="hljs-comment">#ls -la init_atmosphere_model</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== init_atmosphere (end) ====&quot;</span><br>: <span class="hljs-string">&#x27;</span><br><span class="hljs-string">*******************************************************************************</span><br><span class="hljs-string">MPAS was built with default single-precision reals.</span><br><span class="hljs-string">Debugging is off.</span><br><span class="hljs-string">Parallel version is on.</span><br><span class="hljs-string">Papi libraries are off.</span><br><span class="hljs-string">TAU Hooks are off.</span><br><span class="hljs-string">MPAS was built without OpenMP support.</span><br><span class="hljs-string">MPAS was built with .F files.</span><br><span class="hljs-string">The native timer interface is being used</span><br><span class="hljs-string">Using the PIO 2 library.</span><br><span class="hljs-string">*******************************************************************************</span><br><span class="hljs-string">make[1]: Leaving directory /home/wpsze/MPAS-A/mpasv73/MPAS-Model-7.3</span><br><span class="hljs-string">If compilation of the init_atmosphere core was successful, we should also have an executable file named init_atmosphere_model</span><br><span class="hljs-string">&#x27;</span><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-comment">############################## atmosphere_model ############################</span><br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$&#123;do_atmosphere&#125;</span> == True ]]; <span class="hljs-keyword">then</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== atmosphere_model ====&quot;</span><br><span class="hljs-comment"># To preserve all executables except atmosphere_model and clean the MPAS infrastructure, run: </span><br>make clean CORE=atmosphere<br><br><span class="hljs-comment">#export FFLAGS=&quot;-w -fallow-argument-mismatch -O2&quot;</span><br><span class="hljs-comment">#export FCFLAGS=&quot;-w -fallow-argument-mismatch -O2&quot;</span><br><br><span class="hljs-comment"># DEBUG=true</span><br><br>make gfortran CORE=atmosphere PRECISION=single USE_PIO2=<span class="hljs-literal">true</span> 2&gt;&amp;1 |<span class="hljs-built_in">tee</span> log_build_atm.txt<br><br><span class="hljs-comment">### Check MPAS model.</span><br><span class="hljs-comment">#ls -la atmosphere_model</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== atmosphere_model (end) ====&quot;</span><br>: <span class="hljs-string">&#x27;</span><br><span class="hljs-string">*******************************************************************************</span><br><span class="hljs-string">MPAS was built with default single-precision reals.</span><br><span class="hljs-string">Debugging is off.</span><br><span class="hljs-string">Parallel version is on.</span><br><span class="hljs-string">Papi libraries are off.</span><br><span class="hljs-string">TAU Hooks are off.</span><br><span class="hljs-string">MPAS was built without OpenMP support.</span><br><span class="hljs-string">MPAS was built with .F files.</span><br><span class="hljs-string">The native timer interface is being used</span><br><span class="hljs-string">Using the PIO 2 library.</span><br><span class="hljs-string">*******************************************************************************</span><br><span class="hljs-string">&#x27;</span><br><br><span class="hljs-built_in">wait</span><br><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-keyword">if</span> [[ -f atmosphere_model ]]; <span class="hljs-keyword">then</span><br><span class="hljs-built_in">mkdir</span> -p <span class="hljs-variable">$HOME</span>/<span class="hljs-variable">$&#123;mpas_version&#125;</span><br><span class="hljs-built_in">mv</span> streams.init_atmosphere <span class="hljs-variable">$HOME</span>/<span class="hljs-variable">$&#123;mpas_version&#125;</span><br><span class="hljs-built_in">mv</span> namelist.init_atmosphere <span class="hljs-variable">$HOME</span>/<span class="hljs-variable">$&#123;mpas_version&#125;</span><br><span class="hljs-built_in">mv</span> init_atmosphere_model <span class="hljs-variable">$HOME</span>/<span class="hljs-variable">$&#123;mpas_version&#125;</span><br><br><span class="hljs-built_in">mv</span> atmosphere_model <span class="hljs-variable">$HOME</span>/<span class="hljs-variable">$&#123;mpas_version&#125;</span><br><span class="hljs-built_in">mv</span> build_tables <span class="hljs-variable">$HOME</span>/<span class="hljs-variable">$&#123;mpas_version&#125;</span><br><span class="hljs-built_in">mv</span> namelist.atmosphere <span class="hljs-variable">$HOME</span>/<span class="hljs-variable">$&#123;mpas_version&#125;</span><br><span class="hljs-built_in">mv</span> streams.atmosphere <span class="hljs-variable">$HOME</span>/<span class="hljs-variable">$&#123;mpas_version&#125;</span><br><span class="hljs-built_in">mv</span> stream_list.atmosphere.diagnostics <span class="hljs-variable">$HOME</span>/<span class="hljs-variable">$&#123;mpas_version&#125;</span><br><span class="hljs-built_in">mv</span> stream_list.atmosphere.output <span class="hljs-variable">$HOME</span>/<span class="hljs-variable">$&#123;mpas_version&#125;</span><br><span class="hljs-built_in">mv</span> stream_list.atmosphere.surface <span class="hljs-variable">$HOME</span>/<span class="hljs-variable">$&#123;mpas_version&#125;</span><br><br><span class="hljs-built_in">mv</span> ./src/core_atmosphere/physics/physics_wrf/files/* <span class="hljs-variable">$HOME</span>/<span class="hljs-variable">$&#123;mpas_version&#125;</span>/<br><br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$&#123;do_build_tables&#125;</span> == True ]]; <span class="hljs-keyword">then</span><br><span class="hljs-built_in">cd</span> <span class="hljs-variable">$HOME</span>/<span class="hljs-variable">$&#123;mpas_version&#125;</span><br>./build_tables<br><span class="hljs-keyword">fi</span><br><br><span class="hljs-keyword">fi</span><br></code></pre></td></tr></table></figure><p>and,</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/bash</span><br><br><span class="hljs-comment">#------------------------------------------------#</span><br><span class="hljs-comment">#Author:         wpsze</span><br><span class="hljs-comment">#homeail：        </span><br><span class="hljs-comment">#date:           </span><br><span class="hljs-comment">#Version:        0.0 </span><br><span class="hljs-comment">#Description:    Install libraries that MPAS needs </span><br><span class="hljs-comment">#Copyright (C)： 2022 All rights reserved</span><br><span class="hljs-comment">#------------------------------------------------#</span><br><br><span class="hljs-comment">############################## Directory Listing ############################</span><br><span class="hljs-built_in">export</span> HOME=`<span class="hljs-built_in">pwd</span>`<br><span class="hljs-built_in">export</span> download_DIR=<span class="hljs-variable">$HOME</span>/mpas_install/<br><span class="hljs-built_in">export</span> libs_DIR=<span class="hljs-variable">$HOME</span>/Library/<br><br><span class="hljs-built_in">export</span> PATH=/home/wpsze/GNU_GCC/Library/gcc-v9.3.0/bin:<span class="hljs-variable">$PATH</span><br><span class="hljs-built_in">export</span> LD_LIBRARY_PATH=/home/wpsze/GNU_GCC/Library/gcc-v9.3.0/lib/<span class="hljs-variable">$&#123;LD_LIBRARY_PATH:+:$LD_LIBRARY_PATH&#125;</span><br><span class="hljs-comment">#export LD_LIBRARY_PATH=/home/wpsze/GNU_GCC/Library/gcc-v9.3.0/lib:$LD_LIBRARY_PATH</span><br><span class="hljs-built_in">export</span> LD_LIBRARY_PATH=/home/wpsze/GNU_GCC/Library/gcc-v9.3.0/lib64:<span class="hljs-variable">$LD_LIBRARY_PATH</span><br><br><span class="hljs-built_in">export</span> LD_LIBRARY_PATH=<span class="hljs-variable">$libs_DIR</span>/lib:<span class="hljs-variable">$LD_LIBRARY_PATH</span><br><span class="hljs-built_in">export</span> LDFLAGS=-L<span class="hljs-variable">$libs_DIR</span>/lib<br><span class="hljs-built_in">export</span> CPPFLAGS=-I<span class="hljs-variable">$libs_DIR</span>/include<br><br><span class="hljs-built_in">source</span> /home/wpsze/micromamba/etc/profile.d/micromamba.sh <span class="hljs-comment"># install cmake</span><br>micromamba activate mpas_env<br><br>gcc --version<br>gfortran --version<br><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$HOME</span><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$download_DIR</span><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$libs_DIR</span><br><br><span class="hljs-built_in">mkdir</span> -p mpas_install<br><span class="hljs-built_in">mkdir</span> -p Library<br><br>do_download=False <span class="hljs-comment"># True or False</span><br>compile_all=True<br><br><span class="hljs-comment"># Currently Loaded Modules:</span><br><span class="hljs-comment">#  1) ncarenv/1.0 (xx)      4) ncarcompilers/1.0 (xx)  7) pnetcdf/1.11.2  10) ncview/2.1.7 (already)</span><br><span class="hljs-comment">#  2) ncarbinlibs/1.1 (xx)  5) netcdf/4.7.0        8) pio/1.9.23 (2.5.2)      11) metis/5.1.0</span><br><span class="hljs-comment">#  3) gnu/8.3.0 (done)         6) mpich/3.3.1         9) ncl/6.6.2 (already)       12) hdf5/1.10.5</span><br><br>do_mpich=False<br>do_zlib=False<br>do_hdf5=False<br>do_pnetcdf=False<br>do_netcdfC=False<br>do_netcdfF=False<br>do_pio=False<br>do_metis=True<br><br><span class="hljs-comment">############################## Downloading Libraries ############################</span><br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$do_download</span>  == True ]]; <span class="hljs-keyword">then</span><br>    <span class="hljs-built_in">cd</span> <span class="hljs-variable">$download_DIR</span><br>    wget -c https://zlib.net/zlib-1.2.13.tar.gz<br>    wget -c https://www.gfd-dennou.org/arch/netcdf/unidata-mirror/netcdf-c-4.7.4.tar.gz<br>    wget -c https://www.gfd-dennou.org/arch/netcdf/unidata-mirror/netcdf-fortran-4.5.3.tar.gz<br>    <span class="hljs-comment"># wget -c https://github.com/pmodels/mpich/releases/download/v4.0.2/mpich-4.0.2.tar.gz</span><br>    wget -c https://www.mpich.org/static/downloads/3.3.1/mpich-3.3.1.tar.gz<br>    wget -c https://parallel-netcdf.github.io/Release/pnetcdf-1.11.2.tar.gz <br>    <span class="hljs-comment"># Pio is from https://github.com/NCAR/ParallelIO/releases</span><br>    <span class="hljs-comment"># metis is from http://glaros.dtc.umn.edu/gkhome/metis/metis/download</span><br>    wget -c https://hdf-wordpress-1.s3.amazonaws.com/wp-content/uploads/manual/HDF5/HDF5_1_12_0/source/hdf5-1.12.0.tar.gz<br><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$compile_all</span> == True ]]; <span class="hljs-keyword">then</span><br><span class="hljs-comment">###################################################################</span><br><span class="hljs-built_in">export</span> LD_LIBRARY_PATH=<span class="hljs-variable">$libs_DIR</span>/lib:<span class="hljs-variable">$LD_LIBRARY_PATH</span><br><span class="hljs-built_in">export</span> LDFLAGS=-L<span class="hljs-variable">$libs_DIR</span>/lib<br><span class="hljs-built_in">export</span> CPPFLAGS=-I<span class="hljs-variable">$libs_DIR</span>/include<br><span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$libs_DIR</span>/bin:<span class="hljs-variable">$PATH</span><br><br><span class="hljs-comment">#export PNETCDF_PATH=$libs_DIR/bin:$PATH</span><br><span class="hljs-comment">#export PNETCDF=$libs_DIR/bin:$PATH</span><br><br><span class="hljs-comment">#export NETCDF_PATH=$libs_DIR/bin:$PATH</span><br><span class="hljs-comment">#export NETCDF=$libs_DIR/bin:$PATH</span><br><br><span class="hljs-comment">#export PIO=$libs_DIR/bin:$PATH</span><br><br><span class="hljs-comment">############################## MPICH ############################</span><br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$&#123;do_mpich&#125;</span>  == True ]]; <span class="hljs-keyword">then</span><br><span class="hljs-comment">#export PATH=$libs_DIR/gcc-v8.3.0/bin:$PATH</span><br><span class="hljs-comment">#export LD_LIBRARY_PATH=$libs_DIR/gcc-v8.3.0/lib:$LD_LIBRARY_PATH</span><br><span class="hljs-comment">#export LD_LIBRARY_PATH=$libs_DIR/gcc-v8.3.0/lib64:$LD_LIBRARY_PATH</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== MPICH ====&quot;</span><br><span class="hljs-built_in">cd</span> <span class="hljs-variable">$download_DIR</span><br>tar xvf mpich-4.0.2.tar.gz 1&gt;/dev/null 2&gt;&amp;1  <span class="hljs-comment"># 3.3.1 4.0.2</span><br><span class="hljs-built_in">cd</span> mpich-4.0.2/<br><br>./configure --prefix=<span class="hljs-variable">$libs_DIR</span> --with-device=ch3 <span class="hljs-comment">#--enable-pic</span><br>make -j 4<br>make check<br>make install<br><span class="hljs-comment">#make testing</span><br><span class="hljs-built_in">cd</span> ..<br><span class="hljs-built_in">rm</span> -rf mpich-4.0.2<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== MPICH (end) ====&quot;</span><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-comment">### Compilers</span><br><span class="hljs-comment">## commment out for mpich !!</span><br><span class="hljs-built_in">export</span> SERIAL_FC=gfortran<br><span class="hljs-built_in">export</span> SERIAL_F77=gfortran<br><span class="hljs-built_in">export</span> SERIAL_CC=gcc<br><span class="hljs-built_in">export</span> SERIAL_CXX=g++<br><span class="hljs-built_in">export</span> MPI_FC=mpifort<br><span class="hljs-built_in">export</span> MPI_F77=mpifort<br><span class="hljs-built_in">export</span> MPI_F90=mpifort<br><span class="hljs-built_in">export</span> MPI_CC=mpicc<br><span class="hljs-built_in">export</span> MPI_CXX=mpic++<br><span class="hljs-comment">### all serial are same as MPI</span><br><span class="hljs-built_in">export</span> FC=<span class="hljs-variable">$&#123;MPI_FC&#125;</span><br><span class="hljs-built_in">export</span> F77=<span class="hljs-variable">$&#123;MPI_F77&#125;</span><br><span class="hljs-built_in">export</span> F90=<span class="hljs-variable">$&#123;MPI_F77&#125;</span><br><span class="hljs-built_in">export</span> CC=<span class="hljs-variable">$&#123;MPI_F77&#125;</span><br><span class="hljs-built_in">export</span> CXX=<span class="hljs-variable">$&#123;MPI_F77&#125;</span><br><br><span class="hljs-comment">############################## zlib ############################ *** zlib test OK ***</span><br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$&#123;do_zlib&#125;</span>  == True ]]; <span class="hljs-keyword">then</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== zlib ====&quot;</span><br><span class="hljs-built_in">cd</span> <span class="hljs-variable">$download_DIR</span><br>tar xvf zlib-1.2.13.tar.gz 1&gt;/dev/null 2&gt;&amp;1 <br><span class="hljs-built_in">cd</span> zlib-1.2.13/<br><br>./configure --prefix=<span class="hljs-variable">$libs_DIR</span> <span class="hljs-comment">#--static</span><br>make -j 4<br>make install<br>make check<br><span class="hljs-built_in">cd</span> ..<br><span class="hljs-built_in">rm</span> -rf zlib-1.2.13<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== zlib (end) ====&quot;</span><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-comment">############################## HDF5 ############################ </span><br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$&#123;do_hdf5&#125;</span> == True ]]; <span class="hljs-keyword">then</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== hdf5 ====&quot;</span><br><span class="hljs-built_in">cd</span> <span class="hljs-variable">$download_DIR</span><br>tar xvf hdf5-1.12.0.tar.gz 1&gt;/dev/null 2&gt;&amp;1 <br><span class="hljs-built_in">cd</span> hdf5-1.12.0/<br><br>./configure --prefix=<span class="hljs-variable">$libs_DIR</span> --enable-parallel --with-zlib=<span class="hljs-variable">$libs_DIR</span> --enable-fortran <span class="hljs-comment">#--disable-shared</span><br>make -j 4<br>make check<br>make install<br><span class="hljs-built_in">cd</span> ..<br><span class="hljs-built_in">rm</span> -rf hdf5-1.12.0<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== hdf5 (end) ====&quot;</span><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-comment">############################## pnetcdf ############################ PnetCDF has been successfully installed </span><br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$&#123;do_pnetcdf&#125;</span> == True ]]; <span class="hljs-keyword">then</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== pnetcdf ====&quot;</span><br><span class="hljs-built_in">cd</span> <span class="hljs-variable">$download_DIR</span><br>tar xvf pnetcdf-1.11.2.tar.gz 1&gt;/dev/null 2&gt;&amp;1 <br><span class="hljs-built_in">cd</span> pnetcdf-1.11.2/<br><br>./configure --prefix=<span class="hljs-variable">$libs_DIR</span><br>make -j 4<br>make check<br>make ptest<br>make testing<br>make install<br><span class="hljs-built_in">cd</span> ..<br><span class="hljs-built_in">rm</span> -rf pnetcdf-1.11.2<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== pnetcdf (end) ====&quot;</span><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-comment">############################## netcdf-C ############################  Congratulations! You have successfully installed netCDF!</span><br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$&#123;do_netcdfC&#125;</span> == True ]]; <span class="hljs-keyword">then</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== netcdf-C ====&quot;</span><br><span class="hljs-comment">## -disable-dap：--disable-dap的原因是缺少一个‘curl’的lib</span><br><span class="hljs-comment">## 4.1.3以后的版本Fortran和C分开了。把disable--netcdf-4 写进去也无所谓</span><br><span class="hljs-built_in">cd</span> <span class="hljs-variable">$download_DIR</span><br>tar xvf netcdf-c-4.7.4.tar.gz 1&gt;/dev/null 2&gt;&amp;1 <br><span class="hljs-built_in">cd</span> netcdf-c-4.7.4/<br><br><span class="hljs-comment"># have to define below parameters</span><br><span class="hljs-built_in">export</span> FC=mpifort<br><span class="hljs-built_in">export</span> F77=mpifort<br><span class="hljs-built_in">export</span> F90=mpifort<br><span class="hljs-built_in">export</span> CC=mpicc<br><span class="hljs-built_in">export</span> CXX=mpic++<br><br><span class="hljs-comment">#export LIBS=&quot;-lhdf5_hl -lhdf5 -lz -ldl&quot;</span><br><br><span class="hljs-built_in">export</span> LD_LIBRARY_PATH=<span class="hljs-variable">$libs_DIR</span>/lib:<span class="hljs-variable">$LD_LIBRARY_PATH</span><br><span class="hljs-built_in">export</span> LDFLAGS=-L<span class="hljs-variable">$libs_DIR</span>/lib<br><span class="hljs-built_in">export</span> CPPFLAGS=-I<span class="hljs-variable">$libs_DIR</span>/include<br><br><span class="hljs-comment">#./configure --prefix=$libs_DIR --disable-dap --enable-pnetcdf --enable-netcdf4 --enable-cdf5 --enable-parallel-tests --disable-shared</span><br>./configure --prefix=<span class="hljs-variable">$libs_DIR</span> --enable-shared --enable-netcdf4 --disable-filter-testing --disable-dap<br>make -j 4 <br>make check<br>make install<br><span class="hljs-built_in">cd</span> ..<br><span class="hljs-built_in">rm</span> -rf netcdf-c-4.7.4<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== netcdf-C (end) ====&quot;</span><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-comment">############################## netcdf-F ############################ </span><br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$&#123;do_netcdfF&#125;</span> == True ]]; <span class="hljs-keyword">then</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== netcdf-F ====&quot;</span><br><span class="hljs-built_in">cd</span> <span class="hljs-variable">$download_DIR</span><br>tar xvf netcdf-fortran-4.5.3.tar.gz 1&gt;/dev/null 2&gt;&amp;1 <br><span class="hljs-built_in">cd</span> netcdf-fortran-4.5.3/<br><br><br><span class="hljs-built_in">export</span> LD_LIBRARY_PATH=<span class="hljs-variable">$libs_DIR</span>/lib:<span class="hljs-variable">$LD_LIBRARY_PATH</span><br><span class="hljs-built_in">export</span> LDFLAGS=-L<span class="hljs-variable">$libs_DIR</span>/lib<br><span class="hljs-built_in">export</span> CPPFLAGS=-I<span class="hljs-variable">$libs_DIR</span>/include<br><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># configure: error: netcdf-c version 4.7.4 or greater is required</span><br><br>nc-config --cflags<br>nc-config --libs<br>./configure --prefix=<span class="hljs-variable">$libs_DIR</span> --enable-shared <span class="hljs-comment">#--enable-parallel-tests #--disable-shared</span><br><br><span class="hljs-comment">#CFLAGS=$(nc-config --cflags) LDFLAGS=$(nc-config --libs) ./configure --prefix=$libs_DIR --enable-parallel-tests #--disable-shared</span><br><br>make -j 4 <br>make check<br>make install<br><span class="hljs-built_in">cd</span> ..<br><span class="hljs-built_in">rm</span> -rf netcdf-fortran-4.5.3<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== netcdf-F (end) ====&quot;</span><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-comment">############################## Pio ############################</span><br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$&#123;do_pio&#125;</span> == True ]]; <span class="hljs-keyword">then</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== PIO ====&quot;</span><br><span class="hljs-built_in">cd</span> <span class="hljs-variable">$download_DIR</span><br>tar xvf ParallelIO-pio2_5_8.tar.gz 1&gt;/dev/null 2&gt;&amp;1<br><span class="hljs-built_in">cd</span> ParallelIO-pio2_5_8/<br><br><span class="hljs-built_in">export</span> CC=mpicc <br><span class="hljs-built_in">export</span> FC=mpif90 <br><span class="hljs-comment">#./configure --prefix=$libs_DIR --enable-fortran</span><br><span class="hljs-comment">#cmake -DNetCDF_C_PATH=$libs_DIR -DNetCDF_Fortran_PATH=$libs_DIR -DPnetCDF_PATH=$libs_DIR -DPIO_ENABLE_TIMING=OFF -DCMAKE_INSTALL_PREFIX=$libs_DIR</span><br>cmake -DNetCDF_C_PATH=<span class="hljs-variable">$NETCDF</span> -DNetCDF_Fortran_PATH=<span class="hljs-variable">$NETCDF</span> -DPnetCDF_PATH=<span class="hljs-variable">$PNETCDF</span> -DHDF5_PATH=<span class="hljs-variable">$libs_DIR</span> -DCMAKE_INSTALL_PREFIX=<span class="hljs-variable">$libs_DIR</span> -DPIO_USE_MALLOC=ON -DCMAKE_VERBOSE_MAKEFILE=1 -DPIO_ENABLE_TIMING=OFF ./<br>make<br><span class="hljs-comment">#make check</span><br>make install<br><span class="hljs-built_in">cd</span> ..<br><span class="hljs-built_in">rm</span> -rf ParallelIO-pio2_5_8<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== PIO (end) ====&quot;</span><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-comment">############################## metis ############################</span><br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$&#123;do_metis&#125;</span> == True ]]; <span class="hljs-keyword">then</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== metis ====&quot;</span><br><span class="hljs-built_in">cd</span> <span class="hljs-variable">$download_DIR</span><br>tar xvf metis-5.1.0.tar.gz 1&gt;/dev/null 2&gt;&amp;1<br><span class="hljs-built_in">cd</span> metis-5.1.0/<br><span class="hljs-comment">#./configure --prefix=$libs_DIR</span><br><br>make config prefix=<span class="hljs-variable">$libs_DIR</span><br>make<br><span class="hljs-comment">#make check</span><br>make install<br><span class="hljs-built_in">cd</span> ..<br><span class="hljs-built_in">rm</span> -rf metis-5.1.0<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=== metis (end) ====&quot;</span><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-keyword">fi</span><br></code></pre></td></tr></table></figure><h1 id="for-mpasv6.3-and-before">For MPASv6.3 and before</h1><p>Install cmake, curl and unzip !!! {:.warning}</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">source</span> /home/wpsze/micromamba/etc/profile.d/micromamba.sh <span class="hljs-comment"># install cmake</span><br>micromamba activate mpas_env<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>MPAS</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Installation</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>The orographic gravity wave drag (GWDO)</title>
    <link href="/2024/05/31/NWP_gwdo/"/>
    <url>/2024/05/31/NWP_gwdo/</url>
    
    <content type="html"><![CDATA[<p>The wave stress of orography gravity wave drag scheme</p><p><span class="math display">\[\frac{\partial U}{\partial t} = - \frac{1}{\rho} \frac{\partial \tau_x}{\partial z}\]</span></p><h1 id="gwdo">GWDO</h1><h2 id="the-gravity-wave-drag-parameterization">The gravity-wave drag parameterization</h2><p><span class="math display">\[\tau_{GWD} = \rho_0 E \frac{m}{\lambda_{eff}} G \frac{|U_0|^3}{N_0} \]</span></p><h2 id="the-blocked-layer-drag-parameterization">The blocked-layer drag parameterization</h2><p><span class="math display">\[\tau_{BLD} = \frac{1}{2} \rho_0 \frac{m}{\Delta_x^2} C_d \Delta_x^{\perp} L_x^{\perp} h_B |U_0|^2\]</span></p><h1 id="references">References</h1><ol type="1"><li>Choi, H.-J., and S.-Y. Hong (2015), An updated subgrid orographic parameterization for global atmospheric forecast models, J. Geophys. Res. Atmos., 120,12,445–12,457, doi:10.1002/ 2015JD024230.</li><li></li></ol><h1 id="applications">Applications</h1><ol type="1"><li>张涵斌, 史永强, 卢冰, 等. 2024. 尺度适应重力波拖曳方案在高分辨率数值预报中的应用研究[J]. 大气科学, 48(2): 789−802. DOI: 10.3878/j.issn.1006-9895.2304.22235</li></ol>]]></content>
    
    
    <categories>
      
      <category>NWP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>GWDO</tag>
      
      <tag>Parametrization</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MPAS | netcdf-c-4.7.4 final link failed - nonrepresentable section on output</title>
    <link href="/2024/05/30/MPAS_install_netcdf_c_nonrepresentable_error/"/>
    <url>/2024/05/30/MPAS_install_netcdf_c_nonrepresentable_error/</url>
    
    <content type="html"><![CDATA[<h1 id="issue">Issue</h1><p>In order to write netCDF-4 files, you must have the <strong><a href="https://www.unidata.ucar.edu/software/netcdf/">NetCDF-4 C library</a> (libnetcdf)</strong> - version 4.3.1 or above - available on your system, along with all supporting libraries (<em>libhdf5, libz, etc</em>). The details of this differ for each operating system.</p><p><strong>nc-config and libnetcdf.so</strong> are expected to be generated. And, check with</p><blockquote><p>nc-config --cflags nc-config --libs</p></blockquote><p>netcdf-c-4.7.4</p><blockquote><p>final link failed: nonrepresentable section on output</p></blockquote><h1 id="solution">Solution</h1><ul><li>[ ] have to add <strong>--disable-shared</strong> to avoid Error-ld: final link failed: nonrepresentable section on output.</li><li>[x] add -enable-static</li></ul><p>Ref:</p><ol type="1"><li><a href="https://stackoverflow.com/questions/49733534/enable-static-vs-disable-shared">--enable-static vs --disable-shared</a></li></ol><blockquote><p>In the common case that these are switches to a "configure" script generated by Autoconf and Libtool, then they officially mean closely-related, but different, things. --enable-static means <strong>do build static libraries</strong>; --disable-shared means <strong>don't build shared libraries</strong>. If you want to be sure to get only static libraries, no matter what, you need to give both options. However, often just --disable-shared will have that effect, because think about the possibilities: if the package builds only static libraries by default, then --disable-shared is a no-op; if it builds both static and shared libraries by default, then you just have to turn off the shared libraries to get what you want; and if it builds only shared libraries by default, then you might think you need both options, but if you just say --disable-shared, Libtool will usually notice that it's now being asked to build nothing, assume that that couldn't possibly be what you wanted, and flip the --enable-static switch for you.</p></blockquote><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs routeros">echo <span class="hljs-string">&quot;=== netcdf-C ====&quot;</span><br><span class="hljs-comment">## -disable-dap：--disable-dap的原因是缺少一个‘curl’的lib</span><br><span class="hljs-comment">## 4.1.3以后的版本Fortran和C分开了。把disable--netcdf-4 写进去也无所谓</span><br><br>cd <span class="hljs-variable">$download_DIR</span><br>tar xvf netcdf-c-4.7.4.tar.gz 1&gt;/dev/<span class="hljs-literal">null</span> 2&gt;&amp;1 <br>cd netcdf-c-4.7.4/<br><br><span class="hljs-comment"># have to define below parameters</span><br><span class="hljs-built_in">export</span> <span class="hljs-attribute">FC</span>=mpifort<br><span class="hljs-built_in">export</span> <span class="hljs-attribute">F77</span>=mpifort<br><span class="hljs-built_in">export</span> <span class="hljs-attribute">F90</span>=mpifort<br><span class="hljs-built_in">export</span> <span class="hljs-attribute">CC</span>=mpicc<br><span class="hljs-built_in">export</span> <span class="hljs-attribute">CXX</span>=mpic++<br><br><span class="hljs-comment">###export LIBS=&quot;-lhdf5_hl -lhdf5 -lz -ldl&quot;</span><br><br><span class="hljs-built_in">export</span> <span class="hljs-attribute">LD_LIBRARY_PATH</span>=<span class="hljs-variable">$libs_DIR</span>/lib:$LD_LIBRARY_PATH<br><span class="hljs-built_in">export</span> <span class="hljs-attribute">LDFLAGS</span>=-L$libs_DIR/lib<br><span class="hljs-built_in">export</span> <span class="hljs-attribute">CPPFLAGS</span>=-I$libs_DIR/include<br><br>./configure <span class="hljs-attribute">--prefix</span>=<span class="hljs-variable">$libs_DIR</span> --enable-shared --enable-netcdf4 --disable-filter-testing --disable-dap<br>make -j 4 <br>make check<br>make install<br>cd <span class="hljs-built_in">..</span><br>rm -rf netcdf-c-4.7.4<br>echo <span class="hljs-string">&quot;=== netcdf-C (end) ====&quot;</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>MPAS</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Installation</tag>
      
      <tag>netcdf-c</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>WRF | error - jas_image_t aka struct anonymous has no member named inmem_ and image.inmem_=1</title>
    <link href="/2024/05/30/WPS_install_enc_jpeg2000_error/"/>
    <url>/2024/05/30/WPS_install_enc_jpeg2000_error/</url>
    
    <content type="html"><![CDATA[<h1 id="issue">Issue</h1><p>While compiling WPSv3.8.1,</p><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs basic"><span class="hljs-symbol">17 </span>gcc -c  -D_UNDERSCORE -DBYTESWAP -DLINUX -DIO_NETCDF -DBIT32 -DNO_SIGNAL -D_MPI -I/EM/wpsze/WRF/WRFv440/Library/include/ -DUSE_JPEG2000 -DUSE_PNG -D__64BIT__ enc_jp    eg2000.c<br><span class="hljs-symbol">18 </span>enc_jpeg2000.c: In function ‘enc_jpeg2000_’:<br><span class="hljs-symbol">19 </span>enc_jpeg2000.c:<span class="hljs-number">141</span>:<span class="hljs-number">10</span>: <span class="hljs-keyword">error</span>: ‘jas_image_t’ &#123;aka ‘struct &lt;anonymous&gt;’&#125; has no member named ‘inmem_’<br><span class="hljs-symbol">20 </span>  <span class="hljs-number">141</span> |     image.inmem_=<span class="hljs-number">1</span>;<br><span class="hljs-symbol">21 </span>      |          ^<br><span class="hljs-symbol">22 </span>make[<span class="hljs-number">2</span>]: [Makefile:<span class="hljs-number">75</span>: enc_jpeg2000.o] <span class="hljs-keyword">Error</span> <span class="hljs-number">1</span> (ignored)<br></code></pre></td></tr></table></figure><h1 id="search">Search</h1><p>From Grib2 output is broken -- <a href="https://github.com/wrf-model/WRF/issues/993" class="uri">https://github.com/wrf-model/WRF/issues/993</a></p><p>I'm unsure if the issue has been resolved, or if anyone still cares, but I think I see what might be going on here. The offending part of enc_jpeg2000.c relates to a C struct of type jas_image_t (in line 87 in the version of this file I'm looking at):</p><blockquote><p>jas_image_t image;</p></blockquote><p>It throws an error when the code tries to access the inmem_ element:</p><blockquote><pre><code class="hljs">image.inmem_=1;</code></pre></blockquote><p>This C struct is defined by jasper/jas_image.h (version 2.0.14, which is what I have on the system I'm working on). <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">/* Image class. */</span><br><br><span class="hljs-keyword">typedef</span> <span class="hljs-keyword">struct</span> &#123;<br><br>        <span class="hljs-type">jas_image_coord_t</span> tlx_;<br>        <span class="hljs-comment">/* The x-coordinate of the top-left corner of the image bounding box. */</span><br><br>        <span class="hljs-type">jas_image_coord_t</span> tly_;<br>        <span class="hljs-comment">/* The y-coordinate of the top-left corner of the image bounding box. */</span><br><br>        <span class="hljs-type">jas_image_coord_t</span> brx_;<br>        <span class="hljs-comment">/* The x-coordinate of the bottom-right corner of the image bounding</span><br><span class="hljs-comment">          box (plus one). */</span><br><br>        <span class="hljs-type">jas_image_coord_t</span> bry_;<br>        <span class="hljs-comment">/* The y-coordinate of the bottom-right corner of the image bounding</span><br><span class="hljs-comment">          box (plus one). */</span><br><br>        <span class="hljs-type">int</span> numcmpts_;<br>        <span class="hljs-comment">/* The number of components. */</span><br><br>        <span class="hljs-type">int</span> maxcmpts_;<br>        <span class="hljs-comment">/* The maximum number of components that this image can have (i.e., the</span><br><span class="hljs-comment">          allocated size of the components array). */</span><br><br>        <span class="hljs-type">jas_image_cmpt_t</span> **cmpts_;<br>        <span class="hljs-comment">/* Per-component information. */</span><br><br>        <span class="hljs-type">jas_clrspc_t</span> clrspc_;<br><br>        <span class="hljs-type">jas_cmprof_t</span> *cmprof_;<br><br><span class="hljs-comment">//      bool inmem_;</span><br><br>&#125; <span class="hljs-type">jas_image_t</span>;<br></code></pre></td></tr></table></figure></p><p>You can see that the bool component inmem_ has been commented out. If you go back to older versions of jasper you can get back to one that doesn't have inmem_ commented out. For example, in the <a href="https://github.com/jasper-software/jasper">github repo for this library</a>, that would be something like SHAH 2b2efba4eda0a654ab02 or version 1.900.24, which dates to Nov 2016.</p><h1 id="workaround">Workaround</h1><h2 id="in-wpsv3.8.1-code">In WPSv3.8.1 code</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">./ungrib/src/ngl/g2/dec_jpeg2000.c:104:    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot; inmem %d \n&quot;</span>,image-&gt;inmem_);<br>./ungrib/src/ngl/g2/enc_jpeg2000.c:141:    image.inmem_=1;<br></code></pre></td></tr></table></figure><p>and, modify enc_jpeg2000.c</p><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs actionscript"><span class="hljs-comment">/* </span><br><span class="hljs-comment"> * Does not seem to be needed, and throws a compiler error</span><br><span class="hljs-comment"> * image.inmem_=1;</span><br><span class="hljs-comment"> */</span><br></code></pre></td></tr></table></figure><p>Finally, ungrib.exe is generated.</p><p>but, is it right? will that break something...?</p><p>Ref: <a href="https://www.cnblogs.com/jiangleads/articles/11422607.html">WRF 3.9.1.1 安装 记录</a> &gt;此外，如果安装的是较新的jasper版本，还需要更改文件enc_jpeg2000.c （在目录WPS/ungrib/src/ngl/g2/enc_jpeg2000.c） &gt; 参见 <a href="http://forum.wrfforum.com/viewtopic.php?f=20&amp;t=10035" class="uri">http://forum.wrfforum.com/viewtopic.php?f=20&amp;t=10035</a> &gt;将第141行 &gt;&gt; image.inmem_=1; &gt;注释掉 &gt;这样，就能生成ungrib.exe了</p>]]></content>
    
    
    <categories>
      
      <category>WRF</category>
      
    </categories>
    
    
    <tags>
      
      <tag>WPS</tag>
      
      <tag>Installation</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>WRF | Error - Size of put argument of random_seed intrinsic at (1) too small</title>
    <link href="/2024/05/30/WRF_install_random_seed_error/"/>
    <url>/2024/05/30/WRF_install_random_seed_error/</url>
    
    <content type="html"><![CDATA[<h1 id="issue">Issue</h1><p>While compiling WRFv3.8.1,</p><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs basic"><span class="hljs-symbol">2065 </span><br><span class="hljs-symbol">2066 </span> <span class="hljs-number">3128</span> |                    <span class="hljs-keyword">call</span> random_seed (<span class="hljs-keyword">PUT</span>=seed)<br><span class="hljs-symbol">2067 </span>      |                                         <span class="hljs-number">1</span><br><span class="hljs-symbol">2068 </span><span class="hljs-keyword">Error</span>: Size of ‘<span class="hljs-keyword">put</span>’ argument of ‘random_seed’ intrinsic at (<span class="hljs-number">1</span>) too small (<span class="hljs-number">12</span>/<span class="hljs-number">33</span>)<br><span class="hljs-symbol">2069 </span>module_cu_g3.f90:<span class="hljs-number">3217</span>:<span class="hljs-number">41</span>:<br><span class="hljs-symbol">2070 </span><br><span class="hljs-symbol">2071 </span> <span class="hljs-number">3217</span> |                    <span class="hljs-keyword">call</span> random_seed (<span class="hljs-keyword">PUT</span>=seed)<br><span class="hljs-symbol">2072 </span>      |                                         <span class="hljs-number">1</span><br><span class="hljs-symbol">2073 </span><span class="hljs-keyword">Error</span>: Size of ‘<span class="hljs-keyword">put</span>’ argument of ‘random_seed’ intrinsic at (<span class="hljs-number">1</span>) too small (<span class="hljs-number">12</span>/<span class="hljs-number">33</span>)<br><span class="hljs-symbol">2074 </span>module_cu_g3.f90:<span class="hljs-number">3232</span>:<span class="hljs-number">41</span>:<br><span class="hljs-symbol">2075 </span><br><span class="hljs-symbol">2076 </span> <span class="hljs-number">3232</span> |                    <span class="hljs-keyword">call</span> random_seed (<span class="hljs-keyword">PUT</span>=seed)<br><span class="hljs-symbol">2077 </span>      |                                         <span class="hljs-number">1</span><br><span class="hljs-symbol">2078 </span><span class="hljs-keyword">Error</span>: Size of ‘<span class="hljs-keyword">put</span>’ argument of ‘random_seed’ intrinsic at (<span class="hljs-number">1</span>) too small (<span class="hljs-number">12</span>/<span class="hljs-number">33</span>)<br><span class="hljs-symbol">2079 </span>make[<span class="hljs-number">3</span>]: [../configure.wrf:<span class="hljs-number">339</span>: module_cu_g3.o] <span class="hljs-keyword">Error</span> <span class="hljs-number">1</span> (ignored)<br><span class="hljs-symbol">2080 </span>rm -f module_cu_kfeta.o<br></code></pre></td></tr></table></figure><h1 id="solution">Solution</h1><p>Ref: - <a href="https://forum.mmm.ucar.edu/threads/wrfv3-9-compilation-error-on-ubuntu-18-04-lts-with-gfortran-7-4.8786/">WRFV3.9 compilation error on Ubuntu 18.04 LTS with gfortran-7.4</a> - <a href="https://forum.mmm.ucar.edu/threads/wrfv3-8-problem-building-executables.8418/">WRFV3.8 problem building executables</a> - <a href="https://forum.mmm.ucar.edu/threads/wrfv381-with-gnu8-x.217/">WRFv381 with GNU8.x</a></p><blockquote><p>This code has been corrected beginning with V4.0. I'm attaching the modified file so that you can see how we changed it. Unfortunately we didn't have a git repo when we released V3.8.1, but we can add the problems to our known problems page.</p></blockquote><p>The file is &gt; WRF/phys/module_cu_g3.F</p><p>on <a href="https://github.com/wrf-model/WRF/blob/v4.0/phys/module_cu_g3.F" class="uri">https://github.com/wrf-model/WRF/blob/v4.0/phys/module_cu_g3.F</a></p><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs gcode">$ md<span class="hljs-number">5</span>sum module_cu_<span class="hljs-name">g3.</span>F<br>e<span class="hljs-number">385527</span>b<span class="hljs-number">41</span>d<span class="hljs-number">374</span>d<span class="hljs-number">6530596</span>e<span class="hljs-number">069</span>fb<span class="hljs-number">547</span>b  module_cu_<span class="hljs-name">g3.</span>F<br></code></pre></td></tr></table></figure><h1 id="but">But</h1><blockquote><p>Fatal Error: Can't open module file 'module_initialize_real.mod' for reading at (1): No such file or directory</p></blockquote><h2 id="solution-1">Solution</h2><p>Then it should end successfully when running the command a second time (do not understand why but it works...)</p><ol type="1"><li>$ ./compile -j 8 em_real 2&gt;&amp;1 | tee compile.log</li><li>Fatal Error: Can't open module file 'module_initialize_real.mod' ...</li><li>$ ./compile -j 8 em_real 2&gt;&amp;1 | tee compile.log</li><li>Then, it works !!</li></ol><p>ref: <a href="https://valcap74.blogspot.com/2017/10/how-to-compile-wrf-model-on-ecmwf-cray.html" class="uri">https://valcap74.blogspot.com/2017/10/how-to-compile-wrf-model-on-ecmwf-cray.html</a></p>]]></content>
    
    
    <categories>
      
      <category>WRF</category>
      
    </categories>
    
    
    <tags>
      
      <tag>WRF</tag>
      
      <tag>Installation</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MPAS | MPAS-JEDI</title>
    <link href="/2024/05/29/MPAS-JEDI_note/"/>
    <url>/2024/05/29/MPAS-JEDI_note/</url>
    
    <content type="html"><![CDATA[<h1 id="workshop">Workshop</h1><ol type="1"><li><a href="http://www.gpsarc.ncu.edu.tw/MPAS2023/download.html">202310 MPAS-A and MPAS-JEDI Tutorials and Workshop, National Central University (NCU)</a></li><li><a href="https://www2.mmm.ucar.edu/projects/mpas-jedi/tutorial/202310NCU/">Welcome to the MPAS-JEDI tutorial practice guide, 202310NCU</a><ul><li>This web page is intended to serve as a guide through the practice exercises of this tutorial. Exercises are split into seven main sections, each of which focuses on a particular aspect of using the MPAS-JEDI data assimilation system.</li><li><a href="https://www2.mmm.ucar.edu/projects/mpas-jedi/tutorial/202309NCAR/testdata/">202309NCAR/testdata</a></li></ul></li><li>[202309 MPAS-JEDI Tutorial Agenda] (https://www2.mmm.ucar.edu/projects/mpas-jedi/tutorial/202309NCAR/agenda.html)</li><li><a href="https://www2.mmm.ucar.edu/projects/mpas-jedi/tutorial/202309NCAR/">Welcome to the MPAS-JEDI tutorial practice guide, 202309NCAR</a><ul><li>This web page is intended to serve as a guide through the practice exercises of this tutorial. Exercises are split into seven main sections, each of which focuses on a particular aspect of using the MPAS-JEDI data assimilation system.</li></ul></li></ol><h1 id="github">Github</h1><p><a href="https://github.com/JCSDA/mpas-jedi">MPAS-JEDI</a></p><h1 id="presentation">Presentation</h1><ol type="1"><li>2nd EarthCare Moldeling Workshop, Shuzenji, Japan, 27-29 March, 2023 Jake Liu<ul><li><a href="https://www.eorc.jaxa.jp/EARTHCARE/event/Modeling_ws2023/material1/March28/11_EarthCare2023_JakeLiu%20zhiquan%20liu.pdf">Towards global convection-permitting NWP using MPAS and MPAS-JEDI</a></li></ul></li></ol>]]></content>
    
    
    <categories>
      
      <category>MPAS</category>
      
    </categories>
    
    
    <tags>
      
      <tag>MPAS</tag>
      
      <tag>DA</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MPAS | MPAS installation - configure - RUNNING CONFIGURE FOR ch4:ucx</title>
    <link href="/2024/05/29/MPAS_install_error_CH4_UCX/"/>
    <url>/2024/05/29/MPAS_install_error_CH4_UCX/</url>
    
    <content type="html"><![CDATA[<h1 id="issue">Issue</h1><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs stata">configure: RUNNING CONFIGURE <span class="hljs-keyword">FOR</span> ch4:ucx<br>configure: CH4 UCX Netmod:  Using <span class="hljs-keyword">an</span> external ucx<br>checking <span class="hljs-keyword">if</span> UCX meets minimum <span class="hljs-keyword">version</span> requirement... <span class="hljs-keyword">no</span><br>configure: <span class="hljs-keyword">error</span>: UCX installation does not meet minimum <span class="hljs-keyword">version</span> requirement (v1.9.0). Please upgrade your installation, or <span class="hljs-keyword">use</span> --with-ucx=embedded.<br></code></pre></td></tr></table></figure><h1 id="solution">Solution</h1><p>Configure will use an embedded copy of libfabric or ucx if one is not found in the user environment. An installation can be specified by adding</p><blockquote><p>--with-libfabric=<path/to/install> or --with-ucx=<path/to/install></p></blockquote><p>to the configuration.</p><p>The previous MPICH default device (ch3) is also available and supported with option:</p><blockquote><p>--with-device=ch3</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>MPAS</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Installation</tag>
      
      <tag>MPAS</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>VSCode with Markdown editor</title>
    <link href="/2024/05/29/VSCode_markdown_editor/"/>
    <url>/2024/05/29/VSCode_markdown_editor/</url>
    
    <content type="html"><![CDATA[<p>Working with <a href="https://code.visualstudio.com/docs/languages/markdown">Markdown files in Visual Studio Code</a> is simple, straightforward, and fun. Besides VS Code's basic editing, there are a several Markdown-specific features that help you be more productive.</p><h1 id="markdown-preview">Markdown preview</h1><p>You can also right-click on the editor Tab and select Open Preview (Ctrl+Shift+V) or use the Command Palette (Ctrl+Shift+P) to run the Markdown: <strong>Open Preview to the Side</strong> command (Ctrl+K V).</p><h1 id="outline-view">Outline view</h1><p>The Outline view is a separate section in the bottom of the File Explorer. When expanded, it shows the symbol tree of the currently active editor. For Markdown files, the symbol tree is the Markdown file's header hierarchy.</p><h1 id="extension">Extension</h1><ul><li>markdownlint</li><li>Markdown All in One</li><li>Markdown Preview Github Styling</li><li>Markdown Preview Enhanced</li><li>Markdown Table Prettifier</li></ul><h1 id="markdown-syntax">Markdown syntax</h1><h2 id="bolditalics">Bold/Italics</h2><ul><li>I just love <strong>bold text</strong>./I just love <em>bold text</em>.</li><li>I just love <strong>bold text</strong>./I just love <em>bold text</em>.</li><li>Love<strong>is</strong>bold./Love<em>is</em>bold</li></ul><h2 id="blockquotes">Blockquotes</h2><blockquote><p>It is Markdown.</p></blockquote><blockquote><p>It is also Markdown.</p><p>same here. &gt; indent &gt; &gt; indent</p></blockquote><blockquote><h4 id="the-quarterly-results-look-great">The quarterly results look great!</h4><ul><li>Revenue was off the chart.</li><li>Profits were higher than ever.</li></ul><p><em>Everything</em> is going according to <strong>plan</strong>.</p></blockquote><h2 id="lists">Lists</h2><ol type="1"><li>First item</li><li>Second item</li><li>Third item<ol type="1"><li>Indented item</li><li>Indented item</li></ol></li><li>Fourth item</li></ol><p>Or,</p><ul><li>First item</li><li>Second item</li><li>Third item<ul><li>Indented item</li><li>Indented item</li></ul></li><li>Fourth item</li></ul><p>Or,</p><ol type="1"><li>First item</li><li>Second item</li><li>Third item<ul><li>Indented item</li><li>Indented item</li></ul></li><li>Fourth item</li></ol><h2 id="code-and-highlighting">Code and Highlighting</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/sh</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Hello world&quot;</span><br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br></code></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>  cout &lt;&lt; <span class="hljs-string">&quot;Hello World!&quot;</span>;<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> &#123;<br>   <span class="hljs-comment">// printf() displays the string inside quotation</span><br>   <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Hello, World!&quot;</span>);<br>   <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="table">Table</h2><p><a href="https://discourse.devontechnologies.com/t/css-for-markdown-styling-tables/71369" class="uri">https://discourse.devontechnologies.com/t/css-for-markdown-styling-tables/71369</a></p><table><thead><tr class="header"><th>Syntax</th><th>Description</th></tr></thead><tbody><tr class="odd"><td>Header</td><td>Title</td></tr><tr class="even"><td>Paragraph 1</td><td>Text 1</td></tr><tr class="odd"><td>Paragraph 2</td><td>Text 2</td></tr></tbody></table><table><thead><tr class="header"><th style="text-align: left;">Left-Aligned</th><th style="text-align: center;">Center Aligned</th><th style="text-align: right;">Right Aligned</th></tr></thead><tbody><tr class="odd"><td style="text-align: left;">Row 1</td><td style="text-align: center;">Cell 2</td><td style="text-align: right;">Cell 3</td></tr><tr class="even"><td style="text-align: left;">Row 2</td><td style="text-align: center;">Cell 5</td><td style="text-align: right;">Cell 6</td></tr><tr class="odd"><td style="text-align: left;">Row 3</td><td style="text-align: center;">Cell 8</td><td style="text-align: right;">Cell 9</td></tr></tbody></table><table><thead><tr class="header"><th style="text-align: left;">Left-Aligned</th><th style="text-align: center;">Center Aligned</th><th style="text-align: right;">Right Aligned</th></tr></thead><tbody><tr class="odd"><td style="text-align: left;">Row 1</td><td style="text-align: center;"><strong>Bold</strong></td><td style="text-align: right;">Cell 3</td></tr><tr class="even"><td style="text-align: left;">Row 2</td><td style="text-align: center;"><em>Italic</em></td><td style="text-align: right;">Cell 6</td></tr><tr class="odd"><td style="text-align: left;">Row 3</td><td style="text-align: center;"><del>Strike</del></td><td style="text-align: right;">Cell 9</td></tr><tr class="even"><td style="text-align: left;">Row 3</td><td style="text-align: center;"><a href="dot.com">Link</a></td><td style="text-align: right;">Cell 9</td></tr></tbody></table><p><a href="https://nabeelvalley.co.za/blog/2021/23-03/custom-styles-in-markdown/" class="uri">https://nabeelvalley.co.za/blog/2021/23-03/custom-styles-in-markdown/</a></p><style>tr:nth-child(even) {  background-color: #b2b2b2!important;  color: #f4f4f4!important;}</style><table><thead><tr class="header"><th style="text-align: center;"><!-- --></th><th style="text-align: center;"><!-- --></th><th style="text-align: center;"><!-- --></th></tr></thead><tbody><tr class="odd"><td style="text-align: center;">Row 1</td><td style="text-align: center;"><strong>Bold</strong></td><td style="text-align: center;">Cell 3</td></tr><tr class="even"><td style="text-align: center;">Row 2</td><td style="text-align: center;"><em>Italic</em></td><td style="text-align: center;">Cell 6</td></tr><tr class="odd"><td style="text-align: center;">Row 3</td><td style="text-align: center;"><del>Strike</del></td><td style="text-align: center;">Cell 9</td></tr></tbody></table><table><thead><tr class="header"><th style="text-align: left;">elec_physics</th><th style="text-align: center;">nssl_ipelec</th><th style="text-align: center;">nssl_idischarge</th><th style="text-align: left;">outputs</th></tr></thead><tbody><tr class="odd"><td style="text-align: left;">1</td><td style="text-align: center;">2</td><td style="text-align: center;">1</td><td style="text-align: left;">?</td></tr><tr class="even"><td style="text-align: left;">1</td><td style="text-align: center;">3</td><td style="text-align: center;">1</td><td style="text-align: left;">scalar:scr,scw,sci,scs,sch,schl,sciona; <br> state:rscghis_2d,sctot,noninduc,induc,pot, <br> elecmag,elecx,elecy,elecz,light,lightdens,lightdis</td></tr><tr class="odd"><td style="text-align: left;">1</td><td style="text-align: center;">3</td><td style="text-align: center;">2</td><td style="text-align: left;">state:flshi,flshn,flshp,flshfedic, <br> flshfedicp,flshfedicn,flshfedcg,flshfedcgp,flshfedcgn</td></tr></tbody></table><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs markdown">| Syntax | Description |<br>| ----------- | ----------- |<br>| Header | Title |<br>| Paragraph 1| Text 1|<br>| Paragraph 2 | Text 2|<br><br>| Left-Aligned  | Center Aligned  | Right Aligned |<br>|:------------- |:---------------:| -------------:|<br>| Row 1         | Cell 2          | Cell 3        |<br>| Row 2         | Cell 5          | Cell 6        |<br>| Row 3         | Cell 8          | Cell 9        |<br><br>| Left-Aligned  | Center Aligned  | Right Aligned |<br>|:------------- |:---------------:| -------------:|<br>| Row 1         | <span class="hljs-strong">**Bold**</span>        | Cell 3        |<br>| Row 2         | <span class="hljs-emphasis">*Italic*</span>        | Cell 6        |<br>| Row 3         | ~~Strike~~      | Cell 9        |<br>| Row 3         | [<span class="hljs-string">Link</span>](<span class="hljs-link">dot.com</span>) | Cell 9        |<br><br>| &lt;!-- --&gt;      | &lt;!-- --&gt;        | &lt;!-- --&gt;      |<br>|:-------------:|:---------------:|:-------------:|<br>| Row 1         | <span class="hljs-strong">**Bold**</span>        | Cell 3        |<br>| Row 2         | <span class="hljs-emphasis">*Italic*</span>        | Cell 6        |<br>| Row 3         | ~~Strike~~      | Cell 9        |<br><br>| elec<span class="hljs-emphasis">_physics  | nssl_</span>ipelec  | nssl<span class="hljs-emphasis">_idischarge | outputs |</span><br><span class="hljs-emphasis">|:------------- |:---------------:|:---------------:| :-------------|</span><br><span class="hljs-emphasis">| 1         | 2          | 1        | ? |</span><br><span class="hljs-emphasis">| 1         | 3          | 1        | scalar:scr,scw,sci,scs,sch,schl,sciona; <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span></span> state:rscghis_</span>2d,sctot,noninduc,induc,pot, <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span></span> elecmag,elecx,elecy,elecz,light,lightdens,lightdis |<br>| 1         | 3          | 2       | state:flshi,flshn,flshp,flshfedic, <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span></span> flshfedicp,flshfedicn,flshfedcg,flshfedcgp,flshfedcgn |<br><br></code></pre></td></tr></table></figure><h3 id="useful-link">Useful link</h3><ul><li><a href="https://www.tablesgenerator.com/markdown_tables">Markdown Table Generator</a></li></ul><h2 id="links">Links</h2><p>To create a link, enclose the link text in brackets (e.g., [Duck Duck Go]) and then follow it immediately with the URL in parentheses (e.g., (https://duckduckgo.com)).</p><p>It is <a href="https://en.wikipedia.org/wiki/GNU_Compiler_Collection">GNU Compiler Collection (GCC)</a>.</p><h2 id="urls-and-email-addresses">URLs and Email Addresses</h2><p><a href="https://www.markdownguide.org" class="uri">https://www.markdownguide.org</a><br /><a href="mailto:waipangsze@gmail.com" class="email">waipangsze@gmail.com</a></p><h2 id="task-list">Task List</h2><ul><li>[x] Write the press release</li><li>[ ] Update the website</li><li>[ ] Contact the media</li></ul><h2 id="image">Image</h2><ol type="1"><li><p>Open the file containing the Linux.</p><figure><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/3/35/Tux.svg/150px-Tux.svg.png" alt="Tux, the Linux mascot" /><figcaption>Tux, the Linux mascot</figcaption></figure></li><li><p>Close the file.</p></li></ol><h2 id="in-fluid-theme">In Fluid theme,</h2><h3 id="便签">便签</h3><p>可选便签：</p><ul><li>primary</li><li>secondary</li><li>success</li><li>danger</li><li>warning</li><li>info</li><li>light</li></ul><div class="note note-primary">            <p>primary: 文字 或者 <code>markdown</code> 均可</p>          </div><div class="note note-secondary">            <p>secondary: 文字 或者 <code>markdown</code> 均可</p>          </div><div class="note note-success">            <p>success: 文字 或者 <code>markdown</code> 均可</p>          </div><div class="note note-danger">            <p>danger: 文字 或者 <code>markdown</code> 均可</p>          </div><div class="note note-warning">            <p>warning: 文字 或者 <code>markdown</code> 均可</p>          </div><div class="note note-info">            <p>info: 文字 或者 <code>markdown</code> 均可</p>          </div><div class="note note-light">            <p>light: 文字 或者 <code>markdown</code> 均可</p>          </div><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs markdown">&#123;% note primary %&#125;<br>primary: 文字 或者 <span class="hljs-code">`markdown`</span> 均可<br>&#123;% endnote %&#125;<br></code></pre></td></tr></table></figure><h2 id="text---mermaid">TeXt - Mermaid,</h2><p>set <code>mermaid: true</code></p><figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs oxygene"># 流程图，基于 mermaid-js，具体请见：https:<span class="hljs-comment">//hexo.fluid-dev.com/docs/guide/#mermaid-流程图</span><br># Flow chart, based <span class="hljs-keyword">on</span> mermaid-js, see: https:<span class="hljs-comment">//hexo.fluid-dev.com/docs/en/guide/#mermaid</span><br>mermaid:<br># 开启后文章默认可用，自定义页面如需使用，需在 Front-matter 中指定 `mermaid: <span class="hljs-keyword">true</span>`<br># <span class="hljs-keyword">If</span> you want <span class="hljs-keyword">to</span> use mermaid <span class="hljs-keyword">on</span> the custom page, you need <span class="hljs-keyword">to</span> <span class="hljs-keyword">set</span> `mermaid: <span class="hljs-keyword">true</span>` <span class="hljs-keyword">in</span> Front-matter<br>enable: <span class="hljs-keyword">false</span><br></code></pre></td></tr></table></figure><p>and,</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">npm install hexo-filter-mermaid-diagrams<br></code></pre></td></tr></table></figure><pre class="mermaid">pie title NETFLIX         "Time spent looking for movie" : 90         "Time spent watching it" : 10</pre><pre class="mermaid">flowchart TD    Start --> Stop</pre><h3 id="flowchart">Flowchart</h3><pre class="mermaid">graph TD;    A-->B;    A-->C;    B-->D;    C-->D;</pre><pre><code class="hljs">&lt;pre class=&quot;mermaid&quot;&gt;    graph TD;    A--&gt;B;    A--&gt;C;    B--&gt;D;    C--&gt;D;&lt;/pre&gt;</code></pre><h3 id="sequence-diagram">Sequence Diagram</h3><pre class="mermaid">sequenceDiagram    participant Alice    participant Bob    Alice->John: Hello John, how are you?    loop Healthcheck        John->John: Fight against hypochondria    end    Note right of John: Rational thoughts <br/>prevail...    John-->Alice: Great!    John->Bob: How about you?    Bob-->John: Jolly good!</pre><pre><code class="hljs">&lt;pre class=&quot;mermaid&quot;&gt;    sequenceDiagram    participant Alice    participant Bob    Alice-&gt;John: Hello John, how are you?    loop Healthcheck        John-&gt;John: Fight against hypochondria    end    Note right of John: Rational thoughts &lt;br/&gt;prevail...    John--&gt;Alice: Great!    John-&gt;Bob: How about you?    Bob--&gt;John: Jolly good!&lt;/pre&gt;</code></pre><h3 id="gant-diagrams">Gant Diagrams</h3><pre class="mermaid">gantt    dateFormat  YYYY-MM-DD    title Adding GANTT diagram functionality to mermaid    section A section        Completed task            :done,    des1, 2014-01-06,2014-01-08        Active task               :active,  des2, 2014-01-09, 3d        Future task               :         des3, after des2, 5d        Future task2              :         des4, after des3, 5d    section Critical tasks        Completed task in the critical line :crit, done, 2014-01-06,24h        Implement parser and jison          :crit, done, after des1, 2d        Create tests for parser             :crit, active, 3d        Future task in critical line        :crit, 5d        Create tests for renderer           :2d</pre><pre><code class="hljs">&lt;pre class=&quot;mermaid&quot;&gt;    gantt    dateFormat  YYYY-MM-DD    title Adding GANTT diagram functionality to mermaid    section A section        Completed task            :done,    des1, 2014-01-06,2014-01-08        Active task               :active,  des2, 2014-01-09, 3d        Future task               :         des3, after des2, 5d        Future task2              :         des4, after des3, 5d    section Critical tasks        Completed task in the critical line :crit, done, 2014-01-06,24h        Implement parser and jison          :crit, done, after des1, 2d        Create tests for parser             :crit, active, 3d        Future task in critical line        :crit, 5d        Create tests for renderer           :2d&lt;/pre&gt;</code></pre><pre class="mermaid">gantt    title A Gantt Diagram    dateFormat YYYY-MM-DD    section Section        A task          :a1, 2014-01-01, 30d        Another task    :after a1, 20d    section Another        Task in Another :2014-01-12, 12d        another task    :24d    section Another 2        Task in Another :2014-01-12, 12d        another task    :24d</pre><pre><code class="hljs">&lt;pre class=&quot;mermaid&quot;&gt;    gantt    title A Gantt Diagram    dateFormat YYYY-MM-DD    section Section        A task          :a1, 2014-01-01, 30d        Another task    :after a1, 20d    section Another        Task in Another :2014-01-12, 12d        another task    :24d    section Another 2        Task in Another :2014-01-12, 12d        another task    :24d&lt;/pre&gt;</code></pre><h2 id="math-block">Math block</h2><p>set<br /><code>mathjax: true</code><br /><code>mathjax_autoNumber: true</code> {:.info}</p><h3 id="in-text-theme-mathjax-is-used.">In TeXt theme, MathJax is used.</h3><ol type="1"><li><a href="https://nightcatv.github.io/2020/06/05/MathJax%20%E8%AA%9E%E6%B3%95%E8%A3%9C%E5%B8%96/#MathJax-%E8%AA%9E%E6%B3%95%E8%A3%9C%E5%B8%96">MathJax 語法補帖</a></li><li><a href="https://bachzart.github.io/2020/09/17/MathJax-%E8%AF%AD%E6%B3%95%E5%BF%AB%E9%80%9F%E6%8C%87%E5%8D%97/">MathJax 语法快速指南</a></li></ol><p>edit waipangsze.github.io/_includes/markdown-enhancements/mathjax.html and add</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs prolog">displayMath: [ [<span class="hljs-string">&#x27;$$&#x27;</span>,<span class="hljs-string">&#x27;$$&#x27;</span>], [<span class="hljs-string">&#x27;\\[&#x27;</span>,<span class="hljs-string">&#x27;\\]&#x27;</span>] ]<br></code></pre></td></tr></table></figure><p>and,</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/x-mathjax-config&quot;</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-keyword">var</span> _config = &#123; <span class="hljs-attr">tex2jax</span>: &#123;</span><br><span class="language-javascript">        <span class="hljs-attr">inlineMath</span>: [ [<span class="hljs-string">&#x27;$&#x27;</span>,<span class="hljs-string">&#x27;$&#x27;</span>], [<span class="hljs-string">&#x27;\\(&#x27;</span>,<span class="hljs-string">&#x27;\\)&#x27;</span>] ],</span><br><span class="language-javascript">        <span class="hljs-attr">displayMath</span>: [ [<span class="hljs-string">&#x27;$$&#x27;</span>,<span class="hljs-string">&#x27;$$&#x27;</span>], [<span class="hljs-string">&#x27;\\[&#x27;</span>,<span class="hljs-string">&#x27;\\]&#x27;</span>] ]</span><br><span class="language-javascript">&#125;&#125;;</span><br><span class="language-javascript">_config.<span class="hljs-property">TeX</span> = &#123; <span class="hljs-attr">equationNumbers</span>: &#123; <span class="hljs-attr">autoNumber</span>: <span class="hljs-string">&quot;all&quot;</span> &#125; &#125;;</span><br><span class="language-javascript"><span class="hljs-title class_">MathJax</span>.<span class="hljs-property">Hub</span>.<span class="hljs-title class_">Config</span>(_config);</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://cdn.bootcss.com/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML&quot;</span> <span class="hljs-attr">async</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><p>Inline math: <span class="math inline">\(x^2\)</span></p><p><span class="math display">\[\left( \sum_{k=1}^n a_k b_k \right)^2\leq\left( \sum_{k=1}^n a_k^2 \right)\left( \sum_{k=1}^n b_k^2 \right)\]</span></p><p><span class="math display">\[a+1 = b\\c+2 = d \]</span></p><p><span class="math display">\[\begin{align}a &amp;= 1 \\b &amp;= 2 \end{align}\tag{1}\]</span></p><p><span class="math display">\[\begin{equation}\begin{split}A &amp; = \frac{\pi r^2}{2} \\    &amp; = \frac{1}{2} \pi r^2\end{split}\end{equation}\tag{2}\]</span></p><p><span class="math display">\[\begin{align*}  &amp; \phi(x,y) = \phi \left(\sum_{i=1}^n x_ie_i, \sum_{j=1}^n y_je_j \right)  = \sum_{i=1}^n \sum_{j=1}^n x_i y_j \phi(e_i, e_j) = \\  &amp; (x_1, \ldots, x_n) \left( \begin{array}{ccc}      \phi(e_1, e_1) &amp; \cdots &amp; \phi(e_1, e_n) \\      \vdots &amp; \ddots &amp; \vdots \\      \phi(e_n, e_1) &amp; \cdots &amp; \phi(e_n, e_n)    \end{array} \right)  \left( \begin{array}{c}      y_1 \\      \vdots \\      y_n    \end{array} \right)\end{align*}\tag{3}\]</span></p><p><span class="math display">\[a = 1 \\b + 1 = 2 \\c + 1 + 2 = 3\]</span></p><p><span class="math display">\[\begin{cases}a_1x + b_1y + c_1z = d_1\\a_2x + b_2y + c_2z = d_2\\a_3x + b_3y + c_3z = d_3\\\end{cases}\]</span></p>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>editor</tag>
      
      <tag>Markdown</tag>
      
      <tag>VSCode</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>WRF | unrecognized command line option ‘-f90=gfortran’ &amp; ungrib.exe compile error</title>
    <link href="/2024/05/29/WPS_install_gfortran_error/"/>
    <url>/2024/05/29/WPS_install_gfortran_error/</url>
    
    <content type="html"><![CDATA[<h1 id="issue">Issue</h1><p>When compiling WPSv4.0/v4.2/v3.8.1</p><blockquote><p>gfortran: error: unrecognized command line option ‘-f90=gfortran’</p></blockquote><h1 id="solution">Solution</h1><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs makefile"><span class="hljs-comment"># Settings for    Linux x86_64 ppc64le, gfortran compiler with gcc   (dmpar)</span><br><span class="hljs-comment">#</span><br>DESCRIPTION     =       GNU ($SFC/$SCC)<br>DMPARALLEL      =        1<br>OMPCPP          =       <span class="hljs-comment"># -D_OPENMP</span><br>OMP             =       <span class="hljs-comment"># -fopenmp</span><br>OMPCC           =       <span class="hljs-comment"># -fopenmp</span><br>SFC             =       gfortran<br>SCC             =       gcc<br>CCOMP           =       gcc<br>DM_FC           =       mpif90 -f90=gfortran<br>DM_CC           =       mpicc -cc=<span class="hljs-variable">$(SCC)</span><br>FC              =       <span class="hljs-variable">$(DM_FC)</span><br>CC              =       <span class="hljs-variable">$(DM_CC)</span> -DFSEEKO64_OK <br>LD              =       <span class="hljs-variable">$(FC)</span><br></code></pre></td></tr></table></figure><p>modify DM_FC to</p><blockquote><p>DM_FC = mpif90</p></blockquote><p>without -f90-gfortran</p><p>Finally,</p><ol type="1"><li>geogrid.exe and metgrid.exe</li><li>link_grib.csh</li></ol><p>are generated.</p><p>But, <strong>no ungrib.exe !!!</strong></p><h2 id="error">Error</h2><blockquote><p>Error: Arguments of ‘iand’ have different kind type parameters at (1)</p></blockquote><p>References</p><ol type="1"><li><a href="https://forum.mmm.ucar.edu/threads/resolved-ungrib-exe-compile-error-arguments-of-%E2%80%98iand%E2%80%99-have-different-kind-type-parameters-at-1-ted.9409/">(RESOLVED) ungrib.exe compile error: Arguments of ‘iand’ have different kind type parameters at (1)ted</a><ul><li>To dd those two extra lines to ungrib/src/ngl/g2/intmath.f (based on <a href="https://github.com/wrf-model/WPS/pull/119" class="uri">https://github.com/wrf-model/WPS/pull/119</a>)</li></ul></li><li><a href="https://forum.mmm.ucar.edu/threads/resolved-not-generating-ungrib-exe.9367/">(RESOLVED) Not generating ungrib.exe</a></li></ol><h3 id="solution-1">Solution</h3><p><a href="https://github.com/wrf-model/WPS/pull/119/files/74eb62b1bef320b453151e1eb749dae96616da97#diff-93d876794073a0c3c81a225075d33578e88a2d946b833ba92f0bbcd3d6be9c03">Fix mismatch integer kind in IAND intrinsic calls in g2 librar</a></p><p>ungrib/src/ngl/g2/intmath.f</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs stylus">ilog2_2=<span class="hljs-number">0</span><br>i=i_in<br><span class="hljs-function"><span class="hljs-title">if</span><span class="hljs-params">(i&lt;=<span class="hljs-number">0</span>)</span></span> return<br><span class="hljs-function"><span class="hljs-title">if</span><span class="hljs-params">(iand(i,i-<span class="hljs-number">1</span>)</span></span>/=<span class="hljs-number">0</span>) then<br>   !<span class="hljs-built_in">write</span>(<span class="hljs-number">0</span>,*) <span class="hljs-string">&#x27;iand i-1&#x27;</span><br>   ilog2_2=<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><p>to <figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs stylus">      ilog2_2=<span class="hljs-number">0</span><br>      i=i_in<br>      <span class="hljs-built_in">if</span>(i&lt;=<span class="hljs-number">0</span>) return<br>! WPS modification <span class="hljs-keyword">for</span> the XL compiler<br>!      <span class="hljs-built_in">if</span>(<span class="hljs-built_in">iand</span>(<span class="hljs-selector-tag">i</span>,i-<span class="hljs-number">1</span>)/=<span class="hljs-number">0</span>) then<br>      <span class="hljs-built_in">if</span>(<span class="hljs-built_in">iand</span>(<span class="hljs-selector-tag">i</span>,i-<span class="hljs-number">1</span>_2)/=<span class="hljs-number">0</span>) then<br>         !<span class="hljs-built_in">write</span>(<span class="hljs-number">0</span>,*) <span class="hljs-string">&#x27;iand i-1&#x27;</span><br>         ilog2_2=<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure> And, <figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs stylus">ilog2_1=<span class="hljs-number">0</span><br>i=i_in<br><span class="hljs-function"><span class="hljs-title">if</span><span class="hljs-params">(i&lt;=<span class="hljs-number">0</span>)</span></span> return<br><span class="hljs-function"><span class="hljs-title">if</span><span class="hljs-params">(iand(i,i-<span class="hljs-number">1</span>)</span></span>/=<span class="hljs-number">0</span>) then<br>   !<span class="hljs-built_in">write</span>(<span class="hljs-number">0</span>,*) <span class="hljs-string">&#x27;iand i-1&#x27;</span><br>   ilog2_1=<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure> to <figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs stylus">      ilog2_1=<span class="hljs-number">0</span><br>      i=i_in<br>      <span class="hljs-built_in">if</span>(i&lt;=<span class="hljs-number">0</span>) return<br>! WPS modification <span class="hljs-keyword">for</span> the XL compiler<br>!      <span class="hljs-built_in">if</span>(<span class="hljs-built_in">iand</span>(<span class="hljs-selector-tag">i</span>,i-<span class="hljs-number">1</span>)/=<span class="hljs-number">0</span>) then<br>      <span class="hljs-built_in">if</span>(<span class="hljs-built_in">iand</span>(<span class="hljs-selector-tag">i</span>,i-<span class="hljs-number">1</span>_1)/=<span class="hljs-number">0</span>) then<br>         !<span class="hljs-built_in">write</span>(<span class="hljs-number">0</span>,*) <span class="hljs-string">&#x27;iand i-1&#x27;</span><br>         ilog2_1=<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure></p><p><strong>Works!!!</strong></p>]]></content>
    
    
    <categories>
      
      <category>WRF</category>
      
    </categories>
    
    
    <tags>
      
      <tag>WPS</tag>
      
      <tag>Installation</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>WRF | fatal error - rpc/types.h - No such file or directory</title>
    <link href="/2024/05/29/WRF_install_landread_error/"/>
    <url>/2024/05/29/WRF_install_landread_error/</url>
    
    <content type="html"><![CDATA[<h1 id="issue">Issue</h1><p>When compiling WRFv4.0.0,</p><blockquote><p>mpicc -cc=gcc -DFSEEKO64_OK -o landread.o -c -w -O3 -c -DDM_PARALLEL -DMAX_HISTORY=25 -DNMM_CORE=0 landread.c landread.c:68:10: fatal error: rpc/types.h: No such file or directory #include &lt;rpc/types.h&gt; ^~~~~~~~~~~~~ compilation terminated. make[2]: [../configure.wrf:372: landread.o] Error 1 (ignored)</p></blockquote><h1 id="reference">Reference</h1><p><a href="https://forum.mmm.ucar.edu/threads/resolved-problem-compiling-wrfv4-0-on-fedora-28-landread-error.61/">(RESOLVED) Problem Compiling WRFV4.0 on Fedora 28: landread error</a></p><h1 id="workaround-1">Workaround 1</h1><p>We've seen a few reports of this, and it seems to be specific to particular Linux systems. We have not been able to repeat this at NCAR on our Macs, our department Linux server, or on our Linux HPC, and therefore we haven't come up with a long-term solution yet. However, a work-around would be to do the following:</p><p>Issue a ‘clean -a’ and then reconfigure. Then go into your configure.wrf file and look for the line: <figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">CFLAGS</span> = $(CFLAGS_LOCAL) -DDM_PARALLEL -DSTUBMPI \<br><span class="hljs-attr">-DMAX_HISTORY</span>=$(MAX_HISTORY) -DNMM_CORE=$(WRF_NMM_CORE)<br></code></pre></td></tr></table></figure></p><p>Onto the end of that, add -DLANDREAD_STUFF, so that it now looks like: <figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">CFLAGS</span> = $(CFLAGS_LOCAL) -DDM_PARALLEL -DSTUBMPI \<br><span class="hljs-attr">-DMAX_HISTORY</span>=$(MAX_HISTORY) -DNMM_CORE=$(WRF_NMM_CORE) -DLANDREAD_STUB<br></code></pre></td></tr></table></figure> Then save that configure file and recompile. This should get your past the problem. Please let us know if that works for you. Thanks!</p><h3 id="wrfv4.0.0-works">WRFv4.0.0 Works !</h3><h2 id="what-is-landread_stub">What is LANDREAD_STUB?</h2><ol type="1"><li><p>The LANDREAD_STUB option removes the ability for a moving nest to horizontally interpolate high-resolution topography and landuse fields. Very few use this option, so this is typically a safe recourse.</p></li><li><p>For those who do need the capability of a moving nest with the high-resolution static fields, if the location of types.h is not found in /usr/include, the alternative would be to look in /usr/include/tirpc.</p></li></ol><p>We can put together a github pull request, but we will need a couple of users to verify that the proposed fix still provide code that works for us and additionally works for the those that have reported the build troubles with WRF.</p><ol start="3" type="1"><li>Would you please test this pull request: <a href="https://github.com/wrf-model/WRF/pull/1072" class="uri">https://github.com/wrf-model/WRF/pull/1072</a></li></ol><h1 id="workaround-2">Workaround 2</h1><ol type="1"><li><p>I am encountering a similar issue when compiling V3.9.1.1 and the above solution does not seem to work for me.</p></li><li><p>I had to Copy landread.c.dist to landread.c in share directory for WRFV3 and that solved the issue.</p></li><li><p>Just cd share/ and do cp landread.c.dist landread.c</p></li></ol>]]></content>
    
    
    <categories>
      
      <category>WRF</category>
      
    </categories>
    
    
    <tags>
      
      <tag>WRF</tag>
      
      <tag>Installation</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>WRF | make -- time No such file or directory</title>
    <link href="/2024/05/29/WRF_install_time_error/"/>
    <url>/2024/05/29/WRF_install_time_error/</url>
    
    <content type="html"><![CDATA[<h1 id="issue">Issue</h1><p>After moving to new cluster, a error appear when I reinstalled WRF. It is</p><blockquote><p>make[3]: time: No such file or directory</p></blockquote><p>Or,</p><blockquote><p>make[3]: time: No such file or directory make[3]: [makefile:42: module_io_int_idx.o] Error 127 (ignored)</p></blockquote><p>On WRFv450, v440, v433, v430</p><h1 id="workaround">Workaround</h1><p>Reference: <a href="https://forum.mmm.ucar.edu/threads/compiling-wrf-4-2-on-centos7-failed-problems-building-executables-look-for-errors-in-the-build-log.12864/">compiling wrf 4.2 on centos7 failed---&gt;Problems building executables, look for errors in the build log</a></p><p>'time' is a simple linux command that is typically included with your operating system. I believe, ultimately, the issue is that you're using a very old version of GNU to compile a newer version of WRF. GNU is free software, so can you try to install the latest version of GNU to see if that makes any difference in your compile? If you aren't sure how to do this, seek the help of a systems administrator (IT) at your institution. Once you install the new GNU version, you'll need to rebuild NetCDF and your MPI installation with the updated GNU, as well.</p><p>If you do that, and still run into the above error regarding the 'time' command, you can try a couple things: 1) Ask a systems admin for assistance in getting this command installed on your system. 'time' is a very simple linux command and typically comes readily available with the OS. 2) You can try modifying the configure.wrf file. After issuing <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">./clean -a<br>./configure<br></code></pre></td></tr></table></figure> 3) , and reconfiguring, open your configure.wrf file and look for this line: <figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arcade">FC        = <span class="hljs-built_in">time</span> $(DM_FC)<br></code></pre></td></tr></table></figure> 4) Remove 'time' from the line so that it now reads as <figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">FC</span>        =  $(DM_FC)<br></code></pre></td></tr></table></figure> Save the configure.wrf with the change and try recompiling. <figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs maxima">./<span class="hljs-built_in">compile</span> -j <span class="hljs-number">8</span> em_real <span class="hljs-number">2</span>&gt;&amp;<span class="hljs-number">1</span> | tee <span class="hljs-built_in">compile</span>.<span class="hljs-built_in">log</span><br></code></pre></td></tr></table></figure></p><p>or</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#cp -r WRF-4.5.1-raw WRFV4.5.1</span><br><br><span class="hljs-built_in">cd</span> WRFV4.5.1/<br><br>./clean -a<br>./configure <br><span class="hljs-comment">##  34 (dmpar) GNU [gfortran/gcc]</span><br><br><span class="hljs-comment">## rewrite: The character class \s will match the whitespace characters &lt;tab&gt; and &lt;space&gt;.</span><br><span class="hljs-comment">## and don&#x27;t include $(DM_FC) </span><br>sed -i <span class="hljs-string">&quot;s/\s\stime\s//g&quot;</span> configure.wrf<br><span class="hljs-comment">#sed -i &quot;s/-DNMM_CORE=$(WRF_NMM_CORE)/-DNMM_CORE=$(WRF_NMM_CORE)\s-DLANDREAD_STUB/g&quot; configure.wrf</span><br><br>./compile -j 4 em_real 2&gt;&amp;1 | <span class="hljs-built_in">tee</span> compile.log<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>WRF</category>
      
    </categories>
    
    
    <tags>
      
      <tag>WRF</tag>
      
      <tag>Installation</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Conda/Micromamba</title>
    <link href="/2024/03/02/Conda_Micromamba/"/>
    <url>/2024/03/02/Conda_Micromamba/</url>
    
    <content type="html"><![CDATA[<p>The easiest way to export a .yml file from a conda environment is to first activate your environment by running: <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">conda activate myvenv<br></code></pre></td></tr></table></figure> And then run the following command that generated your .yml file: <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">conda <span class="hljs-built_in">env</span> <span class="hljs-built_in">export</span> &gt; list.yml<br></code></pre></td></tr></table></figure> Finally, you can create a new environment using the .yml file, like: <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">conda <span class="hljs-built_in">env</span> create --name myvenv --file=list.yml<br></code></pre></td></tr></table></figure></p><p>or <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">conda <span class="hljs-built_in">env</span> <span class="hljs-built_in">export</span> | grep -v <span class="hljs-string">&quot;^prefix: &quot;</span> &gt; environment.yml<br>conda <span class="hljs-built_in">env</span> create -f environment.yml<br></code></pre></td></tr></table></figure></p><p>Remove environment, <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">conda remove -n ENV_NAME --all<br></code></pre></td></tr></table></figure></p><h1 id="micromamba">Micromamba</h1><p>Micromamba is a standalone version of Mamba which is an alternative to Conda. This stack delivers a custom anaconda/miniconda type deployment based on the communities conda-forge channel with micromamba as the package manager. For more information visit <a href="https://mamba.readthedocs.io/en/latest/user_guide/micromamba.html">micromamba documentation</a>.</p><h2 id="installation">Installation</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">wget micro.mamba.pm/install.sh<br><span class="hljs-built_in">chmod</span> +x install.sh<br>./install.sh<br></code></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">## Parsing arguments</span><br><span class="hljs-keyword">if</span> [ -t 0 ] ; <span class="hljs-keyword">then</span><br>  <span class="hljs-built_in">printf</span> <span class="hljs-string">&quot;Micromamba binary folder? [~/.local/bin] &quot;</span><br>  <span class="hljs-built_in">read</span> BIN_FOLDER<br>  <span class="hljs-built_in">printf</span> <span class="hljs-string">&quot;Init shell (<span class="hljs-variable">$shell</span>)? [Y/n] &quot;</span><br>  <span class="hljs-built_in">read</span> INIT_YES<br>  <span class="hljs-built_in">printf</span> <span class="hljs-string">&quot;Configure conda-forge? [Y/n] &quot;</span><br>  <span class="hljs-built_in">read</span> CONDA_FORGE_YES<br><span class="hljs-keyword">fi</span><br></code></pre></td></tr></table></figure><ul><li>/home/wpsze/.local/bin</li><li>init shell? Y</li><li>configure-forge? Y</li></ul><p>Finally, it will initalize micromambs config on .bashrc</p><h3 id="export-the-contents-of-the-existing-environment-to-a-yaml-file.">Export the contents of the existing environment to a YAML file.</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">micromamba <span class="hljs-built_in">env</span> <span class="hljs-built_in">export</span> -n oldenv &gt; oldenv.yaml<br></code></pre></td></tr></table></figure><h3 id="create-env-by-given-yaml">Create env by given yaml</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">micromamba <span class="hljs-built_in">env</span> create --name newenv --file oldenv.yaml<br></code></pre></td></tr></table></figure><h3 id="source-and-activate-env">Source and activate env</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ <span class="hljs-built_in">source</span> /home/wpsze/micromamba/etc/profile.d/micromamba.sh<br>$ micromamba activate venv<br></code></pre></td></tr></table></figure><h3 id="activate-or-execute">activate or execute</h3><p>Transaction finished</p><p>To activate this environment, use:</p><pre><code class="hljs">micromamba activate venv</code></pre><p>Or to execute a single command in this environment, use:</p><pre><code class="hljs">micromamba run -n venv mycommand</code></pre><h2 id="clone-an-environment">clone an environment,</h2><p>As stated in the answer to <a href="https://stackoverflow.com/questions/76884520/cloning-environment-with-micromamba">Cloning environment with micromamba</a>, <strong>--clone</strong> is not an option in micromamba.</p><p>Instead, export the environment yaml and create a new environment using the --file flag. Then remove the old environment.</p><ol type="1"><li>export the env dependencies: micromamba env export -n oldenv &gt; oldenv.yaml</li><li>create a new env with a new name: micromamba create -n newenv --file oldenv.yaml</li><li>remove the old env: micromamba env remove -n oldenv</li><li>delete the yaml file: rm oldenv.yaml</li></ol><h2 id="checkadd-channel">check/add channel</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ micromamba config list --sources<br>channels:<br>  - conda-forge  <span class="hljs-comment"># &#x27;~/.condarc&#x27;</span><br><br>$ micromamba config append channels conda-forge<br></code></pre></td></tr></table></figure><h1 id="references">References</h1><ol type="1"><li><a href="https://hpc.pku.edu.cn/ug/guide/soft/conda/#_3">北京大学高性能计算校级公共平台用户文档</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>conda</tag>
      
      <tag>Micromamba</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>bashrc</title>
    <link href="/2024/03/02/bashrc/"/>
    <url>/2024/03/02/bashrc/</url>
    
    <content type="html"><![CDATA[<p>If you spend a lot of time on the command line, chances are that you’ll want to customize your shell environment. This can mean creating aliases, adding a new directory to the <strong>$PATH</strong> , or changing the look of the shell prompt.</p><p>You may have come across some tutorials where they say to put your configuration either in the <strong>.bashrc</strong>, <strong>.bash_profile</strong> or another configuration file that is read and executed by the bash shell.</p><h1 id="bash-startup-files">Bash Startup Files</h1><p>When invoked as an interactive login shell, Bash looks for the <strong>/etc/profile</strong> file, and if the file exists , it runs the commands listed in the file. Then Bash searches for <strong><sub>/.bash_profile<strong>, </strong></sub>/.bash_login</strong>, and <strong>~/.profile</strong> files, in the listed order, and executes commands from the first readable file found.</p><p>When Bash is invoked as an <em>interactive non-login shell</em>, it reads and executes commands from <strong>~/.bashrc</strong>, if that file exists, and it is readable.</p><h2 id="difference-between-.bashrc-and-.bash_profile">Difference Between .bashrc and .bash_profile</h2><p><strong>.bash_profile</strong> is read and executed when Bash is invoked as an interactive login shell, while <strong>.bashrc</strong> is executed for an interactive non-login shell.</p><p>Use <strong>.bash_profile</strong> to run commands that should run only once, such as customizing the <strong>$PATH</strong> environment variable .</p><p>Put the commands that should run every time you launch a new shell in the <strong>.bashrc</strong> file. This include your aliases and functions , custom prompts, history customizations , and so on.</p><blockquote><p>Typically, ~/.bash_profile contains lines like below that source the .bashrc file. This means each time you log in to the terminal, both files are read and executed.</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-keyword">if</span> [ -f ~/.bashrc ]; <span class="hljs-keyword">then</span><br>. ~/.bashrc<br><span class="hljs-keyword">fi</span><br></code></pre></td></tr></table></figure><h2 id="profile-and-.bash_profile">~/.profile and ~/.bash_profile</h2><p>Most Linux distributions are using <strong>~/.profile</strong> instead of <strong><sub>/.bash_profile<strong>. The </strong></sub>/.profile</strong> file is read by <em>all shells</em>, while <strong>~/.bash_profile</strong> <em>only by Bash</em>.</p><p>If any startup file is not present on your system, you can create it.</p><h1 id="more">More</h1><h2 id="profile">profile</h2><p>profile，路徑：/etc/profile，用於設定係統級的環境變數和啟動程序，在此文件下配置對所有使用者生效。 當登入使用者（login）時，檔案會被執行，並從/etc/profile.d目錄的設定檔中找到shell設定。</p><h2 id="bash_profile">bash_profile</h2><p>bash_profile只對單一使用者有效，檔案儲存位於~/.bash_profile，該檔案是一個使用者層級的設置，可以理解為某個使用者的設定檔目錄下。</p><p>該文件也可以用於配置環境變數和啟動程序，但僅針對單一使用者有效。</p><p>和 profile 檔案類似，bash_profile 也可以在使用者登入（login）時生效，也可以用來設定環境變數。</p><p>但與 profile 不同，bash_profile 只能對目前使用者生效。</p><p>#BASH Alias BASH Alias is a shortcut to run commands using some mapping. It is a way to create some shortcut commands for repetitive and multiple tasks. We create an alias in a BASH environment in specified files. We can also incorporate BASH functions, variables, etc to make the Alias more programmatic and flexible.</p>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>bashrc</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>vim</title>
    <link href="/2023/10/20/vim/"/>
    <url>/2023/10/20/vim/</url>
    
    <content type="html"><![CDATA[<h1 id="vimrc-setup">.vimrc setup</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">set</span> showmode<br><span class="hljs-built_in">set</span> encoding=utf-8 <br><span class="hljs-built_in">set</span> t_Co=256<br><span class="hljs-built_in">set</span> tabstop=4<br><span class="hljs-built_in">set</span> shiftwidth=4<br><span class="hljs-built_in">set</span> expandtab<br><br><span class="hljs-built_in">set</span> nolist<br><br><span class="hljs-built_in">set</span> number<br><br><span class="hljs-built_in">set</span> <span class="hljs-built_in">paste</span><br><br><span class="hljs-built_in">set</span> showmatch<br><br>autocmd BufNewFile *.py,*.sh <span class="hljs-built_in">exec</span> <span class="hljs-string">&quot;:call SetTitle()&quot;</span><br><br>func SetTitle()<br><span class="hljs-keyword">if</span> <span class="hljs-built_in">expand</span>(<span class="hljs-string">&quot;%:e&quot;</span>) == <span class="hljs-string">&#x27;sh&#x27;</span><br>    call setline(1,<span class="hljs-string">&quot;#!/bin/bash&quot;</span>)<br>elseif <span class="hljs-built_in">expand</span>(<span class="hljs-string">&quot;%:e&quot;</span>) == <span class="hljs-string">&#x27;py&#x27;</span><br>    call setline(1,<span class="hljs-string">&quot;#!/bin/python&quot;</span>)<br>endif<br><br>call setline(2,<span class="hljs-string">&quot;&quot;</span>)<br>call setline(3,<span class="hljs-string">&quot;#------------------------------------------------#&quot;</span>)<br>call setline(4,<span class="hljs-string">&quot;#Author:         wpsze&quot;</span>)<br>call setline(5,<span class="hljs-string">&quot;#Email：         wpsze@gmail.com&quot;</span>)<br>call setline(6,<span class="hljs-string">&quot;#date:           &quot;</span>.strftime(<span class="hljs-string">&quot;%Y-%m-%d %H:%M:%S&quot;</span>))<br>call setline(7,<span class="hljs-string">&quot;#Version:        0.0 &quot;</span>)<br>call setline(8,<span class="hljs-string">&quot;#Description:    The purpose of the script&quot;</span>)<br>call setline(9,<span class="hljs-string">&quot;#Copyright (C)： &quot;</span>.strftime(<span class="hljs-string">&quot;%Y&quot;</span>).<span class="hljs-string">&quot; All rights reserved&quot;</span>)<br>call setline(10,<span class="hljs-string">&quot;#------------------------------------------------#&quot;</span>)<br>call setline(11,<span class="hljs-string">&quot;&quot;</span>)<br>call setline(12,<span class="hljs-string">&quot;&quot;</span>)<br><br><span class="hljs-keyword">if</span> <span class="hljs-built_in">expand</span>(<span class="hljs-string">&quot;%:e&quot;</span>) == <span class="hljs-string">&#x27;sh&#x27;</span><br>    call setline(14, <span class="hljs-string">&quot;#source /home/wpsze/anaconda3/bin/activate venv&quot;</span>)<br>    call setline(16, <span class="hljs-string">&quot;export SCRIPT_DIR=\x22<span class="hljs-subst">$( cd \x22$( dirname \x22$&#123;BASH_SOURCE[0]&#125;\x22 )</span>\x22 &gt;/dev/null 2&gt;&amp;1 &amp;&amp; pwd )\x22&quot;</span>)<br>endif<br><br>endfunc<br><br>autocmd BufNewFile * normal G<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>HPC</tag>
      
      <tag>vim</tag>
      
      <tag>editor</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HKO station and analysis</title>
    <link href="/2023/06/24/HKO-station-and-analysis/"/>
    <url>/2023/06/24/HKO-station-and-analysis/</url>
    
    <content type="html"><![CDATA[<h1 id="download-hko-weather-dataset">Download HKO weather dataset</h1><p>From <a href="https://i-lens.hk/hkweather/">i-lens.hk 香港自動氣象站氣候觀測資料庫</a> <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">export</span> yyyy=2023<br><span class="hljs-built_in">export</span> mm=04<br><br><span class="hljs-keyword">for</span> <span class="hljs-built_in">dd</span> <span class="hljs-keyword">in</span> &#123;14..16&#125;; <span class="hljs-keyword">do</span><br>    wget http://i-lens.hk/hkweather/history_minute_record/<span class="hljs-variable">$&#123;yyyy&#125;</span>/<span class="hljs-variable">$&#123;yyyy&#125;</span><span class="hljs-variable">$&#123;mm&#125;</span><span class="hljs-variable">$&#123;dd&#125;</span>.zip ;<br>    <span class="hljs-built_in">echo</span> $mm<span class="hljs-variable">$dd</span> sleeping now ;<br>    <span class="hljs-comment">#mkdir -p $yyyy</span><br>    <span class="hljs-comment">#mv $&#123;yyyy&#125;$&#123;mm&#125;$&#123;dd&#125;* ./$&#123;yyyy&#125; ;</span><br>    <span class="hljs-comment">#sleep $((80 + RANDOM % 21)) ;</span><br><span class="hljs-keyword">done</span><br></code></pre></td></tr></table></figure> Subsequently, extract those elements.</p><h1 id="list-of-hko-station">List of HKO station</h1><p>As part of the HKO stations, the majority of the names I use align with the definitions provided by HKO. However, there are a few instances where I have personally assigned names to certain elements.</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs sh">ID,lat,lon,station,station_en,station_ch<br>1,22.301944,114.174167,hko,HKO (Tsim Sha Tsui),香港天文台<br>2,22.201111,114.026667,cch,Cheung Chau,長洲<br>3,22.263389,114.299769,cwb,Clear water bay,清水灣<br>4,22.309444,113.921944,hka,HK Airport,香港國際機場<br>5,22.278333,114.162222,hkp,Hong Kong Park,香港公園<br>6,22.247778,114.173611,hks,Wong Chuk Hang,黃竹坑<br>7,22.270556,114.183611,hpv,Happy Valley,跑馬地<br>8,22.315833,114.255556,jkb,Tseung Kwan O,將軍澳<br>9,22.335000,114.184722,klt,Kowloon City,九龍城<br>10,22.311944,114.172778,kp,King’s Park,京士柏<br>11,22.370278,114.312500,ksc,Kau Sai Chau,滘西洲<br>12,22.318611,114.224722,ktg,Kwun Tong,觀塘<br>13,22.468889,113.983611,lfs,Lau Fau Shan,流浮山<br>14,22.258611,113.912778,ngp,Ngong Ping,昂坪<br>15,22.291111,114.043333,pen,Peng Chau,坪洲<br>16,22.475278,114.237500,plc,Tai Mei Tuk,大美督<br>17,22.304722,114.217222,se1,Kai Tak Runway Park,啟德跑道公園<br>18,22.436111,114.084722,sek,Shek Kong,石崗<br>19,22.402500,114.210000,sha,Sha Tin,沙田<br>20,22.375556,114.274444,skg,Sai Kung,西貢<br>21,22.281667,114.236111,skw,Shau Kei Wan,筲箕灣<br>22,22.501944,114.111111,ssh,Sheung Shui,上水<br>23,22.335833,114.136944,ssp,Sham Shui Po,深水埗<br>24,22.214167,114.218611,sty,Stanley,赤柱<br>25,22.357778,114.217778,tc,Tate<span class="hljs-string">&#x27;s Cairn,大老山</span><br><span class="hljs-string">26,22.528611,114.156667,tkl,Ta Kwu Ling,打鼓嶺</span><br><span class="hljs-string">27,22.483480,114.117400,tl,Tai Lung,大隴</span><br><span class="hljs-string">28,22.410556,114.124444,tms,Tai Mo Shan,大帽山</span><br><span class="hljs-string">29,22.446111,114.178889,tpo,Tai Po,大埔</span><br><span class="hljs-string">30,22.385833,113.964167,tu1,Tuen Mun Children and Juvenile Home,屯門兒童及青少年院</span><br><span class="hljs-string">31,22.375556,114.126667,tw,Shing Mun Valley,荃灣城門谷</span><br><span class="hljs-string">32,22.383611,114.107778,twn,Tsuen Wan,荃灣</span><br><span class="hljs-string">33,22.344167,114.110000,ty1,Tsing Yi Station,新青衣站</span><br><span class="hljs-string">34,22.402778,114.323056,tyw,Pak Tam Chung,北潭涌(鯽魚湖)</span><br><span class="hljs-string">35,22.264167,114.155000,vp1,The Peak,山頂</span><br><span class="hljs-string">36,22.182222,114.303333,wgl,Waglan Island,橫瀾島</span><br><span class="hljs-string">37,22.466667,114.008889,wlp,Wetland Park,濕地公園</span><br><span class="hljs-string">38,22.339444,114.205278,wts,Wong Tai Sin,黃大仙</span><br><span class="hljs-string">39,22.440833,114.018333,ylp,ylp,ylp</span><br></code></pre></td></tr></table></figure><h1 id="jupter-notebook-or-python">Jupter Notebook or python</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python</span><br><span class="hljs-comment"># coding: utf-8</span><br><br><span class="hljs-comment"># In[1]:</span><br><br><br><span class="hljs-keyword">import</span> glob, os<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">import</span> xarray <span class="hljs-keyword">as</span> xr<br><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<br><span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> timedelta<br><br><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt<br><span class="hljs-keyword">from</span> matplotlib <span class="hljs-keyword">import</span> cm<br>SMALL_SIZE = <span class="hljs-number">8</span><br>MEDIUM_SIZE = <span class="hljs-number">10</span><br>BIGGER_SIZE = <span class="hljs-number">24</span><br><br>plt.rcParams[<span class="hljs-string">&quot;figure.figsize&quot;</span>] = (<span class="hljs-number">10</span>,<span class="hljs-number">8</span>)<br>plt.rc(<span class="hljs-string">&#x27;font&#x27;</span>, size=BIGGER_SIZE)          <span class="hljs-comment"># controls default text sizes</span><br>plt.rc(<span class="hljs-string">&#x27;axes&#x27;</span>, titlesize=BIGGER_SIZE)     <span class="hljs-comment"># fontsize of the axes title</span><br>plt.rc(<span class="hljs-string">&#x27;axes&#x27;</span>, labelsize=BIGGER_SIZE)    <span class="hljs-comment"># fontsize of the x and y labels</span><br>plt.rc(<span class="hljs-string">&#x27;xtick&#x27;</span>, labelsize=BIGGER_SIZE)    <span class="hljs-comment"># fontsize of the tick labels</span><br>plt.rc(<span class="hljs-string">&#x27;ytick&#x27;</span>, labelsize=BIGGER_SIZE)    <span class="hljs-comment"># fontsize of the tick labels</span><br>plt.rc(<span class="hljs-string">&#x27;legend&#x27;</span>, fontsize=BIGGER_SIZE)    <span class="hljs-comment"># legend fontsize</span><br>plt.rc(<span class="hljs-string">&#x27;figure&#x27;</span>, titlesize=BIGGER_SIZE)  <span class="hljs-comment"># fontsize of the figure title</span><br><br><span class="hljs-comment"># plt.rcParams[&#x27;font.sans-serif&#x27;] = [&#x27;SimHei&#x27;] </span><br><span class="hljs-comment"># plt.rcParams[&#x27;axes.unicode_minus&#x27;] = False</span><br><br>plt.rcParams.update(&#123;<span class="hljs-string">&#x27;font.family&#x27;</span>:<span class="hljs-string">&#x27;sans-serif&#x27;</span>&#125;)<br>plt.rcParams[<span class="hljs-string">&#x27;font.sans-serif&#x27;</span>] = [<span class="hljs-string">&#x27;DejaVu Sans&#x27;</span>]<br><br><span class="hljs-comment"># from IPython.core.interactiveshell import InteractiveShell</span><br><span class="hljs-comment"># InteractiveShell.ast_node_interactivity = &quot;all&quot;</span><br><br><br><span class="hljs-comment"># # Reading all dataset</span><br><br><span class="hljs-comment"># In[2]:</span><br><br><br>select_year = <span class="hljs-string">&quot;202304&quot;</span><br><br>station = pd.read_csv(<span class="hljs-string">r&#x27;./HKO-station.csv&#x27;</span>, header=<span class="hljs-number">0</span>) <span class="hljs-comment"># nearwater or inland</span><br>select_num = <span class="hljs-number">7</span><br><span class="hljs-comment">#======================================== station =============================================</span><br>select_station = station[<span class="hljs-string">&quot;station&quot;</span>][select_num]<br>select_station_en = station[<span class="hljs-string">&quot;station_en&quot;</span>][select_num]<br>select_station_ch = station[<span class="hljs-string">&quot;station_ch&quot;</span>][select_num]<br>file_name_t2m = select_station+<span class="hljs-string">&quot;_&quot;</span>+select_year<br>file_name_wind = select_station+<span class="hljs-string">&quot;_wd_&quot;</span>+select_year<br>file_name_pressure = select_station+<span class="hljs-string">&quot;_pre_&quot;</span>+select_year<br><span class="hljs-built_in">print</span>(select_num, select_station, select_station_en, select_station_ch)<br>station<br><br><br><span class="hljs-comment"># In[3]:</span><br><br><br><span class="hljs-comment">#========================================= mpas ================================================</span><br>mpas_station_extraction_dir=<span class="hljs-string">&quot;/xxx/xxx/station_xxxx.csv&quot;</span><br>df_mpas = pd.read_csv(mpas_station_extraction_dir)<br><span class="hljs-comment"># .dt.tz_localize(None): to remove timezone from a Timestamp column in a pandas dataframe</span><br>df_mpas[<span class="hljs-string">&quot;Date(UTC)&quot;</span>] = pd.to_datetime(df_mpas[<span class="hljs-string">&quot;xtime[UTC]&quot;</span>], utc=<span class="hljs-string">&quot;false&quot;</span>).dt.tz_localize(<span class="hljs-literal">None</span>)<br>df_mpas[<span class="hljs-string">&quot;Date(HKT)&quot;</span>] = df_mpas[<span class="hljs-string">&quot;Date(UTC)&quot;</span>] + timedelta(hours=<span class="hljs-number">8</span>)<br><br>df_select_mpas = df_mpas[df_mpas[<span class="hljs-string">&quot;station&quot;</span>] == select_station]<br>df_select_mpas = df_select_mpas.reset_index(drop = <span class="hljs-literal">True</span>)<br><br><span class="hljs-comment">#=========================================== HKO t2m ==============================================</span><br>obs_file = []<br><span class="hljs-keyword">for</span> file <span class="hljs-keyword">in</span> glob.glob(<span class="hljs-string">f&quot;/home/wpsze/hk_data/<span class="hljs-subst">&#123;select_year&#125;</span>*/<span class="hljs-subst">&#123;file_name_t2m&#125;</span>*&quot;</span>):<br>    obs_file.append(file)<br><span class="hljs-built_in">print</span>(obs_file)<br>df = pd.concat((pd.read_csv(f, header = <span class="hljs-number">0</span>, na_values=[<span class="hljs-string">&#x27;nan&#x27;</span>], keep_default_na=<span class="hljs-literal">True</span>) <span class="hljs-keyword">for</span> f <span class="hljs-keyword">in</span> obs_file))<br>df_hko_obs = df.drop_duplicates()<br>df_hko_obs = df_hko_obs.reset_index(drop = <span class="hljs-literal">True</span>)<br><br>df_hko_obs[<span class="hljs-string">&quot;Date(HKT)&quot;</span>] = pd.to_datetime(df_hko_obs[<span class="hljs-string">&quot;Date&quot;</span>]) <br>df_hko_obs[<span class="hljs-string">&quot;Date(UTC)&quot;</span>] = df_hko_obs[<span class="hljs-string">&quot;Date(HKT)&quot;</span>] + timedelta(hours=-<span class="hljs-number">8</span>)<br>df_hko_obs = df_hko_obs.reset_index(drop = <span class="hljs-literal">True</span>)<br>df_hko_obs<br><span class="hljs-comment">#=========================================================================================</span><br>df_combine = pd.merge(df_select_mpas, df_hko_obs)<br><span class="hljs-comment">#=========================================== HKO wind ==============================================</span><br>obs_file = []<br><span class="hljs-keyword">for</span> file <span class="hljs-keyword">in</span> glob.glob(<span class="hljs-string">f&quot;/em/home/wpsze/hk_data/<span class="hljs-subst">&#123;select_year&#125;</span>*/<span class="hljs-subst">&#123;file_name_wind&#125;</span>*&quot;</span>):<br>    obs_file.append(file)<br><span class="hljs-built_in">print</span>(obs_file)<br>df = pd.concat((pd.read_csv(f, header = <span class="hljs-number">0</span>, na_values=[<span class="hljs-string">&#x27;nan&#x27;</span>], keep_default_na=<span class="hljs-literal">True</span>) <span class="hljs-keyword">for</span> f <span class="hljs-keyword">in</span> obs_file))<br>df_hko_obs = df.drop_duplicates()<br>df_hko_obs = df_hko_obs.reset_index(drop = <span class="hljs-literal">True</span>)<br>df_hko_obs<br><br>df_hko_obs[<span class="hljs-string">&quot;Date(HKT)&quot;</span>] = pd.to_datetime(df_hko_obs[<span class="hljs-string">&quot;Date&quot;</span>]) <br>df_hko_obs[<span class="hljs-string">&quot;Date(UTC)&quot;</span>] = df_hko_obs[<span class="hljs-string">&quot;Date(HKT)&quot;</span>] + timedelta(hours=-<span class="hljs-number">8</span>)<br>df_hko_obs[<span class="hljs-string">&quot;obs-wspd[m/s]&quot;</span>] = df_hko_obs[<span class="hljs-string">&quot;Wind Spd&quot;</span>]*<span class="hljs-number">0.514444444</span> <span class="hljs-comment"># knt to m/s</span><br>df_hko_obs[<span class="hljs-string">&quot;obs-wdir[deg]&quot;</span>] = df_hko_obs[<span class="hljs-string">&quot; Wind Dir&quot;</span>]<br>df_hko_obs = df_hko_obs.reset_index(drop = <span class="hljs-literal">True</span>)<br>df_hko_obs<br><span class="hljs-comment">#=========================================================================================</span><br>df_combine = pd.merge(df_combine, df_hko_obs)<br><span class="hljs-comment">#=========================================================================================</span><br>spin_up_period = <span class="hljs-number">72</span><br>df_combine_skip_spinup = df_combine[spin_up_period:]<br>df_combine_skip_spinup = df_combine_skip_spinup.reset_index(drop = <span class="hljs-literal">True</span>)<br>df_combine_skip_spinup<br><br><br><span class="hljs-comment"># In[4]:</span><br><br><br>df_combine_final = df_combine_skip_spinup[df_combine_skip_spinup[<span class="hljs-string">&quot;obs-wspd[m/s]&quot;</span>]&lt;<span class="hljs-number">100</span>] <br>df_combine_final = df_combine_final.reset_index(drop = <span class="hljs-literal">True</span>)<br>df_combine_final<br><br><br><span class="hljs-comment"># # For t2m</span><br><br><span class="hljs-comment"># In[33]:</span><br><br><br>plt.plot(df_combine_final[<span class="hljs-string">&quot;Date(HKT)&quot;</span>], df_combine_final[<span class="hljs-string">&quot;Temp&quot;</span>], <span class="hljs-string">&#x27;ko-&#x27;</span>, label=<span class="hljs-string">&quot;Obs&quot;</span>)<br>plt.plot(df_combine_final[<span class="hljs-string">&quot;Date(HKT)&quot;</span>], df_combine_final[<span class="hljs-string">&quot;t2m[degC]&quot;</span>],<span class="hljs-string">&#x27;bo-&#x27;</span>, label=<span class="hljs-string">&quot;mpas&quot;</span>)<br>plt.grid(zorder=<span class="hljs-number">0</span>)<br>plt.xlabel(<span class="hljs-string">&quot;Date Time (HKT)&quot;</span>)<br>plt.ylabel(<span class="hljs-string">&quot;T2m [deg C]&quot;</span>)<br>plt.title(select_station_en)<br>plt.xticks(rotation=<span class="hljs-number">45</span>)<br>plt.legend()<br>plt.tight_layout()<br>plt.show()<br>plt.close()<br><br><span class="hljs-comment"># df_combine_final[&quot;Temp&quot;]</span><br><br><br><span class="hljs-comment"># # For wind speed</span><br><br><span class="hljs-comment"># In[6]:</span><br><br><br>plt.plot(df_combine_final[<span class="hljs-string">&quot;Date(HKT)&quot;</span>], df_combine_final[<span class="hljs-string">&quot;Temp&quot;</span>], <span class="hljs-string">&#x27;ko-&#x27;</span>, label=<span class="hljs-string">&quot;Obs&quot;</span>)<br>plt.plot(df_combine_final[<span class="hljs-string">&quot;Date(HKT)&quot;</span>], df_combine_final[<span class="hljs-string">&quot;t2m[degC]&quot;</span>],<span class="hljs-string">&#x27;bo-&#x27;</span>, label=<span class="hljs-string">&quot;mpas&quot;</span>)<br>plt.grid(zorder=<span class="hljs-number">0</span>)<br>plt.xlabel(<span class="hljs-string">&quot;Date Time (HKT)&quot;</span>)<br>plt.ylabel(<span class="hljs-string">&quot;T2m [deg C]&quot;</span>)<br>plt.title(select_station_en)<br>plt.xticks(rotation=<span class="hljs-number">45</span>)<br>plt.legend()<br>plt.show()<br>plt.close()<br><br><br><span class="hljs-comment"># In[7]:</span><br><br><br><span class="hljs-comment">#=========================================================</span><br><br>hko_wind = df_combine_final[<span class="hljs-string">&quot;obs-wspd[m/s]&quot;</span>]<br>hko_wdir = df_combine_final[<span class="hljs-string">&quot;obs-wdir[deg]&quot;</span>]<br><br>size = hko_wdir.shape[<span class="hljs-number">0</span>]<br><br>wspd = hko_wind*<span class="hljs-number">1.9438452</span>    <span class="hljs-comment"># m/s to kt</span><br>wdir = hko_wdir*<span class="hljs-number">0.0174532925</span> <span class="hljs-comment"># deg to rad</span><br>U_obs = -wspd*np.sin(wdir)<br>V_obs = -wspd*np.cos(wdir)<br><br>df = pd.DataFrame(np.vstack([U_obs,V_obs]).T, columns=[<span class="hljs-string">&#x27;U&#x27;</span>, <span class="hljs-string">&#x27;V&#x27;</span>])<br><br><span class="hljs-comment">#=========================================================</span><br>mpas_wind = df_combine_final[<span class="hljs-string">&quot;wspd[m/s]&quot;</span>]<br>mpas_wdir = df_combine_final[<span class="hljs-string">&quot;wdir[deg]&quot;</span>]<br><br>wspd = mpas_wind*<span class="hljs-number">1.9438452</span>    <span class="hljs-comment"># m/s to kt</span><br>wdir = mpas_wdir*<span class="hljs-number">0.0174532925</span> <span class="hljs-comment"># deg to rad</span><br>U_mpas = -wspd*np.sin(wdir)<br>V_mpas = -wspd*np.cos(wdir)<br><br>df_mpas = pd.DataFrame(np.vstack([U_mpas,V_mpas]).T, columns=[<span class="hljs-string">&#x27;U&#x27;</span>, <span class="hljs-string">&#x27;V&#x27;</span>])<br><br><span class="hljs-comment">#=========================================================</span><br><br>fig, ax = plt.subplots(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>, figsize=(<span class="hljs-number">15</span>,<span class="hljs-number">4</span>))<br><br><span class="hljs-comment"># ax.plot(df.index.values.astype(&#x27;d&#x27;), df.V * 0.1 + 4, color=&#x27;k&#x27;)</span><br><span class="hljs-comment"># ax.quiver(df.index.values.astype(&#x27;d&#x27;), np.ones(size) * 2, df.U.values, df.V.values) #, pivot=&#x27;mid&#x27;)</span><br><br>plt.barbs(df_combine_final[<span class="hljs-string">&quot;Date(HKT)&quot;</span>], np.ones(size) * <span class="hljs-number">4</span>, df.U.values, df.V.values, length=<span class="hljs-number">8</span>, barbcolor=<span class="hljs-string">&#x27;k&#x27;</span>)<br><br>plt.barbs(df_combine_final[<span class="hljs-string">&quot;Date(HKT)&quot;</span>], np.ones(size) * <span class="hljs-number">2</span>, df_mpas.U.values, df_mpas.V.values, length=<span class="hljs-number">8</span>, barbcolor=<span class="hljs-string">&#x27;b&#x27;</span>)<br><br>ax.set_ylim([-<span class="hljs-number">1</span>,<span class="hljs-number">6</span>])<br>plt.xticks(rotation=<span class="hljs-number">45</span>)<br>plt.xlabel(<span class="hljs-string">&quot;Date Time (HKT)&quot;</span>)<br>plt.title(select_station_en)<br>plt.xticks(rotation=<span class="hljs-number">45</span>)<br><span class="hljs-comment"># plt.legend()</span><br>plt.show()<br>plt.close()<br><br><br><span class="hljs-comment"># In[8]:</span><br><br><br>fig, ax = plt.subplots(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>, figsize=(<span class="hljs-number">15</span>,<span class="hljs-number">8</span>))<br><br>plt.plot(df_combine_final[<span class="hljs-string">&quot;Date(HKT)&quot;</span>], df_combine_final[<span class="hljs-string">&quot;obs-wspd[m/s]&quot;</span>], <span class="hljs-string">&#x27;ko-&#x27;</span>, label=<span class="hljs-string">&quot;Obs&quot;</span>)<br>plt.plot(df_combine_final[<span class="hljs-string">&quot;Date(HKT)&quot;</span>], df_combine_final[<span class="hljs-string">&quot;wspd[m/s]&quot;</span>],<span class="hljs-string">&#x27;ro-&#x27;</span>, label=<span class="hljs-string">&quot;mpas&quot;</span>)<br><br>plt.barbs(df_combine_final[<span class="hljs-string">&quot;Date(HKT)&quot;</span>], np.ones(size) * -<span class="hljs-number">2</span>, df.U.values, df.V.values, length=<span class="hljs-number">8</span>, barbcolor=<span class="hljs-string">&#x27;k&#x27;</span>)<br><br>plt.barbs(df_combine_final[<span class="hljs-string">&quot;Date(HKT)&quot;</span>], np.ones(size) * -<span class="hljs-number">5</span>, df_mpas.U.values, df_mpas.V.values, length=<span class="hljs-number">8</span>, barbcolor=<span class="hljs-string">&#x27;r&#x27;</span>)<br><br>plt.grid(zorder=<span class="hljs-number">0</span>)<br>plt.xlabel(<span class="hljs-string">&quot;Date Time (HKT)&quot;</span>)<br>plt.ylabel(<span class="hljs-string">&quot;Wind Speed [m/s]&quot;</span>)<br>plt.title(select_station_en)<br>plt.xticks(rotation=<span class="hljs-number">45</span>)<br>plt.ylim([-<span class="hljs-number">7</span>,<span class="hljs-number">12</span>])<br>plt.axhline(y=<span class="hljs-number">0.0</span>, color=<span class="hljs-string">&#x27;k&#x27;</span>, linestyle=<span class="hljs-string">&#x27;-&#x27;</span>)<br>plt.legend()<br>plt.show()<br>plt.close() <br><br><br><span class="hljs-comment"># ## Seperate u and v directions</span><br><span class="hljs-comment"># </span><br><span class="hljs-comment"># U_obs = -wspd x np.sin(wdir)\</span><br><span class="hljs-comment"># V_obs = -wspd x np.cos(wdir)</span><br><br><span class="hljs-comment"># In[9]:</span><br><br><br>fig, ax = plt.subplots(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>, figsize=(<span class="hljs-number">15</span>,<span class="hljs-number">8</span>))<br><br>kt2ms = <span class="hljs-number">0.514444444</span><br><br>plt.plot(df_combine_final[<span class="hljs-string">&quot;Date(HKT)&quot;</span>], U_obs*kt2ms, <span class="hljs-string">&#x27;ko-&#x27;</span>, label=<span class="hljs-string">&quot;Obs&quot;</span>)<br>plt.plot(df_combine_final[<span class="hljs-string">&quot;Date(HKT)&quot;</span>], U_mpas*kt2ms,<span class="hljs-string">&#x27;ro-&#x27;</span>, label=<span class="hljs-string">&quot;mpas&quot;</span>)<br><br>plt.grid(zorder=<span class="hljs-number">0</span>)<br>plt.xlabel(<span class="hljs-string">&quot;Date Time (HKT)&quot;</span>)<br>plt.ylabel(<span class="hljs-string">&quot;U Wind Speed [m/s]&quot;</span>)<br>plt.title(select_station_en)<br>plt.xticks(rotation=<span class="hljs-number">45</span>)<br><span class="hljs-comment"># plt.ylim([-7,10])</span><br>plt.axhline(y=<span class="hljs-number">0.0</span>, color=<span class="hljs-string">&#x27;k&#x27;</span>, linestyle=<span class="hljs-string">&#x27;-&#x27;</span>)<br>plt.legend()<br>plt.show()<br>plt.close() <br><br>fig, ax = plt.subplots(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>, figsize=(<span class="hljs-number">15</span>,<span class="hljs-number">8</span>))<br><br>plt.plot(df_combine_final[<span class="hljs-string">&quot;Date(HKT)&quot;</span>], V_obs*kt2ms, <span class="hljs-string">&#x27;ko-&#x27;</span>, label=<span class="hljs-string">&quot;Obs&quot;</span>)<br>plt.plot(df_combine_final[<span class="hljs-string">&quot;Date(HKT)&quot;</span>], V_mpas*kt2ms,<span class="hljs-string">&#x27;ro-&#x27;</span>, label=<span class="hljs-string">&quot;mpas&quot;</span>)<br><br>plt.grid(zorder=<span class="hljs-number">0</span>)<br>plt.xlabel(<span class="hljs-string">&quot;Date Time (HKT)&quot;</span>)<br>plt.ylabel(<span class="hljs-string">&quot;V Wind Speed [m/s]&quot;</span>)<br>plt.title(select_station_en)<br>plt.xticks(rotation=<span class="hljs-number">45</span>)<br><span class="hljs-comment"># plt.ylim([-7,10])</span><br>plt.axhline(y=<span class="hljs-number">0.0</span>, color=<span class="hljs-string">&#x27;k&#x27;</span>, linestyle=<span class="hljs-string">&#x27;-&#x27;</span>)<br>plt.legend()<br>plt.show()<br>plt.close() <br><br><br><span class="hljs-comment"># # Final Plot</span><br><br><span class="hljs-comment"># In[26]:</span><br><br><br>fig = plt.subplots(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>, figsize=(<span class="hljs-number">20</span>,<span class="hljs-number">12</span>))<br><br>ax = plt.subplot(<span class="hljs-number">221</span>)<br>plt.plot(df_combine_final[<span class="hljs-string">&quot;Date(HKT)&quot;</span>], df_combine_final[<span class="hljs-string">&quot;Temp&quot;</span>], <span class="hljs-string">&#x27;ko-&#x27;</span>, label=<span class="hljs-string">&quot;Obs&quot;</span>)<br>plt.plot(df_combine_final[<span class="hljs-string">&quot;Date(HKT)&quot;</span>], df_combine_final[<span class="hljs-string">&quot;t2m[degC]&quot;</span>],<span class="hljs-string">&#x27;ro-&#x27;</span>, label=<span class="hljs-string">&quot;mpas&quot;</span>)<br>plt.grid(zorder=<span class="hljs-number">0</span>)<br>plt.xlabel(<span class="hljs-string">&quot;Date Time (HKT)&quot;</span>)<br>plt.ylabel(<span class="hljs-string">&quot;T2m [deg C]&quot;</span>)<br>plt.title(select_station_en)<br>plt.xticks(rotation=<span class="hljs-number">45</span>)<br>plt.legend()<br>plt.tight_layout()<br><br>ax = plt.subplot(<span class="hljs-number">222</span>)<br>plt.plot(df_combine_final[<span class="hljs-string">&quot;Date(HKT)&quot;</span>], df_combine_final[<span class="hljs-string">&quot;obs-wspd[m/s]&quot;</span>], <span class="hljs-string">&#x27;ko-&#x27;</span>, label=<span class="hljs-string">&quot;Obs&quot;</span>)<br>plt.plot(df_combine_final[<span class="hljs-string">&quot;Date(HKT)&quot;</span>], df_combine_final[<span class="hljs-string">&quot;wspd[m/s]&quot;</span>],<span class="hljs-string">&#x27;ro-&#x27;</span>, label=<span class="hljs-string">&quot;mpas&quot;</span>)<br>plt.barbs(df_combine_final[<span class="hljs-string">&quot;Date(HKT)&quot;</span>], np.ones(size) * -<span class="hljs-number">2</span>, df.U.values, df.V.values, length=<span class="hljs-number">8</span>, barbcolor=<span class="hljs-string">&#x27;k&#x27;</span>)<br>plt.barbs(df_combine_final[<span class="hljs-string">&quot;Date(HKT)&quot;</span>], np.ones(size) * -<span class="hljs-number">5</span>, df_mpas.U.values, df_mpas.V.values, length=<span class="hljs-number">8</span>, barbcolor=<span class="hljs-string">&#x27;r&#x27;</span>)<br>plt.grid(zorder=<span class="hljs-number">0</span>)<br>plt.xlabel(<span class="hljs-string">&quot;Date Time (HKT)&quot;</span>)<br>plt.ylabel(<span class="hljs-string">&quot;Wind Speed [m/s]&quot;</span>)<br>plt.title(select_station_en)<br>plt.xticks(rotation=<span class="hljs-number">45</span>)<br>plt.ylim([-<span class="hljs-number">7</span>,<span class="hljs-number">12</span>])<br>plt.axhline(y=<span class="hljs-number">0.0</span>, color=<span class="hljs-string">&#x27;k&#x27;</span>, linestyle=<span class="hljs-string">&#x27;-&#x27;</span>)<br>plt.legend()<br><br><br>kt2ms = <span class="hljs-number">0.514444444</span><br>ax = plt.subplot(<span class="hljs-number">223</span>)<br>plt.plot(df_combine_final[<span class="hljs-string">&quot;Date(HKT)&quot;</span>], U_obs*kt2ms, <span class="hljs-string">&#x27;ko-&#x27;</span>, label=<span class="hljs-string">&quot;Obs&quot;</span>)<br>plt.plot(df_combine_final[<span class="hljs-string">&quot;Date(HKT)&quot;</span>], U_mpas*kt2ms,<span class="hljs-string">&#x27;ro-&#x27;</span>, label=<span class="hljs-string">&quot;mpas&quot;</span>)<br>plt.grid(zorder=<span class="hljs-number">0</span>)<br>plt.xlabel(<span class="hljs-string">&quot;Date Time (HKT)&quot;</span>)<br>plt.ylabel(<span class="hljs-string">&quot;U Wind Speed [m/s]&quot;</span>)<br>plt.title(select_station_en)<br>plt.xticks(rotation=<span class="hljs-number">45</span>)<br><span class="hljs-comment"># plt.ylim([-7,10])</span><br>plt.axhline(y=<span class="hljs-number">0.0</span>, color=<span class="hljs-string">&#x27;k&#x27;</span>, linestyle=<span class="hljs-string">&#x27;-&#x27;</span>)<br>plt.legend()<br><br><br>ax = plt.subplot(<span class="hljs-number">224</span>)<br>plt.plot(df_combine_final[<span class="hljs-string">&quot;Date(HKT)&quot;</span>], V_obs*kt2ms, <span class="hljs-string">&#x27;ko-&#x27;</span>, label=<span class="hljs-string">&quot;Obs&quot;</span>)<br>plt.plot(df_combine_final[<span class="hljs-string">&quot;Date(HKT)&quot;</span>], V_mpas*kt2ms,<span class="hljs-string">&#x27;ro-&#x27;</span>, label=<span class="hljs-string">&quot;mpas&quot;</span>)<br>plt.grid(zorder=<span class="hljs-number">0</span>)<br>plt.xlabel(<span class="hljs-string">&quot;Date Time (HKT)&quot;</span>)<br>plt.ylabel(<span class="hljs-string">&quot;V Wind Speed [m/s]&quot;</span>)<br>plt.title(select_station_en)<br>plt.xticks(rotation=<span class="hljs-number">45</span>)<br><span class="hljs-comment"># plt.ylim([-7,10])</span><br>plt.axhline(y=<span class="hljs-number">0.0</span>, color=<span class="hljs-string">&#x27;k&#x27;</span>, linestyle=<span class="hljs-string">&#x27;-&#x27;</span>)<br>plt.legend()<br><br>plt.show()<br>plt.close() <br><br><br><span class="hljs-comment"># In[ ]:</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>NWP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>WRF</tag>
      
      <tag>MPAS</tag>
      
      <tag>HKO</tag>
      
      <tag>obs</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Jupyter-Notebook</title>
    <link href="/2023/06/24/Jupyter-Notebook/"/>
    <url>/2023/06/24/Jupyter-Notebook/</url>
    
    <content type="html"><![CDATA[<h1 id="how-to-display-full-output-in-jupyter-not-only-last-result">How to display full output in Jupyter, not only last result?</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> IPython.core.interactiveshell <span class="hljs-keyword">import</span> InteractiveShell<br>InteractiveShell.ast_node_interactivity = <span class="hljs-string">&quot;all&quot;</span><br></code></pre></td></tr></table></figure><h1 id="sample-plot">Sample plot</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs sh">import os.path<br>import xarray as xr<br>import numpy as np<br>import matplotlib.pyplot as plt<br>import pandas as pd<br><br>SMALL_SIZE = 8<br>MEDIUM_SIZE = 10<br>BIGGER_SIZE = 24<br><br>plt.rcParams[<span class="hljs-string">&quot;figure.figsize&quot;</span>] = (10,8)<br>plt.rc(<span class="hljs-string">&#x27;font&#x27;</span>, size=BIGGER_SIZE)          <span class="hljs-comment"># controls default text sizes</span><br>plt.rc(<span class="hljs-string">&#x27;axes&#x27;</span>, titlesize=BIGGER_SIZE)     <span class="hljs-comment"># fontsize of the axes title</span><br>plt.rc(<span class="hljs-string">&#x27;axes&#x27;</span>, labelsize=BIGGER_SIZE)    <span class="hljs-comment"># fontsize of the x and y labels</span><br>plt.rc(<span class="hljs-string">&#x27;xtick&#x27;</span>, labelsize=BIGGER_SIZE)    <span class="hljs-comment"># fontsize of the tick labels</span><br>plt.rc(<span class="hljs-string">&#x27;ytick&#x27;</span>, labelsize=BIGGER_SIZE)    <span class="hljs-comment"># fontsize of the tick labels</span><br>plt.rc(<span class="hljs-string">&#x27;legend&#x27;</span>, fontsize=BIGGER_SIZE)    <span class="hljs-comment"># legend fontsize</span><br>plt.rc(<span class="hljs-string">&#x27;figure&#x27;</span>, titlesize=BIGGER_SIZE)  <span class="hljs-comment"># fontsize of the figure title</span><br><br><span class="hljs-comment"># plt.rcParams[&#x27;font.sans-serif&#x27;] = [&#x27;SimHei&#x27;] </span><br><span class="hljs-comment"># plt.rcParams[&#x27;axes.unicode_minus&#x27;] = False</span><br><br>plt.rcParams.update(&#123;<span class="hljs-string">&#x27;font.family&#x27;</span>:<span class="hljs-string">&#x27;sans-serif&#x27;</span>&#125;)<br>plt.rcParams[<span class="hljs-string">&#x27;font.sans-serif&#x27;</span>] = [<span class="hljs-string">&#x27;DejaVu Sans&#x27;</span>]<br><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#</span><br><br>plt.title(<span class="hljs-string">&quot;diff T2m (UCM-on - UCM-off) of selected urban area&quot;</span>)<br>plt.ylabel(<span class="hljs-string">&quot;T2m (deg C)&quot;</span>)<br>plt.xlabel(<span class="hljs-string">&quot;Time (HKT)&quot;</span>)<br><br><span class="hljs-comment"># Add a horizontal line across the Axes.</span><br>plt.axhline(y = 0.0, color = <span class="hljs-string">&#x27;k&#x27;</span>, linestyle=<span class="hljs-string">&#x27;--&#x27;</span>, linewidth=2, label = <span class="hljs-string">&#x27;axhline&#x27;</span>)<br>plt.axvline(x = 1.0, color = <span class="hljs-string">&#x27;b&#x27;</span>, linestyle=<span class="hljs-string">&#x27;--&#x27;</span>, linewidth=2, label = <span class="hljs-string">&#x27;axvline&#x27;</span>)<br><br>plt.xticks(rotation=45)<br>plt.grid(linestyle=<span class="hljs-string">&#x27;--&#x27;</span>)<br><br><span class="hljs-comment"># Put a legend to the right of the current axis</span><br>plt.legend(loc=<span class="hljs-string">&#x27;center left&#x27;</span>, bbox_to_anchor=(1, 0.5))<br>plt.tight_layout()<br>plt.show()<br>plt.close()<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Jupyter</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Jupyter</tag>
      
      <tag>python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Removing PDF protected mode</title>
    <link href="/2023/06/24/Removing-PDF-protected-mode/"/>
    <url>/2023/06/24/Removing-PDF-protected-mode/</url>
    
    <content type="html"><![CDATA[<h1 id="section"></h1><p>Removing PDF usage restrictions,</p><blockquote><p>view <a href="https://qpdf.sourceforge.io/">qpdf</a>,</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ <span class="hljs-built_in">sudo</span> apt install qpdf<br>$ qpdf --decrypt restricted-input.pdf unrestricted-output.pdf<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>PDF</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>WRF | WPS geo data and binary tile files</title>
    <link href="/2023/06/24/WPS-geo-data-and-binary-tile-files/"/>
    <url>/2023/06/24/WPS-geo-data-and-binary-tile-files/</url>
    
    <content type="html"><![CDATA[<h1 id="binary-files-in-the-geog-folder">Binary files in the geog folder</h1><p>The file naming convention is described on slides 14 and 15 of the <a href="https://www2.mmm.ucar.edu/wrf/users/tutorial/presentation_pdfs/202101/duda_wps_advanced.pdf">Advanced Usage of the WPS</a> tutorial presentation. If you have any additional questions about the file names, please don't hesitate to follow up in this forum and I can offer further details.</p><h1 id="reading-tile-fines-and-ploting">Reading tile fines and ploting</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">import</span> matplotlib <span class="hljs-keyword">as</span> mpl<br><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt<br><span class="hljs-keyword">import</span> glob<br><span class="hljs-keyword">import</span> re<br><span class="hljs-keyword">import</span> math<br><span class="hljs-keyword">from</span> matplotlib.colors <span class="hljs-keyword">import</span> ListedColormap<br><br>SMALL_SIZE = <span class="hljs-number">8</span><br>MEDIUM_SIZE = <span class="hljs-number">10</span><br>BIGGER_SIZE = <span class="hljs-number">24</span><br><br>plt.rcParams[<span class="hljs-string">&quot;figure.figsize&quot;</span>] = (<span class="hljs-number">10</span>,<span class="hljs-number">8</span>)<br>plt.rc(<span class="hljs-string">&#x27;font&#x27;</span>, size=BIGGER_SIZE)          <span class="hljs-comment"># controls default text sizes</span><br>plt.rc(<span class="hljs-string">&#x27;axes&#x27;</span>, titlesize=BIGGER_SIZE)     <span class="hljs-comment"># fontsize of the axes title</span><br>plt.rc(<span class="hljs-string">&#x27;axes&#x27;</span>, labelsize=BIGGER_SIZE)    <span class="hljs-comment"># fontsize of the x and y labels</span><br>plt.rc(<span class="hljs-string">&#x27;xtick&#x27;</span>, labelsize=BIGGER_SIZE)    <span class="hljs-comment"># fontsize of the tick labels</span><br>plt.rc(<span class="hljs-string">&#x27;ytick&#x27;</span>, labelsize=BIGGER_SIZE)    <span class="hljs-comment"># fontsize of the tick labels</span><br>plt.rc(<span class="hljs-string">&#x27;legend&#x27;</span>, fontsize=BIGGER_SIZE)    <span class="hljs-comment"># legend fontsize</span><br>plt.rc(<span class="hljs-string">&#x27;figure&#x27;</span>, titlesize=BIGGER_SIZE)  <span class="hljs-comment"># fontsize of the figure title</span><br><br><span class="hljs-comment"># plt.rcParams[&#x27;font.sans-serif&#x27;] = [&#x27;SimHei&#x27;] </span><br><span class="hljs-comment"># plt.rcParams[&#x27;axes.unicode_minus&#x27;] = False</span><br><br>plt.rcParams.update(&#123;<span class="hljs-string">&#x27;font.family&#x27;</span>:<span class="hljs-string">&#x27;sans-serif&#x27;</span>&#125;)<br>plt.rcParams[<span class="hljs-string">&#x27;font.sans-serif&#x27;</span>] = [<span class="hljs-string">&#x27;DejaVu Sans&#x27;</span>]<br><br><span class="hljs-comment"># Reading binary tile files</span><br><span class="hljs-comment"># file_dir = &quot;/dir/*&quot;</span><br>root_dir = <span class="hljs-string">&quot;/dir/geog/&quot;</span><br>dataset_dir = <span class="hljs-string">&quot;modis_landuse_20class_30s&quot;</span><br><span class="hljs-comment">#dataset_dir = &quot;modis_landuse_20class_15s&quot;</span><br><span class="hljs-comment"># dataset_dir = &quot;greenfrac_fpar_modis&quot;</span><br><span class="hljs-comment"># dataset_dir = &quot;topo_gmted2010_2.5m&quot;</span><br><span class="hljs-comment"># dataset_dir = &quot;topo_gmted2010_30s&quot;</span><br><span class="hljs-comment"># dataset_dir = &quot;soiltype_top_30s&quot;</span><br><span class="hljs-comment"># dataset_dir = &quot;albedo_modis&quot;</span><br><span class="hljs-comment"># dataset_dir = &quot;albedo_ncep&quot;</span><br><span class="hljs-comment"># dataset_dir = &quot;greenfrac&quot;</span><br><br>file_dir = root_dir + dataset_dir + <span class="hljs-string">&quot;/*&quot;</span><br><span class="hljs-built_in">print</span>(file_dir)<br>all_files = <span class="hljs-built_in">sorted</span>(glob.glob(file_dir))<br><br>all_files<br><br>index_file = all_files[-<span class="hljs-number">1</span>]<br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(index_file, <span class="hljs-string">&quot;r&quot;</span>) <span class="hljs-keyword">as</span> f:<br>    index_info = f.read()<br><span class="hljs-built_in">print</span>(index_info)<br><br><span class="hljs-comment">### WITHOUT SPACE ###</span><br>tile_x = <span class="hljs-built_in">int</span>(re.search(<span class="hljs-string">&#x27;tile_x=(.+?)\ntile_y&#x27;</span>, index_info).group(<span class="hljs-number">1</span>))<br>tile_y = <span class="hljs-built_in">int</span>(re.search(<span class="hljs-string">&#x27;tile_y=(.+?)\ntile_z&#x27;</span>, index_info).group(<span class="hljs-number">1</span>))<br>tile_z = <span class="hljs-built_in">int</span>(re.search(<span class="hljs-string">&#x27;tile_z=(.+?)\nunits&#x27;</span>, index_info).group(<span class="hljs-number">1</span>))  <span class="hljs-comment"># for land use, soiltype</span><br><span class="hljs-comment"># tile_z = int(re.search(&#x27;tile_z=(.+?)\nscale&#x27;, index_info).group(1))  # for greenfrac</span><br><br><span class="hljs-comment">### WITH SPACE ###</span><br><span class="hljs-comment"># tile_x = int(re.search(&#x27;tile_x = (.+?)\ntile_y&#x27;, index_info).group(1))</span><br><span class="hljs-comment"># tile_y = int(re.search(&#x27;tile_y = (.+?)\ntile_z&#x27;, index_info).group(1))</span><br><span class="hljs-comment"># tile_z = int(re.search(&#x27;tile_z = (.+?)\ntile_bdr&#x27;, index_info).group(1))  # for topo_gmted2010</span><br><br>tile_bdr = <span class="hljs-number">0</span>  <span class="hljs-comment"># default = 0?</span><br><span class="hljs-comment"># tile_bdr = int(re.search(&#x27;tile_bdr=(.+?)\nunits&#x27;, index_info).group(1))  # for topo_gmted2010</span><br><br><span class="hljs-comment"># (tile_z, tile_y + 2 * tile_bdr and tile_x + 2 * tile_bdr, tile_y + 2 * tile_bdr and tile_x + 2 * tile_bdr)</span><br>dim1 = tile_z<br>dim2 = tile_y + <span class="hljs-number">2</span> * tile_bdr<br>dim3 = tile_x + <span class="hljs-number">2</span> * tile_bdr<br><br><span class="hljs-comment"># degrees per pixel</span><br><span class="hljs-comment">### WITHOUT SPACE ###</span><br>dx = <span class="hljs-built_in">float</span>(re.search(<span class="hljs-string">&#x27;dx=(.+?)\ndy&#x27;</span>, index_info).group(<span class="hljs-number">1</span>))  <span class="hljs-comment"># for land use, greenfrac, soiltype</span><br><span class="hljs-comment">### WITH SPACE ###</span><br><span class="hljs-comment"># dx = float(re.search(&#x27;dx = (.+?)\ndy&#x27;, index_info).group(1))  # for topo_gmted2010</span><br><br><span class="hljs-built_in">print</span>(dim1, dim2, dim3)<br><span class="hljs-built_in">print</span>(tile_x, tile_y, tile_z, dx)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_tile_name</span>(<span class="hljs-params">pixels_per_tile, dx, target_lat, lat_hemi, target_lon, lon_hemi, pad=<span class="hljs-number">5</span></span>):<br>    <br>    <span class="hljs-comment"># lat starts from south pole</span><br>    <span class="hljs-keyword">if</span> lat_hemi == <span class="hljs-string">&#x27;S&#x27;</span>:<br>        lat = <span class="hljs-number">90</span> - target_lat<br>    <span class="hljs-keyword">elif</span> lat_hemi == <span class="hljs-string">&#x27;N&#x27;</span>:<br>        lat = <span class="hljs-number">90</span> + target_lat<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&#x27;Invalid lat_hemi&#x27;</span>)<br>        <br>    <span class="hljs-comment"># lon starts from international date line</span><br>    <span class="hljs-keyword">if</span> lon_hemi == <span class="hljs-string">&#x27;W&#x27;</span>:<br>        lon = <span class="hljs-number">180</span> - target_lon<br>    <span class="hljs-keyword">elif</span> lon_hemi == <span class="hljs-string">&#x27;E&#x27;</span>:<br>        lon = <span class="hljs-number">180</span> + target_lon<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&#x27;Invalid lon_hemi&#x27;</span>)<br>    <br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;lat&#x27;</span>, lat, <span class="hljs-string">&#x27;lon&#x27;</span>, lon)<br>    <br>    <span class="hljs-comment"># 10 deg per tile for 15s/30s</span><br>    degs_per_tile = <span class="hljs-built_in">round</span>(tile_x * dx)<br>    <span class="hljs-built_in">print</span>(degs_per_tile)<br>    <br><span class="hljs-comment">#     tile_left = int(math.floor(lon / 10) * 10)</span><br><span class="hljs-comment">#     tile_right = int(math.ceil(lon / 10) * 10)</span><br><span class="hljs-comment">#     tile_bot = int(math.floor(lat / 10) * 10)</span><br><span class="hljs-comment">#     tile_top = int(math.ceil(lat / 10) * 10)</span><br>    <br>    tile_left = <span class="hljs-built_in">int</span>(math.floor(lon / degs_per_tile) * degs_per_tile)<br>    tile_right = <span class="hljs-built_in">int</span>(math.ceil(lon / degs_per_tile) * degs_per_tile)<br>    tile_bot = <span class="hljs-built_in">int</span>(math.floor(lat / degs_per_tile) * degs_per_tile)<br>    tile_top = <span class="hljs-built_in">int</span>(math.ceil(lat / degs_per_tile) * degs_per_tile)  <br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;tile dims&#x27;</span>, tile_left, tile_right, tile_bot, tile_top)<br>    <br><span class="hljs-comment">#     tile_left_str = str(int(math.floor(lon / 10) * pixels_per_tile + 1))</span><br><span class="hljs-comment">#     tile_right_str = str(int(math.ceil(lon / 10) * pixels_per_tile))</span><br><span class="hljs-comment">#     tile_bot_str = str(int(math.floor(lat / 10) * pixels_per_tile + 1))</span><br><span class="hljs-comment">#     tile_top_str = str(int(math.ceil(lat / 10) * pixels_per_tile))</span><br><br>    tile_left_str = <span class="hljs-built_in">str</span>(<span class="hljs-built_in">int</span>(math.floor(lon / degs_per_tile) * pixels_per_tile + <span class="hljs-number">1</span>)).zfill(pad)<br>    tile_right_str = <span class="hljs-built_in">str</span>(<span class="hljs-built_in">int</span>(math.ceil(lon / degs_per_tile) * pixels_per_tile)).zfill(pad)<br>    tile_bot_str = <span class="hljs-built_in">str</span>(<span class="hljs-built_in">int</span>(math.floor(lat / degs_per_tile) * pixels_per_tile + <span class="hljs-number">1</span>)).zfill(pad)<br>    tile_top_str = <span class="hljs-built_in">str</span>(<span class="hljs-built_in">int</span>(math.ceil(lat / degs_per_tile) * pixels_per_tile)).zfill(pad)<br><br>    target_file = tile_left_str + <span class="hljs-string">&#x27;-&#x27;</span> + tile_right_str + <span class="hljs-string">&#x27;.&#x27;</span> + tile_bot_str + <span class="hljs-string">&#x27;-&#x27;</span> + tile_top_str<br>    <br>    <span class="hljs-keyword">return</span> target_file<br><br><span class="hljs-comment"># Set lat/lon</span><br><span class="hljs-comment">### WITHOUT SPACE ###</span><br>pixels_per_tile = <span class="hljs-built_in">int</span>(re.search(<span class="hljs-string">&#x27;tile_x=(.+?)\ntile_y&#x27;</span>, index_info).group(<span class="hljs-number">1</span>))<br><span class="hljs-comment">### WITH SPACE ###</span><br><span class="hljs-comment"># pixels_per_tile = int(re.search(&#x27;tile_x = (.+?)\ntile_y&#x27;, index_info).group(1))</span><br><br>search_lat = <span class="hljs-number">22.3</span><br>search_lon = <span class="hljs-number">114.2</span><br><span class="hljs-built_in">print</span>(pixels_per_tile)<br><br><span class="hljs-comment"># west region: 27.8 N, 92.0 E</span><br><br>search_tile = get_tile_name(pixels_per_tile, dx, search_lat, <span class="hljs-string">&#x27;N&#x27;</span>, search_lon, <span class="hljs-string">&#x27;E&#x27;</span>)<br>search_file = root_dir + dataset_dir + <span class="hljs-string">&#x27;/&#x27;</span> + search_tile<br><span class="hljs-built_in">print</span>(search_file)<br><br><span class="hljs-comment"># Plot</span><br>tiley = pixels_per_tile<br>tilex = pixels_per_tile<br><br>arr = np.fromfile(search_file, dtype=<span class="hljs-string">&#x27;i1&#x27;</span>)<br>tile_output = np.reshape(arr, (tiley, tilex))<br><br>num_color = <span class="hljs-number">17</span><br><br><span class="hljs-comment"># For landuse</span><br>lst_color =     [<br><span class="hljs-string">&quot;darkgreen&quot;</span>,<br><span class="hljs-string">&quot;lime&quot;</span>,<br><span class="hljs-string">&quot;limegreen&quot;</span>,<br><span class="hljs-string">&quot;lightgreen&quot;</span>,<br><span class="hljs-string">&quot;darkseagreen&quot;</span>,<br><span class="hljs-string">&quot;mediumpurple&quot;</span>,<br><span class="hljs-string">&quot;linen&quot;</span>,<br><span class="hljs-string">&quot;tan&quot;</span>,<br><span class="hljs-string">&quot;wheat&quot;</span>,<br><span class="hljs-string">&quot;darkorange&quot;</span>,<br><span class="hljs-string">&quot;blue&quot;</span>,<br><span class="hljs-string">&quot;yellow&quot;</span>,<br><span class="hljs-string">&quot;red&quot;</span>,<br><span class="hljs-string">&quot;olive&quot;</span>,<br><span class="hljs-string">&quot;white&quot;</span>,<br><span class="hljs-string">&quot;lightsteelblue&quot;</span>,<br><span class="hljs-string">&quot;cyan&quot;</span>,<br><span class="hljs-string">&quot;whitesmoke&quot;</span>,<br><span class="hljs-string">&quot;grey&quot;</span>,<br><span class="hljs-string">&quot;dimgrey&quot;</span><br>    ]<br><br>custom_cmap = ListedColormap(lst_color[:num_color])<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Min, Max = &quot;</span>, np.<span class="hljs-built_in">min</span>(tile_output), np.<span class="hljs-built_in">max</span>(tile_output))<br><br>plt.imshow(tile_output, cmap=custom_cmap, interpolation=<span class="hljs-string">&#x27;nearest&#x27;</span>, origin=<span class="hljs-string">&#x27;lower&#x27;</span>)<br>plt.colorbar()<br>plt.title( dataset_dir )<br>plt.show()<br>plt.close()<br><br><span class="hljs-comment"># Plot multiple tile fies</span><br>search_file<br><br><span class="hljs-comment"># From small y to large y ==&gt; + </span><br><span class="hljs-comment"># From large x to small x ==&gt; -</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">tile_combine</span>(<span class="hljs-params">header, xs, xe, ys, ye, nxy, pixels_per_tile</span>):<br>    <span class="hljs-comment">#</span><br>    <span class="hljs-comment"># Make first one</span><br>    <span class="hljs-comment">#</span><br>    px = <span class="hljs-number">0</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;For x, &quot;</span>, px, pixels_per_tile, pixels_per_tile*px)<br>    tmp = header+<span class="hljs-built_in">str</span>(xs-pixels_per_tile*px)+<span class="hljs-string">&#x27;-&#x27;</span>+<span class="hljs-built_in">str</span>(xe-pixels_per_tile*px)+<span class="hljs-string">&#x27;.&#x27;</span>+<span class="hljs-built_in">str</span>(ys)+<span class="hljs-string">&#x27;-&#x27;</span>+<span class="hljs-built_in">str</span>(ye)<br>    <span class="hljs-built_in">print</span>(tmp)<br>    arr_tmp = np.fromfile(tmp, dtype=<span class="hljs-string">&#x27;i1&#x27;</span>)<br>    combine = np.reshape(arr_tmp, (tiley, tilex))<br><br>    <span class="hljs-keyword">for</span> py <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, nxy):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;   --- For y, &quot;</span>, py, pixels_per_tile, pixels_per_tile*py)<br>        tmp = header+<span class="hljs-built_in">str</span>(xs)+<span class="hljs-string">&#x27;-&#x27;</span>+<span class="hljs-built_in">str</span>(xe)+<span class="hljs-string">&#x27;.&#x27;</span>+<span class="hljs-built_in">str</span>(ys+pixels_per_tile*py)+<span class="hljs-string">&#x27;-&#x27;</span>+<span class="hljs-built_in">str</span>(ye+pixels_per_tile*py)<br>        <span class="hljs-built_in">print</span>(tmp)<br>        arr_tmp = np.fromfile(tmp, dtype=<span class="hljs-string">&#x27;i1&#x27;</span>)<br>        arr_tmp = np.reshape(arr_tmp, (tiley, tilex))<br>        combine = np.concatenate((combine, arr_tmp))   <br>    <br>    <span class="hljs-comment">#</span><br>    <span class="hljs-comment"># Build the rest</span><br>    <span class="hljs-comment">#</span><br>    <span class="hljs-keyword">for</span> px <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, nxy):<br>        <br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;For x, &quot;</span>, px, pixels_per_tile, pixels_per_tile*px)<br>        tmp = header+<span class="hljs-built_in">str</span>(xs-pixels_per_tile*px)+<span class="hljs-string">&#x27;-&#x27;</span>+ \<br>                    <span class="hljs-built_in">str</span>(xe-pixels_per_tile*px)+<span class="hljs-string">&#x27;.&#x27;</span>+ \<br>                    <span class="hljs-built_in">str</span>(ys)+<span class="hljs-string">&#x27;-&#x27;</span>+ \<br>                    <span class="hljs-built_in">str</span>(ye)<br>        <span class="hljs-built_in">print</span>(tmp)<br>        arr_tmp = np.fromfile(tmp, dtype=<span class="hljs-string">&#x27;i1&#x27;</span>)<br>        tmp_combine = np.reshape(arr_tmp, (tiley, tilex))<br><br>        <span class="hljs-keyword">for</span> py <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, nxy):<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;   ---For y, &quot;</span>, py, pixels_per_tile, pixels_per_tile*py)<br>            tmp = header+<span class="hljs-built_in">str</span>(xs-pixels_per_tile*px)+<span class="hljs-string">&#x27;-&#x27;</span>+ \<br>                        <span class="hljs-built_in">str</span>(xe-pixels_per_tile*px)+<span class="hljs-string">&#x27;.&#x27;</span>+ \<br>                        <span class="hljs-built_in">str</span>(ys+pixels_per_tile*py)+<span class="hljs-string">&#x27;-&#x27;</span>+ \<br>                        <span class="hljs-built_in">str</span>(ye+pixels_per_tile*py)<br>            <span class="hljs-built_in">print</span>(tmp)<br>            arr_tmp = np.fromfile(tmp, dtype=<span class="hljs-string">&#x27;i1&#x27;</span>)<br>            arr_tmp = np.reshape(arr_tmp, (tiley, tilex))<br>            tmp_combine = np.concatenate((tmp_combine, arr_tmp))<br>        <br>        <span class="hljs-comment">#</span><br>        combine = np.concatenate((tmp_combine, combine), axis=<span class="hljs-number">1</span>)<br>    <br>    <br>    <span class="hljs-keyword">return</span> combine<br><br>con = tile_combine(<span class="hljs-string">&quot;/dir/data/geog/modis_landuse_20class_30s/&quot;</span>, <span class="hljs-number">352801</span>, <span class="hljs-number">354000</span>, <span class="hljs-number">133201</span>, <span class="hljs-number">134400</span>, <span class="hljs-number">8</span>, pixels_per_tile)<br><br>plt.imshow(con, cmap=custom_cmap, interpolation=<span class="hljs-string">&#x27;nearest&#x27;</span>, origin=<span class="hljs-string">&#x27;lower&#x27;</span>)<br>plt.colorbar()<br>plt.title( dataset_dir )<br>plt.show()<br>plt.close()<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>WRF</category>
      
    </categories>
    
    
    <tags>
      
      <tag>WRF</tag>
      
      <tag>WPS</tag>
      
      <tag>MPAS</tag>
      
      <tag>tile files</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>WRF | WRF-extraction-station</title>
    <link href="/2023/06/24/WRF-extraction-station/"/>
    <url>/2023/06/24/WRF-extraction-station/</url>
    
    <content type="html"><![CDATA[<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">import</span> xarray <span class="hljs-keyword">as</span> xr<br><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<br><span class="hljs-keyword">from</span> netCDF4 <span class="hljs-keyword">import</span> Dataset<br><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt<br><span class="hljs-keyword">from</span> matplotlib.cm <span class="hljs-keyword">import</span> get_cmap<br><br><span class="hljs-keyword">from</span> wrf <span class="hljs-keyword">import</span> (to_np, getvar, smooth2d, get_cartopy, cartopy_xlim,<br>                 cartopy_ylim, latlon_coords, extract_vars, xy_to_ll, ll_to_xy)<br><br><span class="hljs-comment"># How to display full output in Jupyter, not only last result?</span><br><span class="hljs-keyword">from</span> IPython.core.interactiveshell <span class="hljs-keyword">import</span> InteractiveShell<br>InteractiveShell.ast_node_interactivity = <span class="hljs-string">&quot;all&quot;</span><br><br>SMALL_SIZE = <span class="hljs-number">8</span><br>MEDIUM_SIZE = <span class="hljs-number">10</span><br>BIGGER_SIZE = <span class="hljs-number">24</span><br><br>plt.rcParams[<span class="hljs-string">&quot;figure.figsize&quot;</span>] = (<span class="hljs-number">10</span>,<span class="hljs-number">8</span>)<br>plt.rc(<span class="hljs-string">&#x27;font&#x27;</span>, size=BIGGER_SIZE)          <span class="hljs-comment"># controls default text sizes</span><br>plt.rc(<span class="hljs-string">&#x27;axes&#x27;</span>, titlesize=BIGGER_SIZE)     <span class="hljs-comment"># fontsize of the axes title</span><br>plt.rc(<span class="hljs-string">&#x27;axes&#x27;</span>, labelsize=BIGGER_SIZE)    <span class="hljs-comment"># fontsize of the x and y labels</span><br>plt.rc(<span class="hljs-string">&#x27;xtick&#x27;</span>, labelsize=BIGGER_SIZE)    <span class="hljs-comment"># fontsize of the tick labels</span><br>plt.rc(<span class="hljs-string">&#x27;ytick&#x27;</span>, labelsize=BIGGER_SIZE)    <span class="hljs-comment"># fontsize of the tick labels</span><br>plt.rc(<span class="hljs-string">&#x27;legend&#x27;</span>, fontsize=BIGGER_SIZE)    <span class="hljs-comment"># legend fontsize</span><br>plt.rc(<span class="hljs-string">&#x27;figure&#x27;</span>, titlesize=BIGGER_SIZE)  <span class="hljs-comment"># fontsize of the figure title</span><br><br><span class="hljs-comment"># plt.rcParams[&#x27;font.sans-serif&#x27;] = [&#x27;SimHei&#x27;] </span><br><span class="hljs-comment"># plt.rcParams[&#x27;axes.unicode_minus&#x27;] = False</span><br><br>plt.rcParams.update(&#123;<span class="hljs-string">&#x27;font.family&#x27;</span>:<span class="hljs-string">&#x27;sans-serif&#x27;</span>&#125;)<br>plt.rcParams[<span class="hljs-string">&#x27;font.sans-serif&#x27;</span>] = [<span class="hljs-string">&#x27;DejaVu Sans&#x27;</span>]<br><br>rad2deg = <span class="hljs-number">57.2957795</span><br><br><span class="hljs-comment"># # single xy to latlon</span><br><span class="hljs-comment"># lat_lon = xy_to_ll(ncfile_domain_1, 100, 100)</span><br><span class="hljs-comment"># print(lat_lon.values)</span><br><br><span class="hljs-comment"># # single latlon to xy</span><br><span class="hljs-comment"># x_y = ll_to_xy(ncfile_domain_1, 34.62, 105.46)</span><br><span class="hljs-comment"># print(x_y.values)</span><br><br><span class="hljs-comment"># # more points</span><br><span class="hljs-comment"># lat_lon = xy_to_ll(ncfile_domain_1, [100,105], [100,205])</span><br><span class="hljs-comment"># print(lat_lon.values)</span><br><br><span class="hljs-comment"># # more points</span><br><span class="hljs-comment"># x_y = ll_to_xy(ncfile_domain_1, [34.62, 35], [105.46, 100])</span><br><span class="hljs-comment"># print(x_y.values)</span><br><br><span class="hljs-comment"># get met stations</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_station_info</span>(<span class="hljs-params">statfile</span>):<br>    stats = pd.read_csv(statfile, sep=<span class="hljs-string">&#x27;,&#x27;</span>)<br>    stats = stats[[<span class="hljs-string">&#x27;WMO_id&#x27;</span>,<span class="hljs-string">&#x27;lat&#x27;</span>,<span class="hljs-string">&#x27;lon&#x27;</span>]]<br>    stats = stats.dropna(axis=<span class="hljs-number">0</span>)<br>    stats = stats.astype(&#123;<span class="hljs-string">&#x27;WMO_id&#x27;</span>:<span class="hljs-built_in">int</span>&#125;)<br>    <span class="hljs-keyword">return</span> (stats)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">read_model_data</span>(<span class="hljs-params">domloc, wrfdir, dom, statf, sdate, edate, utc</span>):<br>    <span class="hljs-keyword">import</span> glob<br>    <span class="hljs-keyword">from</span> netCDF4 <span class="hljs-keyword">import</span> Dataset<br>    wrfoutfiles = <span class="hljs-built_in">sorted</span>(glob.glob(<span class="hljs-string">&#x27;&#123;0&#125;/wrfout_&#123;1&#125;_*&#x27;</span>.<span class="hljs-built_in">format</span>(wrfdir,dom)))<br>    wrflist = [ Dataset(f) <span class="hljs-keyword">for</span> f <span class="hljs-keyword">in</span> wrfoutfiles ]<br>    <span class="hljs-keyword">from</span> wrf <span class="hljs-keyword">import</span> getvar, ALL_TIMES, interplevel, extract_times, to_np, ll_to_xy, extract_times<br>    wrftimes = extract_times(wrflist, timeidx=ALL_TIMES, method=<span class="hljs-string">&#x27;cat&#x27;</span>)<br><br>    <span class="hljs-comment"># get start and end index</span><br>    times = [ <span class="hljs-built_in">str</span>(s).split(<span class="hljs-string">&#x27;:&#x27;</span>)[<span class="hljs-number">0</span>] <span class="hljs-keyword">for</span> s <span class="hljs-keyword">in</span> wrftimes ]<br>    <span class="hljs-built_in">print</span>(times)<br>    sdate = (datetime.strptime(sdate,<span class="hljs-string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>)+timedelta(hours=-utc)).strftime(<span class="hljs-string">&#x27;%Y-%m-%dT%H&#x27;</span>) <br>    edate = (datetime.strptime(edate,<span class="hljs-string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>)+timedelta(hours=-utc)).strftime(<span class="hljs-string">&#x27;%Y-%m-%dT%H&#x27;</span>)<br>    st = times.index(sdate)<br>    et = times.index(edate) + <span class="hljs-number">1</span><br>    <span class="hljs-built_in">print</span> (<span class="hljs-string">&#x27;&#123;0&#125;: &#123;1&#125; - &#123;2&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(domloc, st, et))<br><br>    stats = get_station_info(statf)<br>    stats[<span class="hljs-string">&#x27;ij&#x27;</span>] = stats.apply(<span class="hljs-keyword">lambda</span> row: np.array(ll_to_xy(wrflist[<span class="hljs-number">0</span>], row.lat, row.lon).values), axis=<span class="hljs-number">1</span>)<br>    stats[<span class="hljs-string">&#x27;i&#x27;</span>] = stats.apply(<span class="hljs-keyword">lambda</span> row: row.ij[<span class="hljs-number">0</span>], axis=<span class="hljs-number">1</span>)<br>    stats[<span class="hljs-string">&#x27;j&#x27;</span>] = stats.apply(<span class="hljs-keyword">lambda</span> row: row.ij[<span class="hljs-number">1</span>], axis=<span class="hljs-number">1</span>)<br><br>    varlist = [<span class="hljs-string">&quot;T2&quot;</span>,<span class="hljs-string">&quot;Q2&quot;</span>, <span class="hljs-string">&quot;U10&quot;</span>,<span class="hljs-string">&quot;V10&quot;</span>]<br>    df = pd.DataFrame()<br>    <span class="hljs-keyword">for</span> varname <span class="hljs-keyword">in</span> varlist:<br>        <span class="hljs-keyword">for</span> tt <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(st,et):<br>            stats[<span class="hljs-string">&#x27;varname&#x27;</span>] = varname<br>            var = getvar(wrflist, varname, timeidx=tt, method=<span class="hljs-string">&quot;cat&quot;</span>)<br>            <span class="hljs-keyword">if</span> varname == <span class="hljs-string">&#x27;T2&#x27;</span>:<br>                var = var - <span class="hljs-number">273.15</span><br>            stats[<span class="hljs-string">&#x27;datetime&#x27;</span>] = var.coords[<span class="hljs-string">&#x27;Time&#x27;</span>].values<br>            stats[<span class="hljs-string">&#x27;value&#x27;</span>] = stats.apply(<span class="hljs-keyword">lambda</span> row: to_np(var[row.i, row.j]), axis=<span class="hljs-number">1</span>)<br>            df =df.append(stats[[<span class="hljs-string">&#x27;datetime&#x27;</span>,<span class="hljs-string">&#x27;WMO_id&#x27;</span>,<span class="hljs-string">&#x27;varname&#x27;</span>,<span class="hljs-string">&#x27;value&#x27;</span>]])<br>    df[<span class="hljs-string">&#x27;datetime&#x27;</span>] = df.apply(<span class="hljs-keyword">lambda</span> row: (datetime.strptime(<span class="hljs-built_in">str</span>(row.datetime),<span class="hljs-string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>)+timedelta(hours=utc)).strftime(<span class="hljs-string">&quot;%Y-%m-%d %H:%M:%S&quot;</span>), axis=<span class="hljs-number">1</span>)<br>    df[<span class="hljs-string">&#x27;model&#x27;</span>] = domloc<br>    <span class="hljs-comment">#df[&#x27;WSPD10&#x27;] = df.apply(lambda row: math.sqrt(row.U10 ** 2 + row.V10 ** 2))</span><br>    <span class="hljs-comment">#df[&#x27;WDIR10&#x27;] = df.apply(lambda row: 180+(360/(2/3.1415926)*math.atan2(row.U10,row.V10)))</span><br>    <span class="hljs-comment">#df = df[]</span><br>    <span class="hljs-keyword">return</span> (df)<br><br>station = get_station_info(<span class="hljs-string">&quot;./station.txt&quot;</span>)<br>station<br><br><span class="hljs-comment"># WMO_idlatlon</span><br><span class="hljs-comment"># 0122.312114.173</span><br><span class="hljs-comment"># 1233.000105.000</span><br><br>domloc = <span class="hljs-string">&quot;ucm&quot;</span><br>wrfdir = <span class="hljs-string">&quot;/xxx/wrf/&quot;</span><br>dom = <span class="hljs-string">&quot;d02&quot;</span><br>statf = <span class="hljs-string">&quot;./station.txt&quot;</span><br>sdate = <span class="hljs-string">&quot;2023-03-31 21:00:00&quot;</span><br>edate = <span class="hljs-string">&quot;2023-04-01 03:00:00&quot;</span><br>utc = <span class="hljs-number">0</span> <span class="hljs-comment"># 8</span><br><br>df = read_model_data(domloc, wrfdir, dom, statf, sdate, edate, utc)<br>df<br><br>select_var = df[(df[<span class="hljs-string">&quot;varname&quot;</span>] == <span class="hljs-string">&quot;T2&quot;</span>) &amp; (df[<span class="hljs-string">&quot;WMO_id&quot;</span>] == <span class="hljs-number">1</span>)]<br>select_var<br><br>plt.plot(pd.to_datetime(select_var.datetime), select_var.value, <span class="hljs-string">&#x27;ro--&#x27;</span>)<br>plt.title(<span class="hljs-string">&quot;T2m&quot;</span>)<br>plt.ylabel(<span class="hljs-string">&quot;T2m (deg C)&quot;</span>)<br>plt.xlabel(<span class="hljs-string">&quot;Time (UTC)&quot;</span>)<br>plt.legend()<br><span class="hljs-comment"># plt.axhline(y=0.0, color=&#x27;k&#x27;, linestyle=&#x27;-&#x27;)</span><br>plt.xticks(rotation=<span class="hljs-number">45</span>)<br>plt.grid()<br>plt.show()<br>plt.close()<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>WRF</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NWP</tag>
      
      <tag>Jupyter</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>netCDF operator (nco, cdo)</title>
    <link href="/2023/06/24/cdo/"/>
    <url>/2023/06/24/cdo/</url>
    
    <content type="html"><![CDATA[<h2 id="ncrename---netcdf-renamer">ncrename - netCDF Renamer</h2><p>Options &gt; -a old_name, new_name Attribute renaming. The old and new names of the attribute are specified by the associated old_name and new_name values. Global attributes are treated no differently than variable attributes. This option may be specified more than once. You cannot change the attribute name for one particular variable (unless it is uniquely named); all occurrences of the attribute of a given name will be renamed. This is considered an oversight and will be addressed in a future version of NCO. -d old_name, new_name Dimension renaming. The old and new names of the dimension are specified by the associated old_name and new_name values. This option may be specified more than once. -v old_name, new_name Variable renaming. The old and new names of the variable are specified by the associated old_name and new_name values. This option may be specified more than once. -i &gt;Interactive. ncrename will prompt for confirmation before overwriting an existing file.</p><p>Examples Rename the variable p to pressure and t to temperature in netCDF in.nc. In this case p must exist in the input file (or ncrename will abort), but the presence of t is optional: <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ ncrename -v p,pressure -v .t,temperature in.nc<br></code></pre></td></tr></table></figure> ncrename does not automatically attach dimensions to variables of the same name. If you want to rename a coordinate variable so that it remains a coordinate variable, you must separately rename both the dimension and the variable: <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ ncrename -d lon,longitude -v lon,longitude in.nc<br></code></pre></td></tr></table></figure></p><h2 id="ncrcat---netcdf-record-concatenator">ncrcat - netCDF Record Concatenator</h2><p>ncrcat concatenates record variables across an arbitrary number of input files. The final record dimension is by default the sum of the lengths of the record dimensions in the input files. <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ ncrcat -O <span class="hljs-string">&quot;diag*.nc&quot;</span> <span class="hljs-variable">$&#123;path_out&#125;</span><br>$ ncrcat 85.nc 86.nc 87.nc 88.nc 89.nc 8589.nc<br>$ ncrcat 8[56789].nc 8589.nc<br></code></pre></td></tr></table></figure> <a href="https://disc.gsfc.nasa.gov/information/howto?title=How%20to%20Concatenate%20the%20Time%20Dimension%20of%20netCDF%20Files%20with%20NCO">How to Concatenate the Time Dimension of netCDF Files with NCO</a></p><h2 id="appending-variables">Appending variables</h2><p>This puts the contents yyy of bbb.nc into aaa.nc. <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ ncks -A -v yyy bbb.nc aaa.nc<br></code></pre></td></tr></table></figure></p><h2 id="ncdiff---netcdf-differencer">ncdiff - netCDF Differencer</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ ncdiff 86_0112.nc 85_0112.nc diff.nc<br></code></pre></td></tr></table></figure><h2 id="cdo-sub">cdo sub</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ cdo sub v1.nc v2.nc diff.nc<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>NWP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>WRF</tag>
      
      <tag>MPAS</tag>
      
      <tag>netcdf</tag>
      
      <tag>nco</tag>
      
      <tag>cdo</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Approximate Metric Equivalents for Degrees, Minutes, and Seconds</title>
    <link href="/2023/06/24/degree-to-meter/"/>
    <url>/2023/06/24/degree-to-meter/</url>
    
    <content type="html"><![CDATA[<h1 id="approximate-metric-equivalents-for-degrees-minutes-and-seconds">Approximate Metric Equivalents for Degrees, Minutes, and Seconds</h1><p>At the equator for longitude and for latitude anywhere, the following approximations are valid:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs sh">1° = 111 km  (or 60 nautical miles)<br>0.1° = 11.1 km<br>0.01° = 1.11 km (2 decimals, km accuracy)<br>0.001° =111 m<br>0.0001° = 11.1 m<br>0.00001° = 1.11 m<br>0.000001° = 0.11 m (7 decimals, cm accuracy)<br><br>1<span class="hljs-string">&#x27; = 1.85 km  (or 1 nautical mile)</span><br><span class="hljs-string">0.1&#x27;</span> = 185 m<br>0.01<span class="hljs-string">&#x27; = 18.5 m</span><br><span class="hljs-string">0.001&#x27;</span> = 1.85 m<br><br>30<span class="hljs-string">&quot; = 900 m</span><br><span class="hljs-string">15&quot;</span> = 450 m<br>3<span class="hljs-string">&quot; = 90 m</span><br><span class="hljs-string">1&quot;</span> = 30 m<br>1/3<span class="hljs-string">&quot; = 10 m</span><br><span class="hljs-string">0.1&quot;</span> = 3 m<br>1/9<span class="hljs-string">&quot; = 3 m</span><br><span class="hljs-string">1/27&quot;</span> = 1 m<br></code></pre></td></tr></table></figure><p>If you report a position to the nearest 0.01° (two decimal places for latitude and longitude), you will only be accurate to around 1 km. While this is adequate for rough locations on a global scale, for detailed work it will be inadequate.</p><h1 id="latitude-and-longitude">Latitude and longitude</h1><p>Lines of latitude and longitude form the grid system used on globes, maps and charts. Latitude is a measure of how far north or south somewhere is from the Equator; longitude is a measure of how far east or west it is from the Prime Meridian. Whilst lines (or parallels) of latitude all run parallel to the Equator, lines (or meridians) of longitude all converge at the Earth’s North and South Poles. The north–south line passing through any particular point on the Earth’s surface is known as the “local meridian”.</p><p>Although the Equator is the obvious zero point from which to measure latitude, there is no equivalent point from which to measure longitude. In 1884, an international conference decided that the Greenwich Meridian, as defined by the Airy Transit Circle at the Royal Observatory, Greenwich, should be adopted as the Prime or Zero Meridian for the World.</p><p>Latitude and longitude are both measured in degrees. <strong>Each degree (°) is subdivided into 60 minutes (') and each minute into 60 seconds (")</strong>. Each degree of latitude corresponds to a distance on the Earth‘s surface of about 111 km. Each degree of longitude however, corresponds to a distance that varies with latitude. The distance is about 111 km at the Equator, reducing to 0 km at the Poles.</p><h1 id="the-prime-meridian">The prime meridian</h1><p>The prime meridian forms the reference point by which longitudes are defined and expressed. This line makes it possible to measure the position of a location on Earth based on the longitude.</p><p>On Earth, the prime meridian -- which, like all other latitude and longitude lines, is also imaginary -- passes through Greenwich, England. For this reason, it also called the Greenwich meridian. Thus, the prime meridian is the imaginary north-south line that passes through the north and south poles, as well as Greenwich. It has a longitude of 0 degrees. The antemeridian, which is the opposite of the prime meridian, is located on the other side of the Earth and has a longitude of 180 degrees.</p><p>Longitudes and the prime meridian are both used to define time zones. <strong>Greenwich Mean Time (GMT)</strong>, also known as Coordinated Universal Time, is the standard time by which all other time zones are expressed -- for example:</p><p>GMT + 0 = Time in Greenwich, U.K. GMT + 8 = China Standard Time GMT - 8 = Pacific Standard Time</p><h1 id="coordinated-universal-time-or-utc">Coordinated Universal Time or UTC</h1><p>Coordinated Universal Time or UTC is the primary time standard by which the world regulates clocks and time. It is within about one second of mean solar time (such as UT1) at 0° longitude (at the IERS Reference Meridian as the currently used prime meridian) and is not adjusted for daylight saving time. It is effectively a successor to Greenwich Mean Time (GMT).</p><p>世界協調時間是世界上調節時鐘和時間的主要時間標準，它與0度經線的平太陽時相差不超過1秒，並不遵守夏令時。世界協調時間是最接近格林威治標準時間（GMT）的幾個替代時間系統之一。對於大多數用途來說，UTC時間被認為能與GMT時間互換，但GMT時間已不再被科學界所確定。</p>]]></content>
    
    
    <categories>
      
      <category>NWP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>WRF</tag>
      
      <tag>MPAS</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>NetCDF and its Conversion</title>
    <link href="/2023/06/24/netcdf/"/>
    <url>/2023/06/24/netcdf/</url>
    
    <content type="html"><![CDATA[<p><a href="https://www.unidata.ucar.edu/software/netcdf/">NetCDF</a> (Network Common Data Form) is a set of software libraries and machine-independent data formats that support the creation, access, and sharing of array-oriented scientific data. It is also a community standard for sharing scientific data. The Unidata Program Center supports and maintains netCDF programming interfaces for C, C++, Java, and Fortran. Programming interfaces are also available for Python, IDL, MATLAB, R, Ruby, and Perl.</p><p>網絡通用數據格式（英語：Network Common Data Form，NetCDF）是一種自描述、與機器無關、基於陣列的科學數據格式，同時也是支援建立、存取和共用這一數據格式的函數庫。該專案首頁位於美國大氣科學研究大學聯盟（UCAR）的Unidata規劃網站。它也是netCDF軟件、標準開發、更新等的主要來源。NetCDF格式是一種開放標準。NetCDF的經典格式和64位元偏移量格式是開放地理空間協會採用的國際標準。該專案開始於1989年，UCAR目前對其積極支援，在新發行版中改進效能、增加功能並修正缺陷，目前版本系列是netCDF-4，在編譯時也可以選擇只建造netCDF-3庫。</p><h2 id="file-formats-and-conversion">File Formats and Conversion</h2><p><a href="https://nco.sourceforge.net/nco.html#fl_fmt">link</a> &gt; Availability: ncap2, nces, ncecat, ncflint, ncks, ncpdq, ncra, ncrcat, ncwa &gt; Short options: ‘-3’, ‘-4’, ‘-5’, ‘-6’, ‘-7’ &gt; Long options: ‘--3’, ‘--4’, ‘--5’, ‘--6’, ‘--64bit_offset’, ‘--7’, ‘--fl_fmt’, ‘--netcdf4’</p><p>All NCO operators support (read and write) all three (or four, depending on how one counts) file formats supported by netCDF4. The default output file format for all operators is the input file format. The operators listed under “Availability” above allow the user to specify the output file format independent of the input file format. These operators allow the user to convert between the various file formats. (The operators ncatted and ncrename do not support these switches so they always write the output netCDF file in the same format as the input netCDF file.)</p><h3 id="file-formats">File Formats</h3><p>netCDF supports five types of files: <strong>CLASSIC, 64BIT_OFFSET, 64BIT_DATA, NETCDF4, and NETCDF4_CLASSIC</strong>. The CLASSIC (aka CDF1) format is the traditional 32-bit offset written by netCDF2 and netCDF3. As of 2005, nearly all netCDF datasets were in CLASSIC format. The 64BIT_OFFSET (originally called plain old 64BIT) (aka CDF2) format was added in Fall, 2004. As of 2010, many netCDF datasets were in 64BIT_OFFSET format. As of 2013, an increasing number of netCDF datasets were in NETCDF4_CLASSIC format. The 64BIT_DATA (aka CDF5 or PNETCDF) format was added to netCDF in January, 2016 and immediately supported by NCO. Support for Zarr and NCZarr backend storage formats was added to netCDF in 2021 and supported by NCO in 2022.</p><p>The NETCDF4 format uses HDF5 as the file storage layer. The files are (usually) created, accessed, and manipulated using the traditional netCDF3 API (with numerous extensions). The NETCDF4_CLASSIC format refers to netCDF4 files created with the NC_CLASSIC_MODEL mask. Such files use HDF5 as the back-end storage format (unlike netCDF3), though they incorporate only netCDF3 features. Hence NETCDF4_CLASSIC files are entirely readable by applications that use only the netCDF3 API (though the applications must be linked with the netCDF4 library). NCO must be built with netCDF4 to write files in the new NETCDF4 and NETCDF4_CLASSIC formats, and to read files in these formats. Datasets in the default CLASSIC or the newer 64BIT_OFFSET formats have maximum backwards-compatibility with older applications. NCO has deep support for NETCDF4 formats. If backwards compatibility is important, and your datasets are too large for netCDF3, use NETCDF4_CLASSIC instead of CLASSIC format files. NCO support for the NETCDF4 format is complete and many high-performance disk/RAM efficient workflows utilize this format.</p><p>As mentioned above, all operators write use the input file format for output files unless told otherwise. Toggling the short option ‘-6’ or the long option ‘--6’ or ‘--64bit_offset’ (or their key-value equivalent ‘--fl_fmt=64bit_offset’) produces the netCDF3 64-bit offset format named 64BIT_OFFSET. NCO must be built with netCDF 3.6 or higher to produce a 64BIT_OFFSET file. As of NCO version 4.6.9 (September, 2017), toggling the short option ‘-5’ or the long options ‘--5’, ‘--64bit_data’, ‘--cdf5’, or ‘--pnetcdf’ (or their key-value equivalent ‘--fl_fmt=64bit_data’) produces the netCDF3 64-bit data format named 64BIT_DATA. This format is widely used by MPI-enabled modeling codes because of its long association with PnetCDF. NCO must be built with netCDF 4.4 or higher to produce a 64BIT_DATA file.</p><p>Using the ‘-4’ switch (or its long option equivalents ‘--4’ or ‘--netcdf4’), or setting its key-value equivalent ‘--fl_fmt=netcdf4’ produces a NETCDF4 file (i.e., with all supported HDF5 features). Using the ‘-7’ switch (or its long option equivalent ‘--7’ 30, or setting its key-value equivalent ‘--fl_fmt=netcdf4_classic’ produces a NETCDF4_CLASSIC file (i.e., with all supported HDF5 features like compression and chunking but without groups or new atomic types). Operators given the ‘-3’ (or ‘--3’) switch without arguments will (attempt to) produce netCDF3 CLASSIC output, even from netCDF4 input files.</p><p>Note that NETCDF4 and NETCDF4_CLASSIC are the same binary format. The latter simply causes a writing application to fail if it attempts to write a NETCDF4 file that cannot be completely read by the netCDF3 library. Conversely, NETCDF4_CLASSIC indicates to a reading application that all of the file contents are readable with the netCDF3 library. NCO has supported reading/writing basic NETCDF4 and NETCDF4_CLASSIC files since October, 2005.</p><h3 id="determining-file-format">Determining File Format</h3><p>First, examine the first line of global metadata output by <strong>ncks -M</strong>: <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ ncks -M foo_3.nc<br>Summary of foo_3.nc: filetype = NC_FORMAT_CLASSIC, 0 <span class="hljs-built_in">groups</span> ...<br></code></pre></td></tr></table></figure> ncks will also print the extended or underlying format of the input file <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ ncks -D 2 -M foo_4.nc<br></code></pre></td></tr></table></figure> Second, query the file with ‘ncdump -k’: <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ ncdump -k foo_3.nc<br>classic/netCDF-4/cdf5/...<br></code></pre></td></tr></table></figure></p><h3 id="file-conversion">File Conversion</h3><p>Let us demonstrate converting a file from any netCDF-supported input format into any netCDF output format (subject to limits of the output format). Here the <strong>input file in.nc</strong> may be in any of these formats: netCDF3 (classic, 64bit_offset, 64bit_data), netCDF4 (classic and extended), HDF4, HDF5, HDF-EOS (version 2 or 5), and DAP. The switch determines the output format written in the comment:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs sh">ncks --fl_fmt=classic in.nc foo_3.nc <span class="hljs-comment"># netCDF3 classic</span><br>ncks --fl_fmt=64bit_offset in.nc foo_6.nc <span class="hljs-comment"># netCDF3 64bit-offset</span><br>ncks --fl_fmt=64bit_data in.nc foo_5.nc <span class="hljs-comment"># netCDF3 64bit-data</span><br>ncks --fl_fmt=cdf5 in.nc foo_5.nc <span class="hljs-comment"># netCDF3 64bit-data</span><br>ncks --fl_fmt=netcdf4_classic in.nc foo_7.nc <span class="hljs-comment"># netCDF4 classic</span><br>ncks --fl_fmt=netcdf4 in.nc foo_4.nc <span class="hljs-comment"># netCDF4 </span><br>ncks -3 in.nc foo_3.nc <span class="hljs-comment"># netCDF3 classic</span><br>ncks --3 in.nc foo_3.nc <span class="hljs-comment"># netCDF3 classic</span><br>ncks -6 in.nc foo_6.nc <span class="hljs-comment"># netCDF3 64bit-offset</span><br>ncks --64 in.nc foo_6.nc <span class="hljs-comment"># netCDF3 64bit-offset</span><br>ncks -5 in.nc foo_5.nc <span class="hljs-comment"># netCDF3 64bit-data</span><br>ncks --5 in.nc foo_5.nc <span class="hljs-comment"># netCDF3 64bit-data</span><br>ncks -4 in.nc foo_4.nc <span class="hljs-comment"># netCDF4 </span><br>ncks --4 in.nc foo_4.nc <span class="hljs-comment"># netCDF4 </span><br>ncks -7 in.nc foo_7.nc <span class="hljs-comment"># netCDF4 classic</span><br>ncks --7 in.nc foo_7.nc <span class="hljs-comment"># netCDF4 classic</span><br></code></pre></td></tr></table></figure><p>Of course since most operators support these switches, the “conversions” can be done at the output stage of arithmetic or metadata processing rather than requiring a separate step. Producing (netCDF3) CLASSIC or 64BIT_OFFSET or 64BIT_DATA files from NETCDF4_CLASSIC files always works.</p>]]></content>
    
    
    <categories>
      
      <category>NWP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>WRF</tag>
      
      <tag>MPAS</tag>
      
      <tag>netcdf</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>rsync - Transferring and synchronizing files</title>
    <link href="/2023/06/24/rsync-Transferring-and-synchronizing-files/"/>
    <url>/2023/06/24/rsync-Transferring-and-synchronizing-files/</url>
    
    <content type="html"><![CDATA[<p>rsync是Unix下的一款套用軟件，它能同步更新兩處電腦的檔案與目錄，並適當利用差分編碼以減少數據傳輸量。rsync中的一項同類軟件不常見的重要特性是每個目標的鏡像只需傳送一次。rsync可以拷貝／顯示目錄內容，以及拷貝檔案，並可選壓縮以及遞歸拷貝。</p><p>在常駐模式（daemon mode）下，rsync預設監聽TCP埠873，以原生rsync傳輸協定或者透過遠端shell如RSH或者SSH提供檔案。SSH模式下，rsync用戶端執行程式必須同時在本機和遠端機器上安裝。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sh">rsync 的基本語法結構如下：<br><br>rsync 參數 來源檔案 目的檔案<br>以下是最常見的幾個參數：<br><br>-v：verbose 模式，輸出比較詳細的訊息。<br>-r：遞迴（recursive）備份所有子目錄下的目錄與檔案。<br>-a：封裝備份模式，相當於 -rlptgoD，遞迴備份所有子目錄下的目錄與檔案，保留連結檔、檔案的擁有者、群組、權限以及時間戳記。<br>-z：啟用壓縮。<br>-h：將數字以比較容易閱讀的格式輸出。<br></code></pre></td></tr></table></figure><ol type="1"><li>如果要讓 rsync 在傳輸檔案時可以即時顯示進度，可以加上 --progress 參數</li><li>-P参数是--progress和--partial这两个参数的结合</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/bash</span><br><span class="hljs-comment">#Here&#x27;s how this script works:</span><br><br><span class="hljs-comment"># Replace the REMOTE_HOST, REMOTE_PATH, and LOCAL_PATH variables with your actual remote host details, remote file path, and local directory path, respectively.</span><br><span class="hljs-comment"># The LOCK_FILE variable specifies the path to the lock file, which will be used to prevent multiple instances of the script from running simultaneously.</span><br><span class="hljs-comment"># The is_locked function checks if the lock file exists.</span><br><span class="hljs-comment"># The create_lock function creates the lock file.</span><br><span class="hljs-comment"># The remove_lock function removes the lock file.</span><br><span class="hljs-comment"># The perform_rsync function performs the actual rsync -z command to copy the files from the remote machine to the local machine.</span><br><span class="hljs-comment"># The script checks if the lock file exists. If it does, it means the previous rsync is still running, so it exits without starting a new rsync.</span><br><span class="hljs-comment"># If the lock file doesn&#x27;t exist, the script creates the lock file, performs the rsync, and then removes the lock file.</span><br><br>INIT_DIR=<span class="hljs-variable">$1</span><br><br>REMOTE_HOST=<span class="hljs-string">&quot;user@ip&quot;</span><br>PORT=<span class="hljs-string">&quot;1234567&quot;</span><br>REMOTE_PATH=<span class="hljs-string">&quot;/home/user/<span class="hljs-variable">$&#123;INIT_DIR&#125;</span>/file.*&quot;</span> <br>LOCAL_PATH=<span class="hljs-string">&quot;/home/user/<span class="hljs-variable">$&#123;INIT_DIR&#125;</span>/&quot;</span> <br>LOCK_FILE=<span class="hljs-string">&quot;<span class="hljs-variable">$&#123;LOCAL_PATH&#125;</span>/rsync.lock&quot;</span> <br>LOG_FILE=<span class="hljs-string">&quot;<span class="hljs-variable">$&#123;LOCAL_PATH&#125;</span>/rsync.log&quot;</span><br><span class="hljs-comment"># Function to check if the lock file exists</span><br><span class="hljs-function"><span class="hljs-title">is_locked</span></span>() &#123;<br>    [ -f <span class="hljs-string">&quot;<span class="hljs-variable">$LOCK_FILE</span>&quot;</span> ]<br>&#125;<br><br><span class="hljs-comment"># Create the lock file</span><br><span class="hljs-function"><span class="hljs-title">create_lock</span></span>() &#123;<br>    <span class="hljs-built_in">touch</span> <span class="hljs-string">&quot;<span class="hljs-variable">$LOCK_FILE</span>&quot;</span><br>&#125;<br><br><span class="hljs-comment"># Remove the lock file</span><br><span class="hljs-function"><span class="hljs-title">remove_lock</span></span>() &#123;<br>    <span class="hljs-built_in">rm</span> <span class="hljs-string">&quot;<span class="hljs-variable">$LOCK_FILE</span>&quot;</span><br>&#125;<br><br><span class="hljs-comment"># Function to perform rsync</span><br><span class="hljs-function"><span class="hljs-title">perform_rsync</span></span>() &#123;<br>    rsync -azvhP -e <span class="hljs-string">&#x27;ssh -p &#x27;</span> <span class="hljs-string">&quot;<span class="hljs-variable">$PORT</span>&quot;</span> <span class="hljs-string">&quot;<span class="hljs-variable">$REMOTE_HOST</span>:<span class="hljs-variable">$REMOTE_PATH</span>&quot;</span> <span class="hljs-string">&quot;<span class="hljs-variable">$LOCAL_PATH</span>&quot;</span> --log-file=<span class="hljs-variable">$&#123;LOG_FILE&#125;</span><br>&#125;<br><br><span class="hljs-comment"># Check if the lock file exists</span><br><span class="hljs-keyword">if</span> is_locked; <span class="hljs-keyword">then</span><br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Previous rsync is still running. Exiting.&quot;</span><br>    <span class="hljs-built_in">exit</span> 1<br><span class="hljs-keyword">fi</span><br><br><span class="hljs-comment"># Create the lock file</span><br>create_lock<br><br><span class="hljs-comment"># Perform rsync</span><br>perform_rsync<br><br><span class="hljs-comment"># Remove the lock file</span><br>remove_lock<br></code></pre></td></tr></table></figure><p>This can be submitted as cron job and automatically downloads new files generated (e.g. every hour). It checks whether the previous rsync job is done before rsync-ing again, otherwise waits for another time interval defined in the crontab (it generates a 'lock' file when starting a rsync and deleting it afterwards. If the 'lock' file is present it will not run rsync)</p>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>download</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Bash datetime (manipulate)</title>
    <link href="/2023/05/23/bash-datetime/"/>
    <url>/2023/05/23/bash-datetime/</url>
    
    <content type="html"><![CDATA[<h1 id="bash-datetime-manipulate">Bash datetime (manipulate)</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh">NAME<br>       <span class="hljs-built_in">date</span> - <span class="hljs-built_in">print</span> or <span class="hljs-built_in">set</span> the system <span class="hljs-built_in">date</span> and time<br><br>SYNOPSIS<br>       <span class="hljs-built_in">date</span> [OPTION]... [+FORMAT]<br>       <span class="hljs-built_in">date</span> [-u|--utc|--universal] [MMDDhhmm[[CC]YY][.ss]]<br><br></code></pre></td></tr></table></figure><p>We want to manipulate the datetime change.</p><h2 id="formatyyymmdd">Format=YYYMMDD</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs sh">YYYYMMDD=<span class="hljs-string">&quot;20210315&quot;</span><br>Next_day=$(<span class="hljs-built_in">date</span> +%Y%m%d -d <span class="hljs-string">&quot;<span class="hljs-variable">$YYYYMMDD</span> + 1 day&quot;</span>)<br><span class="hljs-comment"># 20210316</span><br>Next_day=$(<span class="hljs-built_in">date</span> +%Y-%m-%d -d <span class="hljs-string">&quot;<span class="hljs-variable">$YYYYMMDD</span> + 1 day&quot;</span>)<br><span class="hljs-comment"># 2021-03-16</span><br>Next_day=$(<span class="hljs-built_in">date</span> +%Y-%m-%d_%H:%M:%S -d <span class="hljs-string">&quot;<span class="hljs-variable">$YYYYMMDD</span> + 1 day&quot;</span>)<br><span class="hljs-comment"># 2021-03-16_00:00:00</span><br>Next_day=$(<span class="hljs-built_in">date</span> +%Y-%m-%d_%H:%M:%S -d <span class="hljs-string">&quot;<span class="hljs-variable">$YYYYMMDD</span> + 1 hour&quot;</span>)<br><span class="hljs-comment"># 2021-03-15_01:00:00</span><br>Next_day=$(<span class="hljs-built_in">date</span> +%Y-%m-%d_%H:%M:%S -d <span class="hljs-string">&quot;<span class="hljs-variable">$YYYYMMDD</span> + 1 min&quot;</span>)<br><span class="hljs-comment"># 2021-03-15_00:01:00</span><br>Next_day=$(<span class="hljs-built_in">date</span> +%Y-%m-%d_%H:%M:%S -d <span class="hljs-string">&quot;<span class="hljs-variable">$YYYYMMDD</span> + 1 second&quot;</span>)<br><span class="hljs-comment"># 2021-03-15_00:00:01</span><br>Next_day=$(<span class="hljs-built_in">date</span> +%Y-%m-%d_%H:%M:%S -d <span class="hljs-string">&quot;<span class="hljs-variable">$YYYYMMDD</span> + 1 day + 1 hour + 1 min + 1 second&quot;</span>)<br><span class="hljs-comment"># 2021-03-16_01:01:01</span><br></code></pre></td></tr></table></figure><h2 id="formatyyyy-mm-dd">Format=YYYY-MM-DD</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">YYYYMMDD=<span class="hljs-string">&quot;2021-04-15&quot;</span><br>Next_day=$(<span class="hljs-built_in">date</span> +%Y-%m-%d_%H:%M:%S -d <span class="hljs-string">&quot;<span class="hljs-variable">$YYYYMMDD</span> + 1 day + 1 hour + 1 min + 1 second&quot;</span>)<br><span class="hljs-comment"># 2021-04-16_01:01:01</span><br></code></pre></td></tr></table></figure><h2 id="formatyyyy-mm-dd-hhmmss">Format=YYYY-MM-DD HH:MM:SS"</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">YYYYMMDD=<span class="hljs-string">&quot;2017-01-19 00:05:01&quot;</span><br>Next_day=$(<span class="hljs-built_in">date</span> +%Y-%m-%d_%H:%M:%S -d <span class="hljs-string">&quot;<span class="hljs-variable">$YYYYMMDD</span> + 1 day + 1 hour + 1 min + 1 second&quot;</span>)<br><span class="hljs-comment"># 2017-01-20_08:06:02</span><br></code></pre></td></tr></table></figure><h2 id="to-seperate">To seperate</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh">FCST_DURATION=<span class="hljs-string">&quot;000_17:00:00&quot;</span><br><br>fcst_DD=<span class="hljs-variable">$&#123;FCST_DURATION:0:3&#125;</span><br>fcst_hh=<span class="hljs-variable">$&#123;FCST_DURATION:4:2&#125;</span><br>fcst_mm=<span class="hljs-variable">$&#123;FCST_DURATION:7:2&#125;</span><br>fcst_ss=<span class="hljs-variable">$&#123;FCST_DURATION:10:2&#125;</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>bash</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>What&#39;s the rigorous definition of phase and phase transition?</title>
    <link href="/2023/05/15/Whats-the-rigorous-definition-of-phase-and-phase-transition/"/>
    <url>/2023/05/15/Whats-the-rigorous-definition-of-phase-and-phase-transition/</url>
    
    <content type="html"><![CDATA[<h1 id="whats-the-rigorous-definition-of-phase-and-phase-transition">What's the rigorous definition of phase and phase transition?</h1><p>Ref: <a href="https://physics.stackexchange.com/questions/313758/whats-the-rigorous-definition-of-phase-and-phase-transition">What's the rigorous definition of phase and phase transition?</a></p><p>From Yi-Zhuang You (尤亦庄, Everett You),</p><blockquote><p>Does this mean that gas and liquid are the same phases? Because in the phase diagram they are connected and they have the same symmetry(translation and rotation). If they are not the same phase, how to call the state in large pressure and large temperature? Liquid or gas?</p></blockquote><p>Yes. <strong>From the modern point of view, liquid and gas are in the same phase</strong>. Because, as the asker has mentioned, they are continuously connected in the phase diagram through the "supercritical" regime. By definition, two states of matter are in the same phase if they can be smoothly deformed to each other without going through phase transitions. Historically, liquid and gas are named as different phases (by mistake) because people thought that "there must be one different phase at each side of the phase transition" (as argued in Diracology's answer). But this idea is wrong.</p><p>We can not declare different phases just by observing phase transitions. Otherwise, for example, in the following phase diagram on the left, we could have declared states A and B to be in different phases, simply because they are separated by phase transitions, as we can first go out of the blue phase and then reenter it. This way of separating phases is clearly stupid. Any reasonable person would agree that A and B should belong to the same phase in this case. Now we just deform the left phase diagram to the right by squeezing the intermediate red phase to a first-order transition line, then why we suddenly get confused about whether A and B are in the same phase or not? Definitely, they should still remain in the same phase! The liquid-gas transition is indeed a situation like this. So a logically consistent definition will have to define liquid and gas as a single phase.</p><blockquote><p>Does this mean that above the critical point the transition from gas to liquid is not a phase transition, but below the critical point, the transition from gas to liquid is a phase transition?</p></blockquote><p>Yes.</p><blockquote><p>If answers to my first and second question are "yes", does this mean even in the same phase there still can have phase transition? This conclusion is so weird!</p></blockquote><p>Given the example of the above phase diagrams, <strong>one will not feel weird about the fact that there can be (first-order) phase transitions inside a single phase</strong>. In fact, <strong>first-order transitions often appear by merging two second-order transitions together (this can be explained by Landau's theory)</strong>. <strong>So going across a first-order transition is like going out of the phase and back again immediately, which definitely can happen inside a single phase</strong>. However, I am not aware of any example that continuous phase transitions can also happen within a single phase. So I conjecture that if a phase transition happens inside a phase, it must be first-order. (The conjecture is falsified by the recent discovery of "unnecessary" quantum criticalities in Bi, Senthil 2018, Jian, Xu 2019, Verresen, Bibo, Pollmann 2021. -- Edited 2021) The liquid-gas transition is one example of my conjecture.</p><blockquote><p>From the Landau's paradigm, what's the symmetry breaking and order parameter in the gas-liquid phase transition? It seems that the symmetry is same in gas and liquid. Gas-liquid phase transition must be able to be explained by Landau's paradigm but Landau's paradigm says that there must be symmetry breaking in phase transition. There is an answer. I admit that from a modern point of view phase transition is not necessary due to symmetry breaking, but I don't think that gas-liquid transition has been beyond Landau's paradigm.</p></blockquote><p><strong>No symmetry breaking is associated with the liquid-gas transition. Landau's paradigm only says that there must be spontaneous symmetry breaking in second-order transitions, but not in first-order transitions.</strong> In fact, nothing can be said about first-order transitions, because first-order transitions can happen anywhere in the phase diagram without any reason. The liquid-gas transition is indeed a case like this.</p><p>Even though the liquid-gas transition is not a symmetry breaking transition, it can still be described within Landau's paradigm phenomenologically (who says that Landau's theory only applies to symmetry breaking transitions?). We can introduce the density <span class="math inline">\(\rho\)</span> of the fluid as the order parameter. Because no symmetry is acting on this order parameter, so there is no symmetry reason to forbid odd-order terms like <span class="math inline">\(\rho, \rho^3, ...\)</span> to appear in Landau's free energy. However the first order term can always be absorbed by redefining the order parameter with a shift <span class="math inline">\(\rho --&gt; \rho 0\)</span> , then the Landau free energy takes the general form of,</p><p><span class="math inline">\(F = F0 + a\rho^2 + b\rho^3 + c\rho^4 + ...\)</span></p><p>First-order transition happens by driving the parameter <span class="math inline">\(a\)</span> to <span class="math inline">\(a &lt; 9b^2/32c\)</span></p><p>From this example, we can see that (within Landau's paradigm) if a phase transition happens without breaking any symmetry, it must be first-order. Again the liquid-gas transition is one such example.</p><blockquote><p>So if given one phase, we firstly find the symmetry is same in this phase and then check several order parameters also same in this phase. However, how do you prove you must not be able to construct some weird order parameters such that in one part of this phase is zero and in another part of this phase is nonzero? For example, in a solid phase of water which has the same crystal structure, how to prove any order parameter that you can construct will not be zero in one part of the phase and nonzero in another part?</p></blockquote><p>Indeed, <strong>you can never rule out the possibility that some weird order parameter is hiding there to further divide the phase into more phases.</strong> That is actually why the solid phase of water is divided into so many different crystal phases. Each crystal structure is associated with a different symmetry-breaking pattern. Sometimes the symmetries are just so complicated that you may miss one or two of them if you are not careful enough. In that case, you will also miss the order parameters associated with the missing symmetry, until you see a specific heat anomaly in the experiment where you did not expect, then you start to realize that oh there is a missing order parameter that actually changes across this transition, and one needs to add some additional symmetry to explain it. This is actually the typical way that physicists work every day, they never figure out the full classification of phases until they see the evidence for new phases and phase transitions. I think this is also the fun part of condensed matter physics: there are always new phases of matter waiting for us to discover.</p><h2 id="more">More</h2><ol type="1"><li>In <a href="https://en.wikipedia.org/wiki/Ginzburg%E2%80%93Landau_theory">wiki</a>, Based on Landau's previously established theory of <strong>second-order phase transitions,</strong> ...</li></ol>]]></content>
    
    
    <categories>
      
      <category>physics</category>
      
    </categories>
    
    
    <tags>
      
      <tag>phase transition</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ERA5 dataset (2) contains invariant variables</title>
    <link href="/2023/05/11/ERA5-2-invariant-variables/"/>
    <url>/2023/05/11/ERA5-2-invariant-variables/</url>
    
    <content type="html"><![CDATA[<h1 id="era5-dataset-2-contains-invariant-variables">ERA5 dataset (2) contains invariant variables</h1><p><a href="https://forum.mmm.ucar.edu/threads/error-while-running-real-exe-with-era5-data-in-wrf-4-3-3.11500/">Post</a> <a href="https://rda.ucar.edu/datasets/ds633.0/dataaccess/">Downlaod</a> Ref: <a href="https://dreambooker.site/2017/12/20/initializing-the-wrf-model-with-ecmwf-era-interim-reanalysis/#/plpy">Initializing the WRF model with ECMWF ERA-Interim reanalysis</a></p><blockquote><p>I am suspicious that you don't have the file that contains invariant variables, especially landmask and terrain height, which are two important variables for WRF/WPS.</p></blockquote><blockquote><p>Please let me know if I am wrong. Otherwise, please download the following two files (from NCAR CISL)</p></blockquote><blockquote><p>e5.oper.invariant.128_172_lsm.regn320sc.2016010100_2016010100.grb e5.oper.invariant.128_129_z.regn320sc.2016010100_2016010100.grb</p></blockquote><blockquote><p>These files are not 'built-in' files. You have to download them, then go through the ungrib and metgrid processes.</p></blockquote><blockquote><p>Note that the two files need to be ungribbed separately (with start_date and end_date = '2016-01-01_00:00:00', and prefix = 'FILE2' in &amp;unribThese files</p></blockquote><blockquote><p>Then rename FILE2:2016-01-01_00 to be FILE2, and set <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">&amp;metgrid<br>fg_name = <span class="hljs-string">&#x27;FILE1&#x27;</span>,<br>io_form_metgrid = 2,<br>constants_name = <span class="hljs-string">&#x27;./FILE2&#x27;</span><br></code></pre></td></tr></table></figure> From here you can continue to run metgrid.exe.</p></blockquote><h2 id="download">Download</h2><p><a href="https://rda.ucar.edu/datasets/ds633.0/dataaccess/">Downlaod</a></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/usr/bin/env csh</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># c-shell script to download selected files from rda.ucar.edu using Wget</span><br><span class="hljs-comment"># NOTE: if you want to run under a different shell, make sure you change</span><br><span class="hljs-comment">#       the &#x27;set&#x27; commands according to your shell&#x27;s syntax</span><br><span class="hljs-comment"># after you save the file, don&#x27;t forget to make it executable</span><br><span class="hljs-comment">#   i.e. - &quot;chmod 755 &lt;name_of_script&gt;&quot;</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Experienced Wget Users: add additional command-line flags to &#x27;opts&#x27; here</span><br><span class="hljs-comment">#   Use the -r (--recursive) option with care</span><br><span class="hljs-comment">#   Do NOT use the -b (--background) option - simultaneous file downloads</span><br><span class="hljs-comment">#       can cause your data access to be blocked</span><br><span class="hljs-built_in">set</span> opts = <span class="hljs-string">&quot;-N&quot;</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Check wget version.  Set the --no-check-certificate option</span><br><span class="hljs-comment"># if wget version is 1.10 or higher</span><br><span class="hljs-built_in">set</span> v = `wget -V |grep <span class="hljs-string">&#x27;GNU Wget &#x27;</span> | <span class="hljs-built_in">cut</span> -d <span class="hljs-string">&#x27; &#x27;</span> -f 3`<br><span class="hljs-built_in">set</span> a = `<span class="hljs-built_in">echo</span> <span class="hljs-variable">$v</span> | <span class="hljs-built_in">cut</span> -d <span class="hljs-string">&#x27;.&#x27;</span> -f 1`<br><span class="hljs-built_in">set</span> b = `<span class="hljs-built_in">echo</span> <span class="hljs-variable">$v</span> | <span class="hljs-built_in">cut</span> -d <span class="hljs-string">&#x27;.&#x27;</span> -f 2`<br><span class="hljs-keyword">if</span>(100 * <span class="hljs-variable">$a</span> + <span class="hljs-variable">$b</span> &gt; 109) <span class="hljs-keyword">then</span><br>  <span class="hljs-built_in">set</span> cert_opt = <span class="hljs-string">&quot;--no-check-certificate&quot;</span><br><span class="hljs-keyword">else</span><br>  <span class="hljs-built_in">set</span> cert_opt = <span class="hljs-string">&quot;&quot;</span><br>endif<br><br><span class="hljs-built_in">set</span> filelist= ( \<br>  https://data.rda.ucar.edu/ds633.0/e5.oper.invariant/197901/e5.oper.invariant.128_026_cl.ll025sc.1979010100_1979010100.grb  \<br>  https://data.rda.ucar.edu/ds633.0/e5.oper.invariant/197901/e5.oper.invariant.128_027_cvl.ll025sc.1979010100_1979010100.grb  \<br>  https://data.rda.ucar.edu/ds633.0/e5.oper.invariant/197901/e5.oper.invariant.128_028_cvh.ll025sc.1979010100_1979010100.grb  \<br>  https://data.rda.ucar.edu/ds633.0/e5.oper.invariant/197901/e5.oper.invariant.128_029_tvl.ll025sc.1979010100_1979010100.grb  \<br>  https://data.rda.ucar.edu/ds633.0/e5.oper.invariant/197901/e5.oper.invariant.128_030_tvh.ll025sc.1979010100_1979010100.grb  \<br>  https://data.rda.ucar.edu/ds633.0/e5.oper.invariant/197901/e5.oper.invariant.128_043_slt.ll025sc.1979010100_1979010100.grb  \<br>  https://data.rda.ucar.edu/ds633.0/e5.oper.invariant/197901/e5.oper.invariant.128_074_sdfor.ll025sc.1979010100_1979010100.grb  \<br>  https://data.rda.ucar.edu/ds633.0/e5.oper.invariant/197901/e5.oper.invariant.128_129_z.ll025sc.1979010100_1979010100.grb  \<br>  https://data.rda.ucar.edu/ds633.0/e5.oper.invariant/197901/e5.oper.invariant.128_160_sdor.ll025sc.1979010100_1979010100.grb  \<br>  https://data.rda.ucar.edu/ds633.0/e5.oper.invariant/197901/e5.oper.invariant.128_161_isor.ll025sc.1979010100_1979010100.grb  \<br>  https://data.rda.ucar.edu/ds633.0/e5.oper.invariant/197901/e5.oper.invariant.128_162_anor.ll025sc.1979010100_1979010100.grb  \<br>  https://data.rda.ucar.edu/ds633.0/e5.oper.invariant/197901/e5.oper.invariant.128_163_slor.ll025sc.1979010100_1979010100.grb  \<br>  https://data.rda.ucar.edu/ds633.0/e5.oper.invariant/197901/e5.oper.invariant.128_172_lsm.ll025sc.1979010100_1979010100.grb  \<br>  https://data.rda.ucar.edu/ds633.0/e5.oper.invariant/197901/e5.oper.invariant.228_007_dl.ll025sc.1979010100_1979010100.grb  \<br>)<br><span class="hljs-keyword">while</span>(<span class="hljs-variable">$#filelist</span> &gt; 0)<br>  <span class="hljs-built_in">set</span> syscmd = <span class="hljs-string">&quot;wget <span class="hljs-variable">$cert_opt</span> <span class="hljs-variable">$opts</span> <span class="hljs-variable">$filelist</span>[1]&quot;</span><br>  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$syscmd</span> ...&quot;</span><br>  <span class="hljs-variable">$syscmd</span><br>  <span class="hljs-built_in">shift</span> filelist<br>end<br></code></pre></td></tr></table></figure><p>Two are important,</p><p>terrain height, &gt; e5.oper.invariant.128_129_z.ll025sc.1979010100_1979010100.grb</p><p>landmask, &gt; e5.oper.invariant.128_172_lsm.ll025sc.1979010100_1979010100.grb</p><h2 id="ungrib">Ungrib</h2><h3 id="source-wrf-env">source WRF env</h3><h3 id="soft-link">soft-link</h3><ol type="1"><li>link_grib.csh</li><li>namelist.wps</li><li>ungrib.exe</li><li>Vtable.ERA-interim.pl as Vtable</li><li>int2nc.exe</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs sh">&amp;share<br> wrf_core = <span class="hljs-string">&#x27;ARW&#x27;</span>,<br> max_dom = 1,<br> start_date = <span class="hljs-string">&#x27;1979-01-01_00:00:00&#x27;</span>,<br> end_date   = <span class="hljs-string">&#x27;1979-01-01_00:00:00&#x27;</span>,<br> interval_seconds = 10800,<br> io_form_geogrid = 2<br>/<br><br>&amp;ungrib<br> out_format = <span class="hljs-string">&#x27;WPS&#x27;</span>,<br> prefix = <span class="hljs-string">&#x27;FIX&#x27;</span>,<br>/<br></code></pre></td></tr></table></figure><p>and link_grib.csh</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ ./link_grib.csh e5.oper.invariant.*<br>GRIBFILE.AAA -&gt; e5.oper.invariant.128_129_z.ll025sc.1979010100_1979010100.grb<br>GRIBFILE.AAB -&gt; e5.oper.invariant.128_172_lsm.ll025sc.1979010100_1979010100.grb<br></code></pre></td></tr></table></figure><p>then ungrib.exe</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ ./ungrib.exe<br>FIX:1979-01-01_00<br></code></pre></td></tr></table></figure><h3 id="check-results">check results</h3><p>Plot Intermediate Files in netCDF Format Using <strong>int2nc.exe (Found in WPS/util/)</strong> <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ ./int2nc.exe FIX:1979-01-01_00<br>FIX:1979-01-01_00.nc<br>$ ncview FIX:1979-01-01_00.nc<br></code></pre></td></tr></table></figure></p><h2 id="for-metgrid.exe">For metgrid.exe</h2><p>namelist.wps is written as</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh">&amp;share<br> start_date = <span class="hljs-string">&#x27;2015-08-07_00:00:00&#x27;</span>,<span class="hljs-string">&#x27;2015-08-07_00:00:00&#x27;</span>,<br> end_date   = <span class="hljs-string">&#x27;2015-08-08_12:00:00&#x27;</span>,<span class="hljs-string">&#x27;2015-08-08_12:00:00&#x27;</span>,<br>&amp;metgrid<br> fg_name = <span class="hljs-string">&#x27;ERA5&#x27;</span>,<br> constants_name = <span class="hljs-string">&#x27;/xxx/xxx/FIX:1979-01-01_00&#x27;</span>,<br> io_form_metgrid = 2,<br></code></pre></td></tr></table></figure><p>Finally, <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ ./metgrid.exe<br></code></pre></td></tr></table></figure></p>]]></content>
    
    
    <categories>
      
      <category>NWP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>WRF</tag>
      
      <tag>WPS</tag>
      
      <tag>IC/BC</tag>
      
      <tag>ERA5</tag>
      
      <tag>grib</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>gdb debugger</title>
    <link href="/2023/05/11/gdb/"/>
    <url>/2023/05/11/gdb/</url>
    
    <content type="html"><![CDATA[<h1 id="gdb-debugger">gdb debugger</h1><p>GDB stands for GNU Project Debugger. GDB（GNU Debugger）是UNIX及UNIX-like下的強大調試工具，可以調試ada, c, c++, asm, minimal, d, fortran, objective-c, go, java,pascal等語言。本文以C程序為例如，介紹GDB啟動調試的多種方式。</p><ol type="1"><li>Compile your code with debugging option</li></ol><h2 id="launch-gdb">Launch gdb</h2><p>In general, it is <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">gdb ./wrf.exe<br></code></pre></td></tr></table></figure> but most of time, it is by mpirun, <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">mpirun -n 1 gdb ./wrf.exe<br></code></pre></td></tr></table></figure></p><p>Sample output, <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sh">GNU gdb (GDB) Red Hat Enterprise Linux 7.6.1-110.el7<br>Copyright (C) 2013 Free Software Foundation, Inc.<br>License GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;<br>This is free software: you are free to change and redistribute it.<br>There is NO WARRANTY, to the extent permitted by law.  Type <span class="hljs-string">&quot;show copying&quot;</span><br>and <span class="hljs-string">&quot;show warranty&quot;</span> <span class="hljs-keyword">for</span> details.<br>This GDB was configured as <span class="hljs-string">&quot;x86_64-redhat-linux-gnu&quot;</span>.<br>For bug reporting instructions, please see:<br>&lt;http://www.gnu.org/software/gdb/bugs/&gt;...<br>Reading symbols from /xxx/WRFV4.4_debug/main/wrf.exe...done.<br>(gdb)<br></code></pre></td></tr></table></figure></p><h2 id="commands">commands</h2><p>Here are few useful commands to get started with gdb for the above example: <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs sh">run or r –&gt; executes the program from start to end.<br><span class="hljs-built_in">break</span> or b –&gt; sets breakpoint on a particular line.<br><span class="hljs-built_in">disable</span> -&gt; <span class="hljs-built_in">disable</span> a breakpoint.<br><span class="hljs-built_in">enable</span> –&gt; <span class="hljs-built_in">enable</span> a disabled breakpoint.<br>delete -&gt; delete a breakpoint by index 1,2,3,...<br>next or n -&gt; executes next line of code, but don’t dive into <span class="hljs-built_in">functions</span>.<br>step –&gt; go to next instruction, diving into the <span class="hljs-keyword">function</span>.<br>list or l –&gt; displays the code.<br><span class="hljs-built_in">print</span> or p –&gt; used to display the stored value.<br>quit or q –&gt; exits out of gdb.<br>clear –&gt; to clear all breakpoints.<br><span class="hljs-built_in">continue</span> –&gt; <span class="hljs-built_in">continue</span> normal execution.<br>reverse-next -&gt; Run the program backward<br>reverse-step -&gt; Run the program backward<br>reverse-continue -&gt; Run the program backward<br></code></pre></td></tr></table></figure></p><h2 id="movement">movement</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">up (n)<br>down (n)<br><span class="hljs-built_in">print</span> or p<br></code></pre></td></tr></table></figure><h2 id="single-step-execution--next">Single step execution -next</h2><p>The next command (can be abbreviated as n) is used to continue to execute the next statement after the program is stopped, assuming that debugging has been started, and stop at line 10, if you want to continue execution, use n to execute the next statement, if later Keeping up with the number num, it means that the instruction is executed num times, and the effect of continuing to execute n lines is achieved.</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs sh">(gdb) b 10<br>Breakpoint 1 at 0x405b26: file wrf.f90, line 10.<br>(gdb) run<br>Starting program: /xxx/./wrf.exe <br>[Thread debugging using libthread_db enabled]<br>Using host libthread_db library <span class="hljs-string">&quot;/lib64/libthread_db.so.1&quot;</span>.<br><br>Breakpoint 1, wrf () at wrf.f90:22<br>22        CALL wrf_init<br>Missing separate debuginfos, use: debuginfo-install ...<br>(gdb) n<br> starting wrf task            0  of            1<br>25        CALL wrf_dfi<br></code></pre></td></tr></table></figure><h2 id="step-into--step">Step into -step</h2><p>For the above situation, if we want to track the internal situation of the function, we can use the step command (which can be abbreviated as s), which can single-step trace to the inside of the function, but only if the function has debugging information and source code information.</p><h2 id="core-document">core document</h2><p>When a program core dumps, a core file may be generated, which can help us identify location problems for a large enough program. But it was proposed before that the system does not limit the generation of core files. You can use the command limit - c to view: <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ <span class="hljs-built_in">ulimit</span> -c<br>0<br>$ <span class="hljs-built_in">ulimit</span> -c unlimited  <span class="hljs-comment"># Indicates that there is no limit to the core file size</span><br></code></pre></td></tr></table></figure> Or add at the end of ~/.bashrc: ulimit -c unlimited</p><h2 id="check-breakpoints">check breakpoints</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ info breakpoints<br></code></pre></td></tr></table></figure><h2 id="set-breakpoints">set breakpoints</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ b 10<br>$ b main.c:10 <span class="hljs-comment"># Important</span><br>$ b Function<br></code></pre></td></tr></table></figure><h3 id="generate-breakpoints-based-on-expression-value-changes">Generate breakpoints based on expression value changes</h3><p>Sometimes we need to observe a certain value or expression to know when it has changed. At this time, we can use the watch command. For example: <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ watch a<br></code></pre></td></tr></table></figure> At this time, let the program continue to run. If the value of a changes, the relevant content will be printed, such as： <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">Hardware watchpoint 2: a<br>Old value = 12<br>New value = 11<br></code></pre></td></tr></table></figure> But here to pay attention is that the program must be running, otherwise it will appear: &gt; No symbol "a" in current context. Because the program is not running, the current context has no relevant variable information.</p><h2 id="tuitext-user-interface">TUI(Text User Interface)</h2><p>The GDB Text User Interface, TUI in short, is a terminal interface which uses the curses library to show the source file, the assembly output, the program registers and GDB commands in separate text windows. <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ gdb main -tui<br></code></pre></td></tr></table></figure> Sounds like what you're looking for is the callstack/backtrace. For that, just use the &gt; $ (gdb) backtrace/bt or where</p><p>command.</p><h2 id="frame">frame</h2><ol type="1"><li>According to the stack frame number or stack frame address, select the stack frame to be viewed. The syntax format is as follows: &gt; (gdb) frame spec</li><li>With the help of the following command, we can view the information stored in the current stack frame: &gt; (gdb) info frame</li></ol><h2 id="backtracebt">backtrace/bt</h2><blockquote><p>backtrace</p></blockquote><p>The command is used to print the information of all stack frames in the current debugging environment</p><h2 id="step-out-of-current-function-with-gdb">Step out of current function with GDB</h2><p>You can use the <strong>finish</strong> command. &gt; finish: Continue running until just after function in the selected stack frame returns. Print the returned value (if any). This command can be abbreviated as fin.</p><h2 id="reserse">Reserse</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">reverse-next -&gt; Run the program backward<br>reverse-step -&gt; Run the program backward<br>reverse-continue -&gt; Run the program backward<br></code></pre></td></tr></table></figure><h2 id="example-wrf">Example: WRF</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ <span class="hljs-built_in">source</span> wrf_env.sh<br><br>(gdb) b solve_em.F:xxx                       <span class="hljs-comment"># try to stop before CALL first_rk_step_part1(...)</span><br>(gdb) b module_first_rk_step_part1.f90:387   <span class="hljs-comment"># try to stop before CALL surface_driver(...)</span><br>(gdb) b module_surface_driver.f90:2683       <span class="hljs-comment"># try to stop before CALL lsm(...) </span><br>(gdb) b module_sf_noahdrv.f90:1234           <span class="hljs-comment"># try to stop before Call urban(...) for WRF</span><br>(gdb) b module_sf_noahdrv.F:xxxx             <span class="hljs-comment"># try to stop before Call urban(...) for MPAS</span><br>(gdb) run<br>...<br>(gdb) n/s/p/f/bt<br></code></pre></td></tr></table></figure><h2 id="inferior-1-process-exited-normally">Inferior 1 (process ) exited normally</h2><p>That is not an error, from gdb's point of view. Your program just finished gracefully, with a return value of 0, and gdb informs you of that.</p><h2 id="what-does-no-stack-mean-in-gdb">What does <strong>no stack</strong> mean in gdb?</h2><h2 id="missing-separate-debuginfos-use-debuginfo-install-cyrus-sasl-lib-">Missing separate debuginfos, use: debuginfo-install cyrus-sasl-lib-?</h2><ol type="1"><li>Install debuginfos</li><li>$ debuginfo-install glibc</li></ol>]]></content>
    
    
    <categories>
      
      <category>gdb</category>
      
    </categories>
    
    
    <tags>
      
      <tag>debug</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ERA5 ERA5T expver dimension issue</title>
    <link href="/2023/05/07/ERA5-expver-issue/"/>
    <url>/2023/05/07/ERA5-expver-issue/</url>
    
    <content type="html"><![CDATA[<h1 id="era5-era5t-expver-dimension-issue">ERA5 ERA5T expver dimension issue</h1><p>Ref: <a href="https://confluence.ecmwf.int/display/CUSF/ERA5+CDS+requests+which+return+a+mixture+of+ERA5+and+ERA5T+data">ERA5 CDS requests which return a mixture of ERA5 and ERA5T data</a></p><p><strong>The ERA5 hourly and monthly data are made available with a 3 month delay.</strong> This means that after a month has passed, another month's worth of ERA5 data is written to the dataset.</p><p><strong>ERA5T (near real time)</strong> preliminary data are used to fill the gap between the end of the ERA5 data and 5 days before the present date. The oldest month of these is overwritten each month as new ERA5 data become available.</p><blockquote><p>It depends on time, it is <strong>expver either 1 or 5</strong>, will not exist at the same time<br />If already past 3 months' time, it will use ERA5, otherwise use ERA5T if too recent</p></blockquote><h2 id="for-example">For example,</h2><p>So as an example, say we have a current date of 15th February 2020:</p><blockquote><p>ERA5 data are currently from 1/1/1979 - 30/11/2019 (instantaneous variables) and 1/1/1979 - 1/12/2019 (00-06 UTC, accumulated variables)<br />ERA5T data (with a 5 day delay) are from 1/12/2019- 10/2/2020 (instantaneous variables) and 1/12/2019 (07-23 UTC, accumulated variables)- 10/2/2020</p></blockquote><p>For requests which return a mixture of ERA5 and ERA5T data (such as for data from the 1st of the month), instantaneous variables (e.g temperature) come from ERA5T (which has 'experiment version' of 5) while accumulated variables (fluxes, precipitation) come from both datasets with the following structure:</p><blockquote><p>00-06 UTC on 1 day of the month from <strong>ERA5 (expver 1)</strong><br />07-23 UTC on 1 day of the month (and the following dates up to 5 day from present) from <strong>ERA5T (expver 5)</strong> When these data are converted to netCDF a new dimension is created called expver containing 1 and 5. Moreover, a single time coordinate is used which covers the entire requested period.</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs sh">dimensions:<br>        longitude = 1440 ;<br>        latitude = 721 ;<br>        expver = 2 ;<br>        time = 24 ;<br>variables:<br>        <span class="hljs-built_in">float</span> longitude(longitude) ;<br>                longitude:units = <span class="hljs-string">&quot;degrees_east&quot;</span> ;<br>                longitude:long_name = <span class="hljs-string">&quot;longitude&quot;</span> ;<br>        <span class="hljs-built_in">float</span> latitude(latitude) ;<br>                latitude:units = <span class="hljs-string">&quot;degrees_north&quot;</span> ;<br>                latitude:long_name = <span class="hljs-string">&quot;latitude&quot;</span> ;<br>        int expver(expver) ;<br>                expver:long_name = <span class="hljs-string">&quot;expver&quot;</span> ;<br>        int time(time) ;<br>                time:units = <span class="hljs-string">&quot;hours since 1900-01-01 00:00:00.0&quot;</span> ;<br>                time:long_name = <span class="hljs-string">&quot;time&quot;</span> ;<br>                time:calendar = <span class="hljs-string">&quot;gregorian&quot;</span> ;<br>        short tp(time, expver, latitude, longitude) ;<br>                tp:scale_factor = 9.06276558810304e-07 ;<br>                tp:add_offset = 0.0296950577259784 ;<br>                tp:_FillValue = -32767s ;<br>                tp:missing_value = -32767s ;<br>                tp:units = <span class="hljs-string">&quot;m&quot;</span> ;<br>                tp:long_name = <span class="hljs-string">&quot;Total precipitation&quot;</span> ;<br>data:<br><br> expver = 5, 1 ;<br> ...<br>&#125;<br></code></pre></td></tr></table></figure><p>Both expver dimensions use the full time extent of time coordinate but the expver 1 data only covers the first 7 timesteps, the remaining timesteps are 'padded' with empty fields. For the expver 5 data, the first 7 timesteps are padded with empty fields, with the remaining timesteps coming from the ERA5T data.</p><p>When the last ERA5 data are released, <strong>they will overwrite the ERA5T data for the entire month and for accumulated variables for 00-06 in next month.</strong> This process will be repeated each month.</p>]]></content>
    
    
    <categories>
      
      <category>NWP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>HPC</tag>
      
      <tag>WRF</tag>
      
      <tag>ERA5</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Git cherry-pick</title>
    <link href="/2023/05/07/Git-cherry-pick/"/>
    <url>/2023/05/07/Git-cherry-pick/</url>
    
    <content type="html"><![CDATA[<h1 id="git-cherry-pick">Git cherry-pick</h1><p>After switching to the master, use the cherry-pick command to take out the submission of "adding commit instructions", and then add it to the master.</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ git checkout master<br>Switched to branch <span class="hljs-string">&#x27;master&#x27;</span><br>$ git cherry-pick 99daed2<br>error: could not apply 99daed2... commit<br>hint: after resolving the conflicts, mark the corrected paths<br>hint: with <span class="hljs-string">&#x27;git add &lt;paths&gt;&#x27;</span> or <span class="hljs-string">&#x27;git rm &lt;paths&gt;&#x27;</span><br>hint: and commit the result with <span class="hljs-string">&#x27;git commit&#x27;</span><br></code></pre></td></tr></table></figure><p>If a conflict occurs, please open sample.txt, modify the conflicting part and then submit.</p><h2 id="whats-the-simplest-way-to-list-conflicted-files-in-git">What's the simplest way to list conflicted files in Git?</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># # Search for all conflicting files.</span><br>git diff --name-only --diff-filter=U --relative<br><br><span class="hljs-comment"># Search for all conflicting files.</span><br>grep -lr <span class="hljs-string">&quot;&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD&quot;</span> ./*<br><br></code></pre></td></tr></table></figure><h2 id="resolve-easyobvious-conflicts">Resolve easy/obvious conflicts</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#At this point you may review each files. If solution is to accept local/our version, run:</span><br>git checkout --ours PATH/FILE<br><br><span class="hljs-comment">#If solution is to accept remote/other-branch version, run:</span><br>git checkout --theirs PATH/FILE<br><br><span class="hljs-comment">#If you have multiple files and you want to accept local/our version, run:</span><br>grep -lr <span class="hljs-string">&#x27;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&#x27;</span> . | xargs git checkout --ours<br><br><span class="hljs-comment">#If you have multiple files and you want to accept remote/other-branch version, run:</span><br>grep -lr <span class="hljs-string">&#x27;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&#x27;</span> . | xargs git checkout --theirs<br></code></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ git add sample.txt<br>$ git commit<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Git</category>
      
    </categories>
    
    
    <tags>
      
      <tag>git cherry-pick</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Git: solve conflicted files</title>
    <link href="/2023/05/07/Git-conflicts/"/>
    <url>/2023/05/07/Git-conflicts/</url>
    
    <content type="html"><![CDATA[<h1 id="git-solve-conflicted-files">Git: solve conflicted files</h1><h2 id="whats-the-simplest-way-to-list-conflicted-files-in-git">What's the simplest way to list conflicted files in Git?</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># # Search for all conflicting files.</span><br>git diff --name-only --diff-filter=U --relative<br><br><span class="hljs-comment"># Search for all conflicting files.</span><br>grep -lr <span class="hljs-string">&quot;&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD&quot;</span> ./*<br><br></code></pre></td></tr></table></figure><h2 id="resolve-easyobvious-conflicts">Resolve easy/obvious conflicts</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#At this point you may review each files. If solution is to accept local/our version, run:</span><br>git checkout --ours PATH/FILE<br><br><span class="hljs-comment">#If solution is to accept remote/other-branch version, run:</span><br>git checkout --theirs PATH/FILE<br><br><span class="hljs-comment">#If you have multiple files and you want to accept local/our version, run:</span><br>grep -lr <span class="hljs-string">&#x27;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&#x27;</span> . | xargs git checkout --ours<br><br><span class="hljs-comment">#If you have multiple files and you want to accept remote/other-branch version, run:</span><br>grep -lr <span class="hljs-string">&#x27;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&#x27;</span> . | xargs git checkout --theirs<br></code></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ git add sample.txt<br>$ git commit<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Git</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Github</tag>
      
      <tag>git commit</tag>
      
      <tag>git conflicts</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>WRF | GRIB1, GRIB2, NetCDF</title>
    <link href="/2023/05/06/GRIB1_GRIB2_NetCDF/"/>
    <url>/2023/05/06/GRIB1_GRIB2_NetCDF/</url>
    
    <content type="html"><![CDATA[<h1 id="grib1-grib2-netcdf">GRIB1, GRIB2, NetCDF</h1><p>Ref: <a href="https://rda.ucar.edu/OS/web/datasets/ds083.2/docs/README_Formats.pdf">GRIB1, GRIB2, NetCDF: Which do I choose?</a></p><p>Your choice of data format depends on the date range that you need and what you want to do with the data. GRIB is a World Meteorological Organization (WMO) international standard for exchanging GRidded BInary data.</p><p><strong>GRIB1</strong> is the original format and requires a separate parameter table to unpack the data. <strong>GRIB2</strong> improves upon the standard with file compression and the inclusion of the metadata/parameter table that you need to unpack the data in each file. <strong>GRIB2 exploits the same compression software commonly used for images to gain a roughly 50% reduction in Hile size over GRIB1. </strong></p><p>If you are interested in <strong>2007.12.06</strong> or later, then choose GRIB2 because of its smaller size. For earlier dates, use GRIB1. If you are using software that reads NetCDF but not GRIB, then convert the files to NetCDF *.nc format. Unless you need to use NetCDF tools, use GRIB2 for its efficiency. The WRF mesoscale model can use either GRIB1 or GRIB2. Newer versions of WRF Preprocessing System (WPS) can recognize FNL GRIB1 and GRIB2; WPS will even provide the appropriate parameter table for FNL in GRIB1 format so you do not need to do so manually.</p><p>If you are using the older MM5 mesoscale model, use GRIB1. You can perform many data processing tasks on GRIB files with wgrib (for GRIB1) and wgrib2 (for GRIB2).</p><p>You can process and visualize GRIB Hiles with GRADS, IDL, Panoply, and R (using the rNOMADS package).</p><p>You can use the extensive NetCDF software libraries if you convert the Hiles to NetCDF. However, be mindful that NetCDF Hiles are not as compact as GRIB2, even when compressed.</p>]]></content>
    
    
    <categories>
      
      <category>WRF</category>
      
    </categories>
    
    
    <tags>
      
      <tag>HPC</tag>
      
      <tag>WRF</tag>
      
      <tag>WPS</tag>
      
      <tag>MPAS</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Intel OneAPI</title>
    <link href="/2023/05/06/Intel_OneAPI/"/>
    <url>/2023/05/06/Intel_OneAPI/</url>
    
    <content type="html"><![CDATA[<h1 id="intel-oneapi">Intel OneAPI</h1><p>The Intel oneAPI HPC Toolkit is a comprehensive suite of development tools that make it fast and easy to build modern code that gets maximum performance out of the newest Intel® processors. This toolkit enables high performance computing on clusters or individual nodes with flexible options including optimal performance on a CPU or GPU.</p><h2 id="command-line-download">Command Line Download</h2><p>Command Line Installation Parameters</p><p>Get latest version <a href="https://www.intel.com/content/www/us/en/developer/tools/oneapi/hpc-toolkit-download.html?operatingsystem=linux&amp;distributions=offline" class="uri">https://www.intel.com/content/www/us/en/developer/tools/oneapi/hpc-toolkit-download.html?operatingsystem=linux&amp;distributions=offline</a></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">wget https://registrationcenter-download.intel.com/akdlm/IRC_NAS/1ff1b38a-8218-4c53-9956-f0b264de35a4/l_HPCKit_p_2023.1.0.46346_offline.sh<br><br><span class="hljs-built_in">sudo</span> sh ./l_HPCKit_p_2023.1.0.46346_offline.sh<br></code></pre></td></tr></table></figure><h3 id="installation-instructions">Installation Instructions</h3><p>The initial download is for the installer application files only. The installer will acquire all the tools during the installation process.</p><ol type="1"><li>Step 1: From the console, locate the downloaded install file.</li><li>Step 2: Use $ sudo sh ./<installer>.sh to launch the GUI Installer as root. Optionally, use $ sh ./<installer>.sh to launch the GUI Installer as current user.</li><li>Step 3: Follow the instructions in the installer.</li><li>Step 4: Explore the Get <a href="https://www.intel.com/content/www/us/en/develop/documentation/get-started-with-intel-oneapi-hpc-linux/top.html">Started Guide</a>.</li></ol><h2 id="get-started-with-the-intel-oneapi-hpc-toolkit-for-linux">Get Started with the Intel oneAPI HPC Toolkit for Linux</h2><p>Although the CMake and pkg-config build tools are not required by the oneAPI tools and toolkits, many oneAPI samples are provided as CMake projects and require CMake to build them. In some cases pkg-config is necessary to locate libraries needed to complete a build of the application.</p><p>The Intel compilers utilize the existing GNU build toolchains to provide a complete C/C++ development environment. If your distribution of Linux does not include the complete suite of GNU development tools, you need to install these tools.</p><p>To install CMake, pkg-config, and the GNU development tools on your Linux system, open a terminal session and enter the following commands:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">sudo</span> apt update<br><span class="hljs-built_in">sudo</span> apt -y install cmake pkg-config build-essential<br></code></pre></td></tr></table></figure><p>Verify the installation by displaying the installation location with this command: <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">which</span> cmake pkg-config make gcc g++<br></code></pre></td></tr></table></figure></p><p>In my caes, it is installed in /home/wpsze/intel/oneapi/</p><blockquote><p>remark #10441: The Intel(R) C++ Compiler Classic (ICC) is deprecated and will be removed from product release in the second half of 2023. The Intel(R) oneAPI DPC++/C++ Compiler (ICX) is the recommended compiler moving forward. Please transition to use this compiler. Use '-diag-disable=10441' to disable this message.</p></blockquote><p>ICC (Linux), ICL (Windows) are classic Intel C/C++ Compilers. Whereas, ICX is Intel nextgen compiler based on Clang /LLVM technology plus Intel proprietary optimizations and code generation.</p><ol type="1"><li>You may use ICC for performance on CPU targets.</li><li>ICX enables OpenMP TARGET offload to Intel GPU targets.</li></ol><p>The following are the guiding principles for ICX:</p><blockquote><ol type="1"><li>ICX and ICC Classic use different compiler drivers. The Intel® C++ Compiler Classic compiler drivers are icc, icpc, and icl.  The Intel® oneAPI DPC++/C++ Compiler drivers are icx and icpx. Use icx to compile and link C programs, and icpx for C++ programs.</li></ol></blockquote><blockquote><ol start="2" type="1"><li>Unlike the icc driver, icx does not use the file extension to determine whether to compile as C or C+. Users must invoke icpx to compile C+ files. . In addition to providing a core C++ Compiler, ICX/ICPX is also used to compile SYCL/DPC++ codes for the Intel® oneAPI Data Parallel C++ Compiler when we pass an additional flag “-fsycl”. </li></ol></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ <span class="hljs-built_in">source</span> /home/wpsze/intel/oneapi/setvars.sh<br><br>$ <span class="hljs-built_in">which</span> icc<br><span class="hljs-comment">#/home/wpsze/intel/oneapi/compiler/2023.1.0/linux/bin/intel64/icc</span><br>$ <span class="hljs-built_in">which</span> ifort <br><span class="hljs-comment">#/home/wpsze/intel/oneapi/compiler/2023.1.0/linux/bin/intel64/ifort</span><br>$ <span class="hljs-built_in">which</span> icpc<br><span class="hljs-comment">#/home/wpsze/intel/oneapi/compiler/2023.1.0/linux/bin/intel64/icpc</span><br><br>$ icc --version<br>icc: remark <span class="hljs-comment">#10441: The Intel(R) C++ Compiler Classic (ICC) is deprecated and will be removed from product release in the second half of 2023. The Intel(R) oneAPI DPC++/C++ Compiler (ICX) is the recommended compiler moving forward. Please transition to use this compiler. Use &#x27;-diag-disable=10441&#x27; to disable this message.</span><br>icc (ICC) 2021.9.0 20230302<br>Copyright (C) 1985-2023 Intel Corporation.  All rights reserved.<br><br>$ ifort --version<br>ifort (IFORT) 2021.9.0 20230302<br>Copyright (C) 1985-2023 Intel Corporation.  All rights reserved.<br><br>$ icpc --version<br>icpc: remark <span class="hljs-comment">#10441: The Intel(R) C++ Compiler Classic (ICC) is deprecated and will be removed from product release in the second half of 2023. The Intel(R) oneAPI DPC++/C++ Compiler (ICX) is the recommended compiler moving forward. Please transition to use this compiler. Use &#x27;-diag-disable=10441&#x27; to disable this message.</span><br>icpc (ICC) 2021.9.0 20230302<br>Copyright (C) 1985-2023 Intel Corporation.  All rights reserved.<br><br>$ <span class="hljs-built_in">which</span> icx<br><span class="hljs-comment"># /home/wpsze/intel/oneapi/compiler/2023.1.0/linux/bin/icx</span><br><br>$ icx --version<br>Intel(R) oneAPI DPC++/C++ Compiler 2023.1.0 (2023.1.0.20230320)<br>Target: x86_64-unknown-linux-gnu<br>Thread model: posix<br>InstalledDir: /home/wpsze/intel/oneapi/compiler/2023.1.0/linux/bin-llvm<br>Configuration file: /home/wpsze/intel/oneapi/compiler/2023.1.0/linux/bin-llvm/../bin/icx.cfg<br><br>$ <span class="hljs-built_in">which</span> icpx<br><span class="hljs-comment"># /home/wpsze/intel/oneapi/compiler/2023.1.0/linux/bin/icpx</span><br><br>$ icpx --version<br>Intel(R) oneAPI DPC++/C++ Compiler 2023.1.0 (2023.1.0.20230320)<br>Target: x86_64-unknown-linux-gnu<br>Thread model: posix<br>InstalledDir: /home/wpsze/intel/oneapi/compiler/2023.1.0/linux/bin-llvm<br>Configuration file: /home/wpsze/intel/oneapi/compiler/2023.1.0/linux/bin-llvm/../bin/icpx.cfg<br></code></pre></td></tr></table></figure><p>Remark</p><ol type="1"><li>The icc and icpc commands resemble the GNU equivalents gcc and g++. This is a highly optimizing C (icc) and C++ (icpc) compiler.</li></ol><h2 id="set-environment-variables-for-cli-development">Set Environment Variables for CLI Development</h2><p>Option 1: Source setvars.sh once per session</p><p>Source setvars.sh every time you open a new terminal window:</p><p>You can find the setvars.sh script in the root folder of your oneAPI installation, which is typically /opt/intel/oneapi/ for system wide installation and ~/intel/oneapi/ when installed as a private installation. Note that system wide installation requires root or sudo privileges.</p><p>For system wide installations: <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">source</span> /opt/intel/oneapi/setvars.sh<br></code></pre></td></tr></table></figure></p><p>For private installations: <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">source</span> ~/intel/oneapi/setvars.sh<br></code></pre></td></tr></table></figure></p><h2 id="build-and-run-a-sample-project-using-the-command-line">Build and Run a Sample Project Using the Command Line</h2><p>To compile and run a sample:</p><ol type="1"><li>Download the sample using the oneAPI CLI Samples Browser. (Command line interface (CLI))</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ oneapi-cli <br></code></pre></td></tr></table></figure><ol start="2" type="1"><li>Compile and run the sample with Make*</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ <span class="hljs-built_in">cd</span> /home/wpsze/intel/oneapi/matrix_mul <br>$ make<br>$ sh run.sh<br></code></pre></td></tr></table></figure><p>Output: &gt; start: 23/05/04 10:59:07.161 &gt; &gt; ./matrix_mul_dpc &gt; Device: Intel(R) xxxx(xx) ix-xxxxS CPU @ x.xxGHz &gt; Problem size: c(150,600) = a(150,300) * b(300,600) &gt; Result of matrix multiplication using SYCL: Success - The results are correct! &gt; &gt; end: 23/05/04 10:59:14.409</p><h2 id="compile-wrfv440-with-intel-oneapi">Compile WRFv440 with Intel OneAPI</h2><p>Ref: [WRF installation on a Linux-based machine]</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">source</span> /home/wpsze/intel/oneapi/setvars.sh<br><span class="hljs-built_in">export</span> PATH=/home/wpsze/intel/oneapi/compiler/2023.1.0/linux/bin/intel64/:<span class="hljs-variable">$PATH</span><br><span class="hljs-built_in">export</span> LD_LIBRARY_PATH=/home/wpsze/intel/oneapi/compiler/2023.1.0/linux/lib/intel64/:<span class="hljs-variable">$LD_LIBRARY_PATH</span><br><br>gcc --version<br>gfortran --version<br><br>icx --version<br>ifort --version<br><br><span class="hljs-comment"># Intel (serial or dmpar)</span><br></code></pre></td></tr></table></figure><p>If it is sucessful, the following exe will be gnerated, <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sh">==========================================================================<br>---&gt;                  Executables successfully built                  &lt;---<br> main/ndown.exe<br> main/real.exe<br> main/tc.exe<br> main/wrf.exe<br>==========================================================================<br>wrf_install/WPS-4.4/geogrid.exe -&gt; geogrid/src/geogrid.exe*<br>wrf_install/WPS-4.4/ungrib.exe -&gt; ungrib/src/ungrib.exe*<br>==========================================================================<br></code></pre></td></tr></table></figure></p>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>HPC</tag>
      
      <tag>WRF</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Tmux terminal multiplexer</title>
    <link href="/2023/05/01/Tmux_terminal_multiplexer/"/>
    <url>/2023/05/01/Tmux_terminal_multiplexer/</url>
    
    <content type="html"><![CDATA[<h1 id="tmux-terminal-multiplexer">Tmux terminal multiplexer</h1><p><strong>tmux</strong> is a terminal multiplexer: it enables a number of terminals to be created, accessed, and controlled from a single screen. tmux may be detached from a screen and continue running in the background, then later reattached.</p><p>This release runs on OpenBSD, FreeBSD, NetBSD, Linux, macOS and Solaris.</p><p><a href="https://github.com/tmux/tmux">Git tmux</a></p><h2 id="dependencies">Dependencies</h2><ul><li>tmux depends on <strong>libevent 2.x</strong>, available from <a href="https://github.com/libevent/libevent/releases/latest">this page</a>.</li><li>It also depends on <strong>ncurses</strong>, available from <a href="https://invisible-mirror.net/archives/ncurses/">this page</a>. To build tmux, a C compiler (for example gcc or clang), make, pkg-config and a suitable yacc (yacc or bison) are needed.</li></ul><h2 id="installation">Installation</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">git <span class="hljs-built_in">clone</span> https://github.com/tmux/tmux.git<br><span class="hljs-built_in">cd</span> tmux<br>sh autogen.sh<br>./configure &amp;&amp; make<br></code></pre></td></tr></table></figure><h2 id="edit-.tmux.conf">Edit .tmux.conf</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># prefix setting (screen-like)</span><br><span class="hljs-built_in">set</span> -g prefix C-a<br>unbind C-b<br><span class="hljs-built_in">bind</span> C-a send-prefix<br><br><span class="hljs-comment"># Use the mouse</span><br><span class="hljs-built_in">set</span> -g mouse on<br><br><span class="hljs-built_in">bind</span> | split-window -h<br><span class="hljs-built_in">bind</span> - split-window -v<br><br><span class="hljs-comment"># History-limit</span><br><span class="hljs-built_in">set</span> -g history-limit 30000<br><br><span class="hljs-built_in">bind</span> -r ^Up select-pane -U<br><span class="hljs-built_in">bind</span> -r ^Down select-pane -D<br><span class="hljs-built_in">bind</span> -r ^Left select-pane -L<br><span class="hljs-built_in">bind</span> -r ^Right select-pane -R<br><br><span class="hljs-built_in">set</span> -g default-terminal <span class="hljs-string">&quot;xterm-256color&quot;</span><br></code></pre></td></tr></table></figure><h2 id="usage">Usage</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># Add new seession</span><br>tmux new -s &lt;session-name&gt;<br><br><span class="hljs-comment"># Detach</span><br>tmux detach<br><br><span class="hljs-comment"># List all sessions</span><br>tmux <span class="hljs-built_in">ls</span><br><br><span class="hljs-comment"># Attach a session</span><br>tmux a -t &lt;session-name&gt;<br><br><span class="hljs-comment"># rename session, </span><br>tmux rename-session -t &lt;old-session-name&gt; &lt;new-session-name&gt;<br><br><span class="hljs-comment"># Reload the current Tmux configuration</span><br>tmux source-file ~/.tmux.conf<br></code></pre></td></tr></table></figure><p>Actions <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># Move bewteen panes</span><br>C trl + A (up,down,lef,right)<br><br><span class="hljs-comment"># the window into two panes horizontally.</span><br>Ctrl + A —<br><br><span class="hljs-comment"># Split the window into two panes vertically.</span><br>Ctrl + A |<br><br><span class="hljs-comment"># Ctrl+B X — Close pane.</span><br>Ctrl + A X<br></code></pre></td></tr></table></figure></p>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>HPC</tag>
      
      <tag>terminal</tag>
      
      <tag>tmux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>WRF | WPS build up domain</title>
    <link href="/2023/05/01/WPS_build_up_domain/"/>
    <url>/2023/05/01/WPS_build_up_domain/</url>
    
    <content type="html"><![CDATA[<h1 id="wps-build-up-domain">WPS build up domain</h1><p><a href="https://www2.mmm.ucar.edu/wrf/users/special_code.html">WRF-Related Special Code</a></p><table><thead><tr class="header"><th style="text-align: left;">Function</th><th style="text-align: left;">source</th></tr></thead><tbody><tr class="odd"><td style="text-align: left;">Convert netCDF to Intermediate</td><td style="text-align: left;"><a href="https://www2.mmm.ucar.edu/wrf/src/netcdf-to-intermediate.f">netcdf-to-intermediate.f</a></td></tr><tr class="even"><td style="text-align: left;">NCL Design Grids</td><td style="text-align: left;"><a href="https://www2.mmm.ucar.edu/wrf/src/design_grids.ncl">design_grids.ncl</a></td></tr><tr class="odd"><td style="text-align: left;">Convert netCDF to Intermediate (CCSM Data)</td><td style="text-align: left;"><a href="https://www2.mmm.ucar.edu/wrf/src/ccsm2IM.tar.gz">tar file</a></td></tr><tr class="even"><td style="text-align: left;">wrf2grads</td><td style="text-align: left;"><a href="https://www2.mmm.ucar.edu/wrf/src/wrf2grads.tar.gz">csh script</a></td></tr><tr class="odd"><td style="text-align: left;">Hurricane Dorian Test Case</td><td style="text-align: left;"><a href="https://www2.mmm.ucar.edu/wrf/src/dorian_test_case.tar.gz">dorian_test_case.tar.gz</a></td></tr></tbody></table><p>The most useful here is <strong>design_grids.ncl</strong></p><blockquote><p>You provide lat/lon/dx/dy and then it will generate WPS domain config.</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/bash</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># https://www2.mmm.ucar.edu/wrf/users/tutorial/presentation_pdfs/202101/werner_data_util_pp.pdf P.19</span><br><span class="hljs-comment"># https://www2.mmm.ucar.edu/wrf/users/special_code.html</span><br><span class="hljs-comment">#</span><br><br><span class="hljs-built_in">source</span> /home/wpsze/anaconda3/bin/activate ncl<br>ncl design_grids.ncl<br><br></code></pre></td></tr></table></figure><p>and design_grids.ncl is like as below,</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br></pre></td><td class="code"><pre><code class="hljs sh">;   Script display location of model domains<br>;   Only works <span class="hljs-keyword">for</span> ARW domains<br>;   Reads namelist file directly<br><br>load <span class="hljs-string">&quot;<span class="hljs-variable">$NCARG_ROOT</span>/lib/ncarg/nclscripts/csm/gsn_code.ncl&quot;</span><br>load <span class="hljs-string">&quot;<span class="hljs-variable">$NCARG_ROOT</span>/lib/ncarg/nclscripts/wrf/WRFUserARW.ncl&quot;</span><br>;load <span class="hljs-string">&quot;./WRFUserARW.ncl&quot;</span><br><br>begin<br>;<br><br>; We generate plots, but what kind <span class="hljs-keyword">do</span> we prefer?<br>; <span class="hljs-built_in">type</span> = <span class="hljs-string">&quot;x11&quot;</span><br>; <span class="hljs-built_in">type</span> = <span class="hljs-string">&quot;pdf&quot;</span><br>; <span class="hljs-built_in">type</span> = <span class="hljs-string">&quot;ps&quot;</span><br>; <span class="hljs-built_in">type</span> = <span class="hljs-string">&quot;ncgm&quot;</span><br>  <span class="hljs-built_in">type</span> = <span class="hljs-string">&quot;png&quot;</span><br>  wks = gsn_open_wks(<span class="hljs-built_in">type</span>,<span class="hljs-string">&quot;wps_show_dom&quot;</span>)<br><br>; Set the colors to be used<br>  colors = (/<span class="hljs-string">&quot;white&quot;</span>,<span class="hljs-string">&quot;black&quot;</span>,<span class="hljs-string">&quot;White&quot;</span>,<span class="hljs-string">&quot;ForestGreen&quot;</span>,<span class="hljs-string">&quot;DeepSkyBlue&quot;</span>,<span class="hljs-string">&quot;Red&quot;</span>,<span class="hljs-string">&quot;Blue&quot;</span>/)<br>  gsn_define_colormap(wks, colors)  <br><br><br>; Set some map information ; line and text information<br>  mpres = True<br>  mpres@mpFillOn = True<br>  mpres@mpFillColors  = (/<span class="hljs-string">&quot;background&quot;</span>,<span class="hljs-string">&quot;DeepSkyBlue&quot;</span>,<span class="hljs-string">&quot;ForestGreen&quot;</span>,<span class="hljs-string">&quot;DeepSkyBlue&quot;</span>, <span class="hljs-string">&quot;transparent&quot;</span>/)<br>  mpres@mpGeophysicalLineColor      = <span class="hljs-string">&quot;Black&quot;</span><br>  mpres@mpGridLineColor             = <span class="hljs-string">&quot;Black&quot;</span><br>  mpres@mpLimbLineColor             = <span class="hljs-string">&quot;Black&quot;</span><br>  mpres@mpNationalLineColor         = <span class="hljs-string">&quot;Black&quot;</span><br>  mpres@mpPerimLineColor            = <span class="hljs-string">&quot;Black&quot;</span><br>  mpres@mpUSStateLineColor          = <span class="hljs-string">&quot;Black&quot;</span><br>  mpres@mpGridSpacingF              = 1<br>  mpres@tiMainString                = <span class="hljs-string">&quot; WPS Domain Configuration  &quot;</span><br><br>  lnres = True <br>  lnres@gsLineThicknessF = 2.5<br>  lnres@domLineColors    = (/ <span class="hljs-string">&quot;white&quot;</span>, <span class="hljs-string">&quot;Red&quot;</span> , <span class="hljs-string">&quot;Red&quot;</span> , <span class="hljs-string">&quot;Blue&quot;</span> /)<br><br>  txres = True<br>  txres@txFont = <span class="hljs-string">&quot;helvetica-bold&quot;</span><br>  ;txres@txJust = <span class="hljs-string">&quot;BottomLeft&quot;</span><br>  txres@txJust = <span class="hljs-string">&quot;TopLeft&quot;</span><br>  txres@txPerimOn = False<br>  txres@txFontHeightF = 0.015<br><br>;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;<br>DOMS = 3<br>DX = 50.<br><br>MAP = <span class="hljs-string">&quot;lambert&quot;</span><br><br>;MAP = <span class="hljs-string">&quot;mercator&quot;</span><br><br>;LAT1 = (/ -47., -39., -27. /); original lambert grids<br>;LAT2 = (/ -10., -18., -23. /)<br>;LON1 = (/ 113., 119., 126. /)<br>;LON2 = (/ 164., 157., 132. /)<br><br>LAT1 = (/ 2.23, 19.94, 21.5 /); modified mercator grids<br>LAT2 = (/ 43.82, 27.09, 23.83 /)<br>LON1 = (/ 85.81, 110.68, 112.51/)<br>LON2 = (/ 140.05, 117.60, 115.04/)<br><br>;LAT1 = (/ -35.0, -45., -27. /); Yasi Domains<br>;LAT2 = (/   0., -20., -23. /)<br>;LON1 = (/ 131., 121., 125./)<br>;LON2 = (/ 171., 159., 131./)<br>;LAT1 = (/ -43.0, -45., -27. /); Yasi Domains<br>;LAT2 = (/   5., -20., -23. /)<br>;LON1 = (/  95., 121., 125./)<br>;LON2 = (/ 179., 159., 131./)<br>parent_id = (/ 1, 1, 2 /)<br>parent_grid_ratio = (/ 1, 3, 3 /)<br><br>std_truelats = False<br><br>;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;<br>; Do not change anything between the <span class="hljs-string">&quot;;;;;;&quot;</span> lines<br><br>  mpres@max_dom   = DOMS<br>  mpres@map_proj  = MAP<br>  mpres@dx        = DX*1000.<br>  mpres@dy        = DX*1000.<br>  mpres@ref_lat   = LAT1(0) + (LAT2(0)-LAT1(0))/2.<br>  mpres@ref_lon   = LON1(0) + (LON2(0)-LON1(0))/2.<br>  mpres@stand_lon = mpres@ref_lon<br>  <br>  <span class="hljs-keyword">if</span> (MAP .eq. <span class="hljs-string">&quot;lambert&quot;</span>) <span class="hljs-keyword">then</span><br>    <span class="hljs-keyword">if</span> ( std_truelats ) <span class="hljs-keyword">then</span><br>      <span class="hljs-keyword">if</span> (LAT1(0) .gt. 0.) <span class="hljs-keyword">then</span><br>        mpres@truelat1 = 30.<br>        mpres@truelat2 = 60.<br>      <span class="hljs-keyword">else</span><br>        mpres@truelat1 = -30.<br>        mpres@truelat2 = -60.<br>      end <span class="hljs-keyword">if</span><br>    <span class="hljs-keyword">else</span><br>      truelat1 = floattoint(LAT1(0) + (LAT2(0)-LAT1(0))/3)<br>      truelat2 = floattoint(truelat1 + (LAT2(0)-LAT1(0))/3)<br>      mpres@truelat1 = int2flt(truelat1)<br>      mpres@truelat2 = int2flt(truelat2)<br>    end <span class="hljs-keyword">if</span><br>  end <span class="hljs-keyword">if</span><br>  <span class="hljs-keyword">if</span> (MAP .eq. <span class="hljs-string">&quot;mercator&quot;</span>) <span class="hljs-keyword">then</span><br>    mpres@truelat2 = 0.<br>    <span class="hljs-keyword">if</span> ( std_truelats ) <span class="hljs-keyword">then</span><br>      mpres@truelat1 = 0.<br>    <span class="hljs-keyword">else</span><br>      truelat1 = floattoint(mpres@ref_lat)<br>      mpres@truelat1 = int2flt(truelat1)<br>    end <span class="hljs-keyword">if</span><br>  end <span class="hljs-keyword">if</span><br><br>  e_we = new ( DOMS, <span class="hljs-built_in">integer</span> ) <br>  e_sn = new ( DOMS, <span class="hljs-built_in">integer</span> ) <br>  e_we(0) = floattoint((LON2(<span class="hljs-number">0</span>)-LON1(<span class="hljs-number">0</span>))*111./DX)<br>  e_sn(0) = floattoint((LAT2(<span class="hljs-number">0</span>)-LAT1(<span class="hljs-number">0</span>))*111./DX)<br>  centeri = e_we(0)/2 + 1<br>  centerj = e_sn(0)/2 + 1<br><br>  i_parent_start = new ( DOMS, <span class="hljs-built_in">integer</span> ) <br>  j_parent_start = new ( DOMS, <span class="hljs-built_in">integer</span> ) <br>  i_parent_start(0) = 1<br>  j_parent_start(0) = 1<br><br>  ;<span class="hljs-built_in">print</span>(mpres)<br>  ;<span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Number of grid points &quot;</span> + e_we(0) + <span class="hljs-string">&quot; &quot;</span> + e_sn(0) )<br><br><br>  <span class="hljs-keyword">if</span> ( DOMS .gt. 1 ) <span class="hljs-keyword">then</span><br><br>    mpres@parent_id         = parent_id<br>    mpres@parent_grid_ratio = parent_grid_ratio<br><br>    res = True<br>    <span class="hljs-keyword">if</span> (MAP .eq. <span class="hljs-string">&quot;lambert&quot;</span>) <span class="hljs-keyword">then</span><br>      res@MAP_PROJ  = 1<br>    end <span class="hljs-keyword">if</span><br>    <span class="hljs-keyword">if</span> (MAP .eq. <span class="hljs-string">&quot;mercator&quot;</span>) <span class="hljs-keyword">then</span><br>      res@MAP_PROJ  = 3<br>    end <span class="hljs-keyword">if</span><br>    res@TRUELAT1  = mpres@truelat1<br>    res@TRUELAT2  = mpres@truelat2<br>    res@STAND_LON = mpres@stand_lon<br>    res@DX        = mpres@dx<br>    res@DY        = mpres@dy<br>    res@REF_LAT   = mpres@ref_lat<br>    res@REF_LON   = mpres@ref_lon<br>    res@KNOWNI    = centeri<br>    res@KNOWNJ    = centerj<br><br>    ratio = 1<br>    ratio_start = 1<br>    istart = 1<br>    jstart = 1<br>    <span class="hljs-keyword">do</span> ii=1,DOMS-1<br>      ratio = ratio * parent_grid_ratio(ii)<br>      loc = wrf_ll_to_ij (LON1(ii),LAT1(ii),res)<br>      loci1 = new(dimsizes(loc),<span class="hljs-built_in">integer</span>)<br>      loci1 = tointeger(loc + .5)<br>      loci1!0 = loc!0<br>      ;<span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;DOM=&quot;</span>+ii + <span class="hljs-string">&quot;  start &quot;</span> + loci1)<br>      loc = wrf_ll_to_ij (LON2(ii),LAT2(ii),res)<br>      loci2 = new(dimsizes(loc),<span class="hljs-built_in">integer</span>)<br>      loci2 = tointeger(loc + .5)<br>      loci2!0 = loc!0<br>      ;<span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;DOM=&quot;</span>+ii + <span class="hljs-string">&quot;    end &quot;</span> + loci2)<br>      e_we(ii) = (loci2(0)-loci1(0))*ratio + 1<br>      e_sn(ii) = (loci2(1)-loci1(1))*ratio + 1<br>      istart = (loci1(0) - istart + 1)*ratio_start<br>      jstart = (loci1(1) - jstart + 1)*ratio_start<br>      i_parent_start(ii) = istart<br>      j_parent_start(ii) = jstart<br>      ;<span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Number of grid points &quot;</span> + e_we(ii) + <span class="hljs-string">&quot; &quot;</span> + e_sn(ii) )<br>      ;<span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Start locations &quot;</span> + istart + <span class="hljs-string">&quot; &quot;</span> + jstart)<br>      ratio_start = ratio<br>    end <span class="hljs-keyword">do</span><br>   <br>  end <span class="hljs-keyword">if</span><br><br>  <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Suggested namelist options&quot;</span>)<br>  xxx = <span class="hljs-string">&quot;parent_id =&quot;</span><br>  <span class="hljs-keyword">do</span> ii=0,DOMS-1<br>    xxx = xxx + <span class="hljs-string">&quot; &quot;</span> + parent_id(ii) + <span class="hljs-string">&quot;,&quot;</span><br>  end <span class="hljs-keyword">do</span><br>  <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot; &quot;</span> + xxx)<br>  xxx = <span class="hljs-string">&quot;parent_grid_ratio =&quot;</span><br>  <span class="hljs-keyword">do</span> ii=0,DOMS-1<br>    xxx = xxx + <span class="hljs-string">&quot; &quot;</span> + parent_grid_ratio(ii) + <span class="hljs-string">&quot;,&quot;</span><br>  end <span class="hljs-keyword">do</span><br>  <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot; &quot;</span> + xxx)<br>  xxx = <span class="hljs-string">&quot;i_parent_start =&quot;</span><br>  <span class="hljs-keyword">do</span> ii=0,DOMS-1<br>    xxx = xxx + <span class="hljs-string">&quot; &quot;</span> + i_parent_start(ii) + <span class="hljs-string">&quot;,&quot;</span><br>  end <span class="hljs-keyword">do</span><br>  <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot; &quot;</span> + xxx)<br>  xxx = <span class="hljs-string">&quot;j_parent_start =&quot;</span><br>  <span class="hljs-keyword">do</span> ii=0,DOMS-1<br>    xxx = xxx + <span class="hljs-string">&quot; &quot;</span> + j_parent_start(ii) + <span class="hljs-string">&quot;,&quot;</span><br>  end <span class="hljs-keyword">do</span><br>  <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot; &quot;</span> + xxx)<br>  xxx = <span class="hljs-string">&quot;e_we =&quot;</span><br>  <span class="hljs-keyword">do</span> ii=0,DOMS-1<br>    xxx = xxx + <span class="hljs-string">&quot; &quot;</span> + e_we(ii) + <span class="hljs-string">&quot;,&quot;</span><br>  end <span class="hljs-keyword">do</span><br>  <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot; &quot;</span> + xxx)<br>  xxx = <span class="hljs-string">&quot;e_sn =&quot;</span><br>  <span class="hljs-keyword">do</span> ii=0,DOMS-1<br>    xxx = xxx + <span class="hljs-string">&quot; &quot;</span> + e_sn(ii) + <span class="hljs-string">&quot;,&quot;</span><br>  end <span class="hljs-keyword">do</span><br>  <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot; &quot;</span> + xxx)<br>  <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot; dx = &quot;</span> + mpres@dx + <span class="hljs-string">&quot;,&quot;</span>)<br>  <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot; dy = &quot;</span> + mpres@dy + <span class="hljs-string">&quot;,&quot;</span>)<br>  <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot; map_proj = &#x27;&quot;</span> + mpres@map_proj + <span class="hljs-string">&quot;&#x27;,&quot;</span>)<br>  <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot; ref_lat = &quot;</span> + sprintf(<span class="hljs-string">&quot;%7.2f&quot;</span>,mpres@ref_lat) + <span class="hljs-string">&quot;,&quot;</span>)<br>  <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot; ref_lon = &quot;</span> + sprintf(<span class="hljs-string">&quot;%7.2f&quot;</span>,mpres@ref_lon) + <span class="hljs-string">&quot;,&quot;</span>)<br>  <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot; truelat1 = &quot;</span> + sprintf(<span class="hljs-string">&quot;%7.2f&quot;</span>,mpres@truelat1) + <span class="hljs-string">&quot;,&quot;</span>)<br>  <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot; truelat2 = &quot;</span> + sprintf(<span class="hljs-string">&quot;%7.2f&quot;</span>,mpres@truelat2) + <span class="hljs-string">&quot;,&quot;</span>)<br>  <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot; stand_lon = &quot;</span> + sprintf(<span class="hljs-string">&quot;%7.2f&quot;</span>,mpres@stand_lon) + <span class="hljs-string">&quot;,&quot;</span>)<br>  <br>  mpres@e_we = e_we<br>  mpres@e_sn = e_sn<br>  mpres@i_parent_start = i_parent_start<br>  mpres@j_parent_start = j_parent_start<br><br>  mp = wrf_wps_dom (wks,mpres,lnres,txres)<br>  pmres = True<br>  pmres@gsMarkerColor = <span class="hljs-string">&quot;White&quot;</span><br>  pmres@gsMarkerIndex = 16<br>  pmres@gsMarkerSizeF = 0.01<br>  gsn_polymarker(wks,mp,128.00,-25.00,pmres)<br>  frame(wks)   <br><br>;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;<br><br><br><br>end<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>WRF</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NWP</tag>
      
      <tag>WRF</tag>
      
      <tag>WPS</tag>
      
      <tag>domain</tag>
      
      <tag>ncl</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Bash &amp; Oh-My-Bash</title>
    <link href="/2023/05/01/bash_oh_my_bash/"/>
    <url>/2023/05/01/bash_oh_my_bash/</url>
    
    <content type="html"><![CDATA[<h1 id="bash-oh-my-bash">Bash &amp; Oh-My-Bash</h1><p>Ref:</p><ol type="1"><li><a href="https://www.cnblogs.com/nbtech/p/oh-my-bash.html">配置安装oh-my-bash</a></li><li><a href="https://github.com/ohmybash/oh-my-bash" class="uri">https://github.com/ohmybash/oh-my-bash</a></li><li><a href="https://github.com/ohmybash/oh-my-bash/tree/master/plugins">plugins</a></li><li><a href="https://github.com/ohmybash/oh-my-bash/wiki/Themes">Themes</a></li></ol><p><em>Oh My Bash</em> works best on macOS and Linux.</p><blockquote><p>Unix-like operating system (macOS or Linux)<br />curl or wget should be installed<br />git should be installed</p></blockquote><h2 id="check-shell-used">Check $SHELL used</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cat</span> /etc/shells<br><span class="hljs-comment">## /etc/shells: valid login shells</span><br><span class="hljs-comment"># /bin/sh</span><br><span class="hljs-comment"># /bin/bash</span><br><span class="hljs-comment"># /bin/rbash</span><br><span class="hljs-comment"># /bin/dash</span><br><span class="hljs-comment"># /bin/csh</span><br><span class="hljs-comment"># /bin/zsh</span><br><span class="hljs-comment"># /usr/bin/zsh</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$SHELL</span><br><span class="hljs-comment"># /bin/bash</span><br></code></pre></td></tr></table></figure><p>To change your shell.</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">chsh -s /bin/bash <span class="hljs-comment">## change to bash ##</span><br><span class="hljs-comment"># or</span><br><span class="hljs-built_in">exec</span> bash <span class="hljs-comment"># zsh</span><br></code></pre></td></tr></table></figure><h2 id="installation">Installation</h2><p>On the HOME dir, like /home/wpsze/</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">git <span class="hljs-built_in">clone</span> https://github.com/ohmybash/oh-my-bash.git<br><span class="hljs-built_in">mv</span> oh-my-bash-master .oh-my-bash<br><span class="hljs-built_in">cd</span> .oh-my-bash/<br><span class="hljs-built_in">chmod</span> +x oh-my-bash.sh<br></code></pre></td></tr></table></figure><p>Backup our .bashrc first, <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cp</span> ~/.bashrc ~/.bashrc.bak<br></code></pre></td></tr></table></figure></p><p>copy the oh-my-bash to .bashrc <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cp</span> ~/.oh-my-bash/templates/bashrc.osh-template ~/.bashrc<br></code></pre></td></tr></table></figure></p><p>source it, <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">source</span> ~/.bashrc<br></code></pre></td></tr></table></figure></p><p>The installation and use of oh-my-bash is very simple, and the use of oh-my-bash is similar to that of oh-my-zsh. There are functions such as auto-completion (ignoring case), history, and quick cd.</p><h2 id="theme">Theme</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">ls</span> .oh-my-bash/themes/<br>vim ~/.bashrc<br><span class="hljs-comment">#</span><br><span class="hljs-comment"># OSH_THEME=&quot;font&quot;</span><br><span class="hljs-comment"># or</span><br>OSH_THEME=<span class="hljs-string">&quot;simple&quot;</span><br></code></pre></td></tr></table></figure><p>and change theme like /home/wpsze/.oh-my-bash/themes/font/font.theme.sh <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">CLOCK_THEME_PROMPT_PREFIX=<span class="hljs-string">&#x27;[&#x27;</span><br>CLOCK_THEME_PROMPT_SUFFIX=<span class="hljs-string">&#x27;]&#x27;</span><br><br><span class="hljs-built_in">local</span> hostname=<span class="hljs-string">&quot;<span class="hljs-variable">$&#123;_omb_prompt_bold_green&#125;</span>\u@\h&quot;</span><br></code></pre></td></tr></table></figure></p><h2 id="absolute-path">absolute path</h2><p>How can I display the absolute path in bash prompt? <a href="https://superuser.com/questions/202212/how-can-i-display-the-absolute-path-in-bash-prompt" class="uri">https://superuser.com/questions/202212/how-can-i-display-the-absolute-path-in-bash-prompt</a></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># PS1=&#x27;\u@\h:\w\$ &#x27;</span><br><span class="hljs-comment"># Replace the &quot;\w&quot; with &quot;\$PWD&quot;</span><br><span class="hljs-comment"># PS1=[\u@\h ]\$PWD$</span><br>PS1=<span class="hljs-string">&quot;<span class="hljs-subst">$(clock_prompt)</span>$python_venv<span class="hljs-variable">$&#123;hostname&#125;</span>:<span class="hljs-variable">$&#123;_omb_prompt_bold_teal&#125;</span>\$&#123;PWD&#125; <span class="hljs-subst">$(scm_prompt_char_info)</span><span class="hljs-variable">$&#123;ret_status&#125;</span>$ <span class="hljs-variable">$&#123;_omb_prompt_normal&#125;</span>&quot;</span><br></code></pre></td></tr></table></figure><p>The key here is <strong>* gives the full path while </strong>* gives only the directory.</p><h2 id="conda-initialize">conda initialize</h2><p>Add the following into .bashrc</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># &gt;&gt;&gt; conda initialize &gt;&gt;&gt;</span><br><span class="hljs-comment"># !! Contents within this block are managed by &#x27;conda init&#x27; !!</span><br>__conda_setup=<span class="hljs-string">&quot;<span class="hljs-subst">$(&#x27;/home/wpsze/anaconda3/bin/conda&#x27; &#x27;shell.bash&#x27; &#x27;hook&#x27; 2&gt; /dev/null)</span>&quot;</span><br><span class="hljs-keyword">if</span> [ $? -eq 0 ]; <span class="hljs-keyword">then</span><br>    <span class="hljs-built_in">eval</span> <span class="hljs-string">&quot;<span class="hljs-variable">$__conda_setup</span>&quot;</span><br><span class="hljs-keyword">else</span><br>    <span class="hljs-keyword">if</span> [ -f <span class="hljs-string">&quot;/home/wpsze/anaconda3/etc/profile.d/conda.sh&quot;</span> ]; <span class="hljs-keyword">then</span><br>        . <span class="hljs-string">&quot;/home/wpsze/anaconda3/etc/profile.d/conda.sh&quot;</span><br>    <span class="hljs-keyword">else</span><br>        <span class="hljs-built_in">export</span> PATH=<span class="hljs-string">&quot;/home/wpsze/anaconda3/bin:<span class="hljs-variable">$PATH</span>&quot;</span><br>    <span class="hljs-keyword">fi</span><br><span class="hljs-keyword">fi</span><br><span class="hljs-built_in">unset</span> __conda_setup<br><span class="hljs-comment"># &lt;&lt;&lt; conda initialize &lt;&lt;&lt;</span><br></code></pre></td></tr></table></figure><h2 id="history-of-most-recent-directories">History of most recent directories</h2><p>Looks like a history of most recent directories you've been in. <strong>which d</strong> identifies it as an alias to <strong>dirs</strong> shell builtin, which prints the contents of the directory stack. Just tried it and number keys allow to move to respective directory.</p><p><strong>dirs</strong> command shell builtin is used to display the list of currently remembered directories. By default, it includes the directory you are currently in. A directory can get into the list via pushd command followed by the dir name and can be removed via popd command.</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ <span class="hljs-built_in">dirs</span> -v | <span class="hljs-built_in">head</span> -n 10<br><span class="hljs-comment"># 0 ~</span><br><span class="hljs-comment"># 1 ~/.oh-my-bash/themes/font</span><br><span class="hljs-comment"># 2 ~/.oh-my-bash/themes</span><br><span class="hljs-comment"># ...</span><br><br><span class="hljs-comment">## Select number above will jump to that direcotry</span><br>$ 1<br>.oh-my-bash/themes/font $ <br></code></pre></td></tr></table></figure><h3 id="add-it-to-.bashrc">add it to .bashrc</h3><p>refer to <a href="https://github.com/ohmyzsh/ohmyzsh/blob/master/lib/directories.zsh">zsh directories.zsh</a> here dl() function name can be defined by yourself. <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">dl</span></span>() &#123;<br>    <span class="hljs-built_in">dirs</span> -v | <span class="hljs-built_in">head</span> -n 10<br>&#125;<br></code></pre></td></tr></table></figure> Remark: In .oh-my-bash/lib/directories.sh New package may be false on this function as <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">OMB_DIRECTORIES_CD_USE_PUSHD=<span class="hljs-literal">true</span> <span class="hljs-comment">#false</span><br></code></pre></td></tr></table></figure> Set as <strong>ture</strong></p><h2 id="autojump---a-faster-way-to-navigate-your-filesystem">autojump - a faster way to navigate your filesystem</h2><p><a href="https://github.com/wting/autojump">Git autojump</a></p><h2 id="ble.sh-bash-line-editor">ble.sh ― Bash Line Editor</h2><h3 id="autosuggestions">autosuggestions</h3><p><a href="https://github.com/akinomyoga/ble.sh">Git ble.sh</a></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># TRIAL without installation</span><br><br>wget -O - https://github.com/akinomyoga/ble.sh/releases/download/nightly/ble-nightly.tar.xz | tar xJf -<br><span class="hljs-built_in">source</span> ble-nightly/ble.sh<br><br><span class="hljs-comment"># Quick INSTALL to BASHRC (If this doesn&#x27;t work, please follow Sec 1.3)</span><br><br>wget -O - https://github.com/akinomyoga/ble.sh/releases/download/nightly/ble-nightly.tar.xz | tar xJf -<br><span class="hljs-built_in">mkdir</span> -p ~/.local/share/blesh<br><span class="hljs-built_in">cp</span> -Rf ble-nightly/* ~/.local/share/blesh/<br><span class="hljs-built_in">rm</span> -rf ble-nightly<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;source ~/.local/share/blesh/ble.sh&#x27;</span> &gt;&gt; ~/.bashrc<br></code></pre></td></tr></table></figure><h2 id="whole-.bashrc">Whole .bashrc</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># Enable the subsequent settings only in interactive sessions</span><br><span class="hljs-keyword">case</span> $- <span class="hljs-keyword">in</span><br>  *i*) ;;<br>    *) <span class="hljs-built_in">return</span>;;<br><span class="hljs-keyword">esac</span><br><br><span class="hljs-comment"># Path to your oh-my-bash installation.</span><br><span class="hljs-built_in">export</span> OSH=~/.oh-my-bash<br><br><span class="hljs-comment"># Set name of the theme to load. Optionally, if you set this to &quot;random&quot;</span><br><span class="hljs-comment"># it&#x27;ll load a random theme each time that oh-my-bash is loaded.</span><br>OSH_THEME=<span class="hljs-string">&quot;font&quot;</span><br><br><span class="hljs-comment"># Uncomment the following line to use case-sensitive completion.</span><br><span class="hljs-comment"># OMB_CASE_SENSITIVE=&quot;true&quot;</span><br><br><span class="hljs-comment"># Uncomment the following line to use hyphen-insensitive completion. Case</span><br><span class="hljs-comment"># sensitive completion must be off. _ and - will be interchangeable.</span><br><span class="hljs-comment"># OMB_HYPHEN_SENSITIVE=&quot;false&quot;</span><br><br><span class="hljs-comment"># Uncomment the following line to disable bi-weekly auto-update checks.</span><br><span class="hljs-comment"># DISABLE_AUTO_UPDATE=&quot;true&quot;</span><br><br><span class="hljs-comment"># Uncomment the following line to change how often to auto-update (in days).</span><br><span class="hljs-comment"># export UPDATE_OSH_DAYS=13</span><br><br><span class="hljs-comment"># Uncomment the following line to disable colors in ls.</span><br><span class="hljs-comment"># DISABLE_LS_COLORS=&quot;true&quot;</span><br><br><span class="hljs-comment"># Uncomment the following line to disable auto-setting terminal title.</span><br><span class="hljs-comment"># DISABLE_AUTO_TITLE=&quot;true&quot;</span><br><br><span class="hljs-comment"># Uncomment the following line to enable command auto-correction.</span><br><span class="hljs-comment"># ENABLE_CORRECTION=&quot;true&quot;</span><br><br><span class="hljs-comment"># Uncomment the following line to display red dots whilst waiting for completion.</span><br><span class="hljs-comment"># COMPLETION_WAITING_DOTS=&quot;true&quot;</span><br><br><span class="hljs-comment"># Uncomment the following line if you want to disable marking untracked files</span><br><span class="hljs-comment"># under VCS as dirty. This makes repository status check for large repositories</span><br><span class="hljs-comment"># much, much faster.</span><br><span class="hljs-comment"># DISABLE_UNTRACKED_FILES_DIRTY=&quot;true&quot;</span><br><br><span class="hljs-comment"># Uncomment the following line if you want to change the command execution time</span><br><span class="hljs-comment"># stamp shown in the history command output.  One of the following values can</span><br><span class="hljs-comment"># be used to specify the timestamp format.</span><br><span class="hljs-comment"># * &#x27;mm/dd/yyyy&#x27;     # mm/dd/yyyy + time</span><br><span class="hljs-comment"># * &#x27;dd.mm.yyyy&#x27;     # dd.mm.yyyy + time</span><br><span class="hljs-comment"># * &#x27;yyyy-mm-dd&#x27;     # yyyy-mm-dd + time</span><br><span class="hljs-comment"># * &#x27;[mm/dd/yyyy]&#x27;   # [mm/dd/yyyy] + [time] with colors</span><br><span class="hljs-comment"># * &#x27;[dd.mm.yyyy]&#x27;   # [dd.mm.yyyy] + [time] with colors</span><br><span class="hljs-comment"># * &#x27;[yyyy-mm-dd]&#x27;   # [yyyy-mm-dd] + [time] with colors</span><br><span class="hljs-comment"># If not set, the default value is &#x27;yyyy-mm-dd&#x27;.</span><br><span class="hljs-comment"># HIST_STAMPS=&#x27;yyyy-mm-dd&#x27;</span><br><br><span class="hljs-comment"># Uncomment the following line if you do not want OMB to overwrite the existing</span><br><span class="hljs-comment"># aliases by the default OMB aliases defined in lib/*.sh</span><br><span class="hljs-comment"># OMB_DEFAULT_ALIASES=&quot;check&quot;</span><br><br><span class="hljs-comment"># Would you like to use another custom folder than $OSH/custom?</span><br><span class="hljs-comment"># OSH_CUSTOM=/path/to/new-custom-folder</span><br><br><span class="hljs-comment"># To disable the uses of &quot;sudo&quot; by oh-my-bash, please set &quot;false&quot; to</span><br><span class="hljs-comment"># this variable.  The default behavior for the empty value is &quot;true&quot;.</span><br>OMB_USE_SUDO=<span class="hljs-literal">true</span><br><br><span class="hljs-comment"># To enable/disable display of Python virtualenv and condaenv</span><br><span class="hljs-comment"># OMB_PROMPT_SHOW_PYTHON_VENV=true  # enable</span><br><span class="hljs-comment"># OMB_PROMPT_SHOW_PYTHON_VENV=false # disable</span><br><br><span class="hljs-comment"># Which completions would you like to load? (completions can be found in ~/.oh-my-bash/completions/*)</span><br><span class="hljs-comment"># Custom completions may be added to ~/.oh-my-bash/custom/completions/</span><br><span class="hljs-comment"># Example format: completions=(ssh git bundler gem pip pip3)</span><br><span class="hljs-comment"># Add wisely, as too many completions slow down shell startup.</span><br>completions=(<br>  git<br>  ssh<br>)<br><br><span class="hljs-comment"># Which aliases would you like to load? (aliases can be found in ~/.oh-my-bash/aliases/*)</span><br><span class="hljs-comment"># Custom aliases may be added to ~/.oh-my-bash/custom/aliases/</span><br><span class="hljs-comment"># Example format: aliases=(vagrant composer git-avh)</span><br><span class="hljs-comment"># Add wisely, as too many aliases slow down shell startup.</span><br><span class="hljs-comment">#aliases=(</span><br><span class="hljs-comment">#  general</span><br><span class="hljs-comment">#)</span><br><br><span class="hljs-comment"># Which plugins would you like to load? (plugins can be found in ~/.oh-my-bash/plugins/*)</span><br><span class="hljs-comment"># Custom plugins may be added to ~/.oh-my-bash/custom/plugins/</span><br><span class="hljs-comment"># Example format: plugins=(rails git textmate ruby lighthouse)</span><br><span class="hljs-comment"># Add wisely, as too many plugins slow down shell startup.</span><br>plugins=(<br>  git<br>  bashmarks<br>)<br><br><span class="hljs-comment"># Which plugins would you like to conditionally load? (plugins can be found in ~/.oh-my-bash/plugins/*)</span><br><span class="hljs-comment"># Custom plugins may be added to ~/.oh-my-bash/custom/plugins/</span><br><span class="hljs-comment"># Example format:</span><br><span class="hljs-comment">#  if [ &quot;$DISPLAY&quot; ] || [ &quot;$SSH&quot; ]; then</span><br><span class="hljs-comment">#      plugins+=(tmux-autoattach)</span><br><span class="hljs-comment">#  fi</span><br><br><span class="hljs-built_in">source</span> <span class="hljs-string">&quot;<span class="hljs-variable">$OSH</span>&quot;</span>/oh-my-bash.sh<br><br><span class="hljs-comment"># User configuration</span><br><span class="hljs-comment"># export MANPATH=&quot;/usr/local/man:$MANPATH&quot;</span><br><br><span class="hljs-comment"># You may need to manually set your language environment</span><br><span class="hljs-comment"># export LANG=en_US.UTF-8</span><br><br><span class="hljs-comment"># Preferred editor for local and remote sessions</span><br><span class="hljs-comment"># if [[ -n $SSH_CONNECTION ]]; then</span><br><span class="hljs-comment">#   export EDITOR=&#x27;vim&#x27;</span><br><span class="hljs-comment"># else</span><br><span class="hljs-comment">#   export EDITOR=&#x27;mvim&#x27;</span><br><span class="hljs-comment"># fi</span><br><br><span class="hljs-comment"># Compilation flags</span><br><span class="hljs-comment"># export ARCHFLAGS=&quot;-arch x86_64&quot;</span><br><br><span class="hljs-comment"># ssh</span><br><span class="hljs-comment"># export SSH_KEY_PATH=&quot;~/.ssh/rsa_id&quot;</span><br><br><span class="hljs-comment"># Set personal aliases, overriding those provided by oh-my-bash libs,</span><br><span class="hljs-comment"># plugins, and themes. Aliases can be placed here, though oh-my-bash</span><br><span class="hljs-comment"># users are encouraged to define aliases within the OSH_CUSTOM folder.</span><br><span class="hljs-comment"># For a full list of active aliases, run `alias`.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Example aliases</span><br><span class="hljs-comment"># alias bashconfig=&quot;mate ~/.bashrc&quot;</span><br><span class="hljs-comment"># alias ohmybash=&quot;mate ~/.oh-my-bash&quot;</span><br><br><span class="hljs-comment">## &gt;&gt;&gt; conda initialize &gt;&gt;&gt;</span><br><span class="hljs-comment"># !! Contents within this block are managed by &#x27;conda init&#x27; !!</span><br>__conda_setup=<span class="hljs-string">&quot;<span class="hljs-subst">$(&#x27;/home/wpsze/anaconda3/bin/conda&#x27; &#x27;shell.bash&#x27; &#x27;hook&#x27; 2&gt; /dev/null)</span>&quot;</span><br><span class="hljs-keyword">if</span> [ $? -eq 0 ]; <span class="hljs-keyword">then</span><br>    <span class="hljs-built_in">eval</span> <span class="hljs-string">&quot;<span class="hljs-variable">$__conda_setup</span>&quot;</span><br><span class="hljs-keyword">else</span><br>    <span class="hljs-keyword">if</span> [ -f <span class="hljs-string">&quot;/home/wpsze/anaconda3/etc/profile.d/conda.sh&quot;</span> ]; <span class="hljs-keyword">then</span><br>        . <span class="hljs-string">&quot;/home/wpsze/anaconda3/etc/profile.d/conda.sh&quot;</span><br>    <span class="hljs-keyword">else</span><br>        <span class="hljs-built_in">export</span> PATH=<span class="hljs-string">&quot;/home/wpsze/anaconda3/bin:<span class="hljs-variable">$PATH</span>&quot;</span><br>    <span class="hljs-keyword">fi</span><br><span class="hljs-keyword">fi</span><br><span class="hljs-built_in">unset</span> __conda_setup<br><span class="hljs-comment"># &lt;&lt;&lt; conda initialize &lt;&lt;&lt;</span><br><br><span class="hljs-comment">## History of most recent directories and jump </span><br><span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">dl</span></span>()&#123;<br>    <span class="hljs-built_in">dirs</span> -v | <span class="hljs-built_in">head</span> -n 10<br>&#125;<br><br><span class="hljs-comment">##</span><br><span class="hljs-comment"># some more ls aliases</span><br><span class="hljs-built_in">alias</span> ll=<span class="hljs-string">&#x27;ls -alF&#x27;</span><br><span class="hljs-built_in">alias</span> la=<span class="hljs-string">&#x27;ls -A&#x27;</span><br><span class="hljs-built_in">alias</span> l=<span class="hljs-string">&#x27;ls -CF&#x27;</span><br><br><span class="hljs-comment"># statistic bash</span><br><span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">bash_stats</span></span>()&#123;<br>  <span class="hljs-built_in">fc</span> -l 1 \<br>    | awk <span class="hljs-string">&#x27;&#123; CMD[$2]++; count++; &#125; END &#123; for (a in CMD) print CMD[a] &quot; &quot; CMD[a]*100/count &quot;% &quot; a &#125;&#x27;</span> \<br>    | grep -v <span class="hljs-string">&quot;./&quot;</span> | <span class="hljs-built_in">sort</span> -nr | <span class="hljs-built_in">head</span> -n 20 | column -c3 -s <span class="hljs-string">&quot; &quot;</span> -t | <span class="hljs-built_in">nl</span><br>&#125;<br><br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>HPC</tag>
      
      <tag>shell script</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>neovim</title>
    <link href="/2023/05/01/neovim/"/>
    <url>/2023/05/01/neovim/</url>
    
    <content type="html"><![CDATA[<h1 id="neovim">neovim</h1><p><a href="https://github.com/neovim/neovim">Git neovim</a></p><h2 id="installation">Installation</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sh">git <span class="hljs-built_in">clone</span> https://github.com/neovim/neovim<br><span class="hljs-built_in">cd</span> neovim <br>make CMAKE_BUILD_TYPE=Release<br>git checkout stable<br><br><span class="hljs-built_in">rm</span> -r build/  <span class="hljs-comment"># clear the CMake cache</span><br><span class="hljs-comment"># To install the executable to a certain location, use:</span><br>make CMAKE_EXTRA_FLAGS=<span class="hljs-string">&quot;-DCMAKE_INSTALL_PREFIX=<span class="hljs-variable">$HOME</span>/shells_setup/neovim&quot;</span><br>make install<br><span class="hljs-built_in">export</span> PATH=<span class="hljs-string">&quot;<span class="hljs-variable">$HOME</span>/shells_setup/neovim/bin:<span class="hljs-variable">$PATH</span>&quot;</span><br></code></pre></td></tr></table></figure><p>make CMAKE_BUILD_TYPE=Release/Debug/RelWithDebInfo</p><p>The build type determines the level of used compiler optimizations and debug information: - <strong>Release</strong>: Full compiler optimizations and no debug information. Expect the best performance from this build type. Often used by package maintainers. - <strong>Debug</strong>: Full debug information; few optimizations. Use this for development to get meaningful output from debuggers like GDB or LLDB. This is the default if CMAKE_BUILD_TYPE is not specified. - <strong>RelWithDebInfo</strong> ("Release With Debug Info"): Enables many optimizations and adds enough debug info so that when Neovim ever crashes, you can still get a backtrace.</p><h2 id="edit-nvim-config">Edit nvim config</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">mkdir</span> ~/.config/nvim/<br>~/.config/nvim/init.vim<br></code></pre></td></tr></table></figure><h2 id="apple-others-config">Apple other's config</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">git <span class="hljs-built_in">clone</span> --depth=1 https://github.com/Avimitin/nvim.git ~/.config/nvim<br><span class="hljs-comment"># or</span><br><br></code></pre></td></tr></table></figure><h2 id="error">Error</h2><h3 id="binsh-2-cmake-not-found">/bin/sh: 2: cmake: not found</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">sudo</span> apt install gcc-multilib<br><span class="hljs-built_in">sudo</span> apt install cmake<br></code></pre></td></tr></table></figure><h3 id="could-not-find-gettext">Could NOT find Gettext</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">sudo</span> apt-get install -y gettext<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>HPC</tag>
      
      <tag>vim</tag>
      
      <tag>editor</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ERA5 dataset</title>
    <link href="/2023/04/30/ERA5_dataset/"/>
    <url>/2023/04/30/ERA5_dataset/</url>
    
    <content type="html"><![CDATA[<h1 id="era5-dataset">ERA5 dataset</h1><p>It is imperative to complete the registration process on the Copernicus Climate Data Store by creating an account.</p><p>Some related links,</p><p><a href="https://forum.mmm.ucar.edu/threads/wrf-using-era5-data.12116/">WRF using ERA5 data</a></p><ul><li><a href="https://cds.climate.copernicus.eu/">Climate Data Store - Copernicus</a></li><li><a href="https://rda.ucar.edu/datasets/ds633.0/dataaccess/">ERA5 (UCAR) ERA5 Reanalysis (0.25 Degree Latitude-Longitude Grid) ds633.0 DOI: 10.5065/BH6N-5N20</a></li><li><a href="https://cds.climate.copernicus.eu/cdsapp#!/dataset/reanalysis-era5-single-levels?tab=overview">ERA5 hourly data on single levels from 1940 to present</a></li><li><a href="https://cds.climate.copernicus.eu/cdsapp#!/dataset/reanalysis-era5-pressure-levels?tab=overview">ERA5 hourly data on pressure levels from 1940 to present</a></li></ul><h2 id="required-meteorological-fields-for-running-wrf">Required Meteorological Fields for Running WRF</h2><blockquote><p><a href="https://www2.mmm.ucar.edu/wrf/users/docs/user_guide_v4/v4.1/users_guide_chap3.html#_Required_Meteorological_Fields">user_guide_v4/v4.1/users_guide_chap3.html#_Required_Meteorological_Fields</a></p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs sh">3D Data (e.g. data on pressure levels)<br>Temperature<br>U and V components of Wind<br>Geopotential Height<br>Relative Humidity (the code can calculate RH <span class="hljs-keyword">if</span> Specific Humidity is available;this is controlled <span class="hljs-keyword">in</span> the Vtable)<br><br>2D Data<br>Surface Pressure<br>Mean Sea Level Pressure<br>Skin Temperature/SST<br>2-meter Temperature<br>2-meter Relative or Specific Humidity<br>10-meter U and V components of wind<br>Soil data (temperature and moisture) and soil height<br>If any masked field is ingested, <span class="hljs-keyword">then</span> a LANDSEA field is recommended<br>Water equivalent snow depth (SNOW) is a <span class="hljs-built_in">nice</span> field to have, but not required.<br>SEAICE is good to have <span class="hljs-keyword">for</span> a high latitude winter <span class="hljs-keyword">case</span>, but it is not required.<br></code></pre></td></tr></table></figure><h2 id="shell-script">Shell script</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/sh</span><br><span class="hljs-comment"># source requried packages</span><br><span class="hljs-built_in">source</span> /home/wpsze/anaconda3/bin/activate venv<br><br>yyyy=<span class="hljs-string">&#x27;2022&#x27;</span><br>mm=<span class="hljs-string">&#x27;06&#x27;</span><br><span class="hljs-built_in">dd</span>=<span class="hljs-string">&#x27;26&#x27;</span><br>hh=<span class="hljs-string">&#x27;18&#x27;</span><br><br><span class="hljs-keyword">for</span> next_hh <span class="hljs-keyword">in</span> $(<span class="hljs-built_in">seq</span> 0 3 36); <span class="hljs-keyword">do</span> <span class="hljs-comment"># Forecast time = 12, 24, 36, 48, 60, 72, 84, 96, 108, 130</span><br>NEXT_DATE=$(TZ=UTC <span class="hljs-built_in">date</span> -d <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;yyyy&#125;</span>-<span class="hljs-variable">$&#123;mm&#125;</span>-<span class="hljs-variable">$&#123;dd&#125;</span>T<span class="hljs-variable">$&#123;hh&#125;</span>:00:00Z +<span class="hljs-variable">$next_hh</span> hour&quot;</span> +%Y%m%d%H)<br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$&#123;NEXT_DATE&#125;</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;downloading &quot;</span> <span class="hljs-variable">$&#123;NEXT_DATE&#125;</span><br>SLoutfile=<span class="hljs-string">&quot;ERA5-0p25-SL-<span class="hljs-variable">$&#123;NEXT_DATE&#125;</span>.grib&quot;</span><br>PLoutfile=<span class="hljs-string">&quot;ERA5-0p25-PL-<span class="hljs-variable">$&#123;NEXT_DATE&#125;</span>.grib&quot;</span><br>resolution=<span class="hljs-string">&quot;0.25&quot;</span><br><br>python ERA5-sl.py <span class="hljs-variable">$&#123;NEXT_DATE&#125;</span> <span class="hljs-variable">$&#123;SLoutfile&#125;</span> <span class="hljs-variable">$&#123;resolution&#125;</span><br>python ERA5-pl.py <span class="hljs-variable">$&#123;NEXT_DATE&#125;</span> <span class="hljs-variable">$&#123;PLoutfile&#125;</span> <span class="hljs-variable">$&#123;resolution&#125;</span><br><span class="hljs-keyword">done</span><br></code></pre></td></tr></table></figure><h2 id="era5-sl.py">ERA5-sl.py</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python</span><br><span class="hljs-comment"># Retrieve ERA5 data on single levels(sl)</span><br><span class="hljs-keyword">import</span> argparse<br>parser = argparse.ArgumentParser()<br>parser.add_argument(<span class="hljs-string">&quot;datetime_string&quot;</span>, <span class="hljs-built_in">help</span>=<span class="hljs-string">&quot;Datetime string of the downloaded data in format YYYYMMDDHH&quot;</span>, <span class="hljs-built_in">type</span>=<span class="hljs-built_in">str</span>)<br>parser.add_argument(<span class="hljs-string">&quot;ofile&quot;</span>, <span class="hljs-built_in">help</span>=<span class="hljs-string">&quot;Output file of the downloaded data, e.g. ERA5-SL-YYYYMMDDHH.grib&quot;</span>, <span class="hljs-built_in">type</span>=<span class="hljs-built_in">str</span>)<br>parser.add_argument(<span class="hljs-string">&quot;resoln&quot;</span>, <span class="hljs-built_in">help</span>=<span class="hljs-string">&quot;Horizontal resolution of the downloaded data (in degree), e.g. 0.25&quot;</span>, <span class="hljs-built_in">type</span>=<span class="hljs-built_in">str</span>)<br>args = parser.parse_args()<br><br><span class="hljs-keyword">import</span> datetime<br>datetime_object = datetime.datetime.strptime(args.datetime_string, <span class="hljs-string">&quot;%Y%m%d%H&quot;</span>)<br>yyyy = datetime_object.strftime(<span class="hljs-string">&quot;%Y&quot;</span>)<br>mm = datetime_object.strftime(<span class="hljs-string">&quot;%m&quot;</span>)<br>dd = datetime_object.strftime(<span class="hljs-string">&quot;%d&quot;</span>)<br>hh = datetime_object.strftime(<span class="hljs-string">&quot;%H:00&quot;</span>)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;================&quot;</span>, args)<br><br><span class="hljs-keyword">import</span> sys<br><span class="hljs-keyword">import</span> logging<br><span class="hljs-keyword">import</span> cdsapi<br>c = cdsapi.Client()<br><span class="hljs-keyword">try</span>:<br>    c.retrieve(<br>        <span class="hljs-string">&quot;reanalysis-era5-single-levels&quot;</span>,<br>        &#123;<br>            <span class="hljs-string">&quot;product_type&quot;</span>: <span class="hljs-string">&quot;reanalysis&quot;</span>,<br>            <span class="hljs-string">&quot;format&quot;</span>: <span class="hljs-string">&quot;grib&quot;</span>,<br>            <span class="hljs-string">&quot;variable&quot;</span>: [<br>                <span class="hljs-string">&quot;10m_u_component_of_wind&quot;</span>,<br>                <span class="hljs-string">&quot;10m_v_component_of_wind&quot;</span>,<br>                <span class="hljs-string">&quot;2m_dewpoint_temperature&quot;</span>,<br>                <span class="hljs-string">&quot;2m_temperature&quot;</span>,<br>                <span class="hljs-string">&quot;land_sea_mask&quot;</span>,<br>                <span class="hljs-string">&quot;mean_sea_level_pressure&quot;</span>,<br>                <span class="hljs-string">&quot;sea_ice_cover&quot;</span>,<br>                <span class="hljs-string">&quot;sea_surface_temperature&quot;</span>,<br>                <span class="hljs-string">&quot;skin_temperature&quot;</span>,<br>                <span class="hljs-string">&quot;snow_density&quot;</span>,<br>                <span class="hljs-string">&quot;snow_depth&quot;</span>,<br>                <span class="hljs-string">&quot;soil_temperature_level_1&quot;</span>,<br>                <span class="hljs-string">&quot;soil_temperature_level_2&quot;</span>,<br>                <span class="hljs-string">&quot;soil_temperature_level_3&quot;</span>,<br>                <span class="hljs-string">&quot;soil_temperature_level_4&quot;</span>,<br>                <span class="hljs-string">&quot;surface_pressure&quot;</span>,<br>                <span class="hljs-string">&quot;volumetric_soil_water_layer_1&quot;</span>,<br>                <span class="hljs-string">&quot;volumetric_soil_water_layer_2&quot;</span>,<br>                <span class="hljs-string">&quot;volumetric_soil_water_layer_3&quot;</span>,<br>                <span class="hljs-string">&quot;volumetric_soil_water_layer_4&quot;</span>,<br><span class="hljs-string">&quot;geopotential&quot;</span><br>            ],<br>            <span class="hljs-string">&quot;grid&quot;</span>: [args.resoln, args.resoln],<br>            <span class="hljs-string">&quot;year&quot;</span>: yyyy,<br>            <span class="hljs-string">&quot;month&quot;</span>: [<br>                mm<br>            ],<br>            <span class="hljs-string">&quot;day&quot;</span>: [<br>                dd<br>            ],<br>            <span class="hljs-string">&quot;time&quot;</span>: [<br>                hh<br>            ],<br>        <span class="hljs-comment">#    &quot;area&quot;:[15, 90, 10, 120], # North, West, South, East. Default: global</span><br>        &#125;,<br>        args.ofile)<br><span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> err:<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">str</span>(err) == <span class="hljs-string">&quot;no data is available within your requested subset. Request returned no data.&quot;</span>:<br>        logging.exception(err)<br>        sys.exit(<span class="hljs-number">96</span>)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">raise</span> err<br></code></pre></td></tr></table></figure><blockquote><p>Remark: + geopotential? Yes for SOILHGT field not found in intermediate file ERA5</p></blockquote><h2 id="era5-pl.py">ERA5-pl.py</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/usr/bin/env python</span><br><span class="hljs-comment"># Retrieve ERA5 data on pressure level(pl)</span><br>import argparse<br>parser = argparse.ArgumentParser()<br>parser.add_argument(<span class="hljs-string">&quot;datetime_string&quot;</span>, <span class="hljs-built_in">help</span>=<span class="hljs-string">&quot;Datetime string of the downloaded data in format YYYYMMDDHH&quot;</span>, <span class="hljs-built_in">type</span>=str)<br>parser.add_argument(<span class="hljs-string">&quot;ofile&quot;</span>, <span class="hljs-built_in">help</span>=<span class="hljs-string">&quot;Output file of the downloaded data, e.g. ERA5-PL-YYYYMMDDHH.grib&quot;</span>, <span class="hljs-built_in">type</span>=str)<br>parser.add_argument(<span class="hljs-string">&quot;resoln&quot;</span>, <span class="hljs-built_in">help</span>=<span class="hljs-string">&quot;Horizontal resolution of the downloaded data (in degree), e.g. 0.25&quot;</span>, <span class="hljs-built_in">type</span>=str)<br>args = parser.parse_args()<br><br>import datetime<br>datetime_object = datetime.datetime.strptime(args.datetime_string, <span class="hljs-string">&quot;%Y%m%d%H&quot;</span>)<br>yyyy = datetime_object.strftime(<span class="hljs-string">&quot;%Y&quot;</span>)<br>mm = datetime_object.strftime(<span class="hljs-string">&quot;%m&quot;</span>)<br><span class="hljs-built_in">dd</span> = datetime_object.strftime(<span class="hljs-string">&quot;%d&quot;</span>)<br>hh = datetime_object.strftime(<span class="hljs-string">&quot;%H:00&quot;</span>)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;================&quot;</span>, args)<br><br>import sys<br>import logging<br>import cdsapi<br>c = cdsapi.Client()<br>try:<br>    c.retrieve(<br>        <span class="hljs-string">&quot;reanalysis-era5-pressure-levels&quot;</span>,<br>        &#123;<br>            <span class="hljs-string">&quot;product_type&quot;</span>: <span class="hljs-string">&quot;reanalysis&quot;</span>,<br>            <span class="hljs-string">&quot;format&quot;</span>: <span class="hljs-string">&quot;grib&quot;</span>,<br>            <span class="hljs-string">&quot;variable&quot;</span>: [<br>                <span class="hljs-string">&quot;geopotential&quot;</span>,<br>                <span class="hljs-string">&quot;relative_humidity&quot;</span>,<br>                <span class="hljs-string">&quot;specific_humidity&quot;</span>,<br>                <span class="hljs-string">&quot;temperature&quot;</span>,<br>                <span class="hljs-string">&quot;u_component_of_wind&quot;</span>,<br>                <span class="hljs-string">&quot;v_component_of_wind&quot;</span><br>            ],<br>            <span class="hljs-string">&quot;pressure_level&quot;</span>: [<br>                <span class="hljs-string">&#x27;1&#x27;</span>, <span class="hljs-string">&#x27;2&#x27;</span>, <span class="hljs-string">&#x27;3&#x27;</span>,<br>                <span class="hljs-string">&#x27;5&#x27;</span>, <span class="hljs-string">&#x27;7&#x27;</span>, <span class="hljs-string">&#x27;10&#x27;</span>,<br>                <span class="hljs-string">&#x27;20&#x27;</span>, <span class="hljs-string">&#x27;30&#x27;</span>, <span class="hljs-string">&#x27;50&#x27;</span>,<br>                <span class="hljs-string">&#x27;70&#x27;</span>, <span class="hljs-string">&#x27;100&#x27;</span>, <span class="hljs-string">&#x27;125&#x27;</span>,<br>                <span class="hljs-string">&#x27;150&#x27;</span>, <span class="hljs-string">&#x27;175&#x27;</span>, <span class="hljs-string">&#x27;200&#x27;</span>,<br>                <span class="hljs-string">&#x27;225&#x27;</span>, <span class="hljs-string">&#x27;250&#x27;</span>, <span class="hljs-string">&#x27;300&#x27;</span>,<br>                <span class="hljs-string">&#x27;350&#x27;</span>, <span class="hljs-string">&#x27;400&#x27;</span>, <span class="hljs-string">&#x27;450&#x27;</span>,<br>                <span class="hljs-string">&#x27;500&#x27;</span>, <span class="hljs-string">&#x27;550&#x27;</span>, <span class="hljs-string">&#x27;600&#x27;</span>,<br>                <span class="hljs-string">&#x27;650&#x27;</span>, <span class="hljs-string">&#x27;700&#x27;</span>, <span class="hljs-string">&#x27;750&#x27;</span>,<br>                <span class="hljs-string">&#x27;775&#x27;</span>, <span class="hljs-string">&#x27;800&#x27;</span>, <span class="hljs-string">&#x27;825&#x27;</span>,<br>                <span class="hljs-string">&#x27;850&#x27;</span>, <span class="hljs-string">&#x27;875&#x27;</span>, <span class="hljs-string">&#x27;900&#x27;</span>,<br>                <span class="hljs-string">&#x27;925&#x27;</span>, <span class="hljs-string">&#x27;950&#x27;</span>, <span class="hljs-string">&#x27;975&#x27;</span>,<br>                <span class="hljs-string">&#x27;1000&#x27;</span><br>            ],<br>            <span class="hljs-string">&quot;grid&quot;</span>: [args.resoln, args.resoln],<br>            <span class="hljs-string">&quot;year&quot;</span>: yyyy,<br>            <span class="hljs-string">&quot;month&quot;</span>: [<br>                mm<br>            ],<br>            <span class="hljs-string">&quot;day&quot;</span>: [<br>                <span class="hljs-built_in">dd</span><br>            ],<br>            <span class="hljs-string">&quot;time&quot;</span>: [<br>                hh<br>            ],<br>        <span class="hljs-comment">#    &quot;area&quot;:[15, 90, 10, 120], # North, West, South, East. Default: global</span><br>        &#125;,<br>        args.ofile)<br>except Exception as err:<br>    <span class="hljs-keyword">if</span> str(err) == <span class="hljs-string">&quot;no data is available within your requested subset. Request returned no data.&quot;</span>:<br>        logging.exception(err)<br>        sys.exit(96)<br>    <span class="hljs-keyword">else</span>:<br>        raise err<br><br><br></code></pre></td></tr></table></figure><h2 id="vtable">Vtable</h2><p>The Vtable that comes with WRF includes not only Vtable.ECMWF, but also Vtable.ERA-interim.pl and Vtable.ERA-interim.ml, where Vtable.ERA-interim.pl corresponds to the ERA-Interim data of the pressure level, Vtable.ERA-interim.ml corresponds to the ERA-Interim data of the model level.</p><h3 id="vtable.era-interim.pl">Vtable.ERA-interim.pl</h3><p><strong>Latest commit b5df64a on Apr 12, 2011</strong> For use with ERA-interim pressure-level output For ERA-interim data at NCAR, use the pl (sc and uv) and sfc sc files. &gt; <a href="https://github.com/openwfm/wrf-fire/blob/master/WPS/ungrib/Variable_Tables/Vtable.ERA-interim.pl">Vtable.ERA-interim.pl</a></p><h3 id="vtable.ecmwf">Vtable.ECMWF</h3><p><strong>Latest commit 5c01f57 on Jun 12, 2010</strong> &gt; <a href="https://github.com/openwfm/wrf-fire/blob/master/WPS/ungrib/Variable_Tables/Vtable.ECMWF">Vtable.ECMWF</a></p><h3 id="vtable.era-interim.ml">Vtable.ERA-interim.ml</h3><p><strong>Latest commit b5df64a on Apr 12, 2011</strong> For use with ERA-interim model-level output. For ERA-interim data at NCAR, use the ml (sc and uv) and sfc sc files. &gt; <a href="https://github.com/openwfm/wrf-fire/blob/master/WPS/ungrib/Variable_Tables/Vtable.ERA-interim.ml">Vtable.ERA-interim.ml</a></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">ln</span> -s /xxx/ERA-interim.pl Vtable<br><br><span class="hljs-comment"># If Vtable.ERA-interim.pl works for you, I don&#x27;t think you need to switch to Vtable.ECMWRF.</span><br><span class="hljs-comment"># If not, Please use Vtable.ECMWF to ungrib ERA5 data. </span><br><span class="hljs-built_in">ln</span> -s /xxx/Vtable.ECMWF Vtable<br></code></pre></td></tr></table></figure><h2 id="link_grib.csh">./link_grib.csh</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ ./link_grib.csh ../DATA/ERA5/*.grib<br></code></pre></td></tr></table></figure><h2 id="namelist.wps-setup-ungrib">namelist.wps, setup &amp;ungrib</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">&amp;ungrib<br> out_format = <span class="hljs-string">&#x27;WPS&#x27;</span>,<br> prefix = <span class="hljs-string">&#x27;FILE&#x27;</span>,<br>/<br></code></pre></td></tr></table></figure><h2 id="ungrib.exe">./ungrib.exe</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ ./ungrib.exe<br></code></pre></td></tr></table></figure><p>Outputs are format of <strong>FILE:2022-06-27_15</strong> that is intermediate file that are ready for WRF metgrid or MPAS init.</p><h2 id="error-missingincomplete-configuration-file-homexx.cdsapirc">Error: Missing/incomplete configuration file: /home/xx/.cdsapirc??</h2><p>The reason is that the .cdsapirc file under /home/xx/ is missing. This file contains the downloaded Key. We go to this link (https://cds.climate.copernicus.eu/api-how-to) to get it as required To our Key, if there is no registration, the key will appear directly on the right after registration. At this time, we will copy the things on the right Copy the code shown next to the file $HOME/.cdsapirc (in your Unix/Linux environment).</p><p>check, &gt; ll -a /home/wpsze/.cdsapirc</p><h2 id="soilhgt-field-not-found-in-intermediate-file-era5">SOILHGT field not found in intermediate file ERA5</h2><p>Besides processing the time-dependent atmospheric and land-surface ERA5 fields, I think you will also need to use ungrib to process the ERA5 invariant fields, including SOILHGT. Once you've created an intermediate file with invariant fields, you can concatenate the contents of that file to each of your time-varying intermediate files. <a href="https://forum.mmm.ucar.edu/threads/error-while-interpolating-regional-initial-conditions-using-era-5-grib-data.12532/">link</a></p><p>The HGT_M value from geogrid comes from the static topographic data. The met_em files contain both that HGT_M value, which is identical to the value from geogrid, and <strong>SOILHGT, which is the terrain information coming from the input/first-guess data (e.g., GFS)</strong>. During real.exe, both are used again. The HGT value in the wrfinput* files comes from the HGT_M value and should still be the same at that time (if using the default namelist setting surface_input_source=3). <strong>real.exe also checks for SOILHGT, which is used for smoothing the coarse grid topography on domain 1 during the wrf process.</strong> <a href="https://forum.mmm.ucar.edu/threads/soilhgt.11582/">link</a></p><p>Smooth_cg_topo and ERA-5 / ERA-Interim data? &gt; For ECMWF and ERA, the Vtable says it uses grib code 129 level 0 for both SOILGEO and SOILHGT. Please download ERA5 terrain data from /FS/DECS/DS630.0/e5.oper.invariant/201601/e5.oper.invariant.128_129_z.regn320sc.2016010100_2016010100.grb ERA-I terrain can be found in https://rda.ucar.edu/datasets/ds627.0/, where if you download any sfc dataset, you can find terrain data in it.<a href="https://forum.mmm.ucar.edu/threads/smooth_cg_topo-and-era-5-era-interim-data.9323/">link</a></p>]]></content>
    
    
    <categories>
      
      <category>NWP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>WRF</tag>
      
      <tag>WPS</tag>
      
      <tag>MPAS</tag>
      
      <tag>IC/BC</tag>
      
      <tag>ERA5</tag>
      
      <tag>ECMWF</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>WRF | WPS namelist.wps Best Practices</title>
    <link href="/2023/04/30/WPS_namelist_wps_Best_Practices/"/>
    <url>/2023/04/30/WPS_namelist_wps_Best_Practices/</url>
    
    <content type="html"><![CDATA[<h1 id="wps-namelist.wps-best-practices">WPS namelist.wps: Best Practices</h1><p><a href="https://www2.mmm.ucar.edu/wrf/users/namelist_best_prac_wps.html">https://www2.mmm.ucar.edu/wrf/users/namelist_best_prac_wps.html</a></p><ol type="1"><li>In namelist.wps, multiple columns are used for multiple domains; however max_domains determines how many columns will be used. For example, if you use 3 columns, but only set max_dom = 2, the last column will be ignored.</li><li>Not all parameters have mulitple columns.</li></ol><h2 id="max_dom">max_dom</h2><p>Nested domains are necessary when scaling down from coarse first-guess (input) data to a fine resolution, and the recommended ratios for coarse data resolution to the parent domain are odd ratios of <strong>3:1 or 5:1</strong>. For example, if your domain of interest needs to have a resolution of 3 km, but your input data have a resolution of 27 km, and you are using a 3:1 ratio, your domain 01, should be around 9 km, and then you can have a nested domain with 3 km grid spacing. In this case, max_dom = 3.</p><h2 id="parent_grid_ratio">parent_grid_ratio</h2><p>The nesting ratio relative to the domain's parent. <strong>For the coarsest domain, parent_grid_ratio should be set to 1</strong>. <strong>Recommended ratios are 3 or 5</strong>. If you are unfamiliar with the model, it is best to leave this set to 3. It is not recommended to use an even number ratio since it is best to have a center grid cell for the fine domain that corresponds with the center of the coarse domain. grid cell.</p><h2 id="i_-j_parent_start">i_, j_parent_start</h2><p>It is good practice to keep nest boundaries away from coarse domain boundaries, and to keep them away from steep topography. As a rough approximation, <strong>keep about 1/3 of the coarse-grid domain surrounding each side of the nest</strong>. This does not have to be exact, and the nest does not have to be centered perfectly, but this helps to stay away from problems later. If the prevailing winds are westerly, it is better to place the nest further away from the west boundary, than the east.</p><h2 id="e_we-e_sn">e_we, e_sn</h2><p>It is recommended to have domains <strong>no smaller than about 100x100</strong>. Note that there will be about 10 grid points (minimum of 5) on each side, in the boundary zone. If domains are too small, the solution will be determined by forcing data. When considering the size of the coarse domain, <strong>there is no need to be economical. Doubling the size of the coarse grid domain will only result in a 25% nested forecast time increase</strong>. <strong>It's also important to consider the speed at which systems are moving through the simulated region. A multi-day forecast needs a much larger domain than a short forecast. If cost is prohibitive, consider adding an external domain.</strong></p><h2 id="geog_data_res">geog_data_res</h2><p>Prior to V3.8, if you wish to use the MODIS data, it would be necessary to specify:</p><blockquote><p>geog_data_res = 'modis_30s+10m', 'modis_30s+2m', 'modis_30s+30s'</p></blockquote><p>Possible available resolutions are <strong>10m (~19km), 5m (~9km), 2m (~4km), and 30s (~0.9km)</strong>. When there are multiple resolutions available for geographical input data, choose a resolution that is <strong>slightly better</strong> than your grid resolution. For example, <strong>if your grid resolution is 9km, using 2 minute static data would be ideal</strong>.</p><h2 id="dx-dy">dx, dy</h2><p>This is given in meters for the Lambert, Polar, and Mercator projections. For the 'lat-lon' projection, this is given in degrees latitude. For namelist.wps it is only necessary to specify the coarse domain resolution, as nest domains will be calculated based on parent_grid_ratio. It is recommended that <strong>dx and dy have the same value</strong> for Mercator, Polar, and Lambert projections.</p><h2 id="map_proj">map_proj</h2><ul><li>lambert: well-suited for mid-latitudes; domain cannot contain poles; domain cannot be periodic in west-east direction</li><li>mercator: well-suited for low-latitudes; may be used for a "channel" domain (periodic in west-east direction).</li><li>polar: good for high-latitude domains, especially if the domain contains a pole</li><li>lat-lon: also called cylindrical equidistant; required for global domains (but does not have to be global); can be used in its normal or rotated aspect</li></ul><p>It is best to check the range of the map scale factor (e.g., <strong>MAPFRAC_M</strong> for the map factor in the center of a grid cell) after running geogrid.exe (this can be checked easily with the ncview program). <strong>Values should be close to 1 to ensure the projection is not causing distortion.</strong></p><h2 id="ref_lat-ref_lon">ref_lat, ref_lon</h2><p>Real values specifying the latitude and longitude of a location whose (i,j) location in the simulation is known. &gt; For ARW, ref_lat and ref_lon give the latitude and longitude of a known location in the domain (it's recommended that these are set to the center of the coarse domain</p><h2 id="truelat12">truelat1/2</h2><ul><li>truelat1: A real value specifying the first true latitude for the Lambert conformal conic projection, or the true latitude for the polar stereographic projection, or the Mercator projection.</li><li>truelat2: A real value specifying the second true latitude for the Lambert conformal conic projection.</li></ul><h2 id="stand_lon">stand_lon</h2><p>If this longitude is set to the <strong>same value as ref_lon</strong>, your coarsest domain will be centered.</p><h2 id="geog_data_path">geog_data_path</h2><p>It's best to set this to <strong>the absolute path.</strong></p><h2 id="ungrid">&amp;ungrid</h2><h3 id="out_format">out_format</h3><p>If you are running ungrib in the WPS/ program, this should be set to <strong>"WPS."</strong></p><h3 id="prefix">prefix</h3><p>The prefix that will be assigned to intermediate files (produced from the ungrib.exe program). This can be left as set to 'FILE' or can be changed to anything you choose like GFS, ERA5, SST.</p><blockquote><p>If you will be using more than one type of input data, and it's necessary to run ungrib twice, you may consider setting this to something that is meaningful to the data type (e.g., "SST" for sea surface temperature data). If you do need to run ungrib twice, set this to only one prefix name per ungrib.exe run.</p></blockquote><h2 id="metgrid">&amp;metgrid</h2><h3 id="fg_name">fg_name</h3><p>This is the prefix that was used when the intermediate files were created (see above). To combine different data sources, <strong>list all prefixes</strong> (e.g., fg_name = 'GFS', 'SST'), that combine GFS and SST</p>]]></content>
    
    
    <categories>
      
      <category>WRF</category>
      
    </categories>
    
    
    <tags>
      
      <tag>WRF</tag>
      
      <tag>WPS</tag>
      
      <tag>namelist.wps</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>WRF | WPS namelist.wps Examples</title>
    <link href="/2023/04/30/WPS_namelist_wps_examples/"/>
    <url>/2023/04/30/WPS_namelist_wps_examples/</url>
    
    <content type="html"><![CDATA[<h1 id="wps-namelist.wps-examples">WPS namelist.wps Examples</h1><h2 id="namelist.wps">namelist.wps</h2><p><a href="https://github.com/wrf-model/WPS/blob/master/namelist.wps">Git namelist.wps</a></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs sh">&amp;share<br> wrf_core = <span class="hljs-string">&#x27;ARW&#x27;</span>,<br> max_dom = 2,<br> start_date = <span class="hljs-string">&#x27;2019-09-04_12:00:00&#x27;</span>,<span class="hljs-string">&#x27;2019-09-04_12:00:00&#x27;</span>,<br> end_date   = <span class="hljs-string">&#x27;2019-09-06_00:00:00&#x27;</span>,<span class="hljs-string">&#x27;2019-09-04_12:00:00&#x27;</span>,<br> interval_seconds = 10800<br>/<br><br>&amp;geogrid<br> parent_id         =   1,   1,<br> parent_grid_ratio =   1,   3,<br> i_parent_start    =   1,  53,<br> j_parent_start    =   1,  25,<br> e_we              =  150, 220,<br> e_sn              =  130, 214,<br> geog_data_res = <span class="hljs-string">&#x27;default&#x27;</span>,<span class="hljs-string">&#x27;default&#x27;</span>,<br> dx = 15000,<br> dy = 15000,<br> map_proj = <span class="hljs-string">&#x27;lambert&#x27;</span>,<br> ref_lat   =  33.00,<br> ref_lon   = -79.00,<br> truelat1  =  30.0,<br> truelat2  =  60.0,<br> stand_lon = -79.0,<br> geog_data_path = <span class="hljs-string">&#x27;/glade/work/wrfhelp/WPS_GEOG/&#x27;</span><br>/<br><br>&amp;ungrib<br> out_format = <span class="hljs-string">&#x27;WPS&#x27;</span>,<br> prefix = <span class="hljs-string">&#x27;FILE&#x27;</span>,<br>/<br><br>&amp;metgrid<br> fg_name = <span class="hljs-string">&#x27;FILE&#x27;</span><br>/<br></code></pre></td></tr></table></figure><h2 id="namelist.wps.all_options">namelist.wps.all_options</h2><p><a href="https://github.com/wrf-model/WPS/blob/master/namelist.wps.all_options">Git namelist.wps.all_options</a></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><code class="hljs sh">&amp;share<br> wrf_core = <span class="hljs-string">&#x27;ARW&#x27;</span>,<br> max_dom = 2,<br> start_date = <span class="hljs-string">&#x27;2006-08-16_12:00:00&#x27;</span>,<span class="hljs-string">&#x27;2006-08-16_12:00:00&#x27;</span>,<br> end_date   = <span class="hljs-string">&#x27;2006-08-16_18:00:00&#x27;</span>,<span class="hljs-string">&#x27;2006-08-16_12:00:00&#x27;</span>,<br> interval_seconds = 21600<br> active_grid = .<span class="hljs-literal">true</span>., .<span class="hljs-literal">true</span>.,<br> subgrid_ratio_x = 1<br> subgrid_ratio_y = 1<br> io_form_geogrid = 2,<br> opt_output_from_geogrid_path = <span class="hljs-string">&#x27;./&#x27;</span>,<br> debug_level = 0<br>/<br> start_date = <span class="hljs-string">&#x27;2000-01-24_12:00:00&#x27;</span>,<span class="hljs-string">&#x27;2000-01-24_12:00:00&#x27;</span>,<br> end_date   = <span class="hljs-string">&#x27;2000-01-25_12:00:00&#x27;</span>,<span class="hljs-string">&#x27;2000-01-24_12:00:00&#x27;</span>,<br> start_year   = 2006, 2006,<br> start_month  =   08,   08,<br> start_day    =   16,   16,<br> start_hour   =   12,   12,<br> start_minute =   00,   00,<br> start_second =   00,   00,<br> end_year     = 2006, 2006,<br> end_month    =   08,   08,<br> end_day      =   16,   16,<br> end_hour     =   18,   12,<br> end_minute   =   00,   00,<br> end_second   =   00,   00,<br><br>&amp;geogrid<br> parent_id         =   1,   1,<br> parent_grid_ratio =   1,   3,<br> i_parent_start    =   1,  31,<br> j_parent_start    =   1,  17,<br> s_we              =   1,   1,<br> e_we              =  74, 112,<br> s_sn              =   1,   1,<br> e_sn              =  61,  97,<br> !<br> !!!!!!!!!!!!!!!!!!!!!!!!!!!! IMPORTANT NOTE !!!!!!!!!!!!!!!!!!!!!!!!!!!!<br> ! The default datasets used to produce the MAXSNOALB and ALBEDO12M<br> ! fields have changed <span class="hljs-keyword">in</span> WPS v4.0. These fields are now interpolated<br> ! from MODIS-based datasets.<br> !<br> ! To match the output given by the default namelist.wps <span class="hljs-keyword">in</span> WPS v3.9.1,<br> ! the following setting <span class="hljs-keyword">for</span> geog_data_res may be used:<br> !<br> ! geog_data_res = <span class="hljs-string">&#x27;maxsnowalb_ncep+albedo_ncep+default&#x27;</span>, <span class="hljs-string">&#x27;maxsnowalb_ncep+albedo_ncep+default&#x27;</span>,<br> !<br> !!!!!!!!!!!!!!!!!!!!!!!!!!!! IMPORTANT NOTE !!!!!!!!!!!!!!!!!!!!!!!!!!!!<br> !<br> geog_data_res = <span class="hljs-string">&#x27;default&#x27;</span>,<span class="hljs-string">&#x27;default&#x27;</span>,<br> dx        = 30000,<br> dy        = 30000,<br> map_proj  = <span class="hljs-string">&#x27;lambert&#x27;</span>,<br> ref_lat   =  34.83,<br> ref_lon   = -81.03,<br> ref_x     =  37.0,<br> ref_y     =  30.5,<br> truelat1  =  30.0,<br> truelat2  =  60.0,<br> stand_lon = -98.0,<br> geog_data_path = <span class="hljs-string">&#x27;/glade/work/wrfhelp/WPS_GEOG/&#x27;</span><br> opt_geogrid_tbl_path = <span class="hljs-string">&#x27;geogrid/&#x27;</span><br>/<br> geog_data_res     = <span class="hljs-string">&#x27;modis_lakes+10m&#x27;</span>,<span class="hljs-string">&#x27;modis_lakes+2m&#x27;</span>,<br> geog_data_res     = <span class="hljs-string">&#x27;usgs_lakes+10m&#x27;</span>,<span class="hljs-string">&#x27;usgs_lakes+2m&#x27;</span>,<br><br>&amp;ungrib<br> out_format = <span class="hljs-string">&#x27;WPS&#x27;</span>,<br> prefix     = <span class="hljs-string">&#x27;FILE&#x27;</span>,<br> ec_rec_len = 26214508,<br> pmin = 100.<br>/<br><br>&amp;metgrid<br> fg_name         = <span class="hljs-string">&#x27;FILE&#x27;</span><br> constants_name  = <span class="hljs-string">&#x27;./TAVGSFC&#x27;</span><br> io_form_metgrid = 2, <br> opt_output_from_metgrid_path = <span class="hljs-string">&#x27;./&#x27;</span>,<br> opt_metgrid_tbl_path         = <span class="hljs-string">&#x27;metgrid/&#x27;</span>,<br> process_only_bdy = 5,<br>/<br><br>&amp;mod_levs<br> press_pa = 201300 , 200100 , 100000 , <br>             95000 ,  90000 , <br>             85000 ,  80000 , <br>             75000 ,  70000 , <br>             65000 ,  60000 , <br>             55000 ,  50000 , <br>             45000 ,  40000 , <br>             35000 ,  30000 , <br>             25000 ,  20000 , <br>             15000 ,  10000 , <br>              5000 ,   1000<br>/<br><br>&amp;plotfmt<br> ix = 100<br> jx = 100<br> ioff = 30<br> joff = 30<br>/<br></code></pre></td></tr></table></figure><h2 id="namelist.wps.global">namelist.wps.global</h2><p><a href="https://github.com/wrf-model/WPS/blob/master/namelist.wps.global">Git namelist.wps.global</a></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><code class="hljs sh">&amp;share<br> wrf_core = <span class="hljs-string">&#x27;ARW&#x27;</span>,<br> max_dom = 2,<br> start_date = <span class="hljs-string">&#x27;2006-08-16_12:00:00&#x27;</span>,<span class="hljs-string">&#x27;2006-08-16_12:00:00&#x27;</span>,<br> end_date   = <span class="hljs-string">&#x27;2006-08-16_12:00:00&#x27;</span>,<span class="hljs-string">&#x27;2006-08-16_12:00:00&#x27;</span>,<br> interval_seconds = 21600<br> io_form_geogrid = 2,<br>/<br><br>&amp;geogrid<br> parent_id         =   1,   1,<br> parent_grid_ratio =   1,   3,<br> i_parent_start    =   1,  31,<br> j_parent_start    =   1,  17,<br> e_we              =  129, 127,<br> e_sn              =  65,  64,<br> !<br> !!!!!!!!!!!!!!!!!!!!!!!!!!!! IMPORTANT NOTE !!!!!!!!!!!!!!!!!!!!!!!!!!!!<br> ! The default datasets used to produce the MAXSNOALB and ALBEDO12M<br> ! fields have changed <span class="hljs-keyword">in</span> WPS v4.0. These fields are now interpolated<br> ! from MODIS-based datasets.<br> !<br> ! To match the output given by the default namelist.wps <span class="hljs-keyword">in</span> WPS v3.9.1,<br> ! the following setting <span class="hljs-keyword">for</span> geog_data_res may be used:<br> !<br> ! geog_data_res = <span class="hljs-string">&#x27;maxsnowalb_ncep+albedo_ncep+default&#x27;</span>, <span class="hljs-string">&#x27;maxsnowalb_ncep+albedo_ncep+default&#x27;</span>,<br> !<br> !!!!!!!!!!!!!!!!!!!!!!!!!!!! IMPORTANT NOTE !!!!!!!!!!!!!!!!!!!!!!!!!!!!<br> !<br> geog_data_res = <span class="hljs-string">&#x27;default&#x27;</span>,<span class="hljs-string">&#x27;default&#x27;</span>,<br> map_proj = <span class="hljs-string">&#x27;lat-lon&#x27;</span>,<br> stand_lon = 0.<br> pole_lat = 90.0<br> pole_lon = 0.0<br> geog_data_path = <span class="hljs-string">&#x27;/glade/work/wrfhelp/WPS_GEOG/&#x27;</span><br>/<br> ref_lat = 45.0<br> ref_lon = -98<br> dx = 1.0<br> dy = 1.0<br><br>&amp;ungrib<br> out_format = <span class="hljs-string">&#x27;WPS&#x27;</span>,<br> prefix = <span class="hljs-string">&#x27;FILE&#x27;</span>,<br>/<br><br>&amp;metgrid<br> fg_name = <span class="hljs-string">&#x27;FILE&#x27;</span><br> io_form_metgrid = 2, <br>/<br><br>&amp;mod_levs<br> press_pa = 201300 , 200100 , 100000 , <br>             95000 ,  90000 , <br>             85000 ,  80000 , <br>             75000 ,  70000 , <br>             65000 ,  60000 , <br>             55000 ,  50000 , <br>             45000 ,  40000 , <br>             35000 ,  30000 , <br>             25000 ,  20000 , <br>             15000 ,  10000 , <br>              5000 ,   1000<br>/<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>WRF</category>
      
    </categories>
    
    
    <tags>
      
      <tag>WRF</tag>
      
      <tag>WPS</tag>
      
      <tag>namelist.wps</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>WRF | WRF em_real namelist.input Examples</title>
    <link href="/2023/04/30/WRF_em_real_namelist_input_Examples/"/>
    <url>/2023/04/30/WRF_em_real_namelist_input_Examples/</url>
    
    <content type="html"><![CDATA[<h1 id="wrf-em_real-namelist.input-examples">WRF em_real namelist.input Examples</h1><p>For em_real</p><h2 id="namelist.input.default">namelist.input.default</h2><p>The default namelist.input file for real cases had several settings that go against best practices and recommendations.</p><p><a href="https://github.com/wrf-model/WRF/blob/master/test/em_real/namelist.input.default">WRF/test/em_real/namelist.input.default</a> <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><code class="hljs sh">&amp;time_control<br>run_days                            = 0,! Number of simulation days. DO NOT ADD ADDITIONAL COLUMNS.<br>run_hours                           = 36,! Number of simulation hours. DO NOT ADD ADDITIONAL COLUMNS.<br>run_minutes                         = 0,! Number of simulation minutes. DO NOT ADD ADDITIONAL COLUMNS.<br>run_seconds                         = 0,! Number of simulation seconds. DO NOT ADD ADDITIONAL COLUMNS.<br>! *NOTE: real.exe does not <span class="hljs-built_in">read</span> run_days/hours/minutes/seconds. Only <span class="hljs-built_in">read</span> by wrf.exe<br>! real.exe only reads start_* and end_* parameters.<br>start_year                          = 2019, 2019, 2019,! Starting year of the simulation.<br>start_month                         = 09,   09,   09,! Starting month of the simulation.<br>start_day                           = 04,   04,   24,! Starting day of the simulation.<br>start_hour                          = 12,   12,   12,! Starting hour of the simulation.<br>end_year                            = 2019, 2019, 2019,! Ending year of the simulation.<br>end_month                           = 09,   09,   09,! Ending month of the simulation.<br>end_day                             = 06,   06,   06,! Ending day of the simulation.<br>end_hour                            = 00,   00,   00,! Ending hour of the simulation.<br>interval_seconds                    = 21600! Time interval (s) between input data. DO NOT ADD ADDITIONAL COLUMNS.<br>input_from_file                     = .<span class="hljs-literal">true</span>.,.<span class="hljs-literal">true</span>.,.<span class="hljs-literal">true</span>.,! Logical - whether input files (e.g., met_em*) will be used.<br>history_interval                    = 180,  60,   60,! Interval between <span class="hljs-built_in">history</span> output (mins). *Note: to change the units of history_interval, add _s (secs), _h (hours)<br>frames_per_outfile                  = 1000, 1000, 1000,! Number of <span class="hljs-built_in">history</span> output <span class="hljs-built_in">times</span> printed to each wrf output (wrfout) file.<br>restart                             = .<span class="hljs-literal">false</span>.,! Logical - whether the run is a <span class="hljs-string">&quot;restart&quot;</span> simulation. DO NOT ADD ADDITIONAL COLUMNS.<br>restart_interval                    = 7200,! Interval between restart (wrfrst) files (min). DO NOT ADD ADDITIONAL COLUMNS.<br>io_form_history                     = 2! File format <span class="hljs-keyword">for</span> <span class="hljs-built_in">history</span> (wrfout) files. See Users<span class="hljs-string">&#x27; Guide for options. DO NOT ADD ADDITIONAL COLUMNS.</span><br><span class="hljs-string">io_form_restart                     = 2! File format for restart (wrfrst) files. See Users&#x27;</span> Guide <span class="hljs-keyword">for</span> options. DO NOT ADD ADDITIONAL COLUMNS.<br>io_form_input                       = 2! File format <span class="hljs-keyword">for</span> the input (wrfinput) files. See Users<span class="hljs-string">&#x27; Guide for options. DO NOT ADD ADDITIONAL COLUMNS.</span><br><span class="hljs-string">io_form_boundary                    = 2! File format for the boundary (wrfbdy) file. See Users&#x27;</span> Guide <span class="hljs-keyword">for</span> options. DO NOT ADD ADDITIONAL COLUMNS.<br>/<br><br>&amp;domains<br>time_step                           = 90,! Time step <span class="hljs-keyword">for</span> model integration (s). Must use 6xDX (or less). DO NOT ADD ADDITIONAL COLUMNS.<br>time_step_fract_num                 = 0,! Numerator <span class="hljs-keyword">if</span> using fractional time step. DO NOT ADD ADDITIONAL COLUMNS.<br>time_step_fract_den                 = 1,! Denomenator <span class="hljs-keyword">if</span> using fractional time step. DO NOT ADD ADDITIONAL COLUMNS.<br>max_dom                             = 1,! Total number of domains <span class="hljs-keyword">for</span> the simulation. DO NOT ADD ADDITIONAL COLUMNS.<br>e_we                                = 150,    220,   200,! Number of grid spaces <span class="hljs-keyword">in</span> the x direction (west-east).<br>e_sn                                = 130,    214,   210,! Number of grid spaces <span class="hljs-keyword">in</span> the y direction (south-north).<br>e_vert                              = 45,     45,    45,! Number of full vertical levels. must be the same <span class="hljs-keyword">for</span> all domains.<br>dzstretch_s                         = 1.1! Surface stretch <span class="hljs-built_in">factor</span> when auto_levels_opt = 2 (<span class="hljs-built_in">which</span> is default). DO NOT ADD ADDITIONAL COLUMNS.<br>p_top_requested                     = 5000,! Pressure top (<span class="hljs-keyword">in</span> Pa) to use <span class="hljs-keyword">for</span> the simulation. The input data must go up to this value. DO NOT ADD ADDITIONAL COLUMNS.<br>num_metgrid_levels                  = 34,! Number of vertical levels <span class="hljs-keyword">in</span> the WPS output. DO NOT ADD ADDITIONAL COLUMNS.<br>num_metgrid_soil_levels             = 4,! Number of soil levels <span class="hljs-keyword">in</span> the WPS output. DO NOT ADD ADDITIONAL COLUMNS.<br>dx                                  = 15000,! Length (m) of each grid <span class="hljs-keyword">in</span> the x (west-east) direction (resolution). DO NOT ADD ADDITIONAL COLUMNS. <br>dy                                  = 15000,! Length (m) of each grid <span class="hljs-keyword">in</span> the y (south-north) direction (resolution). DO NOT ADD ADDITIONAL COLUMNS.  <br>grid_id                             = 1,     2,     3,! Identifier number of each domain.<br>parent_id                           = 0,     1,     2,! The ID of the parent of each domain.<br>i_parent_start                      = 1,     53,    30,! Starting location of the lower left corner i-indice within the parent domain.<br>j_parent_start                      = 1,     25,    30,! Starting location of the lower left corner j-indice within the parent domain.<br>parent_grid_ratio                   = 1,     3,     3,! Ratio of the parent to nest grid size (resolution).<br>parent_time_step_ratio              = 1,     3,     3,! Time_step ratio of the parent to nest.<br>feedback                            = 1,! Switch <span class="hljs-keyword">for</span> feedback from the nest to it<span class="hljs-string">&#x27;s parent at corresponding grid points (1=on;0=off). DO NOT ADD ADDITIONAL COLUMNS.</span><br><span class="hljs-string">smooth_option                       = 0! Smoothing option for the boundary between parent and nest domains (when feedback=1). DO NOT ADD ADDITIONAL COLUMNS.</span><br><span class="hljs-string">/</span><br><span class="hljs-string"></span><br><span class="hljs-string">&amp;physics</span><br><span class="hljs-string">physics_suite                       = &#x27;</span>CONUS<span class="hljs-string">&#x27;! Physics suite option (CONUS or tropical). See Users&#x27;</span> Guide <span class="hljs-keyword">for</span> details. DO NOT ADD ADDITIONAL COLUMNS.<br>mp_physics                          = -1,    -1,    -1,! Microphysics scheme. See Users<span class="hljs-string">&#x27; Guide for options (-1=option from suite). Every domain must be the same.</span><br><span class="hljs-string">cu_physics                          = -1,    -1,     0,! Cumulus scheme. See Users&#x27;</span> Guide <span class="hljs-keyword">for</span> options (-1=option from suite).<br>ra_lw_physics                       = -1,    -1,    -1,! Longwave radiation scheme. See Users<span class="hljs-string">&#x27; Guide for options (-1=option from suite). Every domain must be the same.</span><br><span class="hljs-string">ra_sw_physics                       = -1,    -1,    -1,! Shortwave radiation scheme. See Users&#x27;</span> Guide <span class="hljs-keyword">for</span> options (-1=option from suite). Every domain must be the same.<br>bl_pbl_physics                      = -1,    -1,    -1,! PBL scheme. See Users<span class="hljs-string">&#x27; Guide for options (-1=option from suite).</span><br><span class="hljs-string">sf_sfclay_physics                   = -1,    -1,    -1,! Surface layer scheme. See Users&#x27;</span> Guide <span class="hljs-keyword">for</span> options (-1=option from suite). Every domain must be the same.<br>sf_surface_physics                  = -1,    -1,    -1,! LSM scheme. See Users<span class="hljs-string">&#x27; Guide for options (-1=option from suite). Every domain must be the same.</span><br><span class="hljs-string">radt                                = 15,    15,    15,! Minutes between radiation physics calls (recommended 1 min per km of d01 dx). Every domain must be the same.</span><br><span class="hljs-string">bldt                                = 0,     0,     0,! Minutes between boundary-layer physics calls (recommended 0=every time step). Every domain must be the same.</span><br><span class="hljs-string">cudt                                = 0,     0,     0,! Minutes between cumulus physics calls. Set to 0 (called every time step) for all cumulus schemes except Kain-Fritsch.  Every domain must be the same.</span><br><span class="hljs-string">icloud                              = 1,! Option to couple subgrid-scale clouds from the PBL scheme to radiation schemes (only works with RRTM/RRTMG rad schemes). See Users&#x27;</span> Guide <span class="hljs-keyword">for</span> options. DO NOT ADD ADDITIONAL COLUMNS.<br>num_land_cat                        = 21,! Number of land categories from WPS input data. See Users<span class="hljs-string">&#x27; Guide for details. DO NOT ADD ADDITIONAL COLUMNS.</span><br><span class="hljs-string">sf_urban_physics                    = 0,     0,     0,! Option for activating urban canopy model (only for Noah LSM). See Users&#x27;</span> Guide <span class="hljs-keyword">for</span> details. Use same value <span class="hljs-keyword">for</span> all domains. <br>/<br><br>&amp;fdda<br>/<br><br>&amp;dynamics<br>hybrid_opt                          = 2,! Hybrid coordinate option (2=Klemp cubic form with etac; default beginning V4.0). DO NOT ADD ADDITIONAL COLUMNS. <br>w_damping                           = 0,! Vertical velocity damping flag (0=off;1=on). DO NOT ADD ADDITIONAL COLUMNS.<br>diff_opt                            = 2,      2,      2,! Turbulence and mixing option. See Users<span class="hljs-string">&#x27; Guide for options. </span><br><span class="hljs-string">km_opt                              = 4,      4,      4,! Eddy coefficient option. See Users&#x27;</span> Guide <span class="hljs-keyword">for</span> options.<br>diff_6th_opt                        = 0,      0,      0,! 6th order numerical diffusion option. See Users<span class="hljs-string">&#x27; Guide for options.</span><br><span class="hljs-string">diff_6th_factor                     = 0.12,   0.12,   0.12,! 6th order numerical diffusion non-dimensional rate (max 1.0 = complete removal of 2dx wave in 1 timestep). </span><br><span class="hljs-string">base_temp                           = 290.! Base state temp (K). For real cases only. DO NOT ADD ADDITIONAL COLUMNS.</span><br><span class="hljs-string">damp_opt                            = 3,! Upper-level damping option. See Users&#x27;</span> Guide <span class="hljs-keyword">for</span> options. DO NOT ADD ADDITIONAL COLUMNS.<br>zdamp                               = 5000.,  5000.,  5000.,! Damping depth (m) from model top.<br>dampcoef                            = 0.2,    0.2,    0.2,! Damping coefficient corresponding to damp_opt. See Users<span class="hljs-string">&#x27; Guide for details.</span><br><span class="hljs-string">khdif                               = 0,      0,      0,! Horizontal diffusion constant (m^2/s)</span><br><span class="hljs-string">kvdif                               = 0,      0,      0,! Vertical diffusion constant (m^2/s)</span><br><span class="hljs-string">non_hydrostatic                     = .true., .true., .true.,! Set to false to run the model hydrostatically.</span><br><span class="hljs-string">moist_adv_opt                       = 1,      1,      1,     ! Advection option for moisture. See Users&#x27;</span> Guide <span class="hljs-keyword">for</span> details.<br>scalar_adv_opt                      = 1,      1,      1,     ! Advection option <span class="hljs-keyword">for</span> scalars. See Users<span class="hljs-string">&#x27; Guide for details.</span><br><span class="hljs-string">gwd_opt                             = 1,      1,      0,! Switch for gravity wave drag option (1=on;0=off)</span><br><span class="hljs-string">/</span><br><span class="hljs-string"></span><br><span class="hljs-string">&amp;bdy_control</span><br><span class="hljs-string">spec_bdy_width                      = 5,! Total number of rows for specified boundary value nudging for real cases only. DO NOT ADD ADDITIONAL COLUMNS.</span><br><span class="hljs-string">specified                           = .true.! Specified boundary condition for real cases only. DO NOT ADD ADDITIONAL COLUMNS.</span><br><span class="hljs-string">/</span><br><span class="hljs-string"></span><br><span class="hljs-string">&amp;grib2</span><br><span class="hljs-string">/</span><br><span class="hljs-string"></span><br><span class="hljs-string">&amp;namelist_quilt</span><br><span class="hljs-string">nio_tasks_per_group = 0,! Number of I/O tasks per group for quilting. 0=no quilting. DO NOT ADD ADDITIONAL COLUMNS.</span><br><span class="hljs-string">nio_groups = 1,! Number of I/O groups for quilting. DO NOT ADD ADDITIONAL COLUMNS.</span><br><span class="hljs-string">/</span><br></code></pre></td></tr></table></figure></p><h2 id="examples.namelist-many-cases">examples.namelist (Many cases)</h2><p><a href="https://github.com/wrf-model/WRF/blob/master/test/em_real/examples.namelist">Git em_real/examples.namelist</a></p><blockquote><p>Note, this is not a namelist.input file. <strong>Find what interests you, and cut and paste them to your own namelist.input file.</strong> For more information on these namelist parameters, please see run/README.namelist or Chapter 5 of the User's Guide.</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br></pre></td><td class="code"><pre><code class="hljs sh">Note, this is not a namelist.input file. Find what interests you, and <span class="hljs-built_in">cut</span> and <span class="hljs-built_in">paste</span> them <br>      to your own namelist.input file. For more information on these namelist parameters,<br>      please see run/README.namelist or Chapter 5 of the User<span class="hljs-string">&#x27;s Guide.</span><br><span class="hljs-string"></span><br><span class="hljs-string">** More options for real in namelist record &amp;domains:</span><br><span class="hljs-string"></span><br><span class="hljs-string"> p_top_requested                     = 5000</span><br><span class="hljs-string"> interp_type                         = 2</span><br><span class="hljs-string"> extrap_type                         = 2</span><br><span class="hljs-string"> t_extrap_type                       = 2</span><br><span class="hljs-string"> lowest_lev_from_sfc                 = .false.</span><br><span class="hljs-string"> use_levels_below_ground             = .true.</span><br><span class="hljs-string"> use_surface                         = .true.</span><br><span class="hljs-string"> lagrange_order                      = 2</span><br><span class="hljs-string"> force_sfc_in_vinterp                = 1</span><br><span class="hljs-string"> zap_close_levels                    = 500</span><br><span class="hljs-string"> sfcp_to_sfcp                        = .false.</span><br><span class="hljs-string"> adjust_heights                      = .false.</span><br><span class="hljs-string"> smooth_cg_topo                      = .false.</span><br><span class="hljs-string"> eta_levels                          = 1.000, 0.990, 0.978, 0.964, 0.946,</span><br><span class="hljs-string">                                       0.922, 0.894, 0.860, 0.817, 0.766,</span><br><span class="hljs-string">                                       0.707, 0.644, 0.576, 0.507, 0.444,</span><br><span class="hljs-string">                                       0.380, 0.324, 0.273, 0.228, 0.188,</span><br><span class="hljs-string">                                       0.152, 0.121, 0.093, 0.069, 0.048,</span><br><span class="hljs-string">                                       0.029, 0.014, 0.000,</span><br><span class="hljs-string"></span><br><span class="hljs-string">** Using sst_update option (add these to namelist records &amp;time_control and</span><br><span class="hljs-string">   &amp;physics respectively):</span><br><span class="hljs-string"></span><br><span class="hljs-string"> &amp;time_control</span><br><span class="hljs-string"> auxinput4_inname                    = &quot;wrflowinp_d&lt;domain&gt;&quot;</span><br><span class="hljs-string"> auxinput4_interval                  = 360, 360, 360, </span><br><span class="hljs-string"> io_form_auxinput4                   = 2</span><br><span class="hljs-string"></span><br><span class="hljs-string"> &amp;physics</span><br><span class="hljs-string"> sst_update                          = 1,</span><br><span class="hljs-string"></span><br><span class="hljs-string">** Using qna_update option (add these to namelist records &amp;time_control and</span><br><span class="hljs-string">   &amp;physics respectively):</span><br><span class="hljs-string"></span><br><span class="hljs-string"> &amp;time_control</span><br><span class="hljs-string"> auxinput17_inname                   = &quot;wrfqnainp_d&lt;domain&gt;&quot;</span><br><span class="hljs-string"> auxinput17_interval                 = 360, 360, 360,</span><br><span class="hljs-string"> io_form_auxinput17                  = 2</span><br><span class="hljs-string"></span><br><span class="hljs-string"> &amp;physics</span><br><span class="hljs-string"> qna_update                          = 1,</span><br><span class="hljs-string"></span><br><span class="hljs-string">** Using Noah-MP option (Use sf_surface_physics option = 4, and add</span><br><span class="hljs-string">   &amp;noah_mp namelist record)</span><br><span class="hljs-string"></span><br><span class="hljs-string">&amp;physics</span><br><span class="hljs-string">   sf_surface_physics = 4</span><br><span class="hljs-string"></span><br><span class="hljs-string">&amp;noah_mp</span><br><span class="hljs-string"> dveg     = 4,</span><br><span class="hljs-string"> opt_crs  = 1,</span><br><span class="hljs-string"> opt_btr  = 1,</span><br><span class="hljs-string"> opt_run  = 1,</span><br><span class="hljs-string"> opt_sfc  = 1, </span><br><span class="hljs-string"> opt_frz  = 1, </span><br><span class="hljs-string"> opt_inf  = 1, </span><br><span class="hljs-string"> opt_rad  = 3, </span><br><span class="hljs-string"> opt_alb  = 2,</span><br><span class="hljs-string"> opt_snf  = 1,</span><br><span class="hljs-string"> opt_tbot = 2, </span><br><span class="hljs-string"> opt_stc  = 1,</span><br><span class="hljs-string">/</span><br><span class="hljs-string"></span><br><span class="hljs-string">** Using UCM urban model</span><br><span class="hljs-string">&amp;physics</span><br><span class="hljs-string"> sf_urban_physics                    = 1,      1,     1,</span><br><span class="hljs-string"></span><br><span class="hljs-string">** Using BEP urban model</span><br><span class="hljs-string">&amp;physics</span><br><span class="hljs-string"> sf_urban_physics                    = 2,      2,     2,</span><br><span class="hljs-string"></span><br><span class="hljs-string">** Using BEM urban model</span><br><span class="hljs-string">&amp;physics</span><br><span class="hljs-string"> sf_urban_physics                    = 3,      3,     3,</span><br><span class="hljs-string"></span><br><span class="hljs-string">** Using lake model</span><br><span class="hljs-string">&amp;physics</span><br><span class="hljs-string"> sf_lake_physics                     = 1,      1,     1,</span><br><span class="hljs-string"> lakedepth_default                   = 50.,    50.,   50.,</span><br><span class="hljs-string"> lake_min_elev                       = 5.,     5.,    5.,</span><br><span class="hljs-string"></span><br><span class="hljs-string">** Using shallow water roughness (constant depth)</span><br><span class="hljs-string">&amp;physics</span><br><span class="hljs-string">shalwater_z0                        = 1,       1,     1, </span><br><span class="hljs-string">shalwater_depth                     = 40.0,</span><br><span class="hljs-string"></span><br><span class="hljs-string">** Using shallow water roughness (with bathymetry data)</span><br><span class="hljs-string">&amp;physics</span><br><span class="hljs-string">shalwater_z0                        = 1,       1,     1, </span><br><span class="hljs-string">shalwater_depth                     = 0.0,</span><br><span class="hljs-string"></span><br><span class="hljs-string">** Using stochastic backscatter scheme (new namelist record since v3.6)</span><br><span class="hljs-string"></span><br><span class="hljs-string">&amp;stoch</span><br><span class="hljs-string"> stoch_force_opt                     = 1,        1,        1,</span><br><span class="hljs-string"> stoch_vertstruc_opt                 = 0,        0,        0,</span><br><span class="hljs-string"> tot_backscat_psi                    = 1.E-05,   1.E-05,   1.E-05,</span><br><span class="hljs-string"> tot_backscat_t                      = 1.E-06,   1.E-06,   1.E-06,</span><br><span class="hljs-string"> nens                                = 1,</span><br><span class="hljs-string"> ztau_psi                            = 10800.0,</span><br><span class="hljs-string"> ztau_t                              = 10800.0,</span><br><span class="hljs-string"> rexponent_psi                       =-1.83,</span><br><span class="hljs-string"> rexponent_t                         =-1.83,</span><br><span class="hljs-string"> zsigma2_eps                         = 0.0833,</span><br><span class="hljs-string"> zsigma2_eta                         = 0.0833,</span><br><span class="hljs-string"> kminforc                            = 1,</span><br><span class="hljs-string"> kminforc                            = 1,</span><br><span class="hljs-string"> kminforct                           = 1,</span><br><span class="hljs-string"> lminforct                           = 1,</span><br><span class="hljs-string"> kmaxforc                            = 1000000,</span><br><span class="hljs-string"> lmaxforc                            = 1000000,</span><br><span class="hljs-string"> kmaxforct                           = 1000000,</span><br><span class="hljs-string"> lmaxforct                           = 1000000,</span><br><span class="hljs-string"> perturb_bdy                         = 0,</span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string">** Using DFI options (note this is a separate namelist record):</span><br><span class="hljs-string"></span><br><span class="hljs-string"> &amp;dfi_control</span><br><span class="hljs-string"> dfi_opt                             = 3,</span><br><span class="hljs-string"> dfi_nfilter                         = 7,</span><br><span class="hljs-string"> dfi_cutoff_seconds                  = 3600,</span><br><span class="hljs-string"> dfi_write_filtered_input            = .true.</span><br><span class="hljs-string"> dfi_write_dfi_history               = .false.</span><br><span class="hljs-string"> dfi_bckstop_year                    = 2000,</span><br><span class="hljs-string"> dfi_bckstop_month                   = 01,</span><br><span class="hljs-string"> dfi_bckstop_day                     = 24,</span><br><span class="hljs-string"> dfi_bckstop_hour                    = 10,</span><br><span class="hljs-string"> dfi_bckstop_minute                  = 00,</span><br><span class="hljs-string"> dfi_bckstop_second                  = 00,</span><br><span class="hljs-string"> dfi_fwdstop_year                    = 2000,</span><br><span class="hljs-string"> dfi_fwdstop_month                   = 01,</span><br><span class="hljs-string"> dfi_fwdstop_day                     = 24,</span><br><span class="hljs-string"> dfi_fwdstop_hour                    = 13,</span><br><span class="hljs-string"> dfi_fwdstop_minute                  = 00,</span><br><span class="hljs-string"> dfi_fwdstop_second                  = 00,</span><br><span class="hljs-string"> /</span><br><span class="hljs-string"></span><br><span class="hljs-string"> &amp;domains</span><br><span class="hljs-string"> time_step_dfi                       = 60</span><br><span class="hljs-string"></span><br><span class="hljs-string">** Using gridded nudging option (note this is a separate namelist record) for</span><br><span class="hljs-string">   upperair nudging</span><br><span class="hljs-string"></span><br><span class="hljs-string">** Upper air gridded nudging requires an file generated by the real</span><br><span class="hljs-string">   program.  Activating grid_fdda for the real program is adequate.</span><br><span class="hljs-string"></span><br><span class="hljs-string"> &amp;fdda</span><br><span class="hljs-string"> grid_fdda                           = 1,     1,     1,</span><br><span class="hljs-string"> gfdda_inname                        = &quot;wrffdda_d&lt;domain&gt;&quot;,</span><br><span class="hljs-string"> gfdda_end_h                         = 24,    24,    24,</span><br><span class="hljs-string"> gfdda_interval_m                    = 360,   360,   360,</span><br><span class="hljs-string"> fgdt                                = 0,     0,     0,</span><br><span class="hljs-string"> if_no_pbl_nudging_uv                = 0,     0,     0,</span><br><span class="hljs-string"> if_no_pbl_nudging_t                 = 1,     1,     1,</span><br><span class="hljs-string"> if_no_pbl_nudging_q                 = 1,     1,     1,</span><br><span class="hljs-string"> if_zfac_uv                          = 0,     0,     0,</span><br><span class="hljs-string">  k_zfac_uv                          = 10,   10,    10,</span><br><span class="hljs-string"> if_zfac_t                           = 0,     0,     0,</span><br><span class="hljs-string">  k_zfac_t                           = 10,   10,    10,</span><br><span class="hljs-string"> if_zfac_q                           = 0,     0,     0,</span><br><span class="hljs-string">  k_zfac_q                           = 10,   10,    10,</span><br><span class="hljs-string"> guv                                 = 0.0003,     0.0003,     0.0003,</span><br><span class="hljs-string"> gt                                  = 0.0003,     0.0003,     0.0003,</span><br><span class="hljs-string"> gq                                  = 0.0003,     0.0003,     0.0003,</span><br><span class="hljs-string"> if_ramping                          = 1,</span><br><span class="hljs-string"> dtramp_min                          = 60.0,</span><br><span class="hljs-string"> io_form_gfdda                       = 2,</span><br><span class="hljs-string"></span><br><span class="hljs-string">** Using gridded surface nudging option (note this is a separate namelist </span><br><span class="hljs-string">   record)</span><br><span class="hljs-string"></span><br><span class="hljs-string">** Note that upper-air and surface gridded nudging may be used together </span><br><span class="hljs-string">   or separately.  Surface nudging requires an input file generated by the</span><br><span class="hljs-string">   obsgrid program.</span><br><span class="hljs-string"></span><br><span class="hljs-string"> &amp;fdda</span><br><span class="hljs-string"> grid_sfdda                          = 1,     1,     1,</span><br><span class="hljs-string"> sgfdda_inname                       = &quot;wrfsfdda_d&lt;domain&gt;&quot;,</span><br><span class="hljs-string"> sgfdda_end_h                        = 24,    24,    24,</span><br><span class="hljs-string"> sgfdda_interval_m                   = 360,   360,   360,</span><br><span class="hljs-string"> io_form_sgfdda                      = 2,</span><br><span class="hljs-string"> guv_sfc                             = 0.0003,     0.0003,     0.0003,</span><br><span class="hljs-string"> gt_sfc                              = 0.0003,     0.0003,     0.0003,</span><br><span class="hljs-string"> gq_sfc                              = 0.0003,     0.0003,     0.0003,</span><br><span class="hljs-string"> rinblw                              = 250.,       250.,       250., </span><br><span class="hljs-string"></span><br><span class="hljs-string">** Using observation nudging option (note &amp;fdda is a separate namelist record):</span><br><span class="hljs-string"></span><br><span class="hljs-string"> &amp;time_control</span><br><span class="hljs-string"> auxinput11_interval_s               = 180 , 180 , 180</span><br><span class="hljs-string"> auxinput11_end_h                    = 6   , 6   , 6</span><br><span class="hljs-string"></span><br><span class="hljs-string"> &amp;fdda</span><br><span class="hljs-string"> obs_nudge_opt                       = 1,1,1,</span><br><span class="hljs-string"> max_obs                             = 150000,</span><br><span class="hljs-string"> fdda_start                          = 0.,  0.,  0.,</span><br><span class="hljs-string"> fdda_end                            = 720.,720.,720.,</span><br><span class="hljs-string"> obs_nudge_wind                      = 1,1,1,</span><br><span class="hljs-string"> obs_coef_wind                       = 6.E-4,6.E-4,6.E-4,</span><br><span class="hljs-string"> obs_nudge_temp                      = 1,1,1,</span><br><span class="hljs-string"> obs_coef_temp                       = 6.E-4,6.E-4,6.E-4,</span><br><span class="hljs-string"> obs_nudge_mois                      = 1,1,1,</span><br><span class="hljs-string"> obs_coef_mois                       = 6.E-4,6.E-4,6.E-4,</span><br><span class="hljs-string"> obs_rinxy                           = 240.,240.,180.,</span><br><span class="hljs-string"> obs_rinsig                          = 0.1,</span><br><span class="hljs-string"> obs_twindo                          = 0.6666667,0.6666667,0.6666667,</span><br><span class="hljs-string"> obs_npfi                            = 10,</span><br><span class="hljs-string"> obs_ionf                            = 2, 2, 2,</span><br><span class="hljs-string"> obs_idynin                          = 0,</span><br><span class="hljs-string"> obs_dtramp                          = 40.,</span><br><span class="hljs-string"> obs_prt_freq                        = 10, 10, 10,</span><br><span class="hljs-string"> obs_prt_max                         = 10</span><br><span class="hljs-string"> obs_ipf_errob                       = .true.</span><br><span class="hljs-string"> obs_ipf_nudob                       = .true.</span><br><span class="hljs-string"> obs_ipf_in4dob                      = .true</span><br><span class="hljs-string"> obs_no_pbl_nudge_uv                 = 0</span><br><span class="hljs-string"> obs_no_pbl_nudge_t                  = 0</span><br><span class="hljs-string"> obs_no_pbl_nudge_q                  = 0</span><br><span class="hljs-string"> obs_sfc_scheme_horiz                = 0</span><br><span class="hljs-string"> obs_sfc_scheme_vert                 = 0</span><br><span class="hljs-string"> obs_max_sndng_gap                   = 20</span><br><span class="hljs-string"> obs_nudgezfullr1_uv                 = 50</span><br><span class="hljs-string"> obs_nudgezrampr1_uv                 = 50</span><br><span class="hljs-string"> obs_nudgezfullr2_uv                 = 50</span><br><span class="hljs-string"> obs_nudgezrampr2_uv                 = 50</span><br><span class="hljs-string"> obs_nudgezfullr4_uv                 = -5000</span><br><span class="hljs-string"> obs_nudgezrampr4_uv                 = 50  </span><br><span class="hljs-string"> obs_nudgezfullr1_t                  = 50 </span><br><span class="hljs-string"> obs_nudgezrampr1_t                  = 50</span><br><span class="hljs-string"> obs_nudgezfullr2_t                  = 50</span><br><span class="hljs-string"> obs_nudgezrampr2_t                  = 50</span><br><span class="hljs-string"> obs_nudgezfullr4_t                  = -5000</span><br><span class="hljs-string"> obs_nudgezrampr4_t                  = 50  </span><br><span class="hljs-string"> obs_nudgezfullr1_q                  = 50 </span><br><span class="hljs-string"> obs_nudgezrampr1_q                  = 50</span><br><span class="hljs-string"> obs_nudgezfullr2_q                  = 50</span><br><span class="hljs-string"> obs_nudgezrampr2_q                  = 50</span><br><span class="hljs-string"> obs_nudgezfullr4_q                  = -5000</span><br><span class="hljs-string"> obs_nudgezrampr4_q                  = 50</span><br><span class="hljs-string"> obs_nudgezfullmin                   = 50</span><br><span class="hljs-string"> obs_nudgezrampmin                   = 50</span><br><span class="hljs-string"> obs_nudgezmax                       = 3000</span><br><span class="hljs-string"> obs_sfcfact                         = 1.0</span><br><span class="hljs-string"> obs_sfcfacr                         = 1.0</span><br><span class="hljs-string"> obs_dpsmx                           = 7.5</span><br><span class="hljs-string"> /</span><br><span class="hljs-string"></span><br><span class="hljs-string">** Using spectral nudging option </span><br><span class="hljs-string"></span><br><span class="hljs-string"> &amp;fdda</span><br><span class="hljs-string"> grid_fdda                           = 2,     2,     2,</span><br><span class="hljs-string"> gfdda_inname                        = &quot;wrffdda_d&lt;domain&gt;&quot;,</span><br><span class="hljs-string"> gfdda_end_h                         = 24,    24,    24,</span><br><span class="hljs-string"> gfdda_interval_m                    = 360,   360,   360,</span><br><span class="hljs-string"> fgdt                                = 0,     0,     0,</span><br><span class="hljs-string"> fgdtzero                            = 0,     0,     0,</span><br><span class="hljs-string"> if_no_pbl_nudging_uv                = 0,     0,     0,</span><br><span class="hljs-string"> if_no_pbl_nudging_t                 = 0,     0,     0,</span><br><span class="hljs-string"> if_no_pbl_nudging_ph                = 0,     0,     0,</span><br><span class="hljs-string"> if_zfac_uv                          = 0,     0,     0,</span><br><span class="hljs-string">  k_zfac_uv                          = 10,   10,    10,</span><br><span class="hljs-string"> if_zfac_t                           = 0,     0,     0,</span><br><span class="hljs-string">  k_zfac_t                           = 10,   10,    10,</span><br><span class="hljs-string"> if_zfac_ph                          = 0,     0,     0,</span><br><span class="hljs-string">  k_zfac_ph                          = 10,   10,    10,</span><br><span class="hljs-string"> dk_zfac_uv                          = 1,     1,     1,</span><br><span class="hljs-string"> dk_zfac_t                           = 1,     1,     1,</span><br><span class="hljs-string"> dk_zfac_ph                          = 1,     1,     1,</span><br><span class="hljs-string"> guv                                 = 0.0003,     0.0003,     0.0003,</span><br><span class="hljs-string"> gt                                  = 0.0003,     0.0003,     0.0003,</span><br><span class="hljs-string"> gph                                 = 0.0003,     0.0003,     0.0003,</span><br><span class="hljs-string"> xwavenum                            = 3,</span><br><span class="hljs-string"> ywavenum                            = 3,</span><br><span class="hljs-string"> if_ramping                          = 1,</span><br><span class="hljs-string"> dtramp_min                          = 60.0,</span><br><span class="hljs-string"> io_form_gfdda                       = 2,</span><br><span class="hljs-string"></span><br><span class="hljs-string">** Using adaptive time step option (add these in namelist record &amp;domains):</span><br><span class="hljs-string"></span><br><span class="hljs-string"> use_adaptive_time_step              = .true.,</span><br><span class="hljs-string"> step_to_output_time                 = .true.,</span><br><span class="hljs-string"> target_cfl                          = 1.2, 1.2, 1.2,</span><br><span class="hljs-string"> target_hcfl                         = .84, .84, .84,</span><br><span class="hljs-string"> max_step_increase_pct               = 5,   51,  51,</span><br><span class="hljs-string"> starting_time_step                  = -1,  -1,  -1,</span><br><span class="hljs-string"> max_time_step                       = 360, 120, 40,</span><br><span class="hljs-string"> min_time_step                       =  90,  30, 10,</span><br><span class="hljs-string"> adaptation_domain                   =  1,</span><br><span class="hljs-string"></span><br><span class="hljs-string">** Using automatic vortex-following option (tropical storm tracking only;</span><br><span class="hljs-string">   add these in namelist record &amp;domains):</span><br><span class="hljs-string"></span><br><span class="hljs-string"> vortex_interval                     = 15, 15, 15,</span><br><span class="hljs-string"> max_vortex_speed                    = 40, 40, 40,</span><br><span class="hljs-string"> corral_dist                         =  8, 15, 15,</span><br><span class="hljs-string"> track_level                         = 50000,</span><br><span class="hljs-string"></span><br><span class="hljs-string">** Miscellaneous physics options for namelist record &amp;physics:</span><br><span class="hljs-string"></span><br><span class="hljs-string">Topographic shading (only effective when grid sizes are a few kilometers)</span><br><span class="hljs-string"></span><br><span class="hljs-string"> slope_rad                           = 1,     1,     1,</span><br><span class="hljs-string"> topo_shading                        = 1,     1,     1,</span><br><span class="hljs-string"> shadlen                             = 25000, </span><br><span class="hljs-string"></span><br><span class="hljs-string">Setting threshold value for defining seaice if seaice is not in the input file:</span><br><span class="hljs-string"></span><br><span class="hljs-string"> seaice_threshold                    = 271,</span><br><span class="hljs-string"></span><br><span class="hljs-string">Switching off latent heating from a microphysics scheme (must also set cu_physics = 0):</span><br><span class="hljs-string"></span><br><span class="hljs-string"> no_mp_heating                       = 0,</span><br><span class="hljs-string"></span><br><span class="hljs-string">** Using precipiatiion bucket in a time interval (minutes):</span><br><span class="hljs-string"></span><br><span class="hljs-string"> prec_acc_dt                         = 60.</span><br><span class="hljs-string"></span><br><span class="hljs-string">** Using bucket accumulations for multi-year simulations (guideline: mean monthly accumulation)</span><br><span class="hljs-string"></span><br><span class="hljs-string"> bucket_mm                           = 100.</span><br><span class="hljs-string"> bucket_J                            = 1.e9</span><br><span class="hljs-string"></span><br><span class="hljs-string">** Optional gravitational settling of fog/cloud droplets (MYNN PBL only)</span><br><span class="hljs-string"></span><br><span class="hljs-string"> grav_settling                       = 1,       ; default 0</span><br><span class="hljs-string"></span><br><span class="hljs-string">** Using implicit gravity-wave damping option (add these in namelist record &amp;dynamics):</span><br><span class="hljs-string"></span><br><span class="hljs-string"> damp_opt                            = 3,</span><br><span class="hljs-string"> zdamp                               = 5000.,  5000.,  5000.,</span><br><span class="hljs-string"> dampcoef                            = 0.2,    0.2,    0.2</span><br><span class="hljs-string"></span><br><span class="hljs-string">** Using expanded boundary zone and exponential decay option (add or modify these in</span><br><span class="hljs-string">    namelist record &amp;bdy_control). </span><br><span class="hljs-string">    spec_zone is ALWAYS = 1 </span><br><span class="hljs-string">    relax_zone is ALWAYS = spec_bdy_width - spec_zone</span><br><span class="hljs-string"></span><br><span class="hljs-string">&amp;bdy_control</span><br><span class="hljs-string"> spec_bdy_width                      = 10,</span><br><span class="hljs-string"> specified                           = .true.,</span><br><span class="hljs-string"> spec_exp                            = 0.33</span><br><span class="hljs-string"></span><br><span class="hljs-string">For a tropical channel configuration, set the following:</span><br><span class="hljs-string"></span><br><span class="hljs-string"> specified                           = .true.,</span><br><span class="hljs-string"> periodic_x                          = .true.,</span><br><span class="hljs-string"></span><br><span class="hljs-string">** Using split lateral boundary files</span><br><span class="hljs-string">     The run-time flag multi_bdy_files must be set to TRUE (default is false), and the</span><br><span class="hljs-string">     lateral boundary files must have a date associated. When using the split LBC option,</span><br><span class="hljs-string">     there is ALWAYS and ONLY a single time LBC time in each file.</span><br><span class="hljs-string"></span><br><span class="hljs-string"> multi_bdy_files                     = .true.</span><br><span class="hljs-string"></span><br><span class="hljs-string">Also requires</span><br><span class="hljs-string">&amp;time_control</span><br><span class="hljs-string"> bdy_inname                          = &quot;wrfbdy_d&lt;domain&gt;_&lt;date&gt;&quot;</span><br><span class="hljs-string"></span><br><span class="hljs-string">** using io quilting option to improve output efficiency for large domain runs</span><br><span class="hljs-string">    (note that this is a separate namelist record):</span><br><span class="hljs-string"></span><br><span class="hljs-string"> &amp;namelist_quilt</span><br><span class="hljs-string"> nio_tasks_per_group = 2,</span><br><span class="hljs-string"> nio_groups = 1,</span><br><span class="hljs-string"></span><br><span class="hljs-string">** for tc bogusing:</span><br><span class="hljs-string">   Helpful hints</span><br><span class="hljs-string">   1) The TC bogus *MUST* only be run with a single processor: serial </span><br><span class="hljs-string">      (with or without a nest build option), or as a DM build with np=1.</span><br><span class="hljs-string">   2) Run the TC program for only the initial model time. Remember to copy </span><br><span class="hljs-string">      your metgrid file to a safe location and then let the TC scheme </span><br><span class="hljs-string">      generate the auxiliary files.</span><br><span class="hljs-string">   3) The TC program does not handle soil moisture or soil temperature </span><br><span class="hljs-string">      correctly. After running the TC program, use an NCL script to put the </span><br><span class="hljs-string">      modified fields back into the original metgrid file (remember that you</span><br><span class="hljs-string">      are keeping a pristine copy elsewhere). The modified fields to copy</span><br><span class="hljs-string">      are:  &quot;RH&quot;, &quot;TT&quot;, &quot;UU&quot;, &quot;VV&quot;, &quot;GHT&quot;, &quot;PRES&quot;, &quot;PMSL&quot;, &quot;PSFC&quot;.</span><br><span class="hljs-string">   4) The TC program runs quickly, only a few seconds. It is a good idea to </span><br><span class="hljs-string">      process multiple runs, and vary the TC initialization. It would be </span><br><span class="hljs-string">      reasonable to select the maximum wind speed (vmax_meters_per_second) </span><br><span class="hljs-string">      from 30 to 60 by 5, select the radius of maximum winds ((m), rmax) = </span><br><span class="hljs-string">      50000 to 200000 by 50000, and select a tuning parameter for the </span><br><span class="hljs-string">      vortex (vmax_ratio) = 0.5 to 0.9 by 0.1. Look at the resulting </span><br><span class="hljs-string">      bogus storms (sea level pressure, surface wind speeds, and </span><br><span class="hljs-string">      overall storm size), and choose the best.  </span><br><span class="hljs-string">   5) Remember to also consider starting the TC program at a later or</span><br><span class="hljs-string">      earlier time during your parameter space exploration.</span><br><span class="hljs-string">   6) The bogus storm will organize better if the initialization of the</span><br><span class="hljs-string">      tropical storm is entirely over water, and if the storm is able to </span><br><span class="hljs-string">      develop over water for several days.</span><br><span class="hljs-string">   7) After the metgrid file is finalized, and the real program is run,</span><br><span class="hljs-string">      use DFI in WRF. Removing and then introducing an entire bogus typhoon</span><br><span class="hljs-string">      is the definition of unbalanced. Running DFI for 2-3 hours back and forth</span><br><span class="hljs-string">      will be a benefit. For a successful implementation of a TC bogus storm in </span><br><span class="hljs-string">      WRF, the storm should not oscillate in size, should not be radiating </span><br><span class="hljs-string">      massive amounts of gravity waves, and should not rapidly weaken.</span><br><span class="hljs-string"></span><br><span class="hljs-string"> &amp;tc</span><br><span class="hljs-string"> insert_bogus_storm                  = .true.,</span><br><span class="hljs-string"> remove_storm                        = .false.,</span><br><span class="hljs-string"> num_storm                           = 1,</span><br><span class="hljs-string"> latc_loc                            = 15.,</span><br><span class="hljs-string"> lonc_loc                            = -90.,</span><br><span class="hljs-string"> vmax_meters_per_second              = 30,</span><br><span class="hljs-string"> rmax                                = 50000,</span><br><span class="hljs-string"> vmax_ratio                          = 0.5,</span><br><span class="hljs-string"> /</span><br><span class="hljs-string"></span><br><span class="hljs-string">** for regional climate surface diagnostics such as max/min/mean/std of T2/Q2/wind/rainfall</span><br><span class="hljs-string">between selected output times (e.g. daily) in auxhist3</span><br><span class="hljs-string"></span><br><span class="hljs-string"> &amp;time_control</span><br><span class="hljs-string"> output_diagnostics      = 1</span><br><span class="hljs-string"> auxhist3_outname        = &#x27;</span>wrfxtrm_d&lt;domain&gt;_&lt;<span class="hljs-built_in">date</span>&gt;<span class="hljs-string">&#x27;</span><br><span class="hljs-string"> io_form_auxhist3        = 2</span><br><span class="hljs-string"> auxhist3_interval       = 1440</span><br><span class="hljs-string"> frames_per_auxhist3     = 1</span><br><span class="hljs-string"> /</span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string">** for pressure-level (and some surface) diagnostics, output is on stream 23,</span><br><span class="hljs-string">where the listed pressure levels are in Pa.  For the height level interpolation,</span><br><span class="hljs-string">the unit is stream 22.</span><br><span class="hljs-string"></span><br><span class="hljs-string"> &amp;time_control</span><br><span class="hljs-string"> io_form_auxhist23                   =  2,</span><br><span class="hljs-string"> auxhist23_interval                  = 30,   30,    30,</span><br><span class="hljs-string"> frames_per_auxhist23                =  1,    1,     1, </span><br><span class="hljs-string"> auxhist23_outname                   = &quot;PLEVS_d&lt;domain&gt;_&lt;date&gt;&quot;</span><br><span class="hljs-string"> /</span><br><span class="hljs-string"></span><br><span class="hljs-string"> &amp;diags</span><br><span class="hljs-string"> p_lev_diags                         = 1</span><br><span class="hljs-string"> num_press_levels                    = 4</span><br><span class="hljs-string"> press_levels                        = 85000, 70000, 50000, 25000</span><br><span class="hljs-string"> use_tot_or_hyd_p                    = 2</span><br><span class="hljs-string"> /</span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string">** for height-level diagnostics, output is on stream 22 (negative values</span><br><span class="hljs-string">for z_levels means AGL, so -500 is 500 m AGL, and 10000 is 10 km).</span><br><span class="hljs-string"></span><br><span class="hljs-string"> &amp;time_control</span><br><span class="hljs-string"> io_form_auxhist22                   =  2,</span><br><span class="hljs-string"> auxhist22_interval                  = 30,   30,    30,</span><br><span class="hljs-string"> frames_per_auxhist22                =  1,    1,     1, </span><br><span class="hljs-string"> auxhist22_outname                   = &quot;ZLEVS_d&lt;domain&gt;_&lt;date&gt;&quot;</span><br><span class="hljs-string"> /</span><br><span class="hljs-string"></span><br><span class="hljs-string"> &amp;diags</span><br><span class="hljs-string"> z_lev_diags                         = 1</span><br><span class="hljs-string"> num_z_levels                        = 2</span><br><span class="hljs-string"> z_levels                            = -500, 10000</span><br><span class="hljs-string"> /</span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string">** For solar diagnostics, 2-D fields of variables relevant to solar forecasting are output </span><br><span class="hljs-string">when option solar_diagnostics is activated in diags section of namelist, as shown below.</span><br><span class="hljs-string">Also, if tslist is present when solar_diagnostics is activated, then these same variables</span><br><span class="hljs-string">are output to the time series files for the location(s) specified in tslist.</span><br><span class="hljs-string">All variables are calculated in phys/module_diag_solar.F and defined in registry.solar_fields</span><br><span class="hljs-string"></span><br><span class="hljs-string"> &amp;diags</span><br><span class="hljs-string"> solar_diagnostics                   =  1</span><br><span class="hljs-string"> /</span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string">** Using different flux formulation for tropical storm simulations</span><br><span class="hljs-string">   (best for grid spacing less than 2 km) </span><br><span class="hljs-string">   simple 1-D ocean mixed layer, or University of Miami 3DPWP ocean model</span><br><span class="hljs-string">   (add these in namelist record &amp;physics):</span><br><span class="hljs-string"></span><br><span class="hljs-string"> isftcflx                            = 1,</span><br><span class="hljs-string"> sf_ocean_physics                    = 0 (off), 1 (OML), 2 (3D PWP)</span><br><span class="hljs-string"> oml_hml0                            = 50,</span><br><span class="hljs-string"> oml_gamma                           = 0.14</span><br><span class="hljs-string"> omdt                                = 1</span><br><span class="hljs-string"></span><br><span class="hljs-string"> Add these in the &amp;domains section.  Note that the example here is for</span><br><span class="hljs-string"> a warm ocean: ocean_z is the depth of each layer (m), from the surface</span><br><span class="hljs-string"> downward; the associated temperature is ocean_t (K); and the associated </span><br><span class="hljs-string"> salinity is ocean_s (ppt).</span><br><span class="hljs-string"></span><br><span class="hljs-string"> ocean_levels                        = 30,</span><br><span class="hljs-string"> ocean_z                             =       5.,       15.,       25.,       35.,       45.,       55.,</span><br><span class="hljs-string">                                            65.,       75.,       85.,       95.,      105.,      115.,</span><br><span class="hljs-string">                                           125.,      135.,      145.,      155.,      165.,      175.,</span><br><span class="hljs-string">                                           185.,      195.,      210.,      230.,      250.,      270.,</span><br><span class="hljs-string">                                           290.,      310.,      330.,      350.,      370.,      390.</span><br><span class="hljs-string"> ocean_t                             = 302.3493,  302.3493,  302.3493,  302.1055,  301.9763,  301.6818,</span><br><span class="hljs-string">                                       301.2220,  300.7531,  300.1200,  299.4778,  298.7443,  297.9194,</span><br><span class="hljs-string">                                       297.0883,  296.1443,  295.1941,  294.1979,  293.1558,  292.1136,</span><br><span class="hljs-string">                                       291.0714,  290.0293,  288.7377,  287.1967,  285.6557,  284.8503,</span><br><span class="hljs-string">                                       284.0450,  283.4316,  283.0102,  282.5888,  282.1674,  281.7461</span><br><span class="hljs-string"> ocean_s                             =  34.0127,   34.0127,   34.0127,   34.3217,   34.2624,   34.2632,</span><br><span class="hljs-string">                                        34.3240,   34.3824,   34.3980,   34.4113,   34.4220,   34.4303,</span><br><span class="hljs-string">                                        34.6173,   34.6409,   34.6535,   34.6550,   34.6565,   34.6527,</span><br><span class="hljs-string">                                        34.6490,   34.6446,   34.6396,   34.6347,   34.6297,   34.6247,</span><br><span class="hljs-string">                                        34.6490,   34.6446,   34.6396,   34.6347,   34.6297,   34.6247</span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string">References for 3D ocean circulation model:</span><br><span class="hljs-string">Lee, C.-Y., and S. S. Chen, 2013: Stable Boundary Layer and Its Impact on Tropical Cyclone Structure in a Coupled Atmosphere-Ocean Model, Mon. Wea. Rev.</span><br><span class="hljs-string">Price, J. F., T. B. Sanford, and G. Z. Forristal, 1994: Forced stage response to a moving hurricane. J. Phy. Oceanogr., 24, 233-260.</span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string">** Using the ACOM Forward Lagrangian trajectory calculation:</span><br><span class="hljs-string"></span><br><span class="hljs-string">&amp;domains</span><br><span class="hljs-string"> num_traj                            = 25,</span><br><span class="hljs-string"></span><br><span class="hljs-string">&amp;physics</span><br><span class="hljs-string"> traj_opt                            = 1,</span><br><span class="hljs-string"> dm_has_traj                         = .true.,  ..true.,  .true.</span><br><span class="hljs-string"> </span><br><span class="hljs-string"></span><br><span class="hljs-string">For domain #1, the file must &quot;wrfinput_traj_d01&quot; exist in the working directory. Similarly for domain 2, 3, etc. Each domain</span><br><span class="hljs-string">has a separate file for a namelist.</span><br><span class="hljs-string"></span><br><span class="hljs-string">&amp;traj_default</span><br><span class="hljs-string"> traj_def%start_time        = &#x27;</span>2000-01-24_12:00:00<span class="hljs-string">&#x27;,</span><br><span class="hljs-string"> traj_def%stop_time         = &#x27;</span>2000-01-25_12:00:00<span class="hljs-string">&#x27;,</span><br><span class="hljs-string"> traj_def%dyn_name(1:6)     = &#x27;</span>p<span class="hljs-string">&#x27;, &#x27;</span>T<span class="hljs-string">&#x27;, &#x27;</span>z<span class="hljs-string">&#x27;, &#x27;</span>u<span class="hljs-string">&#x27;, &#x27;</span>v<span class="hljs-string">&#x27;, &#x27;</span>w<span class="hljs-string">&#x27;,</span><br><span class="hljs-string"> traj_def%hyd_name(1)       = &#x27;</span>QVAPOR<span class="hljs-string">&#x27;,</span><br><span class="hljs-string">/</span><br><span class="hljs-string">  </span><br><span class="hljs-string">&amp;traj_spec</span><br><span class="hljs-string"> traj_type%start_time = &#x27;</span>2000-01-24_12:00:00<span class="hljs-string">&#x27;,  &#x27;</span>2000-01-24_12:00:00<span class="hljs-string">&#x27;,  </span><br><span class="hljs-string">                        &#x27;</span>2000-01-24_12:00:00<span class="hljs-string">&#x27;,  &#x27;</span>2000-01-24_12:00:00<span class="hljs-string">&#x27;,  </span><br><span class="hljs-string">                        &#x27;</span>2000-01-24_12:00:00<span class="hljs-string">&#x27;,  &#x27;</span>2000-01-24_12:00:00<span class="hljs-string">&#x27;,  </span><br><span class="hljs-string">                        &#x27;</span>2000-01-24_12:00:00<span class="hljs-string">&#x27;,  &#x27;</span>2000-01-24_12:00:00<span class="hljs-string">&#x27;,  </span><br><span class="hljs-string">                        &#x27;</span>2000-01-24_12:00:00<span class="hljs-string">&#x27;,  &#x27;</span>2000-01-24_12:00:00<span class="hljs-string">&#x27;,  </span><br><span class="hljs-string">                        &#x27;</span>2000-01-24_12:00:00<span class="hljs-string">&#x27;,  </span><br><span class="hljs-string"> traj_type%stop_time  = &#x27;</span>2000-01-25_12:00:00<span class="hljs-string">&#x27;,  &#x27;</span>2000-01-25_12:00:00<span class="hljs-string">&#x27;,  </span><br><span class="hljs-string">                        &#x27;</span>2000-01-25_12:00:00<span class="hljs-string">&#x27;,  &#x27;</span>2000-01-25_12:00:00<span class="hljs-string">&#x27;,  </span><br><span class="hljs-string">                        &#x27;</span>2000-01-25_12:00:00<span class="hljs-string">&#x27;,  &#x27;</span>2000-01-25_12:00:00<span class="hljs-string">&#x27;,  </span><br><span class="hljs-string">                        &#x27;</span>2000-01-25_12:00:00<span class="hljs-string">&#x27;,  &#x27;</span>2000-01-25_12:00:00<span class="hljs-string">&#x27;,  </span><br><span class="hljs-string">                        &#x27;</span>2000-01-25_12:00:00<span class="hljs-string">&#x27;,  &#x27;</span>2000-01-25_12:00:00<span class="hljs-string">&#x27;,  </span><br><span class="hljs-string">                        &#x27;</span>2000-01-25_12:00:00<span class="hljs-string">&#x27;,  </span><br><span class="hljs-string"> traj_type%lev        = 60., 60., 60., 60., 60., 60., 60., 60., 60., 60., 60., </span><br><span class="hljs-string"> traj_type%lon        = -79.88470, -79.74551, -79.60422, -79.46072, </span><br><span class="hljs-string">                        -79.31503, -79.16708, -79.01682, -78.86417, </span><br><span class="hljs-string">                        -78.70911, -78.55151, -78.39142,</span><br><span class="hljs-string"> traj_type%lat        =  29.18063,  29.70515,  30.23069,  30.75718,  </span><br><span class="hljs-string">                         31.28461,  31.81292,  32.34208,  32.87204,  </span><br><span class="hljs-string">                         33.40276,  33.93421,  34.46631,</span><br><span class="hljs-string">/</span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string">** Vertical nesting</span><br><span class="hljs-string"></span><br><span class="hljs-string">The WRF model now supports vertical nesting for a coincident (online)</span><br><span class="hljs-string">model simulation (during a single model run, differing numbers of</span><br><span class="hljs-string">vertical levels may be used per domain).  This is activated with a switch</span><br><span class="hljs-string">to turn on the option (vert_refine_method).  The namelist array eta_levels</span><br><span class="hljs-string">is manually filled in for each domain.  Below is an example for two </span><br><span class="hljs-string">domains.  </span><br><span class="hljs-string"></span><br><span class="hljs-string">NOTE: The user is restricted to using the RRTM LW and Dudhia SW radiation schemes.</span><br><span class="hljs-string">NOTE: The user is restricted from using the hybrid vertical coordinate.</span><br><span class="hljs-string"></span><br><span class="hljs-string"> &amp;domains</span><br><span class="hljs-string"> max_dom                             = 2,</span><br><span class="hljs-string"> e_vert                              = 35,    45,</span><br><span class="hljs-string"> eta_levels(1:35)                    = 1., 0.993, 0.983, 0.97, 0.954, 0.934, 0.909, 0.88, 0.8406663, 0.8013327, </span><br><span class="hljs-string">                                       0.761999, 0.7226653, 0.6525755, 0.5877361, 0.5278192, 0.472514, </span><br><span class="hljs-string">                                       0.4215262, 0.3745775, 0.3314044, 0.2917579, 0.2554026, 0.2221162, </span><br><span class="hljs-string">                                       0.1916888, 0.1639222, 0.1386297, 0.1156351, 0.09525016, 0.07733481, </span><br><span class="hljs-string">                                       0.06158983, 0.04775231, 0.03559115, 0.02490328, 0.0155102, 0.007255059, 0.</span><br><span class="hljs-string"> eta_levels(36:81)                   = 1.0000, 0.9946, 0.9875, 0.9789, 0.9685, 0.9562, 0.9413, 0.9238, 0.9037, 0.8813, 0.8514,</span><br><span class="hljs-string">                                       0.8210, 0.7906, 0.7602, 0.7298, 0.6812, 0.6290, 0.5796, 0.5333, 0.4901, 0.4493, 0.4109,</span><br><span class="hljs-string">                                       0.3746, 0.3412, 0.3098, 0.2802, 0.2524, 0.2267, 0.2028, 0.1803, 0.1593, 0.1398, 0.1219,</span><br><span class="hljs-string">                                       0.1054, 0.0904, 0.0766, 0.0645, 0.0534, 0.0433, 0.0341, 0.0259, 0.0185, 0.0118, 0.0056, 0.    </span><br><span class="hljs-string"> vert_refine_method                  = 0,     2,</span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string">** Tropopause data level of max winds data, for program real.exe only</span><br><span class="hljs-string"></span><br><span class="hljs-string">When information (mostly NCEP supplied through GFS or NAM) is available </span><br><span class="hljs-string">in the Grib2 file, AND extracted with ungrib, the metgrid program inserts</span><br><span class="hljs-string">flag information into the data stream that is input by real.  The real</span><br><span class="hljs-string">program is able to use the available u, v, T, height fields (each may be on</span><br><span class="hljs-string">a tropopause .OR. the level of max winds) in the vertical interpolation.</span><br><span class="hljs-string">To &quot;tune&quot; the data, the user may select a level below which the max wind </span><br><span class="hljs-string">inforamtion is ignored.  The default is 300 hPa.  The user may also </span><br><span class="hljs-string">select the level that when exceeded the trop and maxw fields are ignored</span><br><span class="hljs-string">(due to the horizontal pressure difference detecting a user-defined</span><br><span class="hljs-string">discontinuity, and the metgrid horizontal interpolation across the </span><br><span class="hljs-string">discontinuity would be suspect).  By default, this option is turned off.</span><br><span class="hljs-string">The user may choose to individually activate the vertical interpolation of</span><br><span class="hljs-string">either the level of max winds .OR. the tropopause level.</span><br><span class="hljs-string"></span><br><span class="hljs-string">Default (all pressure units Pa):</span><br><span class="hljs-string"> &amp;domains</span><br><span class="hljs-string"> maxw_horiz_pres_diff                = 5000</span><br><span class="hljs-string"> trop_horiz_pres_diff                = 5000</span><br><span class="hljs-string"> maxw_above_this_level               = 30000</span><br><span class="hljs-string"> use_maxw_level                      = 0 (0=do not use level, 1 = use level)</span><br><span class="hljs-string"> use_trop_level                      = 0 (0=do not use level, 1 = use level)</span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string">** Using aerosol option aer_opt = 2:</span><br><span class="hljs-string"></span><br><span class="hljs-string">&amp;physics</span><br><span class="hljs-string"> aer_opt            = 2,</span><br><span class="hljs-string"> aer_type           = 1,</span><br><span class="hljs-string"> aer_aod550_opt     = 1,</span><br><span class="hljs-string"> aer_aod550_val     = 0.12,</span><br><span class="hljs-string"> aer_angexp_opt     = 1,</span><br><span class="hljs-string"> aer_angexp_val     = 1.3,</span><br><span class="hljs-string"> aer_ssa_opt        = 1,</span><br><span class="hljs-string"> aer_ssa_val        = 0.85,</span><br><span class="hljs-string"> aer_asy_opt        = 1,</span><br><span class="hljs-string"> aer_asy_val        = 0.90,</span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string">** Using Jimenez wind-farm scheme</span><br><span class="hljs-string"></span><br><span class="hljs-string">In the &amp;physics namelist record, set the MAX_DOM value:</span><br><span class="hljs-string"> windfarm                            = 1,    1,    1</span><br><span class="hljs-string"></span><br><span class="hljs-string">Also in the directory with namelist.input, is the file defining the</span><br><span class="hljs-string">specifics of the wind turbine type: wind-turbine-1.tbl</span><br><span class="hljs-string"></span><br><span class="hljs-string">The location of wind turbines are specified as lat lon, and </span><br><span class="hljs-string">the turbine type: windturbines.txt</span><br><span class="hljs-string"></span><br><span class="hljs-string">** Using stochastic schemes</span><br><span class="hljs-string">&amp;stoch</span><br><span class="hljs-string"> skebs              = 1, 1, 1, </span><br><span class="hljs-string"> rand_perturb       = 1, 1, 1, </span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string">** Using kfcupscheme cu_physics (cumulus scheme option). This has been tested with</span><br><span class="hljs-string">the CAM radiation scheme and is not recommended with other radiation schemes.</span><br><span class="hljs-string">Regarding cu_rad_feedback, users want the parameterized clouds to affect radiation.  </span><br><span class="hljs-string">Turning it off is only useful as a sensitivity study to determine the importance of </span><br><span class="hljs-string">that effect. Regarding shallowcu_forced_ra option, setting it to true will override </span><br><span class="hljs-string">the cloud fraction calculations to a prescribed maximum cloud fraction (a value of 0.36)</span><br><span class="hljs-string">which can be changed by the user for sensitivity testing purposes.</span><br><span class="hljs-string"></span><br><span class="hljs-string">&amp;physics</span><br><span class="hljs-string"> cu_physics          = 10,    10,    10,</span><br><span class="hljs-string"> ra_lw_physics       = 3,     3,     3,</span><br><span class="hljs-string"> ra_sw_physics       = 3,     3,     3,</span><br><span class="hljs-string"> cu_rad_feedback     =.true.,.true.,.true.,</span><br><span class="hljs-string"> shallowcu_forced_ra = .false.,.false.,.false.,</span><br><span class="hljs-string"> numBins             = 21,    21,    21,</span><br><span class="hljs-string"> thBinSize           = 0.1,   0.1,   0.1,</span><br><span class="hljs-string"> rBinSize            = 0.0001,0.0001,0.0001,</span><br><span class="hljs-string"> minDeepFreq         = 0.333, 0.333, 0.333,</span><br><span class="hljs-string"> minShallowFreq      = 0.01,  0.01,  0.01, </span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string">** To write out an input file during the model simulation.</span><br><span class="hljs-string"></span><br><span class="hljs-string">&amp;time_control</span><br><span class="hljs-string"> write_input                         = .TRUE.,</span><br><span class="hljs-string"> inputout_interval_m                 = 60, 60, 60</span><br><span class="hljs-string"> input_outname                       = &quot;wrfinput_out_d&lt;domain&gt;_&lt;date&gt;&quot;</span><br><span class="hljs-string"> inputout_begin_h                    = 3, 6, 6</span><br><span class="hljs-string"> inputout_end_h                      = 9, 6, 6</span><br><span class="hljs-string"></span><br><span class="hljs-string">** To use climatological data in Thompson microphysics option 28: in addition to</span><br><span class="hljs-string">process additional data in metgrid, use these:</span><br><span class="hljs-string"></span><br><span class="hljs-string">&amp;domains</span><br><span class="hljs-string"> wif_input_opt                       = 1</span><br><span class="hljs-string"> num_wif_levels                      = 30</span><br><span class="hljs-string"></span><br><span class="hljs-string">&amp;physics</span><br><span class="hljs-string"> mp_physics                          = 28,    28,    28,</span><br><span class="hljs-string"> use_aero_icbc                       = .true.</span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string">** The hybrid vertical coordinate (HVC) requires three pieces:</span><br><span class="hljs-string">1. The WRF and real codes must be built with HVC activated (./configure -hyb)</span><br><span class="hljs-string">2. The eta location (etac) at which the eta levels higher up in the atmosphere</span><br><span class="hljs-string">   become isobaric must be defined (suggested default in Registry).</span><br><span class="hljs-string">3. The run-time option to select the HVC (hybrid_opt, default is OFF): </span><br><span class="hljs-string">&amp;dynamics</span><br><span class="hljs-string"> hybrid_opt          = 2,</span><br><span class="hljs-string"> etac                = 0.2,</span><br><span class="hljs-string"></span><br><span class="hljs-string">** New mechanism to specify physics:</span><br><span class="hljs-string"></span><br><span class="hljs-string">&amp;physics</span><br><span class="hljs-string"> physics_suite = &#x27;</span>CONUS<span class="hljs-string">&#x27;</span><br><span class="hljs-string"></span><br><span class="hljs-string">which is equivalent to</span><br><span class="hljs-string"></span><br><span class="hljs-string"> mp_physics         = 8,</span><br><span class="hljs-string"> cu_physics         = 6,</span><br><span class="hljs-string"> ra_lw_physics      = 4,</span><br><span class="hljs-string"> ra_sw_physics      = 4,</span><br><span class="hljs-string"> bl_pbl_physics     = 2,</span><br><span class="hljs-string"> sf_sfclay_physics  = 2,</span><br><span class="hljs-string"> sf_surface_physics = 2,</span><br><span class="hljs-string"></span><br><span class="hljs-string">&amp;physics</span><br><span class="hljs-string"> physics_suite = &#x27;</span>TROPICAL<span class="hljs-string">&#x27;</span><br><span class="hljs-string"></span><br><span class="hljs-string">which is equivalent to</span><br><span class="hljs-string"></span><br><span class="hljs-string"> mp_physics         = 6,</span><br><span class="hljs-string"> cu_physics         = 16,</span><br><span class="hljs-string"> ra_lw_physics      = 4,</span><br><span class="hljs-string"> ra_sw_physics      = 4,</span><br><span class="hljs-string"> bl_pbl_physics     = 1,</span><br><span class="hljs-string"> sf_sfclay_physics  = 91,</span><br><span class="hljs-string"> sf_surface_physics = 2,</span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string">To overwrite the cu_physics option for a second nest, set </span><br><span class="hljs-string"></span><br><span class="hljs-string"> &amp;physics</span><br><span class="hljs-string"> physics_suite                       = &#x27;</span>tropical<span class="hljs-string">&#x27;</span><br><span class="hljs-string"> cu_physics                          = -1,    -1,     0,</span><br><span class="hljs-string"> ...</span><br><span class="hljs-string"></span><br><span class="hljs-string">** New way to automatically choose levels (default auto_levels_opt=2)</span><br><span class="hljs-string"> max_dz                              = 1000.</span><br><span class="hljs-string"> auto_levels_opt                     = 2</span><br><span class="hljs-string"> dzbot                               = 50.</span><br><span class="hljs-string"> dzstretch_s                         = 1.3</span><br><span class="hljs-string"> dzstretch_u                         = 1.1</span><br><span class="hljs-string"></span><br><span class="hljs-string">** Using the scale-adaptive SMS-3DTKE subgrid turbulent mixing scheme: </span><br><span class="hljs-string"> &amp;physics</span><br><span class="hljs-string">   bl_pbl_physics = 0,</span><br><span class="hljs-string">   sf_sfclay_physics = 1(or 5, 91), </span><br><span class="hljs-string"> /</span><br><span class="hljs-string"> &amp;dynamics</span><br><span class="hljs-string">   diff_opt       = 2,</span><br><span class="hljs-string">   km_opt         = 5, </span><br><span class="hljs-string"> /</span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string">** Using lightning option</span><br><span class="hljs-string"> &amp;physics</span><br><span class="hljs-string"> lightning_option                    = 2,</span><br><span class="hljs-string"> iccg_method                         = 1,</span><br><span class="hljs-string"> iccg_prescribed_num                 = 2,</span><br><span class="hljs-string"> iccg_prescribed_den                 = 1,</span><br><span class="hljs-string"> cldtop_adjustment                   = 0,</span><br><span class="hljs-string"> lightning_dt                        = 5,   ; default: time_step</span><br><span class="hljs-string"> lightning_start_seconds             = 600,</span><br><span class="hljs-string"> flashrate_factor                    = 1.0,</span><br><span class="hljs-string"> ltng_temp_upper                    = -45., ; used by lnox_opt=2</span><br><span class="hljs-string"> ltng_temp_lower                    = -15., ; used by lnox_opt=2</span><br><span class="hljs-string"> /</span><br><span class="hljs-string"> </span><br><span class="hljs-string"> &amp;chem</span><br><span class="hljs-string"> lnox_opt                           = 2,</span><br><span class="hljs-string"> n_ic                               = 200,</span><br><span class="hljs-string"> n_cg                               = 200,</span><br><span class="hljs-string"> lnox_passive                       = .false.,</span><br><span class="hljs-string"> /</span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string">** Using the irrigation parameterizations:</span><br><span class="hljs-string">&amp;physics</span><br><span class="hljs-string"> sf_surf_irr_scheme                  = 3,</span><br><span class="hljs-string"> irr_daily_amount                    = 5.7,</span><br><span class="hljs-string"> irr_start_hour                      = 2,</span><br><span class="hljs-string"> irr_num_hours                       = 3,</span><br><span class="hljs-string"> irr_start_julianday                 = 135,</span><br><span class="hljs-string"> irr_end_julianday                   = 350,</span><br><span class="hljs-string"> irr_ph                              = 0,</span><br><span class="hljs-string"> irr_freq                            = 1,</span><br><span class="hljs-string">/</span><br></code></pre></td></tr></table></figure><h2 id="namelist.input-d0115km">namelist.input d01=15km</h2><p><a href="https://github.com/wrf-model/WRF/blob/master/test/em_real/namelist.input">Git em_real/namelist.input</a></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><code class="hljs sh">&amp;time_control<br>run_days                            = 0,<br>run_hours                           = 36,<br>run_minutes                         = 0,<br>run_seconds                         = 0,<br>start_year                          = 2019, 2019,<br>start_month                         = 09,   09, <br>start_day                           = 04,   04,<br>start_hour                          = 12,   12,<br>end_year                            = 2019, 2019,<br>end_month                           = 09,   09,<br>end_day                             = 06,   06,<br>end_hour                            = 00,   00,<br>interval_seconds                    = 10800<br>input_from_file                     = .<span class="hljs-literal">true</span>.,.<span class="hljs-literal">true</span>.,<br>history_interval                    = 60,  60,<br>frames_per_outfile                  = 1, 1,<br>restart                             = .<span class="hljs-literal">false</span>.,<br>restart_interval                    = 7200,<br>io_form_history                     = 2<br>io_form_restart                     = 2<br>io_form_input                       = 2<br>io_form_boundary                    = 2<br>/<br><br>&amp;domains<br>time_step                           = 90,<br>time_step_fract_num                 = 0,<br>time_step_fract_den                 = 1,<br>max_dom                             = 2,<br>e_we                                = 150,    220,<br>e_sn                                = 130,    214,<br>e_vert                              = 45,     45,<br>dzstretch_s                         = 1.1<br>p_top_requested                     = 5000,<br>num_metgrid_levels                  = 34,<br>num_metgrid_soil_levels             = 4,<br>dx                                  = 15000,<br>dy                                  = 15000,<br>grid_id                             = 1,     2,<br>parent_id                           = 0,     1,<br>i_parent_start                      = 1,     53,<br>j_parent_start                      = 1,     25,<br>parent_grid_ratio                   = 1,     3,<br>parent_time_step_ratio              = 1,     3,<br>feedback                            = 1,<br>smooth_option                       = 0<br>/<br><br>&amp;physics<br>physics_suite                       = <span class="hljs-string">&#x27;CONUS&#x27;</span><br>mp_physics                          = -1,    -1,<br>cu_physics                          = -1,    -1,<br>ra_lw_physics                       = -1,    -1,<br>ra_sw_physics                       = -1,    -1,<br>bl_pbl_physics                      = -1,    -1,<br>sf_sfclay_physics                   = -1,    -1,<br>sf_surface_physics                  = -1,    -1,<br>radt                                = 15,    15,<br>bldt                                = 0,     0,<br>cudt                                = 0,     0,<br>icloud                              = 1,<br>num_land_cat                        = 21,<br>sf_urban_physics                    = 0,     0,<br>fractional_seaice                   = 1,<br>/<br><br>&amp;fdda<br>/<br><br>&amp;dynamics<br>hybrid_opt                          = 2, <br>w_damping                           = 0,<br>diff_opt                            = 2,      2,<br>km_opt                              = 4,      4,<br>diff_6th_opt                        = 0,      0,<br>diff_6th_factor                     = 0.12,   0.12,<br>base_temp                           = 290.<br>damp_opt                            = 3,<br>zdamp                               = 5000.,  5000.,<br>dampcoef                            = 0.2,    0.2,<br>khdif                               = 0,      0,<br>kvdif                               = 0,      0,<br>non_hydrostatic                     = .<span class="hljs-literal">true</span>., .<span class="hljs-literal">true</span>.,<br>moist_adv_opt                       = 1,      1,<br>scalar_adv_opt                      = 1,      1,<br>gwd_opt                             = 1,      0,<br>/<br><br>&amp;bdy_control<br>spec_bdy_width                      = 5,<br>specified                           = .<span class="hljs-literal">true</span>.<br>/<br><br>&amp;grib2<br>/<br><br>&amp;namelist_quilt<br>nio_tasks_per_group = 0,<br>nio_groups = 1,<br>/<br></code></pre></td></tr></table></figure><h2 id="namelist.input-d014km">namelist.input d01=4km</h2><p><a href="https://github.com/wrf-model/WRF/blob/master/test/em_real/namelist.input.4km">Git em_real/namelist.input.4km</a></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><code class="hljs sh">&amp;time_control<br>run_days                            = 0,<br>run_hours                           = 12,<br>run_minutes                         = 0,<br>run_seconds                         = 0,<br>start_year                          = 2001, 2001, 2001,<br>start_month                         = 06,   06,   06,<br>start_day                           = 11,   11,   11,<br>start_hour                          = 12,   12,   12,<br>end_year                            = 2001, 2001, 2001,<br>end_month                           = 06,   06,   06,<br>end_day                             = 12,   12,   12,<br>end_hour                            = 12,   12,   12,<br>interval_seconds                    = 10800<br>input_from_file                     = .<span class="hljs-literal">true</span>.,.<span class="hljs-literal">true</span>.,.<span class="hljs-literal">true</span>.,<br>history_interval                    = 60,   60,   60,<br>frames_per_outfile                  = 1,    1,    1,<br>restart                             = .<span class="hljs-literal">false</span>.,<br>restart_interval                    = 1440,<br>io_form_history                     = 2<br>io_form_restart                     = 2<br>io_form_input                       = 2<br>io_form_boundary                    = 2<br>/<br><br>&amp;domains<br>time_step                           = 24,<br>time_step_fract_num                 = 0,<br>time_step_fract_den                 = 1,<br>max_dom                             = 1,<br>e_we                                = 225,   112,   94,<br>e_sn                                = 202,   97,    91,<br>e_vert                              = 35,    35,    35,<br>p_top_requested                     = 5000,<br>num_metgrid_levels                  = 32<br>num_metgrid_soil_levels             = 4,<br>dx                                  = 4000,<br>dy                                  = 4000,<br>grid_id                             = 1,     2,     3,<br>parent_id                           = 0,     1,     2,<br>i_parent_start                      = 1,     31,    30,<br>j_parent_start                      = 1,     17,    30,<br>parent_grid_ratio                   = 1,     3,     3,<br>parent_time_step_ratio              = 1,     3,     3,<br>feedback                            = 1,<br>smooth_option                       = 0<br>/<br><br>&amp;physics<br>mp_physics                          = 8,     8,     8,<br>ra_lw_physics                       = 4,     4,     4,<br>ra_sw_physics                       = 4,     4,     4,<br>radt                                = 10,    10,    10,<br>sf_sfclay_physics                   = 1,     1,     1,<br>sf_surface_physics                  = 2,     2,     2,<br>bl_pbl_physics                      = 1,     1,     1,<br>bldt                                = 0,     0,     0,<br>ysu_topdown_pblmix                  = 1,<br>cu_physics                          = 0,     0,     0,<br>cudt                                = 0,     0,     0,<br>icloud                              = 1,<br>num_land_cat                        = 21,<br>sf_urban_physics                    = 0,     0,     0,<br>/<br><br>&amp;fdda<br>/<br><br>&amp;dynamics<br>hybrid_opt                          = 2, <br>w_damping                           = 0,<br>diff_opt                            = 1,      1,      1,<br>km_opt                              = 4,      4,      4,<br>diff_6th_opt                        = 0,      0,      0,<br>diff_6th_factor                     = 0.12,   0.12,   0.12,<br>base_temp                           = 290.<br>damp_opt                            = 3,<br>zdamp                               = 5000.,  5000.,  5000.,<br>dampcoef                            = 0.2,    0.2,    0.2<br>khdif                               = 0,      0,      0,<br>kvdif                               = 0,      0,      0,<br>non_hydrostatic                     = .<span class="hljs-literal">true</span>., .<span class="hljs-literal">true</span>., .<span class="hljs-literal">true</span>.,<br>moist_adv_opt                       = 2,      2,      2,<br>scalar_adv_opt                      = 2,      2,      2,<br>/<br><br>&amp;bdy_control<br>spec_bdy_width                      = 5,<br>specified                           = .<span class="hljs-literal">true</span>.,<br>/<br><br>&amp;grib2<br>/<br><br>&amp;namelist_quilt<br>nio_tasks_per_group = 0,<br>nio_groups = 1,<br>/<br></code></pre></td></tr></table></figure><h2 id="namelist.input.pbl-les">namelist.input.PBL-LES</h2><p><a href="https://github.com/wrf-model/WRF/blob/master/test/em_real/namelist.input.pbl-les">Git PBL LES</a></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><code class="hljs sh">&amp;time_control<br>run_days                            = 0,<br>run_hours                           = 12,<br>run_minutes                         = 0,<br>run_seconds                         = 0,<br>start_year                          = 2001, 2001, 2001,<br>start_month                         = 06,   06,   06,<br>start_day                           = 11,   11,   11,<br>start_hour                          = 12,   12,   12,<br>start_minute                        = 00,   00,   00,<br>start_second                        = 00,   00,   00,<br>end_year                            = 2001, 2001, 2001,<br>end_month                           = 06,   06,   06,<br>end_day                             = 12,   12,   12,<br>end_hour                            = 12,   12,   12,<br>end_minute                          = 00,   00,   00,<br>end_second                          = 00,   00,   00,<br>interval_seconds                    = 10800<br>input_from_file                     = .<span class="hljs-literal">true</span>.,.<span class="hljs-literal">true</span>.,.<span class="hljs-literal">true</span>.,<br>history_interval                    = 60,   60,   60,<br>frames_per_outfile                  = 1,    1,    1,<br>restart                             = .<span class="hljs-literal">false</span>.,<br>restart_interval                    = 60,<br>io_form_history                     = 2<br>io_form_restart                     = 2<br>io_form_input                       = 2<br>io_form_boundary                    = 2<br>/<br><br>&amp;domains<br>time_step                           = 5,<br>time_step_fract_num                 = 0,<br>time_step_fract_den                 = 1,<br>max_dom                             = 3,<br>e_we                                = 225,   112,   94,<br>e_sn                                = 202,   97,    91,<br>e_vert                              = 35,    35,    35,<br>p_top_requested                     = 5000,<br>num_metgrid_levels                  = 40<br>num_metgrid_soil_levels             = 4,<br>dx                                  = 1000,<br>dy                                  = 1000,<br>grid_id                             = 1,     2,     3,<br>parent_id                           = 0,     1,     2,<br>i_parent_start                      = 1,     31,    30,<br>j_parent_start                      = 1,     17,    30,<br>parent_grid_ratio                   = 1,     3,     3,<br>parent_time_step_ratio              = 1,     3,     3,<br>feedback                            = 1,<br>smooth_option                       = 0<br>/<br><br>&amp;physics<br>mp_physics                          = 8,     8,     8,<br>ra_lw_physics                       = 4,     4,     4,<br>ra_sw_physics                       = 4,     4,     4,<br>radt                                = 1,     1,     1,<br>sf_sfclay_physics                   = 1,     1,     1,<br>sf_surface_physics                  = 2,     2,     2,<br>bl_pbl_physics                      = 1,     0,     0,<br>bldt                                = 0,     0,     0,<br>ysu_topdown_pblmix                  = 1,<br>cu_physics                          = 0,     0,     0,<br>cudt                                = 0,     0,     0,<br>icloud                              = 1,<br>num_land_cat                        = 21,<br>sf_urban_physics                    = 0,     0,     0,<br>/<br><br>&amp;dynamics<br>hybrid_opt                          = 2, <br>w_damping                           = 0,<br>diff_opt                            = 2,      2,      2,<br>km_opt                              = 4,      3,      3,<br>diff_6th_opt                        = 0,      0,      0,<br>diff_6th_factor                     = 0.12,   0.12,   0.12,<br>base_temp                           = 290.<br>damp_opt                            = 3,<br>zdamp                               = 5000.,  5000.,  5000.,<br>dampcoef                            = 0.2,    0.2,    0.2<br>khdif                               = 0,      0,      0,<br>kvdif                               = 0,      0,      0,<br>non_hydrostatic                     = .<span class="hljs-literal">true</span>., .<span class="hljs-literal">true</span>., .<span class="hljs-literal">true</span>.,<br>moist_adv_opt                       = 2,      2,      2,<br>scalar_adv_opt                      = 2,      2,      2,<br>/<br><br>&amp;bdy_control<br>spec_bdy_width                      = 5,<br>specified                           = .<span class="hljs-literal">true</span>.,<br>/<br><br>&amp;namelist_quilt<br>nio_tasks_per_group = 0,<br>nio_groups = 1,<br>/<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>WRF</category>
      
    </categories>
    
    
    <tags>
      
      <tag>WRF</tag>
      
      <tag>namelist.input</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>WRF | WRF namelist.input: Best Practices</title>
    <link href="/2023/04/30/WRF_namelist_input_Best_Practices/"/>
    <url>/2023/04/30/WRF_namelist_input_Best_Practices/</url>
    
    <content type="html"><![CDATA[<h1 id="wrf-namelist.input-best-practices">WRF namelist.input: Best Practices</h1><p><a href="https://www2.mmm.ucar.edu/wrf/users/namelist_best_prac_wrf.html">https://www2.mmm.ucar.edu/wrf/users/namelist_best_prac_wrf.html</a></p><p><a href="https://github.com/wrf-model/WRF/blob/master/run/README.namelist">Git: WRF/run/README.namelist</a></p><ol type="1"><li>In namelist.input, multiple columns are used for multiple domains; however max_dom determines how many columns will be used. For example, if you use 3 columns, but only set max_dom = 2, the last column will be ignored.</li><li>Not all parameters have mulitple columns. In the descriptions below, it has been specified if a parameter is to be used for multiple domains (max_dom). If this is not shown, then you must only specify one value (in the first column), or you will receive a namelist error upon running.</li></ol><h2 id="domains">&amp;domains</h2><h3 id="time_step">time_step</h3><p>It is recommended to use a value of <strong>5-6xDX (in km)</strong> for a typical case. If you are using many vertical levels and/or with map-scale-factors much larger than 1, you will need to use a smaller time_step. If you are getting CFL errors that stop your run, this means your run has become unstable and <strong>you may need to decrease this value to about 4xDX (or perhaps even 3xDX)</strong>. It makes things easier if you use a time step that evenly divides into your history_interval, so that your output times will be evenly spaced.</p><h3 id="e_vert-max_dom">e_vert (max_dom)</h3><p>The number of vertical (or Eta) levels onto which real.exe will interpolate the incoming data. This number must be the same for each domain. It is not recommended to have fewer than 35 levels.** Typically 40-60 levels is recommended**.</p><h3 id="p_top_requested">p_top_requested</h3><p>The pressure top (in Pa) to use in the model. This level must be available in the incoming WPS data. &gt; The <strong>default and recommended value is 5000 Pa</strong>, and it is not suggested to use a level any lower (in the atmosphere) than this.</p><h3 id="num_metgrid_levels">num_metgrid_levels</h3><p>look for the value near the top of the log.ncdump file. &gt; ncdump -h met_em.d01.<date> &gt;&amp; log.ncdump</p><h3 id="feedback">feedback</h3><p>This determines whether feedback will be used when using nesting, and should be used to determine whether the run will be a one-way or two-way nested run. When feedback is on, the values of the coarse domain are overwritten by the values of the variables (average of cell values for mass points, and average of the cell-face values for horizontal momentum points) in the nest at the coincident points. For masked fields, only the single point value at the collocating points is fed back. If the parent_grid_ratio is even, an arbitrary choice of the southwest corner point value is used for feedback. This is the reason it is recommended to use an odd parent_grid_ratio with this option. When feedback is off , it is equivalent to a one-way nested run, since nest results are not reflected in the parent domain.</p><p><strong>usually, set is feedback = 0 (off)</strong></p><h3 id="smooth_option">smooth_option</h3><p>Determines whether smoothing is to be used for the parent domain in the area of the nest <strong>if feedback is on (feedback = 1)</strong>. Three options are available: - 0 = no smoothing - 1 = 1-2-1 smoothing - 2 = smoothing-desmoothing. <strong>It is typically recommended to keep this option set to 0.</strong></p><h2 id="physics">&amp;physics</h2><h3 id="mp_physics-max_dom">mp_physics (max_dom)</h3><p>WSM6 or ...</p><h3 id="ra_lw_physics-max_dom">ra_lw_physics (max_dom)</h3><p>This should be set to the same option for each domain. <strong>We recommend using the RRTMG option (option 4).</strong></p><h3 id="ra_sw_physics-max_dom">ra_sw_physics (max_dom)</h3><p>This should be set to the same option for each domain. <strong>We recommend using the RRTMG option (option 4).</strong></p><h3 id="radt-max_dom">radt (max_dom)</h3><p>Minutes between radiation physics calls. It is recommended to <strong>use 1 minute per km of dx</strong> (e.g., <strong>set to 10 for 10km parent domain</strong>). If you are running a high-resolution domain and compute time is a concern, then it is okay to use radt = 10-15 min, along with setting 'swint_opt'.<strong>Use the same value for all domains</strong>.</p><h3 id="sf_sfclay_physics-max_dom">sf_sfclay_physics (max_dom)</h3><p>Surface layer physics option. A given option may only work with a certain PBL option. This should be set to <strong>the same option for each domain</strong>.</p><h3 id="sf_surface_physics-max_dom">sf_surface_physics (max_dom)</h3><p>Land surface model (LSM) option. This choice must be made prior to running real.exe. num_soil_layers must also match this option. This should be set to the <strong>same option for each domain</strong>. If you decide to change this option later, <strong>make sure num_soil_layers is set correctly for the new option, and you will need to re-run real.exe</strong>.</p><h3 id="num_soil_layers">num_soil_layers</h3><p>If you choose to use a different LSM later, you must make sure this value is set correctly for the new model, and you will need to re-run real.exe.</p><h3 id="bl_pbl_physics-max_dom">bl_pbl_physics (max_dom)</h3><p>This option <strong>should be used when your domain grid size is &gt; 500m</strong>.</p><h3 id="bldt-max_dom">bldt (max_dom)</h3><p>Minutes between boundary layer physics calls. This should be set to the <strong>same option for each domain</strong>. <strong>The typical/recommended value is 0 (every time step)</strong>.</p><blockquote><p><strong>bldt (max_dom) = 0, ! minutes between boundary-layer physics calls</strong></p></blockquote><h3 id="cu_physics-max_dom">cu_physics (max_dom)</h3><ul><li>For a grid size &gt;10 km, a cumulus scheme is necessary.</li><li>It is not necessary when the grid size is &lt; 4km.</li><li>In <strong>between 4km and 10km is a somewhat gray area</strong>, so avoid this range if possible.<ul><li>If you must use this size, however, you can try the <strong>GF and MSKF schemes (options 3 and 11), as these schemes are scale-aware</strong>.</li></ul></li></ul><h3 id="cudt">cudt ?</h3><p>Minutes between cumulus physics calls. The<strong>typical/recommended value is every time step</strong>, as <strong>most cumulus schemes are cheap to run</strong>. Note: for the KF scheme this is also used for averaging time for vertical velocity trigger. This options is not used by the G3 or GD schemes.</p><blockquote><p><strong>cudt (max_dom) = 0, ! minutes between cumulus physics calls</strong></p></blockquote><h3 id="isfflx">isfflx ?</h3><p>Option that determines heat and moisture fluxes from the surface. Use this option if you wish to turn off surface sensible and latent heat fluxes for some of the surface physics options. It may also be used to control how surface fluxes are used in idealized simulations (e.g., LES).</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh">isfflx                              = 1,! heat and moisture fluxes from the surface<br>                                                 (only works <span class="hljs-keyword">for</span> sf_sfclay_physics = 1,5,7,11)<br>                                                 1 = with fluxes from the surface <br>                                                 0 = no flux from the surface<br>                                                     with bl_pbl_physics=0 this uses tke_drag_coefficient<br>                                                     and tke_heat_flux <span class="hljs-keyword">in</span> vertical diffusion<br>                                                 2 = use drag from sf_sfclay_physics and heat flux from<br>                                                     tke_heat_flux with bl_pbl_physics=0<br></code></pre></td></tr></table></figure><blockquote><p><strong>isfflx = 1,</strong></p></blockquote><h3 id="ifsnow">ifsnow ?</h3><p>This option can be turned off to remove snow effects for the simple soil model (sf_surface_physics = 1).</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">ifsnow                              = 1,! snow-cover effects<br>                                                 (only works <span class="hljs-keyword">for</span> sf_surface_physics = 1)<br>                                                 1 = with snow-cover effect<br>                                                 0 = without snow-cover effect<br></code></pre></td></tr></table></figure><blockquote><p><strong>ifsnow = 1,</strong></p></blockquote><h3 id="icloud">icloud ?</h3><p>Option to compute cloud fraction for radiation.</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sh">icloud                              = 1,! cloud effect to the optical depth <span class="hljs-keyword">in</span> radiation<br>                                                 (only works <span class="hljs-keyword">for</span> ra_sw_physics = 1,4 and ra_lw_physics = 1,4)<br>                                                 Since 3.6, this also controls the cloud fraction options<br>                                                 1 = with cloud effect, and use cloud fraction option 1<br>                                                     (Xu-Randall method) <br>                                                 0 = without cloud effect<br>                                                 2 = with cloud effect, and use cloud fraction option 2 (0/1 based<br>                                                     on threshold<br>                                                 3 = with cloud effect, and use cloud fraction option 3, based on<br>                                                     Sundqvist et al. (1989) (since 3.7)<br></code></pre></td></tr></table></figure><blockquote><p><strong>icloud = 1,</strong></p></blockquote><p>or consider the icloud = 3 that may be better.</p><h3 id="surface_input_source">surface_input_source</h3><p>Where landuse and soil category data come from. Available options are: <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh">surface_input_source                = 3,! <span class="hljs-built_in">where</span> landuse and soil category data come from:<br>                                                 1 = WPS/geogrid but with dominant categories recomputed<br>                                                 2 = GRIB data from another model (only possible<br>                                                     (VEGCAT/SOILCAT are <span class="hljs-keyword">in</span> met_em files from WPS)<br>                                                 3 = use dominant land and soil categories from WPS/geogrid (default since 3.8)<br></code></pre></td></tr></table></figure></p><h3 id="num_land_cat">num_land_cat</h3><p>The number of land categories in the input static/geogrid data. This must match what's produced in WPS/geogrid. Available options are: <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh">num_land_cat                        = 21,      ! number of land categories <span class="hljs-keyword">in</span> input data.<br>                                                 24 - <span class="hljs-keyword">for</span> USGS (default); 20 <span class="hljs-keyword">for</span> MODIS<br>                                                 28 - <span class="hljs-keyword">for</span> USGS <span class="hljs-keyword">if</span> including lake category<br>                                                 21 - <span class="hljs-keyword">for</span> MODIS <span class="hljs-keyword">if</span> including lake category (default since 3.8)<br>                                      40 - <span class="hljs-keyword">for</span> NCLD<br></code></pre></td></tr></table></figure> and may be 5x for LCZ dataset (Urban).</p><h3 id="sf_urban_physics-max_dom">sf_urban_physics (max_dom)</h3><p>This value <strong>must be the same for each domain, and it must be set for each domain.</strong></p><h2 id="dynamics">&amp;dynamics</h2><h3 id="w_damping">w_damping ??</h3><p>Vertical velocity damping flag. Options are 1=with damping; 0=without damping. <strong>For real-time/operational runs, this should always be turned on for model stability</strong> (it is only activated when required.) For budget studies, do not use this option.</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">w_damping                           = 0,       ! vertical velocity damping flag (<span class="hljs-keyword">for</span> operational use)<br>                                                 0 = without damping<br>                                                 1 = with    damping<br></code></pre></td></tr></table></figure><h3 id="diff_opt-max_dom">diff_opt (max_dom) ?</h3><p>Turbulence and mixing option.</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sh">diff_opt(max_dom)                   = 1,! turbulence and mixing option:<br>                                                 0 = no turbulence or explicit<br>                                                     spatial numerical filters (km_opt IS IGNORED).<br>                                                 1 = evaluates 2nd order<br>                                                     diffusion term on coordinate surfaces.<br>                                                     uses kvdif <span class="hljs-keyword">for</span> vertical diff unless PBL option<br>                                                     is used. may be used with km_opt = 1 and 4.<br>                                                     (= 1, recommended <span class="hljs-keyword">for</span> real-data cases)<br>                                                 2 = evaluates mixing terms <span class="hljs-keyword">in</span><br>                                                     physical space (stress form) (x,y,z).<br>                                                     turbulence parameterization is chosen<br>                                                     by specifying km_opt.<br></code></pre></td></tr></table></figure><blockquote><p><strong>diff_opt = 1, 1, 1,</strong></p></blockquote><h3 id="km_opt-max_dom">km_opt (max_dom) ?</h3><p>Eddy coefficient option.</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sh">km_opt(max_dom)                     = 4,! eddy coefficient option<br>                                                 1 = constant (use khdif kvdif)<br>                                                 2 = 1.5 order TKE closure (3D)<br>                                                 3 = Smagorinsky first order closure (3D)<br>                                                     Note: option 2 and 3 are not recommended <span class="hljs-keyword">for</span> DX &gt; 2 km<br>                                                 4 = horizontal Smagorinsky first order closure<br>                                                     (recommended <span class="hljs-keyword">for</span> real-data cases)<br>                                                 5 = SMS-3DTKE scale-adaptive LES/PBL scheme. It must be<br>                                                     used with diff_opt = 2. PBL schemes must be turned off<br>                                                     (bl_pbl_physics=0). It can work with sf_sfclay_physics = 1, 5, 91.<br></code></pre></td></tr></table></figure><blockquote><p><strong>km_opt = 4, 4, 4,</strong></p></blockquote><h3 id="diff_6th_opt">diff_6th_opt ?</h3><p>6th order numerical diffusion option.</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">diff_6th_opt (max_dom)              = 0,       ! 6th-order numerical diffusion<br>                                                 0 = no 6th-order diffusion (default)<br>                                                 1 = 6th-order numerical diffusion (not recommended)<br>                                                 2 = 6th-order numerical diffusion but prohibit up-gradient diffusion<br></code></pre></td></tr></table></figure><blockquote><p><strong>diff_6th_opt = 0, 0, 0,</strong></p></blockquote><h3 id="diff_6th_factor">diff_6th_factor ?</h3><p>6th order numerical diffusion non-dimensional rate. The maximum value is 1.0, which corresponds to complete removal of 2dx wave in one timestep.</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">diff_6th_factor (max_dom)           = 0.12,    ! 6th-order numerical diffusion non-dimensional rate (max value 1.0<br>                                                     corresponds to complete removal of 2dx wave <span class="hljs-keyword">in</span> one timestep)<br></code></pre></td></tr></table></figure><blockquote><p><strong>diff_6th_factor = 0.12, 0.12, 0.12,</strong></p></blockquote><h3 id="base_temp">base_temp ?</h3><p>Base state sea-level (surface) temperature (in K). This option can help to improve simulations when the model top is higher than 20 km (~ 50 mb). Note: This option is only available for real data, and em-only. This is a representative temperature at sea-level in the middle of your domain, regardless of the topography height at that point. <strong>Typical values range from 270-300 K</strong>. This value must stay the same through initialization, model runs, and restarts.</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">base_temp                           = 290.,    ! real-data, em ONLY, base sea-level temp (K)<br></code></pre></td></tr></table></figure><blockquote><p><strong>base_temp = 290.,</strong></p></blockquote><h3 id="damp_opt">damp_opt ?</h3><p>Upper-level damping flag.</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh">damp_opt                            = 0,! upper level damping flag <br>                                                 0 = without damping<br>                                                 1 = with diffusive damping, maybe used <span class="hljs-keyword">for</span> real-data cases <br>                                                     (dampcoef nondimensional ~0.01-0.1)<br>                                                 2 = with Rayleigh  damping (dampcoef inverse time scale [1/s] e.g. .003; idealized <span class="hljs-keyword">case</span> only<br>                                                     not <span class="hljs-keyword">for</span> real-data cases)<br>                                                 3 = with w-Rayleigh damping (dampcoef inverse time scale [1/s] e.g. .2; <br>                                                     <span class="hljs-keyword">for</span> real-data cases)<br></code></pre></td></tr></table></figure><blockquote><p><strong>damp_opt = 0,</strong></p></blockquote><h3 id="zdamp-max_dom">zdamp (max_dom) ?</h3><p>Damping depth (in meters) from model top. <strong>(default is 5000.)</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">zdamp (max_dom)                     = 5000.,! damping depth (m) from model top<br></code></pre></td></tr></table></figure><blockquote><p><strong>z_damp = 5000., 5000., 5000.,</strong></p></blockquote><h3 id="dampcoef-max_dom">dampcoef (max_dom) ??</h3><p>Damping coefficient (also see damp_opt above)</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">dampcoef (max_dom)                  = 0.,! damping coefficient (see above)<br></code></pre></td></tr></table></figure><blockquote><p><strong>dampcoef = 0.2, 0.2, 0.2,</strong></p></blockquote><h3 id="khdif-max_dom">khdif (max_dom) ?</h3><p>Horizontal diffusion constant (m^2/s)</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">khdif (max_dom)                     = 0,; horizontal diffusion constant (m^2/s). A typical value should be 0.1*DX <span class="hljs-keyword">in</span> meters.<br></code></pre></td></tr></table></figure><h3 id="kvdif-max_dom">kvdif (max_dom) ?</h3><p>Vertical diffusion constant (m^2/s)</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">kvdif (max_dom)                     = 0,! vertical diffusion constant (m^2/s). A typical value should be 100.<br></code></pre></td></tr></table></figure><h3 id="non_hydrostatic-max_dom">non_hydrostatic (max_dom) ??</h3><p>Whether running the model in hydrostatic or non-hydrotstatic (default) mode.</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">non_hydrostatic (max_dom)           = .<span class="hljs-literal">true</span>.,! whether running the model <span class="hljs-keyword">in</span> hydrostatic or non-hydro mode<br></code></pre></td></tr></table></figure><h3 id="moist_adv_opt-max_dom">moist_adv_opt (max_dom)</h3><p>Positive-definite or monotonic advection to help eliminate over/under prediction of moisture. Option are: - 0 = advection with no bounds or filters in place - <strong>1 = positive-definite advection of moisure (default)</strong> - 2 = monotonic option</p><h3 id="scalar_adv_opt-max_dom">scalar_adv_opt (max_dom)</h3><p>Positive-definite advection of scalars. Options are: - 0 = advection with no bounds or filters in place - <strong>1 = positive-definite advection of moisure (default)</strong> - 2 = monotonic option</p><h2 id="bdy_control">&amp;bdy_control</h2><h3 id="spec_bdy_width">spec_bdy_width</h3><p>The number of rows for specified boundary value nudging. This value is the total of 'spec_zone' and 'relax_zone' (see below). <strong>A wider boundary zone may work better for coarser driving data</strong>.</p><blockquote><p><strong>spec_bdy_width = 5,</strong></p></blockquote><h3 id="spec_zone">spec_zone</h3><p>The number of points in specified zone (specific boundary condition option). Leave this <strong>set to the default of 1</strong>.</p><blockquote><p><strong>spec_zone = 1,</strong></p></blockquote><h3 id="relax_zone">relax_zone</h3><p>The number of points in relaxation zone (specific boundary condition option). A <strong>wider boundary zone may work better for coarser driving data</strong>.</p><blockquote><p><strong>relax_zone = 4,</strong></p></blockquote><h3 id="specified-max_dom">specified (max_dom)</h3><p>Specified boundary conditions.</p><blockquote><p>The first row and column are specified with external model values (spec_zone = 1, which should not be changed). The rows and columns in relax_zone have values blended from an external model and WRF. The value of relax_zone may be changed, as long as spec_bdy_width = spec_zone + relax_zone. This can be used with periodic_x in tropical channel simulations.</p></blockquote><p><strong>This can only be turned on (.true.) for domain 01 - must be false for all other domains. This is for real data cases only</strong>.</p><blockquote><p><strong>specified = .true., .false., .false.,</strong></p></blockquote><h3 id="nested-max_dom">nested (max_dom)</h3><p>Nested boundary conditions. This <strong>must be set to .true. for nests.</strong> This can be used for real or idealized cases.</p><blockquote><p><strong>nested = .false., .true., .true.,</strong></p></blockquote>]]></content>
    
    
    <categories>
      
      <category>WRF</category>
      
    </categories>
    
    
    <tags>
      
      <tag>WRF</tag>
      
      <tag>namelist.input</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>zsh &amp; oh-my-zsh</title>
    <link href="/2023/04/30/zsh_oh_my_zsh/"/>
    <url>/2023/04/30/zsh_oh_my_zsh/</url>
    
    <content type="html"><![CDATA[<h1 id="zsh-oh-my-zsh">zsh &amp; oh-my-zsh</h1><p>The pre-installed shell of most Linux distributions is bash. But, zsh is more powerfull tool on the terminal.</p><h2 id="zsh">zsh</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">sudo</span> apt install zsh<br><br><span class="hljs-comment"># change the default shell</span><br><span class="hljs-built_in">sudo</span> chsh -s $(<span class="hljs-built_in">which</span> zsh) $(<span class="hljs-built_in">whoami</span>)<br></code></pre></td></tr></table></figure><p>Note: Because the Shell can set different default values ​​according to each account, so referring to the syntax of this article, a whoami technique is used to dynamically obtain the name of the currently logged-in account through the command to set it.</p><h3 id="install-oh-my-zsh">Install oh-my-zsh</h3><p>After installing zsh in the previous step, we can start to adjust the command line appearance settings we want, but the original zsh was too difficult to set up, so it didn’t receive much attention when it first appeared many years ago, until someone wrote a set The framework called oh-my-zsh helps everyone use zsh, and zsh became popular. Now almost all zsh useful tools support oh-my-zsh, so of course it is necessary to install this thing</p><p>Installation <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">sh -c <span class="hljs-string">&quot;<span class="hljs-subst">$(curl -fsSL https://raw.githubusercontent.com/robbyrussell/oh-my-zsh/master/tools/install.sh)</span>&quot;</span><br></code></pre></td></tr></table></figure> After execution, if there is no error message, it means success, and you will find more folders of oh-my-zsh ~/.oh-my-zsh</p><p>However, oh-my-zsh has a lot of built-in themes, and there are many screenshots on its github wiki for reference &gt; https://github.com/ohmyzsh/ohmyzsh/wiki/Themes</p><p>It is very simple to switch the built-in theme, directly modify your ~/.zshrc, and change the original ZSH_THEME="robbyrussell" to what you want</p><h3 id="edit-.zshrc">Edit .zshrc</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># some more ls aliases</span><br><span class="hljs-built_in">alias</span> ll=<span class="hljs-string">&#x27;ls -alF&#x27;</span><br><span class="hljs-built_in">alias</span> la=<span class="hljs-string">&#x27;ls -A&#x27;</span><br><span class="hljs-built_in">alias</span> l=<span class="hljs-string">&#x27;ls -CF&#x27;</span><br><br><span class="hljs-comment"># export TERM=&#x27;xterm-256color&#x27;</span><br><span class="hljs-comment"># # To determine the prompt format, use the $PS1 variable.</span><br><span class="hljs-comment"># PS1=&quot;%&#123;$fg[red]%&#125;%n%&#123;$reset_color%&#125;@%&#123;$fg[green]%&#125;%m %&#123;$fg[yellow]%&#125;%(5~|%-1~/.../%3~|%4~) %&#123;$reset_color%&#125;%% &quot;</span><br></code></pre></td></tr></table></figure><blockquote><p>ZSH_THEME=”agnoster” # Try changing robbyrussell to agnoster After any zsh settings are modified, the following commands must be executed to take effect</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">exec</span> <span class="hljs-variable">$SHELL</span><br></code></pre></td></tr></table></figure><h3 id="conda-problem">Conda problem</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs sh">CommandNotFoundError: Your shell has not been properly configured to use <span class="hljs-string">&#x27;conda activate&#x27;</span>.<br>To initialize your shell, run<br><br>    $ conda init &lt;SHELL_NAME&gt;<br><br>Currently supported shells are:<br>  - bash<br>  - fish<br>  - tcsh<br>  - xonsh<br>  - zsh<br>  - powershell<br><br>See <span class="hljs-string">&#x27;conda init --help&#x27;</span> <span class="hljs-keyword">for</span> more information and options.<br>IMPORTANT: You may need to close and restart your shell after running <span class="hljs-string">&#x27;conda init&#x27;</span>.<br></code></pre></td></tr></table></figure><p>do <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">conda init zsh<br></code></pre></td></tr></table></figure></p><h3 id="zsh-autosuggestions">zsh-autosuggestions</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">git <span class="hljs-built_in">clone</span> https://github.com/zsh-users/zsh-autosuggestions <span class="hljs-variable">$&#123;ZSH_CUSTOM:-~/.oh-my-zsh/custom&#125;</span>/plugins/zsh-autosuggestions<br></code></pre></td></tr></table></figure><p>In .zshrc, &gt; plugins=(zsh-autosuggestions) and then, source ~/.zshrc</p><p>Usage &gt; If you think it is correct, you can press CTRL+F to accept it</p><h3 id="quick-jump-cd--">quick jump: cd -</h3><p>As mentioned earlier, switching between different paths is a headache in command line work. In addition to the abbreviation completion mentioned above, is there a faster way for me to immediately switch to a certain path I recently jumped to? path? Of course there is the <strong>"cd -"</strong> command</p><p>After inputting cd followed by a minus sign, press tab once to list the recent paths visited after this login, and then enter the number according to the prompt below and press Enter to pass, for example, input:** $ cd -5 &lt; Press Enter&gt;** to jump to the ~/software/libclang-python3 path. Of course, instead of entering numbers, you can press tab again to enter the selection mode, use the up and down keys or ctrl+n/p to select, press Enter to confirm, and ctrl+g to return.</p><h3 id="jump-d">jump: d</h3><p>Zsh's directory jump is more intelligent, you don't need to enter cd, just enter the path directly. .. means back one directory, ../../ means back two levels, and so on. (The function of ... is the same as that of ../../) Enter d to list all directories visited by the current session, and then press the number prompted to enter the corresponding directory. <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh">~ &gt; d<br>0 ~ <br>1 ~/Applications <br>2 ~/.proxychains <br>3 /opt/homebrew-cask/Caskroom<br>~ &gt; 1<br>~/Applications<br></code></pre></td></tr></table></figure></p><h2 id="zsh-mkdirsource...-not-found">zsh mkdir/source/...: not found</h2><p>Using bash for all script, &gt; #!/bin/bash</p><h2 id="building-zsh-without-root">Building zsh without root</h2><blockquote><p>No terminal handling library found</p></blockquote><p>Have to install <strong>ncurses</strong> <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">wget https://invisible-island.net/ncurses/#download_ncurses<br>ex<br></code></pre></td></tr></table></figure> output is <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sh">=== output ===<br>** Configuration summary <span class="hljs-keyword">for</span> NCURSES 6.3 20211021:<br><br>       extended funcs: <span class="hljs-built_in">yes</span><br>       xterm terminfo: xterm-new<br><br>        bin directory: /home/wpsze/zsh/ncurses/bin<br>        lib directory: /home/wpsze/zsh/ncurses/lib<br>    include directory: /home/wpsze/zsh/ncurses/include/ncurses<br>        man directory: /home/wpsze/zsh/ncurses/share/man<br>   terminfo directory: /home/wpsze/zsh/ncurses/share/terminfo<br><br>** Include-directory is not <span class="hljs-keyword">in</span> a standard location<br>=====<br></code></pre></td></tr></table></figure></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs sh">wget -O zsh.tar.xz https://sourceforge.net/projects/zsh/files/latest/download --no-check-certificate<br>tar -xvf zsh.tar<br><span class="hljs-built_in">cd</span> zsh<br><br>INSTALLATION_PATH=<span class="hljs-string">&#x27;/home/wpsze/zsh/ncurses/&#x27;</span><br><span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$INSTALLATION_PATH</span>/bin/:<span class="hljs-variable">$PATH</span><br><span class="hljs-built_in">export</span> LD_LIBRARY_PATH=<span class="hljs-variable">$INSTALLATION_PATH</span>/lib:<span class="hljs-variable">$LD_LIBRARY_PATH</span><br><span class="hljs-built_in">export</span> CFLAGS=-I<span class="hljs-variable">$INSTALLATION_PATH</span>/include<br><br><span class="hljs-built_in">export</span> CPPFLAGS=<span class="hljs-string">&quot;-I<span class="hljs-variable">$INSTALLATION_PATH</span>/include&quot;</span> <br><span class="hljs-built_in">export</span> LDFLAGS=<span class="hljs-string">&quot;-L<span class="hljs-variable">$INSTALLATION_PATH</span>/lib&quot;</span><br><br>./configure --prefix=<span class="hljs-variable">$HOME</span>/zsh<br>make <br>make install<br></code></pre></td></tr></table></figure><p>Error <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">/usr/bin/ld: /home/wpsze/zsh/ncurses//lib/libncurses.a(comp_captab.o): relocation R_X86_64_32 against `.rodata<span class="hljs-string">&#x27; can not be used when making a shared object; recompile with -fPIC</span><br><span class="hljs-string">/usr/bin/ld: final link failed: Nonrepresentable section on output</span><br><span class="hljs-string">collect2: error: ld returned 1 exit status</span><br></code></pre></td></tr></table></figure> and <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs sh">zsh configuration<br>-----------------<br>zsh version               : 5.9<br>host operating system     : x86_64-pc-linux-gnu<br><span class="hljs-built_in">source</span> code location      : .<br>compiler                  : gcc -std=gnu11<br>preprocessor flags        : -I/home/wpsze/zsh/ncurses//include<br>executable compiler flags : -I/home/wpsze/zsh/ncurses//include -fPIC<br>module compiler flags     : -I/home/wpsze/zsh/ncurses//include -fPIC -fPIC<br>executable linker flags   : -L/home/wpsze/zsh/ncurses//lib  -rdynamic<br>module linker flags       : -L/home/wpsze/zsh/ncurses//lib  -shared<br>library flags             : -ldl -lncurses -lrt -lm  -lc<br>installation <span class="hljs-built_in">basename</span>     : zsh<br>binary install path       : /home/wpsze/zsh/bin<br>man page install path     : /home/wpsze/zsh/share/man<br>info install path         : /home/wpsze/zsh/share/info<br><span class="hljs-built_in">functions</span> install path    : /home/wpsze/zsh/share/zsh/5.9/functions<br>See config.modules <span class="hljs-keyword">for</span> installed modules and <span class="hljs-built_in">functions</span>.<br></code></pre></td></tr></table></figure> &gt; gcc -std=gnu11 -L/home/wpsze/zsh/ncurses//lib -rdynamic -o zsh main.o <code>cat stamp-modobjs</code> -ldl -lncurses -lrt -lm -lc</p><blockquote><p>recompile with -fPIC</p></blockquote><p>Not solved</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">6903 LIBS=<span class="hljs-string">&quot;<span class="hljs-variable">$ac_func_search_save_LIBS</span> -fPIC&quot;</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>HPC</tag>
      
      <tag>shell script</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>GFS/FNL dataset</title>
    <link href="/2023/04/27/GFS_FNL/"/>
    <url>/2023/04/27/GFS_FNL/</url>
    
    <content type="html"><![CDATA[<h1 id="news-2024-july">News (2024 July)</h1><p><strong>RDA Data Services Unavailable July 30, 2024</strong></p><p>New setup goes to</p><p><a href="https://waipangsze.github.io/2024/08/16/GFS_FNL_RDA_upgrade/" class="uri">https://waipangsze.github.io/2024/08/16/GFS_FNL_RDA_upgrade/</a></p><h1 id="gfs">GFS</h1><p>The Global Forecast System (GFS)<sup id="fnref:1" class="footnote-ref"><a href="#fn:1" rel="footnote"><span class="hint--top hint--rounded" data-aria-label="[GFS Data Access](https://www.ncei.noaa.gov/products/weather-climate-models/global-forecast)">[1]</span></a></sup> is a National Centers for Environmental Prediction (NCEP) weather forecast model that generates data for dozens of atmospheric and land-soil variables, including temperatures, winds, precipitation, soil moisture, and atmospheric ozone concentration. The system couples four separate models (atmosphere, ocean model, land/soil model, and sea ice) that work together to accurately depict weather conditions.</p><h2 id="specifications">Specifications</h2><p>The GFS<sup id="fnref:2" class="footnote-ref"><a href="#fn:2" rel="footnote"><span class="hint--top hint--rounded" data-aria-label="[GFS home page](https://www.emc.ncep.noaa.gov/emc/pages/numerical_forecast_systems/gfs.php)">[2]</span></a></sup> <sup id="fnref:3" class="footnote-ref"><a href="#fn:3" rel="footnote"><span class="hint--top hint--rounded" data-aria-label="[Global Models Verification](https://www.emc.ncep.noaa.gov/users/verification/global/)">[3]</span></a></sup> is run four times a day, producing forecasts up to 16 days in advance. The forecast component uses the Finite Volume Cubed (FV3) model with a resolution of ~13 km, with the atmosphere coupled to the NCEP Global Wave Model. In the vertical, the model is divided into 127 vertical layers. It produces hourly forecast output for the first 120 hours, then 3 hourly for days 5-16. Details on the June 2019 implementation of the initial FV3 version of the GFS (GFSv15) and the March 2021 implementation of GFSv16 can be found in the links listed below.</p><h2 id="download">Download</h2><p>NCEP GFS 0.25 Degree Global Forecast Grids Historical Archive ds084.1 | DOI: 10.5065/D65D8PWK &gt; https://rda.ucar.edu/datasets/ds084.1/ &gt; The NCEP operational Global Forecast System analysis and forecast grids are on a 0.25 by 0.25 global latitude longitude grid. Grids include analysis and forecast time steps at a 3 hourly interval from 0 to 240, and a 12 hourly interval from 240 to 384. Model forecast runs occur at 00, 06, 12, and 18 UTC daily.</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/sh</span><br><span class="hljs-comment">#################################################################</span><br><span class="hljs-comment"># Csh Script (wpsze: to sh script) to retrieve 34 online Data files of &#x27;ds084.1&#x27;,</span><br><span class="hljs-comment"># total 7.16G. This script uses &#x27;wget&#x27; to download data.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Highlight this script by Select All, Copy and Paste it into a file;</span><br><span class="hljs-comment"># make the file executable and run it on command line.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># You need pass in your password as a parameter to execute</span><br><span class="hljs-comment"># this script; or you can set an environment variable RDAPSWD</span><br><span class="hljs-comment"># if your Operating System supports it.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Contact rdahelp@ucar.edu (RDA help desk) for further assistance.</span><br><span class="hljs-comment">#################################################################</span><br><br>wget --no-check-certificate -O \<br>Authentication.<span class="hljs-built_in">log</span> --save-cookies auth.rda_ucar_edu \<br>--article-data=<span class="hljs-string">&quot;email=**xxx@gmail.com**&amp;passwd=**xxx**&amp;action=login&quot;</span> https://rda.ucar.edu/cgi-bin/login<br><br>yyyy=<span class="hljs-string">&#x27;2023&#x27;</span><br>mm=<span class="hljs-string">&#x27;03&#x27;</span><br><span class="hljs-built_in">dd</span>=<span class="hljs-string">&#x27;19&#x27;</span><br>hh=<span class="hljs-string">&#x27;00&#x27;</span><br>yyyymm=<span class="hljs-variable">$&#123;yyyy&#125;</span><br><br><span class="hljs-keyword">for</span> gfsfile <span class="hljs-keyword">in</span> $(<span class="hljs-built_in">seq</span> 0 3 12); <span class="hljs-keyword">do</span> <span class="hljs-comment"># Forecast time = 12, 24, 36, 48, 60, 72, 84, 96, 108, 130, 142, 154</span><br>tmp=$(<span class="hljs-built_in">printf</span> <span class="hljs-string">&quot;%03d&quot;</span> <span class="hljs-variable">$&#123;gfsfile&#125;</span>)<br>tmp=<span class="hljs-string">&quot;<span class="hljs-variable">$&#123;yyyy&#125;</span>/<span class="hljs-variable">$&#123;yyyy&#125;</span><span class="hljs-variable">$&#123;mm&#125;</span><span class="hljs-variable">$&#123;dd&#125;</span>/gfs.0p25.<span class="hljs-variable">$&#123;yyyy&#125;</span><span class="hljs-variable">$&#123;mm&#125;</span><span class="hljs-variable">$&#123;dd&#125;</span><span class="hljs-variable">$&#123;hh&#125;</span>.f<span class="hljs-variable">$&#123;tmp&#125;</span>.grib2&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$&#123;tmp&#125;</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;downloading ...&quot;</span><br>wget --no-check-certificate -N --load-cookies auth.rda_ucar_edu https://rda.ucar.edu/data/ds084.1/<span class="hljs-variable">$&#123;tmp&#125;</span><br><span class="hljs-keyword">done</span><br></code></pre></td></tr></table></figure><h2 id="rename-gfs-files-by-soft-link">Rename GFS files by soft-link</h2><p>If your operational process needs the format of GFS files like as &gt; gfs_20170724_0000_0p25_000</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/sh</span><br><br>old_gfs=`<span class="hljs-built_in">ls</span> ./*.grib2`<br><br><span class="hljs-keyword">for</span> eachfile <span class="hljs-keyword">in</span> <span class="hljs-variable">$&#123;old_gfs&#125;</span><br><span class="hljs-keyword">do</span><br>   <span class="hljs-built_in">echo</span> <span class="hljs-variable">$&#123;eachfile&#125;</span><br>   <span class="hljs-built_in">echo</span> <span class="hljs-variable">$&#123;eachfile:11:8&#125;</span>, <span class="hljs-variable">$&#123;eachfile:19:2&#125;</span>, <span class="hljs-variable">$&#123;eachfile:23:3&#125;</span><br>   <span class="hljs-built_in">echo</span> gfs_<span class="hljs-variable">$&#123;eachfile:11:8&#125;</span>_00<span class="hljs-variable">$&#123;eachfile:19:2&#125;</span>_0p25_<span class="hljs-variable">$&#123;eachfile:23:3&#125;</span><br>   <span class="hljs-built_in">ln</span> -s <span class="hljs-variable">$&#123;eachfile&#125;</span> gfs_<span class="hljs-variable">$&#123;eachfile:11:8&#125;</span>_00<span class="hljs-variable">$&#123;eachfile:19:2&#125;</span>_0p25_<span class="hljs-variable">$&#123;eachfile:23:3&#125;</span><br><span class="hljs-keyword">done</span><br></code></pre></td></tr></table></figure><h2 id="usage-of-gfs-on-wrfnwp">Usage of GFS on WRF/NWP</h2><p>GFS Data &gt; https://www2.mmm.ucar.edu/wrf/OnLineTutorial/DATA/GFS/gfs.php &gt; GFS (Global Forecast System) is a model product from NCEP. &gt; Type: GRIB1 / GRIB2 data</p><p>Resolution: &gt; 0.25 deg global data &gt; Output frequency 3 hourly &gt; 34 pressure levels</p><p>Availability: &gt; From NCAR's RDA site: https://rda.ucar.edu/datasets/ds084.1/</p><p>Vtable: <strong>Vtable.GFS</strong></p><h3 id="namelist.wps">namelist.wps</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># Edit namelist.wps</span><br>start_date = <span class="hljs-string">&#x27;2019-11-29_12:00:00&#x27;</span>,<br>end_date = <span class="hljs-string">&#x27;2019-12-01_00:00:00&#x27;</span>,<br>interval_seconds = 10800,<br>prefix = <span class="hljs-string">&#x27;FILE&#x27;</span>,<br></code></pre></td></tr></table></figure><h3 id="script">Script</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># Notes on running UNGRIB for this data</span><br><span class="hljs-comment"># Examine the GRIB files, e.g.,</span><br><span class="hljs-comment"># ./util/g2print.exe ../DATA/co_blizzard/gfs.0p25.2019112912.f000.grib2</span><br><br><span class="hljs-built_in">ln</span> -sf ungrib/Variable_Tables/Vtable.GFS Vtable<br>./link_grib.csh ../DATA/co_blizzard/gfs.0p25.2019<br><br>./ungrib.exe<br><span class="hljs-comment"># This will create an ungrib.log for your records.</span><br><br><span class="hljs-comment"># Examine the intermediate files, e.g.,</span><br><span class="hljs-comment"># ./util/rd_intermediate.exe FILE:2019-11-29_12</span><br><span class="hljs-comment"># ncl /util/plotfmt_ncl &#x27;filename=&quot;FILE:2019-11-29_12&quot;&#x27;</span><br></code></pre></td></tr></table></figure><h2 id="usage-of-fnl-on-wrfnwp">Usage of FNL on WRF/NWP</h2><p>The NCEP FNL (Final) Operational Global Analysis<sup id="fnref:4" class="footnote-ref"><a href="#fn:4" rel="footnote"><span class="hint--top hint--rounded" data-aria-label="[FNL more](https://rda.ucar.edu/OS/web/datasets/ds083.2/docs/more.html)">[4]</span></a></sup> <sup id="fnref:5" class="footnote-ref"><a href="#fn:5" rel="footnote"><span class="hint--top hint--rounded" data-aria-label="[GFS vs FNL](https://rda.ucar.edu/OS/web/datasets/ds083.2/docs/FNLvGFS.pdf)">[5]</span></a></sup> <sup id="fnref:6" class="footnote-ref"><a href="#fn:6" rel="footnote"><span class="hint--top hint--rounded" data-aria-label="[Analysis,  reanalysis, forecast—what’s the difference?](https://rda.ucar.edu/OS/web/datasets/ds083.2/docs/Analysis.pdf)">[6]</span></a></sup> is on 1x1 degree grids are available every six hours. The analyses are from the NCEP Final Analyses (FNL). These were operationally prepared by NCEP, but are available for download from NCAR/RDA.</p><p>This product is from the Global Data Assimilation System (GDAS), which continuously collects observational data from the Global Telecommunications System (GTS), and other sources, for many analyses. The FNLs are made with the same model which NCEP uses in the Global Forecast System (GFS), <strong>but the FNLs are prepared about an hour or so after the GFS is initialized. The FNLs are delayed so that more observational data can be used</strong>. <em>The GFS is run earlier in support of time critical forecast needs, and uses the FNL from the previous 6 hour cycle as part of its initialization</em>.</p><p>FNL数据集和GFS数据集虽有联系，但在同一资料同化和预报系统中却有不同的产品。它们共享相同的基础模型和数据同化技术。它们包含相同的数据源——<strong>但是在gfs和fnl的初始条件中吸收的“真实”数据的数量有细微的差别</strong>。即使有ncep的巨大计算资源，运行一个全球nwp模型也需要时间。因此，他们需要尽早启动gfs来获得预报而不是后报。fnl是最终的分析结果，比gfs稍晚一些，以便能包括所有可用的观测数据。通常，fnl比gfs多摄取约10%的观察结果。虽然开始时间较晚，但仍有足够的时间，因此6小时的fnl6小时预报可作为下一个gfs资料同化周期的背景场例如，如果你想要00z的气球数据，你必须等待气球上升穿过大气层。对于能够到达平流层的大型氦气箱来说，这可能需要多达90分钟。然后气球的数据需要从世界各地传送到美国马里兰州的ncep中心。如果你想要00z的卫星数据，你必须等待卫星经过一个地面站，这样它才能下载数据。地面站然后通过陆地或海底电缆(如果有的话)传送数据，或者通过另一颗(通信)卫星传送数据。<sup id="fnref:7" class="footnote-ref"><a href="#fn:7" rel="footnote"><span class="hint--top hint--rounded" data-aria-label="[FNL再分析数据和GFS数据之间的区别和联系](http://www.ihamodel.com/?p=17426)">[7]</span></a></sup></p><p>For further information about the FNL archives at NCAR: See, http://rda.ucar.edu/datasets/ds083.2.</p><p>Type: &gt; GRIB2 data</p><p>Resolution: &gt; 1deg global data &gt; Output frequency 6 hourly &gt; 34 pressure levels</p><p>Availability: &gt; http://rda.ucar.edu/datasets/ds083.2 &gt; Follow the tab to "Data Access -&gt; Internet Download". You must register (it is free) to access the data.</p><p>Vtable: <strong>Vtable.GFS</strong></p><h3 id="namelist.wps-1">namelist.wps</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh">Edit namelist.wps<br>start_date = <span class="hljs-string">&#x27;2019-11-25_12:00:00&#x27;</span>,<br>end_date = <span class="hljs-string">&#x27;2019-11-27_00:00:00&#x27;</span>,<br>interval_seconds = 21600,<br>prefix = <span class="hljs-string">&#x27;FILE&#x27;</span>,<br></code></pre></td></tr></table></figure><h3 id="script-1">Script</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># Notes on running UNGRIB for this data</span><br><span class="hljs-comment"># Examine the GRIB files, e.g.,</span><br><span class="hljs-comment"># ./util/g2print.exe ../DATA/boulder_snow/fnl_20191125_12_00.grib2</span><br><span class="hljs-built_in">ln</span> -sf ungrib/Variable_Tables/Vtable.GFS Vtable<br><br>./link_grib.csh ../DATA/boulder_snow/fnl_2019<br><br>./ungrib.exe<br><span class="hljs-comment"># This will create an ungrib.log for your records.</span><br><br><span class="hljs-comment"># Examine the intermediate files, e.g.,</span><br><span class="hljs-comment"># ./util/rd_intermediate.exe FILE:2019-11-25_12</span><br><span class="hljs-comment"># ncl /util/plotfmt.ncl &#x27;filename=&quot;FILE:2019-11-25_12&quot;&#x27;</span><br></code></pre></td></tr></table></figure><h2 id="read-and-plot-grib2-files">Read and Plot grib2 files</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">import xarray as xr<br>ds = xr.open_dataset(<span class="hljs-string">&#x27;./fnl_20191125_12_00.grib2&#x27;</span>,engine=<span class="hljs-string">&#x27;pynio&#x27;</span>)<br>ds<br></code></pre></td></tr></table></figure><section class="footnotes"><div class="footnote-list"><ol><li><span id="fn:1" class="footnote-text"><span><a href="https://www.ncei.noaa.gov/products/weather-climate-models/global-forecast">GFS Data Access</a> <a href="#fnref:1" rev="footnote" class="footnote-backref"> ↩</a></span></span></li><li><span id="fn:2" class="footnote-text"><span><a href="https://www.emc.ncep.noaa.gov/emc/pages/numerical_forecast_systems/gfs.php">GFS home page</a> <a href="#fnref:2" rev="footnote" class="footnote-backref"> ↩</a></span></span></li><li><span id="fn:3" class="footnote-text"><span><a href="https://www.emc.ncep.noaa.gov/users/verification/global/">Global Models Verification</a> <a href="#fnref:3" rev="footnote" class="footnote-backref"> ↩</a></span></span></li><li><span id="fn:4" class="footnote-text"><span><a href="https://rda.ucar.edu/OS/web/datasets/ds083.2/docs/more.html">FNL more</a> <a href="#fnref:4" rev="footnote" class="footnote-backref"> ↩</a></span></span></li><li><span id="fn:5" class="footnote-text"><span><a href="https://rda.ucar.edu/OS/web/datasets/ds083.2/docs/FNLvGFS.pdf">GFS vs FNL</a> <a href="#fnref:5" rev="footnote" class="footnote-backref"> ↩</a></span></span></li><li><span id="fn:6" class="footnote-text"><span><a href="https://rda.ucar.edu/OS/web/datasets/ds083.2/docs/Analysis.pdf">Analysis, reanalysis, forecast—what’s the difference?</a> <a href="#fnref:6" rev="footnote" class="footnote-backref"> ↩</a></span></span></li><li><span id="fn:7" class="footnote-text"><span><a href="http://www.ihamodel.com/?p=17426">FNL再分析数据和GFS数据之间的区别和联系</a> <a href="#fnref:7" rev="footnote" class="footnote-backref"> ↩</a></span></span></li></ol></div></section>]]></content>
    
    
    <categories>
      
      <category>NWP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>WRF</tag>
      
      <tag>WPS</tag>
      
      <tag>MPAS</tag>
      
      <tag>IC/BC</tag>
      
      <tag>NCEP</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Git/Github</title>
    <link href="/2023/04/27/Git_GitHub/"/>
    <url>/2023/04/27/Git_GitHub/</url>
    
    <content type="html"><![CDATA[<h1 id="create-an-empty-git-repo">Create an empty git repo</h1><p>Git settings will be recorded in the .gitconfig file under the home page of the user's directory. We need to use the config command to set it.</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ git config --global user.name <span class="hljs-string">&quot;&lt;username&gt;&quot;</span><br>$ git config --global user.email <span class="hljs-string">&quot;&lt;email&gt;&quot;</span><br></code></pre></td></tr></table></figure><p>Follow this command, you can set the color of Git's output (output) results. <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ git config --global color.ui auto<br></code></pre></td></tr></table></figure></p><p>change editor, <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ git config --global core.editor <span class="hljs-string">&quot;vim&quot;</span><br></code></pre></td></tr></table></figure></p><p>Follow the steps below to set the newly created tutorial directory as a Git database <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ <span class="hljs-built_in">mkdir</span> tutorial<br>$ <span class="hljs-built_in">cd</span> tutorial<br>$ git init<br><br><span class="hljs-comment">## Initialized empty Git repository in /Users/yourname/Desktop/tutorial/.git/</span><br>$ git status<br>$ git add .<br>$ git commit -m <span class="hljs-string">&quot;first commit&quot;</span><br>$ git status<br>$ git <span class="hljs-built_in">log</span><br>$ git <span class="hljs-built_in">log</span> --all --graph --oneline<br></code></pre></td></tr></table></figure></p><h1 id="create-branch-and-swich">Create branch and swich</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ git checkout -b iss53<br>Switched to a new branch <span class="hljs-string">&quot;iss53&quot;</span><br>This is shorthand <span class="hljs-keyword">for</span>:<br><br>$ git branch iss53<br>$ git checkout iss53<br></code></pre></td></tr></table></figure><h2 id="push-to-the-remote-database">Push to the remote database</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ git remote add &lt;name&gt; &lt;url&gt;<br>$ git remote add origin https://xxx/tutorial.git<br></code></pre></td></tr></table></figure><p>Execute the following command to submit the push to the remote database origin, specify the parameter -u item when executing the submission, and then omit the specified branch name. But when pushing to a blank remote database, you must specify the name of the remote database and branch, which must not be omitted. During the process, the system will/may ask for user name and password <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ git push -u origin master<br>$ git <span class="hljs-built_in">clone</span> &lt;repository&gt; &lt;directory&gt;<br></code></pre></td></tr></table></figure></p><h2 id="conflicts">Conflicts</h2><p>Between your last push and the next push, if someone else pushes to update the remote database but you do not update your local database, your push will be rejected. At this time, you need to perform a merge operation to import other people's modification history,otherwise the push will be rejected. ### Resolve conflict &gt; The upper part separated by == is the editing content of the local database, and the lower part is the editing content of the remote database. After modifying all conflicting places, performing a commit will submit the commit content of the conflicting merge message.</p><h1 id="git-clone-a-given-github-repo">git clone a given github repo</h1><p>When the remote github repo is known, You can git clone the remote address first Then copy the project file to be submitted to the clone folder <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># Add all files, such as submitting only some files requires a single git add file name</span><br>git add. <br>git commit -m <span class="hljs-string">&quot;remarks for submission&quot;</span><br><br><span class="hljs-comment"># Force push can overwrite master</span><br>git push -u -f origin master<br></code></pre></td></tr></table></figure></p><p>If you git <strong>commit --amend</strong> here, then error "Your branch and 'origin/master' have diverged" will reject your git push. The process here is, 1. git clone github repo (latest one with commit ID A) 2. you make something changes 3. $ git commit --amend -m "remarks for submission" 4. The above commit with amend will create a New commit ID and rewrite the original commit ID A. Therefore, it can not reconignate two commit ID's and tell your branch and remote 'origin/master' have diverged.</p><p>The solution is, <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">git rebase origin/master <span class="hljs-comment"># git rebase origin main</span><br><span class="hljs-comment"># or</span><br>git merge origin/master <span class="hljs-comment"># git merge origin main</span><br></code></pre></td></tr></table></figure> <a href="https://poanchen.github.io/blog/2020/09/19/what-to-do-when-git-branch-has-diverged">WHAT TO DO WHEN GIT BRANCH HAS DIVERGED?</a></p><h1 id="common-error">Common Error</h1><h2 id="rejected-master---master-non-fast-forward">[rejected] master -&gt; master (non-fast-forward)</h2><blockquote><p>! [rejected] master -&gt; master (non-fast-forward) error: failed to push some refs to ’’ To prevent you from losing history, non-fast-forward updates were rejected Merge the remote changes (e.g. 'git pull') before pushing again. See the 'Note about fast-forwards' section of 'git push --help' for details.</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ git pull origin master<br><br><span class="hljs-comment"># * branch master -&gt; FETCH_HEAD</span><br><span class="hljs-comment"># CONFLICT (content): Merge conflict in file</span><br><span class="hljs-comment"># Automatic merge failed; fix conflicts and then commit the result.</span><br><span class="hljs-comment"># A warning message will appear warning about conflicts during the merge.</span><br></code></pre></td></tr></table></figure><p>The conficts like, &gt; &lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD &gt; commit records the state of the index &gt; ======= &gt; pull Get the content of the remote database &gt; &gt;&gt;&gt;&gt;&gt;&gt;&gt; 4c0182374230cd6eaa93b30049ef2386264fe12a</p><p>Modify the conflicting places, import the modifications of both parties, and delete the redundant marked lines.</p><blockquote><p>commit records the state of the index pull Get the content of the remote database</p></blockquote><p>When the content is modified and the file conflict is resolved, a commit is required. <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ git add sample.txt<br>$ git commit -m <span class="hljs-string">&quot;merge&quot;</span><br></code></pre></td></tr></table></figure></p><h1 id="gitignore-file-itself-is-not-being-ignored">.gitignore file itself is not being ignored</h1><p>This means that .gitignore is a tracked file.... so you changed it, so it shows up as changed. This would be the expected result... and it makes sense. Do you want to ignore .gitignore? This is not quite a good idea because by tracking it, everyone gets to ignore the same things in the project. Now, if you would like to be the only person in the project to be ignoring the files that you started the question from, you might have to consider adding that to <strong>.git/info/exclude</strong> so that it's only on you and no one else.</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh"> $ <span class="hljs-built_in">cat</span> .git/info/exclude<br><span class="hljs-comment"># git ls-files --others --exclude-from=.git/info/exclude</span><br><span class="hljs-comment"># Lines that start with &#x27;#&#x27; are comments.</span><br><span class="hljs-comment"># For a project mostly in C, the following would be a good set of</span><br><span class="hljs-comment"># exclude patterns (uncomment them if you want to use them):</span><br><span class="hljs-comment"># *.[oa]</span><br><span class="hljs-comment"># *~</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Git</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Github</tag>
      
      <tag>git init</tag>
      
      <tag>git add</tag>
      
      <tag>git commit</tag>
      
      <tag>git conflicts</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>WRF | WRF/WPS Geographical Static Data</title>
    <link href="/2023/04/27/WRF_geographical_static_Data/"/>
    <url>/2023/04/27/WRF_geographical_static_Data/</url>
    
    <content type="html"><![CDATA[<h1 id="wrf-geographical-static-data">WRF geographical static Data</h1><p>These are all the mandatory fields required to run WPS and WRF.</p><p>All are under:</p><blockquote><p>https://www2.mmm.ucar.edu/wrf/src/wps_files/</p></blockquote><p>Download links:</p><blockquote><p>http://www2.mmm.ucar.edu/wrf/src/wps_files/geog_complete.tar.bz2 &gt; This is a large compressed file (≈ 2.3 GB) &gt; This file will expand to about 50GB in size. &gt; bunzip2 geog complete.tar.bz2 &gt; tar -xf geog complete.tar</p></blockquote><blockquote><p>https://www2.mmm.ucar.edu/wrf/users/download/get_sources_wps_geog.html &gt; Highest Resolution of each Mandatory Field (*Note: ~29G Uncompressed (2.6G Compressed)) &gt; WPS Geographical Input Data Mandatory for Specific Applications &gt; Optional WPS Geographical Input Data</p></blockquote><p>For the WPS geographical input data download sets that correspond to <strong>Version 3</strong> of the WPS/WRF code.</p><blockquote><p>https://www2.mmm.ucar.edu/wrf/users/download/get_sources_wps_geog_V3.html</p></blockquote><h2 id="landuse">Landuse</h2><p><a href="https://forum.mmm.ucar.edu/threads/references-for-geogrid-static-data.168/">References for geogrid static data</a></p><p>The Noah LSM page identifies the sources of data that they use. We believe, with high probability, that we are using the same. The topography data is definitely the USGS GTOPO30, the soil category data is probably the hybrid STATSGO/FAO, and the land-cover data is probably the USGS GLCC v2 land-use/land-cover data. For future reference, here is a link to the Noah page: <a href="http://www.ral.ucar.edu/research/land/technology/lsm.php">Land Atmosphere Interactions | Research Applications Laboratory</a></p><p>The 30-arc-second MODIS land use datasets (both with and without lakes) are probably derived from the "Modified IGBP MODIS" data in the Noah link.</p><p>To the best of our knowledge, all of the land cover data in the 'landuse_*' directories are the USGS GLCC data from 1992-1993. The coarser resolutions are derived from the 30-arc-second data.</p><p>The data in the 'modis_landuse_20class_15s' directory is based on: (1) Broxton, P. D., Zeng, X., Sulla-Menashe, D., &amp; Troch, P. A. (2014). A global land cover climatology using MODIS data. Journal of Applied Meteorology and Climatology, 53(6), 1593-1605. DOI: 10.1175/JAMC-D-13-0270.1 and (2) ftp://ftp.emc.ncep.noaa.gov/mmb/gcp/ldas/noahlsm/README</p><p>The data in the 'modis_landuse_20class_30s' directory were provided by NCEP and include the addition of a tundra class; these data were most likely collected in 2001.</p><p>The data in the 'modis_landuse_20class_30s_with_lakes' directory are the same as in the 'modis_landuse_20class_30s' directory, but have an inland water body category that was added by NCAR.</p><p>The data in the 'modis_landuse_21class_30s' data were modified by Boston University, most likely based on data collected in 2004.</p><h3 id="in-summary">In summary:</h3><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">landuse_30s</span> - USGS GLCC, <span class="hljs-number">1992</span>-<span class="hljs-number">1993</span><br><span class="hljs-attribute">landuse_30s_with_lakes</span> - USGS GLCC, <span class="hljs-number">1992</span>-<span class="hljs-number">1993</span>, lakes added by NCAR<br><span class="hljs-attribute">landuse_2m</span> - USGS GLCC, <span class="hljs-number">1992</span>-<span class="hljs-number">1993</span>, coarsened from <span class="hljs-number">30</span>s<br><span class="hljs-attribute">landuse_5m</span> - USGS GLCC, <span class="hljs-number">1992</span>-<span class="hljs-number">1993</span>, coarsened from <span class="hljs-number">30</span>s<br><span class="hljs-attribute">landuse_10m</span> - USGS GLCC, <span class="hljs-number">1992</span>-<span class="hljs-number">1993</span>, coarsened from <span class="hljs-number">30</span>s<br><br><span class="hljs-attribute">modis_landuse_20class_15s</span> - MODIS, See reference<br><span class="hljs-attribute">modis_landuse_20class_30s</span> - MODIS, NCEP included tundra class, <span class="hljs-number">2001</span><br><span class="hljs-attribute">modis_landuse_20class_30s_with_lakes</span> - MODIS, NCEP included tundra class, <span class="hljs-number">2001</span>, lakes added by NCAR<br><span class="hljs-attribute">modis_landuse_21class_30s</span> - MODIS, modified by BU, <span class="hljs-number">2004</span><br></code></pre></td></tr></table></figure><h1 id="interpolation-options-for-different-resolution">Interpolation options for different resolution</h1><ol type="1"><li>Is there an algorithm in geogrid/src that compares the original binary data resolution to the model resolution to apply the interpolation option differently?</li></ol><blockquote><p>No, I don't think so. The interpolation option is always dependent on that specified in GEOGRID.TBL</p></blockquote><ol start="2" type="1"><li>If not, is there an algorithm that applies appropriate interpolation options when receiving categorical or continuous variables?</li></ol><blockquote><p>For both categorical and continuous variables, the interpolation is conducted based on the option given in GEOGRID.TBL.</p></blockquote><h1 id="references">References</h1><ol type="1"><li><a href="https://www2.mmm.ucar.edu/wrf/users/tutorial/presentation_pdfs/202101/duda_wps_advanced.pdf">Advanced Usage of the WRF Preprocessing System</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>WRF</category>
      
    </categories>
    
    
    <tags>
      
      <tag>WRF</tag>
      
      <tag>WPS</tag>
      
      <tag>geodata</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Git rebase -i </title>
    <link href="/2023/04/26/Git-rebase-i/"/>
    <url>/2023/04/26/Git-rebase-i/</url>
    
    <content type="html"><![CDATA[<h1 id="use-rebase--i-to-merge-commits">Use rebase -i to merge commits</h1><blockquote><p>Ref: https://backlog.com/git-tutorial/tw/stepup/stepup7_5.html</p></blockquote><p>To merge past commits, use the rebase -i command</p><blockquote><p>$ git rebase -i HEAD~~</p></blockquote><p>The default text editor will open automatically, and you will see commits from HEAD to HEAD~~</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs sh">pick 9a54fd4 add commit instructions<br>pick 0d4a808 Add instructions <span class="hljs-keyword">for</span> pull<br><br><span class="hljs-comment"># Rebase 326fc9f..0d4a808 onto d286baa</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Commands:</span><br><span class="hljs-comment">#  p, pick = use commit</span><br><span class="hljs-comment">#  r, reword = use commit, but edit the commit message</span><br><span class="hljs-comment">#  e, edit = use commit, but stop for amending</span><br><span class="hljs-comment">#  s, squash = use commit, but meld into previous commit</span><br><span class="hljs-comment">#  f, fixup = like &quot;squash&quot;, but discard this commit&#x27;s log message</span><br><span class="hljs-comment">#  x, exec = run command (the rest of the line) using shell</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># If you remove a line here THAT COMMIT WILL BE LOST.</span><br><span class="hljs-comment"># However, if you remove everything, the rebase will be aborted.</span><br><span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure><p>Change the "pick" in the <strong>second line to "squash", save and exit</strong>. Since you need to submit after merging, the editor will remind you to edit the latest submission message, please save and exit after editing the message. In this way, the two commits are merged into one commit. Please check the history with the log command.</p><h1 id="amend-commits-with-rebase--i">Amend commits with rebase -i</h1><blockquote><p>Ref: https://backlog.com/git-tutorial/tw/stepup/stepup7_6.html</p></blockquote><p>Use the rebase -i command to select the commits to amend</p><blockquote><p>$ git rebase -i HEAD~~</p><p>The default text editor will open commits from HEAD to HEAD~~</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs sh">pick 9a54fd4 add commit instructions<br>pick 0d4a808 Add instructions <span class="hljs-keyword">for</span> pull<br><br><span class="hljs-comment"># Rebase 326fc9f..0d4a808 onto d286baa</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Commands:</span><br><span class="hljs-comment">#  p, pick = use commit</span><br><span class="hljs-comment">#  r, reword = use commit, but edit the commit message</span><br><span class="hljs-comment">#  e, edit = use commit, but stop for amending</span><br><span class="hljs-comment">#  s, squash = use commit, but meld into previous commit</span><br><span class="hljs-comment">#  f, fixup = like &quot;squash&quot;, but discard this commit&#x27;s log message</span><br><span class="hljs-comment">#  x, exec = run command (the rest of the line) using shell</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># If you remove a line here THAT COMMIT WILL BE LOST.</span><br><span class="hljs-comment"># However, if you remove everything, the rebase will be aborted.</span><br><span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure><p><strong>Change the text of "pick" in the first line to "edit"</strong>, save and exit. Then, the following content will be displayed, and the commit to be modified will be checked out.</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh">Stopped at d286baa... add commit<br>You can amend the commit now, with<br><br>        git commit --amend<br><br>Once you are satisfied with your changes, run<br><br>        git rebase --<span class="hljs-built_in">continue</span><br></code></pre></td></tr></table></figure><p>open sample.txt ，make changes.</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ git add sample.txt<br>$ git commit --amend<br></code></pre></td></tr></table></figure><p>You now need to execute "git rebase --continue" to complete the rebase.</p><blockquote><p>$ git rebase --continue</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>Git</category>
      
    </categories>
    
    
    <tags>
      
      <tag>git rebase</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>GNU GCC</title>
    <link href="/2023/04/25/GNU/"/>
    <url>/2023/04/25/GNU/</url>
    
    <content type="html"><![CDATA[<p>GNU<sup id="fnref:1" class="footnote-ref"><a href="#fn:1" rel="footnote"><span class="hint--top hint--rounded" data-aria-label="[GNU](https://www.gnu.org/)">[1]</span></a></sup> <sup id="fnref:2" class="footnote-ref"><a href="#fn:2" rel="footnote"><span class="hint--top hint--rounded" data-aria-label="[List of GNU packages](https://en.wikipedia.org/wiki/List_of_GNU_packages)">[2]</span></a></sup> is an operating system that is free software—that is, it respects users' freedom. The GNU operating system consists of GNU packages (programs specifically released by the GNU Project) as well as free software released by third parties. The development of GNU made it possible to use a computer without software that would trample your freedom.</p><h2 id="gnu-compiler-collection-gcc">GNU Compiler Collection (GCC)</h2><p>As of May 2021, the recent 11.1 release of GCC includes front ends for C (gcc), C++ (g++), Objective-C, Fortran (gfortran), Ada (GNAT), Go (gccgo) and D (gdc, since 9.1) programming languages, with the OpenMP and OpenACC parallel language extensions being supported since GCC 5.1. Versions prior to GCC 7 also supported Java (gcj), allowing compilation of Java to native machine code. Modula-2 support, previously offered by third parties, will be merged into GCC 13. Regarding language version support for C++ and C, since GCC 11.1 the default target is gnu++17, a superset of C++17, and gnu11, a superset of C11, with strict standard support also available. GCC also provides experimental support for C++20 and upcoming C++23. <sup id="fnref:3" class="footnote-ref"><a href="#fn:3" rel="footnote"><span class="hint--top hint--rounded" data-aria-label="[GCC GNU Compiler Collection](https://en.wikipedia.org/wiki/GNU_Compiler_Collection)">[3]</span></a></sup></p><h2 id="installation">Installation</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/bash</span><br><span class="hljs-comment">############################## Directory Listing ############################</span><br><span class="hljs-built_in">export</span> HOME=`<span class="hljs-built_in">pwd</span>`<br><span class="hljs-built_in">export</span> download_DIR=<span class="hljs-variable">$HOME</span>/download_DIR/<br><span class="hljs-built_in">export</span> libs_DIR=<span class="hljs-variable">$HOME</span>/Library/<br><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$HOME</span><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$download_DIR</span><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$libs_DIR</span><br><br><span class="hljs-built_in">mkdir</span> -p download_DIR<br><span class="hljs-built_in">mkdir</span> -p Library<br><br><span class="hljs-comment">############################## GCC ############################</span><br><span class="hljs-built_in">cd</span> <span class="hljs-variable">$download_DIR</span><br><br>gcc_version=<span class="hljs-string">&quot;12.2.0&quot;</span> <span class="hljs-comment"># 4.8.5/8.3.0/9.3.0/10.3.0/12.2.0</span><br><br>wget -c --no-check-certificate https://ftp.gnu.org/gnu/gcc/gcc-<span class="hljs-variable">$&#123;gcc_version&#125;</span>/gcc-<span class="hljs-variable">$&#123;gcc_version&#125;</span>.tar.gz<br>tar -xvf gcc-<span class="hljs-variable">$&#123;gcc_version&#125;</span>.tar.gz<br><span class="hljs-built_in">cd</span> gcc-<span class="hljs-variable">$&#123;gcc_version&#125;</span><br><br>./contrib/download_prerequisites<br>./configure --prefix=<span class="hljs-variable">$libs_DIR</span>/gcc-v<span class="hljs-variable">$&#123;gcc_version&#125;</span> --enable-languages=c,c++,fortran --disable-multilib<br><br>make<br>make -j &amp;&amp; make install<br>gcc --version<br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;===================&quot;</span><br><span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$PATH</span>:/<span class="hljs-variable">$libs_DIR</span>/gcc-v<span class="hljs-variable">$&#123;gcc_version&#125;</span>/bin<br>gcc --version<br><br></code></pre></td></tr></table></figure><h2 id="bug-and-error">Bug and Error</h2><blockquote><p>Bug: configure: error: Building GCC requires GMP 4.2+, MPFR 3.1.0+ and MPC 0.8.0+.??? <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># Inside the gcc directory, do this command:</span><br>./contrib/download_prerequisites<br><span class="hljs-comment"># After that script, GMP, MPFR, and MPC will be ready to use. Continue with ./configure.</span><br></code></pre></td></tr></table></figure></p></blockquote><section class="footnotes"><div class="footnote-list"><ol><li><span id="fn:1" class="footnote-text"><span><a href="https://www.gnu.org/">GNU</a> <a href="#fnref:1" rev="footnote" class="footnote-backref"> ↩</a></span></span></li><li><span id="fn:2" class="footnote-text"><span><a href="https://en.wikipedia.org/wiki/List_of_GNU_packages">List of GNU packages</a> <a href="#fnref:2" rev="footnote" class="footnote-backref"> ↩</a></span></span></li><li><span id="fn:3" class="footnote-text"><span><a href="https://en.wikipedia.org/wiki/GNU_Compiler_Collection">GCC GNU Compiler Collection</a> <a href="#fnref:3" rev="footnote" class="footnote-backref"> ↩</a></span></span></li></ol></div></section>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>HPC</tag>
      
      <tag>NWP</tag>
      
      <tag>gnu</tag>
      
      <tag>gcc</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>WRF | WRF installation on a Linux-based machine</title>
    <link href="/2023/04/25/WRF_installation_on_a_Linux_based_machine/"/>
    <url>/2023/04/25/WRF_installation_on_a_Linux_based_machine/</url>
    
    <content type="html"><![CDATA[<h1 id="wrf">WRF</h1><ul><li>Version 1.0: WRF was first released December 2000</li><li>Version 2.0: May 2004</li><li>Version 3.0: April 2008</li><li>Version 4.0: June 2018 (add hybrid vertical coordinate)</li><li>Version 4.1: April 2019</li><li>Version 4.2: April 2020</li><li>Version 4.3: May 2021</li><li>Version 4.4: April 2022</li><li>Version 4.5: April 2023<ul><li>4.5.1: July 2023</li><li>4.5.2: December 2023</li></ul></li><li>Version 4.6: May 2024</li></ul><h1 id="wrf-installation-on-a-linux-based-machine">WRF installation on a Linux-based machine</h1><p>Weather Research &amp; Forecasting Model (WRF) is a state of the art mesoscale numerical weather prediction system designed for both atmospheric research and operational forecasting applications <sup id="fnref:1" class="footnote-ref"><a href="#fn:1" rel="footnote"><span class="hint--top hint--rounded" data-aria-label="[WRF](https://www.mmm.ucar.edu/models/wrf)">[1]</span></a></sup>.</p><p>The installation steps are,</p><ol type="1"><li>Source gcc compiler</li><li>Test gcc compiler</li><li>Install all requried libraries</li><li>Test libraries</li><li>Install WRF</li><li>Install WPS</li></ol><p>Three shell scripts are under the same directory,</p><blockquote><p>gcc_env.sh wrf_env.sh wrf_env_install.sh wrf_wps_install.sh</p></blockquote><h2 id="gcc-version-gcc_env.sh">GCC version (gcc_env.sh)</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/bash</span><br><br><span class="hljs-built_in">export</span> gcc_libs_DIR=/home/wpsze/gcc/<br><span class="hljs-built_in">export</span> LD_LIBRARY_PATH=<span class="hljs-variable">$gcc_libs_DIR</span>/lib:<span class="hljs-variable">$LD_LIBRARY_PATH</span><br><span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$gcc_libs_DIR</span>/bin:<span class="hljs-variable">$PATH</span><br><br><span class="hljs-built_in">export</span> gcc_version=<span class="hljs-string">&quot;gcc-v4.8.5&quot;</span> <span class="hljs-comment"># 4.8.5/8.3.0/9.3.0/10.3.0/12.2.0</span><br><br><span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$gcc_libs_DIR</span>/<span class="hljs-variable">$&#123;gcc_version&#125;</span>/bin:<span class="hljs-variable">$PATH</span><br><span class="hljs-built_in">export</span> LD_LIBRARY_PATH=<span class="hljs-variable">$gcc_libs_DIR</span>/<span class="hljs-variable">$&#123;gcc_version&#125;</span>/lib:<span class="hljs-variable">$LD_LIBRARY_PATH</span><br><span class="hljs-built_in">export</span> LD_LIBRARY_PATH=<span class="hljs-variable">$gcc_libs_DIR</span>/<span class="hljs-variable">$&#123;gcc_version&#125;</span>/lib64:<span class="hljs-variable">$LD_LIBRARY_PATH</span><br><br>gcc --version<br>gfortran --version<br></code></pre></td></tr></table></figure><h3 id="testing-system-compatibility">Testing System Compatibility</h3><p>We have to test the compiler system in your computer/clsuter. #### Download test tar files,</p><blockquote><p>http://www2.mmm.ucar.edu/wrf/OnLineTutorial/compile_tutorial/tar_files/Fortran_C_tests.tar</p></blockquote><h4 id="run_gcc_test.sh">run_gcc_test.sh</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/bash</span><br><span class="hljs-built_in">source</span> gcc_env.sh<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;==========================================================================================&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot; All tests are from http://www2.mmm.ucar.edu/wrf/OnLineTutorial/compile_tutorial/tar_files/Fortran_C_tests.tar &quot;</span><br>gfortran --version<br>gcc --version<br>cpp --version<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;==========================================================================================&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=============================== Fortran_C_tests.tar  =====================================&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;==========================================================================================&quot;</span><br><span class="hljs-comment"># Unpack the test files by entering the following input into the terminal:</span><br><span class="hljs-comment"># tar -xf Fortran_C_tests.tar</span><br><br><span class="hljs-comment"># TEST #1: FIXED FORMAT FORTRAN TEST</span><br>gfortran TEST_1_fortran_only_fixed.f<br>./a.out<br><span class="hljs-comment"># SUCCESS test 1 fortran only fixed format</span><br><br><span class="hljs-comment"># TEST #2: FREE FORMAT FORTRAN TEST</span><br>gfortran TEST_2_fortran_only_free.f90<br>./a.out<br><span class="hljs-comment"># Assume Fortran 2003: has FLUSH, ALLOCATABLE, derived type, and ISO C Binding</span><br><span class="hljs-comment"># SUCCESS test 2 fortran only free format</span><br><br><span class="hljs-comment"># TEST #3: C</span><br>gcc TEST_3_c_only.c<br>./a.out<br><span class="hljs-comment"># SUCCESS test 3 c only</span><br><br><span class="hljs-comment"># TEST #4: FORTRAN CALLING A C FUNCTION (GCC AND GFORTRAN HAVE DIFFERENT DEFAULTS, </span><br><span class="hljs-comment"># SO WE FORCE BOTH TO ALWAYS USE 64 BIT (-M64) WHEN COMBINING THEM)</span><br>gcc -c -m64 TEST_4_fortran+c_c.c<br>gfortran -c -m64 TEST_4_fortran+c_f.f90<br>gfortran -m64 TEST_4_fortran+c_f.o TEST_4_fortran+c_c.o<br>./a.out<br><span class="hljs-comment"># C function called by Fortran</span><br><span class="hljs-comment"># Values are xx = 2.00 and ii = 1</span><br><span class="hljs-comment"># SUCCESS test 4 fortran calling c</span><br><br><span class="hljs-comment"># TEST #5: CSH</span><br>./TEST_csh.csh<br><span class="hljs-comment"># SUCCESS csh test</span><br><span class="hljs-comment">#  TEST #6: PERL</span><br>./TEST_perl.pl<br><span class="hljs-comment"># SUCCESS perl test</span><br><span class="hljs-comment">#  TEST #7: SH</span><br>./TEST_sh.sh<br><span class="hljs-comment"># SUCCESS sh test</span><br></code></pre></td></tr></table></figure><h2 id="wrf-v3.8.1-2">WRF v3.8.1 <sup id="fnref:2" class="footnote-ref"><a href="#fn:2" rel="footnote"><span class="hint--top hint--rounded" data-aria-label="[WRFv3.8.1 installation on a Linux machine](https://metclim.ucd.ie/2017/06/wrf-installation-on-a-linux-machine/)">[2]</span></a></sup></h2><p>Using a version of gfortran which is 4.4.0 or newer is recommended.</p><blockquote><p>https://www2.mmm.ucar.edu/wrf/OnLineTutorial/compile_tutorial/tar_files/ netcdf-4.1.3 mpich-3.0.4 zlib-1.2.7 libpng-1.2.50 JasPer-1.900.1</p></blockquote><p>The above libraries are requried for running WRF and download to folder wrf_instsall/.</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">source</span> gcc_env.sh<br><span class="hljs-comment">#export gcc_version=&quot;gcc-v4.8.5&quot; # and change gcc_env.sh !!!!!!</span><br><br><span class="hljs-built_in">export</span> HOME=`<span class="hljs-built_in">pwd</span>`<br><span class="hljs-built_in">export</span> download_DIR=<span class="hljs-variable">$HOME</span>/wrf_install/<br><span class="hljs-built_in">export</span> libs_DIR=<span class="hljs-variable">$HOME</span>/Library/<br><br><span class="hljs-built_in">export</span> LD_LIBRARY_PATH=<span class="hljs-variable">$libs_DIR</span>/lib:<span class="hljs-variable">$LD_LIBRARY_PATH</span><br><span class="hljs-built_in">export</span> LDFLAGS=-L<span class="hljs-variable">$libs_DIR</span>/lib<br><span class="hljs-built_in">export</span> CPPFLAGS=-I<span class="hljs-variable">$libs_DIR</span>/include<br><br>gcc --version<br>gfortran --version<br><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$HOME</span><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$download_DIR</span><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$libs_DIR</span><br><br><span class="hljs-built_in">mkdir</span> -p wrf_install<br><span class="hljs-built_in">mkdir</span> -p Library<br><br><span class="hljs-comment">############################## zlib ############################</span><br><span class="hljs-built_in">cd</span> <span class="hljs-variable">$download_DIR</span><br><span class="hljs-built_in">rm</span> -rf zlib-1.2.7/<br>tar xvf zlib-1.2.7.tar.gz<br><br><span class="hljs-built_in">cd</span> zlib-1.2.7/<br><br>./configure --prefix=<span class="hljs-variable">$libs_DIR</span><br>make<br>make install<br><br><span class="hljs-comment">############################## libpng ############################</span><br><span class="hljs-built_in">cd</span> <span class="hljs-variable">$download_DIR</span><br><span class="hljs-built_in">rm</span> -rf libpng-1.2.50<br>tar xvf libpng-1.2.50.tar.gz<br><br><span class="hljs-built_in">cd</span> libpng-1.2.50/<br><br>./configure --prefix=<span class="hljs-variable">$libs_DIR</span><br>make<br>make install<br><br><span class="hljs-comment">############################## netcdf-C ############################</span><br><span class="hljs-built_in">cd</span> <span class="hljs-variable">$download_DIR</span><br><span class="hljs-built_in">rm</span> -rf netcdf-4.1.3<br>tar xvf netcdf-4.1.3.tar.gz<br><br><span class="hljs-built_in">cd</span> netcdf-4.1.3/<br><br><span class="hljs-built_in">export</span> LD_LIBRARY_PATH=<span class="hljs-variable">$libs_DIR</span>/lib:<span class="hljs-variable">$LD_LIBRARY_PATH</span><br><span class="hljs-built_in">export</span> LDFLAGS=-L<span class="hljs-variable">$libs_DIR</span>/lib<br><span class="hljs-built_in">export</span> CPPFLAGS=-I<span class="hljs-variable">$libs_DIR</span>/include<br><br><span class="hljs-comment"># ./configure --prefix=$libs_DIR</span><br>./configure --prefix=<span class="hljs-variable">$libs_DIR</span> --disable-dap --disable-netcdf-4 --disable-shared<br>make<br>make install<br><br><span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$libs_DIR</span>/bin:<span class="hljs-variable">$PATH</span><br><span class="hljs-built_in">export</span> NETCDF=<span class="hljs-variable">$libs_DIR</span><br><span class="hljs-comment">############################## JasPer ############################</span><br><span class="hljs-built_in">cd</span> <span class="hljs-variable">$download_DIR</span><br><span class="hljs-built_in">rm</span> -rf jasper-1.900.1<br>tar vxf jasper-1.900.1.tar.gz<br><br><span class="hljs-built_in">cd</span> jasper-1.900.1<br><br><span class="hljs-comment">#sed -i &#x27;s|char|const char|g&#x27; src/libjasper/jpg/jpg_dummy.c</span><br><br>./configure --prefix=<span class="hljs-variable">$libs_DIR</span><br><br>make<br>make install<br><span class="hljs-comment">##############################MPICH############################</span><br><span class="hljs-built_in">cd</span> <span class="hljs-variable">$download_DIR</span><br><span class="hljs-built_in">rm</span> mpich-3.0.4<br>tar vxf mpich-3.0.4.tar.gz<br><br><span class="hljs-built_in">cd</span> mpich-3.0.4/<br>./configure --prefix=<span class="hljs-variable">$libs_DIR</span> <span class="hljs-comment">#--with-device=ch3</span><br><br>make<br>make install<br><br><span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$libs_DIR</span>/bin:<span class="hljs-variable">$PATH</span><br></code></pre></td></tr></table></figure><p>and, combine all required libaries in wrf_env.sh</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/bash</span><br><span class="hljs-built_in">source</span> gcc_env.sh<br><span class="hljs-built_in">export</span> HOME=`<span class="hljs-built_in">pwd</span>`<br><span class="hljs-built_in">export</span> libs_DIR=<span class="hljs-variable">$HOME</span>/Library/<br><span class="hljs-built_in">export</span> LD_LIBRARY_PATH=<span class="hljs-variable">$libs_DIR</span>/lib:<span class="hljs-variable">$LD_LIBRARY_PATH</span><br><span class="hljs-built_in">export</span> LDFLAGS=-L<span class="hljs-variable">$libs_DIR</span>/lib<br><span class="hljs-built_in">export</span> CPPFLAGS=-I<span class="hljs-variable">$libs_DIR</span>/include<br><span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$libs_DIR</span>/bin:<span class="hljs-variable">$PATH</span><br><span class="hljs-built_in">export</span> NETCDF=<span class="hljs-variable">$libs_DIR</span><br></code></pre></td></tr></table></figure><h3 id="library-compatibility-tests">Library Compatibility Tests</h3><p>We have to test the Library in your computer/clsuter. #### Download test tar files,</p><blockquote><p>http://www2.mmm.ucar.edu/wrf/OnLineTutorial/compile_tutorial/tar_files/Fortran_C_NETCDF_MPI_tests.tar</p></blockquote><h4 id="run_library_test.sh">run_library_test.sh</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/bash</span><br><span class="hljs-built_in">source</span> wrf_env.sh<br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=================================================================&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=================== Fortran_C_NETCDF_MPI_tests.tar ==============&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=================================================================&quot;</span><br><br><span class="hljs-comment"># To unpack the tar file, type:</span><br><span class="hljs-comment"># wget -c https://www2.mmm.ucar.edu/wrf/OnLineTutorial/compile_tutorial/tar_files/Fortran_C_NETCDF_MPI_tests.tar</span><br><span class="hljs-comment"># tar -xf Fortran_C_NETCDF_MPI_tests.tar</span><br><br><span class="hljs-comment"># Test #1: Fortran + C + NetCDF</span><br><br><span class="hljs-comment"># The NetCDF-only test requires the include file from the NETCDF package be in this directory. Copy the file here:</span><br><span class="hljs-built_in">cp</span> <span class="hljs-variable">$&#123;NETCDF&#125;</span>/include/netcdf.inc .<br><br><span class="hljs-comment"># Compile the Fortran and C codes for the purpose of this test </span><br><span class="hljs-comment"># (the -c option says to not try to build an executable). Type the following commands:</span><br>gfortran -c 01_fortran+c+netcdf_f.f<br>gcc -c 01_fortran+c+netcdf_c.c<br>gfortran 01_fortran+c+netcdf_f.o 01_fortran+c+netcdf_c.o \<br>     -L<span class="hljs-variable">$&#123;NETCDF&#125;</span>/lib -lnetcdff -lnetcdf<br>./a.out<br><br><span class="hljs-comment"># The following should be displayed on your screen:</span><br><span class="hljs-comment"># C function called by Fortran</span><br><span class="hljs-comment"># Values are xx = 2.00 and ii = 1</span><br><span class="hljs-comment"># SUCCESS test 1 fortran + c + netcdf</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=================================================================&quot;</span><br><span class="hljs-comment"># Test #2: Fortran + C + NetCDF + MPI</span><br><br><span class="hljs-comment"># The NetCDF+MPI test requires include files from both of these packages be in this directory, </span><br><span class="hljs-comment"># but the MPI scripts automatically make the mpif.h file available without assistance, </span><br><span class="hljs-comment"># so no need to copy that one. Copy the NetCDF include file here:</span><br><span class="hljs-built_in">cp</span> <span class="hljs-variable">$&#123;NETCDF&#125;</span>/include/netcdf.inc .<br><br><span class="hljs-comment"># Note that the MPI executables mpif90 and mpicc are used below when compiling. Issue the following commands:</span><br>mpif90 -c 02_fortran+c+netcdf+mpi_f.f<br>mpicc -c 02_fortran+c+netcdf+mpi_c.c<br>mpif90 02_fortran+c+netcdf+mpi_f.o \<br>02_fortran+c+netcdf+mpi_c.o \<br>     -L<span class="hljs-variable">$&#123;NETCDF&#125;</span>/lib -lnetcdff -lnetcdf<br>mpirun ./a.out<br><br><span class="hljs-comment"># The following should be displayed on your screen:</span><br><span class="hljs-comment"># C function called by Fortran</span><br><span class="hljs-comment"># Values are xx = 2.00 and ii = 1</span><br><span class="hljs-comment"># status = 2</span><br><span class="hljs-comment"># SUCCESS test 2 fortran + c + netcdf + mpi</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=================================================================&quot;</span><br></code></pre></td></tr></table></figure><h3 id="install-wrfv3.8.1">Install WRFv3.8.1</h3><h4 id="download">Download</h4><blockquote><p>http://www2.mmm.ucar.edu/wrf/src/WRFV3.8.1.TAR.gz</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/bash</span><br><span class="hljs-comment"># WRF will not compile using GCC version 6 or higher. </span><br><span class="hljs-comment"># It will only work with version 4.8.5. </span><br><span class="hljs-comment"># The GCC6 module loads automatically when you log in.</span><br><span class="hljs-comment"># If you unload it, the system will default to GCC 4.8.5.</span><br><br><span class="hljs-built_in">source</span> wrf_env.sh<br><span class="hljs-built_in">export</span> HOME=`<span class="hljs-built_in">pwd</span>` <br><span class="hljs-built_in">export</span> libs_DIR=/home/wpsze/WRFv381/Library/ <span class="hljs-comment"># HOME = /home/wpsze/WRFv381/</span><br><span class="hljs-built_in">export</span> download_DIR=<span class="hljs-variable">$HOME</span>/wrf_install/<br><br><span class="hljs-comment"># gunzip WRFV3.8.1.TAR.gz</span><br><span class="hljs-comment"># tar -xf WRFV3.8.1.TAR</span><br><br><span class="hljs-built_in">cd</span> <span class="hljs-variable">$download_DIR</span><br><br><span class="hljs-built_in">cd</span> WRFV3/<br><br><span class="hljs-built_in">export</span> WRF_DIR=<span class="hljs-string">&quot;WRFV3&quot;</span><br><br><span class="hljs-comment">#./clean -a ## running or not</span><br><br>./configure <br><span class="hljs-comment">##  34 (dmpar) GNU [gfortran/gcc]</span><br><br>./compile -j 4 em_real 2&gt;&amp;1 | <span class="hljs-built_in">tee</span> compile.log<br><span class="hljs-comment">#./compile em_real 2&gt;&amp;1 | tee compile.log</span><br><br><span class="hljs-comment"># # #It should fail on the first time (namely main/real.exe is not created)</span><br><span class="hljs-comment"># # #with the following error:</span><br><span class="hljs-comment"># # #+++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><br><span class="hljs-comment"># # #real_em.f90:32.7:</span><br><br><span class="hljs-comment"># # #   USE module_initialize_real, ONLY : wrfu_initialize, find_my_parent, find_my_</span><br><span class="hljs-comment"># # 1</span><br><span class="hljs-comment"># # #Fatal Error: Can&#x27;t open module file &#x27;module_initialize_real.mod&#x27; for reading at (1): No such file or</span><br><span class="hljs-comment"># # #directory</span><br><span class="hljs-comment"># # #nup_em.f90:90.7:</span><br><br><span class="hljs-comment"># # #   USE module_initialize_real, only : wrfu_initialize</span><br><span class="hljs-comment"># # #       1</span><br><span class="hljs-comment"># # #Fatal Error: Can&#x27;t open module file &#x27;module_initialize_real.mod&#x27; for reading at (1): No such file or</span><br><span class="hljs-comment"># # #directory</span><br><span class="hljs-comment"># # #+++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><br><br><span class="hljs-comment"># # #Then it should end successfully when running the</span><br><span class="hljs-comment"># # #command a second time (do not understand why but it works...)</span><br><br><span class="hljs-comment"># # # ---&gt;                  Executables successfully built                  &lt;---</span><br></code></pre></td></tr></table></figure><p>This should return the following four files:</p><blockquote><p>wrf.exe real.exe ndown.exe tc.exe</p></blockquote><h3 id="install-wpsv3.8.1">Install WPSv3.8.1</h3><h4 id="download-1">Download</h4><blockquote><p>http://www2.mmm.ucar.edu/wrf/src/WPSV3.8.1.TAR.gz</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/bash</span><br><span class="hljs-built_in">source</span> wrf_env.sh<br><span class="hljs-built_in">export</span> HOME=`<span class="hljs-built_in">pwd</span>` <br><span class="hljs-built_in">export</span> libs_DIR=/home/wpsze/WRFv381/Library/ <span class="hljs-comment"># HOME = /home/wpsze/WRFv381/</span><br><span class="hljs-built_in">export</span> download_DIR=<span class="hljs-variable">$HOME</span>/wrf_install/<br><br><span class="hljs-built_in">cd</span> <span class="hljs-variable">$download_DIR</span><br><span class="hljs-comment">#tar xvf xxxx.tar.gz</span><br><span class="hljs-built_in">cd</span> WPS/<br><span class="hljs-built_in">export</span> WRF_DIR=../WRFV3/<br><span class="hljs-built_in">export</span> JASPERLIB=<span class="hljs-variable">$libs_DIR</span>/lib/<br><span class="hljs-built_in">export</span> JASPERINC=<span class="hljs-variable">$libs_DIR</span>/include/<br><br><span class="hljs-comment">#then option 1 Linux x86_64, gfortran    (serial)</span><br><br><span class="hljs-comment"># ./clean -a</span><br><br>./configure<br><br><span class="hljs-comment"># 1 (dmpar) gfortran</span><br><br>./compile 2&gt;&amp;1 | <span class="hljs-built_in">tee</span> compile.log<br></code></pre></td></tr></table></figure><p>This should return the three executable files needed to run WPS.</p><blockquote><p>geogrid.exe metgrid.exe ungrib.exe</p></blockquote><h2 id="wrf-v4.4.0">WRF v4.4.0</h2><section class="footnotes"><div class="footnote-list"><ol><li><span id="fn:1" class="footnote-text"><span><a href="https://www.mmm.ucar.edu/models/wrf">WRF</a> <a href="#fnref:1" rev="footnote" class="footnote-backref"> ↩</a></span></span></li><li><span id="fn:2" class="footnote-text"><span><a href="https://metclim.ucd.ie/2017/06/wrf-installation-on-a-linux-machine/">WRFv3.8.1 installation on a Linux machine</a> <a href="#fnref:2" rev="footnote" class="footnote-backref"> ↩</a></span></span></li></ol></div></section>]]></content>
    
    
    <categories>
      
      <category>WRF</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NWP</tag>
      
      <tag>gnu</tag>
      
      <tag>gcc</tag>
      
      <tag>WRF</tag>
      
      <tag>WPS</tag>
      
      <tag>Installation</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Slurm</title>
    <link href="/2023/04/24/Slurm/"/>
    <url>/2023/04/24/Slurm/</url>
    
    <content type="html"><![CDATA[<p>SLURM (Simple Linux Utility for Resource Management) <sup id="fnref:1" class="footnote-ref"><a href="#fn:1" rel="footnote"><span class="hint--top hint--rounded" data-aria-label="[Slurm](https://slurm.schedmd.com/documentation.html)">[1]</span></a></sup> <sup id="fnref:5" class="footnote-ref"><a href="#fn:5" rel="footnote"><span class="hint--top hint--rounded" data-aria-label="[Slurm中英文對照文檔](https://docs.slurm.cn/master/man-pages-shou-ce)">[5]</span></a></sup> is a powerful and flexible workload manager, designed for distributed computing environments. It is an open-source, highly-scalable system that provides advanced job scheduling, efficient job submission, and comprehensive system monitoring capabilities. SLURM allows users to manage computing resources efficiently, enabling more efficient and cost-effective research and data analysis. Overall, SLURM provides a highly efficient and flexible resource management solution for distributed computing environments. Its features make it an excellent choice for researchers and scientists looking to optimize their computing resources, streamline their workflows, and enhance their productivity.</p><p>Usual commands:</p><table><thead><tr class="header"><th style="text-align: left;">Purpose</th><th style="text-align: left;">Command</th></tr></thead><tbody><tr class="odd"><td style="text-align: left;">To check what queues (partitions) are available</td><td style="text-align: left;">sinfo</td></tr><tr class="even"><td style="text-align: left;">To submit job</td><td style="text-align: left;">sbatch <your_job_script></td></tr><tr class="odd"><td style="text-align: left;">To view the queue status</td><td style="text-align: left;">squeue</td></tr><tr class="even"><td style="text-align: left;">To view the queue status of your job</td><td style="text-align: left;">squeue -u $USER</td></tr><tr class="odd"><td style="text-align: left;">To cancel a running or pending job</td><td style="text-align: left;">scancel JOBID</td></tr><tr class="even"><td style="text-align: left;">To view detailed information of your job</td><td style="text-align: left;">scontrol show job JOBID</td></tr><tr class="odd"><td style="text-align: left;">To View resource accounting information for finished and running jobs</td><td style="text-align: left;">sacct</td></tr><tr class="even"><td style="text-align: left;">To View resource accounting information for running jobs</td><td style="text-align: left;">sstat</td></tr></tbody></table><h2 id="sample-script">Sample script</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/bash</span><br><br><span class="hljs-comment"># NOTE: Lines starting with &quot;#SBATCH&quot; are valid SLURM commands or statements,</span><br><span class="hljs-comment">#       while those starting with &quot;#&quot; and &quot;##SBATCH&quot; are comments.  Uncomment</span><br><span class="hljs-comment">#       &quot;##SBATCH&quot; line means to remove one # and start with #SBATCH to be a</span><br><span class="hljs-comment">#       SLURM command or statement.</span><br><br><span class="hljs-comment">#SBATCH -J slurm_job # Slurm job name</span><br><span class="hljs-comment">#SBATCH -t 48:00:00  # time limit: (D-HH:MM or D-HH:MM:SS)</span><br><br><span class="hljs-comment"># Enable email notificaitons when job begins and ends, uncomment if you need it</span><br><span class="hljs-comment">##SBATCH --mail-user=waipangsze@gmail.com # Update your email address</span><br><span class="hljs-comment">##SBATCH --mail-type=end           # NONE, BEGIN, END, FAIL, REQUEUE, ALL</span><br><br><span class="hljs-comment"># Choose partition (queue) to use. Note: replace &lt;partition_to_use&gt; with the name of partition</span><br><span class="hljs-comment">#SBATCH -p &lt;partition_to_use&gt;</span><br><br><span class="hljs-comment"># Use memory, nodes and cores</span><br><span class="hljs-comment">#SBATCH --mem=32000            # memory per node in MB </span><br><span class="hljs-comment">#SBATCH --nodes=1              # number of nodes</span><br><span class="hljs-comment">#SBATCH --ntasks-per-node=16   # number of cores</span><br><br><span class="hljs-comment"># Setup runtime environment if necessary</span><br><span class="hljs-comment"># For example, setup intel MPI environment</span><br>module gnu8<br><span class="hljs-comment"># Setup runtime environment if necessary </span><br><span class="hljs-comment"># or you can source ~/.bashrc or ~/.bash_profile </span><br><span class="hljs-comment"># Go to the job submission directory and run your application</span><br><span class="hljs-built_in">cd</span> <span class="hljs-variable">$HOME</span>/apps/slurm<br>mpirun ./your_mpi_application<br><br><span class="hljs-comment"># or another work</span><br>module load intel/compiler/64/2017/17.0.0<br>module load intel/mkl/64/2017/0.098<br>module load intel/mpi/64/2017/0.098<br><span class="hljs-built_in">cd</span> /gpfs/projects/samples/intel_mpi_hello/<br>mpiicc mpi_hello.c -o intel_mpi_hello<br>mpirun ./intel_mpi_hello<br><br><span class="hljs-comment"># or GPU</span><br><span class="hljs-comment">#SBATCH -N 1 -n 8 -p GPU-V100 --gres=gpu:v100:2</span><br>./your-gpu-prog<br></code></pre></td></tr></table></figure><p>You have to module what you need (compiler and correspoinding libraries)<sup id="fnref:2" class="footnote-ref"><a href="#fn:2" rel="footnote"><span class="hint--top hint--rounded" data-aria-label="[HKUST ITSC: JOB SCHEDULING SYSTEM (SLURM)](https://itsc.hkust.edu.hk/services/academic-teaching-support/high-performance-computing/hpc3-cluster/jobs)">[2]</span></a></sup>.</p><p>Upon job completion, the standard output will be stored in the job submission directory under the filename <strong>slurm-<your_slurm_jobid>.out</strong> or assign filename as</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#SBATCH --output=slurm.out     # file to collect standard output</span><br><span class="hljs-comment">#SBATCH --error=slurm.err      # file to collect standard errors</span><br></code></pre></td></tr></table></figure><p>If the time limit is not specified in the submit script, SLURM will assign the default run time, 3 days. This means the job will be terminated by SLURM in 72 hrs. If the memory limit is not requested, SLURM will assign the default 16 GB. The maximum allowed memory per node is 128 GB. To see how much RAM per node your job is using, you can run commands sacct or sstat to query MaxRSS for the job on the node.</p><h2 id="query-job-information">Query job information</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/bash</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;===========================================================&quot;</span><br>sacct --format=JobID,Jobname,start,end,elapsed,nnodes,ncpus,AveRSS,MaxRSS,MaxDiskRead,MaxDiskWrite,CPUTime,MaxVMSize<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;===========================================================&quot;</span><br>squeue -o<span class="hljs-string">&quot;%.7i %.9P %.8j %.8u %.2t %.10M %.6D %C %m %z %V %l&quot;</span><br>squeue -o<span class="hljs-string">&quot;%.7i %o&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;===========================================================&quot;</span><br></code></pre></td></tr></table></figure><p><a href="https://slurm.schedmd.com/sinfo.html"><strong>sinfo</strong></a></p><p><a href="https://slurm.schedmd.com/squeue.html"><strong>squeue</strong></a></p><p><a href="https://slurm.schedmd.com/sacct.html"><strong>sacct</strong></a></p><p><a href="https://slurm.schedmd.com/scontrol.html"><strong>scontrol</strong></a></p><p>One more for check historical jobs, <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">alias</span> sacct_job=<span class="hljs-string">&#x27;sacct --format=&quot;JobId,JobName%50,Partition,Nodelist,Account,AllocCPUS,State,Submit,Start,End,Elapsed&quot;&#x27;</span><br><br>sacct_job --starttime=2023-05-01<br></code></pre></td></tr></table></figure></p><h3 id="seff">seff</h3><p>The Slurm job efficiency report (seff)<sup id="fnref:3" class="footnote-ref"><a href="#fn:3" rel="footnote"><span class="hint--top hint--rounded" data-aria-label="[Slurm command: seff](https://bugs.schedmd.com/show_bug.cgi?id=1611)">[3]</span></a></sup></p><p>Summary: seff takes a jobid and reports on the efficiency of that job's cpu and memory utilization. The rpm/tarball comes with an 'smail' utility that allows for Slurm end-of-job emails to include a seff report. This allows users to become aware if they are wasting resources. <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># This script is roughtly equivalent to:</span><br><span class="hljs-comment"># sacct -P -n -a --format JobID,User,Group,State,Cluster,AllocCPUS,REQMEM,TotalCPU,Elapsed,MaxRSS,ExitCode,NNodes,NTasks -j &lt;job_id&gt;</span><br></code></pre></td></tr></table></figure></p><p>or copy from github <a href="https://github.com/SchedMD/slurm/blob/260ced654c920481eaf03558e887741e673cca53/contribs/seff/seff">SchedMd slurm seff</a></p><h2 id="ulimit--s-unlimited">ulimit -s unlimited</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">ulimit</span> -l unlimited<br><span class="hljs-built_in">ulimit</span> -s unlimited<br></code></pre></td></tr></table></figure><h2 id="slurm-job-dependencies">SLURM Job Dependencies</h2><p>You may submit jobs that runs depending on status of the previously submitted jobs or schedule a bunch of jobs to run one after the other.<sup id="fnref:4" class="footnote-ref"><a href="#fn:4" rel="footnote"><span class="hint--top hint--rounded" data-aria-label="[HKU slurm-job-dependencies](https://hpc.hku.hk/guide/slurm-guide/slurm-job-dependencies/)">[4]</span></a></sup> <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># Format is </span><br>$ sbatch --dependency=<span class="hljs-built_in">type</span>:job_id jobfile<br>$ sbatch --dependency=<span class="hljs-built_in">type</span>:job_id,job_id,job_id jobfile <span class="hljs-comment"># requires more than one job to be completed</span><br><br>jobID=$(sbatch first_job.sh)<br>sbatch --dependency=afterok:<span class="hljs-variable">$&#123;jobID&#125;</span> second_job.sh<br></code></pre></td></tr></table></figure></p><h2 id="submit-a-job-to-a-specific-node">Submit a job to a specific node</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">sbatch --nodelist=node[01-09]<br>sbatch --nodelist=node01<br>sbatch --exclude=node[10-19] <span class="hljs-comment"># Slurm sbatch exclude nodes or node list</span><br></code></pre></td></tr></table></figure><h2 id="parameters-for-openmp">Parameters for OpenMP</h2><p>The OMP_STACKSIZE environment variable controls the size of the stack for threads created by the OpenMP implementation. <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># Parameters for OpenMP</span><br><span class="hljs-built_in">export</span> OMP_STACKSIZE=512m <span class="hljs-comment"># the number is suffixed by B, K, M or G</span><br><span class="hljs-built_in">export</span> OMP_NUM_THREADS=1<br></code></pre></td></tr></table></figure></p><section class="footnotes"><div class="footnote-list"><ol><li><span id="fn:1" class="footnote-text"><span><a href="https://slurm.schedmd.com/documentation.html">Slurm</a> <a href="#fnref:1" rev="footnote" class="footnote-backref"> ↩</a></span></span></li><li><span id="fn:2" class="footnote-text"><span><a href="https://itsc.hkust.edu.hk/services/academic-teaching-support/high-performance-computing/hpc3-cluster/jobs">HKUST ITSC: JOB SCHEDULING SYSTEM (SLURM)</a> <a href="#fnref:2" rev="footnote" class="footnote-backref"> ↩</a></span></span></li><li><span id="fn:3" class="footnote-text"><span><a href="https://bugs.schedmd.com/show_bug.cgi?id=1611">Slurm command: seff</a> <a href="#fnref:3" rev="footnote" class="footnote-backref"> ↩</a></span></span></li><li><span id="fn:4" class="footnote-text"><span><a href="https://hpc.hku.hk/guide/slurm-guide/slurm-job-dependencies/">HKU slurm-job-dependencies</a> <a href="#fnref:4" rev="footnote" class="footnote-backref"> ↩</a></span></span></li><li><span id="fn:5" class="footnote-text"><span><a href="https://docs.slurm.cn/master/man-pages-shou-ce">Slurm中英文對照文檔</a> <a href="#fnref:5" rev="footnote" class="footnote-backref"> ↩</a></span></span></li><li><span id="fn:6" class="footnote-text"><span><a href="https://hpc.hku.hk/guide/slurm-guide/slurm-job-script/">HKU SLURM Job script</a> <a href="#fnref:6" rev="footnote" class="footnote-backref"> ↩</a></span></span></li></ol></div></section>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>slurm</tag>
      
      <tag>HPC</tag>
      
      <tag>NWP</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Setting up Blog on github.io</title>
    <link href="/2023/04/23/github-io/"/>
    <url>/2023/04/23/github-io/</url>
    
    <content type="html"><![CDATA[<p>This article shares the process of setting up blog website on github.io.</p><h2 id="create-a-new-github-and-git-clone-to-local-computer">Create a new github and git clone to local computer</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># the project to your own account and renaming the repo with &lt;yourusername&gt;.github.io</span><br>git <span class="hljs-built_in">clone</span> git@github.com:xxx/xxx.github.io<br></code></pre></td></tr></table></figure><h2 id="install-packages">Install packages</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh">conda create -n jekyll<br>conda activate jekyll<br>conda install -c conda-forge c-compiler compilers cxx-compiler<br>conda install -c conda-forge ruby<br>gem update --system<br>gem install bundler<br>gem install jekyll<br>gem install jekyll-paginate<br></code></pre></td></tr></table></figure><p>Remark: $ conda install -c conda-forge ruby=3.3.3</p><p>and checking, <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">which</span> jekyll<br><span class="hljs-built_in">which</span> ruby<br><span class="hljs-built_in">ln</span> -s /xxx/anaconda3/envs/jekyll/bin/ruby /xxx/anaconda3/envs/jekyll/share/rubygems/bin/ruby<br>bundle init<br>bundle install<br>bundle update --bundler<br>bundle add jekyll<br>gem <span class="hljs-string">&quot;jekyll&quot;</span><br>gem <span class="hljs-string">&quot;jekyll-paginate&quot;</span><br>bundle update<br>bundle <span class="hljs-built_in">exec</span> jekyll -v<br>vim Gemfile + gem <span class="hljs-string">&quot;jekyll-paginate&quot;</span><br></code></pre></td></tr></table></figure></p><h2 id="run-on-local-computer">Run on local computer</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">bundle update<br>bundle <span class="hljs-built_in">exec</span> jekyll serve<br></code></pre></td></tr></table></figure><p>iMac is <figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs vim">Run in <span class="hljs-keyword">verbose</span> <span class="hljs-keyword">mode</span> <span class="hljs-keyword">to</span> see <span class="hljs-keyword">all</span> warnings.<br>                    done in <span class="hljs-number">2.362</span> seconds.<br> Auto-regeneration: enabled <span class="hljs-keyword">for</span> <span class="hljs-string">&#x27;/Users/wpsze/Documents/git-local/waipangsze.github.io&#x27;</span><br>    Server address: http://<span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">4000</span><br>  Server running... press ctrl-<span class="hljs-keyword">c</span> <span class="hljs-keyword">to</span> <span class="hljs-keyword">stop</span>.<br>[<span class="hljs-number">2022</span>-<span class="hljs-number">06</span>-<span class="hljs-number">01</span> <span class="hljs-number">13</span>:<span class="hljs-number">15</span>:<span class="hljs-number">18</span>] ERROR `/js/pageContent.js<span class="hljs-string">&#x27; not found.</span><br></code></pre></td></tr></table></figure></p><p>Open a browser with the ip address in above output</p><h2 id="upload-to-github">Upload to github</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh">git pull --rebase <span class="hljs-comment"># do this at the beginning</span><br>git status<br>git add . <span class="hljs-comment"># add all files</span><br>git commit --amend<br>git push (-f)<br>git push -u origin main<br></code></pre></td></tr></table></figure><h2 id="errors">Errors</h2><ol type="1"><li>jekyll/share/rubygems/bin/ruby: No such file or directory</li><li>Error installing jekyll: Failed to build gem native extension</li><li>cannot load such file – jekyll-paginate</li><li>Could not locate Gemfile (bundle init)</li><li>jekyll is not currently included in the bundle, perhaps you meant to add it to your Gemfile (Edit Gemfile, + gem "jekyll", "~&gt; 4.3"</li><li>make: /usr/bin/mkdir: Command not found ==&gt; in .zshrc, add source ~/.bashrc, and sudo ln -s /bin/mkdir /usr/bin/mkdir</li></ol><p>Reference: 1. <a href="https://s-canchi.github.io/2021-04-30-jekyll-conda/">Setting up a blog site with jekyll using conda</a> 2. <a href="https://github.com/kitian616/jekyll-TeXt-theme">TeXt Theme</a> 3. <a href="https://github.com/kitian616/jekyll-TeXt-theme/tree/master/docs/_posts">_posts</a> 4. <a href="https://github.com/Gaohaoyang/gaohaoyang.github.io/tree/master">gaohaoyang.github.io)</a> 5. <a href="https://gaohaoyang.github.io/">Welcome to HyG's Blog! 这里记录着我的前端学习之路</a></p>]]></content>
    
    
    <categories>
      
      <category>github</category>
      
    </categories>
    
    
    <tags>
      
      <tag>github.io</tag>
      
      <tag>blog</tag>
      
      <tag>jekyll</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
