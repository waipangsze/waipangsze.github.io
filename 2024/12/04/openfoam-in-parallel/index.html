

<!DOCTYPE html>
<html lang="en" data-default-color-scheme=light>



<head>
  <meta charset="UTF-8">

  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="wpsze">
  <meta name="keywords" content="">
  
    <meta name="description" content="Running applications in parallel              Both domain decomposition and reconstruction processes can only be done on a single core.            This section describes how to run OpenFOAM in paralle">
<meta property="og:type" content="article">
<meta property="og:title" content="CFD | OpenFOAM | In parallel">
<meta property="og:url" content="https://waipangsze.github.io/2024/12/04/openfoam-in-parallel/index.html">
<meta property="og:site_name" content="wpsze">
<meta property="og:description" content="Running applications in parallel              Both domain decomposition and reconstruction processes can only be done on a single core.            This section describes how to run OpenFOAM in paralle">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://i.imgur.com/fFT42Yk.png">
<meta property="article:published_time" content="2024-12-04T07:42:00.000Z">
<meta property="article:modified_time" content="2024-12-04T10:08:32.930Z">
<meta property="article:author" content="wpsze">
<meta property="article:tag" content="HPC">
<meta property="article:tag" content="OpenFOAM">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://i.imgur.com/fFT42Yk.png">
  
  
    <meta name="referrer" content="no-referrer-when-downgrade">
  
  
  <title>CFD | OpenFOAM | In parallel - wpsze</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css">



<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"waipangsze.github.io","root":"/","version":"1.9.8","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false},"umami":{"src":null,"website_id":null,"domains":null,"start_time":"2024-01-01T00:00:00.000Z","token":null,"api_server":null}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  

  

  

  

  

  



  
<meta name="generator" content="Hexo 7.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>wpsze</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>Home</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>Archives</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>Categories</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>Tags</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/" target="_self">
                <i class="iconfont icon-link-fill"></i>
                <span>Links</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/bookmark/" target="_self">
                <i class="iconfont icon-bookmark"></i>
                <span>Bookmarks</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>About Me</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" target="_self" href="javascript:;" role="button"
                 data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <i class="iconfont icon-books"></i>
                <span>Docs</span>
              </a>
              <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                
                  
                  
                  
                  <a class="dropdown-item" href="/categories/Physics/" target="_self">
                    <i class="iconfont icon-plan"></i>
                    <span>Physics</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/categories/Maths/" target="_self">
                    <i class="iconfont icon-plan"></i>
                    <span>Maths</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/categories/CFD/" target="_self">
                    <i class="iconfont icon-plan"></i>
                    <span>CFD</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/categories/Meteorology/" target="_self">
                    <i class="iconfont icon-plan"></i>
                    <span>Meteorology</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/monitor/" target="_self">
                    
                    <span>Real Time Monitor</span>
                  </a>
                
              </div>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('https://i.imgur.com/fFT42Yk.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="CFD | OpenFOAM | In parallel"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2024-12-04 15:42" pubdate>
          December 4, 2024 pm
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          500 words
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          5 mins
        
      </span>
    

    
    
      
        <span id="busuanzi_container_page_pv" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="busuanzi_value_page_pv"></span> views
        </span>
        

      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">CFD | OpenFOAM | In parallel</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="running-applications-in-parallel">Running applications in parallel</h1>
<div class="note note-danger">
            <p>Both <strong>domain decomposition and reconstruction processes</strong> can only be done on a <strong>single core</strong>.</p>
          </div>
<p>This section describes how to run OpenFOAM in parallel on distributed processors.</p>
<div class="note note-danger">
            <p>The method of parallel computing used by OpenFOAM is known as <strong>domain decomposition</strong>, in which the geometry and associated fields are broken into pieces and allocated to separate processors for solution.</p>
          </div>
<p>The process of parallel computation involves: decomposition of mesh and fields; running the application in parallel; and, post-processing the decomposed case as described in the following sections. The parallel running uses the public domain <strong>openMPI</strong> implementation of the standard message passing interface (MPI).</p>
<h2 id="decomposition-of-mesh-and-initial-field-data">Decomposition of mesh and initial field data</h2>
<ul>
<li>The mesh and fields are decomposed using the decomposePar utility.</li>
<li>The geometry and fields are broken up according to a set of parameters specified in a dictionary named <code>decomposeParDict</code> that must be located in the <code>system</code> directory of the case of interest.</li>
</ul>
<p>An example <code>decomposeParDict</code> dictionary can be copied from the <code>interFoam/damBreak/damBreak</code> tutorial if the user requires one; the dictionary entries within it are reproduced below:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-number">17</span> numberOfSubdomains <span class="hljs-number">8</span>;<br><span class="hljs-number">18</span><br><span class="hljs-number">19</span> method          simple;<br><span class="hljs-number">20</span><br><span class="hljs-number">21</span> simpleCoeffs<br><span class="hljs-number">22</span> &#123;<br><span class="hljs-number">23</span>     <span class="hljs-built_in">n</span>           (<span class="hljs-number">4</span> <span class="hljs-number">1</span> <span class="hljs-number">2</span>);<br><span class="hljs-number">24</span> &#125;<br><span class="hljs-number">25</span><br><span class="hljs-number">26</span> <span class="hljs-comment">// ******************************* //</span><br></code></pre></td></tr></table></figure>
<figure>
<img src="https://i.imgur.com/rxTVXxT.png" srcset="/img/loading.gif" lazyload alt="&quot;simple&quot; geometric decomposition" width="600" /><figcaption>"simple" geometric decomposition</figcaption>
</figure>
<p>The user has a choice of four methods of decomposition, specified by the method keyword as described below.</p>
<ul>
<li><code>simple</code>
<ul>
<li>Simple geometric decomposition in which the domain is split into pieces by direction.</li>
</ul></li>
<li><code>hierarchical</code>
<ul>
<li>Hierarchical geometric decomposition which is the same as simple except the user specifies the order in which the directional split is done.</li>
</ul></li>
<li><code>scotch</code>
<ul>
<li>Scotch decomposition which requires no geometric input from the user and attempts to minimise the number of processor boundaries. The user can specify a weighting for the decomposition between processors, through an optional processorWeights keyword which can be useful on machines with differing performance between processors. There is also an optional keyword entry strategy that controls the decomposition strategy through a complex string supplied to Scotch. For more information, see the source code file: <code>$FOAM_SRC/parallel/decompose/scotchDecomp/scotchDecomp.C</code></li>
</ul></li>
<li><code>manual</code>
<ul>
<li>Manual decomposition, where the user directly specifies the allocation of each cell to a particular processor.</li>
</ul></li>
</ul>
<p>For each method there are a set of coefficients specified in a sub-dictionary of <code>decompositionDict</code>, named <code>&lt;method&gt;Coeffs</code> as shown in the dictionary listing.</p>
<h3 id="docs-and-github-code">Docs and github code:</h3>
<ul>
<li>Ref: <a target="_blank" rel="noopener" href="https://www.openfoam.com/documentation/guides/latest/doc/openfoam-guide-parallel.html">The decomposeParDict | OpenFOAM: User Guide</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/OpenFOAM/OpenFOAM-4.x/blob/master/applications/utilities/parallelProcessing/decomposePar/decomposeParDict">decomposeParDict code</a></li>
</ul>
<table>
<thead>
<tr class="header">
<th style="text-align: left;"><strong>Name</strong></th>
<th style="text-align: left;"><strong>Class</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">none</td>
<td style="text-align: left;">Foam::noDecomp</td>
</tr>
<tr class="even">
<td style="text-align: left;">manual</td>
<td style="text-align: left;">Foam::manualDecomp</td>
</tr>
<tr class="odd">
<td style="text-align: left;">simple</td>
<td style="text-align: left;">Foam::simpleGeomDecomp</td>
</tr>
<tr class="even">
<td style="text-align: left;">hierarchical</td>
<td style="text-align: left;">Foam::hierarchGeomDecomp</td>
</tr>
<tr class="odd">
<td style="text-align: left;">kahip</td>
<td style="text-align: left;">Foam::kahipDecomp</td>
</tr>
<tr class="even">
<td style="text-align: left;">metis</td>
<td style="text-align: left;">Foam::metisDecomp</td>
</tr>
<tr class="odd">
<td style="text-align: left;">scotch</td>
<td style="text-align: left;">Foam::scotchDecomp</td>
</tr>
<tr class="even">
<td style="text-align: left;">structured</td>
<td style="text-align: left;">Foam::structuredDecomp</td>
</tr>
<tr class="odd">
<td style="text-align: left;">multiLevel</td>
<td style="text-align: left;">Foam::multiLevelDecomp</td>
</tr>
</tbody>
</table>
<p>If using metis,</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs c++">numberOfSubdomains   N;<br>method               metis;<br><br>metisCoeffs<br>&#123;<br>    method           k-way;  <span class="hljs-comment">// recursive or k-way</span><br>    <span class="hljs-built_in">options</span>          ( ...);<br>    <span class="hljs-built_in">processorWeights</span> ( ... );<br>&#125;<br></code></pre></td></tr></table></figure>
<p>error,</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs console"><span class="hljs-meta prompt_">--&gt; </span><span class="language-bash">FOAM FATAL ERROR:</span> <br>You are trying to use metis but do not have the metisDecomp library loaded.<br>This message is from the dummy metisDecomp stub library instead.<br><br>Please install metis and make sure that libmetis.so is in your LD_LIBRARY_PATH.<br>The metisDecomp library can then be built from $FOAM_SRC/parallel/decompose/metisDecomp and dynamically loading or linking this library will add metis as a decomposition method.<br>Please be aware that there are license restrictions on using Metis.<br><br>    From function Foam::List&lt;signed int&gt; Foam::metisDecomp::decompose(const Foam::polyMesh &amp;, const Foam::Field&lt;Foam::Vector&lt;double&gt;&gt; &amp;, const Foam::Field&lt;double&gt; &amp;)<br>    in file dummyMetisDecomp.C at line 93.<br><br>FOAM exiting<br></code></pre></td></tr></table></figure>
<h2 id="run.sh-script">run.sh script</h2>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">## Loading OpenFOAM environment</span><br><br><span class="hljs-comment"># NP=Number of cores available in the system.</span><br><span class="hljs-built_in">export</span> NP=$(<span class="hljs-built_in">nproc</span>)<br><br><span class="hljs-comment"># Create decomposeParDict file to support $NP number of processes.</span><br><span class="hljs-built_in">cp</span> system/decomposeParDict.6 system/decomposeParDict.<span class="hljs-variable">$&#123;NP&#125;</span><br><br><span class="hljs-comment"># Change the numberOfSubdomains in decomposeParDict to create $NP number of subdomains</span><br>sed -i <span class="hljs-string">&quot;s/numberOfSubdomains.*/numberOfSubdomains <span class="hljs-variable">$&#123;NP&#125;</span>;/&quot;</span> system/decomposeParDict.<span class="hljs-variable">$&#123;NP&#125;</span><br><br><span class="hljs-comment">#Change the grid size for $NP, here setting grid size for 192 core system (48*4*1)</span><br>sed -i <span class="hljs-string">&quot;s/ n           (3 2 1)/ n           (48 4 1);/&quot;</span> system/decomposeParDict.<span class="hljs-variable">$&#123;NP&#125;</span><br><br><span class="hljs-comment">#Default Mesh size is very small (0.35M cells), scaling up the Mesh size to 20M cells</span><br>sed -i <span class="hljs-string">&quot;s/(20 8 8)/(100 40 40)/&quot;</span> system/blockMeshDict<br><br><span class="hljs-comment">#To use the file &quot;system/decomposeParDict.$&#123;NP&#125;&quot; in Allrun (run script)</span><br>sed -i <span class="hljs-string">&quot;s#system/decomposeParDict.6#system/decomposeParDict.<span class="hljs-variable">$&#123;NP&#125;</span>#&quot;</span> Allrun<br><br><span class="hljs-comment">#To run the benchmark</span><br><span class="hljs-comment">#Allrun script executes a combination multiple steps</span><br><span class="hljs-comment">#like Mesh creation, Setting the initial fields, Running the application, Postprocessing etc.</span><br>./Allrun<br></code></pre></td></tr></table></figure>
<h2 id="decomposepar"><code>decomposePar</code></h2>
<p>The <code>decomposePar</code> utility is executed in the normal manner by typing</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">decomposePar<br></code></pre></td></tr></table></figure>
<p>On completion, a set of subdirectories will have been created, one for each processor, in the case directory. The directories are named <code>processorN</code> represents a processor number and contains a time directory, containing the decomposed field descriptions, and a <code>constant/polyMesh</code> directory containing the decomposed mesh description.</p>
<h2 id="example-motorbike">Example, <code>motorBike</code></h2>
<ul>
<li><code>./Allrun</code></li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/sh</span><br><span class="hljs-built_in">cd</span> <span class="hljs-variable">$&#123;0%/*&#125;</span> || <span class="hljs-built_in">exit</span> 1    <span class="hljs-comment"># run from this directory</span><br><br><span class="hljs-comment"># Source tutorial run functions</span><br>. <span class="hljs-variable">$WM_PROJECT_DIR</span>/bin/tools/RunFunctions<br><br>xxx<br></code></pre></td></tr></table></figure>
<p>and outputs are,</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs console">xxx<br></code></pre></td></tr></table></figure>
<h1 id="post-processing-parallel-processed-cases">Post-processing parallel processed cases</h1>
<p>When post-processing cases that have been run in parallel the user can:</p>
<ul>
<li>reconstruct the mesh and field data to recreate the complete domain and fields, which can be post-processed as normal;</li>
<li>post-process each segment of decomposed domain individually; or</li>
<li>use ParaView via the option paraFoam -vtk and select the decomposedCase from the GUI whereby the case will be assembled internally</li>
</ul>
<h2 id="reconstructing-mesh-and-data">Reconstructing mesh and data</h2>
<p>The <code>reconstructPar</code> utility performs such a reconstruction by executing the command:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">reconstructPar<br></code></pre></td></tr></table></figure>
<p>Executing <code>reconstructPar</code> without any additional options will process all stored time directories.</p>
<h1 id="issues">Issues</h1>
<ul>
<li><a target="_blank" rel="noopener" href="https://cfd-china.com/topic/3170/openfoam%E5%9C%A8%E5%B9%B6%E8%A1%8C%E8%BF%90%E7%AE%97%E7%BB%93%E6%9D%9F%E5%90%8E-%E8%83%BD%E5%90%A6%E5%B9%B6%E8%A1%8Creconstructpar-%E6%88%96%E8%80%85%E6%9C%89%E6%B2%A1%E6%9C%89%E5%85%B6%E4%BB%96%E6%96%B9%E6%B3%95%E8%83%BD%E5%A4%9F%E5%8A%A0%E5%BF%ABreconstructpar">OpenFOAM在并行运算结束后 能否并行reconstructPar？或者有没有其他方法能够加快reconstructPar？</a>
<ul>
<li>最近跑了几个网格总数比较大的案例（大概500w~1000w），并行计算结束后，执行了reconstructPar进行重构，但是重构时间特别长。</li>
<li>试试这个 <code>mpirun -np 2 redistributePar -reconstruct -parallel</code></li>
<li>印象中以前看一个培训材料说分块和重构都只能单核</li>
<li>openfoam的decomposePar、reconstructPar是个老大难。这个应该需要大幅度的fund他们才会解决。目前他们对这方面还没有迫切的处理需求。目前openfoam针对reconstructPar这面的处理方式是后处理也是并行来搞，paraview直接看decompose的数据，各种postProcess也都是并行来。针对decomposePar慢的问题，openfoam这面是画网格snappyHexMesh直接并行来。所以我这面尝试处理2个亿网格，从生成到计算，也还可以。但是如果是第三方生成的2个亿网格，需要decomposePar，那可就慢了</li>
</ul></li>
</ul>
<h1 id="references">References</h1>
<ol type="1">
<li><a target="_blank" rel="noopener" href="https://www.openfoam.com/documentation/user-guide/3-running-applications/3.2-running-applications-in-parallel">3.2 Running applications in parallel</a></li>
<li><a target="_blank" rel="noopener" href="https://www.amd.com/zh-tw/developer/zen-software-studio/applications/spack/hpc-applications-openfoam.html">Build OpenFOAM using Spack</a></li>
<li><a target="_blank" rel="noopener" href="https://www.openfoam.com/documentation/guides/latest/doc/openfoam-guide-parallel.html">The decomposeParDict | OpenFOAM: User Guide</a></li>
</ol>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/CFD/" class="category-chain-item">CFD</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/HPC/" class="print-no-link">#HPC</a>
      
        <a href="/tags/OpenFOAM/" class="print-no-link">#OpenFOAM</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>CFD | OpenFOAM | In parallel</div>
      <div>https://waipangsze.github.io/2024/12/04/openfoam-in-parallel/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>Author</div>
          <div>wpsze</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>Posted on</div>
          <div>December 4, 2024</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>Updated on</div>
          <div>December 4, 2024</div>
        </div>
      
      
        <div class="license-meta-item">
          <div>Licensed under</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - Attribution">
                    <i class="iconfont icon-cc-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2024/12/04/openfoam-notes/" title="CFD | OpenFOAM | Notes/Blogs">
                        <span class="hidden-mobile">CFD | OpenFOAM | Notes/Blogs</span>
                        <span class="visible-mobile">Next</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>Table of Contents</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  


  
  





  <script>
  Fluid.utils.createScript('https://lib.baomitu.com/mermaid/8.14.0/mermaid.min.js', function() {
    mermaid.initialize({"theme":"default"});

    Fluid.utils.listenDOMLoaded(function() {
      Fluid.events.registerRefreshCallback(function() {
        if ('mermaid' in window) {
          mermaid.init();
        }
      });
    });
  });
</script>






    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">Keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">

  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  

  <span id="sitetime"></span>
  <script language=javascript>
    function siteTime(){
      window.setTimeout("siteTime()", 1000);
      var seconds = 1000;
      var minutes = seconds * 60;
      var hours = minutes * 60;
      var days = hours * 24;
      var years = days * 365;
      var today = new Date();
      var todayYear = today.getFullYear();
      var todayMonth = today.getMonth()+1;
      var todayDate = today.getDate();
      var todayHour = today.getHours();
      var todayMinute = today.getMinutes();
      var todaySecond = today.getSeconds();
      /* Date.UTC() -- 返回date对象距世界标准时间(UTC)1970年1月1日午夜之间的毫秒数(时间戳)
      year - 作为date对象的年份，为4位年份值
      month - 0-11之间的整数，做为date对象的月份
      day - 1-31之间的整数，做为date对象的天数
      hours - 0(午夜24点)-23之间的整数，做为date对象的小时数
      minutes - 0-59之间的整数，做为date对象的分钟数
      seconds - 0-59之间的整数，做为date对象的秒数
      microseconds - 0-999之间的整数，做为date对象的毫秒数 */
      var t1 = Date.UTC(2023,04,23,00,00,00); //北京时间2018-2-13 00:00:00
      var t2 = Date.UTC(todayYear,todayMonth,todayDate,todayHour,todayMinute,todaySecond);
      var diff = t2-t1;
      var diffYears = Math.floor(diff/years);
      var diffDays = Math.floor((diff/days)-diffYears*365);
      var diffHours = Math.floor((diff-(diffYears*365+diffDays)*days)/hours);
      var diffMinutes = Math.floor((diff-(diffYears*365+diffDays)*days-diffHours*hours)/minutes);
      var diffSeconds = Math.floor((diff-(diffYears*365+diffDays)*days-diffHours*hours-diffMinutes*minutes)/seconds);
      /*document.getElementById("sitetime").innerHTML=" 已运行"+/*diffYears+" 年 "+*/diffDays+" 天 "+diffHours+" 小时 "+diffMinutes+" 分钟 "+diffSeconds+" 秒";
      document.getElementById("sitetime").innerHTML=" 已運行"+diffYears+" 年 "+diffDays+" 天 ";
    }/*因为建站时间还没有一年，就将之注释掉了。需要的可以取消*/
    siteTime();
  </script>
  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/5.0.0/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  
      <script>
        if (!window.MathJax) {
          window.MathJax = {
            tex    : {
              inlineMath: { '[+]': [['$', '$']] }
            },
            loader : {
              load: ['ui/lazy']
            },
            options: {
              renderActions: {
                insertedScript: [200, () => {
                  document.querySelectorAll('mjx-container').forEach(node => {
                    let target = node.parentNode;
                    if (target.nodeName.toLowerCase() === 'li') {
                      target.parentNode.classList.add('has-jax');
                    }
                  });
                }, '', false]
              }
            }
          };
        } else {
          MathJax.startup.document.state(0);
          MathJax.texReset();
          MathJax.typeset();
          MathJax.typesetPromise();
        }

        Fluid.events.registerRefreshCallback(function() {
          if ('MathJax' in window && MathJax.startup.document && typeof MathJax.startup.document.state === 'function') {
            MathJax.startup.document.state(0);
            MathJax.texReset();
            MathJax.typeset();
            MathJax.typesetPromise();
          }
        });
      </script>
    

  <script  src="https://lib.baomitu.com/mathjax/3.2.2/es5/tex-mml-chtml.js" ></script>

  <script  src="/js/local-search.js" ></script>

  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">Blog works best with JavaScript enabled</div>
  </noscript>
</body>
</html>
