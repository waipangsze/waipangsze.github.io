

<!DOCTYPE html>
<html lang="en" data-default-color-scheme=light>



<head>
  <meta charset="UTF-8">

  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="wpsze">
  <meta name="keywords" content="">
  
    <meta name="description" content="Open Dataset  ECMWF to achieve fully open data status in 2025 | 17 March 2025  ECMWF is bringing forward the full transition to open data by an entire year, to 1 October 2025, marking a significant mi">
<meta property="og:type" content="article">
<meta property="og:title" content="NWP | ECMWF | IFS | Open data">
<meta property="og:url" content="https://waipangsze.github.io/2024/11/12/ECMWF-IFS/index.html">
<meta property="og:site_name" content="wpsze">
<meta property="og:description" content="Open Dataset  ECMWF to achieve fully open data status in 2025 | 17 March 2025  ECMWF is bringing forward the full transition to open data by an entire year, to 1 October 2025, marking a significant mi">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://www.ecmwf.int/sites/default/files/flags-council-chamber-650px.jpg">
<meta property="article:published_time" content="2024-11-12T02:00:00.000Z">
<meta property="article:modified_time" content="2025-10-20T08:12:06.170Z">
<meta property="article:author" content="wpsze">
<meta property="article:tag" content="WRF">
<meta property="article:tag" content="WPS">
<meta property="article:tag" content="MPAS">
<meta property="article:tag" content="IC&#x2F;BC">
<meta property="article:tag" content="ECMWF">
<meta property="article:tag" content="IFS">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://www.ecmwf.int/sites/default/files/flags-council-chamber-650px.jpg">
  
  
    <meta name="referrer" content="no-referrer-when-downgrade">
  
  
  <title>NWP | ECMWF | IFS | Open data - wpsze</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css">



<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"waipangsze.github.io","root":"/","version":"1.9.8","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"follow_dnt":true,"baidu":null,"google":{"measurement_id":"F7MK-FcxSomhtc1N3hIUDA"},"tencent":{"sid":null,"cid":null},"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false},"umami":{"src":null,"website_id":null,"domains":null,"start_time":"2024-01-01T00:00:00.000Z","token":null,"api_server":null}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  

  

  
    <!-- Google tag (gtag.js) -->
    <script async>
      if (!Fluid.ctx.dnt) {
        Fluid.utils.createScript("https://www.googletagmanager.com/gtag/js?id=F7MK-FcxSomhtc1N3hIUDA", function() {
          window.dataLayer = window.dataLayer || [];
          function gtag() {
            dataLayer.push(arguments);
          }
          gtag('js', new Date());
          gtag('config', 'F7MK-FcxSomhtc1N3hIUDA');
        });
      }
    </script>
  

  

  

  



  
<meta name="generator" content="Hexo 7.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>wpsze</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>Home</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>Archives</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>Categories</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>Tags</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/" target="_self">
                <i class="iconfont icon-link-fill"></i>
                <span>Links</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/bookmark/" target="_self">
                <i class="iconfont icon-bookmark"></i>
                <span>Bookmarks</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" target="_self" href="javascript:;" role="button"
                 data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <i class="iconfont icon-books"></i>
                <span>Docs</span>
              </a>
              <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                
                  
                  
                  
                  <a class="dropdown-item" href="/categories/Physics/" target="_self">
                    <i class="iconfont icon-plan"></i>
                    <span>Physics</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/categories/Maths/" target="_self">
                    <i class="iconfont icon-plan"></i>
                    <span>Maths</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/categories/CFD/" target="_self">
                    <i class="iconfont icon-plan"></i>
                    <span>CFD</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/categories/ML/" target="_self">
                    <i class="iconfont icon-plan"></i>
                    <span>ML</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/categories/Meteorology/" target="_self">
                    <i class="iconfont icon-plan"></i>
                    <span>Meteorology</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/categories/MPAS/" target="_self">
                    <i class="iconfont icon-plan"></i>
                    <span>MPAS</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/categories/PALM/" target="_self">
                    <i class="iconfont icon-plan"></i>
                    <span>PALM</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/monitor/" target="_self">
                    
                    <span>Real Time Monitoring</span>
                  </a>
                
              </div>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>About Me</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('https://www.ecmwf.int/sites/default/files/flags-council-chamber-650px.jpg') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="NWP | ECMWF | IFS | Open data"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2024-11-12 10:00" pubdate>
          November 12, 2024 am
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          7.7k words
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          65 mins
        
      </span>
    

    
    
      
        <span id="busuanzi_container_page_pv" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="busuanzi_value_page_pv"></span> views
        </span>
        

      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">NWP | ECMWF | IFS | Open data</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="open-dataset">Open Dataset</h1>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.ecmwf.int/en/about/media-centre/news/2025/ecmwf-achieve-fully-open-data-status-2025">ECMWF to achieve fully open data status in 2025 | 17 March 2025</a>
<ul>
<li><strong>ECMWF is bringing forward the full transition to open data by an entire year, to 1 October 2025</strong>, marking a significant milestone in its commitment to making weather data more accessible and impactful.</li>
</ul></li>
</ul>
<p>ECMWF now provides a much larger open dataset to the public, representing weather forecasts at a higher resolution and a reduction in some release times, after a <a target="_blank" rel="noopener" href="https://www.ecmwf.int/en/about/media-centre/news/2022/ecmwf-makes-wide-range-data-openly-available">first set of data was made available in early 2022</a>.</p>
<p>The changes can be summarised as follows:</p>
<ul>
<li>Medium-range data of the <strong>Integrated Forecasting System (IFS)</strong> are provided at a resolution of <strong>0.25 x 0.25 degrees (28 x 28 km)</strong>, compared to 0.4 x 0.4 degrees before, and some additional parameters will be added.</li>
<li>Medium-range data of the latest beta version of the <strong>Artificial Intelligence/Integrated Forecasting System (AIFS)</strong> are also available at a <strong>resolution of 0.25 x 0.25 degrees</strong>.</li>
<li>ECMWF’s contribution to the sub-seasonal to seasonal (S2S) dataset, which is part of a global scheme, is now available with a 48-hour delay rather than the previous three-week delay.</li>
<li>All parameters of the EU’s Copernicus Atmosphere Monitoring Service (CAMS) that used to a have a six-day embargo are now available in real time.</li>
</ul>
<p>An <a target="_blank" rel="noopener" href="https://www.ecmwf.int/en/forecasts/datasets/open-data">overview of open data</a> is given on the ECMWF website.</p>
<p>歐洲中期天氣預報中心 (ECMWF) 的 IFS 模式現在可以作為 0.25 度解析度的開放資料取得。從 2024 年 2 月 1 日 開始，IFS 開放資料分佈的解析度從 0.4 度提高到 0.25 度。這項改進顯著提高了數據精度，尤其是在沿海地區和山區。改進後的分辨率受到了廣泛歡迎，因為之前的 0.4 度分辨率對於許多應用來說太粗糙。</p>
<p>資料下載連結： <div class="note note-warning">
            <p><a target="_blank" rel="noopener" href="https://data.ecmwf.int/forecasts/" class="uri">https://data.ecmwf.int/forecasts/</a></p>
          </div></p>
<p>規格如下：</p>
<ul>
<li>解析度從 0.4° 提升至 <strong>0.25°</strong></li>
<li>0.25° x 0.25° lat/lon grid or any multiple thereof (global or sub-area)</li>
<li>On model (Reduced Gaussian) n320 grid</li>
<li>地表變因：2 公尺氣溫、地表溫度、降水量、氣壓、10 公尺風速</li>
<li>9 個大氣壓力層位提供溫度、濕度或風速數據</li>
<li><strong>10 天預報，時間間隔 3 小時</strong></li>
<li>15 天集合預報，包含 51 個集合成員</li>
<li><strong>每天更新 4 次</strong> (00/06/12/18)</li>
<li>最新測試版的人工智慧/綜合預測系統（<strong>AIFS</strong>）的中尺度資料也可提供0.25 x 0.25度的解析度</li>
<li>歐洲中期天氣預報中心（ECMWF）對次季節到季節尺度（<strong>S2S</strong>）資料集的貢獻，作為全球計劃的一部分，<strong>現在可以在48小時延遲後獲取，而不是之前的三週延遲</strong>
<ul>
<li>歐洲中期天氣預報中心(ECMWF)在由世界氣象研究計畫(WWRP)和世界氣候研究計畫(WCRP)組織的預測計畫中，對次季節到季節尺度天氣預報也進行了大大減少的延遲。 ECMWF是此計畫的眾多預報中心之一。我們的預報現在只有48小時的延遲，而不是以前的三週延遲。計劃是鼓勵所有次季節性到季節尺度資料提供者同意減少他們的貢獻延遲。更多資訊可以在次季節性到季節尺度存檔頁面上找到（<a target="_blank" rel="noopener" href="https://confluence.ecmwf.int/display/S2S/S2S+archive" class="uri">https://confluence.ecmwf.int/display/S2S/S2S+archive</a>）</li>
</ul></li>
<li>歐盟的哥白尼大氣監測服務（CAMS）的所有參數，原本需要六天的禁止發布期，現在都可以即時取得
<ul>
<li>ECMWF每天提供全球大氣組成的預報，作為其CAMS產品組合的一部分。這些預報包括0.4 x 0.4度的所有氣象變數。這些預報的壓力層資料和一些地表場資料以前只能在六天後才能獲得。現在它們可以即時獲取，就像大氣組成產品一樣。有關CAMS資料的更多詳細信息，請參閱全球大氣組成預報資料文件頁面（<a target="_blank" rel="noopener" href="https://confluence.ecmwf.int/display/CKB/CAMS%3A+Global+atmospheric+composition+forecast+data+documentation" class="uri">https://confluence.ecmwf.int/display/CKB/CAMS%3A+Global+atmospheric+composition+forecast+data+documentation</a>）。</li>
</ul></li>
<li>升級後的解析度已無縫整合到 Open-Meteo 天氣 API 中。現在您可以比較 18 個不同天氣模型的預報，評估預報的不確定性並選擇最符合您需求的模型。</li>
<li>0.25° 解析度的 51 個集合成員可以透過 Ensemble API 存取。有關 ECMWF IFS 開放資料計劃的更多詳細信息，請參閱 ECMWF 網站。</li>
</ul>
<p>憑藉 0.25° 的分辨率，新的 IFS 開放資料模型適用於 Google GraphCast <strong>機器學習模型</strong>的實際操作。先前，GraphCast 依賴歐洲地球觀測計畫的 <strong>ERA5 資料集，該資料集存在 5 天的延遲</strong>，使其不適用於即時預報應用。開放資料 IFS 0.25° 的發布現在允許您每 6 小時執行 GraphCast 並建立機器學習預報。唯一需要注意的是，高效運行 GraphCast 需要一個大型 GPU，但與超級電腦相比，這已經非常划算了。</p>
<ul>
<li>這些將實現有限區域建模和機器學習初始化。有關即時預測的文件可以在開放資料頁面找到。</li>
<li>最新測試版<strong>AIFS</strong>的中期數據也以0.25 x 0.25度的解析度提供。這是目前AIFS運作的解析度。有關AIFS的更多信息，包括訪問數據的鏈接，請參閱AIFS機器學習數據頁面（<a target="_blank" rel="noopener" href="https://www.ecmwf.int/en/forecasts/dataset/aifs-machine-learning-data" class="uri">https://www.ecmwf.int/en/forecasts/dataset/aifs-machine-learning-data</a>）。</li>
</ul>
<h1 id="snapshot">Snapshot</h1>
<p><img src="https://i.imgur.com/onPeaOO.png" srcset="/img/loading.gif" lazyload width="400" /></p>
<ul>
<li><strong>---Only few days Available---</strong> !!!</li>
<li>File format
<ul>
<li>The files are in GRIB edition 2 format, except for trajectories which are in BUFR edition 4 format.</li>
</ul></li>
</ul>
<table>
<thead>
<tr class="header">
<th>Grib Code</th>
<th>Mars Abbreviation</th>
<th>Long Name</th>
<th>Available model runs</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1025</td>
<td>oper</td>
<td>Atmospheric model</td>
<td>00z, 12z</td>
</tr>
<tr class="even">
<td>1026</td>
<td>scda</td>
<td>Atmospheric model (short cutoff)</td>
<td>06z, 18z</td>
</tr>
<tr class="odd">
<td>1035</td>
<td>enfo</td>
<td>Ensemble prediction system</td>
<td>00z, 06z, 12z, 18z</td>
</tr>
<tr class="even">
<td>1045</td>
<td>wave</td>
<td>Wave model</td>
<td>00z, 12z</td>
</tr>
<tr class="odd">
<td>1081</td>
<td>waef</td>
<td>Wave ensemble forecast</td>
<td></td>
</tr>
</tbody>
</table>
<p>from <a target="_blank" rel="noopener" href="https://codes.ecmwf.int/grib/format/mars/stream/" class="uri">https://codes.ecmwf.int/grib/format/mars/stream/</a></p>
<figure>
<img src="https://i.imgur.com/j5aMuFL.png" srcset="/img/loading.gif" lazyload alt="Time available (UTC)" width="400" /><figcaption>Time available (UTC)</figcaption>
</figure>
<h2 id="ecmwf-open-data-real-time-forecasts-from-ifs-and-aifs-feb-26-2025">ECMWF open data: real-time forecasts from IFS and AIFS (Feb 26, 2025)</h2>
<ul>
<li><a target="_blank" rel="noopener" href="https://confluence.ecmwf.int/display/DAC/ECMWF+open+data%3A+real-time+forecasts+from+IFS+and+AIFS">ECMWF open data: real-time forecasts from IFS and AIFS (Feb 26, 2025)</a></li>
</ul>
<p>Currently, ECMWF open real-time data are available from these locations:</p>
<ul>
<li><strong>ECMWF</strong>: <a target="_blank" rel="noopener" href="https://data.ecmwf.int/forecasts" class="uri">https://data.ecmwf.int/forecasts</a></li>
<li><strong>Amazon's AWS</strong>: "<a target="_blank" rel="noopener" href="https://ecmwf-forecasts.s3.eu-central-1.amazonaws.com" class="uri">https://ecmwf-forecasts.s3.eu-central-1.amazonaws.com</a>"</li>
<li><strong>Google Cloud</strong>: "<a target="_blank" rel="noopener" href="https://console.cloud.google.com/marketplace/product/bigquery-public-data/open-data-ecmwf" class="uri">https://console.cloud.google.com/marketplace/product/bigquery-public-data/open-data-ecmwf</a>"</li>
<li><strong>Microsoft's Azure</strong>: "<a target="_blank" rel="noopener" href="https://ai4edataeuwest.blob.core.windows.net/ecmwf" class="uri">https://ai4edataeuwest.blob.core.windows.net/ecmwf</a>" (warning) see below for access notes</li>
<li><strong>Open-meteo.com</strong>: "<a target="_blank" rel="noopener" href="https://open-meteo.com/en/docs/ecmwf-api" class="uri">https://open-meteo.com/en/docs/ecmwf-api</a>"</li>
<li>ECMWF is happy to announce that IFS Open Data is now available from <strong>Oikolab</strong>!</li>
</ul>
<h3 id="file-format">File format</h3>
<p>The files are in <strong>GRIB edition 2 format</strong>, except for trajectories which are in BUFR edition 4 format. We recommend using ecCodes version 2.38.0 or newer to manipulate the GRIB and BUFR files.</p>
<h3 id="file-naming-convention">File-naming convention</h3>
<p>The files are provided with the following naming convention:</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs console">[ROOT]/[yyyymmdd]/[HH]z/[model]/[resol]/[stream]/[yyyymmdd][HH]0000-[step][U]-[stream]-[type].[format]<br></code></pre></td></tr></table></figure>
<ul>
<li>[ROOT] is the top-level URL of one of the sites hosting the data. See the above for possible values.</li>
<li>[yyyymmdd] is the reference date of the forecasts (base date).</li>
<li>[HH] is the reference time of the forecasts. Values are 00, 06 , 12 and 18.</li>
<li>[model] is the production model (IFS or AIFS). <strong>Note: IFS and AIFS have different options, so please be review dataset pages to see what is available.</strong></li>
<li>[resol] is the horizontal resolution of the data. <strong>Options include: 0p25</strong></li>
<li>[stream] is the forecasting system that produces the data. Values are:
<ul>
<li>oper - high-resolution forecast, atmospheric fields</li>
<li>enfo - ensemble forecast, atmospheric fields (not applicable for AIFS model)</li>
<li>waef - ensemble forecast, ocean wave fields, (not applicable for AIFS model)</li>
<li>wave - wave model, (not applicable for AIFS model)</li>
<li>scda - short cut-off high-resolution forecast, atmospheric fields (also known as "high-frequency products") (not applicable for AIFS model)</li>
<li>scwv - short cut-off high-resolution forecast, ocean wave fields (also known as "high-frequency products") (not applicable for AIFS model) and</li>
<li>mmsf - multi-model seasonal forecasts fields from the ECMWF model only (not applicable for AIFS model).<br />
</li>
</ul></li>
<li>[step] is the forecast time step expressed in units U<br />
</li>
<li>[U] is the unit used for the time step. Values are h for hours and m for month. The latter is only valid for seasonal forecasts (mmsf).</li>
<li>[type] is once of fc (forecast), ef (ensemble forecast), ep (ensemble probabilities) or tf (trajectory forecast for tropical cyclone tracks).</li>
<li>[format] is grib2 for all fields, and bufr for the trajectories.</li>
</ul>
<h3 id="the-valid-combinations-of-the-above-are">The valid combinations of the above are:</h3>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs text">format=bufr, type=tf <br>   HH=00/12 <br>  	  stream=enfo/oper, step=240h <br>   HH=06/18 <br>      stream=enfo, step=144h <br>      stream=scda, step=90h <br>format=grib2 <br>   HH=00/12 <br>      stream=enfo/waef <br>        type=ef, step=0h to 144h by 3h, 144h to 360h by 6h <br>        type=ep, step=240h/360h <br>      stream=oper, wave <br>        type=fc, step=0h to 144h by 3h, 144h to 240h by 6h <br>   HH=06/18 <br>      stream=enfo/waef <br>        type=ef, step=0h to 144h by 3h <br>      stream= scda /scwv <br>        type=fc, step=0h to 90h by 3h <br>   HH=00 <br>   	  stream=mmsf, type=fc, u=m, step=1m to 7m <br></code></pre></td></tr></table></figure>
<h3 id="via-herbie">via Herbie</h3>
<div class="note note-primary">
            <ul><li><a href="https://waipangsze.github.io/2025/04/10/NWP-Herbie-Download-NWP-model-output-MPAS-WRF/"><strong>NWP | Herbie | Download NWP model output (grib2) | MPAS | WRF</strong></a></li></ul>
          </div>
<h1 id="variables">Variables</h1>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.ecmwf.int/en/forecasts/datasets/set-ix">Deterministic AIFS forecast (Set IX - AIFS)</a></li>
</ul>
<h2 id="single-level---forecast">Single level - forecast</h2>
<table>
<thead>
<tr class="header">
<th>Short Name</th>
<th>ID</th>
<th>Long Name</th>
<th>Units</th>
<th>Additional information</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>z</td>
<td>129</td>
<td>Geopotential</td>
<td>m^2 s^-2</td>
<td></td>
</tr>
<tr class="even">
<td>msl</td>
<td>151</td>
<td>Mean sea level pressure</td>
<td>Pa</td>
<td></td>
</tr>
<tr class="odd">
<td>sdor</td>
<td>160</td>
<td>Standard deviation of sub-gridscale orography</td>
<td>m</td>
<td></td>
</tr>
<tr class="even">
<td>slor</td>
<td>163</td>
<td>Slope of sub-gridscale orography</td>
<td>Numeric</td>
<td></td>
</tr>
<tr class="odd">
<td>10u</td>
<td>165</td>
<td>10 metre U wind component</td>
<td>m s^-1</td>
<td></td>
</tr>
<tr class="even">
<td>10v</td>
<td>166</td>
<td>10 metre V wind component</td>
<td>m s^-1</td>
<td></td>
</tr>
<tr class="odd">
<td>2t</td>
<td>167</td>
<td>2 metre temperature</td>
<td>K</td>
<td></td>
</tr>
<tr class="even">
<td>2d</td>
<td>168</td>
<td>2 metre dewpoint temperature</td>
<td>K</td>
<td></td>
</tr>
<tr class="odd">
<td>ssrd</td>
<td>169</td>
<td>Surface short-wave (solar) radiation downwards</td>
<td>J m^-2</td>
<td></td>
</tr>
<tr class="even">
<td>lsm</td>
<td>172</td>
<td>Land-sea mask</td>
<td>(0-1)</td>
<td></td>
</tr>
<tr class="odd">
<td>strd</td>
<td>175</td>
<td>Surface long-wave (thermal) radiation downwards</td>
<td>J m^-2</td>
<td></td>
</tr>
<tr class="even">
<td>lcc</td>
<td>3073</td>
<td>Low cloud cover</td>
<td>%</td>
<td></td>
</tr>
<tr class="odd">
<td>mcc</td>
<td>3074</td>
<td>Medium cloud cover</td>
<td>%</td>
<td></td>
</tr>
<tr class="even">
<td>hcc</td>
<td>3075</td>
<td>High cloud cover</td>
<td>%</td>
<td></td>
</tr>
<tr class="odd">
<td>rowe</td>
<td>231002</td>
<td>Runoff water equivalent (surface plus subsurface)</td>
<td>kg m^-2</td>
<td></td>
</tr>
<tr class="even">
<td>cp</td>
<td>228143</td>
<td>Convective precipitation</td>
<td>kg m^-2</td>
<td></td>
</tr>
<tr class="odd">
<td>sf</td>
<td>228144</td>
<td>Snowfall</td>
<td>kg m^-2</td>
<td></td>
</tr>
<tr class="even">
<td>tcc</td>
<td>228164</td>
<td>Total cloud cover</td>
<td>%</td>
<td></td>
</tr>
<tr class="odd">
<td>tp</td>
<td>228228</td>
<td>Total precipitation</td>
<td>kg m^-2</td>
<td></td>
</tr>
<tr class="even">
<td>100u</td>
<td>228246</td>
<td>100 metre U wind component</td>
<td>m s^-1</td>
<td></td>
</tr>
<tr class="odd">
<td>100v</td>
<td>228247</td>
<td>100 metre V wind component</td>
<td>m s^-1</td>
<td></td>
</tr>
</tbody>
</table>
<h2 id="pressure-level---forecast">Pressure level - forecast</h2>
<ul>
<li>All parameters are available at levels 1000, 925, 850, 700, 600, 500, 400, 300, 250, 200, 150, 100, 50 hPa</li>
</ul>
<table>
<thead>
<tr class="header">
<th>SHORT NAME</th>
<th>ID</th>
<th>LONG NAME</th>
<th>UNITS</th>
<th>ADDITIONAL INFORMATION</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>z</td>
<td>129</td>
<td>Geopotential</td>
<td>m^2 s^-2</td>
<td></td>
</tr>
<tr class="even">
<td>t</td>
<td>130</td>
<td>Temperature</td>
<td>K</td>
<td></td>
</tr>
<tr class="odd">
<td>u</td>
<td>131</td>
<td>U component of wind</td>
<td>m s^-1</td>
<td></td>
</tr>
<tr class="even">
<td>v</td>
<td>132</td>
<td>V component of wind</td>
<td>m s^-1</td>
<td></td>
</tr>
<tr class="odd">
<td>q</td>
<td>133</td>
<td>Specific humidity</td>
<td>kg kg^-1</td>
<td></td>
</tr>
<tr class="even">
<td>w</td>
<td>135</td>
<td>Vertical velocity</td>
<td>Pa s^-1</td>
<td></td>
</tr>
</tbody>
</table>
<h2 id="soil-level---forecast">Soil level - forecast</h2>
<ul>
<li>All parameters are available at levels 1, 2</li>
</ul>
<table>
<thead>
<tr class="header">
<th>SHORT NAME</th>
<th>ID</th>
<th>LONG NAME</th>
<th>UNITS</th>
<th>ADDITIONAL INFORMATION</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>vsw</td>
<td>260199</td>
<td>Volumetric soil moisture</td>
<td>m^3 m^-3</td>
<td></td>
</tr>
<tr class="even">
<td>sot</td>
<td>260360</td>
<td>Soil temperature</td>
<td>K</td>
<td></td>
</tr>
</tbody>
</table>
<h2 id="open-data-variables">open-data variables</h2>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.ecmwf.int/en/forecasts/datasets/open-data" class="uri">https://www.ecmwf.int/en/forecasts/datasets/open-data</a></li>
</ul>
<p>IFS data High-resolution products:</p>
<p>Steps:</p>
<ul>
<li>For times 00z &amp;12z: 0 to 144 by 3, 150 to 360 by 6.</li>
<li>For times 06z &amp; 18z: 0 to 144 by 3.</li>
<li>Type of level data:</li>
</ul>
<p>Surface (sfc), Surface Other level (sol) and Pressure Level (pl)</p>
<p>Pressure levels available (hPa): 1000, 925, 850, 700, 600, 500, 400, 300, 250, 200, 150, 100, 50</p>
<p>Only a single ID is used for Volumetric soil water and Soil Temperature with layer 1 having level=1, layer 2 having level=2 etc. Layers 1-4 are available.</p>
<table>

<thead>
<tr class="header">
<th>Short name</th>
<th>Long name</th>
<th>ID</th>
<th>Type of level</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>z</td>
<td>Geopotential (step 0)</td>
<td>129</td>
<td>sfc</td>
</tr>
<tr class="even">
<td>sdor</td>
<td>Standard deviation of sub-gridscale orography (step 0)</td>
<td>160</td>
<td>sfc</td>
</tr>
<tr class="odd">
<td>slor</td>
<td>Slope of sub-gridscale orography (step 0)</td>
<td>163</td>
<td>sfc</td>
</tr>
<tr class="even">
<td>10u</td>
<td>10 metre U wind component</td>
<td>165</td>
<td>sfc</td>
</tr>
<tr class="odd">
<td>10v</td>
<td>10 metre V wind component</td>
<td>166</td>
<td>sfc</td>
</tr>
<tr class="even">
<td>100u</td>
<td>100 metre U wind component</td>
<td>228246</td>
<td>sfc</td>
</tr>
<tr class="odd">
<td>100v</td>
<td>100 metre V wind component</td>
<td>228247</td>
<td>sfc</td>
</tr>
<tr class="even">
<td>10fg</td>
<td>Maximum 10 metre wind gust since previous post-processing - (appears as 10fg3 for steps 3 to 144)</td>
<td>49 / 228028</td>
<td>sfc</td>
</tr>
<tr class="odd">
<td>2t</td>
<td>2 metre temperature</td>
<td>167</td>
<td>sfc</td>
</tr>
<tr class="even">
<td>2d</td>
<td>2 metre dewpoint temperature</td>
<td>168</td>
<td>sfc</td>
</tr>
<tr class="odd">
<td>msl</td>
<td>Mean sea level pressure</td>
<td>151</td>
<td>sfc</td>
</tr>
<tr class="even">
<td>mp2</td>
<td>Mean zero-crossing wave period</td>
<td>140221</td>
<td>sfc</td>
</tr>
<tr class="odd">
<td>mwd</td>
<td>Mean wave direction</td>
<td>140230</td>
<td>sfc</td>
</tr>
<tr class="even">
<td>mwp</td>
<td>Mean wave period</td>
<td>140232</td>
<td>sfc</td>
</tr>
<tr class="odd">
<td>pp1d</td>
<td>Peak wave period</td>
<td>140231</td>
<td>sfc</td>
</tr>
<tr class="even">
<td>swh</td>
<td>Significant height of combined wind waves and swell</td>
<td>140229</td>
<td>sfc</td>
</tr>
<tr class="odd">
<td>ro</td>
<td>Runoff</td>
<td>205</td>
<td>sfc</td>
</tr>
<tr class="even">
<td>tp</td>
<td>Total Precipitation</td>
<td>228</td>
<td>sfc</td>
</tr>
<tr class="odd">
<td>sp</td>
<td>Surface pressure</td>
<td>134</td>
<td>sfc</td>
</tr>
<tr class="even">
<td>st</td>
<td>Soil temperature</td>
<td>228139</td>
<td>sfc</td>
</tr>
<tr class="odd">
<td>tcwv</td>
<td>Total column vertically-integrated water vapour</td>
<td>137</td>
<td>sfc</td>
</tr>
<tr class="even">
<td>lsm</td>
<td>Land Sea Mask</td>
<td>172</td>
<td>sfc</td>
</tr>
<tr class="odd">
<td>vsw</td>
<td>Volumetric soil water (layers 1-4)</td>
<td>260199</td>
<td>sol</td>
</tr>
<tr class="even">
<td>sot</td>
<td>Soil temperature (layers 1-4)</td>
<td>260360</td>
<td>sol</td>
</tr>
<tr class="odd">
<td>mucape</td>
<td>Most-unstable convective available potential energy</td>
<td>228235</td>
<td>sfc</td>
</tr>
<tr class="even">
<td>asn</td>
<td>Snow albedo</td>
<td>32</td>
<td>sfc</td>
</tr>
<tr class="odd">
<td>mn2t3</td>
<td>Minimum temperature at 2 metres in the last 3 hours</td>
<td>228027</td>
<td>sfc</td>
</tr>
<tr class="even">
<td>mx2t3</td>
<td>Maximum temperature at 2 metres in the last 3 hours</td>
<td>228026</td>
<td>sfc</td>
</tr>
<tr class="odd">
<td>mn2t6</td>
<td>Minimum temperature at 2 metres in the last 6 hours</td>
<td>122</td>
<td>sfc</td>
</tr>
<tr class="even">
<td>mx2t6</td>
<td>Maximum temperature at 2 metres in the last 6 hours</td>
<td>121</td>
<td>sfc</td>
</tr>
<tr class="odd">
<td>tprate</td>
<td>Total precipitation rate</td>
<td>260048</td>
<td>sfc</td>
</tr>
<tr class="even">
<td>ptype</td>
<td>Precipitation type</td>
<td>260015</td>
<td>sfc</td>
</tr>
<tr class="odd">
<td>ttr</td>
<td>Top net long-wave (thermal) radiation</td>
<td>179</td>
<td>sfc</td>
</tr>
<tr class="even">
<td>str</td>
<td>Surface net long-wave (thermal) radiation</td>
<td>177</td>
<td>sfc</td>
</tr>
<tr class="odd">
<td>ssr</td>
<td>Surface net short-wave (solar) radiation</td>
<td>176</td>
<td>sfc</td>
</tr>
<tr class="even">
<td>ssrd</td>
<td>Surface net short-wave (solar) radiation downwards</td>
<td>169</td>
<td>sfc</td>
</tr>
<tr class="odd">
<td>strd</td>
<td>Surface net long-wave (thermal) radiation downwards</td>
<td>175</td>
<td>sfc</td>
</tr>
<tr class="even">
<td>nsss</td>
<td>Time-integrated northward turbulent surface stress</td>
<td>181</td>
<td>sfc</td>
</tr>
<tr class="odd">
<td>ewss</td>
<td>Time-integrated eastward turbulent surface stress</td>
<td>180</td>
<td>sfc</td>
</tr>
<tr class="even">
<td>t20d</td>
<td>Depth of 20C isotherm - currently unavailable (11/03/2024)</td>
<td></td>
<td>sfc</td>
</tr>
<tr class="odd">
<td>sav300</td>
<td>Average salinity in the upper 300m - currently unavailable (11/03/2024)</td>
<td></td>
<td>sfc</td>
</tr>
<tr class="even">
<td>ocu</td>
<td>Eastward sea water velocity - currently unavailable (11/03/2024)</td>
<td></td>
<td>sfc</td>
</tr>
<tr class="odd">
<td>ocv</td>
<td>Northward sea water velocity - currently unavailable (11/03/2024)</td>
<td></td>
<td>sfc</td>
</tr>
<tr class="even">
<td>sithick</td>
<td>Sea ice thickness</td>
<td>262000</td>
<td>sfc</td>
</tr>
<tr class="odd">
<td>zos</td>
<td>Sea surface height</td>
<td>262124</td>
<td>sfc</td>
</tr>
<tr class="even">
<td>d</td>
<td>Divergence</td>
<td>155</td>
<td>pl</td>
</tr>
<tr class="odd">
<td>gh</td>
<td>Geopotential height</td>
<td>156</td>
<td>pl</td>
</tr>
<tr class="even">
<td>q</td>
<td>Specific humidity</td>
<td>133</td>
<td>pl</td>
</tr>
<tr class="odd">
<td>r</td>
<td>Relative humidity</td>
<td>157</td>
<td>pl</td>
</tr>
<tr class="even">
<td>t</td>
<td>Temperature</td>
<td>130</td>
<td>pl</td>
</tr>
<tr class="odd">
<td>u</td>
<td>U component of wind</td>
<td>131</td>
<td>pl</td>
</tr>
<tr class="even">
<td>v</td>
<td>V component of wind</td>
<td>132</td>
<td>pl</td>
</tr>
<tr class="odd">
<td>w</td>
<td>Vertical velocity</td>
<td>135</td>
<td>pl</td>
</tr>
<tr class="even">
<td>vo</td>
<td>Vorticity (relative)</td>
<td>138</td>
<td>pl</td>
</tr>
</tbody>
</table>
<h1 id="rda.ucar-ecmwf-ifs-high-resolution-operational-forecasts">rda.ucar: ECMWF IFS High-Resolution Operational Forecasts</h1>
<h2 id="from-rda.ucar-not-use">From rda.ucar (Not use)</h2>
<ul>
<li><a target="_blank" rel="noopener" href="https://rda.ucar.edu/datasets/d113001/#" class="uri">https://rda.ucar.edu/datasets/d113001/#</a>
<ul>
<li>ECMWF has implemented a significant resolution upgrade and methodology for high-resolution forecasts (HRES) and ensemble forecasts (ENS) beginning January of 2016. HRES is now performed via a transform grid with a nominal grid point spacing of 9 kilometers (0.08 degrees), and is carried out with IFS (Integrated Forecast System).</li>
<li><strong>ECMWF Operational 6-hourly atmospheric surface forecast</strong></li>
<li><strong>ECMWF Operational 6-hourly atmospheric isobaric analysis</strong></li>
</ul></li>
</ul>
<p><img src="https://i.imgur.com/GvUcfD5.png" srcset="/img/loading.gif" lazyload width="400" /></p>
<h1 id="herbie">Herbie</h1>
<p><a href="https://waipangsze.github.io/2025/04/10/NWP-Herbie-Download-NWP-model-output-MPAS-WRF/"><strong>NWP | Herbie | Download NWP model output (grib2) | MPAS | WRF</strong></a></p>
<h1 id="download-script">Download script</h1>
<ul>
<li><code>wget [ROOT]/20240301/00z/ifs/0p25/oper/20240301060000-24h-oper-fc.grib2</code></li>
<li><code>wget [ROOT]/20240301/06z/ifs/0p25/scda/20240301060000-24h-scda-fc.grib2</code></li>
<li><code>wget [ROOT]/20240301/12z/ifs/0p25/wave/20240301060000-12h-wave-fc.grib2</code></li>
<li><code>wget [ROOT]/20240301/06z/ifs/0p25/scwv/20240301060000-18h-scwv-fc.grib2</code></li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/sh</span><br><span class="hljs-comment">#################################################################</span><br><span class="hljs-comment"># https://data.ecmwf.int/forecasts/20241117/00z/ifs/0p25/oper/</span><br><span class="hljs-comment"># https://data.ecmwf.int/forecasts/20241117/00z/ifs/0p25/oper/20241117000000-114h-oper-fc.grib2</span><br><span class="hljs-comment">#################################################################</span><br><br>yyyy=<span class="hljs-string">&#x27;2024&#x27;</span><br>mm=<span class="hljs-string">&#x27;11&#x27;</span><br><span class="hljs-built_in">dd</span>=<span class="hljs-string">&#x27;17&#x27;</span><br>hh=<span class="hljs-string">&#x27;00&#x27;</span><br>yyyymm=<span class="hljs-variable">$&#123;yyyy&#125;</span><span class="hljs-variable">$&#123;mm&#125;</span><br>yyyymmddhh=<span class="hljs-variable">$&#123;yyyy&#125;</span><span class="hljs-variable">$&#123;mm&#125;</span><span class="hljs-variable">$&#123;dd&#125;</span><span class="hljs-variable">$&#123;hh&#125;</span><br><br>tmp_dir=<span class="hljs-string">&quot;<span class="hljs-variable">$&#123;yyyy&#125;</span><span class="hljs-variable">$&#123;mm&#125;</span>/<span class="hljs-variable">$&#123;yyyy&#125;</span><span class="hljs-variable">$&#123;mm&#125;</span><span class="hljs-variable">$&#123;dd&#125;</span>&quot;</span><br><span class="hljs-built_in">mkdir</span> -p <span class="hljs-variable">$&#123;tmp_dir&#125;</span><br><span class="hljs-built_in">cd</span> <span class="hljs-variable">$&#123;tmp_dir&#125;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Current <span class="hljs-variable">$&#123;tmp_dir&#125;</span>&quot;</span><br><br>limit_cpu_core=15<br>count_cpu_core=1<br><br><span class="hljs-keyword">for</span> ifsfile <span class="hljs-keyword">in</span> $(<span class="hljs-built_in">seq</span> 0 3 6); <span class="hljs-keyword">do</span> <span class="hljs-comment"># Forecast time = 12, 24, 36, 48, 60, 72, 84, 96, 108, 130, 142, 154</span><br><br>    tmp_ifs_fname=<span class="hljs-string">&quot;<span class="hljs-variable">$&#123;yyyymmddhh&#125;</span>0000-<span class="hljs-variable">$&#123;ifsfile&#125;</span>h-oper-fc.grib2&quot;</span><br>	<span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Now, <span class="hljs-variable">$&#123;tmp_ifs_fname&#125;</span> ... &quot;</span><br>    <br>		<span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Downloading ... <span class="hljs-variable">$&#123;tmp_ifs_fname&#125;</span>&quot;</span><br>		wget -c --no-check-certificate https://data.ecmwf.int/forecasts/<span class="hljs-variable">$&#123;yyyy&#125;</span><span class="hljs-variable">$&#123;mm&#125;</span><span class="hljs-variable">$&#123;dd&#125;</span>/<span class="hljs-variable">$&#123;hh&#125;</span>z/ifs/0p25/oper/<span class="hljs-variable">$&#123;tmp_ifs_fname&#125;</span><br>    <br>	res=$(( <span class="hljs-variable">$&#123;count_cpu_core&#125;</span> % <span class="hljs-variable">$&#123;limit_cpu_core&#125;</span> ))<br>	<span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$&#123;res&#125;</span> == 0 ]]; <span class="hljs-keyword">then</span><br>		<span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;please wait <span class="hljs-variable">$&#123;tmp_ifs_fname&#125;</span>, <span class="hljs-variable">$&#123;count_cpu_core&#125;</span>, <span class="hljs-variable">$&#123;res&#125;</span>.&quot;</span><br>		<span class="hljs-built_in">wait</span><br>	<span class="hljs-keyword">fi</span><br>    <br><span class="hljs-keyword">done</span><br></code></pre></td></tr></table></figure>
<p>read_grib2.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/bin/python</span><br><span class="hljs-keyword">import</span> pygrib<br><br>grib_file = <span class="hljs-string">&quot;/home/wpsze/IFS/202411/20241117/20241117000000-0h-oper-fc.grib2&quot;</span><br>grbs = pygrib.<span class="hljs-built_in">open</span>(grib_file)<br><span class="hljs-keyword">for</span> grb <span class="hljs-keyword">in</span> grbs:<br>    <span class="hljs-built_in">print</span>(grb) <span class="hljs-comment"># long list</span><br></code></pre></td></tr></table></figure>
<h1 id="run-as-icbc">Run as ICBC</h1>
<p>I recognised that the Vtable.ECMWF you have mentioned was not suitable for the IFS forecast data, due to the data form of the IFS was grib2. But the Vtable.ECMWF was for grib.</p>
<p><a target="_blank" rel="noopener" href="https://github.com/wrf-model/WPS/blob/master/ungrib/Variable_Tables/Vtable.ECMWF" class="uri">https://github.com/wrf-model/WPS/blob/master/ungrib/Variable_Tables/Vtable.ECMWF</a></p>
<ul>
<li><a target="_blank" rel="noopener" href="https://forum.mmm.ucar.edu/threads/ecmwf-open-data-0p25-grib2-vtable.16523/">ECMWF open data 0p25 grib2 Vtable?</a>
<ul>
<li>Do we have Vtable suitable for ungribbing this new dataset? <strong>https://data.ecmwf.int/forecasts/YYYYMMDD/00z/ifs/0p25/oper/</strong></li>
<li>I'm not sure if the existing Vtables (perhaps Vtable.ECMWF?) are suitable. If you'd like to test them out and let us know, that would be great! If they don't work, you can try contacting the input data support group to see if they are able to help. You can also use the utilities, such as g2print.exe and g1print.exe to look at the codes given in the new data type, which can help you to modify an existing Vtable. If you are able to find one that works, feel free to share it so that it may help other users who are trying to use these data.</li>
<li>Provided Vtable.ECMWF unfortunatelly doesn't work as it expects grib1 format. I tried to convert grib2 to grib1 with cnvgrib but it fails too. I hoped that someone already has new Vtable, but ok, it looks I will need to create new one using tools you mentioned. Thank you anyway. If I succeed I will post here working solution later.</li>
<li>if g2print cannot process this dataset, it implies that the ECPDS data cannot be recognized by WPS. You will have to explore this data, create Vtable for it, and I guess it may be necessary to modify codes like ungrib.F and rd_grib2.F, etc.</li>
</ul></li>
<li><a target="_blank" rel="noopener" href="https://forum.mmm.ucar.edu/threads/error-while-running-ungrib-exe-with-ifs-global-data.14439/">Error while running ungrib.exe with IFS global data (not solved)</a>
<ul>
<li>I've downloaded the IFS analysis files from RDA ds113.1 dataset.</li>
<li><a target="_blank" rel="noopener" href="https://rda.ucar.edu/datasets/d113001/dataaccess/#" class="uri">https://rda.ucar.edu/datasets/d113001/dataaccess/#</a></li>
</ul></li>
<li><a target="_blank" rel="noopener" href="https://forum.mmm.ucar.edu/threads/initializing-wrf-with-global-ecmwf.11131/">Initializing WRF with Global ECMWF (not solved)</a>
<ul>
<li>It is not possible to initialize the WRF with only these data available from the ECMWF because some important variables are missing, such as more levels of temperature and soil moisture;</li>
</ul></li>
<li><a target="_blank" rel="noopener" href="https://forum.ecmwf.int/t/wrf-vtable-for-ecmwf-10-days-open-data/1167/1">WRF Vtable for ECMWF 10-days open data (not solved)</a></li>
<li><a target="_blank" rel="noopener" href="https://forum.ecmwf.int/t/vtable-required-for-ecmwf-10-days-open-data/4438/1">Vtable required for ECMWF 10-days open data (not solved)</a></li>
<li><a target="_blank" rel="noopener" href="https://forum.mmm.ucar.edu/threads/ecmwf-open-data-0p25-enfo-grib2-vtable.19236/">ECMWF open data 0p25 enfo grib2 Vtable?</a></li>
<li><a target="_blank" rel="noopener" href="https://forum.mmm.ucar.edu/threads/help-with-ungrib-exe-when-applied-to-ecmwf-data-at-t1279-resolution.14475/#post-37949">help with ungrib.exe when applied to ecmwf data at T1279 resolution</a></li>
<li><a target="_blank" rel="noopener" href="https://forum.mmm.ucar.edu/threads/error-when-ungrib-exe-the-ecmwf-ifs-0p25-dataset-257.18725/">Error when ungrib.exe the ECMWF IFS 0p25 dataset #257</a>
<ul>
<li>I agree that the ECPDS data may have unique GRIB structure that WPS/ungrib cannot recognize.</li>
</ul></li>
</ul>
<h2 id="mpaswrf">MPAS/WRF</h2>
<h3 id="ungrib">ungrib</h3>
<p><strong>Solution</strong>:</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://forum.mmm.ucar.edu/threads/using-newer-ecmwf-data.19307/">Using Newer ECMWF Data | kwerner | Sep 28, 2024</a>
<ul>
<li>The <strong>new EC grib2 data requires an additional step to convert from EC grib2 data to grib2 data WPS supports</strong>. The conversion can be done by using the convert command in the ecCodes library which is available from ECMWF. The conversion step follows the following format: <figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs console"><span class="hljs-meta prompt_">$ </span><span class="language-bash">grib_set -r -w packingType=grid_ccsds -s packingType=grid_simple input.grib2 output.grib2</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">grib_set -r -w packingType=grid_ccsds -s packingType=grid_simple 20250326000000-0h-oper-fc.grib2 ifs_20250326000000-0h-oper-fc.grib2</span><br></code></pre></td></tr></table></figure></li>
<li>The <a target="_blank" rel="noopener" href="https://github.com/wrf-model/WPS/blob/v4.6.0/ungrib/Variable_Tables/Vtable.ECMWF"><strong>updated Vtable.ECMWF in WPS v4.6</strong></a> should work with the converted grib2 data.</li>
<li>I think this could be related to CCSDS compression. You can change the packing type by using eccodes for instance.</li>
<li>Hi Everyone, <strong>One of the problems with the EC data is that it's not all standardized like GFS data</strong>. Depending on where/how the data are obtained, they can be different. We've found that, for e.g., for one user, ungrib is unable to recognize the soil fields. A possible solution for this is to use GFS soil data, in addition to the EC data. We expect the output to still be reasonable, especially because the WRF LSMs are more like that used by GFS. We hope to have a better solution for this issue in the future. For additional information, see this thread in our GitHub code repository (I believe one of you is the one who was having the discussion with my colleague).</li>
</ul></li>
</ul>

    <div class="fold">
      <div class="fold-title fold-info collapsed" data-toggle="collapse" href="#collapse-90469042" role="button" aria-expanded="false" aria-controls="collapse-90469042">
        <div class="fold-arrow">▶</div>Vtable.ECMWF
      </div>
      <div class="fold-collapse collapse" id="collapse-90469042">
        <div class="fold-content">
          <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs Vtable.ECMWF">GRIB1| Level| From |  To  | metgrid  | metgrid  | metgrid                                  |GRIB2|GRIB2|GRIB2|GRIB2|<br>Param| Type |Level1|Level2| Name     | Units    | Description                              |Discp|Catgy|Param|Level|<br>-----+------+------+------+----------+----------+------------------------------------------+-----------------------+<br> 129 | 100  |   *  |      | GEOPT    | m2 s-2   |                                          |  0  |  0  |     | 100 |<br> 156 | 100  |   *  |      | HGT      | m        | Height                                   |  0  |  3  |  5  | 100 |  <br> 130 | 100  |   *  |      | TT       | K        | Temperature                              |  0  |  0  |  0  | 100 |<br> 131 | 100  |   *  |      | UU       | m s-1    | U                                        |  0  |  2  |  2  | 100 |<br> 132 | 100  |   *  |      | VV       | m s-1    | V                                        |  0  |  2  |  3  | 100 |<br> 157 | 100  |   *  |      | RH       | %        | Relative Humidity                        |  0  |  1  |  1  | 100 |<br> 165 |  1   |   0  |      | UU       | m s-1    | U                    At 10 m             |  0  |  2  |  2  | 103 | <br> 166 |  1   |   0  |      | VV       | m s-1    | V                    At 10 m             |  0  |  2  |  3  | 103 | <br> 167 |  1   |   0  |      | TT       | K        | Temperature          At  2 m             |  0  |  0  |  0  | 103 |<br> 168 |  1   |   0  |      | DEWPT    | K        |                                          |  0  |  0  |  6  | 103 |<br>     |  1   |   0  |      | RH       | %        | Relative Humidity    At  2 m             |  0  |  0  |     | 103 | <br> 172 |  1   |   0  |      | LANDSEA  | 0/1 Flag | Land/Sea flag                            |  2  |  0  |  0  |  1  | <br> 129 |  1   |   0  |      | SOILGEO  | m2 s-2   |                                          |  0  |  0  |     | 103 | <br> 156 |  1   |   0  |      | SOILHGT  | m        | Terrain field of source analysis         |  0  |  0  |     | 106 | <br> 134 |  1   |   0  |      | PSFC     | Pa       | Surface Pressure                         |  0  |  3  |  0  |  1  |<br> 151 |  1   |   0  |      | PMSL     | Pa       | Sea-level Pressure                       |  0  |  3  |  0  | 101 |<br> 235 |  1   |   0  |      | SKINTEMP | K        | Sea-Surface Temperature                  |  0  |  3  |     | 101 |<br>  31 |  1   |   0  |      | SEAICE   | 0/1 Flag | Sea-Ice-Flag                             |  0  |  3  |     | 101 |<br>  34 |  1   |   0  |      | SST      | K        | Sea-Surface Temperature                  |  0  |  3  |     | 101 |<br> 141 |  1   |   0  |      | SNOW_EC  | m        |                                          |  0  |  3  |     | 101 |<br>     |  1   |   0  |      | SNOW     | kg m-2   |Water Equivalent of Accumulated Snow Depth|  0  |  3  |     | 101 |<br> 139 | 112  |   0  |   7  | ST000007 | K        | T of 0-7 cm ground layer                 |  2  |  0  |  2  | 106 | <br> 170 | 112  |   7  |  28  | ST007028 | K        | T of 7-28 cm ground layer                | 192 | 128 | 170 | 106 | <br> 183 | 112  |  28  | 100  | ST028100 | K        | T of 28-100 cm ground layer              | 192 | 128 | 183 | 106 | <br> 236 | 112  | 100  | 255  | ST100289 | K        | T of 100-289 cm ground layer             | 192 | 128 | 236 | 106 | <br>  39 | 112  |   0  |   7  | SM000007 | fraction | Soil moisture of 0-7 cm ground layer     | 192 | 128 | 39  | 106 | <br>  40 | 112  |   7  |  28  | SM007028 | fraction | Soil moisture of 7-28 cm ground layer    | 192 | 128 | 40  | 106 | <br>  41 | 112  |  28  | 100  | SM028100 | fraction | Soil moisture of 28-100 cm ground layer  | 192 | 128 | 41  | 106 | <br>  42 | 112  | 100  | 255  | SM100289 | fraction | Soil moisture of 100-289 cm ground layer | 192 | 128 | 42  | 106 | <br>-----+------+------+------+----------+----------+------------------------------------------+-----+-----+-----+-----+<br>#<br>#  Grib codes are from Table 128 <br>#  http://old.ecmwf.int/publications/manuals/d/gribapi/param/filter=grib1/order=paramId/order_type=asc/p=1/table=128/<br>#  <br>#  snow depth is converted to the proper units in rrpr.F<br>#<br>#  Tested on NCAR/RDA ds113.0 dataset. http://rda.ucar.edu/datasets/ds113.0/<br>#  Note that for ds113.0 there is one surface data file per day and 4 pressure-level files per day.<br></code></pre></td></tr></table></figure>
        </div>
      </div>
    </div>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/wrf-model/WPS/issues/263">Vtable error of ECMWF,pls update it | Oct 13, 2024</a>
<ul>
<li>Surface data including soil data may come from grib 1 data. You may need to use eccodes to separate out grib 2 and grib 1 data first before running ungrib. We are not supporting the new enfo data yet. Please post further issue on the Forum.</li>
<li>they are <strong>loss soil data</strong>.</li>
<li><strong>It looks like the grib code for soil data has been messed up somehow</strong>. For the time being, <strong>you can try to use GFS soil data together with the EC atmospheric data. If you need help doing so, try reading the WPS section of the User's Guide</strong>.</li>
<li>Please read carefully this section of the <a target="_blank" rel="noopener" href="https://www2.mmm.ucar.edu/wrf/users/wrf_users_guide/build/html/wps.html#using-multiple-meteorological-data-sources">User's Guide for using combined datasets</a>.</li>
</ul></li>
<li><a target="_blank" rel="noopener" href="https://forum.mmm.ucar.edu/threads/change-in-soil-variables-from-ecmwf-cycle-49r1.19864/#post-48546">Change in soil variables from ECMWF Cycle 49r1 | Nov 14, 2024</a>
<ul>
<li>On <strong>Tuesday (November 12), ECMWF released the 49r1 version of the operational IFS</strong>. Despite all the improvements, they modified the soil variables (temperature and humidity) which stopped the ECMWF Vtable that had been released in the 4.6.0 version of the WPS.</li>
<li><strong>WPS still can't find the soil temperature and moisture variables</strong>.</li>
<li>I contacted the ECMWF team and they gave me this feedback. <strong>It is necessary to make a change within Ungrib</strong>, more specifically in the rd_grib2.F code so that it works with the <strong>new IFS soil variables</strong>.</li>
<li><em>[Jan 3, 2025]</em> Please take a look at <a target="_blank" rel="noopener" href="https://github.com/wrf-model/WPS/pull/266">this document-Change in soil variables from ECMWF Cycle 49r1</a> , which fixes the issues related to the ECMWF 49r1 version of the operational IFS. ECMWF 49r1 is newly released and we haven't done sufficient tests to make sure it works fine for WRF. Please post any issues you may have, which will be helpful for us to implement this data for WRF modeling study. Thanks in advance.</li>
<li><em>[Jan 4, 2025]</em> Please <strong>download</strong> the <strong>modified code "rd_grib2.F"</strong> from the website update <a target="_blank" rel="noopener" href="https://github.com/wrf-model/WPS/pull/266">era5/ifs soil field processing by jimbresch · Pull Request #266 · wrf-model/WPS</a>, <strong>recompile WPS, then rerun ungrib.exe</strong>.</li>
<li>IFS operational model data in the ECMWF open data repository are <strong>only available for the last 4 days.</strong></li>
<li><em>[Jan 15, 2025]</em> As requested, I am providing the corrected rd_grib2F file for WPS 4.5 and my Vtable.ECMWF_GRIB2 file. For the new WPS 4.6 version, I have not yet prepared a correction for the IFS model.</li>
<li><em>[Jan 16, 2025]</em> <strong>I run WPS using your rd_grib2.F and Vtable. All work fine</strong>. Thank you! The met-em file I generated only has 14 pressure levels in the vertical, --- is this what you got?</li>
<li><em>[Jan 16, 2025]</em> Yes, <strong>the IFS model provided by ECMWF has only 14 pressure levels</strong>. I made a simulation with the operational IFS model at 137 hybrid levels, which we have access to at the Institute of Meteorology and Water Management. The results are similar to the results from the IFS model, which is provided as open data. This is good news.</li>
<li><em>[14 Jan, 2025]</em> I have <strong>already tested this Vtable.ECMWF with the new operational IFS data and it doesn't work either</strong>. I reported this here.</li>
</ul></li>
</ul>
<div class="note note-primary">
            <p><strong>recompile WPS, then rerun ungrib.exe</strong></p>
          </div>
<ul>
<li>under <code>WPS-4.6.0/ungrib/src</code>,</li>
</ul>

    <div class="fold">
      <div class="fold-title fold-info collapsed" data-toggle="collapse" href="#collapse-738764b7" role="button" aria-expanded="false" aria-controls="collapse-738764b7">
        <div class="fold-arrow">▶</div>rd_grib2.F
      </div>
      <div class="fold-collapse collapse" id="collapse-738764b7">
        <div class="fold-content">
          <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br><span class="line">819</span><br><span class="line">820</span><br><span class="line">821</span><br><span class="line">822</span><br><span class="line">823</span><br><span class="line">824</span><br><span class="line">825</span><br><span class="line">826</span><br><span class="line">827</span><br><span class="line">828</span><br><span class="line">829</span><br><span class="line">830</span><br><span class="line">831</span><br><span class="line">832</span><br><span class="line">833</span><br><span class="line">834</span><br><span class="line">835</span><br><span class="line">836</span><br><span class="line">837</span><br><span class="line">838</span><br><span class="line">839</span><br><span class="line">840</span><br><span class="line">841</span><br><span class="line">842</span><br><span class="line">843</span><br><span class="line">844</span><br><span class="line">845</span><br><span class="line">846</span><br><span class="line">847</span><br><span class="line">848</span><br><span class="line">849</span><br><span class="line">850</span><br><span class="line">851</span><br><span class="line">852</span><br><span class="line">853</span><br><span class="line">854</span><br><span class="line">855</span><br><span class="line">856</span><br><span class="line">857</span><br><span class="line">858</span><br><span class="line">859</span><br><span class="line">860</span><br><span class="line">861</span><br><span class="line">862</span><br><span class="line">863</span><br><span class="line">864</span><br><span class="line">865</span><br><span class="line">866</span><br><span class="line">867</span><br><span class="line">868</span><br><span class="line">869</span><br><span class="line">870</span><br><span class="line">871</span><br><span class="line">872</span><br><span class="line">873</span><br><span class="line">874</span><br><span class="line">875</span><br><span class="line">876</span><br><span class="line">877</span><br><span class="line">878</span><br><span class="line">879</span><br><span class="line">880</span><br><span class="line">881</span><br><span class="line">882</span><br><span class="line">883</span><br><span class="line">884</span><br><span class="line">885</span><br><span class="line">886</span><br><span class="line">887</span><br><span class="line">888</span><br><span class="line">889</span><br><span class="line">890</span><br><span class="line">891</span><br><span class="line">892</span><br><span class="line">893</span><br><span class="line">894</span><br><span class="line">895</span><br><span class="line">896</span><br><span class="line">897</span><br><span class="line">898</span><br><span class="line">899</span><br><span class="line">900</span><br><span class="line">901</span><br><span class="line">902</span><br><span class="line">903</span><br><span class="line">904</span><br><span class="line">905</span><br><span class="line">906</span><br><span class="line">907</span><br><span class="line">908</span><br><span class="line">909</span><br><span class="line">910</span><br><span class="line">911</span><br><span class="line">912</span><br><span class="line">913</span><br><span class="line">914</span><br><span class="line">915</span><br><span class="line">916</span><br><span class="line">917</span><br><span class="line">918</span><br><span class="line">919</span><br><span class="line">920</span><br><span class="line">921</span><br><span class="line">922</span><br><span class="line">923</span><br><span class="line">924</span><br><span class="line">925</span><br><span class="line">926</span><br><span class="line">927</span><br><span class="line">928</span><br><span class="line">929</span><br><span class="line">930</span><br><span class="line">931</span><br><span class="line">932</span><br><span class="line">933</span><br><span class="line">934</span><br><span class="line">935</span><br><span class="line">936</span><br><span class="line">937</span><br><span class="line">938</span><br><span class="line">939</span><br><span class="line">940</span><br><span class="line">941</span><br><span class="line">942</span><br><span class="line">943</span><br><span class="line">944</span><br><span class="line">945</span><br><span class="line">946</span><br><span class="line">947</span><br><span class="line">948</span><br><span class="line">949</span><br><span class="line">950</span><br><span class="line">951</span><br><span class="line">952</span><br><span class="line">953</span><br><span class="line">954</span><br><span class="line">955</span><br><span class="line">956</span><br><span class="line">957</span><br><span class="line">958</span><br><span class="line">959</span><br><span class="line">960</span><br><span class="line">961</span><br><span class="line">962</span><br><span class="line">963</span><br><span class="line">964</span><br><span class="line">965</span><br><span class="line">966</span><br><span class="line">967</span><br><span class="line">968</span><br><span class="line">969</span><br><span class="line">970</span><br><span class="line">971</span><br><span class="line">972</span><br><span class="line">973</span><br><span class="line">974</span><br><span class="line">975</span><br><span class="line">976</span><br><span class="line">977</span><br><span class="line">978</span><br><span class="line">979</span><br><span class="line">980</span><br><span class="line">981</span><br><span class="line">982</span><br><span class="line">983</span><br><span class="line">984</span><br><span class="line">985</span><br><span class="line">986</span><br><span class="line">987</span><br><span class="line">988</span><br><span class="line">989</span><br><span class="line">990</span><br><span class="line">991</span><br><span class="line">992</span><br><span class="line">993</span><br><span class="line">994</span><br><span class="line">995</span><br><span class="line">996</span><br><span class="line">997</span><br><span class="line">998</span><br><span class="line">999</span><br><span class="line">1000</span><br><span class="line">1001</span><br><span class="line">1002</span><br><span class="line">1003</span><br><span class="line">1004</span><br><span class="line">1005</span><br><span class="line">1006</span><br><span class="line">1007</span><br><span class="line">1008</span><br><span class="line">1009</span><br><span class="line">1010</span><br><span class="line">1011</span><br><span class="line">1012</span><br><span class="line">1013</span><br><span class="line">1014</span><br><span class="line">1015</span><br><span class="line">1016</span><br><span class="line">1017</span><br><span class="line">1018</span><br><span class="line">1019</span><br><span class="line">1020</span><br><span class="line">1021</span><br><span class="line">1022</span><br><span class="line">1023</span><br><span class="line">1024</span><br><span class="line">1025</span><br><span class="line">1026</span><br><span class="line">1027</span><br><span class="line">1028</span><br><span class="line">1029</span><br><span class="line">1030</span><br><span class="line">1031</span><br><span class="line">1032</span><br><span class="line">1033</span><br><span class="line">1034</span><br><span class="line">1035</span><br><span class="line">1036</span><br><span class="line">1037</span><br><span class="line">1038</span><br><span class="line">1039</span><br><span class="line">1040</span><br><span class="line">1041</span><br><span class="line">1042</span><br><span class="line">1043</span><br><span class="line">1044</span><br><span class="line">1045</span><br><span class="line">1046</span><br><span class="line">1047</span><br><span class="line">1048</span><br><span class="line">1049</span><br><span class="line">1050</span><br><span class="line">1051</span><br><span class="line">1052</span><br><span class="line">1053</span><br><span class="line">1054</span><br><span class="line">1055</span><br><span class="line">1056</span><br><span class="line">1057</span><br><span class="line">1058</span><br><span class="line">1059</span><br><span class="line">1060</span><br><span class="line">1061</span><br><span class="line">1062</span><br><span class="line">1063</span><br><span class="line">1064</span><br><span class="line">1065</span><br><span class="line">1066</span><br><span class="line">1067</span><br><span class="line">1068</span><br><span class="line">1069</span><br><span class="line">1070</span><br><span class="line">1071</span><br><span class="line">1072</span><br><span class="line">1073</span><br><span class="line">1074</span><br><span class="line">1075</span><br><span class="line">1076</span><br><span class="line">1077</span><br><span class="line">1078</span><br><span class="line">1079</span><br><span class="line">1080</span><br><span class="line">1081</span><br><span class="line">1082</span><br><span class="line">1083</span><br><span class="line">1084</span><br><span class="line">1085</span><br><span class="line">1086</span><br><span class="line">1087</span><br><span class="line">1088</span><br><span class="line">1089</span><br><span class="line">1090</span><br><span class="line">1091</span><br><span class="line">1092</span><br><span class="line">1093</span><br><span class="line">1094</span><br><span class="line">1095</span><br><span class="line">1096</span><br><span class="line">1097</span><br><span class="line">1098</span><br><span class="line">1099</span><br><span class="line">1100</span><br><span class="line">1101</span><br><span class="line">1102</span><br><span class="line">1103</span><br><span class="line">1104</span><br><span class="line">1105</span><br><span class="line">1106</span><br><span class="line">1107</span><br><span class="line">1108</span><br><span class="line">1109</span><br><span class="line">1110</span><br><span class="line">1111</span><br><span class="line">1112</span><br><span class="line">1113</span><br><span class="line">1114</span><br><span class="line">1115</span><br><span class="line">1116</span><br><span class="line">1117</span><br><span class="line">1118</span><br><span class="line">1119</span><br><span class="line">1120</span><br><span class="line">1121</span><br><span class="line">1122</span><br><span class="line">1123</span><br><span class="line">1124</span><br><span class="line">1125</span><br><span class="line">1126</span><br><span class="line">1127</span><br><span class="line">1128</span><br><span class="line">1129</span><br><span class="line">1130</span><br><span class="line">1131</span><br><span class="line">1132</span><br><span class="line">1133</span><br><span class="line">1134</span><br><span class="line">1135</span><br><span class="line">1136</span><br><span class="line">1137</span><br><span class="line">1138</span><br><span class="line">1139</span><br><span class="line">1140</span><br><span class="line">1141</span><br><span class="line">1142</span><br><span class="line">1143</span><br><span class="line">1144</span><br><span class="line">1145</span><br><span class="line">1146</span><br><span class="line">1147</span><br><span class="line">1148</span><br><span class="line">1149</span><br><span class="line">1150</span><br><span class="line">1151</span><br><span class="line">1152</span><br><span class="line">1153</span><br><span class="line">1154</span><br><span class="line">1155</span><br><span class="line">1156</span><br><span class="line">1157</span><br><span class="line">1158</span><br><span class="line">1159</span><br><span class="line">1160</span><br><span class="line">1161</span><br><span class="line">1162</span><br><span class="line">1163</span><br><span class="line">1164</span><br><span class="line">1165</span><br><span class="line">1166</span><br><span class="line">1167</span><br><span class="line">1168</span><br><span class="line">1169</span><br><span class="line">1170</span><br><span class="line">1171</span><br><span class="line">1172</span><br><span class="line">1173</span><br><span class="line">1174</span><br><span class="line">1175</span><br><span class="line">1176</span><br><span class="line">1177</span><br><span class="line">1178</span><br><span class="line">1179</span><br><span class="line">1180</span><br><span class="line">1181</span><br><span class="line">1182</span><br><span class="line">1183</span><br><span class="line">1184</span><br><span class="line">1185</span><br><span class="line">1186</span><br><span class="line">1187</span><br><span class="line">1188</span><br><span class="line">1189</span><br><span class="line">1190</span><br><span class="line">1191</span><br><span class="line">1192</span><br><span class="line">1193</span><br><span class="line">1194</span><br><span class="line">1195</span><br><span class="line">1196</span><br><span class="line">1197</span><br><span class="line">1198</span><br><span class="line">1199</span><br><span class="line">1200</span><br><span class="line">1201</span><br><span class="line">1202</span><br><span class="line">1203</span><br><span class="line">1204</span><br><span class="line">1205</span><br><span class="line">1206</span><br><span class="line">1207</span><br><span class="line">1208</span><br><span class="line">1209</span><br><span class="line">1210</span><br><span class="line">1211</span><br><span class="line">1212</span><br><span class="line">1213</span><br><span class="line">1214</span><br><span class="line">1215</span><br><span class="line">1216</span><br><span class="line">1217</span><br><span class="line">1218</span><br><span class="line">1219</span><br><span class="line">1220</span><br><span class="line">1221</span><br><span class="line">1222</span><br><span class="line">1223</span><br><span class="line">1224</span><br><span class="line">1225</span><br><span class="line">1226</span><br><span class="line">1227</span><br><span class="line">1228</span><br><span class="line">1229</span><br><span class="line">1230</span><br><span class="line">1231</span><br><span class="line">1232</span><br><span class="line">1233</span><br><span class="line">1234</span><br><span class="line">1235</span><br><span class="line">1236</span><br><span class="line">1237</span><br><span class="line">1238</span><br><span class="line">1239</span><br><span class="line">1240</span><br><span class="line">1241</span><br><span class="line">1242</span><br><span class="line">1243</span><br><span class="line">1244</span><br><span class="line">1245</span><br></pre></td><td class="code"><pre><code class="hljs rd_grib2.F">*****************************************************************************!<br>! Subroutine RD_GRIB2                                                         !<br>!                                                                             !<br>! Purpose:                                                                    !<br>!    Read one record from the input GRIB2 file.  Based on the information in  !<br>!    the GRIB2 header and the user-defined Vtable, decide whether the field in!<br>!    the GRIB2 record is one to process or to skip.  If the field is one we   !<br>!    want to keep, extract the data from the GRIB2 record, and store the data !<br>!    in the ungrib memory structure.                                          !<br>!                                                                             !<br>! Argument list:                                                              !<br>!    Input:                                                                   !<br>!       junit   : &quot;Unit Number&quot; to open and read from.  Not really a Fortran  !<br>!                 unit number, since we do not do Fortran I/O for the GRIB2   !<br>!                 files.  Nor is it a UNIX File Descriptor returned from a C  !<br>!                 OPEN statement.  It is really just an array index to the    !<br>!                 array (IUARR) where the UNIX File Descriptor values are     !<br>!                 stored.                                                     !<br>!       gribflnm     : File name to open, if it is not already open.          !<br>!       debug_level  : Integer for various amounts of printout.               !<br>!       pmin         : Minimum pressure level (Pa) to process.                !<br>!                                                                             !<br>!    Output:                                                                  !<br>!                                                                             !<br>!       hdate        : The (up to)19-character date of the field to process.  !<br>!       grib_edition : Version of the gribfile (1 or 2)                       !<br>!       ireaderr     : Error flag: 0 - no error on read from GRIB2 file.      !<br>!                              1 - Hit the end of the GRIB2 file.             !<br>!                              2 - The file GRIBFLNM we tried to open does    !<br>!                                  not exist.                                 !<br>!                                                                             !<br>!                                                                             !<br>! Author: Paula McCaslin, NOAA/FSL,   Sept 2004                               !<br>! Code is based on code developed by Steve Gilbert NCEP &amp; Kevin Manning NCAR  !<br>! Adapted for WPS: Jim Bresch, NCAR/MMM. Sept 2006                            !<br>!*****************************************************************************!<br>      <br>      SUBROUTINE rd_grib2(junit, gribflnm, hdate, <br>     &amp;  grib_edition, ireaderr, debug_level, pmin)<br><br>      use grib_mod<br>      use params<br>      use table          ! Included to define g2code<br>      use gridinfo       ! Included to define map%<br>      use storage_module ! Included sub put_storage<br>      use module_debug<br><br>      real, allocatable, dimension(:) :: hold_array<br>      parameter(msk1=32000,msk2=4000)<br>      character(len=1),allocatable,dimension(:) :: cgrib<br>      integer :: listsec0(3)<br>      integer :: listsec1(13)<br>      integer year, month, day, hour, minute, second, fcst<br>      character(len=*)  :: gribflnm<br>      character(len=*)  :: hdate<br>      character(len=8)  :: pabbrev<br>      character(len=20) :: labbrev<br>      character(len=80) :: tabbrev<br>      integer :: lskip, lgrib<br>      integer :: junit, itot, icount, iseek<br>      integer :: grib_edition<br>      integer :: i, j, ireaderr, ith , debug_level<br>      integer :: currlen<br>      logical :: unpack, expand<br>      type(gribfield) :: gfld<br>      ! For subroutine put_storage<br>      real :: level<br>      real :: scale_factor<br>      integer :: iplvl<br>      character (len=9) :: my_field<br>      character (len=8) :: tmp8<br>      ! For subroutine output<br>      integer , parameter :: maxlvl = 150<br>      real , dimension(maxlvl) :: plvl<br>      integer :: nlvl<br>      integer , dimension(maxlvl) :: level_array<br>      real :: glevel1, glevel2<br>      logical :: first = .true.<br>      real :: pmin<br><br>C - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -<br>C  SET ARGUMENTS<br><br>      unpack=.true.<br>      expand=.true.<br>      hdate = &#x27;0000-00-00_00:00:00&#x27;<br>      ierr=0<br>      itot=0<br>      icount=0<br>      iseek=0<br>      lskip=0<br>      lgrib=0<br>      currlen=0<br>      ith=1<br>      scale_factor = 1e6<br>      call mprintf(.true.,DEBUG,&quot;Begin rd_grib2&quot;, newline=.true.)<br><br>!/* IOS Return Codes from BACIO:  */<br>!/*  0    All was well                                   */<br>!/* -1    Tried to open read only _and_ write only       */<br>!/* -2    Tried to read and write in the same call       */<br>!/* -3    Internal failure in name processing            */<br>!/* -4    Failure in opening file                        */<br>!/* -5    Tried to read on a write-only file             */<br>!/* -6    Failed in read to find the &#x27;start&#x27; location    */<br>!/* -7    Tried to write to a read only file             */<br>!/* -8    Failed in write to find the &#x27;start&#x27; location   */<br>!/* -9    Error in close                                 */<br>!/* -10   Read or wrote fewer data than requested        */<br><br>!if ireaderr =1 we have hit the end of a file. <br>!if ireaderr =2 we have hit the end of all the files. <br> <br><br>      ! Open a byte-addressable file.<br>      CALL BAOPENR(junit,gribflnm,IOS)<br>      first = .true.<br>      if (ios.eq.0) then <br>      VERSION: do<br><br>         ! Search opend file for the next GRIB2 messege (record).<br>         call skgb(junit,iseek,msk1,lskip,lgrib)<br><br>         ! Check for EOF, or problem<br>         if (lgrib.eq.0) then<br>            exit <br>         endif<br><br>         ! Check size, if needed allocate more memory.<br>         if (lgrib.gt.currlen) then<br>            if (allocated(cgrib)) deallocate(cgrib)<br>            allocate(cgrib(lgrib),stat=is)<br>            !print *,&#x27;G2 allocate(cgrib(lgrib)) status: &#x27;,IS<br>            currlen=lgrib<br>         endif<br><br>         ! Read a given number of bytes from unblocked file.<br>         call baread(junit,lskip,lgrib,lengrib,cgrib)<br><br>         call mprintf ((lgrib.ne.lengrib),ERROR,<br>     &amp;    &quot;rd_grib2: IO Error. %i .ne. %i &quot;, newline=.true.,<br>     &amp;    i1=lgrib,i2=lengrib)<br><br>         iseek=lskip+lgrib<br>         icount=icount+1<br><br>         call mprintf (.true.,DEBUG,<br>     &amp;     &quot;G2 GRIB MESSAGE  %i starts at %i &quot;, newline=.true.,<br>     &amp;      i1=icount,i2=lskip+1)<br><br>         ! Unpack GRIB2 field<br>         call gb_info(cgrib,lengrib,listsec0,listsec1,<br>     &amp;                numfields,numlocal,maxlocal,ierr)<br>         call mprintf((ierr.ne.0),ERROR,<br>     &amp;     &quot; ERROR querying GRIB2 message = %i&quot;,newline=.true.,i1=ierr)<br>         itot=itot+numfields<br><br>         grib_edition=listsec0(2)<br>         if (grib_edition.ne.2) then<br>              exit VERSION<br>         endif<br>         <br>         ! Additional print statments for developer.<br>!MGD         if ( debug_level .GT. 100 ) then<br>!MGD     print *,&#x27;G2 SECTION 0: &#x27;,(listsec0(j),j=1,3)<br>!MGD         print *,&#x27;G2 SECTION 1: &#x27;,(listsec1(j),j=1,13)<br>!MGD         print *,&#x27;G2 Contains &#x27;,numlocal,&#x27; Local Sections &#x27;,<br>!MGD     &amp;           &#x27; and &#x27;,numfields,&#x27; data fields.&#x27;<br>!MGD         endif<br><br><br>         ! ----<br>         ! Once per file fill in date, model and projection values.<br><br>         if (first) then <br>           first = .false.<br><br>           ! Build the 19-character date string, based on GRIB2 header date<br>           ! and time information, including forecast time information:<br><br>           n=1<br>           call gf_getfld(cgrib,lengrib,n,.FALSE.,expand,gfld,ierr)<br><br><br>           year  =gfld%idsect(6)     !(FOUR-DIGIT) YEAR OF THE DATA<br>           month =gfld%idsect(7)     ! MONTH OF THE DATA<br>           day   =gfld%idsect(8)     ! DAY OF THE DATA<br>           hour  =gfld%idsect(9)     ! HOUR OF THE DATA<br>           minute=gfld%idsect(10)    ! MINUTE OF THE DATA<br>           second=gfld%idsect(11)    ! SECOND OF THE DATA<br><br>           fcst = 0<br><br>! Extract forecast time. Assume the first field&#x27;s valid time is true for all fields.<br>! This doesn&#x27;t have to be true, but ungrib is designed to decode one time-level at<br>! a time.<br><br>           if ( gfld%ipdtnum .ne. 8 ) then<br>	     if ( gfld%ipdtmpl(8) .eq. 1 ) then       ! time units are hours<br>	       fcst = gfld%ipdtmpl(9)<br>	     else if ( gfld%ipdtmpl(8) .eq. 0 ) then  ! minutes<br>	       fcst = gfld%ipdtmpl(9) / 60.<br>	     else if ( gfld%ipdtmpl(8) .eq. 2 ) then  ! days<br>	       fcst = gfld%ipdtmpl(9) * 24.<br>	     else<br>               call mprintf(.true.,ERROR,<br>     &amp;           &quot;Time unit in ipdtmpl(8), %i is not suported&quot;,<br>     &amp;            newline=.true.,i1=gfld%ipdtmpl(8))<br>	     endif<br>	   else<br>!  pdt 4.8 data are time-averaged, accumulated, or min/max fields with the <br>!  ending (valid) time provided. <br>	     year  =gfld%ipdtmpl(16) <br>	     month =gfld%ipdtmpl(17)<br>	     day   =gfld%ipdtmpl(18)<br>	     hour  =gfld%ipdtmpl(19)<br>	     minute=gfld%ipdtmpl(20) <br>	     second=gfld%ipdtmpl(21) <br>	     fcst = 0.<br>	   endif<br><br>           if ( gfld%idsect(5) .eq. 2 ) fcst = 0.<br>           ! Compute valid time.<br><br>           !print *, &#x27;ymd&#x27;,gfld%idsect(6),gfld%idsect(7),gfld%idsect(8)<br>           !print *, &#x27;hhmm  &#x27;,gfld%idsect(9),gfld%idsect(10)<br>   <br>           call build_hdate(hdate,year,month,day,hour,minute,second)<br>           call mprintf(.true.,DEBUG,&quot;G2 hdate = %s &quot;, newline=.true.,<br>     &amp;                  s1=hdate)<br>           call geth_newdate(hdate,hdate,3600*fcst)<br>           call mprintf(.true.,DEBUG,&quot;G2 hdate (fcst?) = %s &quot;,<br>     &amp;                  newline=.true., s1=hdate)<br><br>           !--<br><br>           ! Indicator of the source (center) of the data.<br>           icenter = gfld%idsect(1)<br><br>           ! Indicator of model (or whatever) which generated the data.<br>           iprocess = gfld%ipdtmpl(5)<br><br><br>           if (icenter.eq.7) then<br>             if (iprocess.eq.81) then<br>               map%source = &#x27;NCEP GFS Analysis&#x27;<br>             elseif (iprocess.eq.82) then<br>               map%source = &#x27;NCEP GFS GDAS/FNL&#x27;<br>             elseif (iprocess.eq.83) then<br>               map%source = &#x27;NCEP HRRR Model&#x27;<br>             elseif (iprocess.eq.84) then<br>               map%source = &#x27;NCEP MESO NAM Model&#x27;<br>             elseif (iprocess.eq.89) then<br>               map%source = &#x27;NCEP NMM &#x27;<br>             elseif (iprocess.eq.96) then<br>               map%source = &#x27;NCEP GFS Model&#x27;<br>             elseif (iprocess.eq.86 .or. iprocess.eq.100) then<br>               map%source = &#x27;NCEP RUC Model&#x27;    ! 60 km<br>             elseif (iprocess.eq.101) then<br>               map%source = &#x27;NCEP RUC Model&#x27;    ! 40 km<br>             elseif (iprocess.eq.105) then<br>               if (year .gt. 2011) then<br>                 map%source = &#x27;NCEP RAP Model&#x27;<br>               else<br>                 map%source = &#x27;NCEP RUC Model&#x27;  ! 20 km<br>               endif<br>             elseif (iprocess.eq.107) then<br>               map%source = &#x27;NCEP GEFS&#x27;<br>             elseif (iprocess.eq.109) then<br>               map%source = &#x27;NCEP RTMA&#x27;<br>             elseif (iprocess.eq.140) then<br>               map%source = &#x27;NCEP NARR&#x27;<br>             elseif (iprocess.eq.44) then<br>               map%source = &#x27;NCEP SST Analysis&#x27;<br>             elseif (iprocess.eq.70) then<br>               map%source = &#x27;GFDL Hurricane Model&#x27;<br>             elseif (iprocess.eq.80) then<br>               map%source = &#x27;NCEP GFS Ensemble&#x27;<br>             elseif (iprocess.eq.107) then             ! renumbered as of 23 Feb 2010<br>               map%source = &#x27;NCEP GFS Ensemble&#x27;<br>             elseif (iprocess.eq.111) then<br>               map%source = &#x27;NCEP NMMB Model&#x27;<br>             elseif (iprocess.eq.112) then<br>               map%source = &#x27;NCEP WRF-NMM Model&#x27;<br>             elseif (iprocess.eq.116) then<br>               map%source = &#x27;NCEP WRF-ARW Model&#x27;<br>             elseif (iprocess.eq.129) then<br>               map%source = &#x27;NCEP GODAS&#x27;<br>             elseif (iprocess.eq.197) then<br>               map%source = &#x27;NCEP CDAS CFSV2&#x27;<br>             elseif (iprocess.eq.25) then<br>               map%source = &#x27;NCEP SNOW COVER ANALYSIS&#x27;<br>             else<br>               map%source = &#x27;unknown model from NCEP&#x27;<br>               call mprintf(.true.,STDOUT,<br>     &amp;            &quot;unknown model from NCEP %i &quot;,newline=.true.,<br>     &amp;            i1=iprocess)<br>               call mprintf(.true.,LOGFILE,<br>     &amp;            &quot;unknown model from NCEP %i &quot;,newline=.true.,<br>     &amp;            i1=iprocess)<br>             end if<br>           else if (icenter .eq. 57) then<br>             if (iprocess .eq. 87) then<br>               map%source = &#x27;AFWA AGRMET&#x27;<br>             else<br>               map%source = &#x27;AFWA&#x27;<br>             endif<br>           else if ( icenter .eq. 58 ) then<br>             map%source = &#x27;US Navy FNOC&#x27;<br>           else if (icenter .eq. 59) then<br>             if (iprocess .eq. 125) then<br>               map%source = &#x27;NOAA GSD Rapid Refresh Model&#x27;<br>             else if (iprocess .eq. 83) then<br>               map%source = &#x27;NOAA GSD HRRR Model&#x27;<br>             else if (iprocess .eq. 105) then<br>               map%source = &#x27;NOAA GSD&#x27;<br>             else <br>               print *,&#x27;Unknown GSD source&#x27;<br>               stop<br>             endif<br>           else if (icenter .eq. 60) then<br>             map%source = &#x27;NCAR&#x27;<br>           else if (icenter .eq. 98) then<br>             map%source = &#x27;ECMWF&#x27;<br>           else if (icenter .eq. 34) then<br>             map%source = &#x27;JMA&#x27;<br>           else if (icenter .eq. 74 .or. icenter .eq. 75 ) then<br>             map%source = &#x27;UKMO&#x27;<br>           else if (icenter .eq. 78 .or. icenter .eq. 79 ) then<br>             map%source = &#x27;DWD&#x27;<br>           else<br>             map%source = &#x27;unknown model and orig center&#x27;<br>           end if<br>           if (icenter.eq.7) then<br>             if (iprocess.eq.81 .or. iprocess.eq.82 .or.<br>     &amp;           iprocess.eq.96) then<br>!  pmin should not be 15 or 40 hPa for gfs files. Use the next highest level.<br>               if (pmin .eq. 1500.) then<br>                 pmin = 1000.<br>               else if (pmin .eq. 4000.) then<br>                 pmin = 3000.<br>               endif<br>             endif<br>           endif<br><br>           call mprintf(.true.,DEBUG,&quot;G2 source is = %s &quot;,<br>     &amp;                  newline=.true., s1=map%source)<br><br>           !--<br><br>           ! Store information about the grid containing the data.<br>           ! This stuff gets stored in the MAP variable, as defined in <br>           ! module GRIDINFO.<br><br>           map%startloc = &#x27;SWCORNER&#x27;<br>           map%grid_wind = .true.<br><br>           if (gfld%igdtnum.eq.0) then ! Lat/Lon grid aka Cylindrical Equidistant<br>              map%igrid = 0<br>              map%nx = gfld%igdtmpl(8)<br>              map%ny = gfld%igdtmpl(9)<br>              map%dx = gfld%igdtmpl(17)<br>              map%dy = gfld%igdtmpl(18)<br>              map%lat1 = gfld%igdtmpl(12)<br>              map%lon1 = gfld%igdtmpl(13)<br>              write(tmp8,&#x27;(b8.8)&#x27;) gfld%igdtmpl(14)<br>              if (tmp8(5:5) .eq. &#x27;0&#x27;) map%grid_wind = .false.<br>              map%r_earth = earth_radius (gfld%igdtmpl(1),<br>     &amp;                         gfld%igdtmpl(2),gfld%igdtmpl(3))<br><br>! Fix for NCEP 1/12 degree grids (e.g. rtgsst)<br>              if (icenter .eq. 7 .and. map%dx .eq. 83000. .and. map%nx <br>     &amp;              .eq. 4320) then<br>                map%lat1 = 89958333.<br>                map%lon1 = 41667.<br>                map%dx = 83333.333 * sign(1.0,map%dx)<br>                map%dy = 83333.333 * sign(1.0,map%dy)<br>              endif<br><br>              if ((gfld%igdtmpl(10) .eq. 0).OR.<br>     &amp;            (gfld%igdtmpl(10) .eq. 255)) THEN<br>          ! Scale lat/lon values to 0-180, default range is 1e6.<br>                map%lat1 = map%lat1/scale_factor<br>                map%lon1 = map%lon1/scale_factor<br>          ! Scale dx/dy values to degrees, default range is 1e6.<br>                map%dx = map%dx/scale_factor<br>                map%dy = map%dy/scale_factor<br>              else<br>          ! Basic angle and subdivisions are non-zero (not tested)<br>                map%lat1 = map%lat1 *<br>     &amp;                     (gfld%igdtmpl(11)/gfld%igdtmpl(10))<br>                map%lon1 = map%lon1 *<br>     &amp;                     (gfld%igdtmpl(11)/gfld%igdtmpl(10))<br>                map%dx = map%dx * <br>     &amp;                     (gfld%igdtmpl(11)/gfld%igdtmpl(10))<br>                map%dy = map%dy * <br>     &amp;                     (gfld%igdtmpl(11)/gfld%igdtmpl(10))<br>               call mprintf(.true.,STDOUT,&quot;WARNING - Basic angle option <br>     &amp;has not been tested, continuing anyway&quot;)<br>               call mprintf(.true.,LOGFILE,&quot;WARNING - Basic angle option <br>     &amp; has not been tested, continuing anyway&quot;)<br>              endif<br><br><br>! The following is needed for NCEP GFS, 0.5 degree output. The j-scan is in the -y direction.<br>! In WPS, the sign of dy indicates the direction of the scan.<br>              write(tmp8,&#x27;(b8.8)&#x27;) gfld%igdtmpl(19)<br>              read(tmp8,&#x27;(1x,i1)&#x27;) jscan<br>              if ( jscan .eq. 0 .and. map%dy .gt. 0. ) then<br>                map%dy = -1. * map%dy<br>              endif<br>!             if ( map%lat1 .gt. gfld%igdtmpl(15) .and. <br>!    &amp;               map%dy .gt. 0. ) then<br>!               map%dy = -1. * map%dy<br>!               write(6,*) &#x27;Resetting map%dy for iprocess = &#x27;,iprocess<br>!             endif<br><br>           elseif (gfld%igdtnum.eq.10) then ! Mercator Grid.<br>              map%igrid = 1<br>              map%nx = gfld%igdtmpl(8)<br>              map%ny = gfld%igdtmpl(9)<br>              map%lov = 0.<br>              map%truelat1 = gfld%igdtmpl(13) / scale_factor<br>              map%truelat2 = 0.<br>              map%dx = gfld%igdtmpl(18) / scale_factor<br>              map%dy = gfld%igdtmpl(19) / scale_factor<br>              map%lat1 = gfld%igdtmpl(10) / scale_factor<br>              map%lon1 = gfld%igdtmpl(11) / scale_factor<br>              write(tmp8,&#x27;(b8.8)&#x27;) gfld%igdtmpl(12)<br>              if (tmp8(5:5) .eq. &#x27;0&#x27;) map%grid_wind = .false.<br>              map%r_earth = earth_radius (gfld%igdtmpl(1),<br>     &amp;                       gfld%igdtmpl(2),gfld%igdtmpl(3))<br><br>           elseif (gfld%igdtnum.eq.20) then ! Polar-Stereographic Grid.<br>              map%igrid = 5<br>              map%nx = gfld%igdtmpl(8)<br>              map%ny = gfld%igdtmpl(9)<br>              map%lov = gfld%igdtmpl(14) / scale_factor<br>              map%truelat1 = 60.<br>              map%truelat2 = 91.<br>              map%dx = gfld%igdtmpl(15) / scale_factor<br>              map%dy = gfld%igdtmpl(16) / scale_factor<br>              map%lat1 = gfld%igdtmpl(10) / scale_factor<br>              map%lon1 = gfld%igdtmpl(11) / scale_factor<br>              write(tmp8,&#x27;(b8.8)&#x27;) gfld%igdtmpl(12)<br>              if (tmp8(5:5) .eq. &#x27;0&#x27;) map%grid_wind = .false.<br>              map%r_earth = earth_radius (gfld%igdtmpl(1),<br>     &amp;                       gfld%igdtmpl(2),gfld%igdtmpl(3))<br><br>           elseif (gfld%igdtnum.eq.30) then ! Lambert Conformal Grid<br>              map%igrid = 3<br>              map%nx = gfld%igdtmpl(8)<br>              map%ny = gfld%igdtmpl(9)<br>              map%lov = gfld%igdtmpl(14) / scale_factor<br>              map%truelat1 = gfld%igdtmpl(19) / scale_factor<br>              map%truelat2 = gfld%igdtmpl(20) / scale_factor<br>              map%dx = gfld%igdtmpl(15) / scale_factor<br>              map%dy = gfld%igdtmpl(16) / scale_factor<br>              map%lat1 = gfld%igdtmpl(10) / scale_factor<br>              map%lon1 = gfld%igdtmpl(11) / scale_factor<br>              write(tmp8,&#x27;(b8.8)&#x27;) gfld%igdtmpl(12)<br>              if (tmp8(5:5) .eq. &#x27;0&#x27;) map%grid_wind = .false.<br>              map%r_earth = earth_radius (gfld%igdtmpl(1),<br>     &amp;                       gfld%igdtmpl(2),gfld%igdtmpl(3))<br><br>           elseif(gfld%igdtnum.eq.40) then ! Gaussian Grid (we will call it lat/lon)<br>              map%igrid = 4<br>              map%nx = gfld%igdtmpl(8)     ! Ni - # of points along a parallel<br>              map%ny = gfld%igdtmpl(9)     ! Nj - # of points along meridian<br>              map%dx = gfld%igdtmpl(17)    ! Di - i direction increment<br>              map%dy = gfld%igdtmpl(18)    ! N - # of parallels between pole and equator<br>              map%lat1 = gfld%igdtmpl(12)  ! La1 - lat of 1st grid point<br>              map%lon1 = gfld%igdtmpl(13)  ! Lo1 - lon of 1st grid point<br>              write(tmp8,&#x27;(b8.8)&#x27;) gfld%igdtmpl(14)  ! resolution/component flag<br>              if (tmp8(5:5) .eq. &#x27;0&#x27;) map%grid_wind = .false.<br>              map%r_earth = earth_radius (gfld%igdtmpl(1),<br>     &amp;                       gfld%igdtmpl(2),gfld%igdtmpl(3))<br><br>              ! Scale dx/dy values to degrees, default range is 1e6.<br>              if (map%dx.gt.10000) then <br>                 map%dx = map%dx/scale_factor<br>              endif<br>              if (map%dy.gt.10000) then <br>                 map%dy = (map%dy/scale_factor)*(-1)<br>              endif<br><br>              ! Fix for zonal shift in CFSR data, following a similar fix <br>              ! for global lat-lon data in rd_grib1.F<br>              if ( ABS(map%nx * map%dx - 360.0) &lt; 1.0 ) then<br>                 if (ABS(map%dx - (360./real(map%nx))) &gt; 0.00001) then<br>                    write(0,*) &#x27;CFSR fix: recomputing delta-longitude&#x27;<br>                    map%dx = 360./real(map%nx)<br>                 endif<br>              endif<br><br>              ! Scale lat/lon values to 0-180, default range is 1e6.<br>              if (abs(map%lat1).ge.scale_factor) then<br>                 map%lat1 = map%lat1/scale_factor<br>              endif<br>              if (map%lon1.ge.scale_factor) then <br>                 map%lon1 = map%lon1/scale_factor<br>              endif<br>              if ( debug_level .gt. 2 ) then<br>              call mprintf(.true.,DEBUG,<br>     &amp;     &quot;Gaussian Grid: Dx,Dy,lat,lon,nlats %f %f %f %f %i &quot;,<br>     &amp;     newline=.true.,f1=map%dx,f2=map%dy,f3=map%lat1,f4=map%lon1,<br>     &amp;     i1=nint(map%dy))<br>              end if<br>           elseif (gfld%igdtnum.eq.32769) then ! Arakawa Non-E Staggered grid.<br>              map%igrid = 6               <br>              map%nx = gfld%igdtmpl(8)        <br>              map%ny = gfld%igdtmpl(9)        <br>              map%dx = gfld%igdtmpl(17)        <br>              map%dy = gfld%igdtmpl(18)       <br>              map%lat1 = gfld%igdtmpl(12)        <br>              map%lon1 = gfld%igdtmpl(13)        <br>              map%lat0 = gfld%igdtmpl(15)        <br>              map%lon0 = gfld%igdtmpl(16)        <br>              map%r_earth = earth_radius (gfld%igdtmpl(1),<br>     &amp;                         gfld%igdtmpl(2),gfld%igdtmpl(3))<br>              if ((gfld%igdtmpl(10) .eq. 0).OR.<br>     &amp;            (gfld%igdtmpl(10) .eq. 255)) THEN<br>                map%lat1 = map%lat1/scale_factor<br>                map%lon1 = map%lon1/scale_factor<br>                map%lat0 = map%lat0/scale_factor<br>                map%lon0 = map%lon0/scale_factor<br>                map%dx = map%dx/scale_factor/1.e3<br>                map%dy = map%dy/scale_factor/1.e3<br>              else<br>          ! Basic angle and subdivisions are non-zero (not tested)<br>                map%lat1 = map%lat1 *<br>     &amp;                     (gfld%igdtmpl(11)/gfld%igdtmpl(10))<br>                map%lon1 = map%lon1 *<br>     &amp;                     (gfld%igdtmpl(11)/gfld%igdtmpl(10))<br>                map%dx = map%dx * <br>     &amp;                     (gfld%igdtmpl(11)/gfld%igdtmpl(10))<br>                map%dy = map%dy * <br>     &amp;                     (gfld%igdtmpl(11)/gfld%igdtmpl(10))<br>               call mprintf(.true.,STDOUT,&quot;WARNING - Basic angle option <br>     &amp;has not been tested, continuing anyway&quot;)<br>               call mprintf(.true.,LOGFILE,&quot;WARNING - Basic angle option <br>     &amp; has not been tested, continuing anyway&quot;)<br>              endif<br><br>           else<br>              call mprintf(.true.,STDOUT,&quot;GRIB2 Unknown Projection: %i&quot;,<br>     &amp;          newline=.true.,i1=gfld%igdtnum)<br>              call mprintf(.true.,STDOUT,<br>     &amp;          &quot;ungrib understands projections 0, 20, 30, and 40&quot;, <br>     &amp;          newline=.true.)<br>              call mprintf(.true.,LOGFILE,<br>     &amp;          &quot;GRIB2 Unknown Projection: %i&quot;,<br>     &amp;          newline=.true.,i1=gfld%igdtnum)<br>              call mprintf(.true.,LOGFILE,<br>     &amp;          &quot;ungrib understands projections 0, 10, 20, 30, and 40&quot;, <br>     &amp;          newline=.true.)<br>       ! If the projection is not known, then it can&#x27;t be processed by metgrid/plotfmt<br>                stop &#x27;Stop in rd_grib2&#x27;<br>           endif<br><br>           call mprintf(.true.,DEBUG,&quot;G2 igrid = %i ,  dx = %f ,  dy = %<br>     &amp;f &quot;, newline=.true., i1 = map%igrid, f1=map%dx, f2=map%dy)<br>         <br>           if (icenter.eq.7) then<br>             call ncep_grid_num (gfld%igdtnum)<br>           endif<br><br>           ! Deallocate arrays decoding GRIB2 record.<br>           call gf_free(gfld)<br><br>         endif   ! &quot;first&quot; if-block<br><br>         ! ----<br><br>         ! Continue to unpack GRIB2 field.<br>         NUM_FIELDS: do n = 1, numfields <br>	   ! e.g. U and V would =2, otherwise its usually =1<br>           call gf_getfld(cgrib,lengrib,n,.FALSE.,expand,gfld,ierr)<br>           if (ierr.ne.0) then<br>             write(*,*) &#x27; ERROR extracting field gf_getfld = &#x27;,ierr<br>             cycle<br>           endif<br><br>! The JMA GSM has two different grids in the same GRIB file, so we need<br>! to process the map info for each field separately. If any other centers do<br>! this, then processing will need to be added here, too.<br><br>            if (icenter .eq. 34 .and. gfld%igdtnum.eq.0) then<br>              map%nx = gfld%igdtmpl(8)<br>              map%ny = gfld%igdtmpl(9)<br>              map%dx = gfld%igdtmpl(17)<br>              map%dy = gfld%igdtmpl(18)<br>              ! Scale dx/dy values to degrees, default range is 1e6.<br>              if (map%dx.gt.10000) then<br>                 map%dx = map%dx/scale_factor<br>              endif<br>              if (map%dy.gt.10000) then<br>                 map%dy = map%dy/scale_factor<br>              endif<br>              write(tmp8,&#x27;(b8.8)&#x27;) gfld%igdtmpl(19)<br>              read(tmp8,&#x27;(1x,i1)&#x27;) jscan<br>              write(0,*) &#x27;gfld%igdtmpl(19) = &#x27;,gfld%igdtmpl(19),<br>     &amp;   &#x27; jscan = &#x27;,jscan<br>              if ( jscan .eq. 0 .and. map%dy .gt. 0. ) then<br>                map%dy = -1. * map%dy<br>              endif<br>            endif             ! JMA spectral<br><br>! ------------------------------------<br>         ! Additional print information for developer.<br>         if ( debug_level .GT. 1000 ) then<br>!MGD           print *<br>!MGD           print *,&#x27;G2 FIELD &#x27;,n<br>!MGD           if (n==1) then<br>!MGD            print *,&#x27;G2 SECTION 0: &#x27;,gfld%discipline,gfld%version<br>!MGD            print *,&#x27;G2 SECTION 1: &#x27;,(gfld%idsect(j),j=1,gfld%idsectlen)<br>!MGD           endif<br>!MGD           if ( associated(gfld%local).AND.gfld%locallen.gt.0 ) then<br>!MGD              print *,&#x27;G2 SECTION 2: &#x27;,(gfld%local(j),j=1,gfld%locallen)<br>!MGD           endif<br>!MGD           print *,&#x27;G2 SECTION 3: &#x27;,gfld%griddef,gfld%ngrdpts,<br>!MGD     &amp;                            gfld%numoct_opt,gfld%interp_opt,<br>!MGD     &amp;                            gfld%igdtnum<br>!MGD           print *,&#x27;G2 GRID TEMPLATE 3.&#x27;,gfld%igdtnum,&#x27;: &#x27;,<br>!MGD     &amp;            (gfld%igdtmpl(j),j=1,gfld%igdtlen)<br>!MGD           if ( gfld%num_opt .eq. 0 ) then<br>!MGD             print *,&#x27;G2 NO Section 3 List Defining No. of Data Points.&#x27;<br>!MGD           else<br>!MGD             print *,&#x27;G2 Section 3 Optional List: &#x27;,<br>!MGD     &amp;                (gfld%list_opt(j),j=1,gfld%num_opt)<br>!MGD           endif<br>!MGD           print *,&#x27;G2 PRODUCT TEMPLATE 4.&#x27;,gfld%ipdtnum,&#x27;: &#x27;,<br>!MGD     &amp;          (gfld%ipdtmpl(j),j=1,gfld%ipdtlen)<br><br>           pabbrev=param_get_abbrev(gfld%discipline,gfld%ipdtmpl(1),<br>     &amp;                              gfld%ipdtmpl(2))<br>           !call prlevel(gfld%ipdtnum,gfld%ipdtmpl,labbrev)<br>           !call prvtime(gfld%ipdtnum,gfld%ipdtmpl,listsec1,tabbrev)<br>!MGD            print *,&#x27;G2 TEXT: &#x27;,pabbrev,trim(labbrev),&quot; &quot;,trim(tabbrev)<br><br>!MGD           if ( gfld%num_coord .eq. 0 ) then<br>!MGD             print *,&#x27;G2 NO Optional Vertical Coordinate List.&#x27;<br>!MGD           else<br>!MGD             print *,&#x27;G2 Section 4 Optional Coordinates: &#x27;,<br>!MGD     &amp;             (gfld%coord_list(j),j=1,gfld%num_coord)<br>!MGD           endif<br>           if ( gfld%ibmap .ne. 255 ) then<br>              call mprintf(.true.,DEBUG, <br>     &amp;             &#x27;G2 Num. of Data Points = %i with BIT-MAP %i&#x27;, <br>     &amp;             newline=.true., i1=gfld%ndpts, i2=gfld%ibmap)<br>           else<br>              call mprintf(.true.,DEBUG, <br>     &amp;             &#x27;G2 Num. of Data Points = %i NO BIT-MAP&#x27;, <br>     &amp;             newline=.true., i1=gfld%ndpts)<br>           endif<br>!MGD           print *,&#x27;G2 DRS TEMPLATE 5.&#x27;,gfld%idrtnum,&#x27;: &#x27;,<br>!MGD     &amp;          (gfld%idrtmpl(j),j=1,gfld%idrtlen)<br>         endif ! Additional Print information <br>! ------------------------------------<br><br>!         do i = 1, maxvar<br>!           write(6,&#x27;(a10,4i8)&#x27;) namvar(i),(g2code(j,i),j=1,4)<br>!         enddo<br>!MGD      if (debug_level .gt. 50) then<br>!MGD          write(6,*) &#x27;looking for &#x27;,gfld%discipline,gfld%ipdtmpl(1),<br>!MGD     &amp;       gfld%ipdtmpl(2),gfld%ipdtmpl(10)<br>!MGD          endif<br>           call mprintf(.true.,DEBUG,&quot;G2 Searching the g2code array (Vta<br>     &amp;ble) for this grib field %i %i %i %i %i %i &quot;, newline=.true.,<br>     &amp; i1 = gfld%discipline, i2 = gfld%ipdtmpl(1),<br>     &amp; i3 = gfld%ipdtmpl(2), i4 = gfld%ipdtmpl(10),<br>     &amp; i5 = gfld%ipdtmpl(12), i6 = gfld%ipdtnum )<br><br><br>         ! Test this data record against list of desired variables <br>         ! found in Vtable.<br>         ! ----<br>         MATCH_LOOP: do i=1,maxvar ! Max variables found in Vtable,<br>                                   ! maxvar is defined in table.mod<br><br>           if ( gfld%discipline .eq. g2code(1,i) .and.   !Discipline <br>     &amp;          gfld%ipdtmpl(1) .eq. g2code(2,i) .and.   !Category<br>     &amp;          gfld%ipdtmpl(2) .eq. g2code(3,i) .and.   !Parameter<br>     &amp;          gfld%ipdtmpl(10) .eq. g2code(4,i) .and.  !Elevation<br>     &amp;          gfld%ipdtnum    .eq. g2code(5,i)) then   !Template<br><br>            call gf_free(gfld)<br>            call gf_getfld(cgrib,lengrib,n,.TRUE.,expand,gfld,ierr)<br>            pabbrev=param_get_abbrev(gfld%discipline,gfld%ipdtmpl(1),<br>     &amp;                               gfld%ipdtmpl(2))<br><br>              !my_field (e.g. RH, TMP, similar to, but not the same as pabbrev)<br>              my_field=namvar(i) <br><br>!MGD    if (debug_level .gt. 50) then<br>!MGD     write(6,*) &#x27;namvar(i) = &#x27;,namvar(i),&#x27; pabbrev = &#x27;,pabbrev<br>!MGD     write(6,*) &#x27;Parameter = &#x27;,gfld%ipdtmpl(2)<br>!MGD    endif<br>!  The following if-block is commented out since equivalent info can be obtained from g2print<br>!       if (debug_level .gt. 1000) then<br>!          fldmax=gfld%fld(1)<br>!          fldmin=gfld%fld(1)<br>!          sum=gfld%fld(1)<br>!          do j=2,gfld%ndpts<br>!            if (gfld%fld(j).gt.fldmax) fldmax=gfld%fld(j)<br>!            if (gfld%fld(j).lt.fldmin) fldmin=gfld%fld(j)<br>!            sum=sum+gfld%fld(j)<br>!          enddo ! gfld%ndpts<br>!          call mprintf(.true.,DEBUG,&#x27;G2 FIELD=%s MIN=%f AVG=%f MAX=%f&#x27;,<br>!    &amp;         newline=.true., s1=pabbrev, f1=fldmin, f2=sum/gfld%ndpts,<br>!    &amp;         f3=fldmax)<br>!       endif<br><br>! need to match up soil levels with those requested.<br>! For the Vtable levels, -88 = all levels, -99 = missing. The units<br>! vary depending on the level code (e.g. 106 = cm, 103 = m).<br>! The grib2 standard allows scaling of the units, so make sure the soil level<br>! units are in cm (as used in the Vtable).<br>!<br>!              if ( gfld%ipdtmpl(10) .eq. 106 ) then<br>              if (( gfld%ipdtmpl(10) .eq. 106 ) .or. <br>     &amp;           ( gfld%ipdtmpl(10) .eq. 151 )) then              !! Added by Prof. Mariusz Figurski, 20250110<br>                if ( ( gfld%ipdtmpl(14) .EQ. -1*(2**07-1) ) .AND.<br>!    &amp;               ( gfld%ipdtmpl(15) .EQ. -1*(2**31-1) ) ) THEN ! Some compilers cannot<br>                                                                   ! handle the initial 2**31<br>                                                                   ! part of the computation, <br>                                                                   ! which is an arithmetic <br>                                                                   ! overflow on 32 bit signed ints<br>     &amp;               ( gfld%ipdtmpl(15) .EQ. -2147483647  ) ) THEN<br>! special UM grib2<br>                   glevel1 = gfld%ipdtmpl(12)<br>                   glevel2 = gfld%ipdtmpl(11)<br>                else<br>                   glevel1 = 100. * gfld%ipdtmpl(12)*<br>     &amp;                         (10.**(-1.*gfld%ipdtmpl(11)))<br>                   glevel2 = 100. * gfld%ipdtmpl(15)*<br>     &amp;                         (10.**(-1.*gfld%ipdtmpl(14)))<br>!The following if-block accounts for the 2024 changes to IFS soil fields. They use a local table. 10.01.2024 <br>!! Added by Prof. Mariusz Figurski, 20250110<br>                  if (icenter .eq. 98 .and.<br>     &amp;                gfld%discipline .eq. 2 .and.     !! Added by Prof. Mariusz Figurski, 20250110<br>     &amp;                (gfld%ipdtmpl(1) .eq. 3 .or.      !! Added by Prof. Mariusz Figurski, 20250110<br>     &amp;                gfld%ipdtmpl(1) .eq. 0) .and.      !! Added by Prof. Mariusz Figurski, 20250110<br>     &amp;                gfld%ipdtmpl(10).eq. 151) then    !! Added by Prof. Mariusz Figurski, 20250110<br>!     &amp;                gfld%discipline .eq. 192 .and.<br>!     &amp;                gfld%ipdtmpl(1) .eq. 128 .and.<br>!     &amp;                gfld%ipdtmpl(10).eq. 106) then<br>                      glevel1 = gfld%ipdtmpl(12)<br>                      glevel2 = gfld%ipdtmpl(15)                      <br>!!    Added by Prof. Mariusz Figurski, 20250110  start special for IFS grib2<br>                      if ( gfld%ipdtmpl(12) .eq. 0) then<br>                          glevel1 = 0<br>                      elseif ( gfld%ipdtmpl(12) .eq. 1) then<br>                          glevel1 = 7<br>                      elseif ( gfld%ipdtmpl(12) .eq. 2) then<br>                          glevel1 = 28<br>                      elseif ( gfld%ipdtmpl(12) .eq. 3) then<br>                          glevel1 = 100<br>                      elseif ( gfld%ipdtmpl(12) .eq. 4) then<br>                          glevel1 = 289<br>                      endif<br><br>                      if ( gfld%ipdtmpl(15) .eq. 0) then<br>                          glevel2 = 0<br>                      elseif ( gfld%ipdtmpl(15) .eq. 1) then<br>                          glevel2 = 7<br>                      elseif ( gfld%ipdtmpl(15) .eq. 2) then<br>                          glevel2 = 28<br>                      elseif ( gfld%ipdtmpl(15) .eq. 3) then<br>                          glevel2 = 100<br>                      elseif ( gfld%ipdtmpl(15) .eq. 4) then<br>                          glevel2 = 289<br>                      endif<br>!!   end special block for IFS grib2<br><br>                      if ( glevel1 .eq. 100. .and.<br>     &amp;                     glevel2 .lt. -1.e+9 ) then<br>                        glevel2 = 255.<br>                      endif<br>                  endif<br>                end if<br>                TMP8LOOP: do j = 1, maxvar<br>                  if (((g2code(4,j) .eq. 106) .or. <br>     &amp;               (g2code(4,j) .eq. 151)) .and.              !! Added by Prof. Mariusz Figurski, 20250110<br>     &amp;               (gfld%ipdtmpl(1) .eq. g2code(2,j)) .and.   !! Added by Dr. Haiqing SONG, 20181201<br>     &amp;               (gfld%ipdtmpl(2) .eq. g2code(3,j)) .and.<br>     &amp;               (glevel1 .eq. level1(j)) .and.<br>     &amp;               ((glevel2 .eq. level2(j)) .or.<br>     &amp;                                   (level2(j) .le. -88))) then<br>                    my_field = namvar(j)<br>                    exit TMP8LOOP<br>                  endif<br>                enddo TMP8LOOP<br>                if (j .gt. maxvar ) then<br>                  write(6,&#x27;(a,i6,a)&#x27;) &#x27;Subsoil level &#x27;,<br>     &amp;               gfld%ipdtmpl(12), <br>     &amp;           &#x27; in the GRIB2 file, was not found in the Vtable&#x27;<br>                  cycle MATCH_LOOP<br>                endif<br>!MGD         if (debug_level .gt. 50) write(6,*) &#x27;my_field is now &#x27;,my_field<br>              endif<br><br>              ! Level (eg. 10000 mb)<br>              if(gfld%ipdtmpl(10).eq.100) then<br>                 ! Pressure level (range from 1000mb to 0mb)<br>                 level=gfld%ipdtmpl(12) *<br>     &amp;                           (10. ** (-1. * gfld%ipdtmpl(11)))<br>		 if ( level .lt. pmin ) cycle MATCH_LOOP<br>              elseif((gfld%ipdtmpl(10).eq.105).or.<br>     &amp;               (gfld%ipdtmpl(10).eq.118).or.<br>     &amp;               (gfld%ipdtmpl(10).eq.150))then<br>                 ! Hybrid level (range from 1 to N)<br>                 level=gfld%ipdtmpl(12)<br>              elseif(gfld%ipdtmpl(10).eq.104) then<br>                 ! Sigma level (range from 10000 to 0)<br>                 level=gfld%ipdtmpl(12)<br>              elseif(gfld%ipdtmpl(10).eq.101) then<br>                 ! MSL<br>                 level=201300.<br>              elseif(gfld%ipdtmpl(10).eq.103) then<br>	         ! Height above ground (m)<br>		 if (gfld%ipdtmpl(12) .eq. 2. .or. <br>     &amp;               gfld%ipdtmpl(12) .eq. 1000. .or.     ! temp fix for hrrr maxref<br>     &amp;               gfld%ipdtmpl(12) .eq. 10. ) then<br>                   level=200100.<br>		 else<br>                   cycle MATCH_LOOP<br>		 endif<br>              elseif((gfld%ipdtmpl(10).ge.206 .and.<br>     &amp;               gfld%ipdtmpl(10).le.234) .or.<br>     &amp;              (gfld%ipdtmpl(10).ge.242 .and.     <br>     &amp;               gfld%ipdtmpl(10).le.254) .or.<br>     &amp;              (gfld%ipdtmpl(10).eq.200) .or.<br>     &amp;              (gfld%ipdtmpl(10).eq.10) ) then<br>                 ! NCEP cloud layers used for plotting<br>                   level=200100.<br>              elseif(gfld%ipdtmpl(10).eq.106 .or. <br>     &amp;               gfld%ipdtmpl(10).eq.151 .or.       !! Added by Prof. Mariusz Figurski, 20250110<br>     &amp;               gfld%ipdtmpl(10).eq.1) then<br>                 ! Misc near ground/surface levels<br>                 level=200100.<br>              elseif(gfld%ipdtmpl(10).eq.6) then<br>                 ! Level of Max wind<br>                 level=200100.  <br>              elseif(gfld%ipdtmpl(10).eq.7) then<br>                 ! Tropopause<br>                 level=200100.<br>              else<br>                 ! If we are here then the Vtable contains a level code<br>                 ! which we cannot handle. Write an info message and skip it.<br>                 call mprintf(.true.,INFORM,&quot;Rd_grib2 does not know abou<br>     &amp;t level code %i (field = %s). Skipping this field. If you want thi<br>     &amp;s level, rd_grib2.F must be modified&quot;, i1 = gfld%ipdtmpl(10),<br>     &amp; s1 =  my_field )<br>                 cycle MATCH_LOOP<br>              endif<br>              iplvl = int(level)<br><br>              ! Store the unpacked 2D slab from the GRIB2 record<br>              allocate(hold_array(gfld%ngrdpts))<br>              do j=1,gfld%ngrdpts<br>                 hold_array(j)=gfld%fld(j)<br>              enddo<br><br>!   Some grids need to be reordered. Until we get an example, this is<br>!   a placeholder<br>!             call reorder_it (hold_array, map%nx, map%ny, map%dx, <br>!    &amp;                 map%dy, iorder)<br><br>              ! When we have reached this point, we have a data array ARRAY <br>              ! which has some data we want to save, with field name FIELD <br>              ! at pressure level LEVEL (Pa).  Dimensions of this data are <br>              ! map%nx and map%ny.  Put this data into storage.<br><br>              !print *,&#x27;call put_storage&#x27;,iplvl,my_field,hold_array(55),ith<br>              !e.g. call put_storage(200100, &#x27;RH&#x27;, my_field, 1, ith)<br>!             call mprintf(.true.,DEBUG,&quot;Calling put_storage for<br>!    &amp;level = %i , field = %s , g2level = %i &quot;, newline=.true.,<br>!    &amp; i1 = iplvl, s1 = my_field, i2 = gfld%ipdtmpl(12) )<br><br>              call put_storage(iplvl,my_field,<br>     &amp;           reshape(hold_array(1:map%nx*map%ny),<br>     &amp;           (/map%nx, map%ny/)), map%nx,map%ny)<br>              deallocate(hold_array)<br><br>              ! If Specific Humidity is present on hybrid levels AND <br>              ! upper-air RH is missing, see if we can compute RH from <br>              ! Specific Humidity.<br>              if (.not. is_there(iplvl, &#x27;RH&#x27;) .and.<br>     &amp;            is_there(iplvl, &#x27;SH&#x27;) .and.<br>     &amp;            is_there(iplvl, &#x27;TT&#x27;) .and.<br>     &amp;            is_there(iplvl, &#x27;P&#x27;)) then<br>                  call g2_compute_rh_spechumd_upa(map%nx,map%ny,iplvl)<br>                 !call llstor_remove(iplvl, &#x27;SH&#x27;) !We are done with SH<br>              endif<br><br>              ! If Specific Humidity is present on hybrid levels AND <br>              ! upper-air RH is missing, see if we can compute RH from <br>              ! Specific Humidity - v2<br>              if (.not. is_there(iplvl, &#x27;RH&#x27;) .and.<br>     &amp;            is_there(iplvl, &#x27;SPECHUMD&#x27;) .and.<br>     &amp;            is_there(iplvl, &#x27;THETA&#x27;) .and.<br>     &amp;            is_there(iplvl, &#x27;TT&#x27;)) then<br>                  call g2_compute_rh_spechumd_upa2(map%nx,map%ny,iplvl)<br>              endif<br><br>              ! If Temperature and Theta are present on hybrid levels AND<br>              ! upper-air PRESSURE is missing, see if we can compute PRESSURE from<br>              ! Temperature and Theta<br>              if (.not. is_there(iplvl, &#x27;PRESSURE&#x27;) .and.<br>     &amp;            is_there(iplvl, &#x27;THETA&#x27;) .and.<br>     &amp;            is_there(iplvl, &#x27;TT&#x27;)) then<br>                  call g2_compute_pressure_tth_upa(map%nx,map%ny,iplvl)<br>              endif<br><br>              ith=ith+1<br>              exit MATCH_LOOP<br><br>           endif ! Selected param.<br><br><br>         enddo MATCH_LOOP<br><br>         ! Deallocate arrays decoding GRIB2 record.<br>         call gf_free(gfld)<br><br>         enddo NUM_FIELDS<br><br><br>      enddo VERSION ! skgb<br><br><br>       if ( debug_level .gt. 100 ) then<br>         call mprintf (.true.,DEBUG,<br>     &amp;   &quot;G2 total number of fields found = %i &quot;,newline=.true.,i1=itot)<br>       end if<br><br>       CALL BACLOSE(junit,IOS)<br><br>       nullify(gfld%local)            ! must be nullified before opening next file<br>       ireaderr=1<br>      else <br>        call mprintf (.true.,DEBUG,&quot;open status failed because %i &quot;,<br>     &amp;                newline=.true., i1=ios)<br>        hdate = &#x27;9999-99-99_99:99:99&#x27;<br>        ireaderr=2<br>      endif ! ireaderr check <br><br>      END subroutine rd_grib2<br><br>!*****************************************************************************!<br>! Subroutine edition_num                                                      !<br>!                                                                             !<br>! Purpose:                                                                    !<br>!    Read one record from the input GRIB2 file.  Based on the information in  !<br>!    the GRIB2 header and the user-defined Vtable, decide whether the field in!<br>!    the GRIB2 record is one to process or to skip.  If the field is one we   !<br>!    want to keep, extract the data from the GRIB2 record, and pass the data  !<br>!    back to the calling routine.                                             !<br>!                                                                             !<br>! Argument list:                                                              !<br>!    Input:                                                                   !<br>!       JUNIT   : &quot;Unit Number&quot; to open and read from.  Not really a Fortran  !<br>!                 unit number, since we do not do Fortran I/O for the GRIB2   !<br>!                 files.  Nor is it a UNIX File Descriptor returned from a C  !<br>!                 OPEN statement.  It is really just an array index to the    !<br>!                 array (IUARR) where the UNIX File Descriptor values are     !<br>!                 stored.                                                     !<br>!       GRIB2FILE: File name to open, if it is not already open.              !<br>!                                                                             !<br>!    Output:                                                                  !<br>!       GRIB_EDITION: Set to 1 for GRIB and set to 2 for GRIB2                ! <br>!       IERR     : Error flag: 0 - no error on read from GRIB2 file.          !<br>!                              1 - Hit the end of the GRIB2 file.             !<br>!                              2 - The file GRIBFLNM we tried to open does    !<br>!                                  not exist.                                 !<br>! Author: Paula McCaslin                                                      !<br>! NOAA/FSL                                                                    !<br>! Sept 2004                                                                   !<br>!*****************************************************************************!<br>      <br>      SUBROUTINE edition_num(junit, gribflnm, <br>     &amp;  grib_edition, ireaderr)<br><br>      use grib_mod<br>      use params<br>      use module_debug<br><br>      parameter(msk1=32000,msk2=4000)<br>      character(len=1),allocatable,dimension(:) :: cgrib<br>      integer :: listsec0(3)<br>      integer :: listsec1(13)<br>      character(len=*)  :: gribflnm<br>      integer :: lskip, lgrib<br>      integer :: junit<br>      integer :: grib_edition<br>      integer :: i, j, ireaderr<br>      integer :: currlen<br><br>      character(len=4) :: ctemp<br>      character(len=4),parameter :: grib=&#x27;GRIB&#x27;,c7777=&#x27;7777&#x27;<br><br>C - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -<br>C  SET ARGUMENTS<br><br>      itot=0<br>      icount=0<br>      iseek=0<br>      lskip=0<br>      lgrib=0<br>      currlen=0<br><br>!/* IOS Return Codes from BACIO:  */<br>!/*  0    All was well                                   */<br>!/* -1    Tried to open read only _and_ write only       */<br>!/* -2    Tried to read and write in the same call       */<br>!/* -3    Internal failure in name processing            */<br>!/* -4    Failure in opening file                        */<br>!/* -5    Tried to read on a write-only file             */<br>!/* -6    Failed in read to find the &#x27;start&#x27; location    */<br>!/* -7    Tried to write to a read only file             */<br>!/* -8    Failed in write to find the &#x27;start&#x27; location   */<br>!/* -9    Error in close                                 */<br>!/* -10   Read or wrote fewer data than requested        */<br><br>!if ireaderr =1 we have hit the end of a file. <br>!if ireaderr =2 we have hit the end of all the files. <br>!if ireaderr =3 beginning characters &#x27;GRIB&#x27; not found<br><br>      ! Open a byte-addressable file.<br>      CALL BAOPENR(junit,gribflnm,IOS)<br>      if (ios.eq.0) then <br><br>         ! Search opend file for the next GRIB2 messege (record).<br>         call skgb(junit,iseek,msk1,lskip,lgrib)<br><br>         ! Check for EOF, or problem<br>         call mprintf((lgrib.eq.0),ERROR,<br>     &amp;     &quot;Grib2 file or date problem, stopping in edition_num.&quot;,<br>     &amp;     newline=.true.)<br> <br>         ! Check size, if needed allocate more memory.<br>         if (lgrib.gt.currlen) then<br>            if (allocated(cgrib)) deallocate(cgrib)<br>            allocate(cgrib(lgrib),stat=is)<br>            currlen=lgrib<br>         endif<br><br>         ! Read a given number of bytes from unblocked file.<br>         call baread(junit,lskip,lgrib,lengrib,cgrib)<br><br>         ! Check for beginning of GRIB message in the first 100 bytes<br>         istart=0<br>         do j=1,100<br>            ctemp=cgrib(j)//cgrib(j+1)//cgrib(j+2)//cgrib(j+3)<br>            if (ctemp.eq.grib ) then<br>              istart=j<br>              exit<br>            endif<br>         enddo<br>         if (istart.eq.0) then<br>            ireaderr=3<br>            print*, &quot;The beginning 4 characters &gt;GRIB&lt; were not found.&quot;<br>         endif<br>   <br>         ! Unpack Section 0 - Indicator Section to extract GRIB edition field<br>         iofst=8*(istart+5)<br>         call gbyte(cgrib,discipline,iofst,8)     ! Discipline<br>         iofst=iofst+8<br>         call gbyte(cgrib,grib_edition,iofst,8)   ! GRIB edition number<br><br>!        print *, &#x27;ungrib - grib edition num&#x27;,  grib_edition<br>         CALL BACLOSE(junit,IOS)<br>         ireaderr=1<br>      else if (ios .eq. -4) then<br>        call mprintf(.true.,ERROR, <br>     &amp;    &quot;edition_num: unable to open %s&quot;,newline=.true.,s1=gribflnm)<br>      else <br>         print *,&#x27;edition_num: open status failed because&#x27;,ios,gribflnm<br>         ireaderr=2<br>      endif ! ireaderr check <br><br>      END subroutine edition_num<br><br>!*****************************************************************************!<br><br>      SUBROUTINE g2_compute_rh_spechumd_upa(ix, jx, iiplvl)<br>      ! Compute relative humidity from specific humidity in the upper air.<br>      use storage_module<br>      implicit none<br>      integer :: ix, jx<br>      integer :: iiplvl<br>      real :: lat1, lon1, dx, dy<br>      real, dimension(ix,jx) :: T, P, RH, Q<br>    <br>      real, parameter :: svp1=611.2<br>      real, parameter :: svp2=17.67<br>      real, parameter :: svp3=29.65<br>      real, parameter :: svpt0=273.15<br>      real, parameter :: eps = 0.622<br>    <br>      real startlat, startlon, deltalat, deltalon<br><br>      call get_storage(iiplvl, &#x27;P&#x27;, P, ix, jx)<br>      call get_storage(iiplvl, &#x27;TT&#x27;, T, ix, jx)<br>      call get_storage(iiplvl, &#x27;SH&#x27;, Q, ix, jx)<br>    <br>      rh=1.E2*(p*q/(q*(1.-eps)+eps))/(svp1*exp(svp2*(t-svpt0)/(T-svp3)))<br>     <br>      call put_storage(iiplvl, &#x27;RH&#x27;, rh, ix, jx)<br>    <br>      end subroutine g2_compute_rh_spechumd_upa<br><br>!*****************************************************************************!<br><br>      SUBROUTINE g2_compute_rh_spechumd_upa2(ix, jx, iiplvl)<br>      ! Compute relative humidity from specific humidity in the upper air.<br>      use storage_module<br>      implicit none<br>      integer :: ix, jx<br>      integer :: iiplvl<br>      real :: lat1, lon1, dx, dy<br>      real, dimension(ix,jx) :: T, TH, RH, Q, P<br>    <br>      real, parameter :: svp1=611.2<br>      real, parameter :: svp2=17.67<br>      real, parameter :: svp3=29.65<br>      real, parameter :: svpt0=273.15<br>      real, parameter :: eps = 0.622<br>    <br>      real startlat, startlon, deltalat, deltalon<br><br>      call get_storage(iiplvl, &#x27;THETA&#x27;, TH, ix, jx)<br>      call get_storage(iiplvl, &#x27;TT&#x27;, T, ix, jx)<br>      call get_storage(iiplvl, &#x27;SPECHUMD&#x27;, Q, ix, jx)<br>    <br>      p=1.e5*(t/th)**(1005/287.05)<br>     <br>      rh=1.E2*(p*q/(q*(1.-eps)+eps))/(svp1*exp(svp2*(t-svpt0)/(T-svp3)))<br>     <br>      call put_storage(iiplvl, &#x27;RH&#x27;, rh, ix, jx)<br>    <br>      end subroutine g2_compute_rh_spechumd_upa2<br><br>!*****************************************************************************!<br><br>      SUBROUTINE g2_compute_pressure_tth_upa(ix, jx, iiplvl)<br>      ! Compute relative humidity from specific humidity in the upper air.<br>      use storage_module<br>      implicit none<br>      integer :: ix, jx<br>      integer :: iiplvl<br>      real :: lat1, lon1, dx, dy<br>      real, dimension(ix,jx) :: T, TH, P<br>    <br>      real, parameter :: svp1=611.2<br>      real, parameter :: svp2=17.67<br>      real, parameter :: svp3=29.65<br>      real, parameter :: svpt0=273.15<br>      real, parameter :: eps = 0.622<br>    <br>      real startlat, startlon, deltalat, deltalon<br><br>      call get_storage(iiplvl, &#x27;THETA&#x27;, TH, ix, jx)<br>      call get_storage(iiplvl, &#x27;TT&#x27;, T, ix, jx)<br>    <br>      p=1.e5*(t/th)**(1005/287.05)<br>     <br>      call put_storage(iiplvl, &#x27;PRESSURE&#x27;, p, ix, jx)<br>    <br>      end subroutine g2_compute_pressure_tth_upa<br><br>!*****************************************************************************!<br><br>      subroutine ncep_grid_num (pnum)<br>!<br>!  Find the grib number for descriptive  labelling.<br>!  Grib2 doesn&#x27;t have a grid-number entry, so we have to figure it out<br>!  from the parameters. <br>!<br>      use gridinfo       ! Included to define map%<br>      integer :: pnum<br>      real, parameter :: eps = .01<br>      character (len=8) :: tmp8<br><br>!     write(6,*) &#x27;begin ncep_grid_num&#x27;<br>!     write(6,*) &#x27;dx = &#x27;,map%dx,&#x27; pnum = &#x27;,pnum,&#x27; nx = &#x27;,map%nx<br>      tmp8 = &#x27;        &#x27;<br>      if (pnum .eq. 30) then            ! lambert conformal<br>        if ( abs(map%dx - 12.19058) .lt. eps .and. map%nx .eq. 614) then<br>          write(tmp8,&#x27;(&quot;GRID 218&quot;)&#x27;) <br>        else if (abs(map%dx - 40.63525) .lt. eps <br>     &amp;     .and. map%nx .eq. 185) then<br>          write(tmp8,&#x27;(&quot;GRID 212&quot;)&#x27;) <br>        else if (abs(map%dx - 40.63525) .lt. eps <br>     &amp;     .and. map%nx .eq. 151) then<br>          write(tmp8,&#x27;(&quot;GRID 236&quot;)&#x27;) <br>        else if (abs(map%dx - 81.2705) .lt. eps <br>     &amp;     .and. map%nx .eq. 93) then<br>          write(tmp8,&#x27;(&quot;GRID 211&quot;)&#x27;) <br>        else if (abs (map%dx - 32.46341) .lt. eps <br>     &amp;     .and. map%nx .eq. 349) then<br>          write(tmp8,&#x27;(&quot;GRID 221&quot;)&#x27;) <br>        else if (abs(map%dx - 20.317625) .lt. eps <br>     &amp;     .and. map%nx .eq. 301) then<br>          write(tmp8,&#x27;(&quot;GRID 252&quot;)&#x27;) <br>        else if (abs(map%dx - 13.545087) .lt. eps <br>     &amp;     .and. map%nx .eq. 451) then<br>          write(tmp8,&#x27;(&quot;GRID 130&quot;)&#x27;) <br>        endif<br>      else if (pnum .eq. 20) then     ! polar stereographic<br>        if (abs(map%dx - 15.0) .lt. eps) then<br>          write(tmp8,&#x27;(&quot;GRID  88&quot;)&#x27;) <br>        endif<br>      else if (pnum .eq. 0) then      ! lat/lon<br>        if (abs(map%dx - 1.) .lt. eps .and. map%nx .eq. 360) then<br>          write(tmp8,&#x27;(&quot;GRID   3&quot;)&#x27;) <br>        else if (abs(map%dx - 0.5) .lt. eps .and. map%nx .eq. 720) then<br>          write(tmp8,&#x27;(&quot;GRID   4&quot;)&#x27;) <br>        endif<br>      endif<br>      map%source(25:32) = tmp8<br>!     write(6,*) &#x27;map%source = &#x27;,map%source<br>      end subroutine ncep_grid_num<br>!*****************************************************************************!<br><br>      function earth_radius (icode, iscale, irad_m)<br>! Grib2 Code Table 3.2. Returns the spherical earth&#x27;s radius in km.<br>      use module_debug<br>      real :: earth_radius<br>      integer :: icode<br>      integer :: iscale, irad_m<br>      if ( icode .eq. 0 ) then<br>        earth_radius = 6367470. * .001<br>      else if ( icode .eq. 1) then<br>        earth_radius = 0.001 * float(irad_m) / 10**iscale<br>      else if ( icode .eq. 6 ) then<br>        earth_radius = 6371229. * .001<br>      else if ( icode .eq. 8 ) then<br>        earth_radius = 6371200. * .001<br>      else<br>        call mprintf(.true.,ERROR,<br>     &amp;    &quot;unknown earth radius for code %i&quot;,newline=.true.,i1=icode)<br>      endif<br>      end function earth_radius<br></code></pre></td></tr></table></figure>
        </div>
      </div>
    </div>

    <div class="fold">
      <div class="fold-title fold-info collapsed" data-toggle="collapse" href="#collapse-dfb167e8" role="button" aria-expanded="false" aria-controls="collapse-dfb167e8">
        <div class="fold-arrow">▶</div>Vtable.ECMWF_GRIB2
      </div>
      <div class="fold-collapse collapse" id="collapse-dfb167e8">
        <div class="fold-content">
          <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs Vtable.ECMWF_GRIB2">GRIB1| Level| From |  To  | metgrid  | metgrid  | metgrid                                  |GRIB2|GRIB2|GRIB2|GRIB2|<br>Param| Type |Level1|Level2| Name     | Units    | Description                              |Discp|Catgy|Param|Level|<br>-----+------+------+------+----------+----------+------------------------------------------+-----------------------+<br> 129 | 100  |   *  |      | HGT      | m        | Height                                   |  0  |  3  |  5  | 100 |<br> 130 | 100  |   *  |      | TT       | K        | Temperature                              |  0  |  0  |  0  | 100 |<br> 131 | 100  |   *  |      | UU       | m s-1    | U                                        |  0  |  2  |  2  | 100 |<br> 132 | 100  |   *  |      | VV       | m s-1    | V                                        |  0  |  2  |  3  | 100 |<br> 157 | 100  |   *  |      | RH       | %        | Relative Humidity                        |  0  |  1  |  1  | 100 |<br> 165 |  1   |   0  |      | UU       | m s-1    | U                 at 10 m                |  0  |  2  |  2  | 103 |<br> 166 |  1   |   0  |      | VV       | m s-1    | V                 at 10 m                |  0  |  2  |  3  | 103 |<br> 167 |  1   |   0  |      | TT       | K        | Temperature       at  2 m                |  0  |  0  |  0  | 103 |<br> 168 |  1   |   0  |      | DEWPT    | K        |                                          |  0  |  0  |  6  | 103 |<br>     |  1   |   0  |      | RH       | %        | Relative Humidity at 2 m                 |  0  |  1  |  1  | 103 |<br> 172 |  1   |   0  |      | LANDSEA  | 0/1 Flag | Land/Sea flag (1=land, 0 or 2=sea)       |  2  |  0  |  0  |   1 |<br> 134 |  1   |   0  |      | PSFC     | Pa       | Surface Pressure                         |  0  |  3  |  0  |   1 |<br> 151 |  1   |   0  |      | PMSL     | Pa       | Sea-level Pressure                       |  0  |  3  |  0  | 101 |<br> 235 |  1   |   0  |      | SKINTEMP | K        | Skin temperature                         |  0  |  0  | 17  |   1 |<br>  18 | 112  |   0  |   7  | ST000007 | K        | T of 0-7 cm  ground layer                |  2  |  3  |  18 | 151 | <br>  18 | 112  |   7  |  28  | ST007028 | K        | T of 7-28 cm ground layer                |  2  |  3  |  18 | 151 | <br>  18 | 112  |  28  | 100  | ST028100 | K        | T of 28-100 cm ground layer              |  2  |  3  |  18 | 151 | <br>  18 | 112  | 100  | 289  | ST100289 | K        | T of 100-289 cm ground layer             |  2  |  3  |  18 | 151 | <br>  25 | 112  |   0  |   7  | SM000007 | m3 m-3   | Soil moisture of 0-7 cm ground layer     |  2  |  0  |  25 | 151 | <br>  25 | 112  |   7  |  28  | SM007028 | m3 m-3   | Soil moisture of 7-28 cm ground layer    |  2  |  0  |  25 | 151 | <br>  25 | 112  |  28  | 100  | SM028100 | m3 m-3   | Soil moisture of 28-100 cm ground layer  |  2  |  0  |  25 | 151 | <br>  25 | 112  | 100  | 289  | SM100289 | m3 m-3   | Soil moisture of 100-289 cm ground layer |  2  |  0  |  25 | 151 | <br>-----+------+------+------+----------+---------+-----------------------------------------+-------------------------+<br>#<br></code></pre></td></tr></table></figure>
        </div>
      </div>
    </div>
<h4 id="vtable.ecmwf_grib2vtable.ecmwf">Vtable.ECMWF_GRIB2/Vtable.ECMWF</h4>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs console">-rw-rw-r-- 1 wpsze wpsze 321M Apr  1 16:27 ERA5:2025-03-26_00-ECMWF_GRIB2<br>-rw-rw-r-- 1 wpsze wpsze 286M Apr  1 14:26 ERA5:2025-03-26_00-Vtable.ECMWF<br></code></pre></td></tr></table></figure>
<ul>
<li>The intermediate file (ERA5.xxx) by Vtable.ECMWF_GRIB2 is larger file size than that of Vtable.ECMWF</li>
<li>ERA5.xxx by Vtable.ECMWF fails in init_atmosphere_model step.</li>
</ul>
<h3 id="init_atmosphere_model">init_atmosphere_model</h3>
<h4 id="error">Error</h4>
<ul>
<li>MPASv7.3 init_atmosphere_model</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs log">ERROR: extrap_type == 2 not implemented for target_z &gt;= zf(1,nz)<br>ERROR: *****************************************************************<br>ERROR: Error in interpolation of t(k,iCell) for k=  46, iCell=         1<br>CRITICAL ERROR: ********************************************************<br></code></pre></td></tr></table></figure>
<ul>
<li>set 'linear',</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs namelist">&amp;interpolation_control<br>    config_extrap_airtemp = &#x27;linear&#x27;<br>/<br></code></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs log">CRITICAL ERROR: Error in interpolation of st_fg to MPAS grid: num_st = 27244<br></code></pre></td></tr></table></figure>
<ul>
<li><a target="_blank" rel="noopener" href="https://forum.mmm.ucar.edu/threads/error-creating-initial-conditions-with-ncep-fnl-ds083-2.17113/">Error creating initial conditions with NCEP FNL ds083.2 | May 8, 2024</a>
<ul>
<li>I'm trying to create the initial conditions file for MPAS (v8.1) using data obtained from the NCEP FNL ds083.2</li>
<li>Just had to change <code>config_nfgsoillevels</code> to <strong>2</strong> and <code>config_extrap_airtemp</code> to <strong>linear</strong> in <code>namelist.init_atmosphere</code>. Once those two modifications were made <code>init_atmosphere_model</code> and <code>atmosphere_model</code> ran without issues.</li>
<li>Note that <strong>FNL data only contains 2-level of soil information</strong>, which is why we need to set <strong>config_nfgsoillevels=2</strong>. <strong>The top of the FNL data is 10 hpa, and therefore extrapolation is needed if MPAS top level is above 10 hpa</strong>.</li>
<li>For the option of <code>config_extrap_airtemp</code>, would you please let me know what is the model top of your MPAS run? Thanks.</li>
</ul></li>
<li><a target="_blank" rel="noopener" href="https://forum.mmm.ucar.edu/threads/initial-condition-critical-error-error-in-interpolation-of-st_fg-to-mpas.15807/">Initial condition CRITICAL ERROR: Error in interpolation of st_fg to MPAS | Feb 16, 2024</a></li>
<li><a target="_blank" rel="noopener" href="https://forum.mmm.ucar.edu/threads/error-in-interpolation-of-st_fg-to-mpas-grid-with-variable-resolution-mesh-simulation.9387/">'Error in interpolation of st_fg to MPAS grid' with variable-resolution mesh simulation | Jul 23, 2020</a>
<ul>
<li>The error message generally indicates that there are grid cells that have a soil temperature value less than or equal to zero.</li>
<li>I solved the problem by downloading the "Vtable from the RDR page/WRF" and using WPS version 4.0 or higher.</li>
</ul></li>
<li><a target="_blank" rel="noopener" href="https://forum.mmm.ucar.edu/threads/critical-error-error-in-interpolation-of-st_fg-to-mpas-grid.5382/">CRITICAL ERROR: Error in interpolation of st_fg to MPAS grid | Start dateMay 3, 2019</a>
<ul>
<li>This error message is an indication that there were one or more points in the MPAS mesh that received a zero or negative value for soil temperature.</li>
<li>Can you also verify that there are soil moisture and soil temperature fields in your WPS intermediate file, and that the number of soil levels in your intermediate files matches the value of the config_nfgsoillevels in your namelist.init_atmosphere file?</li>
</ul></li>
<li><a target="_blank" rel="noopener" href="https://forum.mmm.ucar.edu/threads/critical-error-error-in-interpolation-of-st_fg-to-mpas-grid-num_st-18642.12857/">CRITICAL ERROR: Error in interpolation of st_fg to MPAS grid: num_st = 18642 | Apr 12, 2023</a>
<ul>
<li><strong>MPAS can only process soil data at specific levels with specific field names. If your input soil data are on levels or with names unrecognized by MPAS, then it won't work</strong>.</li>
<li>Please take a look at the code <strong>"mpas_init_atm_cases.F"</strong>, and the lines 3908 - 4118 process soil temperature data. This might give you some idea how MPAS works.</li>
</ul></li>
<li><a target="_blank" rel="noopener" href="https://forum.mmm.ucar.edu/threads/trying-to-use-rap-as-ic-bc.5549/">Trying to Use RAP as IC/BC | Start dateJun 26, 2019</a>
<ul>
<li>The message "Error in interpolation of st_fg to MPAS grid: num_st = XXXX" is <strong>generally indicative of an issue with the soil temperature</strong>. Would it be possible to use some of the utilities that come with the WRF Pre-processing System (WPS) to check that there are valid soil temperature data in your intermediate file? Specifically, you could use the "<code>rd_intermediate</code>" utility to check that there are fields named, e.g., ST000010, and you could use the "<code>int2nc</code>" utility to convert the intermediate file to netCDF format, where it would be easier to view the soil fields with, e.g., <code>ncview</code>.</li>
</ul></li>
<li><strong>Use WPSv4.6 with above renewed Vtable and rd_grib2.F</strong></li>
</ul>
<h4 id="one-more-issue-資料集可用性-2024-11-12t120000z2025-04-16t120000z">One more issue, 資料集可用性 2024-11-12T12:00:00Z–2025-04-16T12:00:00Z</h4>
<ul>
<li><strong>資料集可用性 2024-11-12T12:00:00Z–2025-04-16T12:00:00Z</strong></li>
<li>The grib files from <code>ecmwf.ini</code> and from <code>aws</code> are different. It will make different/debug on the <code>ungrib</code> step and <code>init_atmosphere_model</code> step.
<ul>
<li>Not all different.</li>
</ul></li>
</ul>
<p>It is because,</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://developers.google.com/earth-engine/datasets/catalog/ECMWF_NRT_FORECAST_IFS_OPER?hl=zh-TW">ECMWF Near-Realtime IFS Atmospheric Forecasts | Earth Engine Data Catalog</a>
<ul>
<li><strong>資料集可用性 2024-11-12T12:00:00Z–2025-04-16T12:00:00Z</strong></li>
<li><strong>自 2024/11/12 推出Cycle 49r1 以來</strong>，Earth Engine 就會提供產品；早期產品則不包含在內。
<ul>
<li>old one: 145 items</li>
<li>new one: 160 items</li>
</ul></li>
</ul></li>
<li><a href="https://waipangsze.github.io/2025/04/10/NWP-Herbie-Download-NWP-model-output-MPAS-WRF/#problem" class="uri">https://waipangsze.github.io/2025/04/10/NWP-Herbie-Download-NWP-model-output-MPAS-WRF/#problem</a></li>
</ul>
<h1 id="parameter-config_nfglevels">parameter "config_nfglevels"</h1>
<ul>
<li><a target="_blank" rel="noopener" href="https://forum.mmm.ucar.edu/threads/configuration-problem-for-parameter-config_nfglevels.10690/">configuration problem for parameter "config_nfglevels" | Sep 2, 2021</a>
<ul>
<li><strong>If you have 37 isobaric levels of atmospheric data, plus surface fields (u10, v10, t2, etc.), that would give a total of 38 levels</strong> from the perspective of the init_atmosphere_model program. As the error message states, config_nfglevels <strong>must therefore be set to at least 38</strong> -- so value of 38, 39, 40, 41, etc. should all work.</li>
<li>Internally, the 'config_nfglevels' namelist option is used by the init_atmosphere_model program to allocate 3-d arrays to hold the horizontally interpolated first-guess ("fg" in the config_nfglevels name) fields. Allocating too few vertical levels in these 3-d arrays is problematic, but allocating extra levels -- which will simply go unused -- isn't a problem, though it does waste memory.</li>
</ul></li>
</ul>
<h4 id="done">Done</h4>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs console">MPAS-120km_2022063000.init.nc<br></code></pre></td></tr></table></figure>
<p>and MPASv7.3 runs (./atmosphere_model) with IFS successfully as well (<strong>both with Vtable.ECMWF_GRIB2 above</strong>).</p>
<h1 id="cronjob">cronjob</h1>
<p>For <code>00z</code>,</p>

    <div class="fold">
      <div class="fold-title fold-info collapsed" data-toggle="collapse" href="#collapse-c21ca059" role="button" aria-expanded="false" aria-controls="collapse-c21ca059">
        <div class="fold-arrow">▶</div>wpsze_download_IFS-cronjob-00z.sh
      </div>
      <div class="fold-collapse collapse" id="collapse-c21ca059">
        <div class="fold-content">
          <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/sh</span><br><span class="hljs-comment">#################################################################</span><br><span class="hljs-comment"># https://data.ecmwf.int/ecpds/home/opendata/20250402/00z/ifs/0p25/oper/20250402000000-0h-oper-fc.grib2</span><br><span class="hljs-comment">#################################################################</span><br><span class="hljs-built_in">source</span> /home/wpsze/micromamba/etc/profile.d/micromamba.sh<br>micromamba activate venv<br><br>BASE_DIR=$(<span class="hljs-built_in">pwd</span>)<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Base Dir = <span class="hljs-variable">$&#123;BASE_DIR&#125;</span>&quot;</span><br><br><span class="hljs-keyword">for</span> ifsday <span class="hljs-keyword">in</span> $(<span class="hljs-built_in">seq</span> 0 1 3); <span class="hljs-keyword">do</span> <span class="hljs-comment"># day-shift = 0, 1, 2, 3</span><br><br>    YYYYMMDDHH=$(<span class="hljs-built_in">date</span> -d <span class="hljs-string">&quot;today - <span class="hljs-variable">$&#123;ifsday&#125;</span> day&quot;</span> +%Y%m%d00)<br><br>    yyyy=<span class="hljs-variable">$&#123;YYYYMMDDHH:0:4&#125;</span><br>    mm=<span class="hljs-variable">$&#123;YYYYMMDDHH:4:2&#125;</span><br>    <span class="hljs-built_in">dd</span>=<span class="hljs-variable">$&#123;YYYYMMDDHH:6:2&#125;</span><br>    hh=<span class="hljs-variable">$&#123;YYYYMMDDHH:8:2&#125;</span><br><br>    yyyymm=<span class="hljs-variable">$&#123;yyyy&#125;</span><span class="hljs-variable">$&#123;mm&#125;</span><br>    yyyymmdd=<span class="hljs-variable">$&#123;yyyy&#125;</span><span class="hljs-variable">$&#123;mm&#125;</span><span class="hljs-variable">$&#123;dd&#125;</span><br><br>    tmp_dir=<span class="hljs-string">&quot;./<span class="hljs-variable">$&#123;yyyy&#125;</span><span class="hljs-variable">$&#123;mm&#125;</span>/<span class="hljs-variable">$&#123;yyyy&#125;</span><span class="hljs-variable">$&#123;mm&#125;</span><span class="hljs-variable">$&#123;dd&#125;</span>&quot;</span><br>    <span class="hljs-built_in">mkdir</span> -p <span class="hljs-variable">$&#123;tmp_dir&#125;</span><br>    <span class="hljs-built_in">cd</span> <span class="hljs-variable">$&#123;tmp_dir&#125;</span><br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Current Dir: <span class="hljs-subst">$(pwd)</span>&quot;</span><br><br>    limit_cpu_core=15<br>    count_cpu_core=1<br><br>    <span class="hljs-comment">#============== 00z ===================================</span><br>    tmp_ifs_fname=<span class="hljs-string">&quot;<span class="hljs-variable">$&#123;YYYYMMDDHH&#125;</span>0000-0h-oper-fc.grib2&quot;</span><br><br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Now, <span class="hljs-variable">$&#123;tmp_ifs_fname&#125;</span> ... &quot;</span><br><br>	    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Downloading ... <span class="hljs-variable">$&#123;tmp_ifs_fname&#125;</span>&quot;</span><br>	    <span class="hljs-comment">#wget -c --no-check-certificate https://data.ecmwf.int/forecasts/$&#123;yyyy&#125;$&#123;mm&#125;$&#123;dd&#125;/00z/ifs/0p25/oper/$&#123;tmp_ifs_fname&#125;</span><br>	    wget -c --no-check-certificate https://data.ecmwf.int/ecpds/home/opendata/<span class="hljs-variable">$&#123;yyyy&#125;</span><span class="hljs-variable">$&#123;mm&#125;</span><span class="hljs-variable">$&#123;dd&#125;</span>/00z/ifs/0p25/oper/<span class="hljs-variable">$&#123;tmp_ifs_fname&#125;</span><br><br><br>    res=$(( <span class="hljs-variable">$&#123;count_cpu_core&#125;</span> % <span class="hljs-variable">$&#123;limit_cpu_core&#125;</span> ))<br>    <span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$&#123;res&#125;</span> == 0 ]]; <span class="hljs-keyword">then</span><br>	    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;please wait <span class="hljs-variable">$&#123;tmp_ifs_fname&#125;</span>, <span class="hljs-variable">$&#123;count_cpu_core&#125;</span>, <span class="hljs-variable">$&#123;res&#125;</span>.&quot;</span><br>	    <span class="hljs-built_in">wait</span><br>    <span class="hljs-keyword">fi</span><br>    <br>    <span class="hljs-built_in">cd</span> <span class="hljs-variable">$&#123;BASE_DIR&#125;</span><br><span class="hljs-keyword">done</span>    <br></code></pre></td></tr></table></figure>
        </div>
      </div>
    </div>
<h2 id="dissemination-schedule">Dissemination schedule</h2>
<figure>
<img src="https://i.imgur.com/j5aMuFL.png" srcset="/img/loading.gif" lazyload alt="Time available (UTC)" width="400" /><figcaption>Time available (UTC)</figcaption>
</figure>
<ul>
<li><strong>HKT = UTC + 8</strong></li>
<li>How to set the crontab: <code>$ crontab -e</code></li>
</ul>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs console"><span class="hljs-meta prompt_">$ </span><span class="language-bash">crontab -l</span><br>30 17 * * * cd /home/wpsze/mpas/IFS; sh wpsze_download_IFS-cronjob-00z.sh <br></code></pre></td></tr></table></figure>
<h1 id="references">References</h1>
<ol type="1">
<li><a target="_blank" rel="noopener" href="https://www.ecmwf.int/en/about/media-centre/news/2024/ecmwf-releases-much-larger-open-dataset">ECMWF releases a much larger open dataset | 29 February 2024</a></li>
<li><a target="_blank" rel="noopener" href="https://www.ecmwf.int/en/forecasts/datasets/open-data">Open data | ECMWF real-time forecast data</a></li>
<li><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/Fgmgjk1_bJdmLWQfttuT0g">ECMWF IFS 免费开放预报升级到 0.25° 分辨率 | 2024年02月26日</a></li>
<li><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/keUhCa-y7xLj6I_xNfJcCw">重大升级！欧洲中期天气预报中心AI加持下免费开放了更高分辨率、更多参数的气象数据！| 2024年03月01日</a></li>
</ol>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/NWP/" class="category-chain-item">NWP</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/WRF/" class="print-no-link">#WRF</a>
      
        <a href="/tags/WPS/" class="print-no-link">#WPS</a>
      
        <a href="/tags/MPAS/" class="print-no-link">#MPAS</a>
      
        <a href="/tags/IC-BC/" class="print-no-link">#IC/BC</a>
      
        <a href="/tags/ECMWF/" class="print-no-link">#ECMWF</a>
      
        <a href="/tags/IFS/" class="print-no-link">#IFS</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>NWP | ECMWF | IFS | Open data</div>
      <div>https://waipangsze.github.io/2024/11/12/ECMWF-IFS/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>Author</div>
          <div>wpsze</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>Posted on</div>
          <div>November 12, 2024</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>Updated on</div>
          <div>October 20, 2025</div>
        </div>
      
      
        <div class="license-meta-item">
          <div>Licensed under</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - Attribution">
                    <i class="iconfont icon-cc-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2024/11/13/WRF-MPAS-as-ICBC/" title="WRF | MPAS Output for WRF IC/BC">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">WRF | MPAS Output for WRF IC/BC</span>
                        <span class="visible-mobile">Previous</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2024/11/02/wrf-topo-wind/" title="WRF | topo-wind">
                        <span class="hidden-mobile">WRF | topo-wind</span>
                        <span class="visible-mobile">Next</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>Table of Contents</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  


  
  





  <script>
  Fluid.utils.createScript('https://lib.baomitu.com/mermaid/8.14.0/mermaid.min.js', function() {
    mermaid.initialize({"theme":"default"});

    Fluid.utils.listenDOMLoaded(function() {
      Fluid.events.registerRefreshCallback(function() {
        if ('mermaid' in window) {
          mermaid.init();
        }
      });
    });
  });
</script>






<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-9HL36SZ28R"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-9HL36SZ28R');
</script>

    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">Keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">

  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  

  <span id="sitetime"></span>
  <script language=javascript>
    function siteTime(){
      window.setTimeout("siteTime()", 1000);
      var seconds = 1000;
      var minutes = seconds * 60;
      var hours = minutes * 60;
      var days = hours * 24;
      var years = days * 365;
      var today = new Date();
      var todayYear = today.getFullYear();
      var todayMonth = today.getMonth()+1;
      var todayDate = today.getDate();
      var todayHour = today.getHours();
      var todayMinute = today.getMinutes();
      var todaySecond = today.getSeconds();
      /* Date.UTC() -- 返回date对象距世界标准时间(UTC)1970年1月1日午夜之间的毫秒数(时间戳)
      year - 作为date对象的年份，为4位年份值
      month - 0-11之间的整数，做为date对象的月份
      day - 1-31之间的整数，做为date对象的天数
      hours - 0(午夜24点)-23之间的整数，做为date对象的小时数
      minutes - 0-59之间的整数，做为date对象的分钟数
      seconds - 0-59之间的整数，做为date对象的秒数
      microseconds - 0-999之间的整数，做为date对象的毫秒数 */
      var t1 = Date.UTC(2023,04,23,00,00,00); //北京时间2018-2-13 00:00:00
      var t2 = Date.UTC(todayYear,todayMonth,todayDate,todayHour,todayMinute,todaySecond);
      var diff = t2-t1;
      var diffYears = Math.floor(diff/years);
      var diffDays = Math.floor((diff/days)-diffYears*365);
      var diffHours = Math.floor((diff-(diffYears*365+diffDays)*days)/hours);
      var diffMinutes = Math.floor((diff-(diffYears*365+diffDays)*days-diffHours*hours)/minutes);
      var diffSeconds = Math.floor((diff-(diffYears*365+diffDays)*days-diffHours*hours-diffMinutes*minutes)/seconds);
      /*document.getElementById("sitetime").innerHTML=" 已运行"+/*diffYears+" 年 "+*/diffDays+" 天 "+diffHours+" 小时 "+diffMinutes+" 分钟 "+diffSeconds+" 秒";
      document.getElementById("sitetime").innerHTML=" 已運行"+diffYears+" 年 "+diffDays+" 天 ";
    }/*因为建站时间还没有一年，就将之注释掉了。需要的可以取消*/
    siteTime();
  </script>
  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/5.0.0/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  
      <script>
        if (!window.MathJax) {
          window.MathJax = {
            tex    : {
              inlineMath: { '[+]': [['$', '$']] }
            },
            loader : {
              load: ['ui/lazy']
            },
            options: {
              renderActions: {
                insertedScript: [200, () => {
                  document.querySelectorAll('mjx-container').forEach(node => {
                    let target = node.parentNode;
                    if (target.nodeName.toLowerCase() === 'li') {
                      target.parentNode.classList.add('has-jax');
                    }
                  });
                }, '', false]
              }
            }
          };
        } else {
          MathJax.startup.document.state(0);
          MathJax.texReset();
          MathJax.typeset();
          MathJax.typesetPromise();
        }

        Fluid.events.registerRefreshCallback(function() {
          if ('MathJax' in window && MathJax.startup.document && typeof MathJax.startup.document.state === 'function') {
            MathJax.startup.document.state(0);
            MathJax.texReset();
            MathJax.typeset();
            MathJax.typesetPromise();
          }
        });
      </script>
    

  <script  src="https://lib.baomitu.com/mathjax/3.2.2/es5/tex-mml-chtml.js" ></script>

  <script  src="/js/local-search.js" ></script>

  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">Blog works best with JavaScript enabled</div>
  </noscript>
</body>
</html>
