

<!DOCTYPE html>
<html lang="en" data-default-color-scheme=light>



<head>
  <meta charset="UTF-8">

  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="wpsze">
  <meta name="keywords" content="">
  
    <meta name="description" content="WRF-ELEC model WRF-ELEC provides basic electrification and lightning using the NSSL microphysics scheme. The electrification parameterizations are based on past work in modeling. The basics of the cha">
<meta property="og:type" content="article">
<meta property="og:title" content="WRF | Predicting lightning activity using WRF-ELEC model">
<meta property="og:url" content="https://waipangsze.github.io/2024/09/20/wrf4-elec-lightning/index.html">
<meta property="og:site_name" content="wpsze">
<meta property="og:description" content="WRF-ELEC model WRF-ELEC provides basic electrification and lightning using the NSSL microphysics scheme. The electrification parameterizations are based on past work in modeling. The basics of the cha">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://upload.wikimedia.org/wikipedia/commons/thumb/9/9f/Lighting_barrage.jpg/1280px-Lighting_barrage.jpg">
<meta property="article:published_time" content="2024-09-19T16:00:00.000Z">
<meta property="article:modified_time" content="2024-10-22T01:22:52.091Z">
<meta property="article:author" content="wpsze">
<meta property="article:tag" content="WRF-ELEC">
<meta property="article:tag" content="Lightning">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://upload.wikimedia.org/wikipedia/commons/thumb/9/9f/Lighting_barrage.jpg/1280px-Lighting_barrage.jpg">
  
  
    <meta name="referrer" content="no-referrer-when-downgrade">
  
  
  <title>WRF | Predicting lightning activity using WRF-ELEC model - wpsze</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css">



<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"waipangsze.github.io","root":"/","version":"1.9.8","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false},"umami":{"src":null,"website_id":null,"domains":null,"start_time":"2024-01-01T00:00:00.000Z","token":null,"api_server":null}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  

  

  

  

  

  



  
<meta name="generator" content="Hexo 7.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>wpsze</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>Home</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>Archives</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>Categories</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>Tags</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/" target="_self">
                <i class="iconfont icon-link-fill"></i>
                <span>Links</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/bookmark/" target="_self">
                <i class="iconfont icon-bookmark"></i>
                <span>Bookmarks</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>About Me</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" target="_self" href="javascript:;" role="button"
                 data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <i class="iconfont icon-books"></i>
                <span>Docs</span>
              </a>
              <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                
                  
                  
                  
                  <a class="dropdown-item" href="/categories/Physics/" target="_self">
                    <i class="iconfont icon-plan"></i>
                    <span>Physics</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/categories/Maths/" target="_self">
                    <i class="iconfont icon-plan"></i>
                    <span>Maths</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/categories/Meteorology/" target="_self">
                    <i class="iconfont icon-plan"></i>
                    <span>Meteorology</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/monitor/" target="_self">
                    
                    <span>Real Time Monitor</span>
                  </a>
                
              </div>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('https://upload.wikimedia.org/wikipedia/commons/thumb/c/c2/Port_and_lighthouse_overnight_storm_with_lightning_in_Port-la-Nouvelle.jpg/1920px-Port_and_lighthouse_overnight_storm_with_lightning_in_Port-la-Nouvelle.jpg') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="WRF | Predicting lightning activity using WRF-ELEC model"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2024-09-20 00:00" pubdate>
          September 20, 2024 am
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          3.7k words
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          32 mins
        
      </span>
    

    
    
      
        <span id="busuanzi_container_page_pv" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="busuanzi_value_page_pv"></span> views
        </span>
        

      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">WRF | Predicting lightning activity using WRF-ELEC model</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="wrf-elec-model">WRF-ELEC model</h1>
<p>WRF-ELEC provides basic electrification and <strong>lightning using the NSSL microphysics scheme</strong>. The electrification parameterizations are based on past work in modeling. The basics of the charge separation schemes comes from Mansell et al. (2005). Their use in the <strong>NSSL 2-moment microphysics</strong> is shown in Mansell et al. 2010 and Mansell and Ziegler (2013). First implementation into WRF is described by Fierro et al. (2013), which includes details of the basic discharge scheme (cylindrical discharge regions centered on lightning initiation points).</p>
<ul>
<li>Mansell et al. 2005: Charge structure and lightning sensitivity in a simulated multicell thunderstorm. J. Geophys. Res., 110, D12101, doi:10.1029/2004JD005287</li>
<li>Mansell, E. R., C. L. Ziegler, and E. C. Bruning, 2010: Simulated electrification of a small thunderstorm with two-moment bulk microphysics. J. Atmos. Sci., 67, 171-194, doi:10. 1175/2009JAS2965.1.</li>
<li><strong>Fierro, A. O., E.R. Mansell, C. Ziegler and D. R. MacGorman 2013: The implementation of an explicit charging and discharge lightning scheme within the WRF-ARW model: Benchmark simulations of a continental squall line, a tropical cyclone and a winter storm. Monthly Weather Review, Volume 141, 2390-2415</strong> (see below)</li>
</ul>
<p>If you have trouble with this option please contact the developers directly (i.e., not wrf_help):</p>
<blockquote>
<p>Ted Mansell (Ted.Mansell <em>at</em> noaa.gov)<br />
Alexandre Fierro (Alex.Fierro <em>at</em> noaa.gov)</p>
</blockquote>
<h2 id="boxmg">BoxMG</h2>
<ul>
<li>Black Box Multigrid (BoxMG) algorithm</li>
</ul>
<p>From <a target="_blank" rel="noopener" href="https://github.com/MicroTed/wrf4-elec/blob/7c90e71bdc4db527d0ec034804e4fd200cdacf28/doc/README.electricity#L41" class="uri">https://github.com/MicroTed/wrf4-elec/blob/7c90e71bdc4db527d0ec034804e4fd200cdacf28/doc/README.electricity#L41</a>,</p>
<p>The <strong>BoxMG elliptic equation solver</strong> is required for WRF-ELEC to calculate the 3D electric potential. This library is distributed at the moment as a source code archive at</p>
<ul>
<li><a target="_blank" rel="noopener" href="http://sourceforge.net/projects/boxmg4wrf/" class="uri">http://sourceforge.net/projects/boxmg4wrf/</a></li>
</ul>
<p>The git repository is recommended as the most up-to-date. Note that the code has only been compiled for Intel/AMD (non-Itanium) architecture under Linux and OS X using either Intel Fortran or GNU compilers. (For problems, contact <a href="mailto:ted.mansell@noaa.gov" class="email">ted.mansell@noaa.gov</a>)</p>
<div class="note note-primary">
            <p><strong>BoxMG needs to be installed before configuring WRF.</strong></p>
          </div>
<p>Install the code where you want the libraries to be and then follow the instructions in the INSTALL document:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ git <span class="hljs-built_in">clone</span> https://git.code.sf.net/p/boxmg4wrf/git boxmg4wrf<br>$ ll<br>34M boxmg4wrf<br></code></pre></td></tr></table></figure>
<ul>
<li><a target="_blank" rel="noopener" href="https://sourceforge.net/p/boxmg4wrf/git/ci/main/tree/" class="uri">https://sourceforge.net/p/boxmg4wrf/git/ci/main/tree/</a>
<ul>
<li>Branches: main, boxmg4wrf-0.1, master, release0.0</li>
</ul></li>
</ul>
<p>git logg (2024-09-24)</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">* d8e89bc (HEAD -&gt; master, origin/master, origin/HEAD)  Fix mpi calls <span class="hljs-keyword">to</span> use single <span class="hljs-keyword">or</span> <span class="hljs-type">double</span> <span class="hljs-type">precision</span> <span class="hljs-keyword">as</span> <span class="hljs-keyword">set</span> <span class="hljs-keyword">by</span> RKIND (<span class="hljs-number">11</span> months ago) &lt;Ted Mansell&gt;<br>* <span class="hljs-number">817</span>df7a  <span class="hljs-keyword">Update</span> <span class="hljs-keyword">to</span> compile <span class="hljs-keyword">on</span> M1 mac (assumes <span class="hljs-keyword">using</span> gfortran <span class="hljs-keyword">as</span> compiler) (<span class="hljs-number">2</span> years ago) &lt;Ted Mansell&gt;<br>* <span class="hljs-number">3</span>cee0c8 (origin/boxmg4wrf<span class="hljs-number">-0.1</span>) Added <span class="hljs-keyword">comment</span> (<span class="hljs-number">2</span> years, <span class="hljs-number">9</span> months ago) &lt;Ted Mansell&gt;<br>* <span class="hljs-number">71</span>c38c1 - Added a <span class="hljs-keyword">check</span> <span class="hljs-keyword">for</span> gcc <span class="hljs-keyword">version</span> <span class="hljs-number">10</span> <span class="hljs-keyword">or</span> greater <span class="hljs-keyword">to</span> <span class="hljs-keyword">add</span> the -fallow-argument-mismatch compile flag - Updates <span class="hljs-keyword">to</span> test example ex_direct_1_f90 (e.g., <span class="hljs-type">double</span> quotes <span class="hljs-keyword">on</span> preprocessed <span class="hljs-keyword">include</span> files) (<span class="hljs-number">2</span> years, <span class="hljs-number">9</span> months ago) &lt;Ted Mansell&gt;<br>* <span class="hljs-number">0e19676</span> erm: <span class="hljs-keyword">add</span> sgl/dbl suffix <span class="hljs-keyword">for</span> libs (<span class="hljs-number">3</span> years, <span class="hljs-number">7</span> months ago) &lt;Ted Mansell&gt;<br>* <span class="hljs-number">6682023</span> erm: turn <span class="hljs-keyword">off</span> <span class="hljs-keyword">all</span> but the one that works (currently) (<span class="hljs-number">3</span> years, <span class="hljs-number">7</span> months ago) &lt;Ted Mansell&gt;<br>* <span class="hljs-number">3644096</span> erm: added dependcies <span class="hljs-keyword">for</span> &quot;check&quot; (<span class="hljs-number">3</span> years, <span class="hljs-number">7</span> months ago) &lt;Ted Mansell&gt;<br>* d98ff35 erm: Minor changes <span class="hljs-keyword">for</span> clarity (hopefully) (<span class="hljs-number">3</span> years, <span class="hljs-number">7</span> months ago) &lt;Ted Mansell&gt;<br>* aaaa34c erm: minor updates (<span class="hljs-number">3</span> years, <span class="hljs-number">7</span> months ago) &lt;Ted Mansell&gt;<br>* b54bb70 erm: added .gitignore file (<span class="hljs-number">3</span> years, <span class="hljs-number">7</span> months ago) &lt;Ted Mansell&gt;<br>* d96cb63 (origin/release0<span class="hljs-number">.0</span>) Initial <span class="hljs-keyword">commit</span> (<span class="hljs-number">3</span> years, <span class="hljs-number">7</span> months ago) &lt;Ted Mansell&gt;<br></code></pre></td></tr></table></figure>
<p>Compile:</p>
<ul>
<li>wrf_env.sh: go to <a href="https://waipangsze.github.io/2023/04/25/WRF_installation_on_a_Linux_based_machine/" class="uri">https://waipangsze.github.io/2023/04/25/WRF_installation_on_a_Linux_based_machine/</a></li>
</ul>
<p>To check environment variables,</p>
<ul>
<li>/ARCH/machine</li>
</ul>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs perl">ife<span class="hljs-string">q (<span class="hljs-variable">$(</span>findstring x86_64,<span class="hljs-variable">$(</span>UNAME_M)</span>),x86_64)<br><br>  BOXMG_CPU = AMD64<br></code></pre></td></tr></table></figure>
<ul>
<li>add these to Makefile to print variables,</li>
</ul>
<figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs gams"><span class="hljs-symbol">$</span>(info <span class="hljs-symbol">$</span><span class="hljs-symbol">$</span>BOXMG_OS is [<span class="hljs-symbol">$</span>&#123;BOXMG_OS&#125;])<br><span class="hljs-symbol">$</span>(info <span class="hljs-symbol">$</span><span class="hljs-symbol">$</span>BOXMG_CPU is [<span class="hljs-symbol">$</span>&#123;BOXMG_CPU&#125;])<br><span class="hljs-symbol">$</span>(info <span class="hljs-symbol">$</span><span class="hljs-symbol">$</span>BOXMG_COMPILER is [<span class="hljs-symbol">$</span>&#123;BOXMG_COMPILER&#125;])<br><span class="hljs-symbol">$</span>(info <span class="hljs-symbol">$</span><span class="hljs-symbol">$</span>BOXMG_ARCHmake is [<span class="hljs-symbol">$</span>&#123;BOXMG_ARCHmake&#125;])<br><span class="hljs-symbol">$</span>(info <span class="hljs-symbol">$</span><span class="hljs-symbol">$</span>BOXMG_ARCH is [<span class="hljs-symbol">$</span>&#123;BOXMG_ARCH&#125;])<br><span class="hljs-symbol">$</span>(info <span class="hljs-symbol">$</span><span class="hljs-symbol">$</span>BOXMG_PRECISION is [<span class="hljs-symbol">$</span>&#123;BOXMG_PRECISION&#125;])<br><span class="hljs-symbol">$</span>(info <span class="hljs-symbol">$</span><span class="hljs-symbol">$</span>BOXMG_MPI is [<span class="hljs-symbol">$</span>&#123;BOXMG_MPI&#125;])<br></code></pre></td></tr></table></figure>
<ul>
<li>$ make</li>
</ul>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs stylus"> $ uname -<span class="hljs-selector-tag">a</span><br>Linux xxx <span class="hljs-number">4.18</span>.<span class="hljs-number">0</span>-<span class="hljs-number">477.10</span>.<span class="hljs-number">1</span><span class="hljs-selector-class">.el8_8</span><span class="hljs-selector-class">.x86_64</span> #<span class="hljs-number">1</span> SMP Tue May <span class="hljs-number">16</span> <span class="hljs-number">11</span>:<span class="hljs-number">38</span>:<span class="hljs-number">37</span> UTC <span class="hljs-number">2023</span> x86_64 x86_64 x86_64 GNU/Linux<br><br><span class="hljs-variable">$BOXMG_OS</span> is <span class="hljs-selector-attr">[Linux]</span><br><span class="hljs-variable">$BOXMG_CPU</span> is <span class="hljs-selector-attr">[AMD64]</span><br><span class="hljs-variable">$BOXMG_COMPILER</span> is <span class="hljs-selector-attr">[gnu]</span><br><span class="hljs-variable">$BOXMG_ARCHmake</span> is <span class="hljs-selector-attr">[./ARCH]</span><br><span class="hljs-variable">$BOXMG_ARCH</span> is <span class="hljs-selector-attr">[Linux-AMD64]</span><br><span class="hljs-variable">$BOXMG_PRECISION</span> is <span class="hljs-selector-attr">[SINGLE]</span><br><span class="hljs-variable">$BOXMG_MPI</span> is <span class="hljs-selector-attr">[yes]</span><br></code></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/bash</span><br><span class="hljs-built_in">export</span> WRF_ENV=<span class="hljs-string">&quot;/home/wpsze/WRF/WRFv440/wrf_env.sh&quot;</span><br><span class="hljs-built_in">source</span> <span class="hljs-variable">$&#123;WRF_ENV&#125;</span><br><br>gcc --version<br>gfortran --version<br>mpirun --version<br><span class="hljs-built_in">which</span> mpif90 &amp; mpif90 --version<br><span class="hljs-built_in">which</span> mpif77 <span class="hljs-comment"># Must</span><br><br><span class="hljs-built_in">export</span> BOXMG_MPI=<span class="hljs-built_in">yes</span><br>make<br></code></pre></td></tr></table></figure>
<div class="note note-success">
            <p>The libraries ( libboxmg_opt_sgl.a, libboxmg-extras_opt_sgl.a ) will be in ./lib.</p>
          </div>
<p>install process:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sh">.......<br>.......<br>gfortran   -funderscoring -DRKIND=4  -Waliasing -Wsurprising -O3  -c -o BMG_rand.o BMG_rand.f<br>ar csrv  ../../lib/libboxmg-extras_opt_sgl.a BMG_rand.o<br>a - BMG_rand.o<br><span class="hljs-built_in">rm</span> BMG_rand.o<br><br> $ ll lib<br>total 1.6M<br>drwxrwxr-x  2 wpsze wpsze  33K Sep 23 16:32 ./<br>drwxrwxr-x 11 wpsze wpsze  33K Sep 23 16:28 ../<br>-rw-rw-r--  1 wpsze wpsze    0 Sep 23 16:13 .keepme<br>-rw-rw-r--  1 wpsze wpsze 1.4M Sep 23 16:32 libboxmg-extras_opt_sgl.a<br>-rw-rw-r--  1 wpsze wpsze 1.4M Sep 23 16:30 libboxmg_opt_sgl.a<br></code></pre></td></tr></table></figure>
<ul>
<li><a target="_blank" rel="noopener" href="https://forum.mmm.ucar.edu/threads/error-while-making-boxmg.12977/">Error while Making BoxMG?</a></li>
</ul>
<h3 id="test-boxmg">Test BoxMG</h3>
<ol type="1">
<li>Go to /tests and make</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/bash</span><br><span class="hljs-built_in">export</span> WRF_ENV=<span class="hljs-string">&quot;/home/wpsze/WRF/WRFv440/wrf_env.sh&quot;</span><br><span class="hljs-built_in">source</span> <span class="hljs-variable">$&#123;WRF_ENV&#125;</span><br><br>gcc --version<br>gfortran --version<br>mpirun --version<br><span class="hljs-built_in">which</span> mpif90 &amp; mpif90 --version<br><span class="hljs-built_in">which</span> mpif77<br><br><span class="hljs-built_in">export</span> LDFLAGS=-L/EM/wpsze/WRF/WRF4-elec/wrf_install/boxmg4wrf/lib<br><span class="hljs-built_in">export</span> LD_LIBRARY_PATH=/EM/wpsze/WRF/WRF4-elec/wrf_install/boxmg4wrf/lib:<span class="hljs-variable">$LD_LIBRARY_PATH</span><br><span class="hljs-built_in">export</span> CPPFLAGS=-I/EM/wpsze/WRF/WRF4-elec/wrf_install/boxmg4wrf/include<br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$&#123;LD_LIBRARY_PATH&#125;</span><br><br><span class="hljs-built_in">export</span> BOXMG_MPI=<span class="hljs-built_in">yes</span><br><br>make<br></code></pre></td></tr></table></figure>
<p>it shows,</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">- <span class="hljs-keyword">building </span><span class="hljs-keyword">boxmg-sym-std-2D </span>objects in libboxmg_opt_sgl.a ... <br>- <span class="hljs-keyword">building </span><span class="hljs-keyword">boxmg-sym-std-3D </span>objects in libboxmg_opt_sgl.a ... <br>- linking objects .... <br>- the executable ex_direct_1_f90 has <span class="hljs-keyword">been </span>created.<br></code></pre></td></tr></table></figure>
<ul>
<li>boxmg-sym-std-3D/ex_direct_1_f90 is successful.</li>
<li>All the rest fails. (why? related RKIND issue.)</li>
</ul>
<h3 id="configurecompile-wrf">Configure/compile WRF</h3>
<div class="note note-danger">
            <p>Important note:<br />Compile WRF using <strong>only one core</strong> with BoxMG !!!<br />./compile -j 1 em_real 2&gt;&amp;1 | tee compile.log</p>
          </div>
<p>To configure WRF, two environment variables must be set: WRF_ELEC and BOXMG</p>
<p>For bash:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">export</span> WRF_ELEC=1<br><span class="hljs-built_in">export</span> BOXMGLIBDIR=[path to boxmg directory]<br></code></pre></td></tr></table></figure>
<p>For example, if the boxmg library directory is /home/wpsze/WRF/WRF4-elec/wrf_install/boxmg4wrf/lib, then (for bash)</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">export</span> BOXMGLIBDIR=/home/wpsze/WRF/WRF4-elec/wrf_install/boxmg4wrf/<br></code></pre></td></tr></table></figure>
<p>Then run 'configure' in the WRF main directory and select an option for <strong>'dmpar' (distributed memory parallel)</strong>. The code is set up only to use the MPI parallel solver from BoxMG, so do not compile for serial mode. (It can still be run on a single processor, however.)</p>
<h2 id="microtedwrf4-elec">MicroTed/wrf4-elec</h2>
<p><a target="_blank" rel="noopener" href="https://github.com/MicroTed/wrf4-elec" class="uri">https://github.com/MicroTed/wrf4-elec</a></p>
<p>The impact of initial conditions in predicting lightning activity using the Weather Research and Forecasting (WRF) with the electrification (ELEC) extra package, known as WRF-ELEC model, has been investigated.</p>
<h3 id="an-example-of-namelist.input">An example of namelist.input</h3>
<p><a target="_blank" rel="noopener" href="https://github.com/MicroTed/wrf4-elec/blob/7c90e71bdc4db527d0ec034804e4fd200cdacf28/test/em_quarter_ss/electest/namelist.input#L55" class="uri">https://github.com/MicroTed/wrf4-elec/blob/7c90e71bdc4db527d0ec034804e4fd200cdacf28/test/em_quarter_ss/electest/namelist.input#L55</a></p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs makefile">&amp;physics<br>mp_physics                          = 18,     1,     1,<br>elec_physics                        = 1,<br>nssl_ipelec                         = 2,<br>nssl_cccn                           = 0.8e9,<br>nssl_isaund                         = 11,<br>nssl_iscreen                        = 1,<br>nssl_idischarge                     = 1,<br>nssl_ibrkd                          = 4,<br>ra_lw_physics                       = 0,     0,     0,<br>ra_sw_physics                       = 0,     0,     0,<br>radt                                = 30,    30,    30,<br>sf_sfclay_physics                   = 0,     0,     0,<br>sf_surface_physics                  = 0,     0,     0,<br>bl_pbl_physics                      = 0,     0,     0,<br>bldt                                = 0,     0,     0,<br>cu_physics                          = 0,     0,     0,<br>cudt                                = 5,     5,     5,<br>num_soil_layers                     = 5,<br>/<br></code></pre></td></tr></table></figure>
<h2 id="readme.electricity">README.electricity</h2>
<div class="note note-primary">
            <p><a target="_blank" rel="noopener" href="https://github.com/MicroTed/wrf4-elec/blob/7c90e71bdc4db527d0ec034804e4fd200cdacf28/doc/README.electricity#L41" class="uri">https://github.com/MicroTed/wrf4-elec/blob/7c90e71bdc4db527d0ec034804e4fd200cdacf28/doc/README.electricity#L41</a></p>
          </div>
<h2 id="wrf4-elecs-registry.elec">wrf4-elec's registry.elec</h2>
<p><a target="_blank" rel="noopener" href="https://github.com/MicroTed/wrf4-elec/blob/main/Registry/registry.elec" class="uri">https://github.com/MicroTed/wrf4-elec/blob/main/Registry/registry.elec</a></p>
<div class="note note-primary">
            <p>Look at namelist !!</p>
          </div>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-comment"># SPACE CHARGE EXPLICIT LIGHTNING</span><br><span class="hljs-attribute">state</span>   real    scr            ikjftb  scalar      <span class="hljs-number">1</span>         -     \<br>   <span class="hljs-attribute">i0rhusdf</span>=(bdy_interp:dt)    <span class="hljs-string">&quot;SCR&quot;</span>       <span class="hljs-string">&quot;Rain space charge mixing ratio&quot;</span> <span class="hljs-string">&quot;# C kg(-1)&quot;</span><br><span class="hljs-attribute">state</span>   real    scw            ikjftb  scalar      <span class="hljs-number">1</span>         -     \<br>   <span class="hljs-attribute">i0rhusdf</span>=(bdy_interp:dt)    <span class="hljs-string">&quot;SCW&quot;</span>       <span class="hljs-string">&quot;cloud water space charge mixing ratio&quot;</span> <span class="hljs-string">&quot;# C kg(-1)&quot;</span><br><span class="hljs-attribute">state</span>   real    sci            ikjftb  scalar      <span class="hljs-number">1</span>         -     \<br>   <span class="hljs-attribute">i0rhusdf</span>=(bdy_interp:dt)    <span class="hljs-string">&quot;SCI&quot;</span>       <span class="hljs-string">&quot;cloud ice space charge mixing ratio&quot;</span> <span class="hljs-string">&quot;# C kg(-1)&quot;</span><br><span class="hljs-attribute">state</span>   real    scs            ikjftb  scalar      <span class="hljs-number">1</span>         -     \<br>   <span class="hljs-attribute">i0rhusdf</span>=(bdy_interp:dt)    <span class="hljs-string">&quot;SCS&quot;</span>       <span class="hljs-string">&quot;snow space charge mixing ratio&quot;</span> <span class="hljs-string">&quot;# C kg(-1)&quot;</span><br><span class="hljs-attribute">state</span>   real    sch            ikjftb  scalar      <span class="hljs-number">1</span>         -     \<br>   <span class="hljs-attribute">i0rhusdf</span>=(bdy_interp:dt)    <span class="hljs-string">&quot;SCH&quot;</span>       <span class="hljs-string">&quot;graupel water space charge mixing ratio&quot;</span> <span class="hljs-string">&quot;# C kg(-1)&quot;</span><br><span class="hljs-attribute">state</span>   real    schl           ikjftb  scalar      <span class="hljs-number">1</span>         -     \<br>   <span class="hljs-attribute">i0rhusdf</span>=(bdy_interp:dt)    <span class="hljs-string">&quot;SCHL&quot;</span>       <span class="hljs-string">&quot;hail water space charge mixing ratio&quot;</span> <span class="hljs-string">&quot;# C kg(-1)&quot;</span><br><span class="hljs-attribute">state</span>   real    sciona          ikjftb  scalar      <span class="hljs-number">1</span>         -     \<br>   <span class="hljs-attribute">i0rhusdf</span>=(bdy_interp:dt)    <span class="hljs-string">&quot;SCIONA&quot;</span>       <span class="hljs-string">&quot;Passive net ion space charge&quot;</span> <span class="hljs-string">&quot;# C kg(-1)&quot;</span><br><span class="hljs-attribute">state</span>   real    clnox          ikjftb  scalar      <span class="hljs-number">1</span>         -     \<br>   <span class="hljs-attribute">i0rhusdf</span>=(bdy_interp:dt)    <span class="hljs-string">&quot;CLNOX&quot;</span>      <span class="hljs-string">&quot;Lightning NOx concentration&quot;</span> <span class="hljs-string">&quot;# moles kg(-1)&quot;</span><br><span class="hljs-comment"># END SPACE CHARGE EXPLICIT LIGHTNING</span><br><br><span class="hljs-comment"># EXPLICIT LIGHTNING</span><br><span class="hljs-comment">#</span><br><span class="hljs-attribute">state</span>    real    rscghis_2d      ij   misc    <span class="hljs-number">1</span>         -     irh         <span class="hljs-string">&quot;rscghis_2d&quot;</span>             <span class="hljs-string">&quot;MAX NONINDUCTIVE CHARGING 2D&quot;</span>     <span class="hljs-string">&quot;C m-2&quot;</span><br><span class="hljs-attribute">state</span>    real    induc           ikj  misc    <span class="hljs-number">1</span>         -     irh         <span class="hljs-string">&quot;induc&quot;</span>                  <span class="hljs-string">&quot;TOTAL INDUCTIVE CHARGING &quot;</span>     <span class="hljs-string">&quot;C m-3&quot;</span><br><span class="hljs-attribute">state</span>    real    noninduc        ikj  misc    <span class="hljs-number">1</span>         -     irh         <span class="hljs-string">&quot;noninduc&quot;</span>               <span class="hljs-string">&quot;TOTAL NONINDUCTIVE CHARGING&quot;</span>     <span class="hljs-string">&quot;C m-3&quot;</span><br><span class="hljs-attribute">state</span>    real    sctot           ikj  misc    <span class="hljs-number">1</span>         -     irh         <span class="hljs-string">&quot;sctot&quot;</span>                  <span class="hljs-string">&quot;Total Space Charge Density&quot;</span>     <span class="hljs-string">&quot;C m-3&quot;</span><br><span class="hljs-attribute">state</span>    real    elecmag         ikj  misc    <span class="hljs-number">1</span>         -     irh         <span class="hljs-string">&quot;elecmag&quot;</span>                <span class="hljs-string">&quot;EFIELD MAGNITUDE&quot;</span>     <span class="hljs-string">&quot;V m-1&quot;</span><br><span class="hljs-attribute">state</span>    real    elecx           ikj  misc    <span class="hljs-number">1</span>         -     irh         <span class="hljs-string">&quot;elecx&quot;</span>                  <span class="hljs-string">&quot;EFIELD X-Component&quot;</span>     <span class="hljs-string">&quot;V m-1&quot;</span><br><span class="hljs-attribute">state</span>    real    elecy           ikj  misc    <span class="hljs-number">1</span>         -     irh         <span class="hljs-string">&quot;elecy&quot;</span>                  <span class="hljs-string">&quot;EFIELD Y-Component&quot;</span>     <span class="hljs-string">&quot;V m-1&quot;</span><br><span class="hljs-attribute">state</span>    real    elecz           ikj  misc    <span class="hljs-number">1</span>         -     irh         <span class="hljs-string">&quot;elecz&quot;</span>                  <span class="hljs-string">&quot;EFIELD Z-Component&quot;</span>     <span class="hljs-string">&quot;V m-1&quot;</span><br><span class="hljs-attribute">state</span>    real    pot             ikj  misc    <span class="hljs-number">1</span>         -     irh         <span class="hljs-string">&quot;pot&quot;</span>                    <span class="hljs-string">&quot;POTENTIAL&quot;</span>     <span class="hljs-string">&quot;V&quot;</span><br><span class="hljs-attribute">state</span>    real    light            ij  misc    <span class="hljs-number">1</span>         -     irh         <span class="hljs-string">&quot;light&quot;</span>                  <span class="hljs-string">&quot;lightning flash initiations&quot;</span>         <span class="hljs-string">&quot;flash origin density&quot;</span><br><span class="hljs-attribute">state</span>    real    lightdens        ij  misc    <span class="hljs-number">1</span>         -     irh         <span class="hljs-string">&quot;lightdens&quot;</span>              <span class="hljs-string">&quot;lightning flash density&quot;</span>    <span class="hljs-string">&quot;flash column-1&quot;</span><br><span class="hljs-attribute">state</span>    real    lightfod         ij  misc    <span class="hljs-number">1</span>         -     irh         <span class="hljs-string">&quot;lightfod&quot;</span>               <span class="hljs-string">&quot;normalized lightning flash origin density&quot;</span>   <span class="hljs-string">&quot;flash column-1&quot;</span><br><span class="hljs-attribute">state</span>    real    flshfedic        ij  misc    <span class="hljs-number">1</span>         -     irh         <span class="hljs-string">&quot;flshfedic&quot;</span>              <span class="hljs-string">&quot;IC lightning flash extent density&quot;</span>         <span class="hljs-string">&quot;flash column-1&quot;</span><br><span class="hljs-attribute">state</span>    real    flshfedicp       ij  misc    <span class="hljs-number">1</span>         -     irh         <span class="hljs-string">&quot;flshfedicp&quot;</span>             <span class="hljs-string">&quot;IC pos lightning flash extent density&quot;</span>         <span class="hljs-string">&quot;flash column-1&quot;</span><br><span class="hljs-attribute">state</span>    real    flshfedicn       ij  misc    <span class="hljs-number">1</span>         -     irh         <span class="hljs-string">&quot;flshfedicn&quot;</span>             <span class="hljs-string">&quot;IC neg lightning flash extent density&quot;</span>         <span class="hljs-string">&quot;flash column-1&quot;</span><br><span class="hljs-attribute">state</span>    real    flshfedcg        ij  misc    <span class="hljs-number">1</span>         -     irh         <span class="hljs-string">&quot;flshfedcg&quot;</span>              <span class="hljs-string">&quot;CG lightning flash extent density&quot;</span>         <span class="hljs-string">&quot;flash column-1&quot;</span><br><span class="hljs-attribute">state</span>    real    flshfedcgn       ij  misc    <span class="hljs-number">1</span>         -     irh         <span class="hljs-string">&quot;flshfedcgn&quot;</span>             <span class="hljs-string">&quot;CG neg lightning flash extent density&quot;</span>         <span class="hljs-string">&quot;flash column-1&quot;</span><br><span class="hljs-attribute">state</span>    real    flshfedcgp       ij  misc    <span class="hljs-number">1</span>         -     irh         <span class="hljs-string">&quot;flshfedcgp&quot;</span>             <span class="hljs-string">&quot;CG pos lightning flash extent density&quot;</span>         <span class="hljs-string">&quot;flash column-1&quot;</span><br><span class="hljs-attribute">state</span>    real    lightdis         ij  misc    <span class="hljs-number">1</span>         -     irh         <span class="hljs-string">&quot;lightdis&quot;</span>               <span class="hljs-string">&quot;lightning source density&quot;</span>     <span class="hljs-string">&quot;Source column-1&quot;</span><br><span class="hljs-attribute">state</span>    real    flshi           ikj  misc    <span class="hljs-number">1</span>         -     irh         <span class="hljs-string">&quot;flshi&quot;</span>                  <span class="hljs-string">&quot;Lightning init points&quot;</span>     <span class="hljs-string">&quot;count&quot;</span><br><span class="hljs-attribute">state</span>    real    flshn           ikj  misc    <span class="hljs-number">1</span>         -     irh         <span class="hljs-string">&quot;flshn&quot;</span>                  <span class="hljs-string">&quot;Negative channels&quot;</span>     <span class="hljs-string">&quot;count&quot;</span><br><span class="hljs-attribute">state</span>    real    flshp           ikj  misc    <span class="hljs-number">1</span>         -     irh         <span class="hljs-string">&quot;flshp&quot;</span>                  <span class="hljs-string">&quot;Positive channels&quot;</span>     <span class="hljs-string">&quot;count&quot;</span><br><span class="hljs-comment"># END EXPLICIT LIGHTNING</span><br><br><br><span class="hljs-comment"># Explicit lightning</span><br><span class="hljs-attribute">rconfig</span>   integer  nssl_ipelec            namelist,physics      max_domains   <span class="hljs-number">0</span>       rh       <span class="hljs-string">&quot;Electrification selection&quot;</span>  <span class="hljs-string">&quot;&quot;</span>      <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-attribute">rconfig</span>   integer  nssl_isaund            namelist,physics      <span class="hljs-number">1</span>             <span class="hljs-number">12</span>      rh       <span class="hljs-string">&quot;Charge separation selection&quot;</span>  <span class="hljs-string">&quot;&quot;</span>      <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-attribute">rconfig</span>   integer  nssl_iscreen           namelist,physics      <span class="hljs-number">1</span>             <span class="hljs-number">0</span>       rh       <span class="hljs-string">&quot;Screening layer parameterization flag&quot;</span>  <span class="hljs-string">&quot;&quot;</span>      <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-attribute">rconfig</span>   real     nssl_lightrad          namelist,physics      <span class="hljs-number">1</span>             <span class="hljs-number">12000</span>   rh       <span class="hljs-string">&quot;discharge cylinder radius (m)&quot;</span>  <span class="hljs-string">&quot;&quot;</span>      <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-attribute">rconfig</span>   integer  nssl_idischarge        namelist,physics      <span class="hljs-number">1</span>             <span class="hljs-number">1</span>       rh       <span class="hljs-string">&quot;lightning discharge flag&quot;</span>  <span class="hljs-string">&quot;&quot;</span>      <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-attribute">rconfig</span>   integer  nssl_ibrkd             namelist,physics      <span class="hljs-number">1</span>             <span class="hljs-number">4</span>       rh       <span class="hljs-string">&quot;Critical Breakeven Efield profile selection&quot;</span>  <span class="hljs-string">&quot;&quot;</span>      <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-attribute">rconfig</span>   real     nssl_elgtfestop        namelist,physics      <span class="hljs-number">1</span>             <span class="hljs-number">0</span>.<span class="hljs-number">8</span>     rh       <span class="hljs-string">&quot;3D lightning initial channel stopping fraction&quot;</span>  <span class="hljs-string">&quot;&quot;</span>      <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-attribute">rconfig</span>   real     nssl_ecrit             namelist,physics      <span class="hljs-number">1</span>             <span class="hljs-number">120000</span>  rh       <span class="hljs-string">&quot;Critical Breakeven Efield magnitude for discharge (V/m) assuming height-constant Ecrit profile&quot;</span>  <span class="hljs-string">&quot;&quot;</span>      <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-attribute">rconfig</span>   real     nssl_disfrac           namelist,physics      <span class="hljs-number">1</span>             <span class="hljs-number">0</span>.<span class="hljs-number">3</span>     rh       <span class="hljs-string">&quot;percentile of charge removed upon discharge (BLM)&quot;</span>  <span class="hljs-string">&quot;&quot;</span>      <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-attribute">rconfig</span>   real     nssl_einternal         namelist,physics      <span class="hljs-number">1</span>           <span class="hljs-number">200</span>.<span class="hljs-number">0</span>     rh       <span class="hljs-string">&quot;Lightning channel internal field (MSZ)&quot;</span>  <span class="hljs-string">&quot;&quot;</span>      <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-attribute">rconfig</span>   real     nssl_tgrnd             namelist,physics      <span class="hljs-number">1</span>           <span class="hljs-number">266</span>.<span class="hljs-number">16</span>    rh       <span class="hljs-string">&quot;Temperature threshold for CG (MSZ)&quot;</span>  <span class="hljs-string">&quot;&quot;</span>      <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-attribute">rconfig</span>   real     nssl_zgrnd             namelist,physics      <span class="hljs-number">1</span>             -<span class="hljs-number">1</span>.     rh       <span class="hljs-string">&quot;Height threshold for CG (MSZ)&quot;</span>  <span class="hljs-string">&quot;&quot;</span>      <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-attribute">rconfig</span>   integer  nssl_clnox             namelist,physics      <span class="hljs-number">1</span>             <span class="hljs-number">0</span>       rh       <span class="hljs-string">&quot;Lightning NOX prediction flag&quot;</span>  <span class="hljs-string">&quot;&quot;</span>      <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-comment"># end Explicit lightning</span><br><br><span class="hljs-attribute">rconfig</span>   integer  elec_physics           namelist,physics      <span class="hljs-number">1</span>            <span class="hljs-number">0</span>       irh       <span class="hljs-string">&quot;elec_physics&quot;</span>            <span class="hljs-string">&quot;&quot;</span>      <span class="hljs-string">&quot;&quot;</span><br><br><span class="hljs-comment"># external WRF-ELEC package</span><br><span class="hljs-attribute">package</span>   noelec             elec_physics==<span class="hljs-number">0</span>             -             -<br><span class="hljs-attribute">package</span>   eleclgt            elec_physics==<span class="hljs-number">1</span>             -             scalar:scr,scw,sci,scs,sch,schl,sciona;state:rscghis_2d,sctot,noninduc,induc,pot,elecmag,elecx,elecy,elecz,light,lightdens,lightdis<br><span class="hljs-comment"># for case of no hail (nssl_2momg)</span><br><span class="hljs-attribute">package</span>   eleclgtg           elec_physics==<span class="hljs-number">11</span>            -             scalar:scr,scw,sci,scs,sch,sciona;state:rscghis_2d,sctot,noninduc,induc,pot,elecmag,elecx,elecy,elecz,light,lightdens,lightdis,lightfod<br><br><span class="hljs-attribute">package</span> lightning1d          nssl_idischarge==<span class="hljs-number">1</span>   -    state:lightfod<br><span class="hljs-attribute">package</span> lightning3d          nssl_idischarge==<span class="hljs-number">2</span>   -    state:flshi,flshn,flshp,flshfedic,flshfedicp,flshfedicn,flshfedcg,flshfedcgp,flshfedcgn<br><span class="hljs-comment"># package lightning3da         nssl_idischarge==3   -    state:flshi,flshn,flshp</span><br><br><span class="hljs-attribute">package</span> nssl_cnox_off nssl_clnox==<span class="hljs-number">0</span>   -   -<br><span class="hljs-attribute">package</span> nssl_cnox_on  nssl_clnox==<span class="hljs-number">1</span>   -   scalar:clnox<br></code></pre></td></tr></table></figure>
<p>here noted,</p>
<!-- <style>
tr:nth-child(even) {
  background-color: #b2b2b2!important;
  !color: #f4f4f4!important;
}
</style> -->
<table>

<thead>
<tr class="header">
<th style="text-align: left;">elec_physics</th>
<th style="text-align: center;">nssl_ipelec</th>
<th style="text-align: center;">nssl_idischarge</th>
<th style="text-align: left;">outputs</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">1</td>
<td style="text-align: left;">?</td>
</tr>
<tr class="even">
<td style="text-align: left;">1</td>
<td style="text-align: center;">3</td>
<td style="text-align: center;">1</td>
<td style="text-align: left;">scalar:scr,scw,sci,scs,sch,schl,sciona; <br> state:rscghis_2d,sctot,noninduc,induc,pot, <br> elecmag,elecx,elecy,elecz,light,lightdens,lightdis</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: center;">3</td>
<td style="text-align: center;">2</td>
<td style="text-align: left;">state:flshi,flshn,flshp,flshfedic, <br> flshfedicp,flshfedicn,flshfedcg,flshfedcgp,flshfedcgn</td>
</tr>
</tbody>
</table>
<h2 id="specific-namelist.input-options">Specific namelist.input options</h2>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><code class="hljs csharp">Specific namelist.input options are given below, along <span class="hljs-keyword">with</span> a list of output fields.<br><br><br>Electrification only works <span class="hljs-keyword">with</span> the NSSL <span class="hljs-number">2</span>-<span class="hljs-function">moment <span class="hljs-title">options</span> (<span class="hljs-params"><span class="hljs-keyword">with</span> hail</span>):</span><br><span class="hljs-function"></span><br><span class="hljs-function"> <span class="hljs-title">mp_physics</span>(<span class="hljs-params">max_dom</span>)</span><br>                                     = <span class="hljs-number">17</span>, NSSL <span class="hljs-number">2</span>-moment <span class="hljs-number">4</span>-<span class="hljs-function">ice <span class="hljs-title">scheme</span> (<span class="hljs-params">steady background CCN</span>)</span><br>                                     = <span class="hljs-number">18</span>, NSSL <span class="hljs-number">2</span>-moment <span class="hljs-number">4</span>-<span class="hljs-function">ice scheme <span class="hljs-keyword">with</span> predicted <span class="hljs-title">CCN</span> (<span class="hljs-params">better <span class="hljs-keyword">for</span> idealized than real cases</span>)</span><br>                                       ; to <span class="hljs-keyword">set</span> a <span class="hljs-keyword">global</span> CCN <span class="hljs-keyword">value</span>, use<br>                                     = <span class="hljs-number">22</span>, NSSL <span class="hljs-number">2</span>-moment <span class="hljs-number">3</span>-ice (hail species turned off)<br>                                       <br>Other variables <span class="hljs-keyword">in</span> the &amp;physics namelist:<br><br> elec_physics                        = <span class="hljs-number">0</span>, electrification (<span class="hljs-keyword">and</span> charge arrays) <span class="hljs-function">turned <span class="hljs-title">off</span> (<span class="hljs-params">DEFAULT</span>)</span><br>                                     = <span class="hljs-number">1</span>, <span class="hljs-function">electrification turned <span class="hljs-title">on</span> (<span class="hljs-params">only works <span class="hljs-keyword">with</span> mp_physics = <span class="hljs-number">17</span>, <span class="hljs-number">18</span>, <span class="hljs-keyword">or</span> <span class="hljs-number">22</span> i.e., <span class="hljs-number">2</span>-moment NSSL schemes</span>)</span><br><span class="hljs-function"></span><br><span class="hljs-function"> <span class="hljs-title">nssl_ipelec</span> (<span class="hljs-params">max_dom</span>)     ! NOTE: only <span class="hljs-keyword">set</span> <span class="hljs-keyword">this</span> to a nonzero <span class="hljs-keyword">value</span> <span class="hljs-keyword">on</span> the innermost domain</span><br>                                     = <span class="hljs-number">0</span>, <span class="hljs-function">charging turned <span class="hljs-title">off</span> (<span class="hljs-params">DEFAULT</span>)</span><br>                                     = <span class="hljs-number">2</span>, non-inductive charging only<br>                                     = <span class="hljs-number">3</span>, non-inductive + inductive charging<br>                                     = <span class="hljs-number">1</span>, <span class="hljs-function"><span class="hljs-keyword">not</span> <span class="hljs-title">used</span> (<span class="hljs-params">reserved <span class="hljs-keyword">for</span> future use</span>)</span><br><span class="hljs-function"></span><br><span class="hljs-function"> nssl_idischarge</span>                     = <span class="hljs-number">0</span>, no discharge<br>                                     = <span class="hljs-number">1</span>, Cylindrical <span class="hljs-string">&quot;1D&quot;</span> <span class="hljs-function">lightning scheme based <span class="hljs-keyword">on</span> Ziegler <span class="hljs-keyword">and</span> <span class="hljs-title">MacGorman</span> (<span class="hljs-params"><span class="hljs-number">1994</span>, JAS</span>)</span> <br>                                     = <span class="hljs-number">2</span>, <span class="hljs-number">3</span>D discrete discharge adapted <span class="hljs-keyword">from</span> MacGorman et al. (<span class="hljs-number">2001</span>)<br><br> nssl_iscreen                        = <span class="hljs-number">0</span>, <span class="hljs-function">no screening <span class="hljs-title">layer</span> (<span class="hljs-params">DEFAULT</span>)</span><br>                                     = <span class="hljs-number">1</span>, screening layer scheme of Ziegler et al. (<span class="hljs-number">1991</span>, JGR)<br>                                     = <span class="hljs-number">2</span>, <span class="hljs-function">screening layer only applied at cloud <span class="hljs-title">top</span> (<span class="hljs-params">seems to be better <span class="hljs-keyword">for</span> storm complexes <span class="hljs-keyword">and</span> large storms</span>)</span><br><span class="hljs-function"></span><br><span class="hljs-function"> nssl_ibrkd</span>                          = breakdown electric field profile to initiate lightning<br>                                     = <span class="hljs-number">1</span>, constant profile <span class="hljs-keyword">with</span> height <span class="hljs-keyword">with</span> <span class="hljs-keyword">value</span> <span class="hljs-keyword">set</span> <span class="hljs-keyword">by</span> nssl_ecrit<br>                                     = <span class="hljs-number">2</span> to <span class="hljs-number">5</span>, <span class="hljs-function">variants of vertical Ecrit profile of <span class="hljs-title">Dwyer</span> (<span class="hljs-params"><span class="hljs-number">2003</span>, GRL</span>) - &#x27;4&#x27; <span class="hljs-keyword">is</span> <span class="hljs-title">recommended</span> (<span class="hljs-params">DEFAULT <span class="hljs-keyword">is</span> <span class="hljs-number">4</span></span>).</span><br><span class="hljs-function"></span><br><span class="hljs-function"> nssl_isaund</span>                         = <span class="hljs-function">Calls the appropriate version of the <span class="hljs-title">UMIST</span> (<span class="hljs-params">e.g., Saunders et al. <span class="hljs-number">1991</span> scheme</span>)</span><br>                                     = <span class="hljs-number">-5</span> : Saunders etal <span class="hljs-number">1991</span> (following Helsdon et al. <span class="hljs-number">2001</span>, but use normal charging instead of <span class="hljs-string">&#x27;anomalous&#x27;</span> zones)<br>                                     = <span class="hljs-number">0</span> : Saunders <span class="hljs-number">1991</span> (modified <span class="hljs-keyword">as</span> <span class="hljs-keyword">in</span> Wojcik <span class="hljs-number">1994</span>)<br>                                     = <span class="hljs-number">2</span> : <span class="hljs-function">RR <span class="hljs-title">scheme</span> (<span class="hljs-params"> no extra factor </span>) (<span class="hljs-params">Mansell et al. <span class="hljs-number">2005</span>, JGR</span>)</span><br>                                     = <span class="hljs-number">4</span> : <span class="hljs-function">Saunders <span class="hljs-keyword">and</span> Peck <span class="hljs-title">Scheme</span> (<span class="hljs-params"> no extra factor </span>) (<span class="hljs-params">Mansell et al. <span class="hljs-number">2005</span>, JGR</span>)</span><br>                                     = <span class="hljs-number">9</span> : <span class="hljs-function">Saunders <span class="hljs-keyword">and</span> Peck <span class="hljs-title">Scheme</span> (<span class="hljs-params"> no extra factor, cutoff at <span class="hljs-number">-32.47</span> <span class="hljs-keyword">as</span> orig eq. <span class="hljs-keyword">from</span> sp98 </span>) (<span class="hljs-params">Mansell et al. <span class="hljs-number">2010</span>, JAS</span>)</span><br>                                     = <span class="hljs-number">10</span> : Brooks et al. RARcrit <span class="hljs-keyword">for</span> T &gt; <span class="hljs-number">-15</span> <span class="hljs-function"><span class="hljs-keyword">using</span> <span class="hljs-title">saund2</span> (<span class="hljs-params">otherwise same <span class="hljs-keyword">as</span> isaund=<span class="hljs-number">2</span></span>) (<span class="hljs-params"><span class="hljs-keyword">set</span> rarfac to negative <span class="hljs-keyword">in</span> saund2</span>)</span><br>                                     = <span class="hljs-number">11</span> : Brooks et al. RARcrit <span class="hljs-keyword">for</span> T &gt; <span class="hljs-number">-15</span> <span class="hljs-function"><span class="hljs-keyword">using</span> <span class="hljs-title">saund6</span> (<span class="hljs-params">otherwise same <span class="hljs-keyword">as</span> isaund=<span class="hljs-number">4</span></span>)</span><br>                                     = <span class="hljs-number">12</span> : Brooks et al. RARcrit <span class="hljs-keyword">for</span> T &gt; <span class="hljs-number">-15</span> <span class="hljs-function"><span class="hljs-keyword">using</span> <span class="hljs-title">saund6</span> (<span class="hljs-params">otherwise same <span class="hljs-keyword">as</span> isaund=<span class="hljs-number">9</span></span>) (<span class="hljs-params">DEFAULT</span>)</span><br>                                     = <span class="hljs-number">13</span> : Brooks et al. RARcrit <span class="hljs-keyword">for</span> T &gt; <span class="hljs-number">-15</span> <span class="hljs-function"><span class="hljs-keyword">using</span> <span class="hljs-title">saund8</span> (<span class="hljs-params">cosine roll-off function <span class="hljs-keyword">for</span> smoother approach to zero at low temperature</span>)</span><br><span class="hljs-function">                                   For <span class="hljs-title">Takahashi</span> (<span class="hljs-params"><span class="hljs-number">1978</span>, <span class="hljs-number">1984</span></span>) charge <span class="hljs-title">separation</span> (<span class="hljs-params">see below</span>)</span><br>                                     = <span class="hljs-number">1</span> : Takahashi <span class="hljs-number">1984</span> <span class="hljs-keyword">with</span> factors <span class="hljs-keyword">for</span> crystal size <span class="hljs-keyword">and</span> impact speed<br>                                     = <span class="hljs-number">3</span> : Takahashi <span class="hljs-number">1984</span> WITHOUT factors <span class="hljs-keyword">for</span> crystal size <span class="hljs-keyword">and</span> impact speed<br><br><br> nssl_lightrad                       = <span class="hljs-number">12000</span>, radius (m) of discharge cylinder <span class="hljs-keyword">for</span> <span class="hljs-number">1</span>-D discharge scheme<br><br> nssl_disfrac                        = <span class="hljs-number">0.3</span>, <span class="hljs-function">nominal fraction of charge removed per <span class="hljs-title">discharge</span> (<span class="hljs-params"><span class="hljs-keyword">for</span> <span class="hljs-number">1</span>D lightning</span>)</span><br><span class="hljs-function"></span><br><span class="hljs-function"> nssl_ecrit</span>                          = <span class="hljs-number">120000</span>, <span class="hljs-function">breakdown electric <span class="hljs-title">field</span> (<span class="hljs-params">Volts/m</span>) to initiate <span class="hljs-title">lightning</span> (<span class="hljs-params">i.e., constant <span class="hljs-keyword">value</span> <span class="hljs-keyword">with</span> height</span>). (<span class="hljs-params"><span class="hljs-keyword">for</span> nssl_ibrkd=<span class="hljs-number">1</span></span>)</span><br><span class="hljs-function"></span><br><span class="hljs-function"> 3D discharge namelist options</span><br><span class="hljs-function"> NSSL_EINTERNAL</span>  =   <span class="hljs-number">200.0000</span>  : <span class="hljs-function"><span class="hljs-keyword">internal</span> field <span class="hljs-keyword">for</span> channel <span class="hljs-title">resistance</span> (<span class="hljs-params">V/m</span>)</span><br><span class="hljs-function"> NSSL_TGRND</span>      =   <span class="hljs-number">266.1600</span>  : Temperature threshold <span class="hljs-keyword">for</span> considering CG flash<br> NSSL_ZGRND      =  <span class="hljs-number">-1.000000</span>  : <span class="hljs-function">Altitude threshold <span class="hljs-keyword">for</span> considering CG <span class="hljs-title">flash</span> (<span class="hljs-params">only <span class="hljs-keyword">if</span> &gt; <span class="hljs-number">0</span>, otherwise uses temperature</span>)</span><br><span class="hljs-function"></span><br><span class="hljs-function">The <span class="hljs-title">Takahashi</span> (<span class="hljs-params"><span class="hljs-number">1978</span>, <span class="hljs-number">1984</span></span>) charge separation requires a lookup table to be read <span class="hljs-keyword">in</span>. </span><br><span class="hljs-function">The table file <span class="hljs-keyword">is</span> &#x27;takahashi.txt&#x27; <span class="hljs-keyword">and</span> needs to be copied <span class="hljs-keyword">from</span> WRF/elec to the working </span><br><span class="hljs-function">directory. To use <span class="hljs-keyword">this</span> option, the NSSL microphysics can read an <span class="hljs-keyword">internal</span> namelist, </span><br><span class="hljs-function">which needs &#x27;nonigrd</span> = <span class="hljs-number">-1&#x27;</span>:<br><br>&amp;nssl_mp_params<br>  nonigrd = <span class="hljs-number">-1</span><br>/<br><br>Also <span class="hljs-keyword">set</span> the <span class="hljs-keyword">value</span> nssl_isaund=<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure>
<h2 id="output-fields">Output fields</h2>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver"><span class="hljs-number">2</span>D, <span class="hljs-built_in">time</span>-dependent:<br><br>  LIGHT      : Sum <span class="hljs-keyword">of</span> lightning initations <span class="hljs-keyword">in</span> <span class="hljs-keyword">the</span> column (For <span class="hljs-number">1</span>D discharge, this counts all points that <br>                 have electric field magnitude that exceeds <span class="hljs-keyword">the</span> initiation threshold<br>  LIGHTDENS  : Flash extent density (FED; <span class="hljs-built_in">sum</span> <span class="hljs-keyword">of</span> <span class="hljs-keyword">the</span> <span class="hljs-built_in">number</span> <span class="hljs-keyword">of</span> flashes that extend <span class="hljs-keyword">into</span> <span class="hljs-keyword">the</span> grid column)<br>  LIGHTDIS   : A kind <span class="hljs-keyword">of</span> <span class="hljs-string">&quot;source point&quot;</span> density that adds up <span class="hljs-keyword">the</span> <span class="hljs-built_in">number</span> <span class="hljs-keyword">of</span> points <span class="hljs-keyword">in</span> <span class="hljs-keyword">a</span> column where<br>                 lightning charge is deposited<br>  rscghis_2d : column <span class="hljs-built_in">sum</span> <span class="hljs-keyword">of</span> charge separation (magnitude) over <span class="hljs-keyword">the</span> history interval<br><br>  For <span class="hljs-number">3</span>D lightning:<br><br>   flshfedic - FED <span class="hljs-built_in">from</span> IC flashes<br>   flshfedicp - FED <span class="hljs-built_in">from</span> IC flashes (pos. channels)<br>   flshfedicn - FED <span class="hljs-built_in">from</span> IC flashes (neg. channels)<br>   flshfedcg - FED <span class="hljs-built_in">from</span> CG flashes<br>   flshfedcgp - FED <span class="hljs-built_in">from</span> CG flashes (pos. channels)<br>   flshfedcgn - FED <span class="hljs-built_in">from</span> CG flashes (neg. channels)<br>   <br><span class="hljs-number">3</span>D, <span class="hljs-built_in">time</span>-dependent:<br><br>  POT         : Electric potential (Volts)<br>  ELECMAG     : Electric field magnitude (V/m)<br>  ELECX       : x-component <span class="hljs-keyword">of</span> E (V/m)<br>  ELECY       : y-component <span class="hljs-keyword">of</span> E (V/m)<br>  ELECZ       : z-component <span class="hljs-keyword">of</span> E (V/m)<br>  INDUC       : Inductive charge separation rate (C m^<span class="hljs-number">-3</span> s^<span class="hljs-number">-1</span>)<br>  NONINDUC    : Net noninductive charge separation rate (C m^<span class="hljs-number">-3</span> s^<span class="hljs-number">-1</span>)<br>  SCW         : Charge density carried <span class="hljs-keyword">by</span> cloud droplets (C/kg, i.e., <span class="hljs-string">&#x27;charge mixing ratio&#x27;</span>)<br>  SCR         : Charge density carried <span class="hljs-keyword">by</span> rain (C/kg)<br>  SCI         : Charge density carried <span class="hljs-keyword">by</span> cloud ice (C/kg)<br>  SCS         : Charge density carried <span class="hljs-keyword">by</span> snow (C/kg)<br>  SCH         : Charge density carried <span class="hljs-keyword">by</span> graupel (C/kg)<br>  SCHL        : Charge density carried <span class="hljs-keyword">by</span> hail (C/kg)<br>  SCTOT       : Net charge density (C m^<span class="hljs-number">-3</span>) Is NOT mixing ratio<br>  SCIONA      : Residual charge <span class="hljs-built_in">from</span> lightning <span class="hljs-keyword">and</span> evaporating hydrometeors that has <span class="hljs-keyword">not</span> been reattached <span class="hljs-built_in">to</span> another species (C/kg)<br><br>  For <span class="hljs-number">3</span>D lightning:<br>    FLSHN, FLSHP : Negative/positive <span class="hljs-string">&quot;channel&quot;</span> points<br>    FLSHI : Flash initiation points<br></code></pre></td></tr></table></figure>
<h2 id="sourceforege">sourceforege</h2>
<p><a target="_blank" rel="noopener" href="https://sourceforge.net/projects/wrfelec/files/" class="uri">https://sourceforge.net/projects/wrfelec/files/</a></p>
<p>Source: README.wrfelec, updated 2015-05-04</p>
<h1 id="compilation-process-details">Compilation process details</h1>
<ul>
<li>BoxMG directory: /home/wpsze/WRF/WRF4-elec/wrf_install/boxmg4wrf/</li>
</ul>
<div class="note note-danger">
            <p>Important note:<br />Compile WRF using <strong>only one core</strong> with BoxMG !!!<br />./compile -j 1 em_real 2&gt;&amp;1 | tee compile.log</p>
          </div>
<p>part of script is shown below,</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">export</span> WRF_ELEC=1<br><span class="hljs-built_in">export</span> BOXMGLIBDIR=/home/wpsze/WRF/WRF4-elec/wrf_install/boxmg4wrf<br><br><span class="hljs-built_in">cd</span> wrf4-elec/<br><br>./clean -a<br>./configure <br><span class="hljs-comment">##  9 (dmpar) GNU [gfortran/gcc]</span><br><br>sed -i <span class="hljs-string">&quot;s/\s\stime\s//g&quot;</span> configure.wrf<br>./compile -j 1 em_real 2&gt;&amp;1 | <span class="hljs-built_in">tee</span> compile.log<br></code></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><code class="hljs sh">checking <span class="hljs-keyword">for</span> perl5... no<br>checking <span class="hljs-keyword">for</span> perl... found /usr/bin/perl (perl)<br>Will use NETCDF <span class="hljs-keyword">in</span> <span class="hljs-built_in">dir</span>: /home/wpsze/WRF/WRFv440/Library/<br>ADIOS2 not <span class="hljs-built_in">set</span> <span class="hljs-keyword">in</span> environment. Will configure WRF <span class="hljs-keyword">for</span> use without.<br>Will use HDF5 <span class="hljs-keyword">in</span> <span class="hljs-built_in">dir</span>: /home/wpsze/WRF/WRFv440/Library/<br>PHDF5 not <span class="hljs-built_in">set</span> <span class="hljs-keyword">in</span> environment. Will configure WRF <span class="hljs-keyword">for</span> use without.<br>Building WRF with electrification option<br>!-DWRF_ELEC=1<br>Will use BoxMG <span class="hljs-keyword">in</span> <span class="hljs-built_in">dir</span>: /home/wpsze/WRF/WRF4-elec/wrf_install/boxmg4wrf/<br>Will use <span class="hljs-string">&#x27;time&#x27;</span> to report timing information<br><span class="hljs-built_in">set</span> sw_boxmg_path<br>WRF_ELEC was found <span class="hljs-keyword">in</span>  -DWRF_ELEC=1<br><span class="hljs-variable">$JASPERLIB</span> or <span class="hljs-variable">$JASPERINC</span> not found <span class="hljs-keyword">in</span> environment, configuring to build without grib2 I/O...<br>------------------------------------------------------------------------<br>Please <span class="hljs-keyword">select</span> from among the following Linux x86_64 options:<br><br>  1. (dmpar)   PGI (pgf90/gcc)<br>  2. (dmpar)   PGI (pgf90/pgcc): SGI MPT<br>  3. (dmpar)   PGI (pgf90/gcc): PGI accelerator<br>  4. (dmpar)   INTEL (ifort/icc)<br>               INTEL (ifort/icc): Xeon Phi (MIC architecture)<br>  5. (dmpar)   INTEL (ifort/icc): Xeon (SNB with AVX mods)<br>  6. (dmpar)   INTEL (ifort/icc): SGI MPT<br>  7. (dmpar)   INTEL (ifort/icc): IBM POE<br>  8. (dmpar)   PATHSCALE (pathf90/pathcc)<br>  9. (dmpar)   GNU (gfortran/gcc)<br> 1.  (dmpar)   IBM (xlf90_r/cc_r)<br> 2.  (dmpar)   PGI (ftn/gcc): Cray XC CLE<br> 3.  (dmpar)   CRAY CCE (ftn $(NOOMP)/cc): Cray XE and XC<br> 4.  (dmpar)   INTEL (ftn/icc): Cray XC<br> 5.  (dmpar)   PGI (pgf90/pgcc)<br> 6.  (dmpar)   PGI (pgf90/gcc): -f90=pgf90<br> 7.  (dmpar)   PGI (pgf90/pgcc): -f90=pgf90<br> 8.  (dmpar)   INTEL (ifort/icc): HSW/BDW<br> 9.  (dmpar)   INTEL (ifort/icc): KNL MIC<br> 10. (dmpar)   AMD (flang/clang) :  AMD ZEN1/ ZEN2/ ZEN3 Architectures<br> 11. (dmpar)   FUJITSU (frtpx/fccpx): FX10/FX100 SPARC64 IXfx/Xlfx<br><br>Enter selection [1-20] : 9<br><br>......<br><br><span class="hljs-comment">######################</span><br>------------------------------------------------------------------------<br>Settings listed above are written to configure.wrf.<br>If you wish to change settings, please edit that file.<br>If you wish to change the default options, edit the file:<br>     <span class="hljs-built_in">arch</span>/configure.defaults<br>NetCDF <span class="hljs-built_in">users</span> note:<br> This installation of NetCDF supports large file support.  To DISABLE large file<br> support <span class="hljs-keyword">in</span> NetCDF, <span class="hljs-built_in">set</span> the environment variable WRFIO_NCD_NO_LARGE_FILE_SUPPORT<br> to 1 and run configure again. Set to any other value to avoid this message.<br>  <br><br>Testing <span class="hljs-keyword">for</span> NetCDF, C and Fortran compiler<br><br>This installation of NetCDF is 64-bit<br>                 C compiler is 64-bit<br>           Fortran compiler is 64-bit<br>              It will build <span class="hljs-keyword">in</span> 64-bit<br> <br>NetCDF version: 4.7.4<br>Enabled NetCDF-4/HDF-5: <span class="hljs-built_in">yes</span><br>NetCDF built with PnetCDF: no<br></code></pre></td></tr></table></figure>
<p>there is an extra folder called "elec",</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh"> $ <span class="hljs-built_in">ls</span> wrf4-elec/elec/<br>binwrf.pl                           module_discharge.F<br>depend.elec                         module_discharge_msz.F<br>include_microphysics_driver_elec.F  module_mp_nssl_2mom_elec.F<br>include_solve_lightningnudge.F      module_nudge_light.F<br>Makefile                            module_screen.F<br>module_boxmgsetup.F                 takahashi.txt<br>module_commasmpi.F<br></code></pre></td></tr></table></figure>
<h1 id="compile-errors">Compile Errors</h1>
<ol type="1">
<li>Error NoahMP submodule files not populating WRF directories.
<ol type="1">
<li><a href="https://waipangsze.github.io/2024/06/04/WRF_install_Error_NoahMP_submodule_files/" class="uri">https://waipangsze.github.io/2024/06/04/WRF_install_Error_NoahMP_submodule_files/</a></li>
<li>Download noahmp @ xxxx folder to your local /WRF/phys/</li>
<li>wrf4-elec is noahmp @ 3be0b28</li>
</ol></li>
<li>time No such file or directory.
<ol type="1">
<li><a href="https://waipangsze.github.io/2024/05/29/WRF_install_time_error/" class="uri">https://waipangsze.github.io/2024/05/29/WRF_install_time_error/</a></li>
</ol></li>
</ol>
<h1 id="done">Done</h1>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sh">---&gt;                  Executables successfully built                  &lt;---<br> <br>-rwxrwxr-x 1 wpsze wpsze 44236440 Sep 24 14:26 main/ndown.exe<br>-rwxrwxr-x 1 wpsze wpsze 44121776 Sep 24 14:26 main/real.exe<br>-rwxrwxr-x 1 wpsze wpsze 43532016 Sep 24 14:26 main/tc.exe<br>-rwxrwxr-x 1 wpsze wpsze 50585304 Sep 24 14:25 main/wrf.exe<br><br> $ <span class="hljs-built_in">ls</span> run/*exe<br>run/ndown.exe  run/real.exe  run/tc.exe  run/wrf.ex<br></code></pre></td></tr></table></figure>
<h1 id="wrf-elec-outputs">WRF-ELEC outputs</h1>
<p>It is important to note that the FOD and reflectivity are derived from ELEC, whereas the LPI originates from WRF-ARW simulations.</p>
<h2 id="simulated-radar-reflectivity">simulated radar reflectivity</h2>
<p>radar reflectivity is diagnosed.</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://wrf-python.readthedocs.io/en/latest/user_api/generated/wrf.dbz.html" class="uri">https://wrf-python.readthedocs.io/en/latest/user_api/generated/wrf.dbz.html</a></li>
<li>This function computes equivalent reflectivity factor [dBZ] at each model grid point assuming spherical particles of constant density, with exponential size distributions. This function is based on “dbzcalc.f” in RIP.</li>
</ul>
<p>or on namelist,</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">&amp;physics<br>...<br>do_radar_ref = 0, 	; 1 = allows radar reflectivity to be computed using mp-scheme-specific parameters.  Currently works <span class="hljs-keyword">for</span> mp_physics = 2,4,6,7,8,10,14,16<br></code></pre></td></tr></table></figure>
<p>with do_radar_reflectivity=1 and after running got the REFL_10cm variable. But this variable REFL_10cm is giving the estimated 10 cm wavelength (S-band) radar reflectivity in dB relative to reflectivity (dBZ) as produced by the WRF microphysics scheme.</p>
<blockquote>
<p>but, above mp_physics = 17 or 18?</p>
</blockquote>
<h2 id="lightning_option-from-wrf-arw">lightning_option (from WRF-ARW)</h2>
<p>Lightning parameterization option to allow flash rate prediction without chemistry.</p>
<p><a target="_blank" rel="noopener" href="https://ruc.noaa.gov/wrf/wrf-chem/Users_guide.pdf">WRF-Chem Version 4.4 User's Guide: Appendix C: Using the Lightning-NOx Parameterization in WRF-Chem</a></p>
<div class="note note-primary">
            <p>(for convection resolved runs; must also use do_radar_ref = 1, and mp_physics = 2,4,6,7,8,10,14, or 16)</p>
          </div>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">lightning_option (max_dom)                       Lightning parameterization <span class="hljs-keyword">option</span> <span class="hljs-keyword">to</span> allow flash rate prediction <span class="hljs-keyword">without</span> chemistry<br>                                    = <span class="hljs-number">0</span>        ! <span class="hljs-keyword">off</span><br>                                    = <span class="hljs-number">1</span>        ! PR92 based <span class="hljs-keyword">on</span> maximum w, redistributes flashes <span class="hljs-keyword">within</span> dBZ &gt; <span class="hljs-number">20</span> (<span class="hljs-keyword">for</span> convection resolved runs; must <span class="hljs-keyword">also</span> use <br>                     do_radar_ref = <span class="hljs-number">1</span>, <span class="hljs-keyword">and</span> mp_physics = <span class="hljs-number">2</span>,<span class="hljs-number">4</span>,<span class="hljs-number">6</span>,<span class="hljs-number">7</span>,<span class="hljs-number">8</span>,<span class="hljs-number">10</span>,<span class="hljs-number">14</span>, <span class="hljs-keyword">or</span> <span class="hljs-number">16</span>)<br>                                    = <span class="hljs-number">2</span>        ! PR92 based <span class="hljs-keyword">on</span> <span class="hljs-number">20</span> dBZ top, redistributes flashes <span class="hljs-keyword">within</span> dBZ &gt; <span class="hljs-number">20</span> (<span class="hljs-keyword">for</span> convection resolved runs; must <span class="hljs-keyword">also</span> use <br>                     do_radar_ref = <span class="hljs-number">1</span>, <span class="hljs-keyword">and</span> mp_physics = <span class="hljs-number">2</span>,<span class="hljs-number">4</span>,<span class="hljs-number">6</span>,<span class="hljs-number">7</span>,<span class="hljs-number">8</span>,<span class="hljs-number">10</span>,<span class="hljs-number">14</span>, <span class="hljs-keyword">or</span> <span class="hljs-number">16</span>)<br>                                    = <span class="hljs-number">3</span>        ! Predicting the potential <span class="hljs-keyword">for</span> lightning activity (based <span class="hljs-keyword">on</span> Yair et al, <span class="hljs-number">2010</span>, J. Geophys. Res., <span class="hljs-number">115</span>, D04205, doi:<span class="hljs-number">10.1029</span>/<span class="hljs-number">2008</span>JD010868) <br>                                    = <span class="hljs-number">11</span>       ! PR92 based <span class="hljs-keyword">on</span> <span class="hljs-keyword">level</span> <span class="hljs-keyword">of</span> neutral buoyancy <span class="hljs-keyword">from</span> convective parameterization (<span class="hljs-keyword">for</span> scales<br>                                                <span class="hljs-keyword">where</span> a CPS <span class="hljs-keyword">is</span> used, intended <span class="hljs-keyword">for</span> use at <span class="hljs-number">10</span> &lt; dx &lt; <span class="hljs-number">50</span> km; must <span class="hljs-keyword">also</span> use cu_physics = <span class="hljs-number">5</span> <span class="hljs-keyword">or</span> <span class="hljs-number">93</span>)<br>lightning_dt  (max_dom)             = <span class="hljs-number">0.</span>       ! <span class="hljs-type">time</span> <span class="hljs-type">interval</span> (seconds) <span class="hljs-keyword">for</span> calling lightning parameterization. <span class="hljs-keyword">Default</span> uses model <span class="hljs-type">time</span> step<br>lightning_start_seconds (max_dom)   = <span class="hljs-number">0.</span>       ! <span class="hljs-keyword">Start</span> <span class="hljs-type">time</span> <span class="hljs-keyword">for</span> calling lightning parameterization. Recommends at least <span class="hljs-number">10</span> minutes <span class="hljs-keyword">for</span> spin-up.<br>flashrate_factor  (max_dom)         = <span class="hljs-number">1.0</span>      ! Factor <span class="hljs-keyword">to</span> adjust the predicted number <span class="hljs-keyword">of</span> flashes. Recommends <span class="hljs-number">1.0</span> <span class="hljs-keyword">for</span> lightning_option = <span class="hljs-number">11</span><br>                                                <span class="hljs-keyword">between</span> dx=<span class="hljs-number">10</span> <span class="hljs-keyword">and</span> <span class="hljs-number">50</span> km. Manual tuning recommended <span class="hljs-keyword">for</span> <span class="hljs-keyword">all</span> other <span class="hljs-keyword">options</span> independently<br>                                                <span class="hljs-keyword">for</span> <span class="hljs-keyword">each</span> nest.<br>cellcount_method (max_dom)                       <span class="hljs-keyword">Method</span> <span class="hljs-keyword">for</span> counting storm cells. Used <span class="hljs-keyword">by</span> CRM <span class="hljs-keyword">options</span> (lightning_options=<span class="hljs-number">1</span>,<span class="hljs-number">2</span>).<br>                                    = <span class="hljs-number">0</span>,       ! model determines <span class="hljs-keyword">method</span> used<br>                                    = <span class="hljs-number">1</span>,       ! tile-wide, appropriate <span class="hljs-keyword">for</span> <span class="hljs-keyword">large</span> domains<br>                                    = <span class="hljs-number">2</span>,       ! <span class="hljs-keyword">domain</span>-wide, appropriate <span class="hljs-keyword">for</span> sing-storm domains<br>cldtop_adjustment (max_dom)         = <span class="hljs-number">0.</span>       ! Adjustment <span class="hljs-keyword">from</span> LNB <span class="hljs-keyword">in</span> km. Used <span class="hljs-keyword">by</span> lightning_option=<span class="hljs-number">11.</span> <span class="hljs-keyword">Default</span> <span class="hljs-keyword">is</span> <span class="hljs-number">0</span>, but recommends <span class="hljs-number">2</span> km<br>iccg_method (max_dom)                            IC:CG partitioning <span class="hljs-keyword">method</span> (IC: intra-cloud; CG: cloud-<span class="hljs-keyword">to</span>-ground)<br>                                    = <span class="hljs-number">0</span>        ! <span class="hljs-keyword">Default</span> <span class="hljs-keyword">method</span> depending <span class="hljs-keyword">on</span> lightning <span class="hljs-keyword">option</span>, currently <span class="hljs-keyword">all</span> <span class="hljs-keyword">options</span> use iccg_method=<span class="hljs-number">2</span> <span class="hljs-keyword">by</span> default<br>                                    = <span class="hljs-number">1</span>        ! <span class="hljs-keyword">Constant</span> everywhere, <span class="hljs-keyword">set</span> <span class="hljs-keyword">with</span> namelist <span class="hljs-keyword">options</span> iccg_prescribed (num|den)#, <span class="hljs-keyword">default</span> <span class="hljs-keyword">is</span> <span class="hljs-number">0.</span>/<span class="hljs-number">1.</span> (<span class="hljs-keyword">all</span> CG).<br>                                    = <span class="hljs-number">2</span>        ! Coarsely prescribed <span class="hljs-number">1995</span><span class="hljs-number">-1999</span> NLDN/OTD climatology based <span class="hljs-keyword">on</span> Boccippio et al. (<span class="hljs-number">2001</span>)<br>                                    = <span class="hljs-number">3</span>        ! Parameterization <span class="hljs-keyword">by</span> Price <span class="hljs-keyword">and</span> Rind (<span class="hljs-number">1993</span>) based <span class="hljs-keyword">on</span> cold-cloud depth<br>                                    = <span class="hljs-number">4</span>        ! Gridded <span class="hljs-keyword">input</span> via arrays iccg_in_(num|den) <span class="hljs-keyword">from</span> wrfinput <span class="hljs-keyword">for</span> monthly mapped ratios. <br>                                                Points <span class="hljs-keyword">with</span> <span class="hljs-number">0</span>/<span class="hljs-number">0</span> <span class="hljs-keyword">values</span> use ratio defined <span class="hljs-keyword">by</span> iccg_prescribed_(num|den)<br>iccg_prescribed_num (max_dom)       = <span class="hljs-number">0.</span>       ! Numerator <span class="hljs-keyword">of</span> <span class="hljs-keyword">user</span>-specified prescribed IC:CG<br>iccg_prescribed_den (max_dom)       = <span class="hljs-number">1.</span>       ! Denominator <span class="hljs-keyword">of</span> <span class="hljs-keyword">user</span>-specified prescribed IC:CG<br>ltng_temp_upper                     = <span class="hljs-number">-45.</span>     ! Temperature (C) <span class="hljs-keyword">of</span> upper peak <span class="hljs-keyword">of</span> LNOx vertical distribution <span class="hljs-keyword">for</span> IC lightning (used <span class="hljs-keyword">by</span> &amp;chem lnox_opt=<span class="hljs-number">2</span>).<br>ltng_temp_lower                     = <span class="hljs-number">-15.</span>     ! Temperatures (C) <span class="hljs-keyword">of</span> lower peak <span class="hljs-keyword">of</span> LNOx vertical distribution <span class="hljs-keyword">for</span> <span class="hljs-keyword">both</span> IC <span class="hljs-keyword">and</span> CG lightning (used <span class="hljs-keyword">by</span> &amp;chem lnox_opt=<span class="hljs-number">2</span>).<br></code></pre></td></tr></table></figure>
<p>From WRF-MPAS-A forum,</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://forum.mmm.ucar.edu/threads/wrf-lightning-scheme-only-being-run-at-model-output-times.16207/#post-40290">WRF lightning scheme only being run at model output times?</a></li>
<li><a target="_blank" rel="noopener" href="https://forum.mmm.ucar.edu/threads/lightning-option.13017/#post-31892">Lightning option</a></li>
<li><a target="_blank" rel="noopener" href="https://forum.mmm.ucar.edu/threads/large-differences-of-simulated-fields-u-v-w-t-with-lightning_option-3-lpi-on-and-off.9338/#post-22147">Large differences of simulated fields (U, V, W, T) with lightning_option = 3 (LPI) on and off</a>
<ul>
<li>An alternative is to calculate the LPI from the model output. This can be done quite simply using an NCL program.</li>
</ul></li>
</ul>
<p>From <a target="_blank" rel="noopener" href="https://groups.google.com/a/ucar.edu/g/wrf-chem-lightning/c/v6nIeyL7G2g" class="uri">https://groups.google.com/a/ucar.edu/g/wrf-chem-lightning/c/v6nIeyL7G2g</a>,</p>
<div class="note note-primary">
            <p>The lightning option = 1 you chose is appropriate for dx&lt;5km because it relies on the maximum updraft speed in the storm updraft. You chose dx=10km which will not produce updraft speeds representative of thunderstorms, and in fact the storms are likely represented by the convective parameterization.</p><p>For dx=10 km, you should use lightning_option = 11.</p>
          </div>
<h2 id="lightlightdenselectric-potential-difference-pot-from-wrf-elec">light/lightdens/Electric POTential difference (POT) (From WRF-ELEC)</h2>
<p>Starting with the electrification processes (inductive and non-inductive processes), calculation method of the electric field, along with the BoxMG mathematical software for computation of POT is described.</p>
<figure>
<img src="https://i.imgur.com/kgs4meR.png" srcset="/img/loading.gif" lazyload alt="WRF-ELEC" /><figcaption>WRF-ELEC</figcaption>
</figure>
<h1 id="what-is-the-time-interval-in-lightflash-column-1">What is the time interval in light(flash column-1)?</h1>
<p><a target="_blank" rel="noopener" href="https://github.com/MicroTed/wrf4-elec/blob/7c90e71bdc4db527d0ec034804e4fd200cdacf28/phys/module_microphysics_driver.F#L117" class="uri">https://github.com/MicroTed/wrf4-elec/blob/7c90e71bdc4db527d0ec034804e4fd200cdacf28/phys/module_microphysics_driver.F#L117</a></p>
<p>!--light 2D flash origin densities per output time !--lightdens 2D flash extent densities per output time !--lightdis 2D total number of discharge points per output time</p>
<ul>
<li>per output time?
<ul>
<li>To find the number of flashes between output times, simply subtract the flashcount array from the previous output time from the current output time to get number of flashes per dt (where64dt = time between output files).</li>
</ul></li>
</ul>
<p>From <a target="_blank" rel="noopener" href="https://github.com/MicroTed/wrf4-elec/blob/7c90e71bdc4db527d0ec034804e4fd200cdacf28/dyn_em/solve_em.F#L157">solve_em.F</a>, <strong>diag_flag and diag_flag_hist</strong> are</p>
<ul>
<li>Set diagnostic flag value <strong>history output time</strong></li>
</ul>
<figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs fortran"><span class="hljs-comment">!-----------------------------------------------------------------------------</span><br><span class="hljs-comment">!</span><br><span class="hljs-comment">! Set restart flag value history output time</span><br><span class="hljs-comment">!-----------------------------------------------------------------------------</span><br>   restart_flag = <span class="hljs-literal">.false.</span><br>   <span class="hljs-keyword">if</span> ( Is_alarm_tstep(grid%domain_clock, grid%alarms(restart_alarm)) ) <span class="hljs-keyword">then</span><br>      restart_flag = <span class="hljs-literal">.true.</span><br>   <span class="hljs-keyword">endif</span><br><span class="hljs-comment">!</span><br><span class="hljs-comment">! Set diagnostic flag value history output time</span><br><span class="hljs-comment">!-----------------------------------------------------------------------------</span><br><br>   ke_diag = kms <span class="hljs-comment">! default to ke_diag=1 in case of nwp_diagnostics == 1</span><br>   diag_flag = <span class="hljs-literal">.false.</span><br>   <span class="hljs-keyword">if</span> ( Is_alarm_tstep(grid%domain_clock, grid%alarms(HISTORY_ALARM)) ) <span class="hljs-keyword">then</span><br>      diag_flag = <span class="hljs-literal">.true.</span><br>      ke_diag = <span class="hljs-built_in">min</span>(k_end,kde-<span class="hljs-number">1</span>) <span class="hljs-comment">! set depth to full domain for reflectivity field</span><br>   <span class="hljs-keyword">endif</span><br>   diag_flag_hist = diag_flag<br></code></pre></td></tr></table></figure>
<ul>
<li>In <a target="_blank" rel="noopener" href="https://github.com/MicroTed/wrf4-elec/blob/7c90e71bdc4db527d0ec034804e4fd200cdacf28/elec/include_microphysics_driver_elec.F#L24">include_microphysics_driver_elec.F</a>,
<ul>
<li>diag_flag_hist</li>
<li>clear_history = .true.</li>
<li>all set = 0.0</li>
</ul></li>
</ul>
<figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs fortran"><span class="hljs-comment">! this sets the clear flag for the next time step if a history dump is occurring now</span><br><span class="hljs-keyword">IF</span> ( diag_flag_hist ) <span class="hljs-keyword">THEN</span><br>   clear_history = <span class="hljs-literal">.true.</span><br><span class="hljs-keyword">ENDIF</span><br><br><span class="hljs-comment">!    add up flashes up to history dump </span><br><br><span class="hljs-comment">!     if (MOD(NINT(curr_secs),history_interval*60).eq.0) then</span><br><span class="hljs-keyword">IF</span> ( clear_history ) <span class="hljs-keyword">THEN</span><br>   clear_history = <span class="hljs-literal">.false.</span><br><span class="hljs-comment">!      write(0,*) &#x27;clear arrays&#x27;</span><br>light(:,:) = <span class="hljs-number">0.</span><br>lightdis(:,:) = <span class="hljs-number">0.</span><br>lightdens(:,:) = <span class="hljs-number">0.</span><br>induc(:,:,:) = <span class="hljs-number">0.0</span><br>noninduc(:,:,:) = <span class="hljs-number">0.0</span><br>   <span class="hljs-keyword">IF</span> ( idischarge == <span class="hljs-number">1</span> ) <span class="hljs-keyword">THEN</span><br>   lightfod(:,:) = <span class="hljs-number">0.</span><br>   ELSEIF ( idischarge &gt;= <span class="hljs-number">2</span> ) <span class="hljs-keyword">THEN</span><br>   flshfedic(:,:) = <span class="hljs-number">0.</span><br>   flshfedicp(:,:) = <span class="hljs-number">0.</span><br>   flshfedicn(:,:) = <span class="hljs-number">0.</span><br>   flshfedcg(:,:) = <span class="hljs-number">0.</span><br>   flshfedcgp(:,:) = <span class="hljs-number">0.</span><br>   flshfedcgn(:,:) = <span class="hljs-number">0.</span><br>   flshi(:,:,:) = <span class="hljs-number">0.</span><br>   flshn(:,:,:) = <span class="hljs-number">0.</span><br>   flshp(:,:,:) = <span class="hljs-number">0.</span><br>   <span class="hljs-keyword">ENDIF</span><br></code></pre></td></tr></table></figure>
<h1 id="wrf-practice">WRF practice</h1>
<table>

<thead>
<tr class="header">
<th style="text-align: left;">option</th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">elec_physics</td>
<td style="text-align: left;">= 0, electrification (and charge arrays) turned off (DEFAULT) <br> = 1, electrification turned on (only works with mp_physics = 17, 18, or 22 i.e., 2-moment NSSL schemes)</td>
</tr>
<tr class="even">
<td style="text-align: left;">nssl_ipelec (max_dom)</td>
<td style="text-align: left;">! NOTE: only set this to a nonzero value on the innermost domain <br> = 0, charging turned off <br> = 2, non-inductive charging only <br> = 3, non-inductive + inductive charging <br> = 1, not used (reserved for future use)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">nssl_idischarge</td>
<td style="text-align: left;"><br> = 0, no discharge <br> = 1, Cylindrical "1D" lightning scheme based on Ziegler and MacGorman (1994, JAS) <br> = 2, 3D discrete discharge adapted from MacGorman et al. (2001)</td>
</tr>
</tbody>
</table>
<ul>
<li>The WRF-ELEC model outputs a variety of variables related to electrification processes and lightning activity in thunderstorms. Some of the key output variables include:</li>
</ul>
<table>

<thead>
<tr class="header">
<th>WRF-ELEC variables</th>
<th>Unit</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>LIGHT(Time, south_north, west_east)</td>
<td>flash origin density</td>
<td>lightning flash initiations</td>
</tr>
<tr class="even">
<td>LIGHTDENS(Time, south_north, west_east)</td>
<td>flash column-1</td>
<td>lightning flash density</td>
</tr>
<tr class="odd">
<td>LIGHTFOD(Time, south_north, west_east)</td>
<td>flash column-1</td>
<td>normalized lightning flash origin density</td>
</tr>
<tr class="even">
<td>LIGHTDIS(Time, south_north, west_east)</td>
<td>Source column-1</td>
<td>lightning source density</td>
</tr>
<tr class="odd">
<td>POT(Time, bottom_top, south_north, west_east)</td>
<td>V</td>
<td>POTENTIAL</td>
</tr>
<tr class="even">
<td>ELECMAG(Time, bottom_top, south_north, west_east)</td>
<td>V m-1</td>
<td>EFIELD MAGNITUDE</td>
</tr>
<tr class="odd">
<td>ELECX(Time, bottom_top, south_north, west_east)</td>
<td>V m-1</td>
<td>EFIELD X-Component</td>
</tr>
<tr class="even">
<td>ELECY(Time, bottom_top, south_north, west_east)</td>
<td>V m-1</td>
<td>EFIELD Y-Component</td>
</tr>
<tr class="odd">
<td>ELECZ(Time, bottom_top, south_north, west_east)</td>
<td>V m-1</td>
<td>EFIELD Z-Component</td>
</tr>
<tr class="even">
<td>SCTOT(Time, bottom_top, south_north, west_east)</td>
<td>C m-3</td>
<td>Total Space Charge Density</td>
</tr>
<tr class="odd">
<td>RSCGHIS_2D(Time, south_north, west_east)</td>
<td>C m-2</td>
<td>MAX NONINDUCTIVE CHARGING 2D</td>
</tr>
<tr class="even">
<td>INDUC(Time, bottom_top, south_north, west_east)</td>
<td>C m-3</td>
<td>TOTAL INDUCTIVE CHARGING</td>
</tr>
<tr class="odd">
<td>NONINDUC(Time, bottom_top, south_north, west_east)</td>
<td>C m-3</td>
<td>TOTAL NONINDUCTIVE CHARGING</td>
</tr>
<tr class="even">
<td>SCTOT(Time, bottom_top, south_north, west_east)</td>
<td>C m-3</td>
<td>Total Space Charge Density</td>
</tr>
</tbody>
</table>
<ul>
<li>If the lightning discharge flag (nssl_idischarge = 2) that is lightning3d, More output variables include: (LIGHTFOD is not calculated)</li>
</ul>
<table>

<thead>
<tr class="header">
<th>WRF-ELEC variables</th>
<th>Unit</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>FLSHFEDIC(Time, south_north, west_east)</td>
<td>flash column-1</td>
<td>IC lightning flash extent density</td>
</tr>
<tr class="even">
<td>FLSHFEDICP(Time, south_north, west_east)</td>
<td>flash column-1</td>
<td>IC pos lightning flash extent density</td>
</tr>
<tr class="odd">
<td>FLSHFEDICN(Time, south_north, west_east)</td>
<td>flash column-1</td>
<td>IC neg lightning flash extent density</td>
</tr>
<tr class="even">
<td>FLSHFEDCG(Time, south_north, west_east)</td>
<td>flash column-1</td>
<td>CG lightning flash extent density</td>
</tr>
<tr class="odd">
<td>FLSHFEDCGN(Time, south_north, west_east)</td>
<td>flash column-1</td>
<td>CG neg lightning flash extent density</td>
</tr>
<tr class="even">
<td>FLSHFEDCGP(Time, south_north, west_east)</td>
<td>flash column-1</td>
<td>CG pos lightning flash extent density</td>
</tr>
<tr class="odd">
<td>FLSHI(Time, bottom_top, south_north, west_east)</td>
<td>count</td>
<td>Lightning init points</td>
</tr>
<tr class="even">
<td>FLSHN(Time, bottom_top, south_north, west_east)</td>
<td>count</td>
<td>Negative channels</td>
</tr>
<tr class="odd">
<td>FLSHP(Time, bottom_top, south_north, west_east)</td>
<td>count</td>
<td>Positive channels</td>
</tr>
</tbody>
</table>
<h1 id="cost-elapsed-time">Cost: Elapsed time</h1>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">WRF-ELEC</th>
<th style="text-align: left;">mp</th>
<th style="text-align: left;">idischarge</th>
<th style="text-align: left;">Elapsed time</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">elec=0</td>
<td style="text-align: left;">17</td>
<td style="text-align: left;">none</td>
<td style="text-align: left;">4h49m</td>
</tr>
<tr class="even">
<td style="text-align: left;">elec=1</td>
<td style="text-align: left;">17</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">6h13m</td>
</tr>
<tr class="odd">
<td style="text-align: left;">elec=1</td>
<td style="text-align: left;">17</td>
<td style="text-align: left;">2</td>
<td style="text-align: left;">9h1m</td>
</tr>
</tbody>
</table>
<p>WRFv4.5-ELEC.</p>
<h1 id="literature-review">Literature review</h1>
<p>Lightning activity is related to two important factors: dynamic–thermodynamic and microphysical characteristics (e.g., Williams et al., 2005; Rosenfeld et al., 2008; Guo et al., 2016; Wang et al., 2018; Zhao et al., 2020). Since the dynamic–thermodynamic processes affect the development of thunderstorm significantly, lightning activity is influenced by various dynamic–thermodynamic variables: temperature (Price, 1993), relative humidity in the lower and middle troposphere (Xiong et al., 2006; Fan et al., 2007), convective available potential energy (Qie et al., 2004; Stolz et al., 2015), and many others.</p>
<h2 id="pr92">(1992) PR92</h2>
<blockquote>
<p>Price, C., and D. Rind (1992), A Simple Lightning Parameterization for Calculating Global Lightning Distributions, J. Geophys. Res., 97(D9), 9919-9933, doi:10.1029/92JD00719.<br />
Wong, J., M. Barth, and D. Noone, 2013: Evaluating a lightning parameterization based on cloud-top height for mesoscale numerical model simulations, Geosci. Model Dev., 6, 429–443, GMD - Evaluating a lightning parameterization based on cloud-top height for mesoscale numerical model simulations.</p>
</blockquote>
<p>ref: <a target="_blank" rel="noopener" href="https://ruc.noaa.gov/wrf/wrf-chem/Users_guide.pdf">WRF-Chem Version 4.4 User's Guide: Appendix C: Using the Lightning-NOx Parameterization in WRF-Chem</a></p>
<p>You may also find useful information in the actual code for the schemes:</p>
<ul>
<li>module_lightning_driver.F</li>
<li>module_ltng_crmpr92.F</li>
</ul>
<h2 id="prediction-of-lightning-flash-density-with-the-wrf-model">(2010) Prediction of lightning flash density with the WRF model</h2>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://pdfs.semanticscholar.org/a206/1d033ccf90082c05a1514df4920005035c0b.pdf" class="uri">https://pdfs.semanticscholar.org/a206/1d033ccf90082c05a1514df4920005035c0b.pdf</a><br />
Lynn, B., and Yoav Yair. "Prediction of lightning flash density with the WRF model." Advances in Geosciences 23 (2010): 11-16.</p>
</blockquote>
<p>The <strong>Lightning Potential Index (LPI)</strong> is a measure of the potential for charge generation and separation that leads to lightning flashes in convective thunderstorms. It is calculated from model simulated updraft and microphysical fields. It was designed to predict the potential of lightning occurrence in operational weather forecasting models, but could possibly be used to improve short-range forecasts of heavy rain. <strong>The index is modified here to be model grid-scale transparent between 1 and 4 km (the approximate upper limit of explicit microphysical weather forecasts)</strong>. Two case studies show that the modification appears to work quite well, and that LPI can be calculated on both an extremely high resolution research-grid (i.e., 1.33 km) and high resolution (i.e., 4 km) operationally compatible forecast grid. Analytical expressions are presented to use the LPI to predict the hourly lightning flash density.</p>
<h2 id="fierro-et-al.">(2013) Fierro et al.</h2>
<blockquote>
<p>Fierro, A. O., Mansell, E. R., MacGorman, D. R., &amp; Ziegler, C. L. (2013). The implementation of an explicit charging and discharge lightning scheme within the WRF-ARW model: Benchmark simulations of a continental squall line, a tropical cyclone, and a winter storm. Monthly Weather Review, 141(7), 2390-2415.</p>
</blockquote>
<p>This work describes the recent implementation of explicit lightning physics within the Weather Research and Forecasting (WRF) Model.</p>
<ul>
<li>Charging of hydrometeors consists of five distinct noninductive parameterizations, polarization of cloud water, and the exchange of charge during collisional mass transfer.</li>
<li>The three components of the ambient electric field are explicitly solved for via the computationally efficient multigrid elliptic solver.</li>
<li>The discharge process employs concepts adapted from two well-documented bulk lightning models, whereby charge reduction is imposed within a prescribed volume centered at grid points characterized by electric field magnitudes exceeding a given breakdown threshold.</li>
</ul>
<p>This lightning model was evaluated through benchmark</p>
<ul>
<li>convection-allowing (3 km) model simulations of three contrasting convective systems: a continental squall line,</li>
<li>a major hurricane (Rita 2005), and</li>
<li>a winter storm.</li>
</ul>
<p>The areal coverage and magnitude of the simulated hourly flash origin density (FOD) for the continental squall line are qualitatively comparable to that of the total lightning data observations from Earth Networks Total Lightning Network (ENTLN). In agreement with the ENTLN observations, no FOD are simulated for the winter storm case. The simulated spatial FOD pattern of the hurricane and the eyewall gross charge structure were both in reasonable agreement with observations. The simulated FOD for all three cases were also evaluated against those obtained with the recently developed McCaul diagnostic lightning prediction schemes and exhibited overall good qualitative agreement with each other for Rita and the continental squall line.</p>
<h2 id="thunderstorm-indices-lpi-layrh-scp">Thunderstorm Indices (LPI, Layrh, SCP)</h2>
<p><strong>Thunderstorm Indices (LPI, Layrh, SCP)</strong> obtained from IMD-WRF (3km) Hourly outputs.</p>
<ul>
<li>Model GEFS - WRF Description</li>
<li><a target="_blank" rel="noopener" href="https://srf.tropmet.res.in/srf/ts_prediction_system/lpi_model.php" class="uri">https://srf.tropmet.res.in/srf/ts_prediction_system/lpi_model.php</a></li>
<li><strong>Lightning Potential Index (LPI)</strong>
<ul>
<li>Here, LPI has been calculated using IMD-WRF (3km) hourly model output. 24 Hour accumulated LPI has been generated by adding hourly LPI values. The threat of LPI has been categorized in Low, Moderate and High. LOW: LPI &lt; 0.001 and &gt;0.0005; Moderate: LPI :&lt; 0.01 and &gt; 0.001; Threat Level: High: LPI &gt; 0.01.</li>
</ul></li>
<li><strong>SuperCell Composite Parameter (SCP)</strong>
<ul>
<li>SCP &gt; 1 indicated that the environment is conducive for thunderstorm formation. The Threat Level of SCP has been categorized in Low, Moderate and High. LOW: 3 &lt; SCP &lt; 5; Moderate: 5 &lt; SCP &lt; 7; High: SCP &gt; 7.</li>
</ul></li>
<li><strong>Layer Relative Humidity (LAYRH)</strong>
<ul>
<li>The threat level of Layrh has been categorized in Low, Moderate and High. LOW: 20 &lt; LAYRH &lt; 40; Moderate: 40 &lt; LAYRH &lt; 60; High : LAYRH &gt; 60</li>
</ul></li>
</ul>
<h2 id="numerical-study-of-performance-of-two-lightning-prediction-methods-based-on-lightning-potential-index-lpi-and-electric-potential-difference-pot-over-tehran-area">(2019) Numerical study of performance of two lightning prediction methods based on: Lightning Potential Index (LPI) and electric POTential difference (POT) over Tehran area</h2>
<blockquote>
<p><strong>Gharaylou, M., Farahani, M. M., Hosseini, M., &amp; Mahmoudian, A. (2019). Numerical study of performance of two lightning prediction methods based on: Lightning Potential Index (LPI) and electric POTential difference (POT) over Tehran area</strong>. Journal of Atmospheric and Solar-Terrestrial Physics, 193, 105067.</p>
</blockquote>
<p>The electric POTential difference (POT) and the Lightning Potential Index (LPI) performance in predicting the lightning activity is investigated and the probable relationship between them is examined. These two indices have a similar dependency on microphysical variables such as ice, graupel mixing ratios, and also updraft characteristics within the cloud. Regardless of this similarity, the LPI directly calculated from WRF model is a more favorable parameter for predicting the lightning events in comparison with the POT, which requires an extra package (ELEC) model. Ten years' available data over the Tehran area were reviewed and four thundercloud cases with distinct characteristics (CAPE, time-frequency, intensity) were selected. In order to acquire the associated physical properties, four simulations have been done using the WRF-ELEC model, which is initialized with ERA-Interim data.</p>
<h2 id="prediction-of-lightning-activity-using-wrf-elec-model">**(2020) Prediction of lightning activity using WRF-ELEC model</h2>
<blockquote>
<p><strong>Gharaylou, M., Farahani, M. M., Mahmoudian, A., &amp; Hosseini, M. (2020). Prediction of lightning activity using WRF-ELEC model: Impact of initial and boundary conditions</strong>. Journal of Atmospheric and Solar-Terrestrial Physics, 210, 105438.</p>
</blockquote>
<blockquote>
<ul>
<li><a target="_blank" rel="noopener" href="https://sci-hub.se/https://doi.org/10.1016/j.jastp.2020.105438" class="uri">https://sci-hub.se/https://doi.org/10.1016/j.jastp.2020.105438</a></li>
</ul>
</blockquote>
<ul>
<li>The WRF model belongs to the first group in which lightning is predicted based on the <strong>Bulk Lightning Model (BLM)</strong>. Ziegler and MacGorman (1994) have studied lightning flashes in a twoand three-dimensional cloud models using the WRF model.</li>
<li>In the early 90s, Price and Rind (1992) developed a lightning parameterization scheme based on <strong>cloud-top height</strong>.</li>
<li>Furthermore, another lightning flash parameterization scheme has been introduced by Allen and Pickering (2002) and Allan et al. (2010) based on the <strong>square of deep convective mass flux</strong>.</li>
<li>Choi et al. (2005) and Zhao et al. (2009) incorporated the <strong>convective available potential energy (CAPE)</strong> in their comparative parameterizations.</li>
<li>Yair et al. (2010) introduced <strong>Lightning Potential Index (LPI)</strong>, an advanced index for evaluating the probability of lightning occurrence, incorporated the dynamic and microphysic concepts.</li>
<li>Following, Lynn et al. (2012) introduced the <strong>potential electrical energy (Ep) parameter</strong> into the WRF model, which was used to predict both <strong>Cloud-to-Ground (CG)</strong> and <strong>Intra-Cloud (IC)</strong> <em>lightning events</em>.</li>
<li>Afterwards, Wong et al. (2013) developed the lightning parameterization based on cloud-top height (Price and Rind, 1992).</li>
<li>Gharaylou et al. (2019) examined 2 indices which are used in predicting the lightning activities both in time and location. They compared the <strong>electric potential difference (POT)</strong> and the <strong>LPI</strong> performance in predicting the lightning associated with four events over a domain located in the north of Iran.</li>
<li><strong>The LPI is computationally less expensive and is directly calculated by the WRF model with less computational cost in comparison with the POT which requires an extra package (ELEC model).</strong>
<ul>
<li>LPI calculations have been discussed in our previous paper (Gharaylou et al., 2019)</li>
</ul></li>
</ul>
<h3 id="effect-of-initial-and-boundary-conditions-ibcs">Effect of Initial and boundary conditions (IBCs)</h3>
<ul>
<li>The mesoscale models ordinarily obtain their initial and boundary conditions (IBCs) from large scale global models. <strong>Applying different initial conditions highly influences the accuracy of the model prediction in local areas</strong> (Zhang et al., 2002, 2006).</li>
<li>A few works have been done to investigate the effect of initial conditions on lightning activity (Lynn et al., 2012).</li>
<li>Zepka et al. (2014) studied the impact of the resolution of the NCEP operational Global Forecast System.</li>
<li>As mentioned, <strong><em>there are very few works</em></strong> related to the assessment of IBC effects in the WRF-ELEC model for lightning prediction.
<ul>
<li>WRF-ELEC model initialized with different datasets needs to be verified.</li>
</ul></li>
</ul>
<h1 id="case-hong-kong-lightning">Case: Hong Kong Lightning</h1>
<p>The "Hong Kong Observatory Lightning Statistics" refers to the detailed records of lightning activity in the Hong Kong region, primarily categorized into cloud-to-ground lightning and intra-cloud lightning. This data not only aids in understanding meteorological patterns but also enhances awareness of the safety risks associated with lightning strikes.</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.hko.gov.hk/tc/wservice/tsheet/llis.htm">香港天文台閃電位置資訊服務 HKO Lightning Location Information Service</a></li>
</ul>
<figure>
<img src="https://www.hko.gov.hk/tc/wservice/tsheet/images/fact2c.jpg" srcset="/img/loading.gif" lazyload alt="閃電定位網絡各個探測站的位置分佈圖/Distribution of lightning sensor stations of the lightning location network" /><figcaption>閃電定位網絡各個探測站的位置分佈圖/Distribution of lightning sensor stations of the lightning location network</figcaption>
</figure>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.hko.gov.hk/en/wxinfo/llis/llis_map.htm">Lightning density map for Hong Kong</a></li>
</ul>
<figure>
<img src="https://www.hko.gov.hk/en/wxinfo/llis/images/ll_density_e.png" srcset="/img/loading.gif" lazyload alt="Average yearly number of cloud-to-ground lightning strokes per square kilometer" /><figcaption>Average yearly number of cloud-to-ground lightning strokes per square kilometer</figcaption>
</figure>
<ul>
<li><a target="_blank" rel="noopener" href="https://maps.weather.gov.hk/ocf/index_uc.html?data=ncln">閃電（試驗版） | 香港及珠江三角洲區域自動分區天氣預報/Automatic regional weather forecast in Hong Kong and the Pearl River Delta region</a></li>
</ul>
<h2 id="statistics-of-lightning-days-at-the-hko-weather-station">Statistics of lightning days at the HKO Weather Station</h2>
<figure>
<img src="../../../../figures/2024-09-20-wrf4-elec-lightning/Statistics_of_lightning_days_at_the_HKO_Weather_Station.png" srcset="/img/loading.gif" lazyload alt="Statistics of lightning days at the HKO Weather Station (Last updated: August 31, 2024). From i-lens.hk" /><figcaption>Statistics of lightning days at the HKO Weather Station (Last updated: August 31, 2024). From <a target="_blank" rel="noopener" href="https://i-lens.hk/hkweather/special_stat.php?event=LIGHTING_DAY&amp;station=HKO">i-lens.hk</a></figcaption>
</figure>
<h2 id="all-weather-stations---ranking-of-highest-daily-total-lightning-counts-in-history">All Weather Stations - Ranking of Highest Daily Total Lightning Counts in History</h2>
<p>From <a target="_blank" rel="noopener" href="https://i-lens.hk/hkweather/rank.php?station=ALL&amp;element=L_BOTH&amp;type=MAX&amp;year=&amp;month=">i-lens.hk</a>, Last updated: August 31, 2024</p>
<table>

<thead>
<tr class="header">
<th style="text-align: center;">Ranking</th>
<th style="text-align: center;">Weather Station</th>
<th style="text-align: center;">Start observation year</th>
<th style="text-align: center;">Observation date</th>
<th style="text-align: center;">Total number of lightning strikes per day (times)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">1</td>
<td style="text-align: center;">Hong Kong Observatory</td>
<td style="text-align: center;">2005</td>
<td style="text-align: center;">2020-06-06</td>
<td style="text-align: center;">47537</td>
</tr>
<tr class="even">
<td style="text-align: center;">2</td>
<td style="text-align: center;">Hong Kong Observatory</td>
<td style="text-align: center;">2005</td>
<td style="text-align: center;">2020-06-07</td>
<td style="text-align: center;">41446</td>
</tr>
<tr class="odd">
<td style="text-align: center;">3</td>
<td style="text-align: center;">Hong Kong Observatory</td>
<td style="text-align: center;">2005</td>
<td style="text-align: center;">2019-04-20</td>
<td style="text-align: center;">36299</td>
</tr>
<tr class="even">
<td style="text-align: center;">4</td>
<td style="text-align: center;">Hong Kong Observatory</td>
<td style="text-align: center;">2005</td>
<td style="text-align: center;">2023-06-01</td>
<td style="text-align: center;">36253</td>
</tr>
<tr class="odd">
<td style="text-align: center;">5</td>
<td style="text-align: center;">Hong Kong Observatory</td>
<td style="text-align: center;">2005</td>
<td style="text-align: center;">2024-04-30</td>
<td style="text-align: center;">32603</td>
</tr>
<tr class="even">
<td style="text-align: center;">6</td>
<td style="text-align: center;">Hong Kong Observatory</td>
<td style="text-align: center;">2005</td>
<td style="text-align: center;">2021-06-28</td>
<td style="text-align: center;">31859</td>
</tr>
<tr class="odd">
<td style="text-align: center;">7</td>
<td style="text-align: center;">Hong Kong Observatory</td>
<td style="text-align: center;">2005</td>
<td style="text-align: center;">2019-08-25</td>
<td style="text-align: center;">24951</td>
</tr>
<tr class="even">
<td style="text-align: center;">8</td>
<td style="text-align: center;">Hong Kong Observatory</td>
<td style="text-align: center;">2005</td>
<td style="text-align: center;">2019-04-19</td>
<td style="text-align: center;">22053</td>
</tr>
<tr class="odd">
<td style="text-align: center;">9</td>
<td style="text-align: center;">Hong Kong Observatory</td>
<td style="text-align: center;">2005</td>
<td style="text-align: center;">2018-08-22</td>
<td style="text-align: center;">21152</td>
</tr>
<tr class="even">
<td style="text-align: center;">10</td>
<td style="text-align: center;">Hong Kong Observatory</td>
<td style="text-align: center;">2005</td>
<td style="text-align: center;">2022-07-30</td>
<td style="text-align: center;">20187</td>
</tr>
<tr class="odd">
<td style="text-align: center;">11</td>
<td style="text-align: center;">Hong Kong Observatory</td>
<td style="text-align: center;">2005</td>
<td style="text-align: center;">2019-06-13</td>
<td style="text-align: center;">19526</td>
</tr>
<tr class="even">
<td style="text-align: center;">12</td>
<td style="text-align: center;">Hong Kong Observatory</td>
<td style="text-align: center;">2005</td>
<td style="text-align: center;">2010-09-09</td>
<td style="text-align: center;">18813</td>
</tr>
<tr class="odd">
<td style="text-align: center;">13</td>
<td style="text-align: center;">Hong Kong Observatory</td>
<td style="text-align: center;">2005</td>
<td style="text-align: center;">2013-05-22</td>
<td style="text-align: center;">18568</td>
</tr>
<tr class="even">
<td style="text-align: center;">14</td>
<td style="text-align: center;">Hong Kong Observatory</td>
<td style="text-align: center;">2005</td>
<td style="text-align: center;">2020-09-15</td>
<td style="text-align: center;">17879</td>
</tr>
<tr class="odd">
<td style="text-align: center;">15</td>
<td style="text-align: center;">Hong Kong Observatory</td>
<td style="text-align: center;">2005</td>
<td style="text-align: center;">2020-05-30</td>
<td style="text-align: center;">17765</td>
</tr>
<tr class="even">
<td style="text-align: center;">16</td>
<td style="text-align: center;">Hong Kong Observatory</td>
<td style="text-align: center;">2005</td>
<td style="text-align: center;">2006-06-09</td>
<td style="text-align: center;">17587</td>
</tr>
<tr class="odd">
<td style="text-align: center;">17</td>
<td style="text-align: center;">Hong Kong Observatory</td>
<td style="text-align: center;">2005</td>
<td style="text-align: center;">2014-03-30</td>
<td style="text-align: center;">16823</td>
</tr>
<tr class="even">
<td style="text-align: center;">18</td>
<td style="text-align: center;">Hong Kong Observatory</td>
<td style="text-align: center;">2005</td>
<td style="text-align: center;">2024-04-26</td>
<td style="text-align: center;">16328</td>
</tr>
<tr class="odd">
<td style="text-align: center;">19</td>
<td style="text-align: center;">Hong Kong Observatory</td>
<td style="text-align: center;">2005</td>
<td style="text-align: center;">2010-09-08</td>
<td style="text-align: center;">14659</td>
</tr>
<tr class="even">
<td style="text-align: center;">20</td>
<td style="text-align: center;">Hong Kong Observatory</td>
<td style="text-align: center;">2005</td>
<td style="text-align: center;">2023-04-21</td>
<td style="text-align: center;">14471</td>
</tr>
</tbody>
</table>
<h2 id="overview-of-climate-change-effects">Overview of Climate Change Effects</h2>
<p>Climate change, driven by the increase in greenhouse gases, has a profound impact on weather patterns. As global temperatures rise, more energy is available in the atmosphere, which intensifies convective storms. Since lightning is primarily a product of such storms, the increase in the frequency and intensity of these storms can lead to changes in lightning activity.</p>
<ul>
<li><strong>Increase Per Degree of Warming:</strong> Across the continental United States (CONUS), the CAPE × P proxy predicts a 12 ± 5% rise in lightning strike rates for each 1°C increase in global mean temperature (Romps et al., 2014). This research suggests that as the planet warms, lightning frequency will likely increase. A 12% rise in lightning activity is anticipated for every degree of warming, which could result in a 50% increase in lightning strikes in regions like the U.S. by the end of the century (Romps et al., 2014; Romps, 2021).</li>
<li><strong>Specific Regional Studies:</strong> Focused on the South China Sea (SCS) and surrounding regions in Southeast Asia to analyze long-term trends and future projections of lightning activity using the longest available satellite-based lightning dataset and climate models. The projections indicate that lightning activity in the SCS region is expected to increase by 10% under SSP245 and by 12% under SSP370 by the end of the 21st century. (Xu et al., 2023; Xu et al., 2024)</li>
<li><strong>Impact of Global Warming on Future Lightning Events</strong>
<ul>
<li>The IPCC AR6 defines several Shared Socioeconomic Pathways (SSPs) that describe possible future climate scenarios based on different levels of greenhouse gas emissions. (e.g., SSP5-8.5: Very high emissions, with warming over 4.4°C)</li>
</ul></li>
<li><strong>Regional Studies on Future Lightning Events (e.g., South China Sea)</strong></li>
</ul>
<p>From these papers,</p>
<ul>
<li>Romps, D. M., Seeley, J. T., Vollaro, D., &amp; Molinari, J. (2014). Projected increase in lightning strikes in the United States due to global warming. Science, 346(6211), 851-854.</li>
<li>Romps, D. M. (2019). Evaluating the future of lightning in cloud‐resolving models. Geophysical Research Letters, 46(24), 14863-14871.</li>
<li>Xu, L., Cao, X., Lan, X., Zhang, W., Sun, C., &amp; Zhang, Y. (2024). Future increase in lightning around the South China Sea under climate change. Earth and Space Science, 11(6), e2023EA003356.</li>
<li>Xu, Mingyi, et al. "Distribution of lightning spatial modes and climatic causes in China." Atmospheric and Oceanic Science Letters 16.2 (2023): 100338.</li>
</ul>
<h1 id="references">References</h1>
<ol type="1">
<li>香港天文台
<ol type="1">
<li><a target="_blank" rel="noopener" href="https://www.hko.gov.hk/tc/education/weather/thunderstorm-and-lightning/00031-what-are-thunderstorms.html">什麼是雷暴？</a></li>
<li><a target="_blank" rel="noopener" href="https://www.hko.gov.hk/tc/publica/reprint/files/r622.pdf">2006-Reprint 622-探討閃電位置數據應用在臨近預報的前景</a></li>
<li><a target="_blank" rel="noopener" href="https://www.weather.gov.hk/tc/publica/reprint/files/r817a.pdf">2009-Reprint 817-香港一次夏季雹暴的天氣過程分析及臨近預報系統的應用</a></li>
<li><a target="_blank" rel="noopener" href="https://www.weather.gov.hk/en/publica/reprint/files/r1035.pdf">2012-Reprint 1035-利用閃電數據監測暴雨發展的個案分析</a></li>
<li><a target="_blank" rel="noopener" href="https://www.hko.gov.hk/tc/whatsnew/r1_wn20170531.htm">2017 天文台加強閃電定位資訊系統投入業務運作</a></li>
<li><a target="_blank" rel="noopener" href="https://www.hko.gov.hk/en/publica/reprint/files/r1337.pdf">2018-Reprint 1337-粵港澳閃電定位網絡的最新發展及與超強颱風天鴿相關之數據分析</a></li>
<li><a target="_blank" rel="noopener" href="https://www.hko.gov.hk/tc/publica/reprint/files/r1341.pdf">2018-Reprint 1341-公眾定點閃電臨近預報服務</a></li>
<li><a target="_blank" rel="noopener" href="https://www.hko.gov.hk/en/publica/reprint/files/r1358.pdf">2019-Reprint 1358-區域與全球閃電定位資料於珠三角地區的精細化比對</a></li>
<li><a target="_blank" rel="noopener" href="https://www.hko.gov.hk/tc/publica/ghm_21/files/HPaper_WongCP.pdf">2020-在珠三角一帶與大雨相關的閃電特徵分析</a></li>
</ol></li>
<li><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/yuzCZB2Nb5CydG3WCysK_w">世界气候“雷极”：印度尼西亚爪哇岛，平均年雷雨日数超过220天</a></li>
<li>徐良韬, 张义军, 王飞, 郑栋. 2012: 雷暴起电和放电物理过程在WRF模式中的耦合及初步检验. 大气科学, 36(5): 1041-1052. DOI: 10.3878/j.issn.1006-9895.2012.11235
<ol type="1">
<li>WRFv3.2.1</li>
<li>本文将雷暴云的起电、放电物理过程引入中尺度的WRF (Weather Research and Forecasting) 模式,并对超级单体和飑线过程进行了模拟研究.起电过程在Milbrandt双参数微物理方案中写入,包含霰、雹与冰晶、雪之间的非感应起电机制,以及霰、雹与云滴之间的感应起电机制.</li>
</ol></li>
<li>徐良韬, 陈双, 姚雯, 等. 利用起放电模式开展闪电活动的直接预报试验. 应用气象学报, 2018, 29(5): 534-545. DOI: 10.11898/1001-7313.20180503.
<ol type="1">
<li>WRFv3.4.1</li>
<li>利用耦合有起电和放电物理过程的中尺度起电放电模式WRF-Electric</li>
</ol></li>
<li>Wasson, G., &amp; Panda, S. K. (2024). Sensitivity of PBL parameterization schemes in simulating lightning and thunderstorm using WRF-ELEC model. Climate Dynamics, 1-23.
<ol type="1">
<li>The WRF-ELEC model, an auxiliary package integrated into WRF, is specifically designed to compute electric potential and overall lightning flash rate (source: <a target="_blank" rel="noopener" href="https://sourceforge.net/projects/wrfelec" class="uri">https://sourceforge.net/projects/wrfelec</a>).</li>
<li>It incorporates explicit cloudresolving scale physics for lightning prediction (<a target="_blank" rel="noopener" href="https://scholar.google.com/scholar_url?url=https://journals.ametsoc.org/view/journals/mwre/141/7/mwr-d-12-00278.1.xml%3Ftab_body%3Dpdf&amp;hl=en&amp;sa=T&amp;oi=gsr-r-ggp&amp;ct=res&amp;cd=0&amp;d=6841908713848986342&amp;ei=DTHtZqfdAfSC6rQP2qO70AU&amp;scisig=AFWwaeaoJDdXALkuhsn44g0xEyU5">Fierro et al.2013</a>). Detailed formulations can be found in <a target="_blank" rel="noopener" href="https://scholar.google.com/scholar_url?url=https://agupubs.onlinelibrary.wiley.com/doi/abs/10.1029/2004jd005287&amp;hl=en&amp;sa=T&amp;oi=gsr-r&amp;ct=res&amp;cd=0&amp;d=13100036974408530565&amp;ei=JTHtZs_QIeqs6rQPw4y2sAM&amp;scisig=AFWwaeZ27Z0oFR35ZZvLDk-yrgo_">Mansell et al.(2005)</a> and <a target="_blank" rel="noopener" href="https://scholar.google.com/scholar_url?url=https://journals.ametsoc.org/view/journals/mwre/141/7/mwr-d-12-00278.1.xml%3Ftab_body%3Dpdf&amp;hl=en&amp;sa=T&amp;oi=gsr-r-ggp&amp;ct=res&amp;cd=0&amp;d=6841908713848986342&amp;ei=OTHtZtytGPay6rQPxrKeiAM&amp;scisig=AFWwaeaoJDdXALkuhsn44g0xEyU5">Fierro et al. (2013)</a>.</li>
<li>skill scores were calculated for each experiment.
<ol type="1">
<li>standard statistics and skill score analysis of CAPE (J/kg) and accumulated total precipitation (mm),</li>
</ol></li>
</ol></li>
<li>Saleh, N., Gharaylou, M., Farahani,M. M., &amp; Alizadeh, O. (2023).Performance of lightning potentialindex, lightning threat index, and theproduct of CAPE and precipitationin the WRF model. Earth and SpaceScience, 10, e2023EA003104. <a target="_blank" rel="noopener" href="https://doi.org/10.1029/2023EA003104" class="uri">https://doi.org/10.1029/2023EA003104</a></li>
<li><a target="_blank" rel="noopener" href="https://weather.ndc.nasa.gov/sport/training/lfa/LFAtraining_20111025.pdf">2011: Lightning Forecast Algorithm (LFA) Overview</a></li>
</ol>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/WRF/" class="category-chain-item">WRF</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/WRF-ELEC/" class="print-no-link">#WRF-ELEC</a>
      
        <a href="/tags/Lightning/" class="print-no-link">#Lightning</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>WRF | Predicting lightning activity using WRF-ELEC model</div>
      <div>https://waipangsze.github.io/2024/09/20/wrf4-elec-lightning/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>Author</div>
          <div>wpsze</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>Posted on</div>
          <div>September 20, 2024</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>Updated on</div>
          <div>October 22, 2024</div>
        </div>
      
      
        <div class="license-meta-item">
          <div>Licensed under</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - Attribution">
                    <i class="iconfont icon-cc-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2024/09/21/Singularity-Container/" title="Singularity Container">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">Singularity Container</span>
                        <span class="visible-mobile">Previous</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2024/09/13/Hexo/" title="Setting up Hexo Blog on github.io">
                        <span class="hidden-mobile">Setting up Hexo Blog on github.io</span>
                        <span class="visible-mobile">Next</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>Table of Contents</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  


  
  





  <script>
  Fluid.utils.createScript('https://lib.baomitu.com/mermaid/8.14.0/mermaid.min.js', function() {
    mermaid.initialize({"theme":"default"});

    Fluid.utils.listenDOMLoaded(function() {
      Fluid.events.registerRefreshCallback(function() {
        if ('mermaid' in window) {
          mermaid.init();
        }
      });
    });
  });
</script>






    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">Keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">

  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  

  <span id="sitetime"></span>
  <script language=javascript>
    function siteTime(){
      window.setTimeout("siteTime()", 1000);
      var seconds = 1000;
      var minutes = seconds * 60;
      var hours = minutes * 60;
      var days = hours * 24;
      var years = days * 365;
      var today = new Date();
      var todayYear = today.getFullYear();
      var todayMonth = today.getMonth()+1;
      var todayDate = today.getDate();
      var todayHour = today.getHours();
      var todayMinute = today.getMinutes();
      var todaySecond = today.getSeconds();
      /* Date.UTC() -- 返回date对象距世界标准时间(UTC)1970年1月1日午夜之间的毫秒数(时间戳)
      year - 作为date对象的年份，为4位年份值
      month - 0-11之间的整数，做为date对象的月份
      day - 1-31之间的整数，做为date对象的天数
      hours - 0(午夜24点)-23之间的整数，做为date对象的小时数
      minutes - 0-59之间的整数，做为date对象的分钟数
      seconds - 0-59之间的整数，做为date对象的秒数
      microseconds - 0-999之间的整数，做为date对象的毫秒数 */
      var t1 = Date.UTC(2023,04,23,00,00,00); //北京时间2018-2-13 00:00:00
      var t2 = Date.UTC(todayYear,todayMonth,todayDate,todayHour,todayMinute,todaySecond);
      var diff = t2-t1;
      var diffYears = Math.floor(diff/years);
      var diffDays = Math.floor((diff/days)-diffYears*365);
      var diffHours = Math.floor((diff-(diffYears*365+diffDays)*days)/hours);
      var diffMinutes = Math.floor((diff-(diffYears*365+diffDays)*days-diffHours*hours)/minutes);
      var diffSeconds = Math.floor((diff-(diffYears*365+diffDays)*days-diffHours*hours-diffMinutes*minutes)/seconds);
      /*document.getElementById("sitetime").innerHTML=" 已运行"+/*diffYears+" 年 "+*/diffDays+" 天 "+diffHours+" 小时 "+diffMinutes+" 分钟 "+diffSeconds+" 秒";
      document.getElementById("sitetime").innerHTML=" 已運行"+diffYears+" 年 "+diffDays+" 天 ";
    }/*因为建站时间还没有一年，就将之注释掉了。需要的可以取消*/
    siteTime();
  </script>
  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/5.0.0/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  
      <script>
        if (!window.MathJax) {
          window.MathJax = {
            tex    : {
              inlineMath: { '[+]': [['$', '$']] }
            },
            loader : {
              load: ['ui/lazy']
            },
            options: {
              renderActions: {
                insertedScript: [200, () => {
                  document.querySelectorAll('mjx-container').forEach(node => {
                    let target = node.parentNode;
                    if (target.nodeName.toLowerCase() === 'li') {
                      target.parentNode.classList.add('has-jax');
                    }
                  });
                }, '', false]
              }
            }
          };
        } else {
          MathJax.startup.document.state(0);
          MathJax.texReset();
          MathJax.typeset();
          MathJax.typesetPromise();
        }

        Fluid.events.registerRefreshCallback(function() {
          if ('MathJax' in window && MathJax.startup.document && typeof MathJax.startup.document.state === 'function') {
            MathJax.startup.document.state(0);
            MathJax.texReset();
            MathJax.typeset();
            MathJax.typesetPromise();
          }
        });
      </script>
    

  <script  src="https://lib.baomitu.com/mathjax/3.2.2/es5/tex-mml-chtml.js" ></script>

  <script  src="/js/local-search.js" ></script>

  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">Blog works best with JavaScript enabled</div>
  </noscript>
</body>
</html>
