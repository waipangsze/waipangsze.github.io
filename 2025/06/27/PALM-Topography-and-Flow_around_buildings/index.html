

<!DOCTYPE html>
<html lang="en" data-default-color-scheme=light>



<head>
  <meta charset="UTF-8">

  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="wpsze">
  <meta name="keywords" content="">
  
    <meta name="description" content="Exercise presentations  https:&#x2F;&#x2F;palm.muk.uni-hannover.de&#x2F;trac&#x2F;wiki&#x2F;doc&#x2F;tut&#x2F;palm#Exercisepresentations   E3: Flow around a cubical building Required lecture Required lectures:  Topography Non-cyclic bo">
<meta property="og:type" content="article">
<meta property="og:title" content="PALM | Topography and Flow_around_buildings">
<meta property="og:url" content="https://waipangsze.github.io/2025/06/27/PALM-Topography-and-Flow_around_buildings/index.html">
<meta property="og:site_name" content="wpsze">
<meta property="og:description" content="Exercise presentations  https:&#x2F;&#x2F;palm.muk.uni-hannover.de&#x2F;trac&#x2F;wiki&#x2F;doc&#x2F;tut&#x2F;palm#Exercisepresentations   E3: Flow around a cubical building Required lecture Required lectures:  Topography Non-cyclic bo">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://i.imgur.com/Unyeq0D.png">
<meta property="article:published_time" content="2025-06-27T03:00:00.000Z">
<meta property="article:modified_time" content="2025-07-11T06:53:53.157Z">
<meta property="article:author" content="wpsze">
<meta property="article:tag" content="MPAS">
<meta property="article:tag" content="NWP">
<meta property="article:tag" content="WRF">
<meta property="article:tag" content="Urban">
<meta property="article:tag" content="PALM">
<meta property="article:tag" content="LES">
<meta property="article:tag" content="Topography">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://i.imgur.com/Unyeq0D.png">
  
  
    <meta name="referrer" content="no-referrer-when-downgrade">
  
  
  <title>PALM | Topography and Flow_around_buildings - wpsze</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css">



<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"waipangsze.github.io","root":"/","version":"1.9.8","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"follow_dnt":true,"baidu":null,"google":{"measurement_id":"F7MK-FcxSomhtc1N3hIUDA"},"tencent":{"sid":null,"cid":null},"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false},"umami":{"src":null,"website_id":null,"domains":null,"start_time":"2024-01-01T00:00:00.000Z","token":null,"api_server":null}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  

  

  
    <!-- Google tag (gtag.js) -->
    <script async>
      if (!Fluid.ctx.dnt) {
        Fluid.utils.createScript("https://www.googletagmanager.com/gtag/js?id=F7MK-FcxSomhtc1N3hIUDA", function() {
          window.dataLayer = window.dataLayer || [];
          function gtag() {
            dataLayer.push(arguments);
          }
          gtag('js', new Date());
          gtag('config', 'F7MK-FcxSomhtc1N3hIUDA');
        });
      }
    </script>
  

  

  

  



  
<meta name="generator" content="Hexo 7.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>wpsze</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>Home</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>Archives</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>Categories</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>Tags</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/" target="_self">
                <i class="iconfont icon-link-fill"></i>
                <span>Links</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/bookmark/" target="_self">
                <i class="iconfont icon-bookmark"></i>
                <span>Bookmarks</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" target="_self" href="javascript:;" role="button"
                 data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <i class="iconfont icon-books"></i>
                <span>Docs</span>
              </a>
              <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                
                  
                  
                  
                  <a class="dropdown-item" href="/categories/Physics/" target="_self">
                    <i class="iconfont icon-plan"></i>
                    <span>Physics</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/categories/Maths/" target="_self">
                    <i class="iconfont icon-plan"></i>
                    <span>Maths</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/categories/CFD/" target="_self">
                    <i class="iconfont icon-plan"></i>
                    <span>CFD</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/categories/ML/" target="_self">
                    <i class="iconfont icon-plan"></i>
                    <span>ML</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/categories/Meteorology/" target="_self">
                    <i class="iconfont icon-plan"></i>
                    <span>Meteorology</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/categories/MPAS/" target="_self">
                    <i class="iconfont icon-plan"></i>
                    <span>MPAS</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/categories/PALM/" target="_self">
                    <i class="iconfont icon-plan"></i>
                    <span>PALM</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/monitor/" target="_self">
                    
                    <span>Real Time Monitoring</span>
                  </a>
                
              </div>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>About Me</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('https://i.imgur.com/Unyeq0D.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="PALM | Topography and Flow_around_buildings"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2025-06-27 11:00" pubdate>
          June 27, 2025 am
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          1.7k words
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          15 mins
        
      </span>
    

    
    
      
        <span id="busuanzi_container_page_pv" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="busuanzi_value_page_pv"></span> views
        </span>
        

      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">PALM | Topography and Flow_around_buildings</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="exercise-presentations">Exercise presentations</h1>
<ul>
<li><a target="_blank" rel="noopener" href="https://palm.muk.uni-hannover.de/trac/wiki/doc/tut/palm#Exercisepresentations" class="uri">https://palm.muk.uni-hannover.de/trac/wiki/doc/tut/palm#Exercisepresentations</a></li>
</ul>
<p><img src="https://i.imgur.com/vli06Jo.png" srcset="/img/loading.gif" lazyload /></p>
<h2 id="e3-flow-around-a-cubical-building">E3: Flow around a cubical building</h2>
<h3 id="required-lecture">Required lecture</h3>
<p>Required lectures:</p>
<ul>
<li>Topography</li>
<li>Non-cyclic boundary conditions</li>
<li>Restart runs</li>
</ul>
<p>Required files:</p>
<ul>
<li>Parameter file (<code>*_p3d</code>, <code>*_pcr</code>)
<ul>
<li>Input files can be downloaded from the supplementary material. Within the parameter files, some options are left blank (marked as “???”) and need to be filled in before starting the simulation.</li>
</ul></li>
<li>Topography file (<code>*_static</code>)</li>
</ul>
<h4 id="flow_around_cube_cyclic">flow_around_cube_cyclic</h4>
<ul>
<li>namelist file: <code>flow_around_cube_noncyclic_p3d</code>
<ul>
<li>set <code>topography</code> = <code>read_from_file</code></li>
</ul></li>
<li>topography file: <code>flow_around_cube_noncyclic_topo</code>
<ul>
<li>alternatively use provided python script to create <strong>static input file</strong> <code>flow_around_cube_noncyclic_static</code></li>
</ul></li>
<li>set <code>topography</code>
<ul>
<li><img src="https://i.imgur.com/ZgeuKkS.png" srcset="/img/loading.gif" lazyload /></li>
</ul></li>
</ul>
<div class="group-image-container"><div class="group-image-row"><div class="group-image-wrap"><img src="https://i.imgur.com/cVrBqQ5.png" srcset="/img/loading.gif" lazyload /></div><div class="group-image-wrap"><img src="https://i.imgur.com/71HGboz.png" srcset="/img/loading.gif" lazyload /></div></div><div class="group-image-row"><div class="group-image-wrap"><img src="https://i.imgur.com/sEDjfww.png" srcset="/img/loading.gif" lazyload /></div><div class="group-image-wrap"><img src="https://i.imgur.com/yCikg50.png" srcset="/img/loading.gif" lazyload /></div></div></div>
<h5 id="prapare-_static">Prapare <code>*_static</code></h5>
<p><img src="https://i.imgur.com/JFTbGlz.png" srcset="/img/loading.gif" lazyload /></p>
<ul>
<li><a target="_blank" rel="noopener" href="https://palm.muk.uni-hannover.de/trac/wiki/doc/app/iofiles/pids/static#topo" class="uri">https://palm.muk.uni-hannover.de/trac/wiki/doc/app/iofiles/pids/static#topo</a></li>
<li><a target="_blank" rel="noopener" href="https://palm.muk.uni-hannover.de/trac/wiki/doc/app/initialization_parameters#topography" class="uri">https://palm.muk.uni-hannover.de/trac/wiki/doc/app/initialization_parameters#topography</a></li>
<li><a target="_blank" rel="noopener" href="https://palm.muk.uni-hannover.de/trac/wiki/doc/app/iofiles#TOPOGRAPHY_DATA" class="uri">https://palm.muk.uni-hannover.de/trac/wiki/doc/app/iofiles#TOPOGRAPHY_DATA</a></li>
</ul>
<h5 id="my-toy-case">my toy case</h5>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python">......<br><span class="hljs-comment"># specify general grid parameters</span><br><span class="hljs-comment"># these values must equal those set in the initialization_parameters</span><br><span class="hljs-variable language_">self</span>.nx = <span class="hljs-number">245</span><br><span class="hljs-variable language_">self</span>.ny = <span class="hljs-number">83</span><br><span class="hljs-variable language_">self</span>.nz = <span class="hljs-number">80</span><br><span class="hljs-variable language_">self</span>.dx = <span class="hljs-number">2.0</span><br><span class="hljs-variable language_">self</span>.dy = <span class="hljs-number">2.0</span><br><span class="hljs-variable language_">self</span>.dz = <span class="hljs-number">2.0</span><br>......<br><span class="hljs-comment"># Set index ranges for buildings</span><br>build_inds_start_x = [ <span class="hljs-number">80</span>, <span class="hljs-number">120</span>, <span class="hljs-number">160</span> ]<br>build_inds_end_x   = [ <span class="hljs-number">99</span>, <span class="hljs-number">139</span>, <span class="hljs-number">179</span> ]<br><br>build_inds_start_y = [<span class="hljs-number">20</span>, <span class="hljs-number">50</span>] <span class="hljs-comment">#build_inds_start_x</span><br>build_inds_end_y   = [<span class="hljs-number">39</span>, <span class="hljs-number">69</span>] <span class="hljs-comment">#build_inds_end_x</span><br>......<br></code></pre></td></tr></table></figure>
<p><img src="https://i.imgur.com/HJTScbq.png" srcset="/img/loading.gif" lazyload width="400" /></p>
<h4 id="flow_around_cube_noncyclic">flow_around_cube_noncyclic</h4>
<h5 id="modify-_p3d-_pcr">Modify <code>*_p3d</code>, <code>*_pcr</code></h5>
<ul>
<li>namelist file: <code>flow_around_cube_noncyclic_p3d</code></li>
<li>topography file: <code>flow_around_cube_noncyclic_topo</code>
<ul>
<li>alternatively use provided python script to create <strong>static input file</strong> <code>flow_around_cube_noncyclic_static</code></li>
</ul></li>
</ul>
<ol type="1">
<li>psolver <a target="_blank" rel="noopener" href="https://palm.muk.uni-hannover.de/trac/wiki/doc/app/initialization_parameters#psolver">link</a>
<ol type="1">
<li>'poisfft'</li>
</ol></li>
<li>end_time
<ol type="1">
<li>9000.0</li>
</ol></li>
<li>Message: psolver = "poisfft" requires that boundary conditions along x and y are both either cyclic or non-cyclic
<ol type="1">
<li>'https://docs.palm-model.com/25.04/Reference/LES_Model/Logging/#PAC0077'</li>
<li>Description: Switch to <code>psolver = 'multigrid'</code> or set <code>bc_lr = bc_ns</code>.</li>
</ol></li>
</ol>
<h1 id="topography-dataset">Topography dataset</h1>
<h2 id="shuttle-radar-topography-mission-srtm-gl3-global-90m">Shuttle Radar Topography Mission (SRTM GL3) Global 90m</h2>
<ul>
<li><a target="_blank" rel="noopener" href="https://portal.opentopography.org/raster?opentopoID=OTSRTM.042013.4326.1" class="uri">https://portal.opentopography.org/raster?opentopoID=OTSRTM.042013.4326.1</a></li>
</ul>
<h2 id="香港-地形圖-geotiff-格式">香港 地形圖 (GeoTiff 格式)</h2>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.landsd.gov.hk/tc/spatial-data/open-data.html">開放數據（地理空間）</a></li>
<li><a target="_blank" rel="noopener" href="https://portal.csdi.gov.hk/geoportal/#metadataInfoPanel">香港1:50 000地形圖 (GeoTiff 格式)</a></li>
<li><a target="_blank" rel="noopener" href="https://portal.csdi.gov.hk/geoportal/#metadataInfoPanel">三維空間數據 3D-BIT00</a>
<ul>
<li>三維空間數據集由三種主要類型的地面物件組成，即建築物、基礎設施和地形。建築物模型分為第一細節層(L1)、第二細節層(L2)和第三細節層(L3)，以代表建築物的不同細節層次。</li>
</ul></li>
</ul>
<h3 id="digital-terrain-model-dtm">Digital Terrain Model (DTM)</h3>
<ul>
<li>Provided by: <strong>Lands Department</strong></li>
</ul>
<p>DTM is a digital terrain model of the HKSAR. It shows the topography of terrain (including some non-ground information such as elevated roads and bridges) in 5-metre raster grid with an accuracy of ±5m.</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://portal.csdi.gov.hk/geoportal/#metadataInfoPanel">香港1:50 000地形圖 (GeoTiff 格式)</a></li>
</ul>
<h3 id="spatial-data-portal-survey-division-cedd">Spatial Data Portal Survey Division, CEDD</h3>
<ul>
<li><a target="_blank" rel="noopener" href="https://sdportal.cedd.gov.hk/#/tc/">Spatial Data Portal Survey Division, CEDD</a>
<ul>
<li>空間數據網站是由土木工程拓展署提供的網上地理空間信息服務，用於預訂和獲取以下數據:
<ul>
<li>三維形象化空載激光遙感測量數據</li>
<li>數碼地圖（只供土木工程拓展署項目顧問/承建商使用）</li>
<li>無人駕駛飛行器產品（只供土木工程拓展署項目顧問/承建商使用）</li>
</ul></li>
</ul></li>
</ul>
<h2 id="generate-.nc-from-.tif">generate <code>*.nc</code> from <code>*.tif</code></h2>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/bash</span><br><span class="hljs-built_in">source</span> /home/wpsze/micromamba/etc/profile.d/micromamba.sh<br>micromamba activate gdal<br><span class="hljs-built_in">export</span> SCRIPT_DIR=<span class="hljs-string">&quot;<span class="hljs-subst">$( cd <span class="hljs-string">&quot;<span class="hljs-subst">$( dirname <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;BASH_SOURCE[0]&#125;</span>&quot;</span> )</span>&quot;</span> &gt;/dev/null 2&gt;&amp;1 &amp;&amp; pwd )</span>&quot;</span><br><br>gdal_translate -of NetCDF <span class="hljs-variable">$&#123;1&#125;</span> <span class="hljs-variable">$&#123;1&#125;</span>.nc<br></code></pre></td></tr></table></figure>
<p><img src="https://i.imgur.com/NHqvVt4.png" srcset="/img/loading.gif" lazyload /></p>
<h3 id="case1-橫瀾waglan-and-蒲台島po-toi">Case1 橫瀾/Waglan and 蒲台島/Po Toi</h3>
<p><img src="https://i.imgur.com/RZi6Hws.png" srcset="/img/loading.gif" lazyload width="400" /></p>
<h3 id="case2-hkia">Case2 HKIA</h3>
<h2 id="generate-.acs-from-.tif-by-rasterio">generate <code>.acs</code> from <code>.tif</code> by rasterio</h2>
<ul>
<li><code>rasterio=1.3.8</code></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">import</span> rasterio<br><br>tif_raster = rasterio.<span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;output_SRTMGL3.tif&quot;</span>)<br>new_array = tif_raster.read(<span class="hljs-number">1</span>)<br><br><span class="hljs-comment"># Modify array</span><br><span class="hljs-comment">#value = 50</span><br><span class="hljs-comment">#new_array  = np.where( (raw_array != 0) &amp; (raw_array &lt;= value) , 1, 0)</span><br><br><span class="hljs-keyword">with</span> rasterio.<span class="hljs-built_in">open</span>(<br>    <span class="hljs-string">&#x27;new_raster.asc&#x27;</span>,<br>    <span class="hljs-string">&#x27;w&#x27;</span>,<br>    driver=<span class="hljs-string">&#x27;AAIGrid&#x27;</span>,<br>    height=new_array.shape[<span class="hljs-number">0</span>],<br>    width=new_array.shape[<span class="hljs-number">1</span>],<br>    count=<span class="hljs-number">1</span>,<br>    dtype=new_array.dtype,<br>    crs=tif_raster.crs,<br>    transform=tif_raster.transform,<br>    force_cellsize=<span class="hljs-literal">True</span><br>) <span class="hljs-keyword">as</span> dst:<br>    dst.write(new_array, <span class="hljs-number">1</span>)<br></code></pre></td></tr></table></figure>
<h2 id="static-file"><code>static file</code></h2>
<ul>
<li><a target="_blank" rel="noopener" href="https://palm.muk.uni-hannover.de/trac/wiki/doc/app/iofiles/pids/static#Staticinputfile" class="uri">https://palm.muk.uni-hannover.de/trac/wiki/doc/app/iofiles/pids/static#Staticinputfile</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.palm-model.org/25.04/Reference/LES_Model/IO-Files/Drivers/static/" class="uri">https://docs.palm-model.org/25.04/Reference/LES_Model/IO-Files/Drivers/static/</a></li>
</ul>
<p>The static input file encompasses topography information as well as all necessary information file to initialize all land- and urban-type surfaces in the model, such as heat capacities, roughness, albedo, emissivity, etc.. The initialization procedure for the surfaces follows a multi-step approach, depending on the given level of detail of each variable as provided in the static input file. In a first step, surfaces are initialized horizontally homogeneous with a bulk classification for each type (e.g. vegetation or soil), either set by a default value or set by a namelist-provided value, while the bulk classification provides standard values for a variety of parameters. In a second step, surfaces are initialized individually by providing the bulk classification at each grid point individually. In case more detailed information is available, all or even single parameters can be initialized individually at each grid point.</p>
<p>The provided input data is used to classify each surface element according to its treatment, i.e. default-, natural- or urban-type, in order to treat each surface element accordingly.</p>
<p>In case no land-surface or urban-surface scheme is applied, all surfaces are classified as default-type. If a surface element has vegetation, pavement or water, it will be classified as natural-type and is treated by the land-surface scheme, while building surfaces will be treated by the urban-surface scheme.</p>
<h2 id="create-static-file-from-.nc-file">create <code>static file</code> from <code>*.nc file</code></h2>
<ul>
<li><code>nc_buildings_2d</code></li>
<li><code>nc_building_type</code></li>
<li><code>nc_building_id</code></li>
</ul>

    <div class="fold">
      <div class="fold-title fold-info collapsed" data-toggle="collapse" href="#collapse-9c51fa20" role="button" aria-expanded="false" aria-controls="collapse-9c51fa20">
        <div class="fold-arrow">▶</div>create_static_file.py
      </div>
      <div class="fold-collapse collapse" id="collapse-9c51fa20">
        <div class="fold-content">
          <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#------------------------------------------------------------------------------#</span><br><span class="hljs-comment"># This file is part of the PALM model system.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># PALM is free software: you can redistribute it and/or modify it under the</span><br><span class="hljs-comment"># terms of the GNU General Public License as published by the Free Software</span><br><span class="hljs-comment"># Foundation, either version 3 of the License, or (at your option) any later</span><br><span class="hljs-comment"># version.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># PALM is distributed in the hope that it will be useful, but WITHOUT ANY</span><br><span class="hljs-comment"># WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR</span><br><span class="hljs-comment"># A PARTICULAR PURPOSE.  See the GNU General Public License for more details.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># You should have received a copy of the GNU General Public License along with</span><br><span class="hljs-comment"># PALM. If not, see &lt;http://www.gnu.org/licenses/&gt;.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Copyright 1997-2020 Leibniz Universitaet Hannover</span><br><span class="hljs-comment">#------------------------------------------------------------------------------#</span><br><br><span class="hljs-keyword">import</span> math<br><span class="hljs-keyword">import</span> netCDF4<br><span class="hljs-keyword">from</span>   netCDF4 <span class="hljs-keyword">import</span> Dataset<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">import</span> datetime<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">StaticDriver</span>:<br>    <span class="hljs-string">&quot;&quot;&quot; This is an example script to generate static drivers for PALM.</span><br><span class="hljs-string"></span><br><span class="hljs-string">    You can use it as a starting point for creating your setup specific</span><br><span class="hljs-string">    driver.</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-string">&quot;&quot;&quot; Open the static driver as NetCDF4 file. Here, you have to give the</span><br><span class="hljs-string">        full path to the static driver that shall be created. Existing file</span><br><span class="hljs-string">        with same name is deleted.</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Opening file...&#x27;</span>)<br>        <span class="hljs-variable language_">self</span>.nc_file = Dataset(<span class="hljs-string">&quot;new_raster.nc&quot;</span>, <span class="hljs-string">&#x27;w&#x27;</span>, <span class="hljs-built_in">format</span>=<span class="hljs-string">&#x27;NETCDF4&#x27;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Opening target file ...&#x27;</span>)<br>        <span class="hljs-variable language_">self</span>.nc_target_file = read_acs()<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">write_global_attributes</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-string">&quot;&quot;&quot; Write global attributes to static driver. &quot;&quot;&quot;</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Writing global attributes...&quot;</span>)<br><br>        <span class="hljs-comment"># mandatory global attributes</span><br>        <span class="hljs-variable language_">self</span>.nc_file.origin_lon = <span class="hljs-number">55.0</span> <span class="hljs-comment"># used to initialize coriolis parameter</span><br>        <span class="hljs-variable language_">self</span>.nc_file.origin_lat = <span class="hljs-number">0.0</span> <span class="hljs-comment"># (overwrite initialization_parameters)</span><br>        <span class="hljs-variable language_">self</span>.nc_file.origin_time = <span class="hljs-string">&#x27;2022-09-14 00:00:00 +00&#x27;</span><br>        <span class="hljs-variable language_">self</span>.nc_file.origin_x = <span class="hljs-number">308124</span><br>        <span class="hljs-variable language_">self</span>.nc_file.origin_y = <span class="hljs-number">6098908</span><br>        <span class="hljs-variable language_">self</span>.nc_file.origin_z = <span class="hljs-number">0.0</span><br>        <span class="hljs-variable language_">self</span>.nc_file.rotation_angle = <span class="hljs-number">0.0</span><br><br>        <span class="hljs-comment"># optional global attributes</span><br>        <span class="hljs-variable language_">self</span>.nc_file.author = <span class="hljs-string">&#x27;...&#x27;</span><br>        <span class="hljs-variable language_">self</span>.nc_file.comment = <span class="hljs-string">&#x27;Miscellaneous information about the data &#x27;</span> \<br>                               <span class="hljs-string">&#x27;or methods to produce it.&#x27;</span><br>        <span class="hljs-variable language_">self</span>.nc_file.creation_date = <span class="hljs-built_in">str</span>(datetime.datetime.now())<br>        <span class="hljs-variable language_">self</span>.nc_file.institution = <span class="hljs-string">&#x27;LUH&#x27;</span><br>        <span class="hljs-variable language_">self</span>.nc_file.history = <span class="hljs-string">&#x27;&#x27;</span><br>        <span class="hljs-variable language_">self</span>.nc_file.palm_revision = <span class="hljs-string">&#x27;&#x27;</span><br>        <span class="hljs-variable language_">self</span>.nc_file.title = <span class="hljs-string">&#x27;Static driver for E3&#x27;</span><br><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">define_dimensions</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-string">&quot;&quot;&quot; Set dimensions on which variables are defined. &quot;&quot;&quot;</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Writing dimensions...&quot;</span>)<br><br>        <span class="hljs-comment"># specify general grid parameters</span><br>        <span class="hljs-comment"># these values must equal those set in the initialization_parameters</span><br>        <span class="hljs-variable language_">self</span>.nx = <span class="hljs-variable language_">self</span>.nc_target_file.shape[<span class="hljs-number">1</span>]+<span class="hljs-number">1</span> <span class="hljs-comment"># lon</span><br>        <span class="hljs-variable language_">self</span>.ny = <span class="hljs-variable language_">self</span>.nc_target_file.shape[<span class="hljs-number">0</span>]+<span class="hljs-number">1</span> <span class="hljs-comment"># lat</span><br>        <span class="hljs-variable language_">self</span>.nz = <span class="hljs-number">100</span><br>        <span class="hljs-variable language_">self</span>.dx = <span class="hljs-number">90.0</span><br>        <span class="hljs-variable language_">self</span>.dy = <span class="hljs-number">90.0</span><br>        <span class="hljs-variable language_">self</span>.dz = <span class="hljs-number">4.0</span><br><br>        <span class="hljs-comment"># mandatory dimensions</span><br>        <span class="hljs-variable language_">self</span>.nc_file.createDimension(<span class="hljs-string">&#x27;x&#x27;</span> ,<span class="hljs-variable language_">self</span>.nx+<span class="hljs-number">1</span>)<br>        <span class="hljs-variable language_">self</span>.x = <span class="hljs-variable language_">self</span>.nc_file.createVariable(<span class="hljs-string">&#x27;x&#x27;</span>, <span class="hljs-string">&#x27;f8&#x27;</span>, (<span class="hljs-string">&#x27;x&#x27;</span>,))<br>        <span class="hljs-variable language_">self</span>.x.units = <span class="hljs-string">&#x27;m&#x27;</span><br>        <span class="hljs-variable language_">self</span>.x.standard_name = <span class="hljs-string">&#x27;x coordinate of cell centers&#x27;</span><br>        <span class="hljs-variable language_">self</span>.x[:] = np.arange(<span class="hljs-number">0</span>,(<span class="hljs-variable language_">self</span>.nx+<span class="hljs-number">1</span>)*<span class="hljs-variable language_">self</span>.dx,<span class="hljs-variable language_">self</span>.dx)<br><br>        <span class="hljs-variable language_">self</span>.nc_file.createDimension(<span class="hljs-string">&#x27;xu&#x27;</span>, <span class="hljs-variable language_">self</span>.nx)<br>        <span class="hljs-variable language_">self</span>.xu = <span class="hljs-variable language_">self</span>.nc_file.createVariable(<span class="hljs-string">&#x27;xu&#x27;</span>, <span class="hljs-string">&#x27;f8&#x27;</span>, (<span class="hljs-string">&#x27;xu&#x27;</span>,))<br>        <span class="hljs-variable language_">self</span>.xu.units = <span class="hljs-string">&#x27;m&#x27;</span><br>        <span class="hljs-variable language_">self</span>.xu.standard_name = <span class="hljs-string">&#x27;x coordinate of cell edges&#x27;</span><br>        <span class="hljs-variable language_">self</span>.xu[:] = np.arange(<span class="hljs-variable language_">self</span>.dx/<span class="hljs-number">2.</span>,<span class="hljs-variable language_">self</span>.nx*<span class="hljs-variable language_">self</span>.dx,<span class="hljs-variable language_">self</span>.dx)<br><br>        <span class="hljs-variable language_">self</span>.nc_file.createDimension(<span class="hljs-string">&#x27;y&#x27;</span>, <span class="hljs-variable language_">self</span>.ny+<span class="hljs-number">1</span>)<br>        <span class="hljs-variable language_">self</span>.y = <span class="hljs-variable language_">self</span>.nc_file.createVariable(<span class="hljs-string">&#x27;y&#x27;</span>, <span class="hljs-string">&#x27;f8&#x27;</span>, (<span class="hljs-string">&#x27;y&#x27;</span>,))<br>        <span class="hljs-variable language_">self</span>.y.units = <span class="hljs-string">&#x27;m&#x27;</span><br>        <span class="hljs-variable language_">self</span>.y.standard_name = <span class="hljs-string">&#x27;y coordinate of cell centers&#x27;</span><br>        <span class="hljs-variable language_">self</span>.y[:] = np.arange(<span class="hljs-number">0</span>,(<span class="hljs-variable language_">self</span>.ny+<span class="hljs-number">1</span>)*<span class="hljs-variable language_">self</span>.dy,<span class="hljs-variable language_">self</span>.dy)<br><br>        <span class="hljs-variable language_">self</span>.nc_file.createDimension(<span class="hljs-string">&#x27;yv&#x27;</span>, <span class="hljs-variable language_">self</span>.ny)<br>        <span class="hljs-variable language_">self</span>.yv = <span class="hljs-variable language_">self</span>.nc_file.createVariable(<span class="hljs-string">&#x27;yv&#x27;</span>, <span class="hljs-string">&#x27;f8&#x27;</span>, (<span class="hljs-string">&#x27;yv&#x27;</span>,))<br>        <span class="hljs-variable language_">self</span>.yv.units = <span class="hljs-string">&#x27;m&#x27;</span><br>        <span class="hljs-variable language_">self</span>.yv.standard_name = <span class="hljs-string">&#x27;y coordinate of cell edges&#x27;</span><br>        <span class="hljs-variable language_">self</span>.yv[:] = np.arange(<span class="hljs-variable language_">self</span>.dy/<span class="hljs-number">2.</span>,<span class="hljs-variable language_">self</span>.ny*<span class="hljs-variable language_">self</span>.dy,<span class="hljs-variable language_">self</span>.dy)<br><br>        <span class="hljs-comment"># if your simulation uses a stretched vertical grid, you need to</span><br>        <span class="hljs-comment"># modify the z and zw coordinates,</span><br>        <span class="hljs-comment"># e.g. z_array = (...) and zw_array = (...)</span><br>        z_array = np.append(<span class="hljs-number">0</span>, np.arange(<span class="hljs-variable language_">self</span>.dz/<span class="hljs-number">2</span>,(<span class="hljs-variable language_">self</span>.nz+<span class="hljs-number">1</span>)*<span class="hljs-variable language_">self</span>.dz,<span class="hljs-variable language_">self</span>.dz))<br>        <span class="hljs-variable language_">self</span>.nc_file.createDimension(<span class="hljs-string">&#x27;z&#x27;</span>,<span class="hljs-variable language_">self</span>.nz+<span class="hljs-number">2</span>)<br>        <span class="hljs-variable language_">self</span>.z = <span class="hljs-variable language_">self</span>.nc_file.createVariable(<span class="hljs-string">&#x27;z&#x27;</span>, <span class="hljs-string">&#x27;f8&#x27;</span>, (<span class="hljs-string">&#x27;z&#x27;</span>,))<br>        <span class="hljs-variable language_">self</span>.z.units = <span class="hljs-string">&#x27;m&#x27;</span><br>        <span class="hljs-variable language_">self</span>.z.standard_name = <span class="hljs-string">&#x27;z coordinate of cell centers&#x27;</span><br>        <span class="hljs-variable language_">self</span>.z[:] = z_array<br><br>        zw_array = np.arange(<span class="hljs-number">0</span>,(<span class="hljs-variable language_">self</span>.nz+<span class="hljs-number">2</span>)*<span class="hljs-variable language_">self</span>.dz,<span class="hljs-variable language_">self</span>.dz)<br>        <span class="hljs-variable language_">self</span>.nc_file.createDimension(<span class="hljs-string">&#x27;zw&#x27;</span>, <span class="hljs-variable language_">self</span>.nz+<span class="hljs-number">2</span>)<br>        <span class="hljs-variable language_">self</span>.zw = <span class="hljs-variable language_">self</span>.nc_file.createVariable(<span class="hljs-string">&#x27;zw&#x27;</span>, <span class="hljs-string">&#x27;f8&#x27;</span>, (<span class="hljs-string">&#x27;zw&#x27;</span>,))<br>        <span class="hljs-variable language_">self</span>.zw.units = <span class="hljs-string">&#x27;m&#x27;</span><br>        <span class="hljs-variable language_">self</span>.zw.standard_name = <span class="hljs-string">&#x27;z coordinate of cell edges&#x27;</span><br>        <span class="hljs-variable language_">self</span>.zw[:] = zw_array<br><br>        <span class="hljs-comment"># optional dimensions, uncomment if needed</span><br>        <span class="hljs-comment">#self.nc_file.createDimension(&#x27;zsoil&#x27;, len(zsoil_array))</span><br>        <span class="hljs-comment">#...</span><br><br>        <span class="hljs-comment">#self.nc_file.createDimension(&#x27;zlad&#x27;, len(zlad_array))</span><br>        <span class="hljs-comment">#...</span><br><br>        <span class="hljs-comment">#self.nc_file.createDimension(&#x27;nsurface_fraction&#x27;, 3)</span><br>        <span class="hljs-comment">#...</span><br><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">add_variables</span>(<span class="hljs-params">self</span>):<br><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Writing variables...&quot;</span>)<br>        fill_val_real = -<span class="hljs-number">9999.9</span><br>        fill_val_int8 = -<span class="hljs-number">127</span><br><br>        <span class="hljs-comment"># topography variables</span><br>        nc_buildings_2d = <span class="hljs-variable language_">self</span>.nc_file.createVariable(<br>             <span class="hljs-string">&#x27;buildings_2d&#x27;</span>, <span class="hljs-string">&#x27;f4&#x27;</span>, (<span class="hljs-string">&#x27;y&#x27;</span>,<span class="hljs-string">&#x27;x&#x27;</span>), fill_value=fill_val_real)<br>        nc_buildings_2d.lod = <span class="hljs-number">1</span><br>        nc_buildings_2d[:,:] = fill_val_real<br><br>        nc_building_id = <span class="hljs-variable language_">self</span>.nc_file.createVariable(<br>            <span class="hljs-string">&#x27;building_id&#x27;</span>, <span class="hljs-string">&#x27;i1&#x27;</span>, (<span class="hljs-string">&#x27;y&#x27;</span>,<span class="hljs-string">&#x27;x&#x27;</span>), fill_value=fill_val_int8)<br>        nc_building_id[:,:] = fill_val_int8<br><br>        nc_building_type = <span class="hljs-variable language_">self</span>.nc_file.createVariable(<br>            <span class="hljs-string">&#x27;building_type&#x27;</span>, <span class="hljs-string">&#x27;i1&#x27;</span>, (<span class="hljs-string">&#x27;y&#x27;</span>,<span class="hljs-string">&#x27;x&#x27;</span>), fill_value=fill_val_int8)<br>        nc_building_type[:,:] = fill_val_int8<br><br><br><br>        <span class="hljs-comment">## terrain height</span><br>        nc_zt = <span class="hljs-variable language_">self</span>.nc_file.createVariable(    \<br>            <span class="hljs-string">&#x27;zt&#x27;</span>, <span class="hljs-string">&#x27;f4&#x27;</span>, (<span class="hljs-string">&#x27;y&#x27;</span>,<span class="hljs-string">&#x27;x&#x27;</span>), fill_value=fill_val_real)<br>        nc_zt.long_name = <span class="hljs-string">&#x27;orography&#x27;</span><br>        nc_zt.units = <span class="hljs-string">&#x27;m&#x27;</span><br><br><br>        nc_zt[:,:] = <span class="hljs-number">0.0</span><br><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;self.nx             = <span class="hljs-subst">&#123;self.nx&#125;</span>&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;self.ny             = <span class="hljs-subst">&#123;self.ny&#125;</span>&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;self.nc_target_file = <span class="hljs-subst">&#123;self.nc_target_file.shape&#125;</span>&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;nc_buildings_2d     = <span class="hljs-subst">&#123;nc_buildings_2d.shape&#125;</span>&quot;</span>)<br><br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-variable language_">self</span>.nc_target_file.shape[<span class="hljs-number">1</span>]): <span class="hljs-comment"># start from 0, or 2 or .. and end self.nx ==&gt; match self.nc_target_file</span><br>            <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-variable language_">self</span>.nc_target_file.shape[<span class="hljs-number">0</span>]):<br>                <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">self</span>.nc_target_file[j,i] &gt; <span class="hljs-number">0.1</span>): <span class="hljs-comment"># Mountains/Buiildings</span><br>                    nc_buildings_2d[j+<span class="hljs-number">2</span>,i+<span class="hljs-number">2</span>] = <span class="hljs-variable language_">self</span>.nc_target_file[j,i] + (<span class="hljs-variable language_">self</span>.dz - <span class="hljs-variable language_">self</span>.nc_target_file[j,i]%<span class="hljs-variable language_">self</span>.dz)<br>                    nc_building_type[j+<span class="hljs-number">2</span>,i+<span class="hljs-number">2</span>] = <span class="hljs-number">2</span><br>                    <span class="hljs-comment"># For each (ii,jj)-pair create an unique ID</span><br>                    nc_building_id[j+<span class="hljs-number">2</span>,i+<span class="hljs-number">2</span>] = <span class="hljs-number">1</span> <span class="hljs-comment">#+ 100*j</span><br>                <span class="hljs-keyword">else</span>:<br>                    nc_buildings_2d[j+<span class="hljs-number">2</span>, i+<span class="hljs-number">2</span>] = fill_val_real<br><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Checking (nc_buildings_2d%self.dz !=0)  = &quot;</span>, np.<span class="hljs-built_in">sum</span>(nc_buildings_2d[:,:]%<span class="hljs-variable language_">self</span>.dz != <span class="hljs-number">0</span>))<br><br>        <span class="hljs-comment"># Set index ranges for buildings</span><br>        <span class="hljs-comment">#build_inds_start_x = [ 80, 120, 160 ]</span><br>        <span class="hljs-comment">#build_inds_end_x   = [ 99, 139, 179 ]</span><br><br>        <span class="hljs-comment">#build_inds_start_y = [20, 50] #build_inds_start_x</span><br>        <span class="hljs-comment">#build_inds_end_y   = [39, 69] #build_inds_end_x</span><br><br>        <span class="hljs-comment">#for i in range(0,self.nx+1):</span><br>        <span class="hljs-comment">#    for j in range(0,self.ny+1):</span><br>        <span class="hljs-comment">#        # Set building height</span><br>        <span class="hljs-comment">#        for ii in range(0,len(build_inds_start_x)):</span><br>        <span class="hljs-comment">#            for jj in range(0,len(build_inds_start_y)):</span><br>        <span class="hljs-comment">#</span><br>        <span class="hljs-comment">#                if ( i &gt;= build_inds_start_x[ii] and i &lt;= build_inds_end_x[ii] ) and \</span><br>        <span class="hljs-comment">#                    ( j &gt;= build_inds_start_y[jj] and j &lt;= build_inds_end_y[jj] ):</span><br>        <span class="hljs-comment">#                    </span><br>        <span class="hljs-comment">#                    nc_buildings_2d[j,i] = 40.0</span><br>        <span class="hljs-comment">#                    nc_building_type[j,i] = 2</span><br>        <span class="hljs-comment">#</span><br>        <span class="hljs-comment">#                   # For each (ii,jj)-pair create an unique ID</span><br>        <span class="hljs-comment">#                    nc_building_id[j,i] = ii + len(build_inds_start_x) * jj</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">finalize</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-string">&quot;&quot;&quot; Close file &quot;&quot;&quot;</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Closing file...&quot;</span>)<br><br>        <span class="hljs-variable language_">self</span>.nc_file.close()<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">read_acs</span>(<span class="hljs-params">input_file=<span class="hljs-string">&quot;new_raster.asc&quot;</span></span>):<br>    <span class="hljs-comment"># Assuming a header of 6 lines, adjust &#x27;skiprows&#x27; as needed</span><br>    data_array = np.loadtxt(input_file, skiprows=<span class="hljs-number">5</span>) <br>    data_array[data_array &lt; <span class="hljs-number">0.1</span>] = -<span class="hljs-number">9999.9</span><br>    data_array = np.flipud(data_array)<br><br>    <span class="hljs-built_in">print</span>(data_array.shape)<br>    <span class="hljs-comment"># Find the maximum value</span><br>    max_value = <span class="hljs-built_in">max</span>(<span class="hljs-built_in">max</span>(row) <span class="hljs-keyword">for</span> row <span class="hljs-keyword">in</span> data_array)<br>    <span class="hljs-comment"># Find the minimum value</span><br>    min_value = <span class="hljs-built_in">min</span>(<span class="hljs-built_in">min</span>(row) <span class="hljs-keyword">for</span> row <span class="hljs-keyword">in</span> data_array)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Maximum value: <span class="hljs-subst">&#123;max_value&#125;</span>&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Minimum value: <span class="hljs-subst">&#123;min_value&#125;</span>&quot;</span>)<br>    <span class="hljs-built_in">print</span>(data_array)<br>    <span class="hljs-keyword">return</span> data_array<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    driver = StaticDriver()<br>    driver.write_global_attributes()<br>    driver.define_dimensions()<br>    driver.add_variables()<br>    driver.finalize()<br></code></pre></td></tr></table></figure>
        </div>
      </div>
    </div>
<ul>
<li>try to execute by using <code>flow_around_cube_cyclic_p3d</code></li>
</ul>

    <div class="fold">
      <div class="fold-title fold-info collapsed" data-toggle="collapse" href="#collapse-05eef982" role="button" aria-expanded="false" aria-controls="collapse-05eef982">
        <div class="fold-arrow">▶</div>flow_around_cube_cyclic_p3d
      </div>
      <div class="fold-collapse collapse" id="collapse-05eef982">
        <div class="fold-content">
          <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><code class="hljs namelist">!-------------------------------------------------------------------------------<br>!-- INITIALIZATION PARAMETER NAMELIST<br>!   Documentation: https://docs.palm-model.org/23.04/Reference/LES_Model/Namelists/#initialization-parameters<br>!-------------------------------------------------------------------------------<br>&amp;initialization_parameters<br>!<br>!-- grid parameters<br>!-------------------------------------------------------------------------------<br>    nx                         = 113, ! Number of gridboxes in x-direction (nx+1)<br>    ny                         = 63, ! Number of gridboxes in y-direction (ny+1)<br>    nz                         = 102, ! Number of gridboxes in z-direction (nz)<br><br>    dx                         = 90.0, ! Size of single gridbox in x-direction<br>    dy                         = 90.0, ! Size of single gridbox in y-direction<br>    dz                         = 4.0, ! Size of single gridbox in z-direction<br>!<br>!-- initialization<br>!-------------------------------------------------------------------------------<br>    initializing_actions       = &#x27;set_constant_profiles&#x27;, ! initial conditions<br><br>    ug_surface                 = 5.0, ! initial u-comp<br>    vg_surface                 = 0.0, ! initial v-comp<br><br>    neutral                    = .T., ! strictly neutral flow<br>!<br>!-- physics<br>!-------------------------------------------------------------------------------<br>    omega                      = 0.0, ! no Coriolis force<br><br>!<br>!-- mode<br>!-------------------------------------------------------------------------------<br>    dp_external                = .T.,          ! use horizontal pressure gradient<br>    dpdxy                      = -0.0002, 0.0, ! set pressure gradient along x<br>!<br>!-- boundary conditions<br>!-------------------------------------------------------------------------------<br>    bc_uv_t                    = &#x27;neumann&#x27;, ! free-slip boundary condition<br><br>!<br>!-- numerics<br>!-------------------------------------------------------------------------------<br>    fft_method                 = &#x27;fftw&#x27;, ! build-in fft method<br>!<br>!-- topography<br>!-------------------------------------------------------------------------------<br>    topography                 = &#x27;read_from_file&#x27;,  ! use input file to set topography<br>!<br>!-- misc<br>!-------------------------------------------------------------------------------<br>    restart_data_format =  &#x27;mpi_shared_memory&#x27;,<br><br>/ ! end of initialization parameter namelist<br><br>!-------------------------------------------------------------------------------<br>!-- RUNTIME PARAMETER NAMELIST<br>!   Documentation: https://docs.palm-model.org/23.04/Reference/LES_Model/Namelists/#runtime-parameters<br>!-------------------------------------------------------------------------------<br>&amp;runtime_parameters<br>!<br>!-- run steering<br>!-------------------------------------------------------------------------------<br>    end_time                   = 2000.0, ! simulation time of the 3D model<br>    create_disturbances        = .T.,    ! randomly perturbate horiz. velocity<br>!<br>!-- data output<br>!-------------------------------------------------------------------------------<br>    dt_run_control             =    0.0, ! output interval for run control<br>    dt_data_output             = 100.0,   !1800.0, ! output interval for general data<br>    dt_dots                    =    0.0, ! output interval for time-series data<br>    dt_dopr                    = 100.0,   !1800.0, ! output interval for profile data<br><br>    data_output                = &#x27;u&#x27;, &#x27;u_av&#x27;,<br>                                 &#x27;v&#x27;, &#x27;v_av&#x27;,<br>                                 &#x27;w&#x27;, &#x27;w_av&#x27;,  ! 2d and/or 3d output<br><br>    data_output_pr             = &#x27;#u&#x27;, &#x27;u*2&#x27;, &#x27;wu&#x27;, &#x27;w*u*&#x27;, &#x27;w&quot;u&quot;&#x27;,<br>                                 &#x27;#v&#x27;, &#x27;v*2&#x27;, &#x27;wv&#x27;, &#x27;w*v*&#x27;, &#x27;w&quot;v&quot;&#x27;,<br>                                 &#x27;w&#x27;, &#x27;w*2&#x27;,<br>                                 &#x27;e&#x27;, &#x27;e*&#x27;,<br>                                 &#x27;#km&#x27;,<br>                                 &#x27;#l&#x27;,      ! Profile output<br><br><br>    averaging_interval         = 100.0, !1800.0, ! averaging interval general data<br>    dt_averaging_input         =    0.0, ! averaging general data sampling rate<br><br>    averaging_interval_pr      = 100.0, !1800.0, ! averaging interval profile data<br>    dt_averaging_input_pr      =    0.0, ! averaging profile data sampling rate<br><br>/ ! end of runtime parameter namelist<br></code></pre></td></tr></table></figure>
        </div>
      </div>
    </div>
<h1 id="case1-橫瀾waglan-and-蒲台島po-toi-1">Case1 橫瀾/Waglan and 蒲台島/Po Toi</h1>
<p><img src="https://i.imgur.com/MMLZba8.png" srcset="/img/loading.gif" lazyload width="500" /></p>
<h1 id="case2-hkia-1">Case2 HKIA</h1>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/PALM/" class="category-chain-item">PALM</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/MPAS/" class="print-no-link">#MPAS</a>
      
        <a href="/tags/NWP/" class="print-no-link">#NWP</a>
      
        <a href="/tags/WRF/" class="print-no-link">#WRF</a>
      
        <a href="/tags/Urban/" class="print-no-link">#Urban</a>
      
        <a href="/tags/PALM/" class="print-no-link">#PALM</a>
      
        <a href="/tags/LES/" class="print-no-link">#LES</a>
      
        <a href="/tags/Topography/" class="print-no-link">#Topography</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>PALM | Topography and Flow_around_buildings</div>
      <div>https://waipangsze.github.io/2025/06/27/PALM-Topography-and-Flow_around_buildings/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>Author</div>
          <div>wpsze</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>Posted on</div>
          <div>June 27, 2025</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>Updated on</div>
          <div>July 11, 2025</div>
        </div>
      
      
        <div class="license-meta-item">
          <div>Licensed under</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - Attribution">
                    <i class="iconfont icon-cc-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2025/07/10/NWP-PGW-Bias-corrected-CMIP6/" title="NWP | PGW + Bias-corrected-CMIP6">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">NWP | PGW + Bias-corrected-CMIP6</span>
                        <span class="visible-mobile">Previous</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2025/06/24/WRF-FDDA-Spectral-nudging/" title="MPAS | WRF | FDDA | Spectral nudging">
                        <span class="hidden-mobile">MPAS | WRF | FDDA | Spectral nudging</span>
                        <span class="visible-mobile">Next</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>Table of Contents</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  


  
  





  <script>
  Fluid.utils.createScript('https://lib.baomitu.com/mermaid/8.14.0/mermaid.min.js', function() {
    mermaid.initialize({"theme":"default"});

    Fluid.utils.listenDOMLoaded(function() {
      Fluid.events.registerRefreshCallback(function() {
        if ('mermaid' in window) {
          mermaid.init();
        }
      });
    });
  });
</script>






<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-9HL36SZ28R"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-9HL36SZ28R');
</script>

    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">Keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">

  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  

  <span id="sitetime"></span>
  <script language=javascript>
    function siteTime(){
      window.setTimeout("siteTime()", 1000);
      var seconds = 1000;
      var minutes = seconds * 60;
      var hours = minutes * 60;
      var days = hours * 24;
      var years = days * 365;
      var today = new Date();
      var todayYear = today.getFullYear();
      var todayMonth = today.getMonth()+1;
      var todayDate = today.getDate();
      var todayHour = today.getHours();
      var todayMinute = today.getMinutes();
      var todaySecond = today.getSeconds();
      /* Date.UTC() -- 返回date对象距世界标准时间(UTC)1970年1月1日午夜之间的毫秒数(时间戳)
      year - 作为date对象的年份，为4位年份值
      month - 0-11之间的整数，做为date对象的月份
      day - 1-31之间的整数，做为date对象的天数
      hours - 0(午夜24点)-23之间的整数，做为date对象的小时数
      minutes - 0-59之间的整数，做为date对象的分钟数
      seconds - 0-59之间的整数，做为date对象的秒数
      microseconds - 0-999之间的整数，做为date对象的毫秒数 */
      var t1 = Date.UTC(2023,04,23,00,00,00); //北京时间2018-2-13 00:00:00
      var t2 = Date.UTC(todayYear,todayMonth,todayDate,todayHour,todayMinute,todaySecond);
      var diff = t2-t1;
      var diffYears = Math.floor(diff/years);
      var diffDays = Math.floor((diff/days)-diffYears*365);
      var diffHours = Math.floor((diff-(diffYears*365+diffDays)*days)/hours);
      var diffMinutes = Math.floor((diff-(diffYears*365+diffDays)*days-diffHours*hours)/minutes);
      var diffSeconds = Math.floor((diff-(diffYears*365+diffDays)*days-diffHours*hours-diffMinutes*minutes)/seconds);
      /*document.getElementById("sitetime").innerHTML=" 已运行"+/*diffYears+" 年 "+*/diffDays+" 天 "+diffHours+" 小时 "+diffMinutes+" 分钟 "+diffSeconds+" 秒";
      document.getElementById("sitetime").innerHTML=" 已運行"+diffYears+" 年 "+diffDays+" 天 ";
    }/*因为建站时间还没有一年，就将之注释掉了。需要的可以取消*/
    siteTime();
  </script>
  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/5.0.0/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  
      <script>
        if (!window.MathJax) {
          window.MathJax = {
            tex    : {
              inlineMath: { '[+]': [['$', '$']] }
            },
            loader : {
              load: ['ui/lazy']
            },
            options: {
              renderActions: {
                insertedScript: [200, () => {
                  document.querySelectorAll('mjx-container').forEach(node => {
                    let target = node.parentNode;
                    if (target.nodeName.toLowerCase() === 'li') {
                      target.parentNode.classList.add('has-jax');
                    }
                  });
                }, '', false]
              }
            }
          };
        } else {
          MathJax.startup.document.state(0);
          MathJax.texReset();
          MathJax.typeset();
          MathJax.typesetPromise();
        }

        Fluid.events.registerRefreshCallback(function() {
          if ('MathJax' in window && MathJax.startup.document && typeof MathJax.startup.document.state === 'function') {
            MathJax.startup.document.state(0);
            MathJax.texReset();
            MathJax.typeset();
            MathJax.typesetPromise();
          }
        });
      </script>
    

  <script  src="https://lib.baomitu.com/mathjax/3.2.2/es5/tex-mml-chtml.js" ></script>

  <script  src="/js/local-search.js" ></script>

  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">Blog works best with JavaScript enabled</div>
  </noscript>
</body>
</html>
