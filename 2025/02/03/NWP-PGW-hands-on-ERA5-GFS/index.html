

<!DOCTYPE html>
<html lang="en" data-default-color-scheme=light>



<head>
  <meta charset="UTF-8">

  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="wpsze">
  <meta name="keywords" content="">
  
    <meta name="description" content="Introduction Keywords:  The Pseudo-Global-Warming (PGW) approach CMIP6 how to convert ERA5 GRIB files to NetCDF format GRIB files are the file format used at ECMWF. GRIB is a WMO standard and consists">
<meta property="og:type" content="article">
<meta property="og:title" content="NWP | Pseudo-Global-Warming (PGW) hands-on | ERA5 | GFS">
<meta property="og:url" content="https://waipangsze.github.io/2025/02/03/NWP-PGW-hands-on-ERA5-GFS/index.html">
<meta property="og:site_name" content="wpsze">
<meta property="og:description" content="Introduction Keywords:  The Pseudo-Global-Warming (PGW) approach CMIP6 how to convert ERA5 GRIB files to NetCDF format GRIB files are the file format used at ECMWF. GRIB is a WMO standard and consists">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://i.imgur.com/kcuHfQW.png">
<meta property="article:published_time" content="2025-02-03T08:47:00.000Z">
<meta property="article:modified_time" content="2025-04-09T08:24:14.924Z">
<meta property="article:author" content="wpsze">
<meta property="article:tag" content="WRF">
<meta property="article:tag" content="NWP">
<meta property="article:tag" content="MPAS">
<meta property="article:tag" content="GFS">
<meta property="article:tag" content="ERA5">
<meta property="article:tag" content="PGW">
<meta property="article:tag" content="GRIB">
<meta property="article:tag" content="NetCDF">
<meta property="article:tag" content="CMIP6">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://i.imgur.com/kcuHfQW.png">
  
  
    <meta name="referrer" content="no-referrer-when-downgrade">
  
  
  <title>NWP | Pseudo-Global-Warming (PGW) hands-on | ERA5 | GFS - wpsze</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css">



<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"waipangsze.github.io","root":"/","version":"1.9.8","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"follow_dnt":true,"baidu":null,"google":{"measurement_id":"F7MK-FcxSomhtc1N3hIUDA"},"tencent":{"sid":null,"cid":null},"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false},"umami":{"src":null,"website_id":null,"domains":null,"start_time":"2024-01-01T00:00:00.000Z","token":null,"api_server":null}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  

  

  
    <!-- Google tag (gtag.js) -->
    <script async>
      if (!Fluid.ctx.dnt) {
        Fluid.utils.createScript("https://www.googletagmanager.com/gtag/js?id=F7MK-FcxSomhtc1N3hIUDA", function() {
          window.dataLayer = window.dataLayer || [];
          function gtag() {
            dataLayer.push(arguments);
          }
          gtag('js', new Date());
          gtag('config', 'F7MK-FcxSomhtc1N3hIUDA');
        });
      }
    </script>
  

  

  

  



  
<meta name="generator" content="Hexo 7.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>wpsze</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>Home</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>Archives</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>Categories</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>Tags</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/" target="_self">
                <i class="iconfont icon-link-fill"></i>
                <span>Links</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/bookmark/" target="_self">
                <i class="iconfont icon-bookmark"></i>
                <span>Bookmarks</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" target="_self" href="javascript:;" role="button"
                 data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <i class="iconfont icon-books"></i>
                <span>Docs</span>
              </a>
              <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                
                  
                  
                  
                  <a class="dropdown-item" href="/categories/Physics/" target="_self">
                    <i class="iconfont icon-plan"></i>
                    <span>Physics</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/categories/Maths/" target="_self">
                    <i class="iconfont icon-plan"></i>
                    <span>Maths</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/categories/CFD/" target="_self">
                    <i class="iconfont icon-plan"></i>
                    <span>CFD</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/categories/ML/" target="_self">
                    <i class="iconfont icon-plan"></i>
                    <span>ML</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/categories/Meteorology/" target="_self">
                    <i class="iconfont icon-plan"></i>
                    <span>Meteorology</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/categories/MPAS/" target="_self">
                    <i class="iconfont icon-plan"></i>
                    <span>MPAS</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/categories/PALM/" target="_self">
                    <i class="iconfont icon-plan"></i>
                    <span>PALM</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/monitor/" target="_self">
                    
                    <span>Real Time Monitoring</span>
                  </a>
                
              </div>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>About Me</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('https://i.imgur.com/kcuHfQW.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="NWP | Pseudo-Global-Warming (PGW) hands-on | ERA5 | GFS"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2025-02-03 16:47" pubdate>
          February 3, 2025 pm
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          4.7k words
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          40 mins
        
      </span>
    

    
    
      
        <span id="busuanzi_container_page_pv" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="busuanzi_value_page_pv"></span> views
        </span>
        

      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">NWP | Pseudo-Global-Warming (PGW) hands-on | ERA5 | GFS</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="introduction">Introduction</h1>
<p>Keywords:</p>
<ul>
<li>The Pseudo-Global-Warming (<strong>PGW</strong>) approach</li>
<li><strong>CMIP6</strong></li>
<li>how to convert <strong>ERA5</strong> <strong>GRIB</strong> files to NetCDF format</li>
<li>GRIB files are the file format used at <strong>ECMWF</strong>. GRIB is a WMO standard and consists of GRIB Edition 1 and Edition 2</li>
</ul>
<p>The ERA5 dataset, produced by the European Centre for Medium-Range Weather Forecasts (ECMWF), provides a wealth of climate and weather data. However, the data is often distributed in the GRIB format, which can be less user-friendly than the NetCDF format, commonly used in scientific computing. This blog post will walk you through the process of converting ERA5 GRIB files to NetCDF.</p>
<div class="note note-primary">
            <p>Read <a href="https://waipangsze.github.io/2024/09/30/PGW/"><strong>Pseudo-Global Warming (PGW) - Future Projection</strong></a></p>
          </div>
<h1 id="motivation">Motivation</h1>
<p>Climate change is one of the most pressing issues of our time, and understanding its impacts requires access to high-quality climate data. The ERA5 dataset provides crucial information on past and present climate conditions, helping researchers analyze trends and signals related to climate change. However, the ERA5 data is often stored in GRIB format, which can be challenging to work with. By converting ERA5 GRIB files to NetCDF format, we can more easily integrate climate change signals into ERA5.</p>
<p>By applying the Pseudo-Global-Warming (PGW) approach, you can use the CMIP6 climate change signals to generate a difference and then add this to the initial conditions, such as those provided by ERA5.</p>
<h1 id="main-script">Main Script</h1>

    <div class="fold">
      <div class="fold-title fold-info collapsed" data-toggle="collapse" href="#collapse-8f7bdefe" role="button" aria-expanded="false" aria-controls="collapse-8f7bdefe">
        <div class="fold-arrow">▶</div>loop.sh
      </div>
      <div class="fold-collapse collapse" id="collapse-8f7bdefe">
        <div class="fold-content">
          <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/bash</span><br><br>ym=<span class="hljs-string">&quot;20220630&quot;</span><br><br><span class="hljs-keyword">for</span> iday <span class="hljs-keyword">in</span> &#123;0..360..3&#125;; <span class="hljs-keyword">do</span><br>    <span class="hljs-comment"># Next_day=$(date +%Y-%m-%d_%H:%M:%S -d &quot;$YYYYMMDD + 1 hour&quot;)</span><br>    <span class="hljs-built_in">export</span> ERA5_datetime=$(<span class="hljs-built_in">date</span> +%Y%m%d%H -d <span class="hljs-string">&quot;<span class="hljs-variable">$ym</span> + <span class="hljs-variable">$iday</span> hour&quot;</span>)<br>    <span class="hljs-built_in">echo</span> <span class="hljs-variable">$&#123;ERA5_datetime&#125;</span><br><br>    ./PGW_main.sh<br><span class="hljs-keyword">done</span><br></code></pre></td></tr></table></figure>
        </div>
      </div>
    </div>

    <div class="fold">
      <div class="fold-title fold-info collapsed" data-toggle="collapse" href="#collapse-dcdac752" role="button" aria-expanded="false" aria-controls="collapse-dcdac752">
        <div class="fold-arrow">▶</div>PGW_main.sh
      </div>
      <div class="fold-collapse collapse" id="collapse-dcdac752">
        <div class="fold-content">
          <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/bash</span><br><br><span class="hljs-comment">#------------------------------------------------#</span><br><span class="hljs-comment">#Author:         wpsze</span><br><span class="hljs-comment">#Email：         wpsze</span><br><span class="hljs-comment">#date:           2025-02-10 09:45:06</span><br><span class="hljs-comment">#Version:        0.0 </span><br><span class="hljs-comment">#Description:    The purpose of the script</span><br><span class="hljs-comment">#Copyright (C)： 2025 All rights reserved</span><br><span class="hljs-comment">#------------------------------------------------#</span><br><br><span class="hljs-built_in">export</span> ERA5_datetime=<span class="hljs-variable">$&#123;ERA5_datetime:-&quot;2022063000&quot;&#125;</span><br><span class="hljs-built_in">export</span> ERA5_path=<span class="hljs-variable">$&#123;ERA5_path:-&quot;/home/wpsze/ERA5/&quot;&#125;</span><br><span class="hljs-built_in">export</span> PGW_ERA5_path=<span class="hljs-variable">$&#123;PGW_ERA5_path:-&quot;/home/wpsze/PGW/ERA5/&quot;&#125;</span>              <span class="hljs-comment"># save future projection of ERA5 IC</span><br><span class="hljs-built_in">export</span> PGW_script_path=<span class="hljs-variable">$&#123;PGW_script_path:-&quot;/home/wpsze/PGW/&quot;&#125;</span><br><br><span class="hljs-built_in">export</span> cmip6_signal_file=<span class="hljs-variable">$&#123;cmip6_signal_file:-&quot;/home/wpsze/CMIP6_gw_signal_difference_data/diff_ssp585far-hist_07.nc&quot;&#125;</span><br><br><span class="hljs-built_in">export</span> yyyymmddhh=<span class="hljs-string">&quot;<span class="hljs-variable">$&#123;ERA5_datetime&#125;</span>&quot;</span><br><span class="hljs-built_in">export</span> yyyymm=<span class="hljs-string">&quot;<span class="hljs-variable">$&#123;ERA5_datetime:0:6&#125;</span>&quot;</span><br><span class="hljs-built_in">export</span> yyyymmdd=<span class="hljs-string">&quot;<span class="hljs-variable">$&#123;ERA5_datetime:0:8&#125;</span>&quot;</span><br><span class="hljs-built_in">export</span> hh=<span class="hljs-string">&quot;<span class="hljs-variable">$&#123;ERA5_datetime:8:2&#125;</span>&quot;</span><br><br><span class="hljs-built_in">source</span> /home/wpsze/micromamba/etc/profile.d/micromamba.sh<br>micromamba activate PGW<br><br><span class="hljs-built_in">mkdir</span> -p tmp<br><span class="hljs-built_in">cd</span> tmp<br><br><span class="hljs-built_in">rm</span> *idx<br><span class="hljs-built_in">ln</span> -sf <span class="hljs-variable">$&#123;ERA5_path&#125;</span>/<span class="hljs-variable">$&#123;yyyymm&#125;</span>/<span class="hljs-variable">$&#123;yyyymmdd&#125;</span>/ERA5-0p25-PL-<span class="hljs-variable">$&#123;yyyymmddhh&#125;</span>.grib<br><span class="hljs-built_in">ln</span> -sf <span class="hljs-variable">$&#123;ERA5_path&#125;</span>/<span class="hljs-variable">$&#123;yyyymm&#125;</span>/<span class="hljs-variable">$&#123;yyyymmdd&#125;</span>/ERA5-0p25-SL-<span class="hljs-variable">$&#123;yyyymmddhh&#125;</span>.grib<br><br><span class="hljs-comment"># Convert ERA5.grib to .nc</span><br><span class="hljs-keyword">if</span> [[ ! -f <span class="hljs-string">&quot;ERA5-0p25-SL-<span class="hljs-variable">$&#123;yyyymmddhh&#125;</span>.nc&quot;</span> ]]; <span class="hljs-keyword">then</span><br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;ERA5-0p25-SL/PL-<span class="hljs-variable">$&#123;yyyymmddhh&#125;</span>.nc doesn&#x27;t exist, generating them ... &quot;</span><br>    time python3 <span class="hljs-variable">$&#123;PGW_script_path&#125;</span>/grib2netcdf.py<br><span class="hljs-keyword">else</span><br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;ERA5-0p25-SL/PL-<span class="hljs-variable">$&#123;yyyymmddhh&#125;</span>.nc exist.&quot;</span><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-comment"># rename/rebuild singal.nc</span><br><span class="hljs-keyword">if</span> [[ ! -f <span class="hljs-string">&quot;signal.nc&quot;</span> ]]; <span class="hljs-keyword">then</span><br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;singal.nc doesn&#x27;t exits, soft-link and rebuild ...&quot;</span><br>    <span class="hljs-built_in">ln</span> -sf <span class="hljs-variable">$&#123;cmip6_signal_file&#125;</span> original-signal.nc<br>    time python3 <span class="hljs-variable">$&#123;PGW_script_path&#125;</span>/rename_signal.py<br><span class="hljs-keyword">else</span> <br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;signal.nc exists.&quot;</span><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-comment"># regrid signal.nc (1.25deg) to 0.25deg </span><br><span class="hljs-keyword">if</span> [[ ! -f <span class="hljs-string">&quot;signal_0p25.nc&quot;</span> ]]; <span class="hljs-keyword">then</span><br>    cdo remapbil,r1440x721 signal.nc signal_0p25.nc<br><span class="hljs-keyword">else</span><br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;signal_0p25.nc exists.&quot;</span><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-comment"># Add singal.nc into ERA5.nc</span><br>time python3 <span class="hljs-variable">$&#123;PGW_script_path&#125;</span>/2d_interp.py<br>time python3 <span class="hljs-variable">$&#123;PGW_script_path&#125;</span>/3d_interp.py<br><span class="hljs-comment"># time python3 $&#123;PGW_script_path&#125;/3d_interp_with_uv.py</span><br><br><span class="hljs-comment"># Convert nc file to grib file</span><br><span class="hljs-built_in">cp</span> ERA5-0p25-SL-<span class="hljs-variable">$&#123;yyyymmddhh&#125;</span>.grib original-SL.grib<br><span class="hljs-built_in">cp</span> ERA5-0p25-PL-<span class="hljs-variable">$&#123;yyyymmddhh&#125;</span>.grib original-PL.grib<br>time sh <span class="hljs-variable">$&#123;PGW_script_path&#125;</span>/netcdf2grib.sh<br><span class="hljs-comment"># time sh $&#123;PGW_script_path&#125;/netcdf2grib_with_uv.sh</span><br><br><span class="hljs-comment"># cleanup</span><br><span class="hljs-built_in">rm</span> original-SL.grib original-PL.grib<br><span class="hljs-built_in">rm</span> original-SL_without_vars.grib original-PL_without_vars.grib<br><span class="hljs-built_in">rm</span> skt_final.grib skt.grib skt_nan.nc skt.nc <br><span class="hljs-built_in">rm</span> sst_final.grib sst.grib sst_nan.nc sst.nc<br><span class="hljs-built_in">rm</span> t_final.grib t.grib t_lev.grib t_nan.nc t.nc<br><span class="hljs-built_in">rm</span> r_final.grib r.grib r_lev.grib r_nan.nc r.nc<br><span class="hljs-built_in">rm</span> *idx<br><br><span class="hljs-comment"># soft-link (Finally, have to move all girb to there!)</span><br><span class="hljs-built_in">mkdir</span> -p <span class="hljs-variable">$&#123;PGW_ERA5_path&#125;</span>/<span class="hljs-variable">$&#123;yyyymm&#125;</span>/<span class="hljs-variable">$&#123;yyyymmdd&#125;</span>/<br>current_dir=$(<span class="hljs-built_in">pwd</span>)<br><span class="hljs-built_in">ln</span> -sf <span class="hljs-variable">$&#123;current_dir&#125;</span>/new_ERA5-0p25-SL-<span class="hljs-variable">$&#123;yyyymmddhh&#125;</span>.grib <span class="hljs-variable">$&#123;PGW_ERA5_path&#125;</span>/<span class="hljs-variable">$&#123;yyyymm&#125;</span>/<span class="hljs-variable">$&#123;yyyymmdd&#125;</span>/ERA5-0p25-SL-<span class="hljs-variable">$&#123;yyyymmddhh&#125;</span>.grib<br><span class="hljs-built_in">ln</span> -sf <span class="hljs-variable">$&#123;current_dir&#125;</span>/new_ERA5-0p25-PL-<span class="hljs-variable">$&#123;yyyymmddhh&#125;</span>.grib <span class="hljs-variable">$&#123;PGW_ERA5_path&#125;</span>/<span class="hljs-variable">$&#123;yyyymm&#125;</span>/<span class="hljs-variable">$&#123;yyyymmdd&#125;</span>/ERA5-0p25-PL-<span class="hljs-variable">$&#123;yyyymmddhh&#125;</span>.grib<br></code></pre></td></tr></table></figure>
        </div>
      </div>
    </div>
<h1 id="converting-era5-grib-to-netcdf-a-step-by-step-guide">Converting ERA5 GRIB to NetCDF: A Step-by-Step Guide</h1>
<h2 id="what-you-need">What You Need</h2>
<p>Before we begin, ensure you have the following:</p>
<ol type="1">
<li><strong>Python</strong>: A popular programming language for data manipulation.</li>
<li><p><strong>Libraries</strong>: You will need <code>xarray</code>, <code>cfgrib</code>, and <code>netCDF4</code>. You can install them using pip:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">micromamba <span class="hljs-built_in">env</span> create -n PGW<br>micromamba activate PGW<br>micromamba install python=3.11 -y<br>pip install xarray cfgrib netCDF4<br>micromamba install scipy -y<br>micromamba install conda-forge::cdo -y<br>micromamba install conda-forge::wgrib -y<br>micromamba install matplotlib -y<br></code></pre></td></tr></table></figure></li>
<li><strong>ERA5 GRIB File</strong>: Download your desired ERA5 dataset in GRIB format from the ECMWF website.</li>
<li>New tool (seems fine or for checking): <a target="_blank" rel="noopener" href="https://confluence.ecmwf.int/display/OIFS/How+to+convert+GRIB+to+netCDF">Convert GRIB file to netCDF</a>
<ol type="1">
<li><code>grib_to_netcdf ICMGG_hybrid.grb -o ICMGG_hybrid.nc</code></li>
<li><code>micromamba install conda-forge::eccodes -y</code></li>
</ol></li>
</ol>
<h2 id="steps-to-convert-grib-to-netcdf">Steps to Convert GRIB to NetCDF</h2>

    <div class="fold">
      <div class="fold-title fold-info collapsed" data-toggle="collapse" href="#collapse-9c51fa20" role="button" aria-expanded="false" aria-controls="collapse-9c51fa20">
        <div class="fold-arrow">▶</div>grib2netcdf.py
      </div>
      <div class="fold-collapse collapse" id="collapse-9c51fa20">
        <div class="fold-content">
          <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/bin/python</span><br><br><span class="hljs-comment">#------------------------------------------------#</span><br><span class="hljs-comment">#Author:         wpsze</span><br><span class="hljs-comment">#Email：         wpsze</span><br><span class="hljs-comment">#date:           2025-02-03 17:26:38</span><br><span class="hljs-comment">#Version:        0.0 </span><br><span class="hljs-comment">#Description:    The purpose of the script</span><br><span class="hljs-comment">#Copyright (C)： 2025 All rights reserved</span><br><span class="hljs-comment">#------------------------------------------------#</span><br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> xarray <span class="hljs-keyword">as</span> xr<br><br><span class="hljs-comment"># environment variable </span><br>yyyymmddhh = os.environ[<span class="hljs-string">&#x27;yyyymmddhh&#x27;</span>] <br><br><span class="hljs-comment">#============== SL =============================</span><br>grib_file = <span class="hljs-string">f&#x27;ERA5-0p25-SL-<span class="hljs-subst">&#123;yyyymmddhh&#125;</span>.grib&#x27;</span><br>ds = xr.open_dataset(grib_file, engine=<span class="hljs-string">&#x27;cfgrib&#x27;</span>)<br><br><span class="hljs-built_in">print</span>(ds)<br><br>output_file = <span class="hljs-string">f&#x27;ERA5-0p25-SL-<span class="hljs-subst">&#123;yyyymmddhh&#125;</span>.nc&#x27;</span><br>ds.to_netcdf(output_file)<br><br><span class="hljs-comment">#============== PL =============================</span><br>grib_file = <span class="hljs-string">f&#x27;ERA5-0p25-PL-<span class="hljs-subst">&#123;yyyymmddhh&#125;</span>.grib&#x27;</span><br>ds = xr.open_dataset(grib_file, engine=<span class="hljs-string">&#x27;cfgrib&#x27;</span>)<br><br><span class="hljs-built_in">print</span>(ds)<br><br>output_file = <span class="hljs-string">f&#x27;ERA5-0p25-PL-<span class="hljs-subst">&#123;yyyymmddhh&#125;</span>.nc&#x27;</span><br>ds.to_netcdf(output_file)<br></code></pre></td></tr></table></figure>
        </div>
      </div>
    </div>
<h2 id="verify-the-conversion">Verify the Conversion</h2>
<p>To ensure that the conversion was successful, you can reopen the NetCDF file and inspect its contents.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">ds_netcdf = xr.open_dataset(output_file)<br><span class="hljs-built_in">print</span>(ds_netcdf)<br></code></pre></td></tr></table></figure>
<h2 id="output">Output</h2>

    <div class="fold">
      <div class="fold-title fold-info collapsed" data-toggle="collapse" href="#collapse-90469042" role="button" aria-expanded="false" aria-controls="collapse-90469042">
        <div class="fold-arrow">▶</div>ERA5-SL.nc (Surface level)
      </div>
      <div class="fold-collapse collapse" id="collapse-90469042">
        <div class="fold-content">
          <figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><code class="hljs console">&lt;xarray.Dataset&gt; Size: 62MB<br>Dimensions:              (latitude: 721, longitude: 1440)<br>Coordinates:<br>    number               int64 8B ...<br>    time                 datetime64[ns] 8B ...<br>    step                 timedelta64[ns] 8B ...<br>    surface              float64 8B ...<br>  * latitude             (latitude) float64 6kB 90.0 89.75 89.5 ... -89.75 -90.0<br>  * longitude            (longitude) float64 12kB 0.0 0.25 0.5 ... 359.5 359.8<br>    valid_time           datetime64[ns] 8B ...<br>    depthBelowLandLayer  float64 8B ...<br>Data variables: (12/15)<br>    u10                  (latitude, longitude) float32 4MB ...<br>    v10                  (latitude, longitude) float32 4MB ...<br>    d2m                  (latitude, longitude) float32 4MB ...<br>    t2m                  (latitude, longitude) float32 4MB ...<br>    lsm                  (latitude, longitude) float32 4MB ...<br>    msl                  (latitude, longitude) float32 4MB ...<br>    ...                   ...<br>    rsn                  (latitude, longitude) float32 4MB ...<br>    sd                   (latitude, longitude) float32 4MB ...<br>    stl1                 (latitude, longitude) float32 4MB ...<br>    sp                   (latitude, longitude) float32 4MB ...<br>    swvl1                (latitude, longitude) float32 4MB ...<br>    z                    (latitude, longitude) float32 4MB ...<br>Attributes:<br>    GRIB_edition:            1<br>    GRIB_centre:             ecmf<br>    GRIB_centreDescription:  European Centre for Medium-Range Weather Forecasts<br>    GRIB_subCentre:          0<br>    Conventions:             CF-1.7<br>    institution:             European Centre for Medium-Range Weather Forecasts<br>    history:                 2025-02-05T09:50 GRIB to CDM+CF via cfgrib-0.9.1...<br><br>netcdf ERA5 &#123;<br>dimensions:<br>	latitude = 721 ;<br>	longitude = 1440 ;<br>variables:<br>	int64 number ;<br>		number:long_name = &quot;ensemble member numerical id&quot; ;<br>		number:standard_name = &quot;realization&quot; ;<br>	int64 time ;<br>		time:long_name = &quot;initial time of forecast&quot; ;<br>		time:standard_name = &quot;forecast_reference_time&quot; ;<br>	double step ;<br>		step:long_name = &quot;time since forecast_reference_time&quot; ;<br>		step:standard_name = &quot;forecast_period&quot; ;<br>	double surface ;<br>		surface:long_name = &quot;original GRIB coordinate for key: level(surface)&quot; ;<br>	double latitude(latitude) ;<br>		latitude:standard_name = &quot;latitude&quot; ;<br>		latitude:long_name = &quot;latitude&quot; ;<br>	double longitude(longitude) ;<br>		longitude:standard_name = &quot;longitude&quot; ;<br>		longitude:long_name = &quot;longitude&quot; ;<br>	double valid_time ;<br>		valid_time:standard_name = &quot;time&quot; ;<br>		valid_time:long_name = &quot;time&quot; ;<br>	float u10(latitude, longitude) ;<br>		u10:long_name = &quot;10 metre U wind component&quot; ;<br>		u10:standard_name = &quot;unknown&quot; ;<br>	float v10(latitude, longitude) ;<br>		v10:long_name = &quot;10 metre V wind component&quot; ;<br>		v10:standard_name = &quot;unknown&quot; ;<br>	float d2m(latitude, longitude) ;<br>		d2m:long_name = &quot;2 metre dewpoint temperature&quot; ;<br>		d2m:standard_name = &quot;unknown&quot; ;<br>	float t2m(latitude, longitude) ;<br>		t2m:long_name = &quot;2 metre temperature&quot; ;<br>		t2m:standard_name = &quot;unknown&quot; ;<br>	float lsm(latitude, longitude) ;<br>		lsm:long_name = &quot;Land-sea mask&quot; ;<br>		lsm:standard_name = &quot;land_binary_mask&quot; ;<br>	float msl(latitude, longitude) ;<br>		msl:long_name = &quot;Mean sea level pressure&quot; ;<br>		msl:standard_name = &quot;air_pressure_at_mean_sea_level&quot; ;<br>	float siconc(latitude, longitude) ;<br>		siconc:long_name = &quot;Sea ice area fraction&quot; ;<br>		siconc:standard_name = &quot;sea_ice_area_fraction&quot; ;<br>	float sst(latitude, longitude) ;<br>		sst:long_name = &quot;Sea surface temperature&quot; ;<br>		sst:standard_name = &quot;unknown&quot; ;<br>	float skt(latitude, longitude) ;<br>		skt:long_name = &quot;Skin temperature&quot; ;<br>		skt:standard_name = &quot;unknown&quot; ;<br>	float rsn(latitude, longitude) ;<br>		rsn:long_name = &quot;Snow density&quot; ;<br>		rsn:standard_name = &quot;unknown&quot; ;<br>	float sd(latitude, longitude) ;<br>		sd:long_name = &quot;Snow depth&quot; ;<br>		sd:standard_name = &quot;lwe_thickness_of_surface_snow_amount&quot; ;<br>	double depthBelowLandLayer ;<br>		depthBelowLandLayer:long_name = &quot;soil depth&quot; ;<br>		depthBelowLandLayer:standard_name = &quot;depth&quot; ;<br>	float stl1(latitude, longitude) ;<br>		stl1:long_name = &quot;Soil temperature level 1&quot; ;<br>		stl1:standard_name = &quot;surface_temperature&quot; ;<br>	float sp(latitude, longitude) ;<br>		sp:long_name = &quot;Surface pressure&quot; ;<br>		sp:standard_name = &quot;surface_air_pressure&quot; ;<br>	float swvl1(latitude, longitude) ;<br>		swvl1:long_name = &quot;Volumetric soil water layer 1&quot; ;<br>		swvl1:standard_name = &quot;unknown&quot; ;<br>	float z(latitude, longitude) ;<br>		z:long_name = &quot;Geopotential&quot; ;<br>		z:standard_name = &quot;geopotential&quot; ;<br></code></pre></td></tr></table></figure>
        </div>
      </div>
    </div>

    <div class="fold">
      <div class="fold-title fold-info collapsed" data-toggle="collapse" href="#collapse-738764b7" role="button" aria-expanded="false" aria-controls="collapse-738764b7">
        <div class="fold-arrow">▶</div>ERA5-PL.nc (Pressure level)
      </div>
      <div class="fold-collapse collapse" id="collapse-738764b7">
        <div class="fold-content">
          <figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><code class="hljs console">&lt;xarray.Dataset&gt; Size: 922MB<br>Dimensions:        (isobaricInhPa: 37, latitude: 721, longitude: 1440)<br>Coordinates:<br>    number         int64 8B ...<br>    time           datetime64[ns] 8B ...<br>    step           timedelta64[ns] 8B ...<br>  * isobaricInhPa  (isobaricInhPa) float64 296B 1e+03 975.0 950.0 ... 2.0 1.0<br>  * latitude       (latitude) float64 6kB 90.0 89.75 89.5 ... -89.5 -89.75 -90.0<br>  * longitude      (longitude) float64 12kB 0.0 0.25 0.5 ... 359.2 359.5 359.8<br>    valid_time     datetime64[ns] 8B ...<br>Data variables:<br>    z              (isobaricInhPa, latitude, longitude) float32 154MB ...<br>    r              (isobaricInhPa, latitude, longitude) float32 154MB ...<br>    q              (isobaricInhPa, latitude, longitude) float32 154MB ...<br>    t              (isobaricInhPa, latitude, longitude) float32 154MB ...<br>    u              (isobaricInhPa, latitude, longitude) float32 154MB ...<br>    v              (isobaricInhPa, latitude, longitude) float32 154MB ...<br>Attributes:<br>    GRIB_edition:            1<br>    GRIB_centre:             ecmf<br>    GRIB_centreDescription:  European Centre for Medium-Range Weather Forecasts<br>    GRIB_subCentre:          0<br>    Conventions:             CF-1.7<br>    institution:             European Centre for Medium-Range Weather Forecasts<br>    history:                 2025-02-05T09:45 GRIB to CDM+CF via cfgrib-0.9.1...<br><br>netcdf ERA5-PL &#123;<br>dimensions:<br>	isobaricInhPa = 37 ;<br>	latitude = 721 ;<br>	longitude = 1440 ;<br>variables:<br>	int64 number ;<br>		number:long_name = &quot;ensemble member numerical id&quot; ;<br>		number:standard_name = &quot;realization&quot; ;<br>	int64 time ;<br>		time:long_name = &quot;initial time of forecast&quot; ;<br>		time:standard_name = &quot;forecast_reference_time&quot; ;<br>	double step ;<br>		step:long_name = &quot;time since forecast_reference_time&quot; ;<br>		step:standard_name = &quot;forecast_period&quot; ;<br>	double isobaricInhPa(isobaricInhPa) ;<br>		isobaricInhPa:long_name = &quot;pressure&quot; ;<br>		isobaricInhPa:standard_name = &quot;air_pressure&quot; ;<br>	double latitude(latitude) ;<br>		latitude:standard_name = &quot;latitude&quot; ;<br>		latitude:long_name = &quot;latitude&quot; ;<br>	double longitude(longitude) ;<br>		longitude:standard_name = &quot;longitude&quot; ;<br>		longitude:long_name = &quot;longitude&quot; ;<br>	double valid_time ;<br>		valid_time:standard_name = &quot;time&quot; ;<br>		valid_time:long_name = &quot;time&quot; ;<br>	float z(isobaricInhPa, latitude, longitude) ;<br>		z:long_name = &quot;Geopotential&quot; ;<br>		z:standard_name = &quot;geopotential&quot; ;<br>	float r(isobaricInhPa, latitude, longitude) ;<br>		r:long_name = &quot;Relative humidity&quot; ;<br>		r:standard_name = &quot;relative_humidity&quot; ;<br>	float q(isobaricInhPa, latitude, longitude) ;<br>		q:long_name = &quot;Specific humidity&quot; ;<br>		q:standard_name = &quot;specific_humidity&quot; ;<br>	float t(isobaricInhPa, latitude, longitude) ;<br>		t:long_name = &quot;Temperature&quot; ;<br>		t:standard_name = &quot;air_temperature&quot; ;<br>	float u(isobaricInhPa, latitude, longitude) ;<br>		u:long_name = &quot;U component of wind&quot; ;<br>		u:standard_name = &quot;eastward_wind&quot; ;<br>	float v(isobaricInhPa, latitude, longitude) ;<br>		v:long_name = &quot;V component of wind&quot; ;<br>		v:standard_name = &quot;northward_wind&quot; ;<br></code></pre></td></tr></table></figure>
        </div>
      </div>
    </div>
<h2 id="additional-resources">Additional Resources</h2>
<ul>
<li><a target="_blank" rel="noopener" href="https://docs.xarray.dev/en/stable/">xarray Documentation</a></li>
<li><a target="_blank" rel="noopener" href="https://cfgrib.readthedocs.io/en/latest/">cfgrib Documentation</a></li>
<li><a target="_blank" rel="noopener" href="https://www.ecmwf.int/en/forecasts/datasets/reanalysis-datasets/era5">ERA5 Data Access</a></li>
</ul>
<hr />
<h1 id="interpolating-2d-sstskt-from-signal-netcdf-to-era5-netcdf">Interpolating 2D SST/SKT from Signal NetCDF to ERA5 NetCDF</h1>
<p>Here’s a Python script for interpolating Sea Surface Temperature (SST) and Surface Skin Temperature (SKT) from a signal NetCDF file to match the ERA5 grid. This process involves horizontal interpolation to ensure that the temperatures align accurately with the finer resolution of the ERA5 dataset. Accurate temperature data is crucial for climate modeling and analysis. By interpolating these temperatures, we can effectively integrate them into broader climate studies.</p>
<h2 id="manipulate-signal.nc">Manipulate signal.nc</h2>
<div class="note note-primary">
            <p>Modify <code>signal.nc</code> because the original signal.nc is not properly defined in a format recognized by CDO, making it impossible to apply CDO command tools.</p>
          </div>

    <div class="fold">
      <div class="fold-title fold-info collapsed" data-toggle="collapse" href="#collapse-dfb167e8" role="button" aria-expanded="false" aria-controls="collapse-dfb167e8">
        <div class="fold-arrow">▶</div>signal.nc
      </div>
      <div class="fold-collapse collapse" id="collapse-dfb167e8">
        <div class="fold-content">
          <figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs console">netcdf signal &#123;<br>dimensions:<br>	ncl0 = 14 ;<br>	ncl1 = 145 ;<br>	ncl2 = 288 ;<br>	ncl3 = 145 ;<br>	ncl4 = 288 ;<br>	ncl5 = 14 ;<br>	ncl6 = 145 ;<br>	ncl7 = 288 ;<br>	ncl8 = 14 ;<br>	ncl9 = 145 ;<br>	ncl10 = 288 ;<br>	ncl11 = 14 ;<br>	ncl12 = 145 ;<br>	ncl13 = 288 ;<br>	ncl14 = 14 ;<br>	ncl15 = 145 ;<br>	ncl16 = 288 ;<br>variables:<br>	float diff_ta(ncl0, ncl1, ncl2) ;<br>	float diff_ts(ncl3, ncl4) ;<br>	float diff_rh(ncl5, ncl6, ncl7) ;<br>	float diff_ua(ncl8, ncl9, ncl10) ;<br>	float diff_va(ncl11, ncl12, ncl13) ;<br>	double lev(ncl14) ;<br>	double lat(ncl15) ;<br>	double lon(ncl16) ;<br>&#125;<br></code></pre></td></tr></table></figure>
        </div>
      </div>
    </div>
<h2 id="cdo">cdo</h2>
<p>Error: <code>cdo    remapbil (Abort): Unsupported generic coordinates (Variable: diff_ta)!</code></p>
<p>It is because <strong>lat/lon/lev are not well-defined</strong>.</p>
<ul>
<li>The original signal.nc is not well-defined file...</li>
<li>have to assign attrs of dimension,
<ul>
<li>isobaricInhPa = 37 ;</li>
<li>latitude = 721 ;</li>
<li>longitude = 1440 ;</li>
</ul></li>
<li>Probably you need to fix the missing values, too.</li>
</ul>

    <div class="fold">
      <div class="fold-title fold-info collapsed" data-toggle="collapse" href="#collapse-5d5d193e" role="button" aria-expanded="false" aria-controls="collapse-5d5d193e">
        <div class="fold-arrow">▶</div>rename_signal.py
      </div>
      <div class="fold-collapse collapse" id="collapse-5d5d193e">
        <div class="fold-content">
          <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/bin/python</span><br><br><span class="hljs-comment">#------------------------------------------------#</span><br><span class="hljs-comment">#Author:         wpsze</span><br><span class="hljs-comment">#Email：         wpsze</span><br><span class="hljs-comment">#date:           2025-02-07 17:37:01</span><br><span class="hljs-comment">#Version:        0.0 </span><br><span class="hljs-comment">#Description:    The purpose of the script</span><br><span class="hljs-comment">#Copyright (C)： 2025 All rights reserved</span><br><span class="hljs-comment">#------------------------------------------------#</span><br><br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">import</span> xarray <span class="hljs-keyword">as</span> xr<br><br><span class="hljs-comment"># Load the signal and ERA5 NetCDF files</span><br>signal_nc = xr.open_dataset(<span class="hljs-string">&#x27;signal.nc&#x27;</span>)      <span class="hljs-comment"># Replace with actual signal file path</span><br><br>signal_nc = signal_nc.rename(&#123;<span class="hljs-string">&#x27;ncl0&#x27;</span>: <span class="hljs-string">&#x27;level&#x27;</span>, <span class="hljs-string">&#x27;ncl1&#x27;</span>: <span class="hljs-string">&#x27;latitude&#x27;</span>, <span class="hljs-string">&#x27;ncl2&#x27;</span>: <span class="hljs-string">&#x27;longitude&#x27;</span>,<br>                              <span class="hljs-string">&#x27;ncl3&#x27;</span>: <span class="hljs-string">&#x27;latitude&#x27;</span>, <span class="hljs-string">&#x27;ncl4&#x27;</span>: <span class="hljs-string">&#x27;longitude&#x27;</span>,<br>                              <span class="hljs-string">&#x27;ncl5&#x27;</span>: <span class="hljs-string">&#x27;level&#x27;</span>, <span class="hljs-string">&#x27;ncl6&#x27;</span>: <span class="hljs-string">&#x27;latitude&#x27;</span>, <span class="hljs-string">&#x27;ncl7&#x27;</span>: <span class="hljs-string">&#x27;longitude&#x27;</span>,<br>                              <span class="hljs-string">&#x27;ncl8&#x27;</span>: <span class="hljs-string">&#x27;level&#x27;</span>, <span class="hljs-string">&#x27;ncl9&#x27;</span>: <span class="hljs-string">&#x27;latitude&#x27;</span>, <span class="hljs-string">&#x27;ncl10&#x27;</span>: <span class="hljs-string">&#x27;longitude&#x27;</span>,<br>                              <span class="hljs-string">&#x27;ncl11&#x27;</span>: <span class="hljs-string">&#x27;level&#x27;</span>, <span class="hljs-string">&#x27;ncl12&#x27;</span>: <span class="hljs-string">&#x27;latitude&#x27;</span>, <span class="hljs-string">&#x27;ncl13&#x27;</span>: <span class="hljs-string">&#x27;longitude&#x27;</span>,<br>                              <span class="hljs-string">&#x27;ncl14&#x27;</span>: <span class="hljs-string">&#x27;level&#x27;</span>, <span class="hljs-string">&#x27;ncl15&#x27;</span>: <span class="hljs-string">&#x27;latitude&#x27;</span>, <span class="hljs-string">&#x27;ncl16&#x27;</span>: <span class="hljs-string">&#x27;longitude&#x27;</span>,&#125;)<br><br><span class="hljs-comment"># Define dimensions</span><br>lev = signal_nc[<span class="hljs-string">&#x27;lev&#x27;</span>].values  <span class="hljs-comment"># Level dimension</span><br>lat = signal_nc[<span class="hljs-string">&#x27;lat&#x27;</span>].values  <span class="hljs-comment"># Latitude dimension</span><br>lon = signal_nc[<span class="hljs-string">&#x27;lon&#x27;</span>].values  <span class="hljs-comment"># Longitude dimension</span><br><br><span class="hljs-comment"># Create DataArrays</span><br>diff_ta = xr.DataArray(<br>    signal_nc[<span class="hljs-string">&#x27;diff_ta&#x27;</span>],<br>    dims=[<span class="hljs-string">&quot;level&quot;</span>, <span class="hljs-string">&quot;latitude&quot;</span>, <span class="hljs-string">&quot;longitude&quot;</span>],<br>    coords=&#123;<span class="hljs-string">&quot;level&quot;</span>: lev, <span class="hljs-string">&quot;latitude&quot;</span>: lat, <span class="hljs-string">&quot;longitude&quot;</span>: lon&#125;<br>)<br><br>diff_rh = xr.DataArray(<br>    signal_nc[<span class="hljs-string">&#x27;diff_rh&#x27;</span>],<br>    dims=[<span class="hljs-string">&quot;level&quot;</span>, <span class="hljs-string">&quot;latitude&quot;</span>, <span class="hljs-string">&quot;longitude&quot;</span>],<br>    coords=&#123;<span class="hljs-string">&quot;level&quot;</span>: lev, <span class="hljs-string">&quot;latitude&quot;</span>: lat, <span class="hljs-string">&quot;longitude&quot;</span>: lon&#125;<br>)<br><br>diff_ua = xr.DataArray(<br>    signal_nc[<span class="hljs-string">&#x27;diff_ua&#x27;</span>],<br>    dims=[<span class="hljs-string">&quot;level&quot;</span>, <span class="hljs-string">&quot;latitude&quot;</span>, <span class="hljs-string">&quot;longitude&quot;</span>],<br>    coords=&#123;<span class="hljs-string">&quot;level&quot;</span>: lev, <span class="hljs-string">&quot;latitude&quot;</span>: lat, <span class="hljs-string">&quot;longitude&quot;</span>: lon&#125;<br>)<br><br>diff_va = xr.DataArray(<br>    signal_nc[<span class="hljs-string">&#x27;diff_va&#x27;</span>],<br>    dims=[<span class="hljs-string">&quot;level&quot;</span>, <span class="hljs-string">&quot;latitude&quot;</span>, <span class="hljs-string">&quot;longitude&quot;</span>],<br>    coords=&#123;<span class="hljs-string">&quot;level&quot;</span>: lev, <span class="hljs-string">&quot;latitude&quot;</span>: lat, <span class="hljs-string">&quot;longitude&quot;</span>: lon&#125;<br>)<br><br>diff_ts = xr.DataArray(<br>    signal_nc[<span class="hljs-string">&#x27;diff_ts&#x27;</span>],<br>    dims=[<span class="hljs-string">&quot;latitude&quot;</span>, <span class="hljs-string">&quot;longitude&quot;</span>],<br>    coords=&#123;<span class="hljs-string">&quot;latitude&quot;</span>: lat, <span class="hljs-string">&quot;longitude&quot;</span>: lon&#125;<br>)<br><br><span class="hljs-comment"># Combine into a Dataset</span><br>test = xr.Dataset(&#123;<br>    <span class="hljs-string">&quot;diff_ta&quot;</span>: diff_ta,<br>    <span class="hljs-string">&quot;diff_rh&quot;</span>: diff_rh,<br>    <span class="hljs-string">&quot;diff_ua&quot;</span>: diff_ua,<br>    <span class="hljs-string">&quot;diff_va&quot;</span>: diff_va,<br>    <span class="hljs-string">&quot;diff_ts&quot;</span>: diff_ts<br>&#125;)<br><br>test[<span class="hljs-string">&#x27;latitude&#x27;</span>] = test[<span class="hljs-string">&#x27;latitude&#x27;</span>].assign_attrs(		<br>                standard_name = <span class="hljs-string">&quot;latitude&quot;</span>,<br>		long_name = <span class="hljs-string">&quot;latitude&quot;</span>,<br>		units = <span class="hljs-string">&quot;degrees_north&quot;</span>,<br>		axis = <span class="hljs-string">&quot;Y&quot;</span> )<br>test[<span class="hljs-string">&#x27;longitude&#x27;</span>] = test[<span class="hljs-string">&#x27;longitude&#x27;</span>].assign_attrs(<br>                standard_name = <span class="hljs-string">&quot;longitude&quot;</span>,<br>		long_name = <span class="hljs-string">&quot;longitude&quot;</span>,<br>		units = <span class="hljs-string">&quot;degrees_east&quot;</span>,<br>		axis = <span class="hljs-string">&quot;X&quot;</span>)<br><br>test[<span class="hljs-string">&#x27;level&#x27;</span>] = test[<span class="hljs-string">&#x27;level&#x27;</span>].assign_attrs(<br>                standard_name = <span class="hljs-string">&quot;air_pressure&quot;</span>,<br>		long_name = <span class="hljs-string">&quot;pressure&quot;</span>,<br>		units = <span class="hljs-string">&quot;Pa&quot;</span>,<br>		positive = <span class="hljs-string">&quot;down&quot;</span>,<br>		axis = <span class="hljs-string">&quot;Z&quot;</span>,<br>		stored_direction = <span class="hljs-string">&quot;decreasing&quot;</span>)<br>   <br><span class="hljs-comment">#================== Save =================================================</span><br><span class="hljs-comment"># Save the result to a new NetCDF file</span><br>test.to_netcdf(<span class="hljs-string">&#x27;signal.nc&#x27;</span>, <span class="hljs-built_in">format</span>=<span class="hljs-string">&#x27;NETCDF4&#x27;</span>)<br></code></pre></td></tr></table></figure>
        </div>
      </div>
    </div>
<p>and, regrid <code>singal.nc</code> to <strong>0.25deg</strong>,</p>
<figure class="highlight qml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs qml">cdo remapbil,r1440x721 <span class="hljs-keyword">signal</span><span class="hljs-string">.nc signal_0p25.nc</span><br></code></pre></td></tr></table></figure>
<h2 id="python-script">Python script</h2>

    <div class="fold">
      <div class="fold-title fold-info collapsed" data-toggle="collapse" href="#collapse-8e159bd8" role="button" aria-expanded="false" aria-controls="collapse-8e159bd8">
        <div class="fold-arrow">▶</div>2d_interp.py
      </div>
      <div class="fold-collapse collapse" id="collapse-8e159bd8">
        <div class="fold-content">
          <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/bin/python</span><br><br><span class="hljs-comment">#------------------------------------------------#</span><br><span class="hljs-comment">#Author:         wpsze</span><br><span class="hljs-comment">#Email：         wpsze</span><br><span class="hljs-comment">#date:           2025-02-04 16:34:39</span><br><span class="hljs-comment">#Version:        0.0 </span><br><span class="hljs-comment">#Description:    The purpose of the script</span><br><span class="hljs-comment">#Copyright (C)： 2025 All rights reserved</span><br><span class="hljs-comment">#------------------------------------------------#</span><br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">import</span> xarray <span class="hljs-keyword">as</span> xr<br><span class="hljs-comment"># from scipy.interpolate import interp1d</span><br><br><span class="hljs-comment"># environment variable </span><br>yyyymmddhh = os.environ[<span class="hljs-string">&#x27;yyyymmddhh&#x27;</span>] <br><br><span class="hljs-comment"># Load the signal and ERA5 NetCDF files</span><br>signal_nc = xr.open_dataset(<span class="hljs-string">&#x27;signal_0p25.nc&#x27;</span>)      <span class="hljs-comment"># Replace with actual signal file path</span><br>era5_nc = xr.open_dataset(<span class="hljs-string">&#x27;ERA5-SL.nc&#x27;</span>)          <span class="hljs-comment"># Replace with actual ERA5 file path</span><br><br><span class="hljs-comment"># Extract 2D SST variables</span><br>sst_signal = signal_nc[<span class="hljs-string">&#x27;diff_ts&#x27;</span>]  <span class="hljs-comment"># SST from signal file (2D array)</span><br>skt_signal = signal_nc[<span class="hljs-string">&#x27;diff_ts&#x27;</span>]  <span class="hljs-comment"># Skin temperature from signal file (2D array)</span><br>lat_signal = signal_nc[<span class="hljs-string">&#x27;lat&#x27;</span>]<br>lon_signal = signal_nc[<span class="hljs-string">&#x27;lon&#x27;</span>]<br><br>sst_era5 = era5_nc[<span class="hljs-string">&#x27;sst&#x27;</span>]       <span class="hljs-comment"># SST from ERA5 file (2D array)</span><br>skt_era5 = era5_nc[<span class="hljs-string">&#x27;skt&#x27;</span>]       <span class="hljs-comment"># Skin temperature from ERA5 file (2D array)</span><br><br><span class="hljs-comment">#================== SST ==================================================</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=== processing: SST &quot;</span>)<br><span class="hljs-comment"># Update dimensions for signal_sst.nc</span><br><span class="hljs-comment">#sst_signal = sst_signal.rename(&#123;&#x27;ncl3&#x27;: &#x27;latitude&#x27;, &#x27;ncl4&#x27;: &#x27;longitude&#x27;&#125;)</span><br><br><span class="hljs-comment"># # Reverse the SST data along the latitude dimension</span><br><span class="hljs-comment">#reversed_sst_signal = sst_signal[::-1, :]  # Assuming latitude is the first dimension</span><br><br><span class="hljs-comment"># # Update the coordinates to reflect the new latitude order</span><br><span class="hljs-comment">#reversed_latitude = lat_signal[::-1]  # Reverse latitude coordinates, from [-90,90] to [90,-90]</span><br><br><span class="hljs-comment"># # Update the SST variable to use the reversed latitude</span><br><span class="hljs-comment">#reversed_sst_signal = reversed_sst_signal.assign_coords(latitude=reversed_latitude.values, longitude=lon_signal.values)</span><br><br><span class="hljs-comment"># Define new latitude and longitude arrays for 0.25-degree grid</span><br><span class="hljs-comment"># Perform horizontal interpolation to 0.25-degree grid</span><br><span class="hljs-comment"># method (&#123;&quot;linear&quot;, &quot;nearest&quot;, &quot;zero&quot;, &quot;slinear&quot;, &quot;quadratic&quot;, </span><br><span class="hljs-comment"># &quot;cubic&quot;, &quot;quintic&quot;, &quot;polynomial&quot;, &quot;pchip&quot;, &quot;barycentric&quot;, &quot;krogh&quot;,</span><br><span class="hljs-comment"># &quot;akima&quot;, &quot;makima&quot;&#125;) – Interpolation method to use (see descriptions above). fill_value=&#x27;extrapolate&#x27;</span><br><span class="hljs-comment"># reversed_sst_signal = reversed_sst_signal.interp(latitude=sst_era5.coords[&#x27;latitude&#x27;].values, </span><br><span class="hljs-comment">#                                                  longitude=sst_era5.coords[&#x27;longitude&#x27;].values)</span><br><br><span class="hljs-comment"># Add signal to ERA5</span><br>era5_nc[<span class="hljs-string">&#x27;sst&#x27;</span>] = sst_era5 + sst_signal.values[::-<span class="hljs-number">1</span>,:] <span class="hljs-comment"># Reverse latitude coordinates, from [-90,90] to [90,-90]</span><br><br><span class="hljs-comment"># #================== skt ==================================================</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=== processing: Skin temperature &quot;</span>)<br><span class="hljs-comment"># # Update dimensions for signal_sst.nc</span><br><span class="hljs-comment"># skt_signal = skt_signal.rename(&#123;&#x27;ncl3&#x27;: &#x27;latitude&#x27;, &#x27;ncl4&#x27;: &#x27;longitude&#x27;&#125;)</span><br><br><span class="hljs-comment"># # Reverse the SST data along the latitude dimension</span><br><span class="hljs-comment">#reversed_skt_signal = skt_signal[::-1, :]  # Assuming latitude is the first dimension</span><br><br><span class="hljs-comment"># # Update the coordinates to reflect the new latitude order</span><br><span class="hljs-comment"># # reversed_latitude = lat_signal[::-1]  # Reverse latitude coordinates (Done before!!)</span><br><br><span class="hljs-comment"># # Update the SST variable to use the reversed latitude</span><br><span class="hljs-comment">#reversed_skt_signal = reversed_skt_signal.assign_coords(latitude=reversed_latitude.values, longitude=lon_signal.values)</span><br><br><span class="hljs-comment"># # Define new latitude and longitude arrays for 0.25-degree grid</span><br><span class="hljs-comment"># # Perform horizontal interpolation to 0.25-degree grid</span><br><span class="hljs-comment"># reversed_skt_signal = reversed_skt_signal.interp(latitude=sst_era5.coords[&#x27;latitude&#x27;].values, </span><br><span class="hljs-comment">#                                                  longitude=sst_era5.coords[&#x27;longitude&#x27;].values)</span><br><br><span class="hljs-comment"># # Add signal to ERA5</span><br>era5_nc[<span class="hljs-string">&#x27;skt&#x27;</span>] = skt_era5 + skt_signal.values[::-<span class="hljs-number">1</span>,:] <span class="hljs-comment"># Reverse latitude coordinates, from [-90,90] to [90,-90]</span><br><br><span class="hljs-comment">#================== Save =================================================</span><br><span class="hljs-comment"># Save the result to a new NetCDF file</span><br>era5_nc.to_netcdf(<span class="hljs-string">f&#x27;new_ERA5-0p25-SL-<span class="hljs-subst">&#123;yyyymmddhh&#125;</span>.nc&#x27;</span>)<br><br><span class="hljs-comment">##to_grib(era5_nc, &#x27;new_ERA5_SL.grib&#x27;) #, grib_keys=&#123;&#x27;centre&#x27;: &#x27;ecmf&#x27;&#125;)</span><br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Horizontal interpolation completed and save</span><br></code></pre></td></tr></table></figure>
        </div>
      </div>
    </div>
<h1 id="interpolating-3d-temperature-from-signal-netcdf-to-era5-netcdf">Interpolating 3D Temperature from Signal NetCDF to ERA5 NetCDF</h1>
<p>Here's a Python script for interpolating a 3D temperature field from a signal NetCDF file to match the grid of an ERA5 NetCDF file.</p>
<p>In this part, we will demonstrate how to interpolate a 3D temperature field (<code>ta</code>) from a signal NetCDF file to match the grid of an ERA5 NetCDF file containing its own 3D temperature field (<code>TT</code>). This process is essential for applying climate change signals to ERA5 data effectively.</p>
<h2 id="introduction-1">Introduction</h2>
<p>In this blog, we'll discuss how to interpolate a 3D temperature field (<code>ta</code>) from a signal NetCDF file to match the grid of an ERA5 NetCDF file, which contains a different temperature variable (<code>TT</code>). This procedure involves two main steps: vertical interpolation to align the vertical levels and horizontal interpolation to match the latitude and longitude coordinates.</p>
<h2 id="motivation-1">Motivation</h2>
<p>By applying the Pseudo-Global-Warming (PGW) approach using CMIP6 climate change signals, we can generate a difference that can be added to the initial conditions like ERA5. Accurate interpolation is crucial for effective climate modeling and analysis.</p>
<h2 id="steps-for-interpolation">Steps for Interpolation</h2>
<ol type="1">
<li><strong>Vertical Interpolation</strong>: Adjust the temperature data from the signal file to the vertical levels of the ERA5 file.</li>
</ol>
<h3 id="python-script-1">Python Script</h3>

    <div class="fold">
      <div class="fold-title fold-info collapsed" data-toggle="collapse" href="#collapse-42d133e0" role="button" aria-expanded="false" aria-controls="collapse-42d133e0">
        <div class="fold-arrow">▶</div>ERA5 isobaricInhPa
      </div>
      <div class="fold-collapse collapse" id="collapse-42d133e0">
        <div class="fold-content">
          <figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs console">netcdf ERA5-PL &#123;<br>dimensions:<br>	isobaricInhPa = 37 ;<br>	latitude = 721 ;<br>	longitude = 1440 ;<br><br>	double isobaricInhPa(isobaricInhPa) ;<br>		isobaricInhPa:_FillValue = NaN ;<br>		isobaricInhPa:long_name = &quot;pressure&quot; ;<br>		isobaricInhPa:units = &quot;hPa&quot; ;<br>		isobaricInhPa:positive = &quot;down&quot; ;<br>		isobaricInhPa:stored_direction = &quot;decreasing&quot; ;<br>		isobaricInhPa:standard_name = &quot;air_pressure&quot; ;<br><br><br> isobaricInhPa = 1000, 975, 950, 925, 900, 875, 850, 825, 800, 775, 750, 700, <br>    650, 600, 550, 500, 450, 400, 350, 300, 250, 225, 200, 175, 150, 125, <br>    100, 70, 50, 30, 20, 10, 7, 5, 3, 2, 1 ;<br></code></pre></td></tr></table></figure>
        </div>
      </div>
    </div>

    <div class="fold">
      <div class="fold-title fold-info collapsed" data-toggle="collapse" href="#collapse-5bf6db73" role="button" aria-expanded="false" aria-controls="collapse-5bf6db73">
        <div class="fold-arrow">▶</div>Variables we need
      </div>
      <div class="fold-collapse collapse" id="collapse-5bf6db73">
        <div class="fold-content">
          <figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs console">float z(isobaricInhPa, latitude, longitude) ;<br>	z:GRIB_units = &quot;m**2 s**-2&quot; ;<br>	z:long_name = &quot;Geopotential&quot; ;<br>	z:standard_name = &quot;geopotential&quot; ;<br>float r(isobaricInhPa, latitude, longitude) ;<br>	r:GRIB_units = &quot;%&quot; ;<br>	r:long_name = &quot;Relative humidity&quot; ;<br>	r:standard_name = &quot;relative_humidity&quot; ;<br>float q(isobaricInhPa, latitude, longitude) ;<br>	q:GRIB_units = &quot;kg kg**-1&quot; ;<br>	q:long_name = &quot;Specific humidity&quot; ;<br>	q:standard_name = &quot;specific_humidity&quot; ;<br>float t(isobaricInhPa, latitude, longitude) ;<br>	t:GRIB_units = &quot;K&quot; ;<br>	t:long_name = &quot;Temperature&quot; ;<br>	t:standard_name = &quot;air_temperature&quot; ;<br>float u(isobaricInhPa, latitude, longitude) ;<br>	u:GRIB_units = &quot;m s**-1&quot; ;<br>	u:long_name = &quot;U component of wind&quot; ;<br>	u:standard_name = &quot;eastward_wind&quot; ;<br>float v(isobaricInhPa, latitude, longitude) ;<br>	v:GRIB_units = &quot;m s**-1&quot; ;<br>	v:long_name = &quot;V component of wind&quot; ;<br>	v:standard_name = &quot;northward_wind&quot; ;<br></code></pre></td></tr></table></figure>
        </div>
      </div>
    </div>
<p>Below is a Python script that performs the required interpolations.</p>

    <div class="fold">
      <div class="fold-title fold-info collapsed" data-toggle="collapse" href="#collapse-c21ca059" role="button" aria-expanded="false" aria-controls="collapse-c21ca059">
        <div class="fold-arrow">▶</div>3d_interp.py (Pressure level)
      </div>
      <div class="fold-collapse collapse" id="collapse-c21ca059">
        <div class="fold-content">
          <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/bin/python</span><br><br><span class="hljs-comment">#------------------------------------------------#</span><br><span class="hljs-comment">#Author:         wpsze</span><br><span class="hljs-comment">#Email：         wpsze</span><br><span class="hljs-comment">#date:           2025-02-04 16:31:50</span><br><span class="hljs-comment">#Version:        0.0 </span><br><span class="hljs-comment">#Description:    The purpose of the script</span><br><span class="hljs-comment">#Copyright (C)： 2025 All rights reserved</span><br><span class="hljs-comment">#------------------------------------------------#</span><br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">import</span> xarray <span class="hljs-keyword">as</span> xr<br><span class="hljs-keyword">from</span> scipy.interpolate <span class="hljs-keyword">import</span> interp1d<br><br><span class="hljs-comment"># environment variable </span><br>yyyymmddhh = os.environ[<span class="hljs-string">&#x27;yyyymmddhh&#x27;</span>] <br><br><span class="hljs-comment"># Load the signal and ERA5 NetCDF files</span><br>signal_nc = xr.open_dataset(<span class="hljs-string">&#x27;signal_0p25.nc&#x27;</span>)  <span class="hljs-comment"># Replace with actual signal file path</span><br>era5_nc = xr.open_dataset(<span class="hljs-string">&#x27;ERA5-PL.nc&#x27;</span>)   <span class="hljs-comment"># Replace with actual ERA5 file path</span><br><br><span class="hljs-comment">#================ Vertical levels =======================================</span><br><span class="hljs-comment"># Vertical levels</span><br>signal_levels = signal_nc[<span class="hljs-string">&#x27;level&#x27;</span>].values/<span class="hljs-number">100</span>            <span class="hljs-comment"># Vertical levels from signal file,  lev(ncl14), convert to hPa unit</span><br>lat_signal = signal_nc[<span class="hljs-string">&#x27;lat&#x27;</span>]<br>lon_signal = signal_nc[<span class="hljs-string">&#x27;lon&#x27;</span>]<br><br><span class="hljs-comment"># Update the coordinates to reflect the new latitude order</span><br>reversed_latitude = lat_signal[::-<span class="hljs-number">1</span>]  <span class="hljs-comment"># Reverse latitude coordinates, from [-90,90] to [90,-90]</span><br><br>era5_levels = era5_nc[<span class="hljs-string">&#x27;isobaricInhPa&#x27;</span>]          <span class="hljs-comment"># Vertical levels from ERA5 file, &#x27;level&#x27; if grib_to_netcdf, &#x27;isobaricInhPa&#x27; if xarray/cfgrib</span><br><br><span class="hljs-comment"># signal:</span><br><span class="hljs-comment">#[1000.  925.  850.  700.  600.  500.  400.  300.  250.  200.  150.  100.</span><br><span class="hljs-comment">#   70.   50.]</span><br><span class="hljs-comment"># ERA5:</span><br><span class="hljs-comment">#[1000.  975.  950.  925.  900.  875.  850.  825.  800.  775.  750.  700.</span><br><span class="hljs-comment">#  650.  600.  550.  500.  450.  400.  350.  300.  250.  225.  200.  175.</span><br><span class="hljs-comment">#  150.  125.  100.   70.   50.   30.   20.   10.    7.    5.    3.    2.</span><br><span class="hljs-comment">#    1.]</span><br><span class="hljs-comment"># Only add singals to specific levels and Convert to by era5_levels[1:29]</span><br><span class="hljs-comment"># [975. 950. 925. 900. 875. 850. 825. 800. 775. 750. 700. 650. 600. 550.</span><br><span class="hljs-comment"># 500. 450. 400. 350. 300. 250. 225. 200. 175. 150. 125. 100.  70.  50.]</span><br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;CMIP6 singal levels = <span class="hljs-subst">&#123;signal_levels&#125;</span>&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;era5_levels[1:29] = <span class="hljs-subst">&#123;era5_levels[<span class="hljs-number">1</span>:<span class="hljs-number">29</span>].values&#125;</span>&quot;</span>)<br><br><span class="hljs-comment">#================ Interpolation function ================================</span><br><span class="hljs-comment"># Interpolation function for vertical levels</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">vertical_interpolate</span>(<span class="hljs-params">var_3d, signal_levels, target_levels</span>):<br>    interpolated_temp = xr.DataArray(<br>        np.empty((target_levels.size, var_3d.shape[<span class="hljs-number">1</span>], var_3d.shape[<span class="hljs-number">2</span>])), <br>        dims=(<span class="hljs-string">&quot;isobaricInhPa&quot;</span>, <span class="hljs-string">&quot;latitude&quot;</span>, <span class="hljs-string">&quot;longitude&quot;</span>))<br>    interpolated_temp = interpolated_temp.assign_coords(isobaricInhPa=era5_levels.values, <br>                                                        latitude=reversed_latitude.values,<br>                                                        longitude=lon_signal.values)<br>    f = interp1d(signal_levels, var_3d[:, :, :], axis=<span class="hljs-number">0</span>, kind=<span class="hljs-string">&#x27;linear&#x27;</span>, fill_value=<span class="hljs-string">&#x27;extrapolate&#x27;</span>)<br>    interpolated_temp[:, :, :] = f(target_levels)<br>    <span class="hljs-keyword">return</span> interpolated_temp<br><br><span class="hljs-comment">#================ T air_temperature in K ================================</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=== processing: T air_temperature in K &quot;</span>)<br><br><span class="hljs-comment"># Extract variables</span><br>ta_signal = signal_nc[<span class="hljs-string">&#x27;diff_ta&#x27;</span>]    <span class="hljs-comment"># 3D temperature from signal file, diff_ta(ncl0, ncl1, ncl2)</span><br>TT_era5 = era5_nc[<span class="hljs-string">&#x27;t&#x27;</span>]              <span class="hljs-comment"># 3D temperature from ERA5 file, t(isobaricInhPa, latitude, longitude)</span><br><br><span class="hljs-comment"># Update dimensions</span><br>ta_signal = ta_signal.rename(&#123;<span class="hljs-string">&#x27;level&#x27;</span>: <span class="hljs-string">&#x27;isobaricInhPa&#x27;</span>, <span class="hljs-string">&#x27;lat&#x27;</span>: <span class="hljs-string">&#x27;latitude&#x27;</span>, <span class="hljs-string">&#x27;lon&#x27;</span>: <span class="hljs-string">&#x27;longitude&#x27;</span>&#125;)<br><br><span class="hljs-comment"># Reverse the TT data along the latitude dimension</span><br>reversed_ta_signal = ta_signal[:, ::-<span class="hljs-number">1</span>, :]  <span class="hljs-comment"># latitude is the second dimension</span><br><br><span class="hljs-comment"># Update the TT variable to use the reversed latitude</span><br>reversed_ta_signal = reversed_ta_signal.assign_coords(latitude=reversed_latitude.values, longitude=lon_signal.values)<br><br><span class="hljs-comment"># Perform vertical interpolation</span><br>interpolated_ta = vertical_interpolate(reversed_ta_signal, signal_levels, era5_levels)<br><br><span class="hljs-comment"># Define new latitude and longitude arrays for 0.25-degree grid</span><br><span class="hljs-comment"># Perform horizontal interpolation to 0.25-degree grid</span><br><span class="hljs-comment">## interpolated_ta = interpolated_ta.interp(latitude=TT_era5.coords[&#x27;latitude&#x27;].values, longitude=TT_era5.coords[&#x27;longitude&#x27;].values)</span><br><br><span class="hljs-comment"># Add signal to ERA5</span><br>era5_nc[<span class="hljs-string">&#x27;t&#x27;</span>][<span class="hljs-number">1</span>:<span class="hljs-number">29</span>,:,:] = TT_era5[<span class="hljs-number">1</span>:<span class="hljs-number">29</span>,:,:] + interpolated_ta[<span class="hljs-number">1</span>:<span class="hljs-number">29</span>,:,:]<br><br><span class="hljs-comment">#================ Relative Humidity (RH) in % ================================</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=== processing: Relative Humidity (RH) in % &quot;</span>)<br><br><span class="hljs-comment"># Extract variables</span><br>rh_signal = signal_nc[<span class="hljs-string">&#x27;diff_rh&#x27;</span>]    <span class="hljs-comment"># 3D RH from signal file, diff_ta(ncl5, ncl6, ncl7)</span><br>RH_era5 = era5_nc[<span class="hljs-string">&#x27;r&#x27;</span>]              <span class="hljs-comment"># 3D RH from ERA5 file, t(isobaricInhPa, latitude, longitude)</span><br><br><span class="hljs-comment"># Update dimensions</span><br>rh_signal = rh_signal.rename(&#123;<span class="hljs-string">&#x27;level&#x27;</span>: <span class="hljs-string">&#x27;isobaricInhPa&#x27;</span>, <span class="hljs-string">&#x27;lat&#x27;</span>: <span class="hljs-string">&#x27;latitude&#x27;</span>, <span class="hljs-string">&#x27;lon&#x27;</span>: <span class="hljs-string">&#x27;longitude&#x27;</span>&#125;)<br><br><span class="hljs-comment"># Reverse the RH data along the latitude dimension</span><br>reversed_rh_signal = rh_signal[:, ::-<span class="hljs-number">1</span>, :]  <span class="hljs-comment"># latitude is the second dimension</span><br><br><span class="hljs-comment"># Update the RH variable to use the reversed latitude</span><br>reversed_rh_signal = reversed_rh_signal.assign_coords(latitude=reversed_latitude.values, longitude=lon_signal.values)<br><br><span class="hljs-comment"># Perform vertical interpolation</span><br>interpolated_rh = vertical_interpolate(reversed_rh_signal, signal_levels, era5_levels)<br><br><span class="hljs-comment"># Define new latitude and longitude arrays for 0.25-degree grid</span><br><span class="hljs-comment"># Perform horizontal interpolation to 0.25-degree grid</span><br><span class="hljs-comment">##interpolated_rh = interpolated_rh.interp(latitude=RH_era5.coords[&#x27;latitude&#x27;].values, longitude=RH_era5.coords[&#x27;longitude&#x27;].values)</span><br><br><span class="hljs-comment"># Add signal to ERA5</span><br>era5_nc[<span class="hljs-string">&#x27;r&#x27;</span>][<span class="hljs-number">1</span>:<span class="hljs-number">29</span>,:,:] = RH_era5[<span class="hljs-number">1</span>:<span class="hljs-number">29</span>,:,:] + interpolated_rh[<span class="hljs-number">1</span>:<span class="hljs-number">29</span>,:,:]<br><br><span class="hljs-comment">#=============================================================================</span><br><br><span class="hljs-comment"># Save the result to a new NetCDF file</span><br>era5_nc.to_netcdf(<span class="hljs-string">f&#x27;new_ERA5-0p25-PL-<span class="hljs-subst">&#123;yyyymmddhh&#125;</span>.nc&#x27;</span>)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Interpolation completed and saved to &#x27;interpolated_ERA5-0p25-PL-<span class="hljs-subst">&#123;yyyymmddhh&#125;</span>.nc.&quot;</span>)<br></code></pre></td></tr></table></figure>
        </div>
      </div>
    </div>

    <div class="fold">
      <div class="fold-title fold-info collapsed" data-toggle="collapse" href="#collapse-98e16488" role="button" aria-expanded="false" aria-controls="collapse-98e16488">
        <div class="fold-arrow">▶</div>3d_interp_with_uv.py
      </div>
      <div class="fold-collapse collapse" id="collapse-98e16488">
        <div class="fold-content">
          <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/bin/python</span><br><br><span class="hljs-comment">#------------------------------------------------#</span><br><span class="hljs-comment">#Author:         wpsze</span><br><span class="hljs-comment">#Email：         wpsze</span><br><span class="hljs-comment">#date:           2025-02-04 16:31:50</span><br><span class="hljs-comment">#Version:        0.0 </span><br><span class="hljs-comment">#Description:    The purpose of the script</span><br><span class="hljs-comment">#Copyright (C)： 2025 All rights reserved</span><br><span class="hljs-comment">#------------------------------------------------#</span><br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">import</span> xarray <span class="hljs-keyword">as</span> xr<br><span class="hljs-keyword">from</span> scipy.interpolate <span class="hljs-keyword">import</span> interp1d<br><br><span class="hljs-comment"># environment variable </span><br>yyyymmddhh = os.environ[<span class="hljs-string">&#x27;yyyymmddhh&#x27;</span>] <br><br><span class="hljs-comment"># Load the signal and ERA5 NetCDF files</span><br>signal_nc = xr.open_dataset(<span class="hljs-string">&#x27;signal_0p25.nc&#x27;</span>)  <span class="hljs-comment"># Replace with actual signal file path</span><br>era5_nc = xr.open_dataset(<span class="hljs-string">f&#x27;ERA5-0p25-PL-<span class="hljs-subst">&#123;yyyymmddhh&#125;</span>.nc&#x27;</span>)   <span class="hljs-comment"># Replace with actual ERA5 file path</span><br><br><span class="hljs-comment">#================ Vertical levels =======================================</span><br><span class="hljs-comment"># Vertical levels</span><br>signal_levels = signal_nc[<span class="hljs-string">&#x27;level&#x27;</span>].values/<span class="hljs-number">100</span>            <span class="hljs-comment"># Vertical levels from signal file,  lev(ncl14), convert to hPa unit</span><br>lat_signal = signal_nc[<span class="hljs-string">&#x27;lat&#x27;</span>]<br>lon_signal = signal_nc[<span class="hljs-string">&#x27;lon&#x27;</span>]<br><br><span class="hljs-comment"># Update the coordinates to reflect the new latitude order</span><br>reversed_latitude = lat_signal[::-<span class="hljs-number">1</span>]  <span class="hljs-comment"># Reverse latitude coordinates, from [-90,90] to [90,-90]</span><br><br>era5_levels = era5_nc[<span class="hljs-string">&#x27;isobaricInhPa&#x27;</span>]          <span class="hljs-comment"># Vertical levels from ERA5 file, &#x27;level&#x27; if grib_to_netcdf, &#x27;isobaricInhPa&#x27; if xarray/cfgrib</span><br><br><span class="hljs-comment"># signal:</span><br><span class="hljs-comment">#[1000.  925.  850.  700.  600.  500.  400.  300.  250.  200.  150.  100.</span><br><span class="hljs-comment">#   70.   50.]</span><br><span class="hljs-comment"># ERA5:</span><br><span class="hljs-comment">#[1000.  975.  950.  925.  900.  875.  850.  825.  800.  775.  750.  700.</span><br><span class="hljs-comment">#  650.  600.  550.  500.  450.  400.  350.  300.  250.  225.  200.  175.</span><br><span class="hljs-comment">#  150.  125.  100.   70.   50.   30.   20.   10.    7.    5.    3.    2.</span><br><span class="hljs-comment">#    1.]</span><br><span class="hljs-comment"># Only add singals to specific levels and Convert to by era5_levels[1:29]</span><br><span class="hljs-comment"># [975. 950. 925. 900. 875. 850. 825. 800. 775. 750. 700. 650. 600. 550.</span><br><span class="hljs-comment"># 500. 450. 400. 350. 300. 250. 225. 200. 175. 150. 125. 100.  70.  50.]</span><br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;CMIP6 singal levels = <span class="hljs-subst">&#123;signal_levels&#125;</span>&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;era5_levels[1:29] = <span class="hljs-subst">&#123;era5_levels[<span class="hljs-number">1</span>:<span class="hljs-number">29</span>].values&#125;</span>&quot;</span>)<br><br><span class="hljs-comment">#================ Interpolation function ================================</span><br><span class="hljs-comment"># Interpolation function for vertical levels</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">vertical_interpolate</span>(<span class="hljs-params">var_3d, signal_levels, target_levels</span>):<br>    interpolated_temp = xr.DataArray(<br>        np.empty((target_levels.size, var_3d.shape[<span class="hljs-number">1</span>], var_3d.shape[<span class="hljs-number">2</span>])), <br>        dims=(<span class="hljs-string">&quot;isobaricInhPa&quot;</span>, <span class="hljs-string">&quot;latitude&quot;</span>, <span class="hljs-string">&quot;longitude&quot;</span>))<br>    interpolated_temp = interpolated_temp.assign_coords(isobaricInhPa=era5_levels.values, <br>                                                        latitude=reversed_latitude.values,<br>                                                        longitude=lon_signal.values)<br>    f = interp1d(signal_levels, var_3d[:, :, :], axis=<span class="hljs-number">0</span>, kind=<span class="hljs-string">&#x27;linear&#x27;</span>, fill_value=<span class="hljs-string">&#x27;extrapolate&#x27;</span>)<br>    interpolated_temp[:, :, :] = f(target_levels)<br>    <span class="hljs-keyword">return</span> interpolated_temp<br><br><span class="hljs-comment">#================ T air_temperature in K ================================</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=== processing: T air_temperature in K &quot;</span>)<br><br><span class="hljs-comment"># Extract variables</span><br>ta_signal = signal_nc[<span class="hljs-string">&#x27;diff_ta&#x27;</span>]    <span class="hljs-comment"># 3D temperature from signal file, diff_ta(ncl0, ncl1, ncl2)</span><br>TT_era5 = era5_nc[<span class="hljs-string">&#x27;t&#x27;</span>]              <span class="hljs-comment"># 3D temperature from ERA5 file, t(isobaricInhPa, latitude, longitude)</span><br><br><span class="hljs-comment"># Update dimensions</span><br>ta_signal = ta_signal.rename(&#123;<span class="hljs-string">&#x27;level&#x27;</span>: <span class="hljs-string">&#x27;isobaricInhPa&#x27;</span>, <span class="hljs-string">&#x27;lat&#x27;</span>: <span class="hljs-string">&#x27;latitude&#x27;</span>, <span class="hljs-string">&#x27;lon&#x27;</span>: <span class="hljs-string">&#x27;longitude&#x27;</span>&#125;)<br><br><span class="hljs-comment"># Reverse the TT data along the latitude dimension</span><br>reversed_ta_signal = ta_signal[:, ::-<span class="hljs-number">1</span>, :]  <span class="hljs-comment"># latitude is the second dimension, # Reverse latitude coordinates, from [-90,90] to [90,-90]</span><br><br><span class="hljs-comment"># Update the TT variable to use the reversed latitude</span><br>reversed_ta_signal = reversed_ta_signal.assign_coords(latitude=reversed_latitude.values, longitude=lon_signal.values)<br><br><span class="hljs-comment"># Perform vertical interpolation</span><br>interpolated_ta = vertical_interpolate(reversed_ta_signal, signal_levels, era5_levels)<br><br><span class="hljs-comment"># Define new latitude and longitude arrays for 0.25-degree grid</span><br><span class="hljs-comment"># Perform horizontal interpolation to 0.25-degree grid</span><br><span class="hljs-comment">## interpolated_ta = interpolated_ta.interp(latitude=TT_era5.coords[&#x27;latitude&#x27;].values, longitude=TT_era5.coords[&#x27;longitude&#x27;].values)</span><br><br><span class="hljs-comment"># Add signal to ERA5</span><br>era5_nc[<span class="hljs-string">&#x27;t&#x27;</span>][<span class="hljs-number">1</span>:<span class="hljs-number">29</span>,:,:] = TT_era5[<span class="hljs-number">1</span>:<span class="hljs-number">29</span>,:,:] + interpolated_ta[<span class="hljs-number">1</span>:<span class="hljs-number">29</span>,:,:]<br><br><span class="hljs-comment">#================ Relative Humidity (RH) in % ================================</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=== processing: Relative Humidity (RH) in % &quot;</span>)<br><br><span class="hljs-comment"># Extract variables</span><br>rh_signal = signal_nc[<span class="hljs-string">&#x27;diff_rh&#x27;</span>]    <span class="hljs-comment"># 3D RH from signal file, diff_ta(ncl5, ncl6, ncl7)</span><br>RH_era5 = era5_nc[<span class="hljs-string">&#x27;r&#x27;</span>]              <span class="hljs-comment"># 3D RH from ERA5 file, t(isobaricInhPa, latitude, longitude)</span><br><br><span class="hljs-comment"># Update dimensions</span><br>rh_signal = rh_signal.rename(&#123;<span class="hljs-string">&#x27;level&#x27;</span>: <span class="hljs-string">&#x27;isobaricInhPa&#x27;</span>, <span class="hljs-string">&#x27;lat&#x27;</span>: <span class="hljs-string">&#x27;latitude&#x27;</span>, <span class="hljs-string">&#x27;lon&#x27;</span>: <span class="hljs-string">&#x27;longitude&#x27;</span>&#125;)<br><br><span class="hljs-comment"># Reverse the RH data along the latitude dimension</span><br>reversed_rh_signal = rh_signal[:, ::-<span class="hljs-number">1</span>, :]  <span class="hljs-comment"># latitude is the second dimension, # Reverse latitude coordinates, from [-90,90] to [90,-90]</span><br><br><span class="hljs-comment"># Update the RH variable to use the reversed latitude</span><br>reversed_rh_signal = reversed_rh_signal.assign_coords(latitude=reversed_latitude.values, longitude=lon_signal.values)<br><br><span class="hljs-comment"># Perform vertical interpolation</span><br>interpolated_rh = vertical_interpolate(reversed_rh_signal, signal_levels, era5_levels)<br><br><span class="hljs-comment"># Define new latitude and longitude arrays for 0.25-degree grid</span><br><span class="hljs-comment"># Perform horizontal interpolation to 0.25-degree grid</span><br><span class="hljs-comment">##interpolated_rh = interpolated_rh.interp(latitude=RH_era5.coords[&#x27;latitude&#x27;].values, longitude=RH_era5.coords[&#x27;longitude&#x27;].values)</span><br><br><span class="hljs-comment"># Add signal to ERA5</span><br>era5_nc[<span class="hljs-string">&#x27;r&#x27;</span>][<span class="hljs-number">1</span>:<span class="hljs-number">29</span>,:,:] = RH_era5[<span class="hljs-number">1</span>:<span class="hljs-number">29</span>,:,:] + interpolated_rh[<span class="hljs-number">1</span>:<span class="hljs-number">29</span>,:,:]<br><br><span class="hljs-comment">#================ u eastward_wind ================================</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=== processing: u eastward_wind (m s**-1) &quot;</span>)<br><br><span class="hljs-comment"># Extract variables</span><br>ua_signal = signal_nc[<span class="hljs-string">&#x27;diff_ua&#x27;</span>]    <span class="hljs-comment"># 3D diff_ua from signal file, diff_ua(level, latitude, longitude)</span><br>u_era5 = era5_nc[<span class="hljs-string">&#x27;u&#x27;</span>]              <span class="hljs-comment"># 3D u from ERA5 file, u(isobaricInhPa, latitude, longitude)</span><br><br><span class="hljs-comment"># Update dimensions</span><br>ua_signal = ua_signal.rename(&#123;<span class="hljs-string">&#x27;level&#x27;</span>: <span class="hljs-string">&#x27;isobaricInhPa&#x27;</span>, <span class="hljs-string">&#x27;lat&#x27;</span>: <span class="hljs-string">&#x27;latitude&#x27;</span>, <span class="hljs-string">&#x27;lon&#x27;</span>: <span class="hljs-string">&#x27;longitude&#x27;</span>&#125;)<br><br><span class="hljs-comment"># Reverse the RH data along the latitude dimension</span><br>reversed_ua_signal = ua_signal[:, ::-<span class="hljs-number">1</span>, :]  <span class="hljs-comment"># latitude is the second dimension, # Reverse latitude coordinates, from [-90,90] to [90,-90]</span><br><br><span class="hljs-comment"># Update the RH variable to use the reversed latitude</span><br>reversed_ua_signal = reversed_ua_signal.assign_coords(latitude=reversed_latitude.values, longitude=lon_signal.values)<br><br><span class="hljs-comment"># Perform vertical interpolation</span><br>interpolated_ua = vertical_interpolate(reversed_ua_signal, signal_levels, era5_levels)<br><br><span class="hljs-comment"># Define new latitude and longitude arrays for 0.25-degree grid</span><br><span class="hljs-comment"># Perform horizontal interpolation to 0.25-degree grid</span><br><span class="hljs-comment">##interpolated_rh = interpolated_rh.interp(latitude=RH_era5.coords[&#x27;latitude&#x27;].values, longitude=RH_era5.coords[&#x27;longitude&#x27;].values)</span><br><br><span class="hljs-comment"># Add signal to ERA5</span><br>era5_nc[<span class="hljs-string">&#x27;u&#x27;</span>][<span class="hljs-number">1</span>:<span class="hljs-number">29</span>,:,:] = u_era5[<span class="hljs-number">1</span>:<span class="hljs-number">29</span>,:,:] + interpolated_ua[<span class="hljs-number">1</span>:<span class="hljs-number">29</span>,:,:]<br><br><span class="hljs-comment">#================ v northward_wind ================================</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=== processing: v northward_wind (m s**-1) &quot;</span>)<br><br><span class="hljs-comment"># Extract variables</span><br>va_signal = signal_nc[<span class="hljs-string">&#x27;diff_va&#x27;</span>]    <span class="hljs-comment"># 3D diff_va from signal file, diff_va(level, latitude, longitude)</span><br>v_era5 = era5_nc[<span class="hljs-string">&#x27;v&#x27;</span>]              <span class="hljs-comment"># 3D v from ERA5 file, u(isobaricInhPa, latitude, longitude)</span><br><br><span class="hljs-comment"># Update dimensions</span><br>va_signal = va_signal.rename(&#123;<span class="hljs-string">&#x27;level&#x27;</span>: <span class="hljs-string">&#x27;isobaricInhPa&#x27;</span>, <span class="hljs-string">&#x27;lat&#x27;</span>: <span class="hljs-string">&#x27;latitude&#x27;</span>, <span class="hljs-string">&#x27;lon&#x27;</span>: <span class="hljs-string">&#x27;longitude&#x27;</span>&#125;)<br><br><span class="hljs-comment"># Reverse the RH data along the latitude dimension</span><br>reversed_va_signal = va_signal[:, ::-<span class="hljs-number">1</span>, :]  <span class="hljs-comment"># latitude is the second dimension, # Reverse latitude coordinates, from [-90,90] to [90,-90]</span><br><br><span class="hljs-comment"># Update the RH variable to use the reversed latitude</span><br>reversed_va_signal = reversed_va_signal.assign_coords(latitude=reversed_latitude.values, longitude=lon_signal.values)<br><br><span class="hljs-comment"># Perform vertical interpolation</span><br>interpolated_va = vertical_interpolate(reversed_va_signal, signal_levels, era5_levels)<br><br><span class="hljs-comment"># Define new latitude and longitude arrays for 0.25-degree grid</span><br><span class="hljs-comment"># Perform horizontal interpolation to 0.25-degree grid</span><br><span class="hljs-comment">##interpolated_rh = interpolated_rh.interp(latitude=RH_era5.coords[&#x27;latitude&#x27;].values, longitude=RH_era5.coords[&#x27;longitude&#x27;].values)</span><br><br><span class="hljs-comment"># Add signal to ERA5</span><br>era5_nc[<span class="hljs-string">&#x27;v&#x27;</span>][<span class="hljs-number">1</span>:<span class="hljs-number">29</span>,:,:] = v_era5[<span class="hljs-number">1</span>:<span class="hljs-number">29</span>,:,:] + interpolated_va[<span class="hljs-number">1</span>:<span class="hljs-number">29</span>,:,:]<br><br><span class="hljs-comment">#=============================================================================</span><br><br><span class="hljs-comment"># Save the result to a new NetCDF file</span><br>era5_nc.to_netcdf(<span class="hljs-string">f&#x27;new_ERA5-0p25-PL-<span class="hljs-subst">&#123;yyyymmddhh&#125;</span>.nc&#x27;</span>)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Interpolation completed and saved to &#x27;interpolated_ERA5-0p25-PL-<span class="hljs-subst">&#123;yyyymmddhh&#125;</span>.nc.&quot;</span>)<br></code></pre></td></tr></table></figure>
        </div>
      </div>
    </div>
<h3 id="explanation-of-the-code">Explanation of the Code</h3>
<ol type="1">
<li><strong>Loading Data</strong>: The script uses <code>xarray</code> to load the signal and ERA5 NetCDF files.</li>
<li><strong>Vertical Interpolation</strong>: A function (<code>vertical_interpolate</code>) is defined to perform linear interpolation on the vertical levels of the temperature data.</li>
<li><strong>Saving the Result</strong>: The interpolated temperature data is saved to a new NetCDF file.</li>
</ol>
<h2 id="conclusion">Conclusion</h2>
<p>This interpolation approach allows for aligning temperature data from different datasets, which is essential for climate modeling. By accurately matching the grids of the signal and ERA5 data, we can effectively analyze and apply climate change signals in our research.</p>
<hr />
<h1 id="converting-netcdf-files-back-to-grib-format-a-step-by-step-guide">Converting NetCDF Files back to GRIB Format: A Step-by-Step Guide</h1>
<h2 id="introduction-2">Introduction</h2>
<p>In the realm of climate data analysis, the ability to convert between different file formats is essential. While NetCDF is widely used for storing multidimensional scientific data, GRIB (Generalized Regularly-distributed Information in Binary form) is prevalent in meteorological applications. This blog will guide you through the process of converting NetCDF files back to GRIB format, ensuring you're equipped to handle various data formats in your climate studies.</p>
<h2 id="motivation-2">Motivation</h2>
<p>The motivation behind converting NetCDF files to GRIB format can stem from several factors:</p>
<ul>
<li><strong>Compatibility</strong>: Many meteorological models and tools predominantly use GRIB format. Converting your NetCDF data ensures compatibility with these systems.</li>
<li><strong>Efficiency</strong>: GRIB files are often more compact than their NetCDF counterparts, making them easier to store and share, especially when dealing with large datasets.</li>
<li><strong>Standardization</strong>: For specific applications, adhering to a standard format like GRIB can enhance data interoperability across different platforms and tools.</li>
</ul>
<h2 id="麻煩了">麻煩了</h2>
<p><strong>這一步真是麻煩太多了</strong></p>
<p>Move to <a href="https://waipangsze.github.io/2025/02/05/NWP-PGW-To-prepare-the-ERA5-GRIB-file/"><strong>NWP | PGW | To prepare the ERA5 GRIB file</strong></a></p>
<h2 id="verify-the-conversion-1">Verify the Conversion</h2>
<p>After conversion, it’s crucial to verify that the GRIB file has been created correctly. You can do this by checking the contents:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">grib_ls output_file.grib<br></code></pre></td></tr></table></figure>
<h2 id="verify-the-initial-condition">Verify the initial condition</h2>
<p>To plot the vertical profiles of the given data, we can use Python with the matplotlib library. Here's how visualize the profiles of signal_1p25, signal_0p25, diff_era5 and diff-MPAS-init.nc against the specified levels.</p>

    <div class="fold">
      <div class="fold-title fold-info collapsed" data-toggle="collapse" href="#collapse-4f34dce5" role="button" aria-expanded="false" aria-controls="collapse-4f34dce5">
        <div class="fold-arrow">▶</div>check_plot.py
      </div>
      <div class="fold-collapse collapse" id="collapse-4f34dce5">
        <div class="fold-content">
          <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/bin/python</span><br><br><span class="hljs-comment">#------------------------------------------------#</span><br><span class="hljs-comment">#Author:         wpsze</span><br><span class="hljs-comment">#Email：         wpsze</span><br><span class="hljs-comment">#date:           2025-02-06 08:54:13</span><br><span class="hljs-comment">#Version:        0.0 </span><br><span class="hljs-comment">#Description:    The purpose of the script</span><br><span class="hljs-comment">#Copyright (C)： 2025 All rights reserved</span><br><span class="hljs-comment">#------------------------------------------------#</span><br><br><span class="hljs-keyword">import</span> xarray <span class="hljs-keyword">as</span> xr<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<br><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt<br><br>SMALL_SIZE = <span class="hljs-number">8</span><br>MEDIUM_SIZE = <span class="hljs-number">10</span><br>BIGGER_SIZE = <span class="hljs-number">24</span><br><br>plt.rcParams[<span class="hljs-string">&quot;figure.figsize&quot;</span>] = (<span class="hljs-number">10</span>,<span class="hljs-number">8</span>)<br>plt.rc(<span class="hljs-string">&#x27;font&#x27;</span>, size=BIGGER_SIZE)          <span class="hljs-comment"># controls default text sizes</span><br>plt.rc(<span class="hljs-string">&#x27;axes&#x27;</span>, titlesize=BIGGER_SIZE)     <span class="hljs-comment"># fontsize of the axes title</span><br>plt.rc(<span class="hljs-string">&#x27;axes&#x27;</span>, labelsize=BIGGER_SIZE)    <span class="hljs-comment"># fontsize of the x and y labels</span><br>plt.rc(<span class="hljs-string">&#x27;xtick&#x27;</span>, labelsize=BIGGER_SIZE)    <span class="hljs-comment"># fontsize of the tick labels</span><br>plt.rc(<span class="hljs-string">&#x27;ytick&#x27;</span>, labelsize=BIGGER_SIZE)    <span class="hljs-comment"># fontsize of the tick labels</span><br>plt.rc(<span class="hljs-string">&#x27;legend&#x27;</span>, fontsize=BIGGER_SIZE)    <span class="hljs-comment"># legend fontsize</span><br>plt.rc(<span class="hljs-string">&#x27;figure&#x27;</span>, titlesize=BIGGER_SIZE)  <span class="hljs-comment"># fontsize of the figure title</span><br><br><span class="hljs-comment">#=================================================================</span><br>yyyymmddhh = <span class="hljs-string">&quot;2022063000&quot;</span><br><br><span class="hljs-comment">#============== signal 1.25 deg =============================</span><br>dsignal = xr.open_dataset(<span class="hljs-string">&quot;signal.nc&quot;</span>)<br><br><span class="hljs-comment">#============== signal 0.25 deg =============================</span><br>dsignal_0p25 = xr.open_dataset(<span class="hljs-string">&quot;signal_0p25.nc&quot;</span>)<br><br><span class="hljs-comment">#============== SL/PL =============================</span><br>original_SL_file = xr.open_dataset(<span class="hljs-string">f&quot;ERA5-0p25-SL-<span class="hljs-subst">&#123;yyyymmddhh&#125;</span>.nc&quot;</span>)<br>new_SL_file = xr.open_dataset(<span class="hljs-string">f&quot;new_ERA5-0p25-SL-<span class="hljs-subst">&#123;yyyymmddhh&#125;</span>.nc&quot;</span>)<br><span class="hljs-comment"># original_PL_file = xr.open_dataset(f&quot;ERA5-0p25-SL-&#123;yyyymmddhh&#125;.nc&quot;)</span><br><span class="hljs-comment"># new_PL_file = xr.open_dataset(f&quot;new_ERA5-0p25-SL-&#123;yyyymmddhh&#125;.nc&quot;)</span><br>diff_PL = xr.open_dataset(<span class="hljs-string">&quot;diff_pl.nc&quot;</span>) <span class="hljs-comment"># ncdiff new_PL.nc PL.nc</span><br><br><span class="hljs-comment">#============== MPAS init.nc diff =============================</span><br>diff_init = xr.open_dataset(<span class="hljs-string">&quot;diff_init.nc&quot;</span>) <span class="hljs-comment"># ncdiff xx.nc xx.nc</span><br><br><span class="hljs-comment"># diff_init[&quot;skintemp&quot;].shape</span><br><span class="hljs-comment"># (1, 40962)</span><br><span class="hljs-comment"># diff_init[&quot;theta&quot;].shape</span><br><span class="hljs-comment"># (1, 40962, 55)</span><br><span class="hljs-comment">#============== SST &amp; SKT =============================</span><br>tmp = np.nanmean(dsignal[<span class="hljs-string">&quot;diff_ts&quot;</span>].values)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;signal diff_ts 1.25deg nanmean = <span class="hljs-subst">&#123;tmp&#125;</span>&quot;</span>)<br><br>tmp = np.nanmean(dsignal_0p25[<span class="hljs-string">&quot;diff_ts&quot;</span>].values)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;signal diff_ts 0.25deg nanmean = <span class="hljs-subst">&#123;tmp&#125;</span>&quot;</span>)<br><br>tmp = new_SL_file[<span class="hljs-string">&quot;sst&quot;</span>].values - original_SL_file[<span class="hljs-string">&quot;sst&quot;</span>].values<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;diff EAR5 (future-past) SST = <span class="hljs-subst">&#123;np.nanmean(tmp)&#125;</span>&quot;</span>)<br><br>tmp = new_SL_file[<span class="hljs-string">&quot;skt&quot;</span>].values - original_SL_file[<span class="hljs-string">&quot;skt&quot;</span>].values<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;diff EAR5 (future-past) SKT = <span class="hljs-subst">&#123;np.nanmean(tmp)&#125;</span>&quot;</span>)<br><br>tmp = diff_init[<span class="hljs-string">&quot;skintemp&quot;</span>]<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;diff init (future-past) skintemp = <span class="hljs-subst">&#123;np.nanmean(tmp)&#125;</span>&quot;</span>)<br><span class="hljs-comment">#============== vertial =============================</span><br><span class="hljs-comment"># Extract the variable &#x27;ta&#x27; (ensure to adjust the variable name if it&#x27;s different)</span><br>ta_signal = dsignal[<span class="hljs-string">&#x27;diff_ta&#x27;</span>]<br>ta_signal_0p25 = dsignal_0p25[<span class="hljs-string">&#x27;diff_ta&#x27;</span>]<br>ta_era5 = diff_PL[<span class="hljs-string">&#x27;t&#x27;</span>]<br><br><span class="hljs-comment"># Assuming the vertical dimension is named &#x27;level&#x27; or &#x27;plev&#x27;; adjust as necessary</span><br>levels = ta_signal[<span class="hljs-string">&#x27;level&#x27;</span>].values  <span class="hljs-comment"># Adjust depending on your dimensions</span><br>levels_era5 = diff_PL[<span class="hljs-string">&#x27;isobaricInhPa&#x27;</span>].values  <span class="hljs-comment"># Adjust depending on your dimensions</span><br><br><span class="hljs-comment"># Plotting</span><br>plt.figure(figsize=(<span class="hljs-number">10</span>, <span class="hljs-number">6</span>))<br><br><span class="hljs-comment"># Plot each profile</span><br>plt.plot(ta_era5.sel(isobaricInhPa=levels_era5).mean(dim=<span class="hljs-string">&#x27;latitude&#x27;</span>).mean(dim=<span class="hljs-string">&#x27;longitude&#x27;</span>), levels_era5, label=<span class="hljs-string">&#x27;ERA5&#x27;</span>, color=<span class="hljs-string">&#x27;green&#x27;</span>, marker = <span class="hljs-string">&#x27;o&#x27;</span>)<br>plt.plot(ta_signal.sel(level=levels).mean(dim=<span class="hljs-string">&#x27;latitude&#x27;</span>).mean(dim=<span class="hljs-string">&#x27;longitude&#x27;</span>), levels/<span class="hljs-number">100</span>, label=<span class="hljs-string">&#x27;Signal&#x27;</span>, color=<span class="hljs-string">&#x27;blue&#x27;</span>, marker = <span class="hljs-string">&#x27;o&#x27;</span>)<br>plt.plot(ta_signal_0p25.sel(level=levels).mean(dim=<span class="hljs-string">&#x27;lat&#x27;</span>).mean(dim=<span class="hljs-string">&#x27;lon&#x27;</span>), levels/<span class="hljs-number">100</span>, label=<span class="hljs-string">&#x27;Signal 0.25°&#x27;</span>, color=<span class="hljs-string">&#x27;orange&#x27;</span>, marker = <span class="hljs-string">&#x27;o&#x27;</span>)<br><br><span class="hljs-comment"># Add labels and title</span><br>plt.xlabel(<span class="hljs-string">&#x27;diff Temperature (K)&#x27;</span>)  <span class="hljs-comment"># Adjust based on your variable unit</span><br>plt.ylabel(<span class="hljs-string">&#x27;Pressure Level (hPa)&#x27;</span>)  <span class="hljs-comment"># Adjust based on your vertical coordinate</span><br>plt.title(<span class="hljs-string">&#x27;Vertical Profiles of diff Temperature (ta)&#x27;</span>)<br>plt.legend()<br>plt.grid()<br>plt.gca().invert_yaxis()  <span class="hljs-comment"># Invert y-axis for pressure levels</span><br>plt.tight_layout()<br><br><span class="hljs-comment"># Show the plot</span><br><span class="hljs-comment"># plt.show()</span><br>plt.savefig(<span class="hljs-string">&quot;diff_ta.png&quot;</span>, dpi=<span class="hljs-number">300</span>)<br><br><span class="hljs-comment">#============== vertial =============================</span><br><span class="hljs-comment"># Extract the variable &#x27;ta&#x27; (ensure to adjust the variable name if it&#x27;s different)</span><br>ta_signal = dsignal[<span class="hljs-string">&#x27;diff_rh&#x27;</span>]<br>ta_signal_0p25 = dsignal_0p25[<span class="hljs-string">&#x27;diff_rh&#x27;</span>]<br>ta_era5 = diff_PL[<span class="hljs-string">&#x27;r&#x27;</span>]<br><br><span class="hljs-comment"># Assuming the vertical dimension is named &#x27;level&#x27; or &#x27;plev&#x27;; adjust as necessary</span><br>levels = ta_signal[<span class="hljs-string">&#x27;level&#x27;</span>].values  <span class="hljs-comment"># Adjust depending on your dimensions</span><br>levels_era5 = diff_PL[<span class="hljs-string">&#x27;isobaricInhPa&#x27;</span>].values  <span class="hljs-comment"># Adjust depending on your dimensions</span><br><br><span class="hljs-comment"># Plotting</span><br>plt.figure(figsize=(<span class="hljs-number">10</span>, <span class="hljs-number">6</span>))<br><br><span class="hljs-comment"># Plot each profile</span><br>plt.plot(ta_era5.sel(isobaricInhPa=levels_era5).mean(dim=<span class="hljs-string">&#x27;latitude&#x27;</span>).mean(dim=<span class="hljs-string">&#x27;longitude&#x27;</span>), levels_era5, label=<span class="hljs-string">&#x27;ERA5&#x27;</span>, color=<span class="hljs-string">&#x27;green&#x27;</span>, marker = <span class="hljs-string">&#x27;o&#x27;</span>)<br>plt.plot(ta_signal.sel(level=levels).mean(dim=<span class="hljs-string">&#x27;latitude&#x27;</span>).mean(dim=<span class="hljs-string">&#x27;longitude&#x27;</span>), levels/<span class="hljs-number">100</span>, label=<span class="hljs-string">&#x27;Signal&#x27;</span>, color=<span class="hljs-string">&#x27;blue&#x27;</span>, marker = <span class="hljs-string">&#x27;o&#x27;</span>)<br>plt.plot(ta_signal_0p25.sel(level=levels).mean(dim=<span class="hljs-string">&#x27;lat&#x27;</span>).mean(dim=<span class="hljs-string">&#x27;lon&#x27;</span>), levels/<span class="hljs-number">100</span>, label=<span class="hljs-string">&#x27;Signal 0.25°&#x27;</span>, color=<span class="hljs-string">&#x27;orange&#x27;</span>, marker = <span class="hljs-string">&#x27;o&#x27;</span>)<br><br><span class="hljs-comment"># Add labels and title</span><br>plt.xlabel(<span class="hljs-string">&#x27;diff RH (%)&#x27;</span>)  <span class="hljs-comment"># Adjust based on your variable unit</span><br>plt.ylabel(<span class="hljs-string">&#x27;Pressure Level (hPa)&#x27;</span>)  <span class="hljs-comment"># Adjust based on your vertical coordinate</span><br>plt.title(<span class="hljs-string">&#x27;Vertical Profiles of diff RH (%)&#x27;</span>)<br>plt.legend()<br>plt.grid()<br>plt.gca().invert_yaxis()  <span class="hljs-comment"># Invert y-axis for pressure levels</span><br>plt.tight_layout()<br><br><span class="hljs-comment"># Show the plot</span><br><span class="hljs-comment"># plt.show()</span><br>plt.savefig(<span class="hljs-string">&quot;diff_rh.png&quot;</span>, dpi=<span class="hljs-number">300</span>)<br><br><span class="hljs-comment">#========================================================</span><br><span class="hljs-comment"># Plotting</span><br>plt.figure(figsize=(<span class="hljs-number">10</span>, <span class="hljs-number">6</span>))<br><br><span class="hljs-comment"># Plot each profile</span><br>plt.plot(np.mean(diff_init[<span class="hljs-string">&quot;relhum&quot;</span>][<span class="hljs-number">0</span>,:,:], axis=<span class="hljs-number">0</span>), np.linspace(<span class="hljs-number">0</span>,<span class="hljs-number">54</span>,<span class="hljs-number">54</span>+<span class="hljs-number">1</span>), label=<span class="hljs-string">&#x27;MPAS-120km&#x27;</span>, color=<span class="hljs-string">&#x27;black&#x27;</span>, marker = <span class="hljs-string">&#x27;o&#x27;</span>)<br><br><span class="hljs-comment"># Add labels and title</span><br>plt.xlabel(<span class="hljs-string">&#x27;diff RH (%)&#x27;</span>)  <span class="hljs-comment"># Adjust based on your variable unit</span><br>plt.ylabel(<span class="hljs-string">&#x27;level&#x27;</span>)  <span class="hljs-comment"># Adjust based on your vertical coordinate</span><br>plt.title(<span class="hljs-string">&#x27;Vertical Profiles of diff RH (%)&#x27;</span>)<br>plt.legend()<br>plt.grid()<br>plt.tight_layout()<br><br><span class="hljs-comment"># Show the plot</span><br><span class="hljs-comment"># plt.show()</span><br>plt.savefig(<span class="hljs-string">&quot;diff_init_rh.png&quot;</span>, dpi=<span class="hljs-number">300</span>)<br></code></pre></td></tr></table></figure>
        </div>
      </div>
    </div>
<h1 id="ncl-references">NCL references</h1>
<h1 id="discussion-summary">Discussion Summary</h1>
<ol type="1">
<li><strong>Which Variables Can Be Used?</strong>
<ul>
<li>The selection of variables is highly dependent on the specific goals and context of the case study. Commonly utilized variables include:
<ul>
<li><strong>Temperature (T)</strong>: Essential for understanding thermal dynamics.</li>
<li><strong>Relative Humidity (RH)</strong>: Important for moisture content and cloud formation.</li>
<li>Additional variables may include geopotential and wind components, depending on the focus of the study.</li>
</ul></li>
</ul></li>
<li><strong>Importing Wind Components (u, v): !!!</strong>
<ul>
<li>The decision to import wind components (u and v) should be guided by their relevance to the study. Wind data is crucial for:
<ul>
<li>Enhancing model accuracy, especially in studies involving atmospheric dynamics.</li>
<li>Providing insights into transport processes and weather patterns.</li>
</ul></li>
<li><strong>The PGW method is designed to isolate the thermodynamic effects of climate change</strong> while largely preserving the historical synoptic patterns and dynamics of the atmosphere, such as the large-scale wind fields that govern tropical cyclone steering. <strong>In most PGW implementations, the future climate signal is applied to thermodynamic variables (e.g., temperature and specific humidity profiles) rather than dynamic variables like the 3D wind field</strong>. <strong>This is because altering the wind field directly could disrupt the atmospheric balance (e.g., geostrophic or hydrostatic equilibrium), leading to unrealistic adjustments in the model during the initial spin-up period</strong>. Instead, the wind fields are typically left unchanged in the initial conditions, allowing the model to dynamically adjust the winds in response to the perturbed thermodynamic state as the simulation evolves.</li>
<li>For tropical cyclones, the steering flow—defined as the vertically averaged environmental wind that guides the storm’s motion—is a critical factor. This flow is influenced by the large-scale circulation patterns (e.g., subtropical ridges, troughs, and jet streams), which are part of the initial and boundary conditions derived from reanalysis data (e.g., ERA-Interim or NCEP) in a control run. In a PGW simulation, the assumption is often that the future climate signal does not significantly alter these large-scale wind patterns in the initial state. <strong>Therefore, in many studies, the 3D wind field is not explicitly modified by adding a future wind signal to the initial conditions</strong>. The focus is instead on how thermodynamic changes (e.g., warmer SSTs, increased atmospheric moisture) affect cyclone intensity, structure, and potentially its track indirectly through feedback on the dynamics.</li>
<li><strong>If your goal is to isolate the thermodynamic effects of warming</strong> (e.g., how increased SSTs or humidity affect TC intensity), then not adding a 3D wind perturbation is standard practice. The steering flow will remain consistent with the historical case, and any changes in TC behavior will stem from thermodynamic feedbacks.</li>
<li><strong>If your goal</strong> is to explore how future changes in large-scale circulation might affect TC steering, then you could consider adding a 3D wind perturbation derived from GCM projections (e.g., CMIP5 or CMIP6 under a scenario like RCP8.5). <strong>However, this is less common in PGW because</strong>:
<ul>
<li>GCMs show significant disagreement on future wind field changes, especially at regional scales relevant to TC steering.</li>
<li>Adding wind perturbations risks introducing imbalances that could destabilize the model unless carefully adjusted (e.g., via pressure corrections to maintain hydrostatic balance).</li>
<li>The steering flow’s response to climate change is often studied separately using full transient GCM simulations rather than PGW.</li>
</ul></li>
<li><strong>In practice, some PGW studies avoid wind perturbations entirely to maintain consistency with the historical storm track and focus on intensity or precipitation changes</strong>. Others might use sensitivity experiments to test the impact of hypothetical wind changes, but this is not the norm.</li>
</ul></li>
<li><strong>Interpolation Methods:</strong>
<ul>
<li><strong>Horizontal Interpolation</strong>: Bilinear interpolation is commonly used for its simplicity and effectiveness in providing smooth transitions between grid points.</li>
<li><strong>Vertical Interpolation</strong>: The choice between linear and logarithmic interpolation should be based on the nature of the variable being interpolated:
<ul>
<li><strong>Linear Interpolation</strong> is suitable for most variables.</li>
<li><strong>Logarithmic Interpolation</strong> may be more appropriate for variables with a wide range of values, such as pressure or density.</li>
</ul></li>
</ul></li>
<li><strong>Consideration of Vertical Levels:</strong>
<ul>
<li>When performing vertical interpolation, it is important to consider whether to include levels such as 100 hPa. Generally:
<ul>
<li>If the climate signal data does not extend above certain levels (e.g., 50 hPa), it is prudent to exclude those levels to avoid introducing inconsistencies into the model.</li>
</ul></li>
</ul></li>
<li><strong>Data Integration Formats:</strong>
<ul>
<li>The climate signal can be integrated into different formats based on the model being used:
<ul>
<li>For <strong>ERA5</strong>, climate signals can be added to the ICBC (Initial Condition Boundary Condition) files in GRIB format.</li>
<li>In <strong>WRF</strong>, data may be added directly to <code>met_em</code> files, which are used for meteorological input.
<ul>
<li>ungrib
<ul>
<li>Extract meteorological fields from GRIB files</li>
</ul></li>
<li>metgrid
<ul>
<li>Horizontally interpolate meteorological fields (from ungrib) to simulation grids (defined by geogrid)</li>
</ul></li>
<li>real.exe
<ul>
<li>Initialization will calculate reference state, vertical coordinate interpolation, disturbance field calculation, output boundary conditions, surface data mask, etc.</li>
<li><a target="_blank" rel="noopener" href="https://sites.google.com/g.ntu.edu.tw/wrf-tutorial-modules/%E6%A8%A1%E5%BC%8F%E8%A8%AD%E8%A8%88/wrf-initialization">初始化會計算 reference state ，垂直座標內插，擾動場計算，產出邊界條件，地表資料遮罩等等</a></li>
<li><a target="_blank" rel="noopener" href="https://www2.mmm.ucar.edu/wrf/users/docs/user_guide_v4/v4.2/users_guide_chap4.html" class="uri">https://www2.mmm.ucar.edu/wrf/users/docs/user_guide_v4/v4.2/users_guide_chap4.html</a></li>
<li><strong>So, it is fine for adding signal into met_em because met_em only does horizontal interpolation.</strong></li>
</ul></li>
<li>wrf.exe</li>
</ul></li>
<li>For <strong>MPAS</strong>, it is no met_em step and only from <code>static.nc</code> to <code>init.nc</code>. Therefore, the only way is to add signal into ICBC=ERA5.</li>
</ul></li>
</ul></li>
<li><strong>Long-term Simulations:</strong>
<ul>
<li>For extended runs in both MPAS and WRF, it is essential to <strong>regularly update SST data</strong>. This practice helps maintain the relevance of the model outputs to current climate conditions, ensuring that the simulations reflect the most recent data and improving the accuracy of long-term forecasts.</li>
</ul></li>
</ol>
<div class="note note-primary">
            <p>Read <strong><a href="https://waipangsze.github.io/2025/02/14/MPAS-ERA5-Update-SST-and-sea-ice-fraction/">MPAS | ERA5| Update SST and sea-ice fraction</a></strong></p>
          </div>
<p>Integrating and interpolating climate variables in models like WRF and MPAS involves careful consideration of the variables used, the methods of interpolation, and the formats for data integration. By addressing these factors, researchers can enhance the accuracy and reliability of climate and weather predictions. Proper handling of SST and other variables in both short-term and long-term simulations is crucial for effective climate modeling and analysis.</p>
<hr />
<h1 id="references">References</h1>
<ol type="1">
<li><a target="_blank" rel="noopener" href="https://code.mpimet.mpg.de/projects/cdo/wiki/tutorial#Basic-Usage">Climate Data Operators (CDO) Tutorial (<strong>recommend</strong>)</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/ecmwf/cfgrib/issues/289">failed to set key 'endStep' in to_grib</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/ecmwf/cfgrib/issues/18">Add support to write a xarray.Dataset to a GRIB file.</a>
<ol type="1">
<li>cfgrib.to_grib(ds, 'User_Guide_Example_Data_from_cfgrib.grib')#, grib_keys={'centre': 'ecmf'})</li>
<li><code>cfgrib/xarray_to_grib.py:252: FutureWarning: GRIB write support is experimental, DO NOT RELY ON IT!</code></li>
</ol></li>
<li><a target="_blank" rel="noopener" href="https://code.mpimet.mpg.de/boards/1/topics/2907">Converting NetCDF to GRIB | 2014</a>
<ol type="1">
<li><code>cdo -v -f grb -copy sstatlantic_addhifreq.nc ofile.grb</code>
<ol type="1">
<li><code>cdo -v -f grb2 -copy sstatlantic_addhifreq.nc ofile.grb</code> if grib2 format.</li>
</ol></li>
<li>The large GRIB file has data with 2602x1402=3648004 grid points. CDO stores netCDF double precision floats to 24bit packed GRIB per default. The result is a GRIB record with 10944120 bytes. The max. record length in the GRIB1 standard is 8388607 bytes. <strong>CDO uses the ECMWF extension of the GRIB1 standard for larger GRIB records</strong>. These large GRIB records can only be read by CDO or tools from the ECMWF.</li>
<li>You can create a 16bit GRIB record to reduce the record size:
<ol type="1">
<li><code>cdo -b 16 -f grb copy file.nc file.grb</code></li>
</ol></li>
</ol></li>
<li>Due to the fact that the NetCDF data model is much more free and extensible than the GRIB one, it is not possible to write a generic xarray.Dataset to a GRIB file. The aim for cfgrib is to implement write support for a subset of carefully crafted datasets that fit the GRIB data model. In particular the only coordinates that we target at the moment are the one returned by opening a GRIB with the cfgrib flavour of cfgrib.open_dataset, namely:number, time, step, a vertical coordinate (isobaricInhPa, heightAboveGround, surface, etc), and the horizontal coordinates (for example latitude and longitude for a regular_ll grid type).</li>
</ol>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/NWP/" class="category-chain-item">NWP</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/WRF/" class="print-no-link">#WRF</a>
      
        <a href="/tags/NWP/" class="print-no-link">#NWP</a>
      
        <a href="/tags/MPAS/" class="print-no-link">#MPAS</a>
      
        <a href="/tags/GFS/" class="print-no-link">#GFS</a>
      
        <a href="/tags/ERA5/" class="print-no-link">#ERA5</a>
      
        <a href="/tags/PGW/" class="print-no-link">#PGW</a>
      
        <a href="/tags/GRIB/" class="print-no-link">#GRIB</a>
      
        <a href="/tags/NetCDF/" class="print-no-link">#NetCDF</a>
      
        <a href="/tags/CMIP6/" class="print-no-link">#CMIP6</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>NWP | Pseudo-Global-Warming (PGW) hands-on | ERA5 | GFS</div>
      <div>https://waipangsze.github.io/2025/02/03/NWP-PGW-hands-on-ERA5-GFS/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>Author</div>
          <div>wpsze</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>Posted on</div>
          <div>February 3, 2025</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>Updated on</div>
          <div>April 9, 2025</div>
        </div>
      
      
        <div class="license-meta-item">
          <div>Licensed under</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - Attribution">
                    <i class="iconfont icon-cc-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2025/02/04/ML-AnythingLLM-Ollama/" title="ML | AnythingLLM + Ollama">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">ML | AnythingLLM + Ollama</span>
                        <span class="visible-mobile">Previous</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2025/02/01/Maths-Riemann-Hypothesis-Analytic-Continuation-Prime-Number-Counting-Function/" title="Maths | 黎曼猜想/解析延拓/素數計數函數">
                        <span class="hidden-mobile">Maths | 黎曼猜想/解析延拓/素數計數函數</span>
                        <span class="visible-mobile">Next</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>Table of Contents</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  


  
  





  <script>
  Fluid.utils.createScript('https://lib.baomitu.com/mermaid/8.14.0/mermaid.min.js', function() {
    mermaid.initialize({"theme":"default"});

    Fluid.utils.listenDOMLoaded(function() {
      Fluid.events.registerRefreshCallback(function() {
        if ('mermaid' in window) {
          mermaid.init();
        }
      });
    });
  });
</script>






<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-9HL36SZ28R"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-9HL36SZ28R');
</script>

    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">Keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">

  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  

  <span id="sitetime"></span>
  <script language=javascript>
    function siteTime(){
      window.setTimeout("siteTime()", 1000);
      var seconds = 1000;
      var minutes = seconds * 60;
      var hours = minutes * 60;
      var days = hours * 24;
      var years = days * 365;
      var today = new Date();
      var todayYear = today.getFullYear();
      var todayMonth = today.getMonth()+1;
      var todayDate = today.getDate();
      var todayHour = today.getHours();
      var todayMinute = today.getMinutes();
      var todaySecond = today.getSeconds();
      /* Date.UTC() -- 返回date对象距世界标准时间(UTC)1970年1月1日午夜之间的毫秒数(时间戳)
      year - 作为date对象的年份，为4位年份值
      month - 0-11之间的整数，做为date对象的月份
      day - 1-31之间的整数，做为date对象的天数
      hours - 0(午夜24点)-23之间的整数，做为date对象的小时数
      minutes - 0-59之间的整数，做为date对象的分钟数
      seconds - 0-59之间的整数，做为date对象的秒数
      microseconds - 0-999之间的整数，做为date对象的毫秒数 */
      var t1 = Date.UTC(2023,04,23,00,00,00); //北京时间2018-2-13 00:00:00
      var t2 = Date.UTC(todayYear,todayMonth,todayDate,todayHour,todayMinute,todaySecond);
      var diff = t2-t1;
      var diffYears = Math.floor(diff/years);
      var diffDays = Math.floor((diff/days)-diffYears*365);
      var diffHours = Math.floor((diff-(diffYears*365+diffDays)*days)/hours);
      var diffMinutes = Math.floor((diff-(diffYears*365+diffDays)*days-diffHours*hours)/minutes);
      var diffSeconds = Math.floor((diff-(diffYears*365+diffDays)*days-diffHours*hours-diffMinutes*minutes)/seconds);
      /*document.getElementById("sitetime").innerHTML=" 已运行"+/*diffYears+" 年 "+*/diffDays+" 天 "+diffHours+" 小时 "+diffMinutes+" 分钟 "+diffSeconds+" 秒";
      document.getElementById("sitetime").innerHTML=" 已運行"+diffYears+" 年 "+diffDays+" 天 ";
    }/*因为建站时间还没有一年，就将之注释掉了。需要的可以取消*/
    siteTime();
  </script>
  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/5.0.0/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  
      <script>
        if (!window.MathJax) {
          window.MathJax = {
            tex    : {
              inlineMath: { '[+]': [['$', '$']] }
            },
            loader : {
              load: ['ui/lazy']
            },
            options: {
              renderActions: {
                insertedScript: [200, () => {
                  document.querySelectorAll('mjx-container').forEach(node => {
                    let target = node.parentNode;
                    if (target.nodeName.toLowerCase() === 'li') {
                      target.parentNode.classList.add('has-jax');
                    }
                  });
                }, '', false]
              }
            }
          };
        } else {
          MathJax.startup.document.state(0);
          MathJax.texReset();
          MathJax.typeset();
          MathJax.typesetPromise();
        }

        Fluid.events.registerRefreshCallback(function() {
          if ('MathJax' in window && MathJax.startup.document && typeof MathJax.startup.document.state === 'function') {
            MathJax.startup.document.state(0);
            MathJax.texReset();
            MathJax.typeset();
            MathJax.typesetPromise();
          }
        });
      </script>
    

  <script  src="https://lib.baomitu.com/mathjax/3.2.2/es5/tex-mml-chtml.js" ></script>

  <script  src="/js/local-search.js" ></script>

  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">Blog works best with JavaScript enabled</div>
  </noscript>
</body>
</html>
