

<!DOCTYPE html>
<html lang="en" data-default-color-scheme=light>



<head>
  <meta charset="UTF-8">

  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="wpsze">
  <meta name="keywords" content="">
  
    <meta name="description" content="NWP | Pseudo-Global-Warming (PGW) hands-on | ERA5 | GFS                         NWP | ERA5 | GRIB1 and GRIB2            To prepare the ERA5 GRIB file from the modified era5_with_signal.nc">
<meta property="og:type" content="article">
<meta property="og:title" content="NWP | PGW | To prepare the ERA5 GRIB file">
<meta property="og:url" content="https://waipangsze.github.io/2025/02/05/NWP-PGW-To-prepare-the-ERA5-GRIB-file/index.html">
<meta property="og:site_name" content="wpsze">
<meta property="og:description" content="NWP | Pseudo-Global-Warming (PGW) hands-on | ERA5 | GFS                         NWP | ERA5 | GRIB1 and GRIB2            To prepare the ERA5 GRIB file from the modified era5_with_signal.nc">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://i.imgur.com/kcuHfQW.png">
<meta property="article:published_time" content="2025-02-05T07:33:00.000Z">
<meta property="article:modified_time" content="2025-10-27T06:03:55.775Z">
<meta property="article:author" content="wpsze">
<meta property="article:tag" content="MPAS">
<meta property="article:tag" content="NWP">
<meta property="article:tag" content="WRF">
<meta property="article:tag" content="GFS">
<meta property="article:tag" content="ERA5">
<meta property="article:tag" content="PGW">
<meta property="article:tag" content="GRIB">
<meta property="article:tag" content="NetCDF">
<meta property="article:tag" content="CMIP6">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://i.imgur.com/kcuHfQW.png">
  
  
    <meta name="referrer" content="no-referrer-when-downgrade">
  
  
  <title>NWP | PGW | To prepare the ERA5 GRIB file - wpsze</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css">



<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"waipangsze.github.io","root":"/","version":"1.9.8","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"follow_dnt":true,"baidu":null,"google":{"measurement_id":"F7MK-FcxSomhtc1N3hIUDA"},"tencent":{"sid":null,"cid":null},"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false},"umami":{"src":null,"website_id":null,"domains":null,"start_time":"2024-01-01T00:00:00.000Z","token":null,"api_server":null}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  

  

  
    <!-- Google tag (gtag.js) -->
    <script async>
      if (!Fluid.ctx.dnt) {
        Fluid.utils.createScript("https://www.googletagmanager.com/gtag/js?id=F7MK-FcxSomhtc1N3hIUDA", function() {
          window.dataLayer = window.dataLayer || [];
          function gtag() {
            dataLayer.push(arguments);
          }
          gtag('js', new Date());
          gtag('config', 'F7MK-FcxSomhtc1N3hIUDA');
        });
      }
    </script>
  

  

  

  



  
<meta name="generator" content="Hexo 7.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>wpsze</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>Home</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>Archives</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>Categories</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>Tags</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/" target="_self">
                <i class="iconfont icon-link-fill"></i>
                <span>Links</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/bookmark/" target="_self">
                <i class="iconfont icon-bookmark"></i>
                <span>Bookmarks</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" target="_self" href="javascript:;" role="button"
                 data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <i class="iconfont icon-books"></i>
                <span>Docs</span>
              </a>
              <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                
                  
                  
                  
                  <a class="dropdown-item" href="/categories/Physics/" target="_self">
                    <i class="iconfont icon-plan"></i>
                    <span>Physics</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/categories/Maths/" target="_self">
                    <i class="iconfont icon-plan"></i>
                    <span>Maths</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/categories/CFD/" target="_self">
                    <i class="iconfont icon-plan"></i>
                    <span>CFD</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/categories/ML/" target="_self">
                    <i class="iconfont icon-plan"></i>
                    <span>ML</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/categories/Meteorology/" target="_self">
                    <i class="iconfont icon-plan"></i>
                    <span>Meteorology</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/categories/MPAS/" target="_self">
                    <i class="iconfont icon-plan"></i>
                    <span>MPAS</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/categories/PALM/" target="_self">
                    <i class="iconfont icon-plan"></i>
                    <span>PALM</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/monitor/" target="_self">
                    
                    <span>Real Time Monitoring</span>
                  </a>
                
              </div>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>About Me</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('https://i.imgur.com/kcuHfQW.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="NWP | PGW | To prepare the ERA5 GRIB file"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2025-02-05 15:33" pubdate>
          February 5, 2025 pm
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          1.1k words
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          10 mins
        
      </span>
    

    
    
      
        <span id="busuanzi_container_page_pv" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="busuanzi_value_page_pv"></span> views
        </span>
        

      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">NWP | PGW | To prepare the ERA5 GRIB file</h1>
            
            
              <div class="markdown-body">
                
                <div class="note note-primary">
            <p><a href="https://waipangsze.github.io/2025/02/03/NWP-PGW-hands-on-ERA5-GFS/"><strong>NWP | Pseudo-Global-Warming (PGW) hands-on | ERA5 | GFS</strong></a></p>
          </div>
<div class="note note-primary">
            <p><a href="https://waipangsze.github.io/2025/02/05/NWP-ERA5-GRIB1-GRIB2/"><strong>NWP | ERA5 | GRIB1 and GRIB2</strong></a></p>
          </div>
<p>To prepare the <code>ERA5</code> GRIB file from the modified <code>era5_with_signal.nc</code>, you need to specify GRIB metadata such as <code>dataDate</code>, <code>shortName</code>, <code>level</code>, <code>dataType</code>, and <code>typeOfLevel</code> when converting <code>era5_with_signal.nc</code> back to GRIB format. The process involves using <strong><code>cdo</code></strong> and <strong><code>grib_set</code></strong> from ecCodes to properly define these GRIB headers.</p>
<p>Below is the detailed step-by-step guide:</p>
<hr />
<h3 id="step-1-check-metadata-of-the-original-grib-file"><strong>Step 1: Check Metadata of the Original GRIB File</strong></h3>
<p>Inspect the original <code>ERA5</code> GRIB file (<code>era5.grib</code>) to understand the required metadata.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">grib_ls era5.grib<br></code></pre></td></tr></table></figure>
<p>This will give you information about: - <code>dataDate</code>: The date of the data (e.g., 20250101 for January 1, 2025). - <code>shortName</code>: The short name of the variable (e.g., <code>t2m</code> for 2-meter temperature). - <code>level</code>: The model level, pressure level, or surface (e.g., <code>2</code> for surface data). - <code>dataType</code>: The type of data, such as <code>an</code> (analysis) or <code>fc</code> (forecast). - <code>typeOfLevel</code>: Specifies the level type (e.g., <code>surface</code>, <code>isobaricInhPa</code>, etc.).</p>
<p>Ensure you note these details.</p>
<hr />
<h3 id="step-2-convert-era5_with_signal.nc-to-grib-format"><strong>Step 2: Convert <code>era5_with_signal.nc</code> to GRIB Format</strong></h3>
<p>Use <strong><code>cdo</code></strong> to convert the modified NetCDF file to GRIB format. You can specify metadata such as short names, levels, and GRIB options directly.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">cdo -f grb copy era5_with_signal.nc era5_with_signal.grib<br></code></pre></td></tr></table></figure>
<p>This creates a basic GRIB file, but it may not yet have all the required metadata (e.g., <code>dataDate</code>, <code>shortName</code>, <code>typeOfLevel</code>). You can fix those in the next steps.</p>
<hr />
<h3 id="step-3-assign-grib-metadata"><strong>Step 3: Assign GRIB Metadata</strong></h3>
<p>Use <strong><code>grib_set</code></strong> to modify GRIB metadata. First, inspect the GRIB file to see the current metadata:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">grib_ls era5_with_signal.grib<br></code></pre></td></tr></table></figure>
<p>If metadata like <code>dataDate</code>, <code>shortName</code>, or <code>typeOfLevel</code> is incorrect or missing, update them as follows:</p>
<h4 id="example-1-set-datadate-and-shortname">Example 1: Set <code>dataDate</code> and <code>shortName</code></h4>
<p>Set the date and variable short name (e.g., for <code>2-meter temperature</code>):</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">grib_set -s dataDate=20250101,dataTime=<span class="hljs-variable">$&#123;hh&#125;</span>00,shortName=t2m era5_with_signal.grib era5_with_signal_updated.grib<br></code></pre></td></tr></table></figure>
<h4 id="example-2-set-typeoflevel-and-level">Example 2: Set <code>typeOfLevel</code> and <code>level</code></h4>
<p>If the <code>typeOfLevel</code> (e.g., <code>surface</code>) or <code>level</code> (e.g., <code>2</code>) is missing or incorrect, set them:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">grib_set -s typeOfLevel=surface,level=2 era5_with_signal_updated.grib era5_with_signal_final.grib<br></code></pre></td></tr></table></figure>
<hr />
<h3 id="step-4-verify-the-final-grib-file"><strong>Step 4: Verify the Final GRIB File</strong></h3>
<p>After updating the metadata, verify the contents of the resulting GRIB file:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">grib_ls era5_with_signal_final.grib<br></code></pre></td></tr></table></figure>
<p>Check that all metadata (e.g., <code>dataDate</code>, <code>shortName</code>, <code>level</code>, etc.) matches the desired values.</p>
<hr />
<h3 id="step-5-automate-metadata-assignment-optional"><strong>Step 5: Automate Metadata Assignment (Optional)</strong></h3>
<p>If you need to assign multiple metadata fields at once, you can use a configuration file with <code>grib_set</code> or write a script to automate the process.</p>
<h4 id="example-bulk-metadata-update-script">Example: Bulk Metadata Update Script</h4>
<p>Create a script to set multiple fields:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/bash</span><br><br>INPUT_GRIB=<span class="hljs-string">&quot;era5_with_signal.grib&quot;</span><br>OUTPUT_GRIB=<span class="hljs-string">&quot;era5_with_signal_final.grib&quot;</span><br><br><span class="hljs-comment"># Update metadata</span><br>grib_set -s dataDate=20250101,dataTime=<span class="hljs-variable">$&#123;hh&#125;</span>00,shortName=t2m,typeOfLevel=surface,level=2 <span class="hljs-variable">$INPUT_GRIB</span> <span class="hljs-variable">$OUTPUT_GRIB</span><br><br><span class="hljs-comment"># Verify metadata</span><br>grib_ls <span class="hljs-variable">$OUTPUT_GRIB</span><br></code></pre></td></tr></table></figure>
<p>Save this as <code>update_grib_metadata.sh</code>, make it executable, and run it:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">chmod</span> +x update_grib_metadata.sh<br>./update_grib_metadata.sh<br></code></pre></td></tr></table></figure>
<hr />
<h3 id="step-6-handling-multiple-variables"><strong>Step 6: Handling Multiple Variables</strong></h3>
<p>If your <code>era5_with_signal.nc</code> contains multiple variables (e.g., temperature <code>t2m</code>, wind speed <code>u10</code>, etc.), you need to split the file by variable, assign correct metadata, and merge them back into one GRIB file.</p>
<h4 id="split-by-variable">Split by Variable:</h4>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">cdo selname,t2m era5_with_signal.nc t2m.nc<br>cdo selname,u10 era5_with_signal.nc u10.nc<br></code></pre></td></tr></table></figure>
<h4 id="convert-each-variable-to-grib">Convert Each Variable to GRIB:</h4>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">cdo -f grb copy t2m.nc t2m.grib<br>cdo -f grb copy u10.nc u10.grib<br></code></pre></td></tr></table></figure>
<h4 id="set-metadata-for-each-grib-file">Set Metadata for Each GRIB File:</h4>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">grib_set -s dataDate=20250101,dataTime=<span class="hljs-variable">$&#123;hh&#125;</span>00,shortName=t2m,typeOfLevel=surface,level=2 t2m.grib t2m_final.grib<br>grib_set -s dataDate=20250101,dataTime=<span class="hljs-variable">$&#123;hh&#125;</span>00,shortName=u10,typeOfLevel=surface,level=10 u10.grib u10_final.grib<br></code></pre></td></tr></table></figure>
<h4 id="merge-the-grib-files">Merge the GRIB Files:</h4>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">cdo merge t2m_final.grib u10_final.grib era5_with_signal_final.grib<br></code></pre></td></tr></table></figure>
<hr />
<h3 id="summary-of-commands"><strong>Summary of Commands</strong></h3>
<ol type="1">
<li><p>Convert NetCDF to GRIB: <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">cdo -f grb copy era5_with_signal.nc era5_with_signal.grib<br></code></pre></td></tr></table></figure></p></li>
<li><p>Assign GRIB metadata: <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">grib_set -s dataDate=YYYYMMDD,dataTime=<span class="hljs-variable">$&#123;hh&#125;</span>00,shortName=VAR,typeOfLevel=LEVEL_TYPE,level=LEVEL era5_with_signal.grib era5_with_signal_final.grib<br></code></pre></td></tr></table></figure></p></li>
<li><p>Verify the final GRIB file: <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">grib_ls era5_with_signal_final.grib<br></code></pre></td></tr></table></figure></p></li>
</ol>
<p>This process ensures that your modified ERA5 file is correctly formatted with all necessary GRIB metadata. Let me know if you encounter any issues!</p>
<h1 id="hands-on-wpsze">** Hands-on: wpsze</h1>

    <div class="fold">
      <div class="fold-title fold-info collapsed" data-toggle="collapse" href="#collapse-1607c597" role="button" aria-expanded="false" aria-controls="collapse-1607c597">
        <div class="fold-arrow">▶</div>netcdf2grid.sh
      </div>
      <div class="fold-collapse collapse" id="collapse-1607c597">
        <div class="fold-content">
          <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><code class="hljs ssh">#!/bin/bash<br>#------------------------------------------------#<br>#Author:         wpsze<br>#Email：         wpsze<br>#date:           2025-02-06 08:41:43<br>#Version:        0.0 <br>#Description:    The purpose of the script<br>#Copyright (C)： 2025 All rights reserved<br>#------------------------------------------------#<br><br>#================= SL ====================================<br>cdo selname,sst new_ERA5-0p25-SL-$&#123;yyyymmddhh&#125;.nc sst_nan.nc<br>cdo selname,skt new_ERA5-0p25-SL-$&#123;yyyymmddhh&#125;.nc skt_nan.nc<br><br>cdo setmissval,-999 sst_nan.nc sst.nc<br>cdo setmissval,-999 skt_nan.nc skt.nc<br><br># cdo pack sst.nc sst_test.nc<br># cdo pack skt.nc skt_test.nc<br><br>cdo -f grb copy sst.nc sst.grib<br>cdo -f grb copy skt.nc skt.grib<br><br>cdo showname sst.grib<br>cdo showname skt.grib<br><br>grib_set -s dataDate=$&#123;yyyymmdd&#125;,dataTime=$&#123;hh&#125;00,shortName=sst,typeOfLevel=surface,level=0 sst.grib sst_final.grib<br>grib_set -s dataDate=$&#123;yyyymmdd&#125;,dataTime=$&#123;hh&#125;00,shortName=skt,typeOfLevel=surface,level=0 skt.grib skt_final.grib<br><br>cdo showname sst_final.grib<br>cdo showname skt_final.grib<br><br>cdo delname,var34,var235 original-SL.grib original-SL_without_vars.grib<br><br>rm new_ERA5-0p25-SL-$&#123;yyyymmddhh&#125;.grib<br>cdo merge sst_final.grib skt_final.grib original-SL_without_vars.grib new_ERA5-0p25-SL-$&#123;yyyymmddhh&#125;.grib<br><br>cdo showname new_ERA5-0p25-SL-$&#123;yyyymmddhh&#125;.grib<br><br>#================= PL: t ====================================<br>cdo selname,t new_ERA5-0p25-PL-$&#123;yyyymmddhh&#125;.nc t_nan.nc<br><br>cdo setmissval,-999 t_nan.nc t.nc<br><br># cdo pack t.nc t_test.nc<br><br># How to ensure the order of levels<br># encodeBMS_float   : Missing value = NaN is unsupported!<br>cdo -f grb copy t.nc t_lev.grib<br>cdo invertlev t_lev.grib t.grib<br><br>cdo showname t.grib<br><br>grib_set -s dataDate=$&#123;yyyymmdd&#125;,dataTime=$&#123;hh&#125;00,shortName=t,typeOfLevel=isobaricInhPa t.grib t_final.grib<br><br>cdo showname t_final.grib<br><br>##cdo delname,var130,var157 original-PL.grib original-PL_without_vars.grib<br>##cdo merge t_final.grib original-PL_without_vars.grib era5_with_signal_final_PL.grib<br>##cdo showname era5_with_signal_final_PL.grib<br><br>#================= PL: r ====================================<br>cdo selname,r new_ERA5-0p25-PL-$&#123;yyyymmddhh&#125;.nc r_nan.nc<br><br>cdo setmissval,-999 r_nan.nc r.nc<br><br># cdo pack r.nc r_test.nc<br><br># How to ensure the order of levels<br># encodeBMS_float   : Missing value = NaN is unsupported!<br>cdo -f grb copy r.nc r_lev.grib<br>cdo invertlev r_lev.grib r.grib<br><br>cdo showname r.grib<br><br>grib_set -s dataDate=$&#123;yyyymmdd&#125;,dataTime=$&#123;hh&#125;00,shortName=r,typeOfLevel=isobaricInhPa r.grib r_final.grib<br><br>cdo showname r_final.grib<br><br>#================= PL: combine t, r ====================================<br>cdo delname,var130,var157 original-PL.grib original-PL_without_vars.grib<br><br>rm new_ERA5-0p25-PL-$&#123;yyyymmddhh&#125;.grib<br>cdo merge t_final.grib r_final.grib original-PL_without_vars.grib new_ERA5-0p25-PL-$&#123;yyyymmddhh&#125;.grib<br><br>cdo showname new_ERA5-0p25-PL-$&#123;yyyymmddhh&#125;.grib<br></code></pre></td></tr></table></figure>
        </div>
      </div>
    </div>

    <div class="fold">
      <div class="fold-title fold-info collapsed" data-toggle="collapse" href="#collapse-4f34dce5" role="button" aria-expanded="false" aria-controls="collapse-4f34dce5">
        <div class="fold-arrow">▶</div>netcdf2grib_with_uv.sh
      </div>
      <div class="fold-collapse collapse" id="collapse-4f34dce5">
        <div class="fold-content">
          <figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><code class="hljs console"><span class="hljs-meta prompt_">#</span><span class="language-bash">!/bin/bash</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">------------------------------------------------#</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">Author:         wpsze</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">Email：         wpsze</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-built_in">date</span>:           2025-02-06 08:41:43</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">Version:        0.0</span> <br><span class="hljs-meta prompt_">#</span><span class="language-bash">Description:    The purpose of the script</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">Copyright (C)： 2025 All rights reserved</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">------------------------------------------------#</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">================= SL ====================================</span><br>cdo selname,sst new_ERA5-0p25-SL-$&#123;yyyymmddhh&#125;.nc sst_nan.nc<br>cdo selname,skt new_ERA5-0p25-SL-$&#123;yyyymmddhh&#125;.nc skt_nan.nc<br><br>cdo setmissval,-999 sst_nan.nc sst.nc<br>cdo setmissval,-999 skt_nan.nc skt.nc<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">cdo pack sst.nc sst_test.nc</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">cdo pack skt.nc skt_test.nc</span><br><br>cdo -f grb copy sst.nc sst.grib<br>cdo -f grb copy skt.nc skt.grib<br><br>cdo showname sst.grib<br>cdo showname skt.grib<br><br>grib_set -s dataDate=$&#123;yyyymmdd&#125;,dataTime=$&#123;hh&#125;00,shortName=sst,typeOfLevel=surface,level=0 sst.grib sst_final.grib<br>grib_set -s dataDate=$&#123;yyyymmdd&#125;,dataTime=$&#123;hh&#125;00,shortName=skt,typeOfLevel=surface,level=0 skt.grib skt_final.grib<br><br>cdo showname sst_final.grib<br>cdo showname skt_final.grib<br><br>cdo delname,var34,var235 original-SL.grib original-SL_without_vars.grib<br><br>rm new_ERA5-0p25-SL-$&#123;yyyymmddhh&#125;.grib<br>cdo merge sst_final.grib skt_final.grib original-SL_without_vars.grib new_ERA5-0p25-SL-$&#123;yyyymmddhh&#125;.grib<br><br>cdo showname new_ERA5-0p25-SL-$&#123;yyyymmddhh&#125;.grib<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">================= PL: t ====================================</span><br>cdo selname,t new_ERA5-0p25-PL-$&#123;yyyymmddhh&#125;.nc t_nan.nc<br><br>cdo setmissval,-999 t_nan.nc t.nc<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">cdo pack t.nc t_test.nc</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">How to ensure the order of levels</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">encodeBMS_float   : Missing value = NaN is unsupported!</span><br>cdo -f grb copy t.nc t_lev.grib<br>cdo invertlev t_lev.grib t.grib<br><br>cdo showname t.grib<br><br>grib_set -s dataDate=$&#123;yyyymmdd&#125;,dataTime=$&#123;hh&#125;00,shortName=t,typeOfLevel=isobaricInhPa t.grib t_final.grib<br><br>cdo showname t_final.grib<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">#cdo delname,var130,var157 original-PL.grib original-PL_without_vars.grib</span></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">#cdo merge t_final.grib original-PL_without_vars.grib era5_with_signal_final_PL.grib</span></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">#cdo showname era5_with_signal_final_PL.grib</span></span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">================= PL: r ====================================</span><br>cdo selname,r new_ERA5-0p25-PL-$&#123;yyyymmddhh&#125;.nc r_nan.nc<br><br>cdo setmissval,-999 r_nan.nc r.nc<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">cdo pack r.nc r_test.nc</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">How to ensure the order of levels</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">encodeBMS_float   : Missing value = NaN is unsupported!</span><br>cdo -f grb copy r.nc r_lev.grib<br>cdo invertlev r_lev.grib r.grib<br><br>cdo showname r.grib<br><br>grib_set -s dataDate=$&#123;yyyymmdd&#125;,dataTime=$&#123;hh&#125;00,shortName=r,typeOfLevel=isobaricInhPa r.grib r_final.grib<br><br>cdo showname r_final.grib<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">================= PL: u ====================================</span><br>cdo selname,u new_ERA5-0p25-PL-$&#123;yyyymmddhh&#125;.nc u_nan.nc<br><br>cdo setmissval,-999 u_nan.nc u.nc<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">cdo pack u.nc u_test.nc</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">How to ensure the order of levels</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">encodeBMS_float   : Missing value = NaN is unsupported!</span><br>cdo -f grb copy u.nc u_lev.grib<br>cdo invertlev u_lev.grib u.grib<br><br>cdo showname u.grib<br><br>grib_set -s dataDate=$&#123;yyyymmdd&#125;,dataTime=$&#123;hh&#125;00,shortName=u,typeOfLevel=isobaricInhPa u.grib u_final.grib<br><br>cdo showname u_final.grib<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">================= PL: v ====================================</span><br>cdo selname,v new_ERA5-0p25-PL-$&#123;yyyymmddhh&#125;.nc v_nan.nc<br><br>cdo setmissval,-999 v_nan.nc v.nc<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">cdo pack v.nc v_test.nc</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">How to ensure the order of levels</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">encodeBMS_float   : Missing value = NaN is unsupported!</span><br>cdo -f grb copy v.nc v_lev.grib<br>cdo invertlev v_lev.grib v.grib<br><br>cdo showname v.grib<br><br>grib_set -s dataDate=$&#123;yyyymmdd&#125;,dataTime=$&#123;hh&#125;00,shortName=v,typeOfLevel=isobaricInhPa v.grib v_final.grib<br><br>cdo showname v_final.grib<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">================= PL: combine t, r, u, v ====================================</span><br>cdo delname,var130,var157,var131,var132 original-PL.grib original-PL_without_vars.grib<br><br>rm new_ERA5-0p25-PL-$&#123;yyyymmddhh&#125;.grib<br>cdo merge t_final.grib r_final.grib u_final.grib v_final.grib original-PL_without_vars.grib new_ERA5-0p25-PL-$&#123;yyyymmddhh&#125;.grib<br><br>cdo showname new_ERA5-0p25-PL-$&#123;yyyymmddhh&#125;.grib<br></code></pre></td></tr></table></figure>
        </div>
      </div>
    </div>
<h2 id="debug">Debug</h2>
<h3 id="encodebms_double-missing-value-nan-is-unsupported">encodeBMS_double : Missing value = NaN is unsupported!</h3>
<ul>
<li><a target="_blank" rel="noopener" href="https://code.mpimet.mpg.de/boards/1/topics/1628">CDO NetCDF to Grib files | 2013</a></li>
</ul>
<p><strong>NaN is not allowed in the grib standard,</strong> but you can change it with cdo:</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs console">[ram@thingol:~/tar/downloads]cdo setmissval,-9.e38 oscar_vel7403.nc t.nc<br>cdo setmissval: Processed 2310724 values from 4 variables over 1 timestep ( 0.12s )<br></code></pre></td></tr></table></figure>
<p>and then convert it to grib,</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs console">[ram@thingol:~/tar/downloads]cdo -f grb copy t.nc oscar_vel7403.grb            <br>cgribexDefLevel    : Changed zaxis type from generic to pressure<br>cdo copy: Processed 2310724 values from 4 variables over 1 timestep ( 0.09s )<br></code></pre></td></tr></table></figure>
<p>Some lines on grib and netcdf:</p>
<p>GRIB1/GRIB2 are international standards for climate data sets defined by the WMO. Every data set has to have some identifiers (mostly integers), which describe what the data is (physical variable,unit,...). See here for a docu on the definitions. For example, NaN is not allowed for a missing value in the GRIB1 standard. In contrast to this Netcdf is self-explanatory: The user can defined, which name, unit or other (freely definable) attributes a certain variable should have. That's why it's not always possible to convert netcdf to grib.</p>
<h3 id="netcdf-numeric-conversion-not-representable">NetCDF: Numeric conversion not representable</h3>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs console"><span class="hljs-meta prompt_"> $ </span><span class="language-bash">ncview sst.nc</span><br>Ncview 2.1.7 David W. Pierce  29 March 2016<br>http://meteora.ucsd.edu:80/~pierce/ncview_home_page.html<br>Copyright (C) 1993 through 2015, David W. Pierce<br>Ncview comes with ABSOLUTELY NO WARRANTY; for details type `ncview -w&#x27;.<br>This is free software licensed under the Gnu General Public License version 3; type `ncview -c&#x27; for redistribution details.<br><br>Note: no Ncview app-defaults file found, using internal defaults<br>netcdf_fi_get_data: error on nc_get_vara_float call<br>cdfid=65536   variable=sst<br>start, count:<br>[0]: 0  721<br>[1]: 0  1440<br>NetCDF: Numeric conversion not representable<br></code></pre></td></tr></table></figure>
<ul>
<li><a target="_blank" rel="noopener" href="https://code.mpimet.mpg.de/boards/1/topics/165">NetCDF: Numeric conversion not representable</a></li>
<li><a target="_blank" rel="noopener" href="https://code.mpimet.mpg.de/projects/cdo/wiki#netCDF-with-packed-data">netCDF with packed data</a>
<ul>
<li>Packing reduces the data volume by reducing the precision of the stored numbers. In NetCDF it is implemented using the attributes add_offset and scale_factor. CDO supports NetCDF files with packed data but can not automatically repack the data. That means the attributes add_offset and scale_factor are never changed. If you are using a CDO operator which change the range of the data you also have to take care that the modified data can be packed with the same add_offset and scale_factor. Otherwise the result could be wrong. You will get the following error message if some data values are out of the range of the packed datatype:</li>
<li><code>Error (cdf_put_vara_double) : NetCDF: Numeric conversion not representable</code></li>
<li>In this case you have to change the data type to <strong>single or double precision floating-point.</strong> This can be done with the CDO option <code>-b F32</code> or <code>-b F64</code>.</li>
<li>As of CDO release 2.3.0, NetCDF data is always written out unpacked if the operator changes the range of the data. Use the new operator pack to repack the data if required:</li>
<li><code>cdo pack -&lt;operator&gt;  infile outfile</code></li>
</ul></li>
</ul>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs console"><span class="hljs-meta prompt_"> $ </span><span class="language-bash">cdo pack sst.nc sst_test.nc</span><br>cdo    pack: Processed 1038240 values from 1 variable over 1 timestep [0.29s 54MB].<br><br>-rw-rw-r-- 1 wpsze wpsze 8.0M Feb  6 11:16 sst.nc<br>-rw-rw-r-- 1 wpsze wpsze 2.1M Feb  6 11:51 sst_test.nc<br></code></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>Packing reduces the data volume by reducing the precision of the stored numbers</li>
<li>It reduces the precision, so not apply <code>cdo pack</code></li>
</ul>
</blockquote>

    <div class="fold">
      <div class="fold-title fold-info collapsed" data-toggle="collapse" href="#collapse-5a8c6cc0" role="button" aria-expanded="false" aria-controls="collapse-5a8c6cc0">
        <div class="fold-arrow">▶</div>ncdump -h sst*.nc
      </div>
      <div class="fold-collapse collapse" id="collapse-5a8c6cc0">
        <div class="fold-content">
          <figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs console"><span class="hljs-meta prompt_"> $ </span><span class="language-bash">ncdump -h sst.nc</span><br>netcdf sst &#123;<br>dimensions:<br>	longitude = 1440 ;<br>	latitude = 721 ;<br>variables:<br>	double sst(latitude, longitude) ;<br>		sst:coordinates = &quot;depthBelowLandLayer&quot; ;<br>		sst:_FillValue = -Infinity ;<br>		sst:missing_value = -Infinity ;<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"> $ </span><span class="language-bash">ncdump -h sst_test.nc</span> <br>netcdf sst_test &#123;<br>dimensions:<br>	longitude = 1440 ;<br>	latitude = 721 ;<br>variables:<br>	short sst(latitude, longitude) ;<br>		sst:coordinates = &quot;depthBelowLandLayer&quot; ;<br>		sst:add_offset = 294.354168667848 ;<br>		sst:scale_factor = 0.000648260007869365 ;<br>		sst:_FillValue = -32767s ;<br>		sst:missing_value = -32767s ;<br></code></pre></td></tr></table></figure>
        </div>
      </div>
    </div>
<p>then, <code>ncview sst_test.nc</code> is successful.</p>
<h1 id="references">References</h1>
<ol type="1">
<li><a target="_blank" rel="noopener" href="https://code.mpimet.mpg.de/projects/cdo/wiki/tutorial#Basic-Usage">Climate Data Operators (CDO) Tutorial (<strong>recommend</strong>)</a></li>
</ol>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/NWP/" class="category-chain-item">NWP</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/MPAS/" class="print-no-link">#MPAS</a>
      
        <a href="/tags/NWP/" class="print-no-link">#NWP</a>
      
        <a href="/tags/WRF/" class="print-no-link">#WRF</a>
      
        <a href="/tags/GFS/" class="print-no-link">#GFS</a>
      
        <a href="/tags/ERA5/" class="print-no-link">#ERA5</a>
      
        <a href="/tags/PGW/" class="print-no-link">#PGW</a>
      
        <a href="/tags/GRIB/" class="print-no-link">#GRIB</a>
      
        <a href="/tags/NetCDF/" class="print-no-link">#NetCDF</a>
      
        <a href="/tags/CMIP6/" class="print-no-link">#CMIP6</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>NWP | PGW | To prepare the ERA5 GRIB file</div>
      <div>https://waipangsze.github.io/2025/02/05/NWP-PGW-To-prepare-the-ERA5-GRIB-file/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>Author</div>
          <div>wpsze</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>Posted on</div>
          <div>February 5, 2025</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>Updated on</div>
          <div>October 27, 2025</div>
        </div>
      
      
        <div class="license-meta-item">
          <div>Licensed under</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - Attribution">
                    <i class="iconfont icon-cc-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2025/02/05/NWP-Check-grib-files/" title="NWP | Check grib files">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">NWP | Check grib files</span>
                        <span class="visible-mobile">Previous</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2025/02/04/ML-AnythingLLM-Ollama/" title="ML | AnythingLLM + Ollama">
                        <span class="hidden-mobile">ML | AnythingLLM + Ollama</span>
                        <span class="visible-mobile">Next</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>Table of Contents</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  


  
  





  <script>
  Fluid.utils.createScript('https://lib.baomitu.com/mermaid/8.14.0/mermaid.min.js', function() {
    mermaid.initialize({"theme":"default"});

    Fluid.utils.listenDOMLoaded(function() {
      Fluid.events.registerRefreshCallback(function() {
        if ('mermaid' in window) {
          mermaid.init();
        }
      });
    });
  });
</script>






<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-9HL36SZ28R"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-9HL36SZ28R');
</script>

    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">Keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">

  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  

  <span id="sitetime"></span>
  <script language=javascript>
    function siteTime(){
      window.setTimeout("siteTime()", 1000);
      var seconds = 1000;
      var minutes = seconds * 60;
      var hours = minutes * 60;
      var days = hours * 24;
      var years = days * 365;
      var today = new Date();
      var todayYear = today.getFullYear();
      var todayMonth = today.getMonth()+1;
      var todayDate = today.getDate();
      var todayHour = today.getHours();
      var todayMinute = today.getMinutes();
      var todaySecond = today.getSeconds();
      /* Date.UTC() -- 返回date对象距世界标准时间(UTC)1970年1月1日午夜之间的毫秒数(时间戳)
      year - 作为date对象的年份，为4位年份值
      month - 0-11之间的整数，做为date对象的月份
      day - 1-31之间的整数，做为date对象的天数
      hours - 0(午夜24点)-23之间的整数，做为date对象的小时数
      minutes - 0-59之间的整数，做为date对象的分钟数
      seconds - 0-59之间的整数，做为date对象的秒数
      microseconds - 0-999之间的整数，做为date对象的毫秒数 */
      var t1 = Date.UTC(2023,04,23,00,00,00); //北京时间2018-2-13 00:00:00
      var t2 = Date.UTC(todayYear,todayMonth,todayDate,todayHour,todayMinute,todaySecond);
      var diff = t2-t1;
      var diffYears = Math.floor(diff/years);
      var diffDays = Math.floor((diff/days)-diffYears*365);
      var diffHours = Math.floor((diff-(diffYears*365+diffDays)*days)/hours);
      var diffMinutes = Math.floor((diff-(diffYears*365+diffDays)*days-diffHours*hours)/minutes);
      var diffSeconds = Math.floor((diff-(diffYears*365+diffDays)*days-diffHours*hours-diffMinutes*minutes)/seconds);
      /*document.getElementById("sitetime").innerHTML=" 已运行"+/*diffYears+" 年 "+*/diffDays+" 天 "+diffHours+" 小时 "+diffMinutes+" 分钟 "+diffSeconds+" 秒";
      document.getElementById("sitetime").innerHTML=" 已運行"+diffYears+" 年 "+diffDays+" 天 ";
    }/*因为建站时间还没有一年，就将之注释掉了。需要的可以取消*/
    siteTime();
  </script>
  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/5.0.0/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  
      <script>
        if (!window.MathJax) {
          window.MathJax = {
            tex    : {
              inlineMath: { '[+]': [['$', '$']] }
            },
            loader : {
              load: ['ui/lazy']
            },
            options: {
              renderActions: {
                insertedScript: [200, () => {
                  document.querySelectorAll('mjx-container').forEach(node => {
                    let target = node.parentNode;
                    if (target.nodeName.toLowerCase() === 'li') {
                      target.parentNode.classList.add('has-jax');
                    }
                  });
                }, '', false]
              }
            }
          };
        } else {
          MathJax.startup.document.state(0);
          MathJax.texReset();
          MathJax.typeset();
          MathJax.typesetPromise();
        }

        Fluid.events.registerRefreshCallback(function() {
          if ('MathJax' in window && MathJax.startup.document && typeof MathJax.startup.document.state === 'function') {
            MathJax.startup.document.state(0);
            MathJax.texReset();
            MathJax.typeset();
            MathJax.typesetPromise();
          }
        });
      </script>
    

  <script  src="https://lib.baomitu.com/mathjax/3.2.2/es5/tex-mml-chtml.js" ></script>

  <script  src="/js/local-search.js" ></script>

  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">Blog works best with JavaScript enabled</div>
  </noscript>
</body>
</html>
