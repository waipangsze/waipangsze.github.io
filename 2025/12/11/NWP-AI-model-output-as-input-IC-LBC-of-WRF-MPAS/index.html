

<!DOCTYPE html>
<html lang="en" data-default-color-scheme=light>



<head>
  <meta charset="UTF-8">

  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="wpsze">
  <meta name="keywords" content="">
  
    <meta name="description" content="NWP | AI for Numerical Weather Prediction (NWP) NWP | ECMWF | IFS | Open data   Introduction As the field of Numerical Weather Prediction (NWP) rapidly evolves, the integration of AI-driven forecasti">
<meta property="og:type" content="article">
<meta property="og:title" content="NWP | AI model output as input (IC&#x2F;LBC) of WRF&#x2F;MPAS">
<meta property="og:url" content="https://waipangsze.github.io/2025/12/11/NWP-AI-model-output-as-input-IC-LBC-of-WRF-MPAS/index.html">
<meta property="og:site_name" content="wpsze">
<meta property="og:description" content="NWP | AI for Numerical Weather Prediction (NWP) NWP | ECMWF | IFS | Open data   Introduction As the field of Numerical Weather Prediction (NWP) rapidly evolves, the integration of AI-driven forecasti">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://i.imgur.com/De3YbE0.png">
<meta property="article:published_time" content="2025-12-10T22:00:00.000Z">
<meta property="article:modified_time" content="2025-12-11T07:03:11.866Z">
<meta property="article:author" content="wpsze">
<meta property="article:tag" content="MPAS">
<meta property="article:tag" content="NWP">
<meta property="article:tag" content="WRF">
<meta property="article:tag" content="ECMWF">
<meta property="article:tag" content="AI">
<meta property="article:tag" content="ML">
<meta property="article:tag" content="PanguWeather">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://i.imgur.com/De3YbE0.png">
  
  
    <meta name="referrer" content="no-referrer-when-downgrade">
  
  
  <title>NWP | AI model output as input (IC/LBC) of WRF/MPAS - wpsze</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css">



<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"waipangsze.github.io","root":"/","version":"1.9.8","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"follow_dnt":true,"baidu":null,"google":{"measurement_id":"F7MK-FcxSomhtc1N3hIUDA"},"tencent":{"sid":null,"cid":null},"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false},"umami":{"src":null,"website_id":null,"domains":null,"start_time":"2024-01-01T00:00:00.000Z","token":null,"api_server":null}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  

  

  
    <!-- Google tag (gtag.js) -->
    <script async>
      if (!Fluid.ctx.dnt) {
        Fluid.utils.createScript("https://www.googletagmanager.com/gtag/js?id=F7MK-FcxSomhtc1N3hIUDA", function() {
          window.dataLayer = window.dataLayer || [];
          function gtag() {
            dataLayer.push(arguments);
          }
          gtag('js', new Date());
          gtag('config', 'F7MK-FcxSomhtc1N3hIUDA');
        });
      }
    </script>
  

  

  

  



  
<meta name="generator" content="Hexo 7.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>wpsze</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>Home</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>Archives</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>Categories</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>Tags</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/" target="_self">
                <i class="iconfont icon-link-fill"></i>
                <span>Links</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/bookmark/" target="_self">
                <i class="iconfont icon-bookmark"></i>
                <span>Bookmarks</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" target="_self" href="javascript:;" role="button"
                 data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <i class="iconfont icon-books"></i>
                <span>Docs</span>
              </a>
              <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                
                  
                  
                  
                  <a class="dropdown-item" href="/categories/Physics/" target="_self">
                    <i class="iconfont icon-plan"></i>
                    <span>Physics</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/categories/Maths/" target="_self">
                    <i class="iconfont icon-plan"></i>
                    <span>Maths</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/categories/CFD/" target="_self">
                    <i class="iconfont icon-plan"></i>
                    <span>CFD</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/categories/ML/" target="_self">
                    <i class="iconfont icon-plan"></i>
                    <span>ML</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/categories/Meteorology/" target="_self">
                    <i class="iconfont icon-plan"></i>
                    <span>Meteorology</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/categories/MPAS/" target="_self">
                    <i class="iconfont icon-plan"></i>
                    <span>MPAS</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/categories/PALM/" target="_self">
                    <i class="iconfont icon-plan"></i>
                    <span>PALM</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/monitor/" target="_self">
                    
                    <span>Real Time Monitoring</span>
                  </a>
                
              </div>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>About Me</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('https://i.imgur.com/De3YbE0.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="NWP | AI model output as input (IC/LBC) of WRF/MPAS"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2025-12-11 06:00" pubdate>
          December 11, 2025 am
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          929 words
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          8 mins
        
      </span>
    

    
    
      
        <span id="busuanzi_container_page_pv" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="busuanzi_value_page_pv"></span> views
        </span>
        

      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">NWP | AI model output as input (IC/LBC) of WRF/MPAS</h1>
            
            
              <div class="markdown-body">
                
                <ul>
<li><a href="https://waipangsze.github.io/2024/10/09/NWP-AI-for-Numerical-Weather-Prediction-NWP/"><strong>NWP | AI for Numerical Weather Prediction (NWP)</strong></a></li>
<li><a href="https://waipangsze.github.io/2024/11/12/ECMWF-IFS/">NWP | ECMWF | IFS | Open data</a></li>
</ul>
<hr />
<h1 id="introduction">Introduction</h1>
<p>As the field of Numerical Weather Prediction (NWP) rapidly evolves, the integration of AI-driven forecasting models like ECMWF's Pangu-Weather offers incredible speed and efficiency. This post documents a technical workflow where I used the Pangu-Weather model to generate a 10-day forecast and encountered a critical issue when attempting to initialize the Weather Research and Forecasting (WRF) model: <strong>the absence of crucial soil temperature and soil moisture variables</strong> in the Pangu-Weather GRIB output.</p>
<p>This article outlines the steps taken, the problem encountered, and the solution involving the use of auxiliary data from the ECMWF's operational Integrated Forecasting System (IFS).</p>
<h1 id="literature-review">Literature review</h1>
<h2 id="ai-driven-wrf-2025">AI-Driven WRF (2025)</h2>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.nature.com/articles/s41612-025-00926-z.pdf">Xu, H., Zhao, Y., Dajun, Z., Duan, Y., &amp; Xu, X. (2025). Exploring the typhoon intensity forecasting through integrating AI weather forecasting with regional numerical weather model. npj Climate and Atmospheric Science, 8(1), 38.</a>
<ul>
<li>we propose an attractive approach by initiating regional Weather Research and Forecasting (WRF) model with Pangu-weather, a state-of-the-art AI weather forecasting system (AI-Driven WRF), whose forecasting power can be further augmented by the implementation of dynamic vortex initialization.</li>
<li><img src="https://i.imgur.com/1MtDXOA.png" srcset="/img/loading.gif" lazyload /></li>
</ul></li>
</ul>
<hr />
<h1 id="the-nwp-workflow-ai-model-to-wrf-input">The NWP Workflow: AI Model to WRF Input</h1>
<p>The process involves several standard steps in an NWP setup, with the AI model replacing the initial global model forecast:</p>
<h2 id="ai-forecast-generation-ecmwf-pangu-weather">1. AI Forecast Generation (ECMWF Pangu-Weather)</h2>
<p>I utilized the ECMWF implementation of the Pangu-Weather AI model to produce a 10-day forecast.</p>
<ul>
<li><strong>Model Used:</strong> <code>ai-models</code> (specifically utilizing the <code>pangu_weather_6.onnx</code> and <code>pangu_weather_24.onnx</code> models for 6-hourly and 24-hourly steps).</li>
<li><strong>Time Interval:</strong> A full 10-day forecast with output at 6-hour intervals.</li>
<li><p><strong>Output File:</strong> A single large GRIB file named <code>panguweather.grib</code>.</p></li>
<li><p><a href="https://waipangsze.github.io/2024/10/09/NWP-AI-for-Numerical-Weather-Prediction-NWP/#practice-2025-12-09" class="uri">https://waipangsze.github.io/2024/10/09/NWP-AI-for-Numerical-Weather-Prediction-NWP/#practice-2025-12-09</a></p></li>
</ul>
<blockquote>
<p><strong>Key takeaway:</strong> The Pangu-Weather model is trained primarily to forecast atmospheric variables like geopotential, wind components, temperature, and specific humidity. It does not natively output the necessary land surface variables (soil temperature and soil moisture) required for the WRF model's <code>ungrib</code> and <code>metgrid</code> steps.</p>
</blockquote>
<h2 id="preparing-grib-files-for-wrf">2. Preparing GRIB Files for WRF</h2>
<p>The single 10-day GRIB file needed to be processed for the WRF Preprocessing System (WPS).</p>
<ul>
<li><p><strong>Step 2a: Splitting the GRIB file</strong> The monolithic <code>panguweather.grib</code> file, containing all timesteps, was split into individual GRIB2 files, one for each 6-hour forecast time. This is often necessary for robust processing by the WPS utilities.</p>
<ul>
<li><p>Method 1: Using CDO (Climate Data Operators)</p>
<ul>
<li><p>CDO is the simplest command-line solution and is often pre-installed or easily available in scientific computing environments.</p></li>
<li><p><strong>CDO Command: <code>splitsel</code></strong></p></li>
<li><p>The <code>splitsel,1</code> operator is designed to split a file into one output file per timestep (or more accurately, one file per selection/record). Since IFS GRIB files often have multiple fields (parameters, levels) per timestep, this command works by splitting based on the internal record count.</p></li>
</ul>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># Syntax: cdo -splitsel,N &lt;input_file&gt; &lt;output_prefix&gt;</span><br><span class="hljs-comment"># N=1 means split after every single record/timestep.</span><br><br>cdo -splitsel,1 input_ifs.grib2 output_timestep_<br></code></pre></td></tr></table></figure></p>
<ul>
<li><strong>Output Files:</strong> This will generate files named sequentially, like <code>output_timestep_000001.grib2</code>, <code>output_timestep_000002.grib2</code>, etc.</li>
</ul></li>
</ul></li>
<li><p><strong>Step 2b: The <code>ungrib</code> Step</strong> The <code>ungrib.exe</code> utility reads the meteorological data from the GRIB files and extracts/interpolates them onto a model-ready intermediate file format (e.g., <code>AI:YYYY-MM-DD_HH</code>).</p>
<ul>
<li><strong>Action:</strong> Ran <code>ungrib.exe</code> on the individual Pangu-Weather GRIB files.</li>
<li><strong>Result:</strong> <code>ungrib</code> processed the atmospheric variables successfully.</li>
</ul></li>
<li><p><strong>Step 2c: The <code>metgrid</code> Step</strong> The <code>metgrid.exe</code> utility takes the intermediate files and horizontally interpolates the data onto the user-defined WRF grid domains.</p>
<ul>
<li><strong>Action:</strong> Ran <code>metgrid.exe</code>.</li>
<li><strong>Result:</strong> Successful, but the resulting <code>met_em.*</code> files were deficient.</li>
</ul></li>
</ul>

    <div class="fold">
      <div class="fold-title fold-info collapsed" data-toggle="collapse" href="#collapse-dcdac752" role="button" aria-expanded="false" aria-controls="collapse-dcdac752">
        <div class="fold-arrow">▶</div>ncdump -h met_em.d01.2025-12-08_00\:00\:00.nc
      </div>
      <div class="fold-collapse collapse" id="collapse-dcdac752">
        <div class="fold-content">
          <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br></pre></td><td class="code"><pre><code class="hljs log">netcdf met_em.d01.2025-12-08_00\:00\:00 &#123;<br>dimensions:<br>	Time = UNLIMITED ; // (1 currently)<br>	DateStrLen = 19 ;<br>	west_east = 151 ;<br>	south_north = 117 ;<br>	num_metgrid_levels = 14 ;<br>	south_north_stag = 118 ;<br>	west_east_stag = 152 ;<br>	z-dimension0003 = 3 ;<br>	z-dimension0132 = 132 ;<br>	z-dimension0012 = 12 ;<br>	z-dimension0016 = 16 ;<br>	z-dimension0020 = 20 ;<br>variables:<br>	char Times(Time, DateStrLen) ;<br>	float PRES(Time, num_metgrid_levels, south_north, west_east) ;<br>	float VV(Time, num_metgrid_levels, south_north_stag, west_east) ;<br>	float UU(Time, num_metgrid_levels, south_north, west_east_stag) ;<br>	float TT(Time, num_metgrid_levels, south_north, west_east) ;<br>	float PMSL(Time, south_north, west_east) ;<br>	float OL4SS(Time, south_north, west_east) ;<br>	float OL3SS(Time, south_north, west_east) ;<br>	float OL2SS(Time, south_north, west_east) ;<br>	float OL1SS(Time, south_north, west_east) ;<br>	float OA4SS(Time, south_north, west_east) ;<br>	float OA3SS(Time, south_north, west_east) ;<br>	float OA2SS(Time, south_north, west_east) ;<br>	float OA1SS(Time, south_north, west_east) ;<br>	float VARSS(Time, south_north, west_east) ;<br>	float CONSS(Time, south_north, west_east) ;<br>	float OL4LS(Time, south_north, west_east) ;<br>	float OL3LS(Time, south_north, west_east) ;<br>	float OL2LS(Time, south_north, west_east) ;<br>	float OL1LS(Time, south_north, west_east) ;<br>	float OA4LS(Time, south_north, west_east) ;<br>	float OA3LS(Time, south_north, west_east) ;<br>	float OA2LS(Time, south_north, west_east) ;<br>	float OA1LS(Time, south_north, west_east) ;<br>	float VARLS(Time, south_north, west_east) ;<br>	float CONLS(Time, south_north, west_east) ;<br>	float IRRIGATION(Time, south_north, west_east) ;<br>	float SANDFRAC(Time, south_north, west_east) ;<br>	float CLAYFRAC(Time, south_north, west_east) ;<br>	float EROD(Time, z-dimension0003, south_north, west_east) ;<br>	float CANFRA(Time, south_north, west_east) ;<br>	float IMPERV(Time, south_north, west_east) ;<br>	float FRC_URB2D(Time, south_north, west_east) ;<br>	float URB_PARAM(Time, z-dimension0132, south_north, west_east) ;<br>	float LAKE_DEPTH(Time, south_north, west_east) ;<br>	float VAR_SSO(Time, south_north, west_east) ;<br>	float OL4(Time, south_north, west_east) ;<br>	float OL3(Time, south_north, west_east) ;<br>	float OL2(Time, south_north, west_east) ;<br>	float OL1(Time, south_north, west_east) ;<br>	float OA4(Time, south_north, west_east) ;<br>	float OA3(Time, south_north, west_east) ;<br>	float OA2(Time, south_north, west_east) ;<br>	float OA1(Time, south_north, west_east) ;<br>	float VAR(Time, south_north, west_east) ;<br>	float CON(Time, south_north, west_east) ;<br>	float SNOALB(Time, south_north, west_east) ;<br>	float LAI12M(Time, z-dimension0012, south_north, west_east) ;<br>	float GREENFRAC(Time, z-dimension0012, south_north, west_east) ;<br>	float ALBEDO12M(Time, z-dimension0012, south_north, west_east) ;<br>	float SCB_DOM(Time, south_north, west_east) ;<br>	float SOILCBOT(Time, z-dimension0016, south_north, west_east) ;<br>	float SCT_DOM(Time, south_north, west_east) ;<br>	float SOILCTOP(Time, z-dimension0016, south_north, west_east) ;<br>	float SOILTEMP(Time, south_north, west_east) ;<br>	float HGT_M(Time, south_north, west_east) ;<br>	float LU_INDEX(Time, south_north, west_east) ;<br>	float LANDUSEF(Time, z-dimension0020, south_north, west_east) ;<br>	float COSALPHA_V(Time, south_north_stag, west_east) ;<br>	float SINALPHA_V(Time, south_north_stag, west_east) ;<br>	float COSALPHA_U(Time, south_north, west_east_stag) ;<br>	float SINALPHA_U(Time, south_north, west_east_stag) ;<br>	float XLONG_C(Time, south_north_stag, west_east_stag) ;<br>	float XLAT_C(Time, south_north_stag, west_east_stag) ;<br>	float LANDMASK(Time, south_north, west_east) ;<br>	float COSALPHA(Time, south_north, west_east) ;<br>	float SINALPHA(Time, south_north, west_east) ;<br>	float F(Time, south_north, west_east) ;<br>	float E(Time, south_north, west_east) ;<br>	float MAPFAC_UY(Time, south_north, west_east_stag) ;<br>	float MAPFAC_VY(Time, south_north_stag, west_east) ;<br>	float MAPFAC_MY(Time, south_north, west_east) ;<br>	float MAPFAC_UX(Time, south_north, west_east_stag) ;<br>	float MAPFAC_VX(Time, south_north_stag, west_east) ;<br>	float MAPFAC_MX(Time, south_north, west_east) ;<br>	float MAPFAC_U(Time, south_north, west_east_stag) ;<br>	float MAPFAC_V(Time, south_north_stag, west_east) ;<br>	float MAPFAC_M(Time, south_north, west_east) ;<br>	float CLONG(Time, south_north, west_east) ;<br>	float CLAT(Time, south_north, west_east) ;<br>	float XLONG_U(Time, south_north, west_east_stag) ;<br>	float XLAT_U(Time, south_north, west_east_stag) ;<br>	float XLONG_V(Time, south_north_stag, west_east) ;<br>	float XLAT_V(Time, south_north_stag, west_east) ;<br>	float XLONG_M(Time, south_north, west_east) ;<br>	float XLAT_M(Time, south_north, west_east) ;<br>// global attributes:<br>		:TITLE = &quot;OUTPUT FROM METGRID V4.6.0&quot; ;<br>		:SIMULATION_START_DATE = &quot;2025-12-08_00:00:00&quot; ;<br>		:WEST-EAST_GRID_DIMENSION = 152 ;<br>		:SOUTH-NORTH_GRID_DIMENSION = 118 ;<br>		:BOTTOM-TOP_GRID_DIMENSION = 14 ;<br>		:WEST-EAST_PATCH_START_UNSTAG = 1 ;<br>		:WEST-EAST_PATCH_END_UNSTAG = 151 ;<br>		:WEST-EAST_PATCH_START_STAG = 1 ;<br>		:WEST-EAST_PATCH_END_STAG = 152 ;<br>		:SOUTH-NORTH_PATCH_START_UNSTAG = 1 ;<br>		:SOUTH-NORTH_PATCH_END_UNSTAG = 117 ;<br>		:SOUTH-NORTH_PATCH_START_STAG = 1 ;<br>		:SOUTH-NORTH_PATCH_END_STAG = 118 ;<br>		:GRIDTYPE = &quot;C&quot; ;<br>		:DX = 54000.f ;<br>		:DY = 54000.f ;<br>		:DYN_OPT = 2 ;<br>		:CEN_LAT = 33.86901f ;<br>		:CEN_LON = 101.666f ;<br>		:TRUELAT1 = 33.87f ;<br>		:TRUELAT2 = 33.87f ;<br>		:MOAD_CEN_LAT = 33.86901f ;<br>		:STAND_LON = 102.186f ;<br>		:POLE_LAT = 90.f ;<br>		:POLE_LON = 0.f ;<br>		:corner_lats = 1.56295f, 50.91934f, 51.36064f, 1.790321f, 1.498215f, 50.79367f, 51.2374f, 1.72683f, 1.36425f, 51.11355f, 51.55564f, 1.590767f, 1.299759f, 50.98765f, 51.43218f, 1.527496f ;<br>		:corner_lons = 69.9118f, 43.32767f, 159.9401f, 133.7513f, 69.71295f, 43.01984f, 160.2521f, 133.951f, 69.97626f, 43.1283f, 160.1375f, 133.688f, 69.77777f, 42.81989f, 160.4501f, 133.8874f ;<br>		:MAP_PROJ = 1 ;<br>		:MMINLU = &quot;MODIFIED_IGBP_MODIS_NOAH&quot; ;<br>		:NUM_LAND_CAT = 20 ;<br>		:ISWATER = 17 ;<br>		:ISLAKE = -1 ;<br>		:ISICE = 15 ;<br>		:ISURBAN = 13 ;<br>		:ISOILWATER = 14 ;<br>		:grid_id = 1 ;<br>		:parent_id = 1 ;<br>		:i_parent_start = 1 ;<br>		:j_parent_start = 1 ;<br>		:i_parent_end = 152 ;<br>		:j_parent_end = 118 ;<br>		:parent_grid_ratio = 1 ;<br>		:sr_x = 1 ;<br>		:sr_y = 1 ;<br>		:NUM_METGRID_SOIL_LEVELS = 0 ;<br>		:FLAG_METGRID = 1 ;<br>		:FLAG_EXCLUDED_MIDDLE = 0 ;<br>		:FLAG_SLP = 1 ;<br>		:FLAG_MF_XY = 1 ;<br>		:FLAG_LAI12M = 1 ;<br>		:FLAG_VAR_SSO = 1 ;<br>		:FLAG_LAKE_DEPTH = 1 ;<br>		:FLAG_URB_PARAM = 1 ;<br>		:FLAG_FRC_URB2D = 1 ;<br>		:FLAG_IMPERV = 1 ;<br>		:FLAG_CANFRA = 1 ;<br>		:FLAG_EROD = 1 ;<br>		:FLAG_CLAYFRAC = 1 ;<br>		:FLAG_SANDFRAC = 1 ;<br>&#125;<br></code></pre></td></tr></table></figure>
        </div>
      </div>
    </div>
<hr />
<h2 id="the-critical-problem-missing-soil-variables">The Critical Problem: Missing Soil Variables</h2>
<p>Upon inspecting the <code>met_em.*</code> files generated by <code>metgrid</code>, a crucial issue was identified (often logged as an error or warning during <code>metgrid</code>, or discovered later during the <code>real</code> step):</p>
<p><strong>The <code>met_em</code> files contained only atmospheric variables (geopotential height, temperature, wind, pressure, specific humidity, ...) but were completely missing land surface variables, specifically:</strong></p>
<ul>
<li><strong>Soil Temperature (ST000010, etc.)</strong></li>
<li><strong>Soil Moisture (SM000010, etc.)</strong></li>
</ul>
<figure>
<img src="https://i.imgur.com/DMNgLdw.png" srcset="/img/loading.gif" lazyload alt="Left: IFS met_em. Right: AI met_em" /><figcaption>Left: IFS met_em. Right: AI met_em</figcaption>
</figure>
<p>The WRF model requires these variables to correctly initialize the land surface physics (Land Surface Model, LSM) and maintain a realistic energy and water balance at the lower boundary. Initializing WRF without them will lead to incorrect surface fluxes, potentially causing model "blow-up" or severe biases in near-surface forecasts.</p>
<hr />
<h2 id="the-solution-auxiliary-data-sourcing">The Solution: Auxiliary Data Sourcing</h2>
<p>The fix requires obtaining the missing soil variables from a reliable source and merging them into the initialization data.</p>
<h3 id="strategy-using-ecmwf-ifs-operational-data">Strategy: Using ECMWF-IFS Operational Data</h3>
<p>Since <code>Pangu-Weather</code> is a re-forecast product based on ECMWF training data (<strong>ERA5</strong>), the logical step is to use the <strong>ECMWF's Integrated Forecasting System (IFS)</strong> operational analysis or short-range forecast for the same initialization time.</p>
<p>The solution steps are:</p>
<ol type="1">
<li><strong>Download Auxiliary Data:</strong> Obtain the required soil variables (Soil Temperature and Volumetric Soil Water/Moisture) from the ECMWF's high-resolution operational model (HRES) or reanalysis (ERA5) for the forecast start time.
<ul>
<li><strong>Variables:</strong> Typically required at four soil levels.</li>
</ul></li>
<li><strong>Separate GRIB Processing:</strong> Process this auxiliary IFS GRIB file <em>separately</em> through <code>ungrib</code> and <code>metgrid</code>.
<ul>
<li>The IFS data will be processed by WPS to create a set of <code>met_em.*</code> files containing <strong>only the soil variables</strong>.</li>
</ul></li>
<li><strong>Data Merging (Copy/Overwrite):</strong> Use a utility to copy/merge the soil variables from the IFS-derived <code>met_em.*</code> files into the Pangu-Weather derived <code>met_em.*</code> files.</li>
</ol>
<blockquote>
<p><strong>Conceptual Code Snippet (Using NetCDF tools like NCO):</strong></p>
<ol type="1">
<li>Generate <code>met_em_pangu.*</code> (Pangu-Weather, missing soil)</li>
<li>Generate <code>met_em_ifs_soil.*</code> (IFS, only soil variables)</li>
<li>Merge: <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># Example using NCO/NetCDF command to copy variable &#x27;TSLB&#x27; (Soil Temp)</span><br>ncks -A met_em_ifs_soil.d01.2025-12-11_00:00:00 met_em_pangu.d01.2025-12-11_00:00:00 -v TSLB<br></code></pre></td></tr></table></figure></li>
<li><strong>Verification:</strong> Verify the final, merged <code>met_em.*</code> files contain all necessary atmospheric (from Pangu) and land surface (from IFS) fields.</li>
</ol>
</blockquote>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/NWP/" class="category-chain-item">NWP</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/MPAS/" class="print-no-link">#MPAS</a>
      
        <a href="/tags/NWP/" class="print-no-link">#NWP</a>
      
        <a href="/tags/WRF/" class="print-no-link">#WRF</a>
      
        <a href="/tags/ECMWF/" class="print-no-link">#ECMWF</a>
      
        <a href="/tags/AI/" class="print-no-link">#AI</a>
      
        <a href="/tags/ML/" class="print-no-link">#ML</a>
      
        <a href="/tags/PanguWeather/" class="print-no-link">#PanguWeather</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>NWP | AI model output as input (IC/LBC) of WRF/MPAS</div>
      <div>https://waipangsze.github.io/2025/12/11/NWP-AI-model-output-as-input-IC-LBC-of-WRF-MPAS/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>Author</div>
          <div>wpsze</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>Posted on</div>
          <div>December 11, 2025</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>Updated on</div>
          <div>December 11, 2025</div>
        </div>
      
      
        <div class="license-meta-item">
          <div>Licensed under</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - Attribution">
                    <i class="iconfont icon-cc-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2025/12/19/CFD-Turbulence-model-activation/" title="CFD | Turbulence model activation (use or not use)">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">CFD | Turbulence model activation (use or not use)</span>
                        <span class="visible-mobile">Previous</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2025/12/09/CFD-Flat-Plate/" title="CFD | Flat Plate">
                        <span class="hidden-mobile">CFD | Flat Plate</span>
                        <span class="visible-mobile">Next</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>Table of Contents</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  


  
  





  <script>
  Fluid.utils.createScript('https://lib.baomitu.com/mermaid/8.14.0/mermaid.min.js', function() {
    mermaid.initialize({"theme":"default"});

    Fluid.utils.listenDOMLoaded(function() {
      Fluid.events.registerRefreshCallback(function() {
        if ('mermaid' in window) {
          mermaid.init();
        }
      });
    });
  });
</script>






<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-9HL36SZ28R"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-9HL36SZ28R');
</script>

    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">Keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">

  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  

  <span id="sitetime"></span>
  <script language=javascript>
    function siteTime(){
      window.setTimeout("siteTime()", 1000);
      var seconds = 1000;
      var minutes = seconds * 60;
      var hours = minutes * 60;
      var days = hours * 24;
      var years = days * 365;
      var today = new Date();
      var todayYear = today.getFullYear();
      var todayMonth = today.getMonth()+1;
      var todayDate = today.getDate();
      var todayHour = today.getHours();
      var todayMinute = today.getMinutes();
      var todaySecond = today.getSeconds();
      /* Date.UTC() -- 返回date对象距世界标准时间(UTC)1970年1月1日午夜之间的毫秒数(时间戳)
      year - 作为date对象的年份，为4位年份值
      month - 0-11之间的整数，做为date对象的月份
      day - 1-31之间的整数，做为date对象的天数
      hours - 0(午夜24点)-23之间的整数，做为date对象的小时数
      minutes - 0-59之间的整数，做为date对象的分钟数
      seconds - 0-59之间的整数，做为date对象的秒数
      microseconds - 0-999之间的整数，做为date对象的毫秒数 */
      var t1 = Date.UTC(2023,04,23,00,00,00); //北京时间2018-2-13 00:00:00
      var t2 = Date.UTC(todayYear,todayMonth,todayDate,todayHour,todayMinute,todaySecond);
      var diff = t2-t1;
      var diffYears = Math.floor(diff/years);
      var diffDays = Math.floor((diff/days)-diffYears*365);
      var diffHours = Math.floor((diff-(diffYears*365+diffDays)*days)/hours);
      var diffMinutes = Math.floor((diff-(diffYears*365+diffDays)*days-diffHours*hours)/minutes);
      var diffSeconds = Math.floor((diff-(diffYears*365+diffDays)*days-diffHours*hours-diffMinutes*minutes)/seconds);
      /*document.getElementById("sitetime").innerHTML=" 已运行"+/*diffYears+" 年 "+*/diffDays+" 天 "+diffHours+" 小时 "+diffMinutes+" 分钟 "+diffSeconds+" 秒";
      document.getElementById("sitetime").innerHTML=" 已運行"+diffYears+" 年 "+diffDays+" 天 ";
    }/*因为建站时间还没有一年，就将之注释掉了。需要的可以取消*/
    siteTime();
  </script>
  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/5.0.0/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  
      <script>
        if (!window.MathJax) {
          window.MathJax = {
            tex    : {
              inlineMath: { '[+]': [['$', '$']] }
            },
            loader : {
              load: ['ui/lazy']
            },
            options: {
              renderActions: {
                insertedScript: [200, () => {
                  document.querySelectorAll('mjx-container').forEach(node => {
                    let target = node.parentNode;
                    if (target.nodeName.toLowerCase() === 'li') {
                      target.parentNode.classList.add('has-jax');
                    }
                  });
                }, '', false]
              }
            }
          };
        } else {
          MathJax.startup.document.state(0);
          MathJax.texReset();
          MathJax.typeset();
          MathJax.typesetPromise();
        }

        Fluid.events.registerRefreshCallback(function() {
          if ('MathJax' in window && MathJax.startup.document && typeof MathJax.startup.document.state === 'function') {
            MathJax.startup.document.state(0);
            MathJax.texReset();
            MathJax.typeset();
            MathJax.typesetPromise();
          }
        });
      </script>
    

  <script  src="https://lib.baomitu.com/mathjax/3.2.2/es5/tex-mml-chtml.js" ></script>

  <script  src="/js/local-search.js" ></script>

  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">Blog works best with JavaScript enabled</div>
  </noscript>
</body>
</html>
